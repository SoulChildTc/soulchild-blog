<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>kubeadm堆叠方案部署k8s高可用集群 - SoulChild随笔记</title><meta name=author content="SoulChild"><meta name=author-link content="https://www.soulchild.cn"><meta name=description content="小牛之路,记录点滴成长"><meta name=keywords content="k8s"><meta itemprop=name content="kubeadm堆叠方案部署k8s高可用集群"><meta itemprop=description content><meta itemprop=datePublished content="2020-07-10T13:11:00+08:00"><meta itemprop=dateModified content="2020-12-08T16:25:33+08:00"><meta itemprop=wordCount content="1513"><meta itemprop=image content="https://www.soulchild.cn/logo.png"><meta itemprop=keywords content="k8s,"><meta property="og:title" content="kubeadm堆叠方案部署k8s高可用集群"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://www.soulchild.cn/post/1875/"><meta property="og:image" content="https://www.soulchild.cn/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-07-10T13:11:00+08:00"><meta property="article:modified_time" content="2020-12-08T16:25:33+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.soulchild.cn/logo.png"><meta name=twitter:title content="kubeadm堆叠方案部署k8s高可用集群"><meta name=twitter:description content><meta name=application-name content="SoulChild随笔记"><meta name=apple-mobile-web-app-title content="SoulChild随笔记"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.soulchild.cn/post/1875/><link rel=prev href=https://www.soulchild.cn/post/1874/><link rel=next href=https://www.soulchild.cn/post/1876/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"kubeadm堆叠方案部署k8s高可用集群","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.soulchild.cn\/post\/1875\/"},"genre":"posts","keywords":"k8s","wordcount":1513,"url":"https:\/\/www.soulchild.cn\/post\/1875\/","datePublished":"2020-07-10T13:11:00+08:00","dateModified":"2020-12-08T16:25:33+08:00","publisher":{"@type":"Organization","name":"SoulChild"},"author":{"@type":"Person","name":"SoulChild"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=SoulChild随笔记><span class=header-title-pre><i class='fa-brands fa-docker'></i></span><span class=header-title-text>SoulChild随笔记</span></a><span id=typeit-header-subtitle-desktop class="typeit header-subtitle"></span></div><nav><ul class=menu><li class="menu-item text-start"><a class=menu-link href=/posts/ title=所有文章><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 所有文章</a></li><li class="menu-item text-start"><a class=menu-link href=/tags/ title=标签><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class="menu-item text-start has-children"><a class=menu-link href=/categories/ title=分类><i class="fa-fw fas fa-folder-open fa-fw fa-sm" aria-hidden=true></i> 分类</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class="menu-item text-start"><a class=menu-link href=/categories/kubernetes title=Kubernetes><i class="fa-solid fa-dharmachakra fa-fw fa-sm" aria-hidden=true></i> Kubernetes</a></li><li class="menu-item text-start"><a class=menu-link href=/categories/python title=Python><i class="fa-brands fa-python fa-fw fa-sm" aria-hidden=true></i> Python</a></li><li class="menu-item text-start"><a class=menu-link href=/categories/golang title=Golang><i class="fa-brands fa-golang fa-fw fa-sm" aria-hidden=true></i> Golang</a></li></ul></li><li class="menu-item text-start"><a class=menu-link href=/friends/ title=友链><i class="fa-solid fa-users fa-fw fa-sm fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="$grep " id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=SoulChild随笔记><span class=header-title-pre><i class='fa-brands fa-docker'></i></span><span class=header-title-text>SoulChild随笔记</span></a><span id=typeit-header-subtitle-mobile class="typeit header-subtitle"></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="$grep " id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class="menu-item text-start"><a class=menu-link href=/posts/ title=所有文章><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 所有文章</a></li><li class="menu-item text-start"><a class=menu-link href=/tags/ title=标签><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class="menu-item text-start"><span class=nested-item><a class=menu-link href=/categories/ title=分类><i class="fa-fw fas fa-folder-open fa-fw fa-sm" aria-hidden=true></i> 分类</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class="menu-item text-start"><a class=menu-link href=/categories/kubernetes title=Kubernetes><i class="fa-solid fa-dharmachakra fa-fw fa-sm" aria-hidden=true></i> Kubernetes</a></li><li class="menu-item text-start"><a class=menu-link href=/categories/python title=Python><i class="fa-brands fa-python fa-fw fa-sm" aria-hidden=true></i> Python</a></li><li class="menu-item text-start"><a class=menu-link href=/categories/golang title=Golang><i class="fa-brands fa-golang fa-fw fa-sm" aria-hidden=true></i> Golang</a></li></ul></li><li class="menu-item text-start"><a class=menu-link href=/friends/ title=友链><i class="fa-solid fa-users fa-fw fa-sm fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container data-page-style=normal><aside class=toc id=toc-auto></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>kubeadm堆叠方案部署k8s高可用集群</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://www.soulchild.cn title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img class="lazyload avatar" src=/svg/loading.min.svg data-src=/images/avatar.png data-srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" data-sizes=auto alt=SoulChild title=SoulChild>&nbsp;SoulChild</a></span>
<span class=post-category>收录于 <a href=/categories/kubernetes/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> kubernetes</a></span></div><div class=post-meta-line><span title="2020-07-10 13:11:00"><i class="fa-regular fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime="2020-07-10 13:11">2020-07-10 13:11</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i> 约 1513 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw" aria-hidden=true></i> 预计阅读 8 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title=kubeadm堆叠方案部署k8s高可用集群>
<i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class=content id=content data-end-flag=---><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-exclamation-triangle fa-fw" aria-hidden=true></i>警告<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>本文最后更新于 2020-12-08 16:25，文中内容可能已过时。</div></div></div><p>1.host解析</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat &gt;&gt; /etc/hosts <span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>10.0.0.10  k8s-master01
</span></span></span><span class=line><span class=cl><span class=s>10.0.0.11  k8s-master02
</span></span></span><span class=line><span class=cl><span class=s>10.0.0.12  k8s-master03
</span></span></span><span class=line><span class=cl><span class=s>10.0.0.5   k8s-master
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></td></tr></table></div></div><p>2.安装依赖包</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum install -y epel-release conntrack ntpdate ntp ipvsadm ipset jq iptables curl sysstat libseccomp wget unzip net-tools
</span></span></code></pre></td></tr></table></div></div><p>3.关闭防火墙</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl stop firewalld
</span></span><span class=line><span class=cl>systemctl disable firewalld
</span></span><span class=line><span class=cl>iptables -F <span class=o>&amp;&amp;</span> iptables -X <span class=o>&amp;&amp;</span> iptables -F -t nat <span class=o>&amp;&amp;</span> iptables -X -t nat
</span></span><span class=line><span class=cl>iptables -P FORWARD ACCEPT
</span></span></code></pre></td></tr></table></div></div><p>4.关闭selinux</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>setenforce <span class=m>0</span>
</span></span><span class=line><span class=cl>sed -i <span class=s1>&#39;s/^SELINUX=.*/SELINUX=disabled/&#39;</span> /etc/selinux/config
</span></span></code></pre></td></tr></table></div></div><p>5.优化内核参数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>modprobe br_netfilter
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat &gt; kubernetes.conf <span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>net.bridge.bridge-nf-call-iptables=1
</span></span></span><span class=line><span class=cl><span class=s>net.bridge.bridge-nf-call-ip6tables=1
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.ip_forward=1
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.tcp_tw_recycle=0
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.neigh.default.gc_thresh1=1024
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.neigh.default.gc_thresh2=2048
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.neigh.default.gc_thresh3=4096
</span></span></span><span class=line><span class=cl><span class=s>vm.swappiness=0 # 禁止使用 swap 空间，只有当系统 OOM 时才允许使用它
</span></span></span><span class=line><span class=cl><span class=s>vm.overcommit_memory=1 # 不检查物理内存是否够用
</span></span></span><span class=line><span class=cl><span class=s>vm.panic_on_oom=0 # 开启 OOM
</span></span></span><span class=line><span class=cl><span class=s>fs.inotify.max_user_instances=8192
</span></span></span><span class=line><span class=cl><span class=s>fs.inotify.max_user_watches=1048576
</span></span></span><span class=line><span class=cl><span class=s>fs.file-max=52706963
</span></span></span><span class=line><span class=cl><span class=s>fs.nr_open=52706963
</span></span></span><span class=line><span class=cl><span class=s>net.ipv6.conf.all.disable_ipv6=1
</span></span></span><span class=line><span class=cl><span class=s>net.netfilter.nf_conntrack_max=2310720
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cp kubernetes.conf  /etc/sysctl.d/kubernetes.conf
</span></span><span class=line><span class=cl>sysctl -p /etc/sysctl.d/kubernetes.conf
</span></span></code></pre></td></tr></table></div></div><p>ipvs配置</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>modprobe ip_vs_rr
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat &gt; /etc/sysconfig/modules/ipvs.modules <span class=s>&lt;&lt;EOF 
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash 
</span></span></span><span class=line><span class=cl><span class=s>modprobe -- ip_vs 
</span></span></span><span class=line><span class=cl><span class=s>modprobe -- ip_vs_rr 
</span></span></span><span class=line><span class=cl><span class=s>modprobe -- ip_vs_wrr 
</span></span></span><span class=line><span class=cl><span class=s>modprobe -- ip_vs_sh 
</span></span></span><span class=line><span class=cl><span class=s>modprobe -- nf_conntrack_ipv4 
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>chmod <span class=m>755</span> /etc/sysconfig/modules/ipvs.modules <span class=o>&amp;&amp;</span> bash /etc/sysconfig/modules/ipvs.modules <span class=o>&amp;&amp;</span> lsmod <span class=p>|</span> grep -e ip_vs -e nf_conntrack_ipv4
</span></span></code></pre></td></tr></table></div></div><p>6.安装keepalived</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum install -y keepalived
</span></span></code></pre></td></tr></table></div></div><p>7.配置keepalived,另外两台也需要配置，需要修改router_id、</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat &gt; /etc/keepalived/keepalived.conf <span class=s>&lt;&lt; EOF 
</span></span></span><span class=line><span class=cl><span class=s>global_defs {
</span></span></span><span class=line><span class=cl><span class=s>   router_id k8s-master01
</span></span></span><span class=line><span class=cl><span class=s>}
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>vrrp_script check_haproxy {
</span></span></span><span class=line><span class=cl><span class=s>    #根据进程名称检测进程是否存在
</span></span></span><span class=line><span class=cl><span class=s>    script &#34;killall -0 haproxy&#34;   
</span></span></span><span class=line><span class=cl><span class=s>    #每3秒检查一次
</span></span></span><span class=line><span class=cl><span class=s>    interval 3
</span></span></span><span class=line><span class=cl><span class=s>    #检测失败会减少2的权值
</span></span></span><span class=line><span class=cl><span class=s>    weight -2
</span></span></span><span class=line><span class=cl><span class=s>    #10次检测失败才为失败状态
</span></span></span><span class=line><span class=cl><span class=s>    fall 10
</span></span></span><span class=line><span class=cl><span class=s>    #2次检测成功才为正常状态
</span></span></span><span class=line><span class=cl><span class=s>    rise 2
</span></span></span><span class=line><span class=cl><span class=s>}
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>vrrp_instance VI_1 {
</span></span></span><span class=line><span class=cl><span class=s>    state BACKUP
</span></span></span><span class=line><span class=cl><span class=s>    interface eth0
</span></span></span><span class=line><span class=cl><span class=s>    virtual_router_id 51
</span></span></span><span class=line><span class=cl><span class=s>    priority 100
</span></span></span><span class=line><span class=cl><span class=s>    advert_int 1
</span></span></span><span class=line><span class=cl><span class=s>    authentication {
</span></span></span><span class=line><span class=cl><span class=s>        auth_type PASS
</span></span></span><span class=line><span class=cl><span class=s>        auth_pass soulchild
</span></span></span><span class=line><span class=cl><span class=s>    }
</span></span></span><span class=line><span class=cl><span class=s>    virtual_ipaddress {
</span></span></span><span class=line><span class=cl><span class=s>        10.0.0.5
</span></span></span><span class=line><span class=cl><span class=s>    }
</span></span></span><span class=line><span class=cl><span class=s>    track_script {
</span></span></span><span class=line><span class=cl><span class=s>        check_haproxy
</span></span></span><span class=line><span class=cl><span class=s>    }
</span></span></span><span class=line><span class=cl><span class=s>}
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></td></tr></table></div></div><p>启动</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl <span class=nb>enable</span> keepalived <span class=o>&amp;&amp;</span> systemctl start keepalived
</span></span></code></pre></td></tr></table></div></div><p>8.安装配置haproxy</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum install -y haproxy
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat &gt; /etc/haproxy/haproxy.cfg <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>#---------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=s># Global settings
</span></span></span><span class=line><span class=cl><span class=s>#---------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=s>global
</span></span></span><span class=line><span class=cl><span class=s>    # to have these messages end up in /var/log/haproxy.log you will
</span></span></span><span class=line><span class=cl><span class=s>    # need to:
</span></span></span><span class=line><span class=cl><span class=s>    # 1) configure syslog to accept network log events.  This is done
</span></span></span><span class=line><span class=cl><span class=s>    #    by adding the &#39;-r&#39; option to the SYSLOGD_OPTIONS in
</span></span></span><span class=line><span class=cl><span class=s>    #    /etc/sysconfig/syslog
</span></span></span><span class=line><span class=cl><span class=s>    # 2) configure local2 events to go to the /var/log/haproxy.log
</span></span></span><span class=line><span class=cl><span class=s>    #   file. A line like the following can be added to
</span></span></span><span class=line><span class=cl><span class=s>    #   /etc/sysconfig/syslog
</span></span></span><span class=line><span class=cl><span class=s>    #
</span></span></span><span class=line><span class=cl><span class=s>    #    local2.*                       /var/log/haproxy.log
</span></span></span><span class=line><span class=cl><span class=s>    #
</span></span></span><span class=line><span class=cl><span class=s>    log         127.0.0.1 local2
</span></span></span><span class=line><span class=cl><span class=s>    
</span></span></span><span class=line><span class=cl><span class=s>    chroot      /var/lib/haproxy
</span></span></span><span class=line><span class=cl><span class=s>    pidfile     /var/run/haproxy.pid
</span></span></span><span class=line><span class=cl><span class=s>    maxconn     4000
</span></span></span><span class=line><span class=cl><span class=s>    user        haproxy
</span></span></span><span class=line><span class=cl><span class=s>    group       haproxy
</span></span></span><span class=line><span class=cl><span class=s>    daemon 
</span></span></span><span class=line><span class=cl><span class=s>       
</span></span></span><span class=line><span class=cl><span class=s>    # turn on stats unix socket
</span></span></span><span class=line><span class=cl><span class=s>    stats socket /var/lib/haproxy/stats
</span></span></span><span class=line><span class=cl><span class=s>#---------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=s># common defaults that all the &#39;listen&#39; and &#39;backend&#39; sections will
</span></span></span><span class=line><span class=cl><span class=s># use if not designated in their block
</span></span></span><span class=line><span class=cl><span class=s>#---------------------------------------------------------------------  
</span></span></span><span class=line><span class=cl><span class=s>defaults
</span></span></span><span class=line><span class=cl><span class=s>    mode                    http
</span></span></span><span class=line><span class=cl><span class=s>    log                     global
</span></span></span><span class=line><span class=cl><span class=s>    option                  httplog
</span></span></span><span class=line><span class=cl><span class=s>    option                  dontlognull
</span></span></span><span class=line><span class=cl><span class=s>    option http-server-close
</span></span></span><span class=line><span class=cl><span class=s>    option forwardfor       except 127.0.0.0/8
</span></span></span><span class=line><span class=cl><span class=s>    option                  redispatch
</span></span></span><span class=line><span class=cl><span class=s>    retries                 3
</span></span></span><span class=line><span class=cl><span class=s>    timeout http-request    10s
</span></span></span><span class=line><span class=cl><span class=s>    timeout queue           1m
</span></span></span><span class=line><span class=cl><span class=s>    timeout connect         10s
</span></span></span><span class=line><span class=cl><span class=s>    timeout client          1m
</span></span></span><span class=line><span class=cl><span class=s>    timeout server          1m
</span></span></span><span class=line><span class=cl><span class=s>    timeout http-keep-alive 10s
</span></span></span><span class=line><span class=cl><span class=s>    timeout check           10s
</span></span></span><span class=line><span class=cl><span class=s>    maxconn                 3000
</span></span></span><span class=line><span class=cl><span class=s>#---------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=s># kubernetes apiserver frontend which proxys to the backends
</span></span></span><span class=line><span class=cl><span class=s>#--------------------------------------------------------------------- 
</span></span></span><span class=line><span class=cl><span class=s>frontend kubernetes-apiserver
</span></span></span><span class=line><span class=cl><span class=s>    mode                 tcp
</span></span></span><span class=line><span class=cl><span class=s>    bind                 *:8443
</span></span></span><span class=line><span class=cl><span class=s>    option               tcplog
</span></span></span><span class=line><span class=cl><span class=s>    default_backend      kubernetes-apiserver    
</span></span></span><span class=line><span class=cl><span class=s>#---------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=s># round robin balancing between the various backends
</span></span></span><span class=line><span class=cl><span class=s>#---------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=s>backend kubernetes-apiserver
</span></span></span><span class=line><span class=cl><span class=s>    mode        tcp
</span></span></span><span class=line><span class=cl><span class=s>    balance     roundrobin
</span></span></span><span class=line><span class=cl><span class=s>    server      k8s-master01   10.0.0.10:6443 check
</span></span></span><span class=line><span class=cl><span class=s>    server      k8s-master02   10.0.0.11:6443 check
</span></span></span><span class=line><span class=cl><span class=s>    server      k8s-master03   10.0.0.12:6443 check
</span></span></span><span class=line><span class=cl><span class=s>#---------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=s># collection haproxy statistics message
</span></span></span><span class=line><span class=cl><span class=s>#---------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=s>listen stats
</span></span></span><span class=line><span class=cl><span class=s>    bind                 *:1080
</span></span></span><span class=line><span class=cl><span class=s>    stats auth           admin:admin
</span></span></span><span class=line><span class=cl><span class=s>    stats refresh        5s
</span></span></span><span class=line><span class=cl><span class=s>    stats realm          HAProxy\ Statistics
</span></span></span><span class=line><span class=cl><span class=s>    stats uri            /admin?stats
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></td></tr></table></div></div><p>启动haproxy</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl <span class=nb>enable</span> haproxy <span class=o>&amp;&amp;</span> systemctl start haproxy
</span></span></code></pre></td></tr></table></div></div><p>9.安装docker</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -o /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>yum install docker-ce-18.06.3.ce-3.el7 -y
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat &gt; /etc/docker/daemon.json <span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>{
</span></span></span><span class=line><span class=cl><span class=s>   &#34;exec-opts&#34;: [&#34;native.cgroupdriver=systemd&#34;],
</span></span></span><span class=line><span class=cl><span class=s>  &#34;registry-mirrors&#34;: [&#34;https://dockerhub.mirrors.nwafu.edu.cn/&#34;],
</span></span></span><span class=line><span class=cl><span class=s>}
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>systemctl start docker
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> docker
</span></span></code></pre></td></tr></table></div></div><p>10.配置k8s源</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
</span></span></span><span class=line><span class=cl><span class=s>[kubernetes]
</span></span></span><span class=line><span class=cl><span class=s>name=Kubernetes
</span></span></span><span class=line><span class=cl><span class=s>baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
</span></span></span><span class=line><span class=cl><span class=s>enabled=1
</span></span></span><span class=line><span class=cl><span class=s>gpgcheck=1
</span></span></span><span class=line><span class=cl><span class=s>repo_gpgcheck=1
</span></span></span><span class=line><span class=cl><span class=s>gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></td></tr></table></div></div><p>安装kubelet、kubeadm</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum install -y kubelet-1.15.3-0 kubeadm-1.15.3-0
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> kubelet.service <span class=o>&amp;&amp;</span> systemctl start kubelet
</span></span></code></pre></td></tr></table></div></div><p>11.生成集群配置文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat &gt; kubeadm-config.yaml <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>apiServer:
</span></span></span><span class=line><span class=cl><span class=s>  certSANs:
</span></span></span><span class=line><span class=cl><span class=s>    - k8s-master01
</span></span></span><span class=line><span class=cl><span class=s>    - k8s-master02
</span></span></span><span class=line><span class=cl><span class=s>    - k8s-master03
</span></span></span><span class=line><span class=cl><span class=s>    - k8s-master
</span></span></span><span class=line><span class=cl><span class=s>    - 10.0.0.10
</span></span></span><span class=line><span class=cl><span class=s>    - 10.0.0.11
</span></span></span><span class=line><span class=cl><span class=s>    - 10.0.0.12
</span></span></span><span class=line><span class=cl><span class=s>    - 10.0.0.5
</span></span></span><span class=line><span class=cl><span class=s>    - 127.0.0.1
</span></span></span><span class=line><span class=cl><span class=s>  extraArgs:
</span></span></span><span class=line><span class=cl><span class=s>    authorization-mode: Node,RBAC
</span></span></span><span class=line><span class=cl><span class=s>  timeoutForControlPlane: 4m0s
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: kubeadm.k8s.io/v1beta2
</span></span></span><span class=line><span class=cl><span class=s>certificatesDir: /etc/kubernetes/pki
</span></span></span><span class=line><span class=cl><span class=s>clusterName: kubernetes
</span></span></span><span class=line><span class=cl><span class=s>controlPlaneEndpoint: &#34;k8s-master:8443&#34;
</span></span></span><span class=line><span class=cl><span class=s>controllerManager: {}
</span></span></span><span class=line><span class=cl><span class=s>dns: 
</span></span></span><span class=line><span class=cl><span class=s>  type: CoreDNS
</span></span></span><span class=line><span class=cl><span class=s>etcd:
</span></span></span><span class=line><span class=cl><span class=s>  local:    
</span></span></span><span class=line><span class=cl><span class=s>    dataDir: /var/lib/etcd
</span></span></span><span class=line><span class=cl><span class=s>imageRepository: registry.aliyuncs.com/google_containers
</span></span></span><span class=line><span class=cl><span class=s>kind: ClusterConfiguration
</span></span></span><span class=line><span class=cl><span class=s>kubernetesVersion: v1.15.3
</span></span></span><span class=line><span class=cl><span class=s>networking: 
</span></span></span><span class=line><span class=cl><span class=s>  dnsDomain: cluster.local  
</span></span></span><span class=line><span class=cl><span class=s>  podSubnet: 10.244.0.0/16
</span></span></span><span class=line><span class=cl><span class=s>  serviceSubnet: 10.1.0.0/16
</span></span></span><span class=line><span class=cl><span class=s>scheduler: {}
</span></span></span><span class=line><span class=cl><span class=s>---
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: kubeproxy.config.k8s.io/v1alpha1
</span></span></span><span class=line><span class=cl><span class=s>kind: KubeProxyConfiguration
</span></span></span><span class=line><span class=cl><span class=s>mode: ipvs
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></td></tr></table></div></div><p>初始化第一个master节点：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubeadm init --config kubeadm-config.yaml --experimental-upload-certs
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Your Kubernetes control-plane has initialized successfully!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>To start using your cluster, you need to run the following as a regular user:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  mkdir -p <span class=nv>$HOME</span>/.kube
</span></span><span class=line><span class=cl>  sudo cp -i /etc/kubernetes/admin.conf <span class=nv>$HOME</span>/.kube/config
</span></span><span class=line><span class=cl>  sudo chown <span class=k>$(</span>id -u<span class=k>)</span>:<span class=k>$(</span>id -g<span class=k>)</span> <span class=nv>$HOME</span>/.kube/config
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>You should now deploy a pod network to the cluster.
</span></span><span class=line><span class=cl>Run <span class=s2>&#34;kubectl apply -f [podnetwork].yaml&#34;</span> with one of the options listed at:
</span></span><span class=line><span class=cl>  https://kubernetes.io/docs/concepts/cluster-administration/addons/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>You can now join any number of the control-plane node running the following <span class=nb>command</span> on each as root:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  kubeadm join k8s-master:8443 --token ax2bp9.3urgj3zz0venammc <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --discovery-token-ca-cert-hash sha256:8b6d70e35884f1a15c3834b2db4d5649902cccfd4e755a0064ad8ffffb0dc9ed <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --control-plane --certificate-key 7f6e02ff6e4a07e09be3e4af53c1f74306243228329710bbdb76a84983e8c753
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Please note that the certificate-key gives access to cluster sensitive data, keep it secret!
</span></span><span class=line><span class=cl>As a safeguard, uploaded-certs will be deleted in two hours<span class=p>;</span> If necessary, you can use 
</span></span><span class=line><span class=cl><span class=s2>&#34;kubeadm init phase upload-certs --upload-certs&#34;</span> to reload certs afterward.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Then you can join any number of worker nodes by running the following on each as root:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubeadm join k8s-master:8443 --token ax2bp9.3urgj3zz0venammc <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --discovery-token-ca-cert-hash sha256:8b6d70e35884f1a15c3834b2db4d5649902cccfd4e755a0064ad8ffffb0dc9ed
</span></span></code></pre></td></tr></table></div></div><p>kubeconfig</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>  mkdir -p <span class=nv>$HOME</span>/.kube
</span></span><span class=line><span class=cl>  sudo cp -i /etc/kubernetes/admin.conf <span class=nv>$HOME</span>/.kube/config
</span></span><span class=line><span class=cl>  sudo chown <span class=k>$(</span>id -u<span class=k>)</span>:<span class=k>$(</span>id -g<span class=k>)</span> <span class=nv>$HOME</span>/.kube/config
</span></span></code></pre></td></tr></table></div></div><p>配置flannel</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat &gt; kube-flannel.yaml <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>---
</span></span></span><span class=line><span class=cl><span class=s>kind: ClusterRole
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: rbac.authorization.k8s.io/v1beta1
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: flannel
</span></span></span><span class=line><span class=cl><span class=s>rules:
</span></span></span><span class=line><span class=cl><span class=s>  - apiGroups:
</span></span></span><span class=line><span class=cl><span class=s>      - &#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s>    resources:
</span></span></span><span class=line><span class=cl><span class=s>      - pods
</span></span></span><span class=line><span class=cl><span class=s>    verbs:
</span></span></span><span class=line><span class=cl><span class=s>      - get
</span></span></span><span class=line><span class=cl><span class=s>  - apiGroups:
</span></span></span><span class=line><span class=cl><span class=s>      - &#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s>    resources:
</span></span></span><span class=line><span class=cl><span class=s>      - nodes
</span></span></span><span class=line><span class=cl><span class=s>    verbs:
</span></span></span><span class=line><span class=cl><span class=s>      - list
</span></span></span><span class=line><span class=cl><span class=s>      - watch
</span></span></span><span class=line><span class=cl><span class=s>  - apiGroups:
</span></span></span><span class=line><span class=cl><span class=s>      - &#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s>    resources:
</span></span></span><span class=line><span class=cl><span class=s>      - nodes/status
</span></span></span><span class=line><span class=cl><span class=s>    verbs:
</span></span></span><span class=line><span class=cl><span class=s>      - patch
</span></span></span><span class=line><span class=cl><span class=s>---
</span></span></span><span class=line><span class=cl><span class=s>kind: ClusterRoleBinding
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: rbac.authorization.k8s.io/v1beta1
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: flannel
</span></span></span><span class=line><span class=cl><span class=s>roleRef:
</span></span></span><span class=line><span class=cl><span class=s>  apiGroup: rbac.authorization.k8s.io
</span></span></span><span class=line><span class=cl><span class=s>  kind: ClusterRole
</span></span></span><span class=line><span class=cl><span class=s>  name: flannel
</span></span></span><span class=line><span class=cl><span class=s>subjects:
</span></span></span><span class=line><span class=cl><span class=s>- kind: ServiceAccount
</span></span></span><span class=line><span class=cl><span class=s>  name: flannel
</span></span></span><span class=line><span class=cl><span class=s>  namespace: kube-system
</span></span></span><span class=line><span class=cl><span class=s>---
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: v1
</span></span></span><span class=line><span class=cl><span class=s>kind: ServiceAccount
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: flannel
</span></span></span><span class=line><span class=cl><span class=s>  namespace: kube-system
</span></span></span><span class=line><span class=cl><span class=s>---
</span></span></span><span class=line><span class=cl><span class=s>kind: ConfigMap
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: v1
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: kube-flannel-cfg
</span></span></span><span class=line><span class=cl><span class=s>  namespace: kube-system
</span></span></span><span class=line><span class=cl><span class=s>  labels:
</span></span></span><span class=line><span class=cl><span class=s>    tier: node
</span></span></span><span class=line><span class=cl><span class=s>    app: flannel
</span></span></span><span class=line><span class=cl><span class=s>data:
</span></span></span><span class=line><span class=cl><span class=s>  cni-conf.json: |
</span></span></span><span class=line><span class=cl><span class=s>    {
</span></span></span><span class=line><span class=cl><span class=s>      &#34;name&#34;: &#34;cbr0&#34;,
</span></span></span><span class=line><span class=cl><span class=s>      &#34;plugins&#34;: [
</span></span></span><span class=line><span class=cl><span class=s>        {
</span></span></span><span class=line><span class=cl><span class=s>          &#34;type&#34;: &#34;flannel&#34;,
</span></span></span><span class=line><span class=cl><span class=s>          &#34;delegate&#34;: {
</span></span></span><span class=line><span class=cl><span class=s>            &#34;hairpinMode&#34;: true,
</span></span></span><span class=line><span class=cl><span class=s>            &#34;isDefaultGateway&#34;: true
</span></span></span><span class=line><span class=cl><span class=s>          }
</span></span></span><span class=line><span class=cl><span class=s>        },
</span></span></span><span class=line><span class=cl><span class=s>        {
</span></span></span><span class=line><span class=cl><span class=s>          &#34;type&#34;: &#34;portmap&#34;,
</span></span></span><span class=line><span class=cl><span class=s>          &#34;capabilities&#34;: {
</span></span></span><span class=line><span class=cl><span class=s>            &#34;portMappings&#34;: true
</span></span></span><span class=line><span class=cl><span class=s>          }
</span></span></span><span class=line><span class=cl><span class=s>        }
</span></span></span><span class=line><span class=cl><span class=s>      ]
</span></span></span><span class=line><span class=cl><span class=s>    }
</span></span></span><span class=line><span class=cl><span class=s>  net-conf.json: |
</span></span></span><span class=line><span class=cl><span class=s>    {
</span></span></span><span class=line><span class=cl><span class=s>      &#34;Network&#34;: &#34;10.244.0.0/16&#34;,
</span></span></span><span class=line><span class=cl><span class=s>      &#34;Backend&#34;: {
</span></span></span><span class=line><span class=cl><span class=s>        &#34;Type&#34;: &#34;vxlan&#34;
</span></span></span><span class=line><span class=cl><span class=s>      }
</span></span></span><span class=line><span class=cl><span class=s>    }
</span></span></span><span class=line><span class=cl><span class=s>---
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: extensions/v1beta1
</span></span></span><span class=line><span class=cl><span class=s>kind: DaemonSet
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: kube-flannel-ds-amd64
</span></span></span><span class=line><span class=cl><span class=s>  namespace: kube-system
</span></span></span><span class=line><span class=cl><span class=s>  labels:
</span></span></span><span class=line><span class=cl><span class=s>    tier: node
</span></span></span><span class=line><span class=cl><span class=s>    app: flannel
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  template:
</span></span></span><span class=line><span class=cl><span class=s>    metadata:
</span></span></span><span class=line><span class=cl><span class=s>      labels:
</span></span></span><span class=line><span class=cl><span class=s>        tier: node
</span></span></span><span class=line><span class=cl><span class=s>        app: flannel
</span></span></span><span class=line><span class=cl><span class=s>    spec:
</span></span></span><span class=line><span class=cl><span class=s>      hostNetwork: true
</span></span></span><span class=line><span class=cl><span class=s>      nodeSelector:
</span></span></span><span class=line><span class=cl><span class=s>        beta.kubernetes.io/arch: amd64
</span></span></span><span class=line><span class=cl><span class=s>      tolerations:
</span></span></span><span class=line><span class=cl><span class=s>      - operator: Exists
</span></span></span><span class=line><span class=cl><span class=s>        effect: NoSchedule
</span></span></span><span class=line><span class=cl><span class=s>      serviceAccountName: flannel
</span></span></span><span class=line><span class=cl><span class=s>      initContainers:
</span></span></span><span class=line><span class=cl><span class=s>      - name: install-cni
</span></span></span><span class=line><span class=cl><span class=s>        image: quay.io/coreos/flannel:v0.11.0-amd64
</span></span></span><span class=line><span class=cl><span class=s>        command:
</span></span></span><span class=line><span class=cl><span class=s>        - cp
</span></span></span><span class=line><span class=cl><span class=s>        args:
</span></span></span><span class=line><span class=cl><span class=s>        - -f
</span></span></span><span class=line><span class=cl><span class=s>        - /etc/kube-flannel/cni-conf.json
</span></span></span><span class=line><span class=cl><span class=s>        - /etc/cni/net.d/10-flannel.conflist
</span></span></span><span class=line><span class=cl><span class=s>        volumeMounts:
</span></span></span><span class=line><span class=cl><span class=s>        - name: cni
</span></span></span><span class=line><span class=cl><span class=s>          mountPath: /etc/cni/net.d
</span></span></span><span class=line><span class=cl><span class=s>        - name: flannel-cfg
</span></span></span><span class=line><span class=cl><span class=s>          mountPath: /etc/kube-flannel/
</span></span></span><span class=line><span class=cl><span class=s>      containers:
</span></span></span><span class=line><span class=cl><span class=s>      - name: kube-flannel
</span></span></span><span class=line><span class=cl><span class=s>        image: quay.io/coreos/flannel:v0.11.0-amd64
</span></span></span><span class=line><span class=cl><span class=s>        command:
</span></span></span><span class=line><span class=cl><span class=s>        - /opt/bin/flanneld
</span></span></span><span class=line><span class=cl><span class=s>        args:
</span></span></span><span class=line><span class=cl><span class=s>        - --ip-masq
</span></span></span><span class=line><span class=cl><span class=s>        - --kube-subnet-mgr
</span></span></span><span class=line><span class=cl><span class=s>        resources:
</span></span></span><span class=line><span class=cl><span class=s>          requests:
</span></span></span><span class=line><span class=cl><span class=s>            cpu: &#34;100m&#34;
</span></span></span><span class=line><span class=cl><span class=s>            memory: &#34;50Mi&#34;
</span></span></span><span class=line><span class=cl><span class=s>          limits:
</span></span></span><span class=line><span class=cl><span class=s>            cpu: &#34;100m&#34;
</span></span></span><span class=line><span class=cl><span class=s>            memory: &#34;50Mi&#34;
</span></span></span><span class=line><span class=cl><span class=s>        securityContext:
</span></span></span><span class=line><span class=cl><span class=s>          privileged: true
</span></span></span><span class=line><span class=cl><span class=s>        env:
</span></span></span><span class=line><span class=cl><span class=s>        - name: POD_NAME
</span></span></span><span class=line><span class=cl><span class=s>          valueFrom:
</span></span></span><span class=line><span class=cl><span class=s>            fieldRef:
</span></span></span><span class=line><span class=cl><span class=s>              fieldPath: metadata.name
</span></span></span><span class=line><span class=cl><span class=s>        - name: POD_NAMESPACE
</span></span></span><span class=line><span class=cl><span class=s>          valueFrom:
</span></span></span><span class=line><span class=cl><span class=s>            fieldRef:
</span></span></span><span class=line><span class=cl><span class=s>              fieldPath: metadata.namespace
</span></span></span><span class=line><span class=cl><span class=s>        volumeMounts:
</span></span></span><span class=line><span class=cl><span class=s>        - name: run
</span></span></span><span class=line><span class=cl><span class=s>          mountPath: /run
</span></span></span><span class=line><span class=cl><span class=s>        - name: flannel-cfg
</span></span></span><span class=line><span class=cl><span class=s>          mountPath: /etc/kube-flannel/
</span></span></span><span class=line><span class=cl><span class=s>      volumes:
</span></span></span><span class=line><span class=cl><span class=s>        - name: run
</span></span></span><span class=line><span class=cl><span class=s>          hostPath:
</span></span></span><span class=line><span class=cl><span class=s>            path: /run
</span></span></span><span class=line><span class=cl><span class=s>        - name: cni
</span></span></span><span class=line><span class=cl><span class=s>          hostPath:
</span></span></span><span class=line><span class=cl><span class=s>            path: /etc/cni/net.d
</span></span></span><span class=line><span class=cl><span class=s>        - name: flannel-cfg
</span></span></span><span class=line><span class=cl><span class=s>          configMap:
</span></span></span><span class=line><span class=cl><span class=s>            name: kube-flannel-cfg
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></td></tr></table></div></div><p>部署flannel</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f kube-flannel.yaml
</span></span></code></pre></td></tr></table></div></div><p>添加master节点</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>  kubeadm join k8s-master:8443 --token ax2bp9.3urgj3zz0venammc <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --discovery-token-ca-cert-hash sha256:8b6d70e35884f1a15c3834b2db4d5649902cccfd4e755a0064ad8ffffb0dc9ed <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --control-plane --certificate-key 7f6e02ff6e4a07e09be3e4af53c1f74306243228329710bbdb76a84983e8c753
</span></span></code></pre></td></tr></table></div></div><p>默认的token是2小时过期，后续添加节点可以使用以下方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#生成token</span>
</span></span><span class=line><span class=cl>kubeadm token create --print-join-command
</span></span><span class=line><span class=cl><span class=c1>#生成加入所需的证书</span>
</span></span><span class=line><span class=cl>kubeadm init phase upload-certs --upload-certs
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>upload-certs<span class=o>]</span> Using certificate key:
</span></span><span class=line><span class=cl>e15a6cc99b25cc953c651a3f372fc471f19c2a1f37541f60964d3ee7bb37b59f
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#添加master节点</span>
</span></span><span class=line><span class=cl>kubeadm join k8s-master:8443 --token 69zo1f.ewu91vkugod22372     --discovery-token-ca-cert-hash sha256:8b6d70e35884f1a15c3834b2db4d5649902cccfd4e755a0064ad8ffffb0dc9ed --control-plane --certificate-key<span class=o>=</span>e15a6cc99b25cc953c651a3f372fc471f19c2a1f37541f60964d3ee7bb37b59f
</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2020-12-08 16:25:33">更新于 2020-12-08 16:25&nbsp;</span></div><div class=post-info-license><span>本站使用「署名 4.0 国际」创作共享协议，可自由转载、引用，但需署名作者且注明文章出处</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/k8s/ class=post-tag>k8s</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/post/1874/ class=post-nav-item rel=prev title=harbor2.0.1安装部署><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>harbor2.0.1安装部署</a>
<a href=/post/1876/ class=post-nav-item rel=next title=hadoop3.2.1伪分布式模式安装>hadoop3.2.1伪分布式模式安装<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div class=post-reward><div class=comment>请我喝杯水</div><input type=checkbox class=reward-input name=reward id=fi-reward hidden>
<label class=reward-button for=fi-reward>赞赏</label><div class=reward-ways><div><img src=/images/wx.png alt="SoulChild 微信号">
<span data-animation>微信号</span></div><div><img src=/images/wechatpay.png alt="SoulChild 微信打赏">
<span data-animation>微信打赏</span></div></div></div><div id=comments><div id=giscus><script src=https://giscus.app/client.js data-repo=SoulChildTc/soulchild-blog data-repo-id=R_kgDOIwJKxg data-category=General data-category-id=DIC_kwDOIwJKxs4CTwRk data-mapping=title data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article></main><footer class=footer><div class=footer-container><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2017 - 2023</span><span class=author itemprop=copyrightHolder>
<a href=https://www.soulchild.cn target=_blank rel="external nofollow noopener noreferrer">SoulChild</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class=site-time title='网站运行中 ...'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="run-times ms-1">网站运行中 ...</span></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div><div class="footer-line beian"><span class="icp footer-divider">特别感谢
<a href=https://gohugo.io target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.109.0">Hugo</a> |
<a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.17-RC">FixIt</a> |
<a href=https://github.com target=_blank rel="noopener noreffer">GitHub</a> |
<a href=https://vercel.com target=_blank rel="noopener noreffer">Vercel</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><div id=mask></div><div class=reading-progress-bar style=left:0;top:0;--bg-progress:#438a55;--bg-progress-dark:#438a55></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/pace/themes/green/pace-theme-bounce.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script src=/lib/lazysizes/lazysizes.min.js async defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/typeit/index.umd.js defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/pangu/pangu.min.js defer></script><script src=/lib/cell-watermark/watermark.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:50},comment:{enable:!0,expired:!1,giscus:{darkTheme:"dark",lightTheme:"light"}},data:{"typeit-header-subtitle-desktop":"rm -fr /*","typeit-header-subtitle-mobile":"rm -fr /*"},enablePWA:!0,lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},pangu:{enable:!0,selector:"article"},search:{algoliaAppID:"CE9G7Q4H6N",algoliaIndex:"soulchild-blog",algoliaSearchKey:"0f69a431d92a03c2cf4143d8dbc6af0a",highlightTag:"em",maxResultLength:20,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},siteTime:"2017-06-08T21:38:36+08:00",typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"typeit-header-subtitle-desktop":["typeit-header-subtitle-desktop"],"typeit-header-subtitle-mobile":["typeit-header-subtitle-mobile"]},duration:-1,speed:100},watermark:{appendto:".wrapper\u003emain",colspacing:300,content:"SoulChild随笔记",enable:!0,fontfamily:"inherit",fontsize:.85,height:300,opacity:.1,rotate:15,rowspacing:100,width:300}}</script><script src=/js/theme.min.js defer></script></body></html>